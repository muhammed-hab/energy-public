function $4(t,e){for(var a=0;a<e.length;a++){const c=e[a];if(typeof c!="string"&&!Array.isArray(c)){for(const p in c)if(p!=="default"&&!(p in t)){const y=Object.getOwnPropertyDescriptor(c,p);y&&Object.defineProperty(t,p,y.get?y:{enumerable:!0,get:()=>c[p]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))c(p);new MutationObserver(p=>{for(const y of p)if(y.type==="childList")for(const M of y.addedNodes)M.tagName==="LINK"&&M.rel==="modulepreload"&&c(M)}).observe(document,{childList:!0,subtree:!0});function a(p){const y={};return p.integrity&&(y.integrity=p.integrity),p.referrerPolicy&&(y.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?y.credentials="include":p.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function c(p){if(p.ep)return;p.ep=!0;const y=a(p);fetch(p.href,y)}})();function Im(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var tT={exports:{}},qx={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iP;function X4(){if(iP)return qx;iP=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function a(c,p,y){var M=null;if(y!==void 0&&(M=""+y),p.key!==void 0&&(M=""+p.key),"key"in p){y={};for(var r in p)r!=="key"&&(y[r]=p[r])}else y=p;return p=y.ref,{$$typeof:t,type:c,key:M,ref:p!==void 0?p:null,props:y}}return qx.Fragment=e,qx.jsx=a,qx.jsxs=a,qx}var rP;function Z4(){return rP||(rP=1,tT.exports=X4()),tT.exports}var se=Z4(),nT={exports:{}},br={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aP;function Y4(){if(aP)return br;aP=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),y=Symbol.for("react.consumer"),M=Symbol.for("react.context"),r=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),k=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),U=Symbol.iterator;function H(Xe){return Xe===null||typeof Xe!="object"?null:(Xe=U&&Xe[U]||Xe["@@iterator"],typeof Xe=="function"?Xe:null)}var Y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},X=Object.assign,Q={};function J(Xe,kt,_n){this.props=Xe,this.context=kt,this.refs=Q,this.updater=_n||Y}J.prototype.isReactComponent={},J.prototype.setState=function(Xe,kt){if(typeof Xe!="object"&&typeof Xe!="function"&&Xe!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Xe,kt,"setState")},J.prototype.forceUpdate=function(Xe){this.updater.enqueueForceUpdate(this,Xe,"forceUpdate")};function j(){}j.prototype=J.prototype;function oe(Xe,kt,_n){this.props=Xe,this.context=kt,this.refs=Q,this.updater=_n||Y}var ce=oe.prototype=new j;ce.constructor=oe,X(ce,J.prototype),ce.isPureReactComponent=!0;var pe=Array.isArray,Ae={H:null,A:null,T:null,S:null},Ee=Object.prototype.hasOwnProperty;function be(Xe,kt,_n,Xt,It,ln){return _n=ln.ref,{$$typeof:t,type:Xe,key:kt,ref:_n!==void 0?_n:null,props:ln}}function Ve(Xe,kt){return be(Xe.type,kt,void 0,void 0,void 0,Xe.props)}function Se(Xe){return typeof Xe=="object"&&Xe!==null&&Xe.$$typeof===t}function xe(Xe){var kt={"=":"=0",":":"=2"};return"$"+Xe.replace(/[=:]/g,function(_n){return kt[_n]})}var Fe=/\/+/g;function Ct(Xe,kt){return typeof Xe=="object"&&Xe!==null&&Xe.key!=null?xe(""+Xe.key):kt.toString(36)}function Et(){}function Tt(Xe){switch(Xe.status){case"fulfilled":return Xe.value;case"rejected":throw Xe.reason;default:switch(typeof Xe.status=="string"?Xe.then(Et,Et):(Xe.status="pending",Xe.then(function(kt){Xe.status==="pending"&&(Xe.status="fulfilled",Xe.value=kt)},function(kt){Xe.status==="pending"&&(Xe.status="rejected",Xe.reason=kt)})),Xe.status){case"fulfilled":return Xe.value;case"rejected":throw Xe.reason}}throw Xe}function _t(Xe,kt,_n,Xt,It){var ln=typeof Xe;(ln==="undefined"||ln==="boolean")&&(Xe=null);var fn=!1;if(Xe===null)fn=!0;else switch(ln){case"bigint":case"string":case"number":fn=!0;break;case"object":switch(Xe.$$typeof){case t:case e:fn=!0;break;case B:return fn=Xe._init,_t(fn(Xe._payload),kt,_n,Xt,It)}}if(fn)return It=It(Xe),fn=Xt===""?"."+Ct(Xe,0):Xt,pe(It)?(_n="",fn!=null&&(_n=fn.replace(Fe,"$&/")+"/"),_t(It,kt,_n,"",function(jn){return jn})):It!=null&&(Se(It)&&(It=Ve(It,_n+(It.key==null||Xe&&Xe.key===It.key?"":(""+It.key).replace(Fe,"$&/")+"/")+fn)),kt.push(It)),1;fn=0;var $t=Xt===""?".":Xt+":";if(pe(Xe))for(var pn=0;pn<Xe.length;pn++)Xt=Xe[pn],ln=$t+Ct(Xt,pn),fn+=_t(Xt,kt,_n,ln,It);else if(pn=H(Xe),typeof pn=="function")for(Xe=pn.call(Xe),pn=0;!(Xt=Xe.next()).done;)Xt=Xt.value,ln=$t+Ct(Xt,pn++),fn+=_t(Xt,kt,_n,ln,It);else if(ln==="object"){if(typeof Xe.then=="function")return _t(Tt(Xe),kt,_n,Xt,It);throw kt=String(Xe),Error("Objects are not valid as a React child (found: "+(kt==="[object Object]"?"object with keys {"+Object.keys(Xe).join(", ")+"}":kt)+"). If you meant to render a collection of children, use an array instead.")}return fn}function et(Xe,kt,_n){if(Xe==null)return Xe;var Xt=[],It=0;return _t(Xe,Xt,"","",function(ln){return kt.call(_n,ln,It++)}),Xt}function Lt(Xe){if(Xe._status===-1){var kt=Xe._result;kt=kt(),kt.then(function(_n){(Xe._status===0||Xe._status===-1)&&(Xe._status=1,Xe._result=_n)},function(_n){(Xe._status===0||Xe._status===-1)&&(Xe._status=2,Xe._result=_n)}),Xe._status===-1&&(Xe._status=0,Xe._result=kt)}if(Xe._status===1)return Xe._result.default;throw Xe._result}var lt=typeof reportError=="function"?reportError:function(Xe){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var kt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Xe=="object"&&Xe!==null&&typeof Xe.message=="string"?String(Xe.message):String(Xe),error:Xe});if(!window.dispatchEvent(kt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Xe);return}console.error(Xe)};function ut(){}return br.Children={map:et,forEach:function(Xe,kt,_n){et(Xe,function(){kt.apply(this,arguments)},_n)},count:function(Xe){var kt=0;return et(Xe,function(){kt++}),kt},toArray:function(Xe){return et(Xe,function(kt){return kt})||[]},only:function(Xe){if(!Se(Xe))throw Error("React.Children.only expected to receive a single React element child.");return Xe}},br.Component=J,br.Fragment=a,br.Profiler=p,br.PureComponent=oe,br.StrictMode=c,br.Suspense=I,br.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ae,br.act=function(){throw Error("act(...) is not supported in production builds of React.")},br.cache=function(Xe){return function(){return Xe.apply(null,arguments)}},br.cloneElement=function(Xe,kt,_n){if(Xe==null)throw Error("The argument must be a React element, but you passed "+Xe+".");var Xt=X({},Xe.props),It=Xe.key,ln=void 0;if(kt!=null)for(fn in kt.ref!==void 0&&(ln=void 0),kt.key!==void 0&&(It=""+kt.key),kt)!Ee.call(kt,fn)||fn==="key"||fn==="__self"||fn==="__source"||fn==="ref"&&kt.ref===void 0||(Xt[fn]=kt[fn]);var fn=arguments.length-2;if(fn===1)Xt.children=_n;else if(1<fn){for(var $t=Array(fn),pn=0;pn<fn;pn++)$t[pn]=arguments[pn+2];Xt.children=$t}return be(Xe.type,It,void 0,void 0,ln,Xt)},br.createContext=function(Xe){return Xe={$$typeof:M,_currentValue:Xe,_currentValue2:Xe,_threadCount:0,Provider:null,Consumer:null},Xe.Provider=Xe,Xe.Consumer={$$typeof:y,_context:Xe},Xe},br.createElement=function(Xe,kt,_n){var Xt,It={},ln=null;if(kt!=null)for(Xt in kt.key!==void 0&&(ln=""+kt.key),kt)Ee.call(kt,Xt)&&Xt!=="key"&&Xt!=="__self"&&Xt!=="__source"&&(It[Xt]=kt[Xt]);var fn=arguments.length-2;if(fn===1)It.children=_n;else if(1<fn){for(var $t=Array(fn),pn=0;pn<fn;pn++)$t[pn]=arguments[pn+2];It.children=$t}if(Xe&&Xe.defaultProps)for(Xt in fn=Xe.defaultProps,fn)It[Xt]===void 0&&(It[Xt]=fn[Xt]);return be(Xe,ln,void 0,void 0,null,It)},br.createRef=function(){return{current:null}},br.forwardRef=function(Xe){return{$$typeof:r,render:Xe}},br.isValidElement=Se,br.lazy=function(Xe){return{$$typeof:B,_payload:{_status:-1,_result:Xe},_init:Lt}},br.memo=function(Xe,kt){return{$$typeof:k,type:Xe,compare:kt===void 0?null:kt}},br.startTransition=function(Xe){var kt=Ae.T,_n={};Ae.T=_n;try{var Xt=Xe(),It=Ae.S;It!==null&&It(_n,Xt),typeof Xt=="object"&&Xt!==null&&typeof Xt.then=="function"&&Xt.then(ut,lt)}catch(ln){lt(ln)}finally{Ae.T=kt}},br.unstable_useCacheRefresh=function(){return Ae.H.useCacheRefresh()},br.use=function(Xe){return Ae.H.use(Xe)},br.useActionState=function(Xe,kt,_n){return Ae.H.useActionState(Xe,kt,_n)},br.useCallback=function(Xe,kt){return Ae.H.useCallback(Xe,kt)},br.useContext=function(Xe){return Ae.H.useContext(Xe)},br.useDebugValue=function(){},br.useDeferredValue=function(Xe,kt){return Ae.H.useDeferredValue(Xe,kt)},br.useEffect=function(Xe,kt){return Ae.H.useEffect(Xe,kt)},br.useId=function(){return Ae.H.useId()},br.useImperativeHandle=function(Xe,kt,_n){return Ae.H.useImperativeHandle(Xe,kt,_n)},br.useInsertionEffect=function(Xe,kt){return Ae.H.useInsertionEffect(Xe,kt)},br.useLayoutEffect=function(Xe,kt){return Ae.H.useLayoutEffect(Xe,kt)},br.useMemo=function(Xe,kt){return Ae.H.useMemo(Xe,kt)},br.useOptimistic=function(Xe,kt){return Ae.H.useOptimistic(Xe,kt)},br.useReducer=function(Xe,kt,_n){return Ae.H.useReducer(Xe,kt,_n)},br.useRef=function(Xe){return Ae.H.useRef(Xe)},br.useState=function(Xe){return Ae.H.useState(Xe)},br.useSyncExternalStore=function(Xe,kt,_n){return Ae.H.useSyncExternalStore(Xe,kt,_n)},br.useTransition=function(){return Ae.H.useTransition()},br.version="19.0.0",br}var oP;function DC(){return oP||(oP=1,nT.exports=Y4()),nT.exports}var le=DC();const Go=Im(le),K4=$4({__proto__:null,default:Go},[le]);var iT={exports:{}},Wx={},rT={exports:{}},aT={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sP;function J4(){return sP||(sP=1,function(t){function e(et,Lt){var lt=et.length;et.push(Lt);e:for(;0<lt;){var ut=lt-1>>>1,Xe=et[ut];if(0<p(Xe,Lt))et[ut]=Lt,et[lt]=Xe,lt=ut;else break e}}function a(et){return et.length===0?null:et[0]}function c(et){if(et.length===0)return null;var Lt=et[0],lt=et.pop();if(lt!==Lt){et[0]=lt;e:for(var ut=0,Xe=et.length,kt=Xe>>>1;ut<kt;){var _n=2*(ut+1)-1,Xt=et[_n],It=_n+1,ln=et[It];if(0>p(Xt,lt))It<Xe&&0>p(ln,Xt)?(et[ut]=ln,et[It]=lt,ut=It):(et[ut]=Xt,et[_n]=lt,ut=_n);else if(It<Xe&&0>p(ln,lt))et[ut]=ln,et[It]=lt,ut=It;else break e}}return Lt}function p(et,Lt){var lt=et.sortIndex-Lt.sortIndex;return lt!==0?lt:et.id-Lt.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var y=performance;t.unstable_now=function(){return y.now()}}else{var M=Date,r=M.now();t.unstable_now=function(){return M.now()-r}}var I=[],k=[],B=1,U=null,H=3,Y=!1,X=!1,Q=!1,J=typeof setTimeout=="function"?setTimeout:null,j=typeof clearTimeout=="function"?clearTimeout:null,oe=typeof setImmediate<"u"?setImmediate:null;function ce(et){for(var Lt=a(k);Lt!==null;){if(Lt.callback===null)c(k);else if(Lt.startTime<=et)c(k),Lt.sortIndex=Lt.expirationTime,e(I,Lt);else break;Lt=a(k)}}function pe(et){if(Q=!1,ce(et),!X)if(a(I)!==null)X=!0,Tt();else{var Lt=a(k);Lt!==null&&_t(pe,Lt.startTime-et)}}var Ae=!1,Ee=-1,be=5,Ve=-1;function Se(){return!(t.unstable_now()-Ve<be)}function xe(){if(Ae){var et=t.unstable_now();Ve=et;var Lt=!0;try{e:{X=!1,Q&&(Q=!1,j(Ee),Ee=-1),Y=!0;var lt=H;try{t:{for(ce(et),U=a(I);U!==null&&!(U.expirationTime>et&&Se());){var ut=U.callback;if(typeof ut=="function"){U.callback=null,H=U.priorityLevel;var Xe=ut(U.expirationTime<=et);if(et=t.unstable_now(),typeof Xe=="function"){U.callback=Xe,ce(et),Lt=!0;break t}U===a(I)&&c(I),ce(et)}else c(I);U=a(I)}if(U!==null)Lt=!0;else{var kt=a(k);kt!==null&&_t(pe,kt.startTime-et),Lt=!1}}break e}finally{U=null,H=lt,Y=!1}Lt=void 0}}finally{Lt?Fe():Ae=!1}}}var Fe;if(typeof oe=="function")Fe=function(){oe(xe)};else if(typeof MessageChannel<"u"){var Ct=new MessageChannel,Et=Ct.port2;Ct.port1.onmessage=xe,Fe=function(){Et.postMessage(null)}}else Fe=function(){J(xe,0)};function Tt(){Ae||(Ae=!0,Fe())}function _t(et,Lt){Ee=J(function(){et(t.unstable_now())},Lt)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(et){et.callback=null},t.unstable_continueExecution=function(){X||Y||(X=!0,Tt())},t.unstable_forceFrameRate=function(et){0>et||125<et?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):be=0<et?Math.floor(1e3/et):5},t.unstable_getCurrentPriorityLevel=function(){return H},t.unstable_getFirstCallbackNode=function(){return a(I)},t.unstable_next=function(et){switch(H){case 1:case 2:case 3:var Lt=3;break;default:Lt=H}var lt=H;H=Lt;try{return et()}finally{H=lt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(et,Lt){switch(et){case 1:case 2:case 3:case 4:case 5:break;default:et=3}var lt=H;H=et;try{return Lt()}finally{H=lt}},t.unstable_scheduleCallback=function(et,Lt,lt){var ut=t.unstable_now();switch(typeof lt=="object"&&lt!==null?(lt=lt.delay,lt=typeof lt=="number"&&0<lt?ut+lt:ut):lt=ut,et){case 1:var Xe=-1;break;case 2:Xe=250;break;case 5:Xe=1073741823;break;case 4:Xe=1e4;break;default:Xe=5e3}return Xe=lt+Xe,et={id:B++,callback:Lt,priorityLevel:et,startTime:lt,expirationTime:Xe,sortIndex:-1},lt>ut?(et.sortIndex=lt,e(k,et),a(I)===null&&et===a(k)&&(Q?(j(Ee),Ee=-1):Q=!0,_t(pe,lt-ut))):(et.sortIndex=Xe,e(I,et),X||Y||(X=!0,Tt())),et},t.unstable_shouldYield=Se,t.unstable_wrapCallback=function(et){var Lt=H;return function(){var lt=H;H=Lt;try{return et.apply(this,arguments)}finally{H=lt}}}}(aT)),aT}var lP;function Q4(){return lP||(lP=1,rT.exports=J4()),rT.exports}var oT={exports:{}},Us={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cP;function eU(){if(cP)return Us;cP=1;var t=DC();function e(I){var k="https://react.dev/errors/"+I;if(1<arguments.length){k+="?args[]="+encodeURIComponent(arguments[1]);for(var B=2;B<arguments.length;B++)k+="&args[]="+encodeURIComponent(arguments[B])}return"Minified React error #"+I+"; visit "+k+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var c={d:{f:a,r:function(){throw Error(e(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},p=Symbol.for("react.portal");function y(I,k,B){var U=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:p,key:U==null?null:""+U,children:I,containerInfo:k,implementation:B}}var M=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function r(I,k){if(I==="font")return"";if(typeof k=="string")return k==="use-credentials"?k:""}return Us.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=c,Us.createPortal=function(I,k){var B=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!k||k.nodeType!==1&&k.nodeType!==9&&k.nodeType!==11)throw Error(e(299));return y(I,k,null,B)},Us.flushSync=function(I){var k=M.T,B=c.p;try{if(M.T=null,c.p=2,I)return I()}finally{M.T=k,c.p=B,c.d.f()}},Us.preconnect=function(I,k){typeof I=="string"&&(k?(k=k.crossOrigin,k=typeof k=="string"?k==="use-credentials"?k:"":void 0):k=null,c.d.C(I,k))},Us.prefetchDNS=function(I){typeof I=="string"&&c.d.D(I)},Us.preinit=function(I,k){if(typeof I=="string"&&k&&typeof k.as=="string"){var B=k.as,U=r(B,k.crossOrigin),H=typeof k.integrity=="string"?k.integrity:void 0,Y=typeof k.fetchPriority=="string"?k.fetchPriority:void 0;B==="style"?c.d.S(I,typeof k.precedence=="string"?k.precedence:void 0,{crossOrigin:U,integrity:H,fetchPriority:Y}):B==="script"&&c.d.X(I,{crossOrigin:U,integrity:H,fetchPriority:Y,nonce:typeof k.nonce=="string"?k.nonce:void 0})}},Us.preinitModule=function(I,k){if(typeof I=="string")if(typeof k=="object"&&k!==null){if(k.as==null||k.as==="script"){var B=r(k.as,k.crossOrigin);c.d.M(I,{crossOrigin:B,integrity:typeof k.integrity=="string"?k.integrity:void 0,nonce:typeof k.nonce=="string"?k.nonce:void 0})}}else k==null&&c.d.M(I)},Us.preload=function(I,k){if(typeof I=="string"&&typeof k=="object"&&k!==null&&typeof k.as=="string"){var B=k.as,U=r(B,k.crossOrigin);c.d.L(I,B,{crossOrigin:U,integrity:typeof k.integrity=="string"?k.integrity:void 0,nonce:typeof k.nonce=="string"?k.nonce:void 0,type:typeof k.type=="string"?k.type:void 0,fetchPriority:typeof k.fetchPriority=="string"?k.fetchPriority:void 0,referrerPolicy:typeof k.referrerPolicy=="string"?k.referrerPolicy:void 0,imageSrcSet:typeof k.imageSrcSet=="string"?k.imageSrcSet:void 0,imageSizes:typeof k.imageSizes=="string"?k.imageSizes:void 0,media:typeof k.media=="string"?k.media:void 0})}},Us.preloadModule=function(I,k){if(typeof I=="string")if(k){var B=r(k.as,k.crossOrigin);c.d.m(I,{as:typeof k.as=="string"&&k.as!=="script"?k.as:void 0,crossOrigin:B,integrity:typeof k.integrity=="string"?k.integrity:void 0})}else c.d.m(I)},Us.requestFormReset=function(I){c.d.r(I)},Us.unstable_batchedUpdates=function(I,k){return I(k)},Us.useFormState=function(I,k,B){return M.H.useFormState(I,k,B)},Us.useFormStatus=function(){return M.H.useHostTransitionStatus()},Us.version="19.0.0",Us}var uP;function ZL(){if(uP)return oT.exports;uP=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),oT.exports=eU(),oT.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hP;function tU(){if(hP)return Wx;hP=1;var t=Q4(),e=DC(),a=ZL();function c(h){var _="https://react.dev/errors/"+h;if(1<arguments.length){_+="?args[]="+encodeURIComponent(arguments[1]);for(var S=2;S<arguments.length;S++)_+="&args[]="+encodeURIComponent(arguments[S])}return"Minified React error #"+h+"; visit "+_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function p(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}var y=Symbol.for("react.element"),M=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),I=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),B=Symbol.for("react.profiler"),U=Symbol.for("react.provider"),H=Symbol.for("react.consumer"),Y=Symbol.for("react.context"),X=Symbol.for("react.forward_ref"),Q=Symbol.for("react.suspense"),J=Symbol.for("react.suspense_list"),j=Symbol.for("react.memo"),oe=Symbol.for("react.lazy"),ce=Symbol.for("react.offscreen"),pe=Symbol.for("react.memo_cache_sentinel"),Ae=Symbol.iterator;function Ee(h){return h===null||typeof h!="object"?null:(h=Ae&&h[Ae]||h["@@iterator"],typeof h=="function"?h:null)}var be=Symbol.for("react.client.reference");function Ve(h){if(h==null)return null;if(typeof h=="function")return h.$$typeof===be?null:h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case I:return"Fragment";case r:return"Portal";case B:return"Profiler";case k:return"StrictMode";case Q:return"Suspense";case J:return"SuspenseList"}if(typeof h=="object")switch(h.$$typeof){case Y:return(h.displayName||"Context")+".Provider";case H:return(h._context.displayName||"Context")+".Consumer";case X:var _=h.render;return h=h.displayName,h||(h=_.displayName||_.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case j:return _=h.displayName||null,_!==null?_:Ve(h.type)||"Memo";case oe:_=h._payload,h=h._init;try{return Ve(h(_))}catch{}}return null}var Se=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,xe=Object.assign,Fe,Ct;function Et(h){if(Fe===void 0)try{throw Error()}catch(S){var _=S.stack.trim().match(/\n( *(at )?)/);Fe=_&&_[1]||"",Ct=-1<S.stack.indexOf(`
    at`)?" (<anonymous>)":-1<S.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Fe+h+Ct}var Tt=!1;function _t(h,_){if(!h||Tt)return"";Tt=!0;var S=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var O={DetermineComponentFrameRoot:function(){try{if(_){var Fn=function(){throw Error()};if(Object.defineProperty(Fn.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Fn,[])}catch(bn){var sn=bn}Reflect.construct(h,[],Fn)}else{try{Fn.call()}catch(bn){sn=bn}h.call(Fn.prototype)}}else{try{throw Error()}catch(bn){sn=bn}(Fn=h())&&typeof Fn.catch=="function"&&Fn.catch(function(){})}}catch(bn){if(bn&&sn&&typeof bn.stack=="string")return[bn.stack,sn.stack]}return[null,null]}};O.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var G=Object.getOwnPropertyDescriptor(O.DetermineComponentFrameRoot,"name");G&&G.configurable&&Object.defineProperty(O.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var te=O.DetermineComponentFrameRoot(),Me=te[0],He=te[1];if(Me&&He){var mt=Me.split(`
`),Vt=He.split(`
`);for(G=O=0;O<mt.length&&!mt[O].includes("DetermineComponentFrameRoot");)O++;for(;G<Vt.length&&!Vt[G].includes("DetermineComponentFrameRoot");)G++;if(O===mt.length||G===Vt.length)for(O=mt.length-1,G=Vt.length-1;1<=O&&0<=G&&mt[O]!==Vt[G];)G--;for(;1<=O&&0<=G;O--,G--)if(mt[O]!==Vt[G]){if(O!==1||G!==1)do if(O--,G--,0>G||mt[O]!==Vt[G]){var Sn=`
`+mt[O].replace(" at new "," at ");return h.displayName&&Sn.includes("<anonymous>")&&(Sn=Sn.replace("<anonymous>",h.displayName)),Sn}while(1<=O&&0<=G);break}}}finally{Tt=!1,Error.prepareStackTrace=S}return(S=h?h.displayName||h.name:"")?Et(S):""}function et(h){switch(h.tag){case 26:case 27:case 5:return Et(h.type);case 16:return Et("Lazy");case 13:return Et("Suspense");case 19:return Et("SuspenseList");case 0:case 15:return h=_t(h.type,!1),h;case 11:return h=_t(h.type.render,!1),h;case 1:return h=_t(h.type,!0),h;default:return""}}function Lt(h){try{var _="";do _+=et(h),h=h.return;while(h);return _}catch(S){return`
Error generating stack: `+S.message+`
`+S.stack}}function lt(h){var _=h,S=h;if(h.alternate)for(;_.return;)_=_.return;else{h=_;do _=h,(_.flags&4098)!==0&&(S=_.return),h=_.return;while(h)}return _.tag===3?S:null}function ut(h){if(h.tag===13){var _=h.memoizedState;if(_===null&&(h=h.alternate,h!==null&&(_=h.memoizedState)),_!==null)return _.dehydrated}return null}function Xe(h){if(lt(h)!==h)throw Error(c(188))}function kt(h){var _=h.alternate;if(!_){if(_=lt(h),_===null)throw Error(c(188));return _!==h?null:h}for(var S=h,O=_;;){var G=S.return;if(G===null)break;var te=G.alternate;if(te===null){if(O=G.return,O!==null){S=O;continue}break}if(G.child===te.child){for(te=G.child;te;){if(te===S)return Xe(G),h;if(te===O)return Xe(G),_;te=te.sibling}throw Error(c(188))}if(S.return!==O.return)S=G,O=te;else{for(var Me=!1,He=G.child;He;){if(He===S){Me=!0,S=G,O=te;break}if(He===O){Me=!0,O=G,S=te;break}He=He.sibling}if(!Me){for(He=te.child;He;){if(He===S){Me=!0,S=te,O=G;break}if(He===O){Me=!0,O=te,S=G;break}He=He.sibling}if(!Me)throw Error(c(189))}}if(S.alternate!==O)throw Error(c(190))}if(S.tag!==3)throw Error(c(188));return S.stateNode.current===S?h:_}function _n(h){var _=h.tag;if(_===5||_===26||_===27||_===6)return h;for(h=h.child;h!==null;){if(_=_n(h),_!==null)return _;h=h.sibling}return null}var Xt=Array.isArray,It=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ln={pending:!1,data:null,method:null,action:null},fn=[],$t=-1;function pn(h){return{current:h}}function jn(h){0>$t||(h.current=fn[$t],fn[$t]=null,$t--)}function Pe(h,_){$t++,fn[$t]=h.current,h.current=_}var Gn=pn(null),vn=pn(null),qn=pn(null),ke=pn(null);function Fi(h,_){switch(Pe(qn,_),Pe(vn,h),Pe(Gn,null),h=_.nodeType,h){case 9:case 11:_=(_=_.documentElement)&&(_=_.namespaceURI)?tx(_):0;break;default:if(h=h===8?_.parentNode:_,_=h.tagName,h=h.namespaceURI)h=tx(h),_=av(h,_);else switch(_){case"svg":_=1;break;case"math":_=2;break;default:_=0}}jn(Gn),Pe(Gn,_)}function di(){jn(Gn),jn(vn),jn(qn)}function bi(h){h.memoizedState!==null&&Pe(ke,h);var _=Gn.current,S=av(_,h.type);_!==S&&(Pe(vn,h),Pe(Gn,S))}function Mn(h){vn.current===h&&(jn(Gn),jn(vn)),ke.current===h&&(jn(ke),Cf._currentValue=ln)}var wi=Object.prototype.hasOwnProperty,ei=t.unstable_scheduleCallback,ot=t.unstable_cancelCallback,Ue=t.unstable_shouldYield,Yt=t.unstable_requestPaint,gt=t.unstable_now,Kt=t.unstable_getCurrentPriorityLevel,an=t.unstable_ImmediatePriority,Xn=t.unstable_UserBlockingPriority,On=t.unstable_NormalPriority,Jn=t.unstable_LowPriority,Ni=t.unstable_IdlePriority,Un=t.log,si=t.unstable_setDisableYieldValue,ci=null,_i=null;function ui(h){if(_i&&typeof _i.onCommitFiberRoot=="function")try{_i.onCommitFiberRoot(ci,h,void 0,(h.current.flags&128)===128)}catch{}}function Ai(h){if(typeof Un=="function"&&si(h),_i&&typeof _i.setStrictMode=="function")try{_i.setStrictMode(ci,h)}catch{}}var Si=Math.clz32?Math.clz32:ai,Wn=Math.log,Ot=Math.LN2;function ai(h){return h>>>=0,h===0?32:31-(Wn(h)/Ot|0)|0}var on=128,wn=4194304;function Kn(h){var _=h&42;if(_!==0)return _;switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return h&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return h}}function ti(h,_){var S=h.pendingLanes;if(S===0)return 0;var O=0,G=h.suspendedLanes,te=h.pingedLanes,Me=h.warmLanes;h=h.finishedLanes!==0;var He=S&134217727;return He!==0?(S=He&~G,S!==0?O=Kn(S):(te&=He,te!==0?O=Kn(te):h||(Me=He&~Me,Me!==0&&(O=Kn(Me))))):(He=S&~G,He!==0?O=Kn(He):te!==0?O=Kn(te):h||(Me=S&~Me,Me!==0&&(O=Kn(Me)))),O===0?0:_!==0&&_!==O&&(_&G)===0&&(G=O&-O,Me=_&-_,G>=Me||G===32&&(Me&4194176)!==0)?_:O}function Vi(h,_){return(h.pendingLanes&~(h.suspendedLanes&~h.pingedLanes)&_)===0}function Zr(h,_){switch(h){case 1:case 2:case 4:case 8:return _+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ga(){var h=on;return on<<=1,(on&4194176)===0&&(on=128),h}function Cr(){var h=wn;return wn<<=1,(wn&62914560)===0&&(wn=4194304),h}function oo(h){for(var _=[],S=0;31>S;S++)_.push(h);return _}function Sr(h,_){h.pendingLanes|=_,_!==268435456&&(h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0)}function yc(h,_,S,O,G,te){var Me=h.pendingLanes;h.pendingLanes=S,h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0,h.expiredLanes&=S,h.entangledLanes&=S,h.errorRecoveryDisabledLanes&=S,h.shellSuspendCounter=0;var He=h.entanglements,mt=h.expirationTimes,Vt=h.hiddenUpdates;for(S=Me&~S;0<S;){var Sn=31-Si(S),Fn=1<<Sn;He[Sn]=0,mt[Sn]=-1;var sn=Vt[Sn];if(sn!==null)for(Vt[Sn]=null,Sn=0;Sn<sn.length;Sn++){var bn=sn[Sn];bn!==null&&(bn.lane&=-536870913)}S&=~Fn}O!==0&&xc(h,O,0),te!==0&&G===0&&h.tag!==0&&(h.suspendedLanes|=te&~(Me&~_))}function xc(h,_,S){h.pendingLanes|=_,h.suspendedLanes&=~_;var O=31-Si(_);h.entangledLanes|=_,h.entanglements[O]=h.entanglements[O]|1073741824|S&4194218}function $o(h,_){var S=h.entangledLanes|=_;for(h=h.entanglements;S;){var O=31-Si(S),G=1<<O;G&_|h[O]&_&&(h[O]|=_),S&=~G}}function Sa(h){return h&=-h,2<h?8<h?(h&134217727)!==0?32:268435456:8:2}function Xo(){var h=It.p;return h!==0?h:(h=window.event,h===void 0?32:Ub(h.type))}function At(h,_){var S=It.p;try{return It.p=h,_()}finally{It.p=S}}var he=Math.random().toString(36).slice(2),_e="__reactFiber$"+he,Te="__reactProps$"+he,je="__reactContainer$"+he,We="__reactEvents$"+he,Qe="__reactListeners$"+he,ft="__reactHandles$"+he,nt="__reactResources$"+he,St="__reactMarker$"+he;function wt(h){delete h[_e],delete h[Te],delete h[We],delete h[Qe],delete h[ft]}function Mt(h){var _=h[_e];if(_)return _;for(var S=h.parentNode;S;){if(_=S[je]||S[_e]){if(S=_.alternate,_.child!==null||S!==null&&S.child!==null)for(h=Ib(h);h!==null;){if(S=h[_e])return S;h=Ib(h)}return _}h=S,S=h.parentNode}return null}function we(h){if(h=h[_e]||h[je]){var _=h.tag;if(_===5||_===6||_===13||_===26||_===27||_===3)return h}return null}function Ze(h){var _=h.tag;if(_===5||_===26||_===27||_===6)return h.stateNode;throw Error(c(33))}function at(h){var _=h[nt];return _||(_=h[nt]={hoistableStyles:new Map,hoistableScripts:new Map}),_}function vt(h){h[St]=!0}var ht=new Set,qt={};function Jt(h,_){En(h,_),En(h+"Capture",_)}function En(h,_){for(qt[h]=_,h=0;h<_.length;h++)ht.add(_[h])}var Tn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Bn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),$n={},Vn={};function Pi(h){return wi.call(Vn,h)?!0:wi.call($n,h)?!1:Bn.test(h)?Vn[h]=!0:($n[h]=!0,!1)}function or(h,_,S){if(Pi(_))if(S===null)h.removeAttribute(_);else{switch(typeof S){case"undefined":case"function":case"symbol":h.removeAttribute(_);return;case"boolean":var O=_.toLowerCase().slice(0,5);if(O!=="data-"&&O!=="aria-"){h.removeAttribute(_);return}}h.setAttribute(_,""+S)}}function er(h,_,S){if(S===null)h.removeAttribute(_);else{switch(typeof S){case"undefined":case"function":case"symbol":case"boolean":h.removeAttribute(_);return}h.setAttribute(_,""+S)}}function qi(h,_,S,O){if(O===null)h.removeAttribute(S);else{switch(typeof O){case"undefined":case"function":case"symbol":case"boolean":h.removeAttribute(S);return}h.setAttributeNS(_,S,""+O)}}function Ci(h){switch(typeof h){case"bigint":case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function Li(h){var _=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(_==="checkbox"||_==="radio")}function ia(h){var _=Li(h)?"checked":"value",S=Object.getOwnPropertyDescriptor(h.constructor.prototype,_),O=""+h[_];if(!h.hasOwnProperty(_)&&typeof S<"u"&&typeof S.get=="function"&&typeof S.set=="function"){var G=S.get,te=S.set;return Object.defineProperty(h,_,{configurable:!0,get:function(){return G.call(this)},set:function(Me){O=""+Me,te.call(this,Me)}}),Object.defineProperty(h,_,{enumerable:S.enumerable}),{getValue:function(){return O},setValue:function(Me){O=""+Me},stopTracking:function(){h._valueTracker=null,delete h[_]}}}}function gr(h){h._valueTracker||(h._valueTracker=ia(h))}function To(h){if(!h)return!1;var _=h._valueTracker;if(!_)return!0;var S=_.getValue(),O="";return h&&(O=Li(h)?h.checked?"true":"false":h.value),h=O,h!==S?(_.setValue(h),!0):!1}function ws(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}var vo=/[\n"\\]/g;function Ua(h){return h.replace(vo,function(_){return"\\"+_.charCodeAt(0).toString(16)+" "})}function cr(h,_,S,O,G,te,Me,He){h.name="",Me!=null&&typeof Me!="function"&&typeof Me!="symbol"&&typeof Me!="boolean"?h.type=Me:h.removeAttribute("type"),_!=null?Me==="number"?(_===0&&h.value===""||h.value!=_)&&(h.value=""+Ci(_)):h.value!==""+Ci(_)&&(h.value=""+Ci(_)):Me!=="submit"&&Me!=="reset"||h.removeAttribute("value"),_!=null?_a(h,Me,Ci(_)):S!=null?_a(h,Me,Ci(S)):O!=null&&h.removeAttribute("value"),G==null&&te!=null&&(h.defaultChecked=!!te),G!=null&&(h.checked=G&&typeof G!="function"&&typeof G!="symbol"),He!=null&&typeof He!="function"&&typeof He!="symbol"&&typeof He!="boolean"?h.name=""+Ci(He):h.removeAttribute("name")}function ua(h,_,S,O,G,te,Me,He){if(te!=null&&typeof te!="function"&&typeof te!="symbol"&&typeof te!="boolean"&&(h.type=te),_!=null||S!=null){if(!(te!=="submit"&&te!=="reset"||_!=null))return;S=S!=null?""+Ci(S):"",_=_!=null?""+Ci(_):S,He||_===h.value||(h.value=_),h.defaultValue=_}O=O??G,O=typeof O!="function"&&typeof O!="symbol"&&!!O,h.checked=He?h.checked:!!O,h.defaultChecked=!!O,Me!=null&&typeof Me!="function"&&typeof Me!="symbol"&&typeof Me!="boolean"&&(h.name=Me)}function _a(h,_,S){_==="number"&&ws(h.ownerDocument)===h||h.defaultValue===""+S||(h.defaultValue=""+S)}function Vr(h,_,S,O){if(h=h.options,_){_={};for(var G=0;G<S.length;G++)_["$"+S[G]]=!0;for(S=0;S<h.length;S++)G=_.hasOwnProperty("$"+h[S].value),h[S].selected!==G&&(h[S].selected=G),G&&O&&(h[S].defaultSelected=!0)}else{for(S=""+Ci(S),_=null,G=0;G<h.length;G++){if(h[G].value===S){h[G].selected=!0,O&&(h[G].defaultSelected=!0);return}_!==null||h[G].disabled||(_=h[G])}_!==null&&(_.selected=!0)}}function ra(h,_,S){if(_!=null&&(_=""+Ci(_),_!==h.value&&(h.value=_),S==null)){h.defaultValue!==_&&(h.defaultValue=_);return}h.defaultValue=S!=null?""+Ci(S):""}function Oo(h,_,S,O){if(_==null){if(O!=null){if(S!=null)throw Error(c(92));if(Xt(O)){if(1<O.length)throw Error(c(93));O=O[0]}S=O}S==null&&(S=""),_=S}S=Ci(_),h.defaultValue=S,O=h.textContent,O===S&&O!==""&&O!==null&&(h.value=O)}function yo(h,_){if(_){var S=h.firstChild;if(S&&S===h.lastChild&&S.nodeType===3){S.nodeValue=_;return}}h.textContent=_}var Fm=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function kl(h,_,S){var O=_.indexOf("--")===0;S==null||typeof S=="boolean"||S===""?O?h.setProperty(_,""):_==="float"?h.cssFloat="":h[_]="":O?h.setProperty(_,S):typeof S!="number"||S===0||Fm.has(_)?_==="float"?h.cssFloat=S:h[_]=(""+S).trim():h[_]=S+"px"}function Fl(h,_,S){if(_!=null&&typeof _!="object")throw Error(c(62));if(h=h.style,S!=null){for(var O in S)!S.hasOwnProperty(O)||_!=null&&_.hasOwnProperty(O)||(O.indexOf("--")===0?h.setProperty(O,""):O==="float"?h.cssFloat="":h[O]="");for(var G in _)O=_[G],_.hasOwnProperty(G)&&S[G]!==O&&kl(h,G,O)}else for(var te in _)_.hasOwnProperty(te)&&kl(h,te,_[te])}function rp(h){if(h.indexOf("-")===-1)return!1;switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Nm=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ss=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function tr(h){return Ss.test(""+h)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":h}var Dd=null;function oi(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var _u=null,Nl=null;function Pd(h){var _=we(h);if(_&&(h=_.stateNode)){var S=h[Te]||null;e:switch(h=_.stateNode,_.type){case"input":if(cr(h,S.value,S.defaultValue,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name),_=S.name,S.type==="radio"&&_!=null){for(S=h;S.parentNode;)S=S.parentNode;for(S=S.querySelectorAll('input[name="'+Ua(""+_)+'"][type="radio"]'),_=0;_<S.length;_++){var O=S[_];if(O!==h&&O.form===h.form){var G=O[Te]||null;if(!G)throw Error(c(90));cr(O,G.value,G.defaultValue,G.defaultValue,G.checked,G.defaultChecked,G.type,G.name)}}for(_=0;_<S.length;_++)O=S[_],O.form===h.form&&To(O)}break e;case"textarea":ra(h,S.value,S.defaultValue);break e;case"select":_=S.value,_!=null&&Vr(h,!!S.multiple,_,!1)}}}var Bi=!1;function Ld(h,_,S){if(Bi)return h(_,S);Bi=!0;try{var O=h(_);return O}finally{if(Bi=!1,(_u!==null||Nl!==null)&&(pg(),_u&&(_=_u,h=Nl,Nl=_u=null,Pd(_),h)))for(_=0;_<h.length;_++)Pd(h[_])}}function qs(h,_){var S=h.stateNode;if(S===null)return null;var O=S[Te]||null;if(O===null)return null;S=O[_];e:switch(_){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(O=!O.disabled)||(h=h.type,O=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!O;break e;default:h=!1}if(h)return null;if(S&&typeof S!="function")throw Error(c(231,_,typeof S));return S}var Nn=!1;if(Tn)try{var ir={};Object.defineProperty(ir,"passive",{get:function(){Nn=!0}}),window.addEventListener("test",ir,ir),window.removeEventListener("test",ir,ir)}catch{Nn=!1}var Gi=null,Wa=null,Es=null;function nr(){if(Es)return Es;var h,_=Wa,S=_.length,O,G="value"in Gi?Gi.value:Gi.textContent,te=G.length;for(h=0;h<S&&_[h]===G[h];h++);var Me=S-h;for(O=1;O<=Me&&_[S-O]===G[te-O];O++);return Es=G.slice(h,1<O?1-O:void 0)}function bc(h){var _=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&_===13&&(h=13)):h=_,h===10&&(h=13),32<=h||h===13?h:0}function ls(){return!0}function _h(){return!1}function Fr(h){function _(S,O,G,te,Me){this._reactName=S,this._targetInst=G,this.type=O,this.nativeEvent=te,this.target=Me,this.currentTarget=null;for(var He in h)h.hasOwnProperty(He)&&(S=h[He],this[He]=S?S(te):te[He]);return this.isDefaultPrevented=(te.defaultPrevented!=null?te.defaultPrevented:te.returnValue===!1)?ls:_h,this.isPropagationStopped=_h,this}return xe(_.prototype,{preventDefault:function(){this.defaultPrevented=!0;var S=this.nativeEvent;S&&(S.preventDefault?S.preventDefault():typeof S.returnValue!="unknown"&&(S.returnValue=!1),this.isDefaultPrevented=ls)},stopPropagation:function(){var S=this.nativeEvent;S&&(S.stopPropagation?S.stopPropagation():typeof S.cancelBubble!="unknown"&&(S.cancelBubble=!0),this.isPropagationStopped=ls)},persist:function(){},isPersistent:ls}),_}var Nr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},vh=Fr(Nr),$a=xe({},Nr,{view:0,detail:0}),ap=Fr($a),vu,yh,Bl,Va=xe({},$a,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Vm,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==Bl&&(Bl&&h.type==="mousemove"?(vu=h.screenX-Bl.screenX,yh=h.screenY-Bl.screenY):yh=vu=0,Bl=h),vu)},movementY:function(h){return"movementY"in h?h.movementY:yh}}),Ws=Fr(Va),so=xe({},Va,{dataTransfer:0}),Bm=Fr(so),Ul=xe({},$a,{relatedTarget:0}),Yr=Fr(Ul),Ms=xe({},Nr,{animationName:0,elapsedTime:0,pseudoElement:0}),Xa=Fr(Ms),va=xe({},Nr,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),Od=Fr(va),$s=xe({},Nr,{data:0}),wc=Fr($s),zd={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Xs={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Um={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Vl(h){var _=this.nativeEvent;return _.getModifierState?_.getModifierState(h):(h=Um[h])?!!_[h]:!1}function Vm(){return Vl}var jm=xe({},$a,{key:function(h){if(h.key){var _=zd[h.key]||h.key;if(_!=="Unidentified")return _}return h.type==="keypress"?(h=bc(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?Xs[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Vm,charCode:function(h){return h.type==="keypress"?bc(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?bc(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),zo=Fr(jm),Gm=xe({},Va,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),kd=Fr(Gm),Fd=xe({},$a,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Vm}),Nd=Fr(Fd),jy=xe({},Nr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Gy=Fr(jy),Bd=xe({},Va,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),Ud=Fr(Bd),Hy=xe({},Nr,{newState:0,oldState:0}),xh=Fr(Hy),Hm=[9,13,27,32],Zs=Tn&&"CompositionEvent"in window,Ts=null;Tn&&"documentMode"in document&&(Ts=document.documentMode);var qy=Tn&&"TextEvent"in window&&!Ts,op=Tn&&(!Zs||Ts&&8<Ts&&11>=Ts),M_=" ",qm=!1;function T_(h,_){switch(h){case"keyup":return Hm.indexOf(_.keyCode)!==-1;case"keydown":return _.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sp(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var As=!1;function Ui(h,_){switch(h){case"compositionend":return sp(_);case"keypress":return _.which!==32?null:(qm=!0,M_);case"textInput":return h=_.data,h===M_&&qm?null:h;default:return null}}function Qn(h,_){if(As)return h==="compositionend"||!Zs&&T_(h,_)?(h=nr(),Es=Wa=Gi=null,As=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(_.ctrlKey||_.altKey||_.metaKey)||_.ctrlKey&&_.altKey){if(_.char&&1<_.char.length)return _.char;if(_.which)return String.fromCharCode(_.which)}return null;case"compositionend":return op&&_.locale!=="ko"?null:_.data;default:return null}}var lp={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pi(h){var _=h&&h.nodeName&&h.nodeName.toLowerCase();return _==="input"?!!lp[h.type]:_==="textarea"}function yu(h,_,S,O){_u?Nl?Nl.push(O):Nl=[O]:_u=O,_=yg(_,"onChange"),0<_.length&&(S=new vh("onChange","change",null,S,O),h.push({event:S,listeners:_}))}var Sc=null,fi=null;function bh(h){Eb(h,0)}function dl(h){var _=Ze(h);if(To(_))return h}function cp(h,_){if(h==="change")return _}var Vd=!1;if(Tn){var xo;if(Tn){var ja="oninput"in document;if(!ja){var yn=document.createElement("div");yn.setAttribute("oninput","return;"),ja=typeof yn.oninput=="function"}xo=ja}else xo=!1;Vd=xo&&(!document.documentMode||9<document.documentMode)}function up(){Sc&&(Sc.detachEvent("onpropertychange",jd),fi=Sc=null)}function jd(h){if(h.propertyName==="value"&&dl(fi)){var _=[];yu(_,fi,h,oi(h)),Ld(bh,_)}}function Gd(h,_,S){h==="focusin"?(up(),Sc=_,fi=S,Sc.attachEvent("onpropertychange",jd)):h==="focusout"&&up()}function Ec(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return dl(fi)}function Za(h,_){if(h==="click")return dl(_)}function jl(h,_){if(h==="input"||h==="change")return dl(_)}function Wm(h,_){return h===_&&(h!==0||1/h===1/_)||h!==h&&_!==_}var Ya=typeof Object.is=="function"?Object.is:Wm;function Ys(h,_){if(Ya(h,_))return!0;if(typeof h!="object"||h===null||typeof _!="object"||_===null)return!1;var S=Object.keys(h),O=Object.keys(_);if(S.length!==O.length)return!1;for(O=0;O<S.length;O++){var G=S[O];if(!wi.call(_,G)||!Ya(h[G],_[G]))return!1}return!0}function Mc(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function hp(h,_){var S=Mc(h);h=0;for(var O;S;){if(S.nodeType===3){if(O=h+S.textContent.length,h<=_&&O>=_)return{node:S,offset:_-h};h=O}e:{for(;S;){if(S.nextSibling){S=S.nextSibling;break e}S=S.parentNode}S=void 0}S=Mc(S)}}function A_(h,_){return h&&_?h===_?!0:h&&h.nodeType===3?!1:_&&_.nodeType===3?A_(h,_.parentNode):"contains"in h?h.contains(_):h.compareDocumentPosition?!!(h.compareDocumentPosition(_)&16):!1:!1}function dp(h){h=h!=null&&h.ownerDocument!=null&&h.ownerDocument.defaultView!=null?h.ownerDocument.defaultView:window;for(var _=ws(h.document);_ instanceof h.HTMLIFrameElement;){try{var S=typeof _.contentWindow.location.href=="string"}catch{S=!1}if(S)h=_.contentWindow;else break;_=ws(h.document)}return _}function $m(h){var _=h&&h.nodeName&&h.nodeName.toLowerCase();return _&&(_==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||_==="textarea"||h.contentEditable==="true")}function C_(h,_){var S=dp(_);_=h.focusedElem;var O=h.selectionRange;if(S!==_&&_&&_.ownerDocument&&A_(_.ownerDocument.documentElement,_)){if(O!==null&&$m(_)){if(h=O.start,S=O.end,S===void 0&&(S=h),"selectionStart"in _)_.selectionStart=h,_.selectionEnd=Math.min(S,_.value.length);else if(S=(h=_.ownerDocument||document)&&h.defaultView||window,S.getSelection){S=S.getSelection();var G=_.textContent.length,te=Math.min(O.start,G);O=O.end===void 0?te:Math.min(O.end,G),!S.extend&&te>O&&(G=O,O=te,te=G),G=hp(_,te);var Me=hp(_,O);G&&Me&&(S.rangeCount!==1||S.anchorNode!==G.node||S.anchorOffset!==G.offset||S.focusNode!==Me.node||S.focusOffset!==Me.offset)&&(h=h.createRange(),h.setStart(G.node,G.offset),S.removeAllRanges(),te>O?(S.addRange(h),S.extend(Me.node,Me.offset)):(h.setEnd(Me.node,Me.offset),S.addRange(h)))}}for(h=[],S=_;S=S.parentNode;)S.nodeType===1&&h.push({element:S,left:S.scrollLeft,top:S.scrollTop});for(typeof _.focus=="function"&&_.focus(),_=0;_<h.length;_++)S=h[_],S.element.scrollLeft=S.left,S.element.scrollTop=S.top}}var Xm=Tn&&"documentMode"in document&&11>=document.documentMode,Tc=null,Zm=null,wh=null,Gl=!1;function R_(h,_,S){var O=S.window===S?S.document:S.nodeType===9?S:S.ownerDocument;Gl||Tc==null||Tc!==ws(O)||(O=Tc,"selectionStart"in O&&$m(O)?O={start:O.selectionStart,end:O.selectionEnd}:(O=(O.ownerDocument&&O.ownerDocument.defaultView||window).getSelection(),O={anchorNode:O.anchorNode,anchorOffset:O.anchorOffset,focusNode:O.focusNode,focusOffset:O.focusOffset}),wh&&Ys(wh,O)||(wh=O,O=yg(Zm,"onSelect"),0<O.length&&(_=new vh("onSelect","select",null,_,S),h.push({event:_,listeners:O}),_.target=Tc)))}function Ac(h,_){var S={};return S[h.toLowerCase()]=_.toLowerCase(),S["Webkit"+h]="webkit"+_,S["Moz"+h]="moz"+_,S}var Cc={animationend:Ac("Animation","AnimationEnd"),animationiteration:Ac("Animation","AnimationIteration"),animationstart:Ac("Animation","AnimationStart"),transitionrun:Ac("Transition","TransitionRun"),transitionstart:Ac("Transition","TransitionStart"),transitioncancel:Ac("Transition","TransitionCancel"),transitionend:Ac("Transition","TransitionEnd")},xu={},Ym={};Tn&&(Ym=document.createElement("div").style,"AnimationEvent"in window||(delete Cc.animationend.animation,delete Cc.animationiteration.animation,delete Cc.animationstart.animation),"TransitionEvent"in window||delete Cc.transitionend.transition);function lo(h){if(xu[h])return xu[h];if(!Cc[h])return h;var _=Cc[h],S;for(S in _)if(_.hasOwnProperty(S)&&S in Ym)return xu[h]=_[S];return h}var Hd=lo("animationend"),Sh=lo("animationiteration"),qd=lo("animationstart"),Rc=lo("transitionrun"),fp=lo("transitionstart"),Km=lo("transitioncancel"),Ic=lo("transitionend"),bu=new Map,Eh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function ko(h,_){bu.set(h,_),Jt(_,[h])}var co=[],Cs=0,Dc=0;function Pc(){for(var h=Cs,_=Dc=Cs=0;_<h;){var S=co[_];co[_++]=null;var O=co[_];co[_++]=null;var G=co[_];co[_++]=null;var te=co[_];if(co[_++]=null,O!==null&&G!==null){var Me=O.pending;Me===null?G.next=G:(G.next=Me.next,Me.next=G),O.pending=G}te!==0&&Lc(S,G,te)}}function wu(h,_,S,O){co[Cs++]=h,co[Cs++]=_,co[Cs++]=S,co[Cs++]=O,Dc|=O,h.lanes|=O,h=h.alternate,h!==null&&(h.lanes|=O)}function Su(h,_,S,O){return wu(h,_,S,O),Wi(h)}function cs(h,_){return wu(h,null,null,_),Wi(h)}function Lc(h,_,S){h.lanes|=S;var O=h.alternate;O!==null&&(O.lanes|=S);for(var G=!1,te=h.return;te!==null;)te.childLanes|=S,O=te.alternate,O!==null&&(O.childLanes|=S),te.tag===22&&(h=te.stateNode,h===null||h._visibility&1||(G=!0)),h=te,te=te.return;G&&_!==null&&h.tag===3&&(te=h.stateNode,G=31-Si(S),te=te.hiddenUpdates,h=te[G],h===null?te[G]=[_]:h.push(_),_.lane=S|536870912)}function Wi(h){if(50<tu)throw tu=0,_f=null,Error(c(185));for(var _=h.return;_!==null;)h=_,_=h.return;return h.tag===3?h.stateNode:null}var Eu={},Mu=new WeakMap;function us(h,_){if(typeof h=="object"&&h!==null){var S=Mu.get(h);return S!==void 0?S:(_={value:h,source:_,stack:Lt(_)},Mu.set(h,_),_)}return{value:h,source:_,stack:Lt(_)}}var Tu=[],Mh=0,Rr=null,Th=0,Zo=[],Yo=0,Hl=null,fl=1,pl="";function Au(h,_){Tu[Mh++]=Th,Tu[Mh++]=Rr,Rr=h,Th=_}function Ah(h,_,S){Zo[Yo++]=fl,Zo[Yo++]=pl,Zo[Yo++]=Hl,Hl=h;var O=fl;h=pl;var G=32-Si(O)-1;O&=~(1<<G),S+=1;var te=32-Si(_)+G;if(30<te){var Me=G-G%5;te=(O&(1<<Me)-1).toString(32),O>>=Me,G-=Me,fl=1<<32-Si(_)+G|S<<G|O,pl=te+h}else fl=1<<te|S<<G|O,pl=h}function Cu(h){h.return!==null&&(Au(h,1),Ah(h,1,0))}function pp(h){for(;h===Rr;)Rr=Tu[--Mh],Tu[Mh]=null,Th=Tu[--Mh],Tu[Mh]=null;for(;h===Hl;)Hl=Zo[--Yo],Zo[Yo]=null,pl=Zo[--Yo],Zo[Yo]=null,fl=Zo[--Yo],Zo[Yo]=null}var Kr=null,Ka=null,Ir=!1,Ko=null,Rs=!1,Wd=Error(c(519));function ml(h){var _=Error(c(418,""));throw Rh(us(_,h)),Wd}function mp(h){var _=h.stateNode,S=h.type,O=h.memoizedProps;switch(_[_e]=h,_[Te]=O,S){case"dialog":Or("cancel",_),Or("close",_);break;case"iframe":case"object":case"embed":Or("load",_);break;case"video":case"audio":for(S=0;S<vg.length;S++)Or(vg[S],_);break;case"source":Or("error",_);break;case"img":case"image":case"link":Or("error",_),Or("load",_);break;case"details":Or("toggle",_);break;case"input":Or("invalid",_),ua(_,O.value,O.defaultValue,O.checked,O.defaultChecked,O.type,O.name,!0),gr(_);break;case"select":Or("invalid",_);break;case"textarea":Or("invalid",_),Oo(_,O.value,O.defaultValue,O.children),gr(_)}S=O.children,typeof S!="string"&&typeof S!="number"&&typeof S!="bigint"||_.textContent===""+S||O.suppressHydrationWarning===!0||Sf(_.textContent,S)?(O.popover!=null&&(Or("beforetoggle",_),Or("toggle",_)),O.onScroll!=null&&Or("scroll",_),O.onScrollEnd!=null&&Or("scrollend",_),O.onClick!=null&&(_.onclick=ru),_=!0):_=!1,_||ml(h)}function gp(h){for(Kr=h.return;Kr;)switch(Kr.tag){case 3:case 27:Rs=!0;return;case 5:case 13:Rs=!1;return;default:Kr=Kr.return}}function Oc(h){if(h!==Kr)return!1;if(!Ir)return gp(h),Ir=!0,!1;var _=!1,S;if((S=h.tag!==3&&h.tag!==27)&&((S=h.tag===5)&&(S=h.type,S=!(S!=="form"&&S!=="button")||bg(h.type,h.memoizedProps)),S=!S),S&&(_=!0),_&&Ka&&ml(h),gp(h),h.tag===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(c(317));e:{for(h=h.nextSibling,_=0;h;){if(h.nodeType===8)if(S=h.data,S==="/$"){if(_===0){Ka=rc(h.nextSibling);break e}_--}else S!=="$"&&S!=="$!"&&S!=="$?"||_++;h=h.nextSibling}Ka=null}}else Ka=Kr?rc(h.stateNode.nextSibling):null;return!0}function Ch(){Ka=Kr=null,Ir=!1}function Rh(h){Ko===null?Ko=[h]:Ko.push(h)}var gl=Error(c(460)),I_=Error(c(474)),Jm={then:function(){}};function D_(h){return h=h.status,h==="fulfilled"||h==="rejected"}function _p(){}function P_(h,_,S){switch(S=h[S],S===void 0?h.push(_):S!==_&&(_.then(_p,_p),_=S),_.status){case"fulfilled":return _.value;case"rejected":throw h=_.reason,h===gl?Error(c(483)):h;default:if(typeof _.status=="string")_.then(_p,_p);else{if(h=li,h!==null&&100<h.shellSuspendCounter)throw Error(c(482));h=_,h.status="pending",h.then(function(O){if(_.status==="pending"){var G=_;G.status="fulfilled",G.value=O}},function(O){if(_.status==="pending"){var G=_;G.status="rejected",G.reason=O}})}switch(_.status){case"fulfilled":return _.value;case"rejected":throw h=_.reason,h===gl?Error(c(483)):h}throw $d=_,gl}}var $d=null;function vp(){if($d===null)throw Error(c(459));var h=$d;return $d=null,h}var zc=null,kc=0;function ql(h){var _=kc;return kc+=1,zc===null&&(zc=[]),P_(zc,h,_)}function Ru(h,_){_=_.props.ref,h.ref=_!==void 0?_:null}function Xd(h,_){throw _.$$typeof===y?Error(c(525)):(h=Object.prototype.toString.call(_),Error(c(31,h==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":h)))}function Qm(h){var _=h._init;return _(h._payload)}function yp(h){function _(Ht,Ft){if(h){var en=Ht.deletions;en===null?(Ht.deletions=[Ft],Ht.flags|=16):en.push(Ft)}}function S(Ht,Ft){if(!h)return null;for(;Ft!==null;)_(Ht,Ft),Ft=Ft.sibling;return null}function O(Ht){for(var Ft=new Map;Ht!==null;)Ht.key!==null?Ft.set(Ht.key,Ht):Ft.set(Ht.index,Ht),Ht=Ht.sibling;return Ft}function G(Ht,Ft){return Ht=dn(Ht,Ft),Ht.index=0,Ht.sibling=null,Ht}function te(Ht,Ft,en){return Ht.index=en,h?(en=Ht.alternate,en!==null?(en=en.index,en<Ft?(Ht.flags|=33554434,Ft):en):(Ht.flags|=33554434,Ft)):(Ht.flags|=1048576,Ft)}function Me(Ht){return h&&Ht.alternate===null&&(Ht.flags|=33554434),Ht}function He(Ht,Ft,en,Pn){return Ft===null||Ft.tag!==6?(Ft=Cn(en,Ht.mode,Pn),Ft.return=Ht,Ft):(Ft=G(Ft,en),Ft.return=Ht,Ft)}function mt(Ht,Ft,en,Pn){var Ti=en.type;return Ti===I?Sn(Ht,Ft,en.props.children,Pn,en.key):Ft!==null&&(Ft.elementType===Ti||typeof Ti=="object"&&Ti!==null&&Ti.$$typeof===oe&&Qm(Ti)===Ft.type)?(Ft=G(Ft,en.props),Ru(Ft,en),Ft.return=Ht,Ft):(Ft=Gt(en.type,en.key,en.props,null,Ht.mode,Pn),Ru(Ft,en),Ft.return=Ht,Ft)}function Vt(Ht,Ft,en,Pn){return Ft===null||Ft.tag!==4||Ft.stateNode.containerInfo!==en.containerInfo||Ft.stateNode.implementation!==en.implementation?(Ft=zn(en,Ht.mode,Pn),Ft.return=Ht,Ft):(Ft=G(Ft,en.children||[]),Ft.return=Ht,Ft)}function Sn(Ht,Ft,en,Pn,Ti){return Ft===null||Ft.tag!==7?(Ft=rn(en,Ht.mode,Pn,Ti),Ft.return=Ht,Ft):(Ft=G(Ft,en),Ft.return=Ht,Ft)}function Fn(Ht,Ft,en){if(typeof Ft=="string"&&Ft!==""||typeof Ft=="number"||typeof Ft=="bigint")return Ft=Cn(""+Ft,Ht.mode,en),Ft.return=Ht,Ft;if(typeof Ft=="object"&&Ft!==null){switch(Ft.$$typeof){case M:return en=Gt(Ft.type,Ft.key,Ft.props,null,Ht.mode,en),Ru(en,Ft),en.return=Ht,en;case r:return Ft=zn(Ft,Ht.mode,en),Ft.return=Ht,Ft;case oe:var Pn=Ft._init;return Ft=Pn(Ft._payload),Fn(Ht,Ft,en)}if(Xt(Ft)||Ee(Ft))return Ft=rn(Ft,Ht.mode,en,null),Ft.return=Ht,Ft;if(typeof Ft.then=="function")return Fn(Ht,ql(Ft),en);if(Ft.$$typeof===Y)return Fn(Ht,Np(Ht,Ft),en);Xd(Ht,Ft)}return null}function sn(Ht,Ft,en,Pn){var Ti=Ft!==null?Ft.key:null;if(typeof en=="string"&&en!==""||typeof en=="number"||typeof en=="bigint")return Ti!==null?null:He(Ht,Ft,""+en,Pn);if(typeof en=="object"&&en!==null){switch(en.$$typeof){case M:return en.key===Ti?mt(Ht,Ft,en,Pn):null;case r:return en.key===Ti?Vt(Ht,Ft,en,Pn):null;case oe:return Ti=en._init,en=Ti(en._payload),sn(Ht,Ft,en,Pn)}if(Xt(en)||Ee(en))return Ti!==null?null:Sn(Ht,Ft,en,Pn,null);if(typeof en.then=="function")return sn(Ht,Ft,ql(en),Pn);if(en.$$typeof===Y)return sn(Ht,Ft,Np(Ht,en),Pn);Xd(Ht,en)}return null}function bn(Ht,Ft,en,Pn,Ti){if(typeof Pn=="string"&&Pn!==""||typeof Pn=="number"||typeof Pn=="bigint")return Ht=Ht.get(en)||null,He(Ft,Ht,""+Pn,Ti);if(typeof Pn=="object"&&Pn!==null){switch(Pn.$$typeof){case M:return Ht=Ht.get(Pn.key===null?en:Pn.key)||null,mt(Ft,Ht,Pn,Ti);case r:return Ht=Ht.get(Pn.key===null?en:Pn.key)||null,Vt(Ft,Ht,Pn,Ti);case oe:var lr=Pn._init;return Pn=lr(Pn._payload),bn(Ht,Ft,en,Pn,Ti)}if(Xt(Pn)||Ee(Pn))return Ht=Ht.get(en)||null,Sn(Ft,Ht,Pn,Ti,null);if(typeof Pn.then=="function")return bn(Ht,Ft,en,ql(Pn),Ti);if(Pn.$$typeof===Y)return bn(Ht,Ft,en,Np(Ft,Pn),Ti);Xd(Ft,Pn)}return null}function Oi(Ht,Ft,en,Pn){for(var Ti=null,lr=null,ji=Ft,Ki=Ft=0,Eo=null;ji!==null&&Ki<en.length;Ki++){ji.index>Ki?(Eo=ji,ji=null):Eo=ji.sibling;var Gr=sn(Ht,ji,en[Ki],Pn);if(Gr===null){ji===null&&(ji=Eo);break}h&&ji&&Gr.alternate===null&&_(Ht,ji),Ft=te(Gr,Ft,Ki),lr===null?Ti=Gr:lr.sibling=Gr,lr=Gr,ji=Eo}if(Ki===en.length)return S(Ht,ji),Ir&&Au(Ht,Ki),Ti;if(ji===null){for(;Ki<en.length;Ki++)ji=Fn(Ht,en[Ki],Pn),ji!==null&&(Ft=te(ji,Ft,Ki),lr===null?Ti=ji:lr.sibling=ji,lr=ji);return Ir&&Au(Ht,Ki),Ti}for(ji=O(ji);Ki<en.length;Ki++)Eo=bn(ji,Ht,Ki,en[Ki],Pn),Eo!==null&&(h&&Eo.alternate!==null&&ji.delete(Eo.key===null?Ki:Eo.key),Ft=te(Eo,Ft,Ki),lr===null?Ti=Eo:lr.sibling=Eo,lr=Eo);return h&&ji.forEach(function(sd){return _(Ht,sd)}),Ir&&Au(Ht,Ki),Ti}function dr(Ht,Ft,en,Pn){if(en==null)throw Error(c(151));for(var Ti=null,lr=null,ji=Ft,Ki=Ft=0,Eo=null,Gr=en.next();ji!==null&&!Gr.done;Ki++,Gr=en.next()){ji.index>Ki?(Eo=ji,ji=null):Eo=ji.sibling;var sd=sn(Ht,ji,Gr.value,Pn);if(sd===null){ji===null&&(ji=Eo);break}h&&ji&&sd.alternate===null&&_(Ht,ji),Ft=te(sd,Ft,Ki),lr===null?Ti=sd:lr.sibling=sd,lr=sd,ji=Eo}if(Gr.done)return S(Ht,ji),Ir&&Au(Ht,Ki),Ti;if(ji===null){for(;!Gr.done;Ki++,Gr=en.next())Gr=Fn(Ht,Gr.value,Pn),Gr!==null&&(Ft=te(Gr,Ft,Ki),lr===null?Ti=Gr:lr.sibling=Gr,lr=Gr);return Ir&&Au(Ht,Ki),Ti}for(ji=O(ji);!Gr.done;Ki++,Gr=en.next())Gr=bn(ji,Ht,Ki,Gr.value,Pn),Gr!==null&&(h&&Gr.alternate!==null&&ji.delete(Gr.key===null?Ki:Gr.key),Ft=te(Gr,Ft,Ki),lr===null?Ti=Gr:lr.sibling=Gr,lr=Gr);return h&&ji.forEach(function(uM){return _(Ht,uM)}),Ir&&Au(Ht,Ki),Ti}function ka(Ht,Ft,en,Pn){if(typeof en=="object"&&en!==null&&en.type===I&&en.key===null&&(en=en.props.children),typeof en=="object"&&en!==null){switch(en.$$typeof){case M:e:{for(var Ti=en.key;Ft!==null;){if(Ft.key===Ti){if(Ti=en.type,Ti===I){if(Ft.tag===7){S(Ht,Ft.sibling),Pn=G(Ft,en.props.children),Pn.return=Ht,Ht=Pn;break e}}else if(Ft.elementType===Ti||typeof Ti=="object"&&Ti!==null&&Ti.$$typeof===oe&&Qm(Ti)===Ft.type){S(Ht,Ft.sibling),Pn=G(Ft,en.props),Ru(Pn,en),Pn.return=Ht,Ht=Pn;break e}S(Ht,Ft);break}else _(Ht,Ft);Ft=Ft.sibling}en.type===I?(Pn=rn(en.props.children,Ht.mode,Pn,en.key),Pn.return=Ht,Ht=Pn):(Pn=Gt(en.type,en.key,en.props,null,Ht.mode,Pn),Ru(Pn,en),Pn.return=Ht,Ht=Pn)}return Me(Ht);case r:e:{for(Ti=en.key;Ft!==null;){if(Ft.key===Ti)if(Ft.tag===4&&Ft.stateNode.containerInfo===en.containerInfo&&Ft.stateNode.implementation===en.implementation){S(Ht,Ft.sibling),Pn=G(Ft,en.children||[]),Pn.return=Ht,Ht=Pn;break e}else{S(Ht,Ft);break}else _(Ht,Ft);Ft=Ft.sibling}Pn=zn(en,Ht.mode,Pn),Pn.return=Ht,Ht=Pn}return Me(Ht);case oe:return Ti=en._init,en=Ti(en._payload),ka(Ht,Ft,en,Pn)}if(Xt(en))return Oi(Ht,Ft,en,Pn);if(Ee(en)){if(Ti=Ee(en),typeof Ti!="function")throw Error(c(150));return en=Ti.call(en),dr(Ht,Ft,en,Pn)}if(typeof en.then=="function")return ka(Ht,Ft,ql(en),Pn);if(en.$$typeof===Y)return ka(Ht,Ft,Np(Ht,en),Pn);Xd(Ht,en)}return typeof en=="string"&&en!==""||typeof en=="number"||typeof en=="bigint"?(en=""+en,Ft!==null&&Ft.tag===6?(S(Ht,Ft.sibling),Pn=G(Ft,en),Pn.return=Ht,Ht=Pn):(S(Ht,Ft),Pn=Cn(en,Ht.mode,Pn),Pn.return=Ht,Ht=Pn),Me(Ht)):S(Ht,Ft)}return function(Ht,Ft,en,Pn){try{kc=0;var Ti=ka(Ht,Ft,en,Pn);return zc=null,Ti}catch(ji){if(ji===gl)throw ji;var lr=Ut(29,ji,null,Ht.mode);return lr.lanes=Pn,lr.return=Ht,lr}finally{}}}var Jo=yp(!0),xp=yp(!1),uo=pn(null),Iu=pn(0);function Ih(h,_){h=ha,Pe(Iu,h),Pe(uo,_),ha=h|_.baseLanes}function bp(){Pe(Iu,ha),Pe(uo,uo.current)}function Dh(){ha=Iu.current,jn(uo),jn(Iu)}var Ao=pn(null),Is=null;function Fc(h){var _=h.alternate;Pe(Ja,Ja.current&1),Pe(Ao,h),Is===null&&(_===null||uo.current!==null||_.memoizedState!==null)&&(Is=h)}function wp(h){if(h.tag===22){if(Pe(Ja,Ja.current),Pe(Ao,h),Is===null){var _=h.alternate;_!==null&&_.memoizedState!==null&&(Is=h)}}else hs()}function hs(){Pe(Ja,Ja.current),Pe(Ao,Ao.current)}function Wl(h){jn(Ao),Is===h&&(Is=null),jn(Ja)}var Ja=pn(0);function Zd(h){for(var _=h;_!==null;){if(_.tag===13){var S=_.memoizedState;if(S!==null&&(S=S.dehydrated,S===null||S.data==="$?"||S.data==="$!"))return _}else if(_.tag===19&&_.memoizedProps.revealOrder!==void 0){if((_.flags&128)!==0)return _}else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===h)break;for(;_.sibling===null;){if(_.return===null||_.return===h)return null;_=_.return}_.sibling.return=_.return,_=_.sibling}return null}var L_=typeof AbortController<"u"?AbortController:function(){var h=[],_=this.signal={aborted:!1,addEventListener:function(S,O){h.push(O)}};this.abort=function(){_.aborted=!0,h.forEach(function(S){return S()})}},Sp=t.unstable_scheduleCallback,Ph=t.unstable_NormalPriority,ya={$$typeof:Y,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Lh(){return{controller:new L_,data:new Map,refCount:0}}function $l(h){h.refCount--,h.refCount===0&&Sp(Ph,function(){h.controller.abort()})}var Oh=null,Du=0,_l=0,Nc=null;function O_(h,_){if(Oh===null){var S=Oh=[];Du=0,_l=Q_(),Nc={status:"pending",value:void 0,then:function(O){S.push(O)}}}return Du++,_.then(z_,z_),_}function z_(){if(--Du===0&&Oh!==null){Nc!==null&&(Nc.status="fulfilled");var h=Oh;Oh=null,_l=0,Nc=null;for(var _=0;_<h.length;_++)(0,h[_])()}}function Pu(h,_){var S=[],O={status:"pending",value:null,reason:null,then:function(G){S.push(G)}};return h.then(function(){O.status="fulfilled",O.value=_;for(var G=0;G<S.length;G++)(0,S[G])(_)},function(G){for(O.status="rejected",O.reason=G,G=0;G<S.length;G++)(0,S[G])(void 0)}),O}var Yd=Se.S;Se.S=function(h,_){typeof _=="object"&&_!==null&&typeof _.then=="function"&&O_(h,_),Yd!==null&&Yd(h,_)};var Ln=pn(null);function Kd(){var h=Ln.current;return h!==null?h:li.pooledCache}function zh(h,_){_===null?Pe(Ln,Ln.current):Pe(Ln,_.pool)}function Xl(){var h=Kd();return h===null?null:{parent:ya._currentValue,pool:h}}var Qo=0,gn=null,Wr=null,Ga=null,Ep=!1,Zl=!1,Yl=!1,kh=0,Fh=0,Bc=null,Jd=0;function xa(){throw Error(c(321))}function Qd(h,_){if(_===null)return!1;for(var S=0;S<_.length&&S<h.length;S++)if(!Ya(h[S],_[S]))return!1;return!0}function Ds(h,_,S,O,G,te){return Qo=te,gn=_,_.memoizedState=null,_.updateQueue=null,_.lanes=0,Se.H=h===null||h.memoizedState===null?Qs:No,Yl=!1,te=S(O,G),Yl=!1,Zl&&(te=Kl(_,S,O,G)),Fo(h),te}function Fo(h){Se.H=Os;var _=Wr!==null&&Wr.next!==null;if(Qo=0,Ga=Wr=gn=null,Ep=!1,Fh=0,Bc=null,_)throw Error(c(300));h===null||eo||(h=h.dependencies,h!==null&&wl(h)&&(eo=!0))}function Kl(h,_,S,O){gn=h;var G=0;do{if(Zl&&(Bc=null),Fh=0,Zl=!1,25<=G)throw Error(c(301));if(G+=1,Ga=Wr=null,h.updateQueue!=null){var te=h.updateQueue;te.lastEffect=null,te.events=null,te.stores=null,te.memoCache!=null&&(te.memoCache.index=0)}Se.H=xl,te=_(S,O)}while(Zl);return te}function eg(){var h=Se.H,_=h.useState()[0];return _=typeof _.then=="function"?Vc(_):_,h=h.useState()[0],(Wr!==null?Wr.memoizedState:null)!==h&&(gn.flags|=1024),_}function ef(){var h=kh!==0;return kh=0,h}function Uc(h,_,S){_.updateQueue=h.updateQueue,_.flags&=-2053,h.lanes&=~S}function Nh(h){if(Ep){for(h=h.memoizedState;h!==null;){var _=h.queue;_!==null&&(_.pending=null),h=h.next}Ep=!1}Qo=0,Ga=Wr=gn=null,Zl=!1,Fh=kh=0,Bc=null}function ho(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ga===null?gn.memoizedState=Ga=h:Ga=Ga.next=h,Ga}function Br(){if(Wr===null){var h=gn.alternate;h=h!==null?h.memoizedState:null}else h=Wr.next;var _=Ga===null?gn.memoizedState:Ga.next;if(_!==null)Ga=_,Wr=h;else{if(h===null)throw gn.alternate===null?Error(c(467)):Error(c(310));Wr=h,h={memoizedState:Wr.memoizedState,baseState:Wr.baseState,baseQueue:Wr.baseQueue,queue:Wr.queue,next:null},Ga===null?gn.memoizedState=Ga=h:Ga=Ga.next=h}return Ga}var Er;Er=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function Vc(h){var _=Fh;return Fh+=1,Bc===null&&(Bc=[]),h=P_(Bc,h,_),_=gn,(Ga===null?_.memoizedState:Ga.next)===null&&(_=_.alternate,Se.H=_===null||_.memoizedState===null?Qs:No),h}function jc(h){if(h!==null&&typeof h=="object"){if(typeof h.then=="function")return Vc(h);if(h.$$typeof===Y)return Co(h)}throw Error(c(438,String(h)))}function Bh(h){var _=null,S=gn.updateQueue;if(S!==null&&(_=S.memoCache),_==null){var O=gn.alternate;O!==null&&(O=O.updateQueue,O!==null&&(O=O.memoCache,O!=null&&(_={data:O.data.map(function(G){return G.slice()}),index:0})))}if(_==null&&(_={data:[],index:0}),S===null&&(S=Er(),gn.updateQueue=S),S.memoCache=_,S=_.data[_.index],S===void 0)for(S=_.data[_.index]=Array(h),O=0;O<h;O++)S[O]=pe;return _.index++,S}function Ks(h,_){return typeof _=="function"?_(h):_}function Gc(h){var _=Br();return Hc(_,Wr,h)}function Hc(h,_,S){var O=h.queue;if(O===null)throw Error(c(311));O.lastRenderedReducer=S;var G=h.baseQueue,te=O.pending;if(te!==null){if(G!==null){var Me=G.next;G.next=te.next,te.next=Me}_.baseQueue=G=te,O.pending=null}if(te=h.baseState,G===null)h.memoizedState=te;else{_=G.next;var He=Me=null,mt=null,Vt=_,Sn=!1;do{var Fn=Vt.lane&-536870913;if(Fn!==Vt.lane?(hi&Fn)===Fn:(Qo&Fn)===Fn){var sn=Vt.revertLane;if(sn===0)mt!==null&&(mt=mt.next={lane:0,revertLane:0,action:Vt.action,hasEagerState:Vt.hasEagerState,eagerState:Vt.eagerState,next:null}),Fn===_l&&(Sn=!0);else if((Qo&sn)===sn){Vt=Vt.next,sn===_l&&(Sn=!0);continue}else Fn={lane:0,revertLane:Vt.revertLane,action:Vt.action,hasEagerState:Vt.hasEagerState,eagerState:Vt.eagerState,next:null},mt===null?(He=mt=Fn,Me=te):mt=mt.next=Fn,gn.lanes|=sn,hr|=sn;Fn=Vt.action,Yl&&S(te,Fn),te=Vt.hasEagerState?Vt.eagerState:S(te,Fn)}else sn={lane:Fn,revertLane:Vt.revertLane,action:Vt.action,hasEagerState:Vt.hasEagerState,eagerState:Vt.eagerState,next:null},mt===null?(He=mt=sn,Me=te):mt=mt.next=sn,gn.lanes|=Fn,hr|=Fn;Vt=Vt.next}while(Vt!==null&&Vt!==_);if(mt===null?Me=te:mt.next=He,!Ya(te,h.memoizedState)&&(eo=!0,Sn&&(S=Nc,S!==null)))throw S;h.memoizedState=te,h.baseState=Me,h.baseQueue=mt,O.lastRenderedState=te}return G===null&&(O.lanes=0),[h.memoizedState,O.dispatch]}function qc(h){var _=Br(),S=_.queue;if(S===null)throw Error(c(311));S.lastRenderedReducer=h;var O=S.dispatch,G=S.pending,te=_.memoizedState;if(G!==null){S.pending=null;var Me=G=G.next;do te=h(te,Me.action),Me=Me.next;while(Me!==G);Ya(te,_.memoizedState)||(eo=!0),_.memoizedState=te,_.baseQueue===null&&(_.baseState=te),S.lastRenderedState=te}return[te,O]}function Lu(h,_,S){var O=gn,G=Br(),te=Ir;if(te){if(S===void 0)throw Error(c(407));S=S()}else S=_();var Me=!Ya((Wr||G).memoizedState,S);if(Me&&(G.memoizedState=S,eo=!0),G=G.queue,Ca(Ou.bind(null,O,G,h),[h]),G.getSnapshot!==_||Me||Ga!==null&&Ga.memoizedState.tag&1){if(O.flags|=2048,Ps(9,Dn.bind(null,O,G,S,_),{destroy:void 0},null),li===null)throw Error(c(349));te||(Qo&60)!==0||hn(O,_,S)}return S}function hn(h,_,S){h.flags|=16384,h={getSnapshot:_,value:S},_=gn.updateQueue,_===null?(_=Er(),gn.updateQueue=_,_.stores=[h]):(S=_.stores,S===null?_.stores=[h]:S.push(h))}function Dn(h,_,S,O){_.value=S,_.getSnapshot=O,$r(_)&&bt(h)}function Ou(h,_,S){return S(function(){$r(_)&&bt(h)})}function $r(h){var _=h.getSnapshot;h=h.value;try{var S=_();return!Ya(h,S)}catch{return!0}}function bt(h){var _=cs(h,2);_!==null&&ys(_,h,2)}function Mp(h){var _=ho();if(typeof h=="function"){var S=h;if(h=S(),Yl){Ai(!0);try{S()}finally{Ai(!1)}}}return _.memoizedState=_.baseState=h,_.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ks,lastRenderedState:h},_}function tf(h,_,S,O){return h.baseState=S,Hc(h,Wr,typeof O=="function"?O:Ks)}function tg(h,_,S,O,G){if(Gh(h))throw Error(c(485));if(h=_.action,h!==null){var te={payload:G,action:h,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Me){te.listeners.push(Me)}};Se.T!==null?S(!0):te.isTransition=!1,O(te),S=_.pending,S===null?(te.next=_.pending=te,ng(_,te)):(te.next=S.next,_.pending=S.next=te)}}function ng(h,_){var S=_.action,O=_.payload,G=h.state;if(_.isTransition){var te=Se.T,Me={};Se.T=Me;try{var He=S(G,O),mt=Se.S;mt!==null&&mt(Me,He),ig(h,_,He)}catch(Vt){Wc(h,_,Vt)}finally{Se.T=te}}else try{te=S(G,O),ig(h,_,te)}catch(Vt){Wc(h,_,Vt)}}function ig(h,_,S){S!==null&&typeof S=="object"&&typeof S.then=="function"?S.then(function(O){rg(h,_,O)},function(O){return Wc(h,_,O)}):rg(h,_,S)}function rg(h,_,S){_.status="fulfilled",_.value=S,k_(_),h.state=S,_=h.pending,_!==null&&(S=_.next,S===_?h.pending=null:(S=S.next,_.next=S,ng(h,S)))}function Wc(h,_,S){var O=h.pending;if(h.pending=null,O!==null){O=O.next;do _.status="rejected",_.reason=S,k_(_),_=_.next;while(_!==O)}h.action=null}function k_(h){h=h.listeners;for(var _=0;_<h.length;_++)(0,h[_])()}function F_(h,_){return _}function ag(h,_){if(Ir){var S=li.formState;if(S!==null){e:{var O=gn;if(Ir){if(Ka){t:{for(var G=Ka,te=Rs;G.nodeType!==8;){if(!te){G=null;break t}if(G=rc(G.nextSibling),G===null){G=null;break t}}te=G.data,G=te==="F!"||te==="F"?G:null}if(G){Ka=rc(G.nextSibling),O=G.data==="F!";break e}}ml(O)}O=!1}O&&(_=S[0])}}return S=ho(),S.memoizedState=S.baseState=_,O={pending:null,lanes:0,dispatch:null,lastRenderedReducer:F_,lastRenderedState:_},S.queue=O,S=Rp.bind(null,gn,O),O.dispatch=S,O=Mp(!1),te=lf.bind(null,gn,!1,O.queue),O=ho(),G={state:_,dispatch:null,action:h,pending:null},O.queue=G,S=tg.bind(null,gn,G,te,S),G.dispatch=S,O.memoizedState=h,[_,S,!1]}function nf(h){var _=Br();return Jl(_,Wr,h)}function Jl(h,_,S){_=Hc(h,_,F_)[0],h=Gc(Ks)[0],_=typeof _=="object"&&_!==null&&typeof _.then=="function"?Vc(_):_;var O=Br(),G=O.queue,te=G.dispatch;return S!==O.memoizedState&&(gn.flags|=2048,Ps(9,og.bind(null,G,S),{destroy:void 0},null)),[_,te,h]}function og(h,_){h.action=_}function Tp(h){var _=Br(),S=Wr;if(S!==null)return Jl(_,S,h);Br(),_=_.memoizedState,S=Br();var O=S.queue.dispatch;return S.memoizedState=h,[_,O,!1]}function Ps(h,_,S,O){return h={tag:h,create:_,inst:S,deps:O,next:null},_=gn.updateQueue,_===null&&(_=Er(),gn.updateQueue=_),S=_.lastEffect,S===null?_.lastEffect=h.next=h:(O=S.next,S.next=h,h.next=O,_.lastEffect=h),h}function rf(){return Br().memoizedState}function ds(h,_,S,O){var G=ho();gn.flags|=h,G.memoizedState=Ps(1|_,S,{destroy:void 0},O===void 0?null:O)}function Ls(h,_,S,O){var G=Br();O=O===void 0?null:O;var te=G.memoizedState.inst;Wr!==null&&O!==null&&Qd(O,Wr.memoizedState.deps)?G.memoizedState=Ps(_,S,te,O):(gn.flags|=h,G.memoizedState=Ps(1|_,S,te,O))}function sg(h,_){ds(8390656,8,h,_)}function Ca(h,_){Ls(2048,8,h,_)}function N_(h,_){return Ls(4,2,h,_)}function Uh(h,_){return Ls(4,4,h,_)}function Dr(h,_){if(typeof _=="function"){h=h();var S=_(h);return function(){typeof S=="function"?S():_(null)}}if(_!=null)return h=h(),_.current=h,function(){_.current=null}}function sr(h,_,S){S=S!=null?S.concat([h]):null,Ls(4,4,Dr.bind(null,_,h),S)}function Ap(){}function vl(h,_){var S=Br();_=_===void 0?null:_;var O=S.memoizedState;return _!==null&&Qd(_,O[1])?O[0]:(S.memoizedState=[h,_],h)}function zu(h,_){var S=Br();_=_===void 0?null:_;var O=S.memoizedState;if(_!==null&&Qd(_,O[1]))return O[0];if(O=h(),Yl){Ai(!0);try{h()}finally{Ai(!1)}}return S.memoizedState=[O,_],O}function Js(h,_,S){return S===void 0||(Qo&1073741824)!==0?h.memoizedState=_:(h.memoizedState=S,h=mb(),gn.lanes|=h,hr|=h,S)}function af(h,_,S,O){return Ya(S,_)?S:uo.current!==null?(h=Js(h,S,O),Ya(h,_)||(eo=!0),h):(Qo&42)===0?(eo=!0,h.memoizedState=S):(h=mb(),gn.lanes|=h,hr|=h,_)}function Vh(h,_,S,O,G){var te=It.p;It.p=te!==0&&8>te?te:8;var Me=Se.T,He={};Se.T=He,lf(h,!1,_,S);try{var mt=G(),Vt=Se.S;if(Vt!==null&&Vt(He,mt),mt!==null&&typeof mt=="object"&&typeof mt.then=="function"){var Sn=Pu(mt,O);Zc(h,_,Sn,Bs(h))}else Zc(h,_,O,Bs(h))}catch(Fn){Zc(h,_,{then:function(){},status:"rejected",reason:Fn},Bs())}finally{It.p=te,Se.T=Me}}function yl(){}function Qa(h,_,S,O){if(h.tag!==5)throw Error(c(476));var G=of(h).queue;Vh(h,G,_,ln,S===null?yl:function(){return jh(h),S(O)})}function of(h){var _=h.memoizedState;if(_!==null)return _;_={memoizedState:ln,baseState:ln,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ks,lastRenderedState:ln},next:null};var S={};return _.next={memoizedState:S,baseState:S,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ks,lastRenderedState:S},next:null},h.memoizedState=_,h=h.alternate,h!==null&&(h.memoizedState=_),_}function jh(h){var _=of(h).next.queue;Zc(h,_,{},Bs())}function sf(){return Co(Cf)}function Cp(){return Br().memoizedState}function $c(){return Br().memoizedState}function lg(h){for(var _=h.return;_!==null;){switch(_.tag){case 24:case 3:var S=Bs();h=ms(S);var O=tc(_,h,S);O!==null&&(ys(O,_,S),Zh(O,_,S)),_={cache:Lh()},h.payload=_;return}_=_.return}}function Xc(h,_,S){var O=Bs();S={lane:O,revertLane:0,action:S,hasEagerState:!1,eagerState:null,next:null},Gh(h)?Ha(_,S):(S=Su(h,_,S,O),S!==null&&(ys(S,h,O),Ip(S,_,O)))}function Rp(h,_,S){var O=Bs();Zc(h,_,S,O)}function Zc(h,_,S,O){var G={lane:O,revertLane:0,action:S,hasEagerState:!1,eagerState:null,next:null};if(Gh(h))Ha(_,G);else{var te=h.alternate;if(h.lanes===0&&(te===null||te.lanes===0)&&(te=_.lastRenderedReducer,te!==null))try{var Me=_.lastRenderedState,He=te(Me,S);if(G.hasEagerState=!0,G.eagerState=He,Ya(He,Me))return wu(h,_,G,0),li===null&&Pc(),!1}catch{}finally{}if(S=Su(h,_,G,O),S!==null)return ys(S,h,O),Ip(S,_,O),!0}return!1}function lf(h,_,S,O){if(O={lane:2,revertLane:Q_(),action:O,hasEagerState:!1,eagerState:null,next:null},Gh(h)){if(_)throw Error(c(479))}else _=Su(h,S,O,2),_!==null&&ys(_,h,2)}function Gh(h){var _=h.alternate;return h===gn||_!==null&&_===gn}function Ha(h,_){Zl=Ep=!0;var S=h.pending;S===null?_.next=_:(_.next=S.next,S.next=_),h.pending=_}function Ip(h,_,S){if((S&4194176)!==0){var O=_.lanes;O&=h.pendingLanes,S|=O,_.lanes=S,$o(h,S)}}var Os={readContext:Co,use:jc,useCallback:xa,useContext:xa,useEffect:xa,useImperativeHandle:xa,useLayoutEffect:xa,useInsertionEffect:xa,useMemo:xa,useReducer:xa,useRef:xa,useState:xa,useDebugValue:xa,useDeferredValue:xa,useTransition:xa,useSyncExternalStore:xa,useId:xa};Os.useCacheRefresh=xa,Os.useMemoCache=xa,Os.useHostTransitionStatus=xa,Os.useFormState=xa,Os.useActionState=xa,Os.useOptimistic=xa;var Qs={readContext:Co,use:jc,useCallback:function(h,_){return ho().memoizedState=[h,_===void 0?null:_],h},useContext:Co,useEffect:sg,useImperativeHandle:function(h,_,S){S=S!=null?S.concat([h]):null,ds(4194308,4,Dr.bind(null,_,h),S)},useLayoutEffect:function(h,_){return ds(4194308,4,h,_)},useInsertionEffect:function(h,_){ds(4,2,h,_)},useMemo:function(h,_){var S=ho();_=_===void 0?null:_;var O=h();if(Yl){Ai(!0);try{h()}finally{Ai(!1)}}return S.memoizedState=[O,_],O},useReducer:function(h,_,S){var O=ho();if(S!==void 0){var G=S(_);if(Yl){Ai(!0);try{S(_)}finally{Ai(!1)}}}else G=_;return O.memoizedState=O.baseState=G,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:G},O.queue=h,h=h.dispatch=Xc.bind(null,gn,h),[O.memoizedState,h]},useRef:function(h){var _=ho();return h={current:h},_.memoizedState=h},useState:function(h){h=Mp(h);var _=h.queue,S=Rp.bind(null,gn,_);return _.dispatch=S,[h.memoizedState,S]},useDebugValue:Ap,useDeferredValue:function(h,_){var S=ho();return Js(S,h,_)},useTransition:function(){var h=Mp(!1);return h=Vh.bind(null,gn,h.queue,!0,!1),ho().memoizedState=h,[!1,h]},useSyncExternalStore:function(h,_,S){var O=gn,G=ho();if(Ir){if(S===void 0)throw Error(c(407));S=S()}else{if(S=_(),li===null)throw Error(c(349));(hi&60)!==0||hn(O,_,S)}G.memoizedState=S;var te={value:S,getSnapshot:_};return G.queue=te,sg(Ou.bind(null,O,te,h),[h]),O.flags|=2048,Ps(9,Dn.bind(null,O,te,S,_),{destroy:void 0},null),S},useId:function(){var h=ho(),_=li.identifierPrefix;if(Ir){var S=pl,O=fl;S=(O&~(1<<32-Si(O)-1)).toString(32)+S,_=":"+_+"R"+S,S=kh++,0<S&&(_+="H"+S.toString(32)),_+=":"}else S=Jd++,_=":"+_+"r"+S.toString(32)+":";return h.memoizedState=_},useCacheRefresh:function(){return ho().memoizedState=lg.bind(null,gn)}};Qs.useMemoCache=Bh,Qs.useHostTransitionStatus=sf,Qs.useFormState=ag,Qs.useActionState=ag,Qs.useOptimistic=function(h){var _=ho();_.memoizedState=_.baseState=h;var S={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return _.queue=S,_=lf.bind(null,gn,!0,S),S.dispatch=_,[h,_]};var No={readContext:Co,use:jc,useCallback:vl,useContext:Co,useEffect:Ca,useImperativeHandle:sr,useInsertionEffect:N_,useLayoutEffect:Uh,useMemo:zu,useReducer:Gc,useRef:rf,useState:function(){return Gc(Ks)},useDebugValue:Ap,useDeferredValue:function(h,_){var S=Br();return af(S,Wr.memoizedState,h,_)},useTransition:function(){var h=Gc(Ks)[0],_=Br().memoizedState;return[typeof h=="boolean"?h:Vc(h),_]},useSyncExternalStore:Lu,useId:Cp};No.useCacheRefresh=$c,No.useMemoCache=Bh,No.useHostTransitionStatus=sf,No.useFormState=nf,No.useActionState=nf,No.useOptimistic=function(h,_){var S=Br();return tf(S,Wr,h,_)};var xl={readContext:Co,use:jc,useCallback:vl,useContext:Co,useEffect:Ca,useImperativeHandle:sr,useInsertionEffect:N_,useLayoutEffect:Uh,useMemo:zu,useReducer:qc,useRef:rf,useState:function(){return qc(Ks)},useDebugValue:Ap,useDeferredValue:function(h,_){var S=Br();return Wr===null?Js(S,h,_):af(S,Wr.memoizedState,h,_)},useTransition:function(){var h=qc(Ks)[0],_=Br().memoizedState;return[typeof h=="boolean"?h:Vc(h),_]},useSyncExternalStore:Lu,useId:Cp};xl.useCacheRefresh=$c,xl.useMemoCache=Bh,xl.useHostTransitionStatus=sf,xl.useFormState=Tp,xl.useActionState=Tp,xl.useOptimistic=function(h,_){var S=Br();return Wr!==null?tf(S,Wr,h,_):(S.baseState=h,[h,S.queue.dispatch])};function zs(h,_,S,O){_=h.memoizedState,S=S(O,_),S=S==null?_:xe({},_,S),h.memoizedState=S,h.lanes===0&&(h.updateQueue.baseState=S)}var Hh={isMounted:function(h){return(h=h._reactInternals)?lt(h)===h:!1},enqueueSetState:function(h,_,S){h=h._reactInternals;var O=Bs(),G=ms(O);G.payload=_,S!=null&&(G.callback=S),_=tc(h,G,O),_!==null&&(ys(_,h,O),Zh(_,h,O))},enqueueReplaceState:function(h,_,S){h=h._reactInternals;var O=Bs(),G=ms(O);G.tag=1,G.payload=_,S!=null&&(G.callback=S),_=tc(h,G,O),_!==null&&(ys(_,h,O),Zh(_,h,O))},enqueueForceUpdate:function(h,_){h=h._reactInternals;var S=Bs(),O=ms(S);O.tag=2,_!=null&&(O.callback=_),_=tc(h,O,S),_!==null&&(ys(_,h,S),Zh(_,h,S))}};function ku(h,_,S,O,G,te,Me){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(O,te,Me):_.prototype&&_.prototype.isPureReactComponent?!Ys(S,O)||!Ys(G,te):!0}function Dp(h,_,S,O){h=_.state,typeof _.componentWillReceiveProps=="function"&&_.componentWillReceiveProps(S,O),typeof _.UNSAFE_componentWillReceiveProps=="function"&&_.UNSAFE_componentWillReceiveProps(S,O),_.state!==h&&Hh.enqueueReplaceState(_,_.state,null)}function Ql(h,_){var S=_;if("ref"in _){S={};for(var O in _)O!=="ref"&&(S[O]=_[O])}if(h=h.defaultProps){S===_&&(S=xe({},S));for(var G in h)S[G]===void 0&&(S[G]=h[G])}return S}var Yc=typeof reportError=="function"?reportError:function(h){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var _=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof h=="object"&&h!==null&&typeof h.message=="string"?String(h.message):String(h),error:h});if(!window.dispatchEvent(_))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",h);return}console.error(h)};function qh(h){Yc(h)}function Pp(h){console.error(h)}function cf(h){Yc(h)}function uf(h,_){try{var S=h.onUncaughtError;S(_.value,{componentStack:_.stack})}catch(O){setTimeout(function(){throw O})}}function Lp(h,_,S){try{var O=h.onCaughtError;O(S.value,{componentStack:S.stack,errorBoundary:_.tag===1?_.stateNode:null})}catch(G){setTimeout(function(){throw G})}}function Fu(h,_,S){return S=ms(S),S.tag=3,S.payload={element:null},S.callback=function(){uf(h,_)},S}function cg(h){return h=ms(h),h.tag=3,h}function ug(h,_,S,O){var G=S.type.getDerivedStateFromError;if(typeof G=="function"){var te=O.value;h.payload=function(){return G(te)},h.callback=function(){Lp(_,S,O)}}var Me=S.stateNode;Me!==null&&typeof Me.componentDidCatch=="function"&&(h.callback=function(){Lp(_,S,O),typeof G!="function"&&(to===null?to=new Set([this]):to.add(this));var He=O.stack;this.componentDidCatch(O.value,{componentStack:He!==null?He:""})})}function B_(h,_,S,O,G){if(S.flags|=32768,O!==null&&typeof O=="object"&&typeof O.then=="function"){if(_=S.alternate,_!==null&&Fs(_,S,G,!0),S=Ao.current,S!==null){switch(S.tag){case 13:return Is===null?vf():S.alternate===null&&Yi===0&&(Yi=3),S.flags&=-257,S.flags|=65536,S.lanes=G,O===Jm?S.flags|=16384:(_=S.updateQueue,_===null?S.updateQueue=new Set([O]):_.add(O),Qh(h,O,G)),!1;case 22:return S.flags|=65536,O===Jm?S.flags|=16384:(_=S.updateQueue,_===null?(_={transitions:null,markerInstances:null,retryQueue:new Set([O])},S.updateQueue=_):(S=_.retryQueue,S===null?_.retryQueue=new Set([O]):S.add(O)),Qh(h,O,G)),!1}throw Error(c(435,S.tag))}return Qh(h,O,G),vf(),!1}if(Ir)return _=Ao.current,_!==null?((_.flags&65536)===0&&(_.flags|=256),_.flags|=65536,_.lanes=G,O!==Wd&&(h=Error(c(422),{cause:O}),Rh(us(h,S)))):(O!==Wd&&(_=Error(c(423),{cause:O}),Rh(us(_,S))),h=h.current.alternate,h.flags|=65536,G&=-G,h.lanes|=G,O=us(O,S),G=Fu(h.stateNode,O,G),Jc(h,G),Yi!==4&&(Yi=2)),!1;var te=Error(c(520),{cause:O});if(te=us(te,S),mr===null?mr=[te]:mr.push(te),Yi!==4&&(Yi=2),_===null)return!0;O=us(O,S),S=_;do{switch(S.tag){case 3:return S.flags|=65536,h=G&-G,S.lanes|=h,h=Fu(S.stateNode,O,h),Jc(S,h),!1;case 1:if(_=S.type,te=S.stateNode,(S.flags&128)===0&&(typeof _.getDerivedStateFromError=="function"||te!==null&&typeof te.componentDidCatch=="function"&&(to===null||!to.has(te))))return S.flags|=65536,G&=-G,S.lanes|=G,G=cg(G),ug(G,h,S,O),Jc(S,G),!1}S=S.return}while(S!==null);return!1}var hg=Error(c(461)),eo=!1;function za(h,_,S,O){_.child=h===null?xp(_,null,S,O):Jo(_,h.child,S,O)}function Wh(h,_,S,O,G){S=S.render;var te=_.ref;if("ref"in O){var Me={};for(var He in O)He!=="ref"&&(Me[He]=O[He])}else Me=O;return ts(_),O=Ds(h,_,S,Me,te,G),He=ef(),h!==null&&!eo?(Uc(h,_,G),bl(h,_,G)):(Ir&&He&&Cu(_),_.flags|=1,za(h,_,O,G),_.child)}function Bo(h,_,S,O,G){if(h===null){var te=S.type;return typeof te=="function"&&!Pt(te)&&te.defaultProps===void 0&&S.compare===null?(_.tag=15,_.type=te,$h(h,_,te,O,G)):(h=Gt(S.type,null,O,_,_.mode,G),h.ref=_.ref,h.return=_,_.child=h)}if(te=h.child,!kp(h,G)){var Me=te.memoizedProps;if(S=S.compare,S=S!==null?S:Ys,S(Me,O)&&h.ref===_.ref)return bl(h,_,G)}return _.flags|=1,h=dn(te,O),h.ref=_.ref,h.return=_,_.child=h}function $h(h,_,S,O,G){if(h!==null){var te=h.memoizedProps;if(Ys(te,O)&&h.ref===_.ref)if(eo=!1,_.pendingProps=O=te,kp(h,G))(h.flags&131072)!==0&&(eo=!0);else return _.lanes=h.lanes,bl(h,_,G)}return Jr(h,_,S,O,G)}function dg(h,_,S){var O=_.pendingProps,G=O.children,te=(_.stateNode._pendingVisibility&2)!==0,Me=h!==null?h.memoizedState:null;if(hf(h,_),O.mode==="hidden"||te){if((_.flags&128)!==0){if(O=Me!==null?Me.baseLanes|S:S,h!==null){for(G=_.child=h.child,te=0;G!==null;)te=te|G.lanes|G.childLanes,G=G.sibling;_.childLanes=te&~O}else _.childLanes=0,_.child=null;return U_(h,_,O,S)}if((S&536870912)!==0)_.memoizedState={baseLanes:0,cachePool:null},h!==null&&zh(_,Me!==null?Me.cachePool:null),Me!==null?Ih(_,Me):bp(),wp(_);else return _.lanes=_.childLanes=536870912,U_(h,_,Me!==null?Me.baseLanes|S:S,S)}else Me!==null?(zh(_,Me.cachePool),Ih(_,Me),hs(),_.memoizedState=null):(h!==null&&zh(_,null),bp(),hs());return za(h,_,G,S),_.child}function U_(h,_,S,O){var G=Kd();return G=G===null?null:{parent:ya._currentValue,pool:G},_.memoizedState={baseLanes:S,cachePool:G},h!==null&&zh(_,null),bp(),wp(_),h!==null&&Fs(h,_,O,!0),null}function hf(h,_){var S=_.ref;if(S===null)h!==null&&h.ref!==null&&(_.flags|=2097664);else{if(typeof S!="function"&&typeof S!="object")throw Error(c(284));(h===null||h.ref!==S)&&(_.flags|=2097664)}}function Jr(h,_,S,O,G){return ts(_),S=Ds(h,_,S,O,void 0,G),O=ef(),h!==null&&!eo?(Uc(h,_,G),bl(h,_,G)):(Ir&&O&&Cu(_),_.flags|=1,za(h,_,S,G),_.child)}function df(h,_,S,O,G,te){return ts(_),_.updateQueue=null,S=Kl(_,O,S,G),Fo(h),O=ef(),h!==null&&!eo?(Uc(h,_,te),bl(h,_,te)):(Ir&&O&&Cu(_),_.flags|=1,za(h,_,S,te),_.child)}function V_(h,_,S,O,G){if(ts(_),_.stateNode===null){var te=Eu,Me=S.contextType;typeof Me=="object"&&Me!==null&&(te=Co(Me)),te=new S(O,te),_.memoizedState=te.state!==null&&te.state!==void 0?te.state:null,te.updater=Hh,_.stateNode=te,te._reactInternals=_,te=_.stateNode,te.props=O,te.state=_.memoizedState,te.refs={},Bp(_),Me=S.contextType,te.context=typeof Me=="object"&&Me!==null?Co(Me):Eu,te.state=_.memoizedState,Me=S.getDerivedStateFromProps,typeof Me=="function"&&(zs(_,S,Me,O),te.state=_.memoizedState),typeof S.getDerivedStateFromProps=="function"||typeof te.getSnapshotBeforeUpdate=="function"||typeof te.UNSAFE_componentWillMount!="function"&&typeof te.componentWillMount!="function"||(Me=te.state,typeof te.componentWillMount=="function"&&te.componentWillMount(),typeof te.UNSAFE_componentWillMount=="function"&&te.UNSAFE_componentWillMount(),Me!==te.state&&Hh.enqueueReplaceState(te,te.state,null),wo(_,O,te,G),bo(),te.state=_.memoizedState),typeof te.componentDidMount=="function"&&(_.flags|=4194308),O=!0}else if(h===null){te=_.stateNode;var He=_.memoizedProps,mt=Ql(S,He);te.props=mt;var Vt=te.context,Sn=S.contextType;Me=Eu,typeof Sn=="object"&&Sn!==null&&(Me=Co(Sn));var Fn=S.getDerivedStateFromProps;Sn=typeof Fn=="function"||typeof te.getSnapshotBeforeUpdate=="function",He=_.pendingProps!==He,Sn||typeof te.UNSAFE_componentWillReceiveProps!="function"&&typeof te.componentWillReceiveProps!="function"||(He||Vt!==Me)&&Dp(_,te,O,Me),nl=!1;var sn=_.memoizedState;te.state=sn,wo(_,O,te,G),bo(),Vt=_.memoizedState,He||sn!==Vt||nl?(typeof Fn=="function"&&(zs(_,S,Fn,O),Vt=_.memoizedState),(mt=nl||ku(_,S,mt,O,sn,Vt,Me))?(Sn||typeof te.UNSAFE_componentWillMount!="function"&&typeof te.componentWillMount!="function"||(typeof te.componentWillMount=="function"&&te.componentWillMount(),typeof te.UNSAFE_componentWillMount=="function"&&te.UNSAFE_componentWillMount()),typeof te.componentDidMount=="function"&&(_.flags|=4194308)):(typeof te.componentDidMount=="function"&&(_.flags|=4194308),_.memoizedProps=O,_.memoizedState=Vt),te.props=O,te.state=Vt,te.context=Me,O=mt):(typeof te.componentDidMount=="function"&&(_.flags|=4194308),O=!1)}else{te=_.stateNode,fo(h,_),Me=_.memoizedProps,Sn=Ql(S,Me),te.props=Sn,Fn=_.pendingProps,sn=te.context,Vt=S.contextType,mt=Eu,typeof Vt=="object"&&Vt!==null&&(mt=Co(Vt)),He=S.getDerivedStateFromProps,(Vt=typeof He=="function"||typeof te.getSnapshotBeforeUpdate=="function")||typeof te.UNSAFE_componentWillReceiveProps!="function"&&typeof te.componentWillReceiveProps!="function"||(Me!==Fn||sn!==mt)&&Dp(_,te,O,mt),nl=!1,sn=_.memoizedState,te.state=sn,wo(_,O,te,G),bo();var bn=_.memoizedState;Me!==Fn||sn!==bn||nl||h!==null&&h.dependencies!==null&&wl(h.dependencies)?(typeof He=="function"&&(zs(_,S,He,O),bn=_.memoizedState),(Sn=nl||ku(_,S,Sn,O,sn,bn,mt)||h!==null&&h.dependencies!==null&&wl(h.dependencies))?(Vt||typeof te.UNSAFE_componentWillUpdate!="function"&&typeof te.componentWillUpdate!="function"||(typeof te.componentWillUpdate=="function"&&te.componentWillUpdate(O,bn,mt),typeof te.UNSAFE_componentWillUpdate=="function"&&te.UNSAFE_componentWillUpdate(O,bn,mt)),typeof te.componentDidUpdate=="function"&&(_.flags|=4),typeof te.getSnapshotBeforeUpdate=="function"&&(_.flags|=1024)):(typeof te.componentDidUpdate!="function"||Me===h.memoizedProps&&sn===h.memoizedState||(_.flags|=4),typeof te.getSnapshotBeforeUpdate!="function"||Me===h.memoizedProps&&sn===h.memoizedState||(_.flags|=1024),_.memoizedProps=O,_.memoizedState=bn),te.props=O,te.state=bn,te.context=mt,O=Sn):(typeof te.componentDidUpdate!="function"||Me===h.memoizedProps&&sn===h.memoizedState||(_.flags|=4),typeof te.getSnapshotBeforeUpdate!="function"||Me===h.memoizedProps&&sn===h.memoizedState||(_.flags|=1024),O=!1)}return te=O,hf(h,_),O=(_.flags&128)!==0,te||O?(te=_.stateNode,S=O&&typeof S.getDerivedStateFromError!="function"?null:te.render(),_.flags|=1,h!==null&&O?(_.child=Jo(_,h.child,null,G),_.child=Jo(_,null,S,G)):za(h,_,S,G),_.memoizedState=te.state,h=_.child):h=bl(h,_,G),h}function Op(h,_,S,O){return Ch(),_.flags|=256,za(h,_,S,O),_.child}var Nu={dehydrated:null,treeContext:null,retryLane:0};function zp(h){return{baseLanes:h,cachePool:Xl()}}function Bu(h,_,S){return h=h!==null?h.childLanes&~S:0,_&&(h|=Tr),h}function ff(h,_,S){var O=_.pendingProps,G=!1,te=(_.flags&128)!==0,Me;if((Me=te)||(Me=h!==null&&h.memoizedState===null?!1:(Ja.current&2)!==0),Me&&(G=!0,_.flags&=-129),Me=(_.flags&32)!==0,_.flags&=-33,h===null){if(Ir){if(G?Fc(_):hs(),Ir){var He=Ka,mt;if(mt=He){e:{for(mt=He,He=Rs;mt.nodeType!==8;){if(!He){He=null;break e}if(mt=rc(mt.nextSibling),mt===null){He=null;break e}}He=mt}He!==null?(_.memoizedState={dehydrated:He,treeContext:Hl!==null?{id:fl,overflow:pl}:null,retryLane:536870912},mt=Ut(18,null,null,0),mt.stateNode=He,mt.return=_,_.child=mt,Kr=_,Ka=null,mt=!0):mt=!1}mt||ml(_)}if(He=_.memoizedState,He!==null&&(He=He.dehydrated,He!==null))return He.data==="$!"?_.lanes=16:_.lanes=536870912,null;Wl(_)}return He=O.children,O=O.fallback,G?(hs(),G=_.mode,He=Uu({mode:"hidden",children:He},G),O=rn(O,G,S,null),He.return=_,O.return=_,He.sibling=O,_.child=He,G=_.child,G.memoizedState=zp(S),G.childLanes=Bu(h,Me,S),_.memoizedState=Nu,O):(Fc(_),ks(_,He))}if(mt=h.memoizedState,mt!==null&&(He=mt.dehydrated,He!==null)){if(te)_.flags&256?(Fc(_),_.flags&=-257,_=aa(h,_,S)):_.memoizedState!==null?(hs(),_.child=h.child,_.flags|=128,_=null):(hs(),G=O.fallback,He=_.mode,O=Uu({mode:"visible",children:O.children},He),G=rn(G,He,S,null),G.flags|=2,O.return=_,G.return=_,O.sibling=G,_.child=O,Jo(_,h.child,null,S),O=_.child,O.memoizedState=zp(S),O.childLanes=Bu(h,Me,S),_.memoizedState=Nu,_=G);else if(Fc(_),He.data==="$!"){if(Me=He.nextSibling&&He.nextSibling.dataset,Me)var Vt=Me.dgst;Me=Vt,O=Error(c(419)),O.stack="",O.digest=Me,Rh({value:O,source:null,stack:null}),_=aa(h,_,S)}else if(eo||Fs(h,_,S,!1),Me=(S&h.childLanes)!==0,eo||Me){if(Me=li,Me!==null){if(O=S&-S,(O&42)!==0)O=1;else switch(O){case 2:O=1;break;case 8:O=4;break;case 32:O=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:O=64;break;case 268435456:O=134217728;break;default:O=0}if(O=(O&(Me.suspendedLanes|S))!==0?0:O,O!==0&&O!==mt.retryLane)throw mt.retryLane=O,cs(h,O),ys(Me,h,O),hg}He.data==="$?"||vf(),_=aa(h,_,S)}else He.data==="$?"?(_.flags|=128,_.child=h.child,_=$_.bind(null,h),He._reactRetry=_,_=null):(h=mt.treeContext,Ka=rc(He.nextSibling),Kr=_,Ir=!0,Ko=null,Rs=!1,h!==null&&(Zo[Yo++]=fl,Zo[Yo++]=pl,Zo[Yo++]=Hl,fl=h.id,pl=h.overflow,Hl=_),_=ks(_,O.children),_.flags|=4096);return _}return G?(hs(),G=O.fallback,He=_.mode,mt=h.child,Vt=mt.sibling,O=dn(mt,{mode:"hidden",children:O.children}),O.subtreeFlags=mt.subtreeFlags&31457280,Vt!==null?G=dn(Vt,G):(G=rn(G,He,S,null),G.flags|=2),G.return=_,O.return=_,O.sibling=G,_.child=O,O=G,G=_.child,He=h.child.memoizedState,He===null?He=zp(S):(mt=He.cachePool,mt!==null?(Vt=ya._currentValue,mt=mt.parent!==Vt?{parent:Vt,pool:Vt}:mt):mt=Xl(),He={baseLanes:He.baseLanes|S,cachePool:mt}),G.memoizedState=He,G.childLanes=Bu(h,Me,S),_.memoizedState=Nu,O):(Fc(_),S=h.child,h=S.sibling,S=dn(S,{mode:"visible",children:O.children}),S.return=_,S.sibling=null,h!==null&&(Me=_.deletions,Me===null?(_.deletions=[h],_.flags|=16):Me.push(h)),_.child=S,_.memoizedState=null,S)}function ks(h,_){return _=Uu({mode:"visible",children:_},h.mode),_.return=h,h.child=_}function Uu(h,_){return mn(h,_,0,null)}function aa(h,_,S){return Jo(_,h.child,null,S),h=ks(_,_.pendingProps.children),h.flags|=2,_.memoizedState=null,h}function fs(h,_,S){h.lanes|=_;var O=h.alternate;O!==null&&(O.lanes|=_),tl(h.return,_,S)}function Kc(h,_,S,O,G){var te=h.memoizedState;te===null?h.memoizedState={isBackwards:_,rendering:null,renderingStartTime:0,last:O,tail:S,tailMode:G}:(te.isBackwards=_,te.rendering=null,te.renderingStartTime=0,te.last=O,te.tail=S,te.tailMode=G)}function Xh(h,_,S){var O=_.pendingProps,G=O.revealOrder,te=O.tail;if(za(h,_,O.children,S),O=Ja.current,(O&2)!==0)O=O&1|2,_.flags|=128;else{if(h!==null&&(h.flags&128)!==0)e:for(h=_.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&fs(h,S,_);else if(h.tag===19)fs(h,S,_);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===_)break e;for(;h.sibling===null;){if(h.return===null||h.return===_)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}O&=1}switch(Pe(Ja,O),G){case"forwards":for(S=_.child,G=null;S!==null;)h=S.alternate,h!==null&&Zd(h)===null&&(G=S),S=S.sibling;S=G,S===null?(G=_.child,_.child=null):(G=S.sibling,S.sibling=null),Kc(_,!1,G,S,te);break;case"backwards":for(S=null,G=_.child,_.child=null;G!==null;){if(h=G.alternate,h!==null&&Zd(h)===null){_.child=G;break}h=G.sibling,G.sibling=S,S=G,G=h}Kc(_,!0,S,null,te);break;case"together":Kc(_,!1,null,null,void 0);break;default:_.memoizedState=null}return _.child}function bl(h,_,S){if(h!==null&&(_.dependencies=h.dependencies),hr|=_.lanes,(S&_.childLanes)===0)if(h!==null){if(Fs(h,_,S,!1),(S&_.childLanes)===0)return null}else return null;if(h!==null&&_.child!==h.child)throw Error(c(153));if(_.child!==null){for(h=_.child,S=dn(h,h.pendingProps),_.child=S,S.return=_;h.sibling!==null;)h=h.sibling,S=S.sibling=dn(h,h.pendingProps),S.return=_;S.sibling=null}return _.child}function kp(h,_){return(h.lanes&_)!==0?!0:(h=h.dependencies,!!(h!==null&&wl(h)))}function pf(h,_,S){switch(_.tag){case 3:Fi(_,_.stateNode.containerInfo),es(_,ya,h.memoizedState.cache),Ch();break;case 27:case 5:bi(_);break;case 4:Fi(_,_.stateNode.containerInfo);break;case 10:es(_,_.type,_.memoizedProps.value);break;case 13:var O=_.memoizedState;if(O!==null)return O.dehydrated!==null?(Fc(_),_.flags|=128,null):(S&_.child.childLanes)!==0?ff(h,_,S):(Fc(_),h=bl(h,_,S),h!==null?h.sibling:null);Fc(_);break;case 19:var G=(h.flags&128)!==0;if(O=(S&_.childLanes)!==0,O||(Fs(h,_,S,!1),O=(S&_.childLanes)!==0),G){if(O)return Xh(h,_,S);_.flags|=128}if(G=_.memoizedState,G!==null&&(G.rendering=null,G.tail=null,G.lastEffect=null),Pe(Ja,Ja.current),O)break;return null;case 22:case 23:return _.lanes=0,dg(h,_,S);case 24:es(_,ya,h.memoizedState.cache)}return bl(h,_,S)}function Fp(h,_,S){if(h!==null)if(h.memoizedProps!==_.pendingProps)eo=!0;else{if(!kp(h,S)&&(_.flags&128)===0)return eo=!1,pf(h,_,S);eo=(h.flags&131072)!==0}else eo=!1,Ir&&(_.flags&1048576)!==0&&Ah(_,Th,_.index);switch(_.lanes=0,_.tag){case 16:e:{h=_.pendingProps;var O=_.elementType,G=O._init;if(O=G(O._payload),_.type=O,typeof O=="function")Pt(O)?(h=Ql(O,h),_.tag=1,_=V_(null,_,O,h,S)):(_.tag=0,_=Jr(null,_,O,h,S));else{if(O!=null){if(G=O.$$typeof,G===X){_.tag=11,_=Wh(null,_,O,h,S);break e}else if(G===j){_.tag=14,_=Bo(null,_,O,h,S);break e}}throw _=Ve(O)||O,Error(c(306,_,""))}}return _;case 0:return Jr(h,_,_.type,_.pendingProps,S);case 1:return O=_.type,G=Ql(O,_.pendingProps),V_(h,_,O,G,S);case 3:e:{if(Fi(_,_.stateNode.containerInfo),h===null)throw Error(c(387));var te=_.pendingProps;G=_.memoizedState,O=G.element,fo(h,_),wo(_,te,null,S);var Me=_.memoizedState;if(te=Me.cache,es(_,ya,te),te!==G.cache&&ps(_,[ya],S,!0),bo(),te=Me.element,G.isDehydrated)if(G={element:te,isDehydrated:!1,cache:Me.cache},_.updateQueue.baseState=G,_.memoizedState=G,_.flags&256){_=Op(h,_,te,S);break e}else if(te!==O){O=us(Error(c(424)),_),Rh(O),_=Op(h,_,te,S);break e}else for(Ka=rc(_.stateNode.containerInfo.firstChild),Kr=_,Ir=!0,Ko=null,Rs=!0,S=xp(_,null,te,S),_.child=S;S;)S.flags=S.flags&-3|4096,S=S.sibling;else{if(Ch(),te===O){_=bl(h,_,S);break e}za(h,_,te,S)}_=_.child}return _;case 26:return hf(h,_),h===null?(S=sx(_.type,null,_.pendingProps,null))?_.memoizedState=S:Ir||(S=_.type,h=_.pendingProps,O=Ef(qn.current).createElement(S),O[_e]=_,O[Te]=h,Po(O,S,h),vt(O),_.stateNode=O):_.memoizedState=sx(_.type,h.memoizedProps,_.pendingProps,h.memoizedState),null;case 27:return bi(_),h===null&&Ir&&(O=_.stateNode=ax(_.type,_.pendingProps,qn.current),Kr=_,Rs=!0,Ka=rc(O.firstChild)),O=_.pendingProps.children,h!==null||Ir?za(h,_,O,S):_.child=Jo(_,null,O,S),hf(h,_),_.child;case 5:return h===null&&Ir&&((G=O=Ka)&&(O=JE(O,_.type,_.pendingProps,Rs),O!==null?(_.stateNode=O,Kr=_,Ka=rc(O.firstChild),Rs=!1,G=!0):G=!1),G||ml(_)),bi(_),G=_.type,te=_.pendingProps,Me=h!==null?h.memoizedProps:null,O=te.children,bg(G,te)?O=null:Me!==null&&bg(G,Me)&&(_.flags|=32),_.memoizedState!==null&&(G=Ds(h,_,eg,null,null,S),Cf._currentValue=G),hf(h,_),za(h,_,O,S),_.child;case 6:return h===null&&Ir&&((h=S=Ka)&&(S=QE(S,_.pendingProps,Rs),S!==null?(_.stateNode=S,Kr=_,Ka=null,h=!0):h=!1),h||ml(_)),null;case 13:return ff(h,_,S);case 4:return Fi(_,_.stateNode.containerInfo),O=_.pendingProps,h===null?_.child=Jo(_,null,O,S):za(h,_,O,S),_.child;case 11:return Wh(h,_,_.type,_.pendingProps,S);case 7:return za(h,_,_.pendingProps,S),_.child;case 8:return za(h,_,_.pendingProps.children,S),_.child;case 12:return za(h,_,_.pendingProps.children,S),_.child;case 10:return O=_.pendingProps,es(_,_.type,O.value),za(h,_,O.children,S),_.child;case 9:return G=_.type._context,O=_.pendingProps.children,ts(_),G=Co(G),O=O(G),_.flags|=1,za(h,_,O,S),_.child;case 14:return Bo(h,_,_.type,_.pendingProps,S);case 15:return $h(h,_,_.type,_.pendingProps,S);case 19:return Xh(h,_,S);case 22:return dg(h,_,S);case 24:return ts(_),O=Co(ya),h===null?(G=Kd(),G===null&&(G=li,te=Lh(),G.pooledCache=te,te.refCount++,te!==null&&(G.pooledCacheLanes|=S),G=te),_.memoizedState={parent:O,cache:G},Bp(_),es(_,ya,G)):((h.lanes&S)!==0&&(fo(h,_),wo(_,null,null,S),bo()),G=h.memoizedState,te=_.memoizedState,G.parent!==O?(G={parent:O,cache:O},_.memoizedState=G,_.lanes===0&&(_.memoizedState=_.updateQueue.baseState=G),es(_,ya,O)):(O=te.cache,es(_,ya,O),O!==G.cache&&ps(_,[ya],S,!0))),za(h,_,_.pendingProps.children,S),_.child;case 29:throw _.pendingProps}throw Error(c(156,_.tag))}var fg=pn(null),ec=null,el=null;function es(h,_,S){Pe(fg,_._currentValue),_._currentValue=S}function Uo(h){h._currentValue=fg.current,jn(fg)}function tl(h,_,S){for(;h!==null;){var O=h.alternate;if((h.childLanes&_)!==_?(h.childLanes|=_,O!==null&&(O.childLanes|=_)):O!==null&&(O.childLanes&_)!==_&&(O.childLanes|=_),h===S)break;h=h.return}}function ps(h,_,S,O){var G=h.child;for(G!==null&&(G.return=h);G!==null;){var te=G.dependencies;if(te!==null){var Me=G.child;te=te.firstContext;e:for(;te!==null;){var He=te;te=G;for(var mt=0;mt<_.length;mt++)if(He.context===_[mt]){te.lanes|=S,He=te.alternate,He!==null&&(He.lanes|=S),tl(te.return,S,h),O||(Me=null);break e}te=He.next}}else if(G.tag===18){if(Me=G.return,Me===null)throw Error(c(341));Me.lanes|=S,te=Me.alternate,te!==null&&(te.lanes|=S),tl(Me,S,h),Me=null}else Me=G.child;if(Me!==null)Me.return=G;else for(Me=G;Me!==null;){if(Me===h){Me=null;break}if(G=Me.sibling,G!==null){G.return=Me.return,Me=G;break}Me=Me.return}G=Me}}function Fs(h,_,S,O){h=null;for(var G=_,te=!1;G!==null;){if(!te){if((G.flags&524288)!==0)te=!0;else if((G.flags&262144)!==0)break}if(G.tag===10){var Me=G.alternate;if(Me===null)throw Error(c(387));if(Me=Me.memoizedProps,Me!==null){var He=G.type;Ya(G.pendingProps.value,Me.value)||(h!==null?h.push(He):h=[He])}}else if(G===ke.current){if(Me=G.alternate,Me===null)throw Error(c(387));Me.memoizedState.memoizedState!==G.memoizedState.memoizedState&&(h!==null?h.push(Cf):h=[Cf])}G=G.return}h!==null&&ps(_,h,S,O),_.flags|=262144}function wl(h){for(h=h.firstContext;h!==null;){if(!Ya(h.context._currentValue,h.memoizedValue))return!0;h=h.next}return!1}function ts(h){ec=h,el=null,h=h.dependencies,h!==null&&(h.firstContext=null)}function Co(h){return j_(ec,h)}function Np(h,_){return ec===null&&ts(h),j_(h,_)}function j_(h,_){var S=_._currentValue;if(_={context:_,memoizedValue:S,next:null},el===null){if(h===null)throw Error(c(308));el=_,h.dependencies={lanes:0,firstContext:_},h.flags|=524288}else el=el.next=_;return S}var nl=!1;function Bp(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function fo(h,_){h=h.updateQueue,_.updateQueue===h&&(_.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,callbacks:null})}function ms(h){return{lane:h,tag:0,payload:null,callback:null,next:null}}function tc(h,_,S){var O=h.updateQueue;if(O===null)return null;if(O=O.shared,(Rn&2)!==0){var G=O.pending;return G===null?_.next=_:(_.next=G.next,G.next=_),O.pending=_,_=Wi(h),Lc(h,null,S),_}return wu(h,O,_,S),Wi(h)}function Zh(h,_,S){if(_=_.updateQueue,_!==null&&(_=_.shared,(S&4194176)!==0)){var O=_.lanes;O&=h.pendingLanes,S|=O,_.lanes=S,$o(h,S)}}function Jc(h,_){var S=h.updateQueue,O=h.alternate;if(O!==null&&(O=O.updateQueue,S===O)){var G=null,te=null;if(S=S.firstBaseUpdate,S!==null){do{var Me={lane:S.lane,tag:S.tag,payload:S.payload,callback:null,next:null};te===null?G=te=Me:te=te.next=Me,S=S.next}while(S!==null);te===null?G=te=_:te=te.next=_}else G=te=_;S={baseState:O.baseState,firstBaseUpdate:G,lastBaseUpdate:te,shared:O.shared,callbacks:O.callbacks},h.updateQueue=S;return}h=S.lastBaseUpdate,h===null?S.firstBaseUpdate=_:h.next=_,S.lastBaseUpdate=_}var Yh=!1;function bo(){if(Yh){var h=Nc;if(h!==null)throw h}}function wo(h,_,S,O){Yh=!1;var G=h.updateQueue;nl=!1;var te=G.firstBaseUpdate,Me=G.lastBaseUpdate,He=G.shared.pending;if(He!==null){G.shared.pending=null;var mt=He,Vt=mt.next;mt.next=null,Me===null?te=Vt:Me.next=Vt,Me=mt;var Sn=h.alternate;Sn!==null&&(Sn=Sn.updateQueue,He=Sn.lastBaseUpdate,He!==Me&&(He===null?Sn.firstBaseUpdate=Vt:He.next=Vt,Sn.lastBaseUpdate=mt))}if(te!==null){var Fn=G.baseState;Me=0,Sn=Vt=mt=null,He=te;do{var sn=He.lane&-536870913,bn=sn!==He.lane;if(bn?(hi&sn)===sn:(O&sn)===sn){sn!==0&&sn===_l&&(Yh=!0),Sn!==null&&(Sn=Sn.next={lane:0,tag:He.tag,payload:He.payload,callback:null,next:null});e:{var Oi=h,dr=He;sn=_;var ka=S;switch(dr.tag){case 1:if(Oi=dr.payload,typeof Oi=="function"){Fn=Oi.call(ka,Fn,sn);break e}Fn=Oi;break e;case 3:Oi.flags=Oi.flags&-65537|128;case 0:if(Oi=dr.payload,sn=typeof Oi=="function"?Oi.call(ka,Fn,sn):Oi,sn==null)break e;Fn=xe({},Fn,sn);break e;case 2:nl=!0}}sn=He.callback,sn!==null&&(h.flags|=64,bn&&(h.flags|=8192),bn=G.callbacks,bn===null?G.callbacks=[sn]:bn.push(sn))}else bn={lane:sn,tag:He.tag,payload:He.payload,callback:He.callback,next:null},Sn===null?(Vt=Sn=bn,mt=Fn):Sn=Sn.next=bn,Me|=sn;if(He=He.next,He===null){if(He=G.shared.pending,He===null)break;bn=He,He=bn.next,bn.next=null,G.lastBaseUpdate=bn,G.shared.pending=null}}while(!0);Sn===null&&(mt=Fn),G.baseState=mt,G.firstBaseUpdate=Vt,G.lastBaseUpdate=Sn,te===null&&(G.shared.lanes=0),hr|=Me,h.lanes=Me,h.memoizedState=Fn}}function Vu(h,_){if(typeof h!="function")throw Error(c(191,h));h.call(_)}function Qc(h,_){var S=h.callbacks;if(S!==null)for(h.callbacks=null,h=0;h<S.length;h++)Vu(S[h],_)}function il(h,_){try{var S=_.updateQueue,O=S!==null?S.lastEffect:null;if(O!==null){var G=O.next;S=G;do{if((S.tag&h)===h){O=void 0;var te=S.create,Me=S.inst;O=te(),Me.destroy=O}S=S.next}while(S!==G)}}catch(He){da(_,_.return,He)}}function Sl(h,_,S){try{var O=_.updateQueue,G=O!==null?O.lastEffect:null;if(G!==null){var te=G.next;O=te;do{if((O.tag&h)===h){var Me=O.inst,He=Me.destroy;if(He!==void 0){Me.destroy=void 0,G=_;var mt=S;try{He()}catch(Vt){da(G,mt,Vt)}}}O=O.next}while(O!==te)}}catch(Vt){da(_,_.return,Vt)}}function Ji(h){var _=h.updateQueue;if(_!==null){var S=h.stateNode;try{Qc(_,S)}catch(O){da(h,h.return,O)}}}function nc(h,_,S){S.props=Ql(h.type,h.memoizedProps),S.state=h.memoizedState;try{S.componentWillUnmount()}catch(O){da(h,_,O)}}function ju(h,_){try{var S=h.ref;if(S!==null){var O=h.stateNode;switch(h.tag){case 26:case 27:case 5:var G=O;break;default:G=O}typeof S=="function"?h.refCleanup=S(G):S.current=G}}catch(te){da(h,_,te)}}function gs(h,_){var S=h.ref,O=h.refCleanup;if(S!==null)if(typeof O=="function")try{O()}catch(G){da(h,_,G)}finally{h.refCleanup=null,h=h.alternate,h!=null&&(h.refCleanup=null)}else if(typeof S=="function")try{S(null)}catch(G){da(h,_,G)}else S.current=null}function mf(h){var _=h.type,S=h.memoizedProps,O=h.stateNode;try{e:switch(_){case"button":case"input":case"select":case"textarea":S.autoFocus&&O.focus();break e;case"img":S.src?O.src=S.src:S.srcSet&&(O.srcset=S.srcSet)}}catch(G){da(h,h.return,G)}}function rl(h,_,S){try{var O=h.stateNode;Ab(O,h.type,S,_),O[Te]=_}catch(G){da(h,h.return,G)}}function Ns(h){return h.tag===5||h.tag===3||h.tag===26||h.tag===27||h.tag===4}function po(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||Ns(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==27&&h.tag!==18;){if(h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function Ro(h,_,S){var O=h.tag;if(O===5||O===6)h=h.stateNode,_?S.nodeType===8?S.parentNode.insertBefore(h,_):S.insertBefore(h,_):(S.nodeType===8?(_=S.parentNode,_.insertBefore(h,S)):(_=S,_.appendChild(h)),S=S._reactRootContainer,S!=null||_.onclick!==null||(_.onclick=ru));else if(O!==4&&O!==27&&(h=h.child,h!==null))for(Ro(h,_,S),h=h.sibling;h!==null;)Ro(h,_,S),h=h.sibling}function Ra(h,_,S){var O=h.tag;if(O===5||O===6)h=h.stateNode,_?S.insertBefore(h,_):S.appendChild(h);else if(O!==4&&O!==27&&(h=h.child,h!==null))for(Ra(h,_,S),h=h.sibling;h!==null;)Ra(h,_,S),h=h.sibling}var El=!1,Mr=!1,gf=!1,Gu=typeof WeakSet=="function"?WeakSet:Set,f=null,i=!1;function s(h,_){if(h=h.containerInfo,qp=Cg,h=dp(h),$m(h)){if("selectionStart"in h)var S={start:h.selectionStart,end:h.selectionEnd};else e:{S=(S=h.ownerDocument)&&S.defaultView||window;var O=S.getSelection&&S.getSelection();if(O&&O.rangeCount!==0){S=O.anchorNode;var G=O.anchorOffset,te=O.focusNode;O=O.focusOffset;try{S.nodeType,te.nodeType}catch{S=null;break e}var Me=0,He=-1,mt=-1,Vt=0,Sn=0,Fn=h,sn=null;t:for(;;){for(var bn;Fn!==S||G!==0&&Fn.nodeType!==3||(He=Me+G),Fn!==te||O!==0&&Fn.nodeType!==3||(mt=Me+O),Fn.nodeType===3&&(Me+=Fn.nodeValue.length),(bn=Fn.firstChild)!==null;)sn=Fn,Fn=bn;for(;;){if(Fn===h)break t;if(sn===S&&++Vt===G&&(He=Me),sn===te&&++Sn===O&&(mt=Me),(bn=Fn.nextSibling)!==null)break;Fn=sn,sn=Fn.parentNode}Fn=bn}S=He===-1||mt===-1?null:{start:He,end:mt}}else S=null}S=S||{start:0,end:0}}else S=null;for(rv={focusedElem:h,selectionRange:S},Cg=!1,f=_;f!==null;)if(_=f,h=_.child,(_.subtreeFlags&1028)!==0&&h!==null)h.return=_,f=h;else for(;f!==null;){switch(_=f,te=_.alternate,h=_.flags,_.tag){case 0:break;case 11:case 15:break;case 1:if((h&1024)!==0&&te!==null){h=void 0,S=_,G=te.memoizedProps,te=te.memoizedState,O=S.stateNode;try{var Oi=Ql(S.type,G,S.elementType===S.type);h=O.getSnapshotBeforeUpdate(Oi,te),O.__reactInternalSnapshotBeforeUpdate=h}catch(dr){da(S,S.return,dr)}}break;case 3:if((h&1024)!==0){if(h=_.stateNode.containerInfo,S=h.nodeType,S===9)wg(h);else if(S===1)switch(h.nodeName){case"HEAD":case"HTML":case"BODY":wg(h);break;default:h.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((h&1024)!==0)throw Error(c(163))}if(h=_.sibling,h!==null){h.return=_.return,f=h;break}f=_.return}return Oi=i,i=!1,Oi}function m(h,_,S){var O=S.flags;switch(S.tag){case 0:case 11:case 15:ge(h,S),O&4&&il(5,S);break;case 1:if(ge(h,S),O&4)if(h=S.stateNode,_===null)try{h.componentDidMount()}catch(He){da(S,S.return,He)}else{var G=Ql(S.type,_.memoizedProps);_=_.memoizedState;try{h.componentDidUpdate(G,_,h.__reactInternalSnapshotBeforeUpdate)}catch(He){da(S,S.return,He)}}O&64&&Ji(S),O&512&&ju(S,S.return);break;case 3:if(ge(h,S),O&64&&(O=S.updateQueue,O!==null)){if(h=null,S.child!==null)switch(S.child.tag){case 27:case 5:h=S.child.stateNode;break;case 1:h=S.child.stateNode}try{Qc(O,h)}catch(He){da(S,S.return,He)}}break;case 26:ge(h,S),O&512&&ju(S,S.return);break;case 27:case 5:ge(h,S),_===null&&O&4&&mf(S),O&512&&ju(S,S.return);break;case 12:ge(h,S);break;case 13:ge(h,S),O&4&&V(h,S);break;case 22:if(G=S.memoizedState!==null||El,!G){_=_!==null&&_.memoizedState!==null||Mr;var te=El,Me=Mr;El=G,(Mr=_)&&!Me?ze(h,S,(S.subtreeFlags&8772)!==0):ge(h,S),El=te,Mr=Me}O&512&&(S.memoizedProps.mode==="manual"?ju(S,S.return):gs(S,S.return));break;default:ge(h,S)}}function x(h){var _=h.alternate;_!==null&&(h.alternate=null,x(_)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(_=h.stateNode,_!==null&&wt(_)),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}var b=null,T=!1;function P(h,_,S){for(S=S.child;S!==null;)N(h,_,S),S=S.sibling}function N(h,_,S){if(_i&&typeof _i.onCommitFiberUnmount=="function")try{_i.onCommitFiberUnmount(ci,S)}catch{}switch(S.tag){case 26:Mr||gs(S,_),P(h,_,S),S.memoizedState?S.memoizedState.count--:S.stateNode&&(S=S.stateNode,S.parentNode.removeChild(S));break;case 27:Mr||gs(S,_);var O=b,G=T;for(b=S.stateNode,P(h,_,S),S=S.stateNode,_=S.attributes;_.length;)S.removeAttributeNode(_[0]);wt(S),b=O,T=G;break;case 5:Mr||gs(S,_);case 6:G=b;var te=T;if(b=null,P(h,_,S),b=G,T=te,b!==null)if(T)try{h=b,O=S.stateNode,h.nodeType===8?h.parentNode.removeChild(O):h.removeChild(O)}catch(Me){da(S,_,Me)}else try{b.removeChild(S.stateNode)}catch(Me){da(S,_,Me)}break;case 18:b!==null&&(T?(_=b,S=S.stateNode,_.nodeType===8?sv(_.parentNode,S):_.nodeType===1&&sv(_,S),Dg(_)):sv(b,S.stateNode));break;case 4:O=b,G=T,b=S.stateNode.containerInfo,T=!0,P(h,_,S),b=O,T=G;break;case 0:case 11:case 14:case 15:Mr||Sl(2,S,_),Mr||Sl(4,S,_),P(h,_,S);break;case 1:Mr||(gs(S,_),O=S.stateNode,typeof O.componentWillUnmount=="function"&&nc(S,_,O)),P(h,_,S);break;case 21:P(h,_,S);break;case 22:Mr||gs(S,_),Mr=(O=Mr)||S.memoizedState!==null,P(h,_,S),Mr=O;break;default:P(h,_,S)}}function V(h,_){if(_.memoizedState===null&&(h=_.alternate,h!==null&&(h=h.memoizedState,h!==null&&(h=h.dehydrated,h!==null))))try{Dg(h)}catch(S){da(_,_.return,S)}}function q(h){switch(h.tag){case 13:case 19:var _=h.stateNode;return _===null&&(_=h.stateNode=new Gu),_;case 22:return h=h.stateNode,_=h._retryCache,_===null&&(_=h._retryCache=new Gu),_;default:throw Error(c(435,h.tag))}}function Z(h,_){var S=q(h);_.forEach(function(O){var G=bb.bind(null,h,O);S.has(O)||(S.add(O),O.then(G,G))})}function K(h,_){var S=_.deletions;if(S!==null)for(var O=0;O<S.length;O++){var G=S[O],te=h,Me=_,He=Me;e:for(;He!==null;){switch(He.tag){case 27:case 5:b=He.stateNode,T=!1;break e;case 3:b=He.stateNode.containerInfo,T=!0;break e;case 4:b=He.stateNode.containerInfo,T=!0;break e}He=He.return}if(b===null)throw Error(c(160));N(te,Me,G),b=null,T=!1,te=G.alternate,te!==null&&(te.return=null),G.return=null}if(_.subtreeFlags&13878)for(_=_.child;_!==null;)fe(_,h),_=_.sibling}var ne=null;function fe(h,_){var S=h.alternate,O=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:K(_,h),ue(h),O&4&&(Sl(3,h,h.return),il(3,h),Sl(5,h,h.return));break;case 1:K(_,h),ue(h),O&512&&(Mr||S===null||gs(S,S.return)),O&64&&El&&(h=h.updateQueue,h!==null&&(O=h.callbacks,O!==null&&(S=h.shared.hiddenCallbacks,h.shared.hiddenCallbacks=S===null?O:S.concat(O))));break;case 26:var G=ne;if(K(_,h),ue(h),O&512&&(Mr||S===null||gs(S,S.return)),O&4){var te=S!==null?S.memoizedState:null;if(O=h.memoizedState,S===null)if(O===null)if(h.stateNode===null){e:{O=h.type,S=h.memoizedProps,G=G.ownerDocument||G;t:switch(O){case"title":te=G.getElementsByTagName("title")[0],(!te||te[St]||te[_e]||te.namespaceURI==="http://www.w3.org/2000/svg"||te.hasAttribute("itemprop"))&&(te=G.createElement(O),G.head.insertBefore(te,G.querySelector("head > title"))),Po(te,O,S),te[_e]=h,vt(te),O=te;break e;case"link":var Me=cx("link","href",G).get(O+(S.href||""));if(Me){for(var He=0;He<Me.length;He++)if(te=Me[He],te.getAttribute("href")===(S.href==null?null:S.href)&&te.getAttribute("rel")===(S.rel==null?null:S.rel)&&te.getAttribute("title")===(S.title==null?null:S.title)&&te.getAttribute("crossorigin")===(S.crossOrigin==null?null:S.crossOrigin)){Me.splice(He,1);break t}}te=G.createElement(O),Po(te,O,S),G.head.appendChild(te);break;case"meta":if(Me=cx("meta","content",G).get(O+(S.content||""))){for(He=0;He<Me.length;He++)if(te=Me[He],te.getAttribute("content")===(S.content==null?null:""+S.content)&&te.getAttribute("name")===(S.name==null?null:S.name)&&te.getAttribute("property")===(S.property==null?null:S.property)&&te.getAttribute("http-equiv")===(S.httpEquiv==null?null:S.httpEquiv)&&te.getAttribute("charset")===(S.charSet==null?null:S.charSet)){Me.splice(He,1);break t}}te=G.createElement(O),Po(te,O,S),G.head.appendChild(te);break;default:throw Error(c(468,O))}te[_e]=h,vt(te),O=te}h.stateNode=O}else Fb(G,h.type,h.stateNode);else h.stateNode=kb(G,O,h.memoizedProps);else te!==O?(te===null?S.stateNode!==null&&(S=S.stateNode,S.parentNode.removeChild(S)):te.count--,O===null?Fb(G,h.type,h.stateNode):kb(G,O,h.memoizedProps)):O===null&&h.stateNode!==null&&rl(h,h.memoizedProps,S.memoizedProps)}break;case 27:if(O&4&&h.alternate===null){G=h.stateNode,te=h.memoizedProps;try{for(var mt=G.firstChild;mt;){var Vt=mt.nextSibling,Sn=mt.nodeName;mt[St]||Sn==="HEAD"||Sn==="BODY"||Sn==="SCRIPT"||Sn==="STYLE"||Sn==="LINK"&&mt.rel.toLowerCase()==="stylesheet"||G.removeChild(mt),mt=Vt}for(var Fn=h.type,sn=G.attributes;sn.length;)G.removeAttributeNode(sn[0]);Po(G,Fn,te),G[_e]=h,G[Te]=te}catch(Oi){da(h,h.return,Oi)}}case 5:if(K(_,h),ue(h),O&512&&(Mr||S===null||gs(S,S.return)),h.flags&32){G=h.stateNode;try{yo(G,"")}catch(Oi){da(h,h.return,Oi)}}O&4&&h.stateNode!=null&&(G=h.memoizedProps,rl(h,G,S!==null?S.memoizedProps:G)),O&1024&&(gf=!0);break;case 6:if(K(_,h),ue(h),O&4){if(h.stateNode===null)throw Error(c(162));O=h.memoizedProps,S=h.stateNode;try{S.nodeValue=O}catch(Oi){da(h,h.return,Oi)}}break;case 3:if(Mg=null,G=ne,ne=ed(_.containerInfo),K(_,h),ne=G,ue(h),O&4&&S!==null&&S.memoizedState.isDehydrated)try{Dg(_.containerInfo)}catch(Oi){da(h,h.return,Oi)}gf&&(gf=!1,ve(h));break;case 4:O=ne,ne=ed(h.stateNode.containerInfo),K(_,h),ue(h),ne=O;break;case 12:K(_,h),ue(h);break;case 13:K(_,h),ue(h),h.child.flags&8192&&h.memoizedState!==null!=(S!==null&&S.memoizedState!==null)&&(Io=gt()),O&4&&(O=h.updateQueue,O!==null&&(h.updateQueue=null,Z(h,O)));break;case 22:if(O&512&&(Mr||S===null||gs(S,S.return)),mt=h.memoizedState!==null,Vt=S!==null&&S.memoizedState!==null,Sn=El,Fn=Mr,El=Sn||mt,Mr=Fn||Vt,K(_,h),Mr=Fn,El=Sn,ue(h),_=h.stateNode,_._current=h,_._visibility&=-3,_._visibility|=_._pendingVisibility&2,O&8192&&(_._visibility=mt?_._visibility&-2:_._visibility|1,mt&&(_=El||Mr,S===null||Vt||_||Ce(h)),h.memoizedProps===null||h.memoizedProps.mode!=="manual"))e:for(S=null,_=h;;){if(_.tag===5||_.tag===26||_.tag===27){if(S===null){Vt=S=_;try{if(G=Vt.stateNode,mt)te=G.style,typeof te.setProperty=="function"?te.setProperty("display","none","important"):te.display="none";else{Me=Vt.stateNode,He=Vt.memoizedProps.style;var bn=He!=null&&He.hasOwnProperty("display")?He.display:null;Me.style.display=bn==null||typeof bn=="boolean"?"":(""+bn).trim()}}catch(Oi){da(Vt,Vt.return,Oi)}}}else if(_.tag===6){if(S===null){Vt=_;try{Vt.stateNode.nodeValue=mt?"":Vt.memoizedProps}catch(Oi){da(Vt,Vt.return,Oi)}}}else if((_.tag!==22&&_.tag!==23||_.memoizedState===null||_===h)&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===h)break e;for(;_.sibling===null;){if(_.return===null||_.return===h)break e;S===_&&(S=null),_=_.return}S===_&&(S=null),_.sibling.return=_.return,_=_.sibling}O&4&&(O=h.updateQueue,O!==null&&(S=O.retryQueue,S!==null&&(O.retryQueue=null,Z(h,S))));break;case 19:K(_,h),ue(h),O&4&&(O=h.updateQueue,O!==null&&(h.updateQueue=null,Z(h,O)));break;case 21:break;default:K(_,h),ue(h)}}function ue(h){var _=h.flags;if(_&2){try{if(h.tag!==27){e:{for(var S=h.return;S!==null;){if(Ns(S)){var O=S;break e}S=S.return}throw Error(c(160))}switch(O.tag){case 27:var G=O.stateNode,te=po(h);Ra(h,te,G);break;case 5:var Me=O.stateNode;O.flags&32&&(yo(Me,""),O.flags&=-33);var He=po(h);Ra(h,He,Me);break;case 3:case 4:var mt=O.stateNode.containerInfo,Vt=po(h);Ro(h,Vt,mt);break;default:throw Error(c(161))}}}catch(Sn){da(h,h.return,Sn)}h.flags&=-3}_&4096&&(h.flags&=-4097)}function ve(h){if(h.subtreeFlags&1024)for(h=h.child;h!==null;){var _=h;ve(_),_.tag===5&&_.flags&1024&&_.stateNode.reset(),h=h.sibling}}function ge(h,_){if(_.subtreeFlags&8772)for(_=_.child;_!==null;)m(h,_.alternate,_),_=_.sibling}function Ce(h){for(h=h.child;h!==null;){var _=h;switch(_.tag){case 0:case 11:case 14:case 15:Sl(4,_,_.return),Ce(_);break;case 1:gs(_,_.return);var S=_.stateNode;typeof S.componentWillUnmount=="function"&&nc(_,_.return,S),Ce(_);break;case 26:case 27:case 5:gs(_,_.return),Ce(_);break;case 22:gs(_,_.return),_.memoizedState===null&&Ce(_);break;default:Ce(_)}h=h.sibling}}function ze(h,_,S){for(S=S&&(_.subtreeFlags&8772)!==0,_=_.child;_!==null;){var O=_.alternate,G=h,te=_,Me=te.flags;switch(te.tag){case 0:case 11:case 15:ze(G,te,S),il(4,te);break;case 1:if(ze(G,te,S),O=te,G=O.stateNode,typeof G.componentDidMount=="function")try{G.componentDidMount()}catch(Vt){da(O,O.return,Vt)}if(O=te,G=O.updateQueue,G!==null){var He=O.stateNode;try{var mt=G.shared.hiddenCallbacks;if(mt!==null)for(G.shared.hiddenCallbacks=null,G=0;G<mt.length;G++)Vu(mt[G],He)}catch(Vt){da(O,O.return,Vt)}}S&&Me&64&&Ji(te),ju(te,te.return);break;case 26:case 27:case 5:ze(G,te,S),S&&O===null&&Me&4&&mf(te),ju(te,te.return);break;case 12:ze(G,te,S);break;case 13:ze(G,te,S),S&&Me&4&&V(G,te);break;case 22:te.memoizedState===null&&ze(G,te,S),ju(te,te.return);break;default:ze(G,te,S)}_=_.sibling}}function Le(h,_){var S=null;h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(S=h.memoizedState.cachePool.pool),h=null,_.memoizedState!==null&&_.memoizedState.cachePool!==null&&(h=_.memoizedState.cachePool.pool),h!==S&&(h!=null&&h.refCount++,S!=null&&$l(S))}function qe(h,_){h=null,_.alternate!==null&&(h=_.alternate.memoizedState.cache),_=_.memoizedState.cache,_!==h&&(_.refCount++,h!=null&&$l(h))}function Ne(h,_,S,O){if(_.subtreeFlags&10256)for(_=_.child;_!==null;)Ge(h,_,S,O),_=_.sibling}function Ge(h,_,S,O){var G=_.flags;switch(_.tag){case 0:case 11:case 15:Ne(h,_,S,O),G&2048&&il(9,_);break;case 3:Ne(h,_,S,O),G&2048&&(h=null,_.alternate!==null&&(h=_.alternate.memoizedState.cache),_=_.memoizedState.cache,_!==h&&(_.refCount++,h!=null&&$l(h)));break;case 12:if(G&2048){Ne(h,_,S,O),h=_.stateNode;try{var te=_.memoizedProps,Me=te.id,He=te.onPostCommit;typeof He=="function"&&He(Me,_.alternate===null?"mount":"update",h.passiveEffectDuration,-0)}catch(mt){da(_,_.return,mt)}}else Ne(h,_,S,O);break;case 23:break;case 22:te=_.stateNode,_.memoizedState!==null?te._visibility&4?Ne(h,_,S,O):Ke(h,_):te._visibility&4?Ne(h,_,S,O):(te._visibility|=4,Be(h,_,S,O,(_.subtreeFlags&10256)!==0)),G&2048&&Le(_.alternate,_);break;case 24:Ne(h,_,S,O),G&2048&&qe(_.alternate,_);break;default:Ne(h,_,S,O)}}function Be(h,_,S,O,G){for(G=G&&(_.subtreeFlags&10256)!==0,_=_.child;_!==null;){var te=h,Me=_,He=S,mt=O,Vt=Me.flags;switch(Me.tag){case 0:case 11:case 15:Be(te,Me,He,mt,G),il(8,Me);break;case 23:break;case 22:var Sn=Me.stateNode;Me.memoizedState!==null?Sn._visibility&4?Be(te,Me,He,mt,G):Ke(te,Me):(Sn._visibility|=4,Be(te,Me,He,mt,G)),G&&Vt&2048&&Le(Me.alternate,Me);break;case 24:Be(te,Me,He,mt,G),G&&Vt&2048&&qe(Me.alternate,Me);break;default:Be(te,Me,He,mt,G)}_=_.sibling}}function Ke(h,_){if(_.subtreeFlags&10256)for(_=_.child;_!==null;){var S=h,O=_,G=O.flags;switch(O.tag){case 22:Ke(S,O),G&2048&&Le(O.alternate,O);break;case 24:Ke(S,O),G&2048&&qe(O.alternate,O);break;default:Ke(S,O)}_=_.sibling}}var it=8192;function Rt(h){if(h.subtreeFlags&it)for(h=h.child;h!==null;)xt(h),h=h.sibling}function xt(h){switch(h.tag){case 26:Rt(h),h.flags&it&&h.memoizedState!==null&&aM(ne,h.memoizedState,h.memoizedProps);break;case 5:Rt(h);break;case 3:case 4:var _=ne;ne=ed(h.stateNode.containerInfo),Rt(h),ne=_;break;case 22:h.memoizedState===null&&(_=h.alternate,_!==null&&_.memoizedState!==null?(_=it,it=16777216,Rt(h),it=_):Rt(h));break;default:Rt(h)}}function jt(h){var _=h.alternate;if(_!==null&&(h=_.child,h!==null)){_.child=null;do _=h.sibling,h.sibling=null,h=_;while(h!==null)}}function zt(h){var _=h.deletions;if((h.flags&16)!==0){if(_!==null)for(var S=0;S<_.length;S++){var O=_[S];f=O,tn(O,h)}jt(h)}if(h.subtreeFlags&10256)for(h=h.child;h!==null;)pt(h),h=h.sibling}function pt(h){switch(h.tag){case 0:case 11:case 15:zt(h),h.flags&2048&&Sl(9,h,h.return);break;case 3:zt(h);break;case 12:zt(h);break;case 22:var _=h.stateNode;h.memoizedState!==null&&_._visibility&4&&(h.return===null||h.return.tag!==13)?(_._visibility&=-5,Dt(h)):zt(h);break;default:zt(h)}}function Dt(h){var _=h.deletions;if((h.flags&16)!==0){if(_!==null)for(var S=0;S<_.length;S++){var O=_[S];f=O,tn(O,h)}jt(h)}for(h=h.child;h!==null;){switch(_=h,_.tag){case 0:case 11:case 15:Sl(8,_,_.return),Dt(_);break;case 22:S=_.stateNode,S._visibility&4&&(S._visibility&=-5,Dt(_));break;default:Dt(_)}h=h.sibling}}function tn(h,_){for(;f!==null;){var S=f;switch(S.tag){case 0:case 11:case 15:Sl(8,S,_);break;case 23:case 22:if(S.memoizedState!==null&&S.memoizedState.cachePool!==null){var O=S.memoizedState.cachePool.pool;O!=null&&O.refCount++}break;case 24:$l(S.memoizedState.cache)}if(O=S.child,O!==null)O.return=S,f=O;else e:for(S=h;f!==null;){O=f;var G=O.sibling,te=O.return;if(x(O),O===S){f=null;break e}if(G!==null){G.return=te,f=G;break e}f=te}}}function dt(h,_,S,O){this.tag=h,this.key=S,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=_,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=O,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ut(h,_,S,O){return new dt(h,_,S,O)}function Pt(h){return h=h.prototype,!(!h||!h.isReactComponent)}function dn(h,_){var S=h.alternate;return S===null?(S=Ut(h.tag,_,h.key,h.mode),S.elementType=h.elementType,S.type=h.type,S.stateNode=h.stateNode,S.alternate=h,h.alternate=S):(S.pendingProps=_,S.type=h.type,S.flags=0,S.subtreeFlags=0,S.deletions=null),S.flags=h.flags&31457280,S.childLanes=h.childLanes,S.lanes=h.lanes,S.child=h.child,S.memoizedProps=h.memoizedProps,S.memoizedState=h.memoizedState,S.updateQueue=h.updateQueue,_=h.dependencies,S.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext},S.sibling=h.sibling,S.index=h.index,S.ref=h.ref,S.refCleanup=h.refCleanup,S}function Zt(h,_){h.flags&=31457282;var S=h.alternate;return S===null?(h.childLanes=0,h.lanes=_,h.child=null,h.subtreeFlags=0,h.memoizedProps=null,h.memoizedState=null,h.updateQueue=null,h.dependencies=null,h.stateNode=null):(h.childLanes=S.childLanes,h.lanes=S.lanes,h.child=S.child,h.subtreeFlags=0,h.deletions=null,h.memoizedProps=S.memoizedProps,h.memoizedState=S.memoizedState,h.updateQueue=S.updateQueue,h.type=S.type,_=S.dependencies,h.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext}),h}function Gt(h,_,S,O,G,te){var Me=0;if(O=h,typeof h=="function")Pt(h)&&(Me=1);else if(typeof h=="string")Me=iM(h,S,Gn.current)?26:h==="html"||h==="head"||h==="body"?27:5;else e:switch(h){case I:return rn(S.children,G,te,_);case k:Me=8,G|=24;break;case B:return h=Ut(12,S,_,G|2),h.elementType=B,h.lanes=te,h;case Q:return h=Ut(13,S,_,G),h.elementType=Q,h.lanes=te,h;case J:return h=Ut(19,S,_,G),h.elementType=J,h.lanes=te,h;case ce:return mn(S,G,te,_);default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case U:case Y:Me=10;break e;case H:Me=9;break e;case X:Me=11;break e;case j:Me=14;break e;case oe:Me=16,O=null;break e}Me=29,S=Error(c(130,h===null?"null":typeof h,"")),O=null}return _=Ut(Me,S,_,G),_.elementType=h,_.type=O,_.lanes=te,_}function rn(h,_,S,O){return h=Ut(7,h,O,_),h.lanes=S,h}function mn(h,_,S,O){h=Ut(22,h,O,_),h.elementType=ce,h.lanes=S;var G={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var te=G._current;if(te===null)throw Error(c(456));if((G._pendingVisibility&2)===0){var Me=cs(te,2);Me!==null&&(G._pendingVisibility|=2,ys(Me,te,2))}},attach:function(){var te=G._current;if(te===null)throw Error(c(456));if((G._pendingVisibility&2)!==0){var Me=cs(te,2);Me!==null&&(G._pendingVisibility&=-3,ys(Me,te,2))}}};return h.stateNode=G,h}function Cn(h,_,S){return h=Ut(6,h,null,_),h.lanes=S,h}function zn(h,_,S){return _=Ut(4,h.children!==null?h.children:[],h.key,_),_.lanes=S,_.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},_}function ni(h){h.flags|=4}function Yn(h,_){if(_.type!=="stylesheet"||(_.state.loading&4)!==0)h.flags&=-16777217;else if(h.flags|=16777216,!Nb(_)){if(_=Ao.current,_!==null&&((hi&4194176)===hi?Is!==null:(hi&62914560)!==hi&&(hi&536870912)===0||_!==Is))throw $d=Jm,I_;h.flags|=8192}}function Zn(h,_){_!==null&&(h.flags|=4),h.flags&16384&&(_=h.tag!==22?Cr():536870912,h.lanes|=_,la|=_)}function mi(h,_){if(!Ir)switch(h.tailMode){case"hidden":_=h.tail;for(var S=null;_!==null;)_.alternate!==null&&(S=_),_=_.sibling;S===null?h.tail=null:S.sibling=null;break;case"collapsed":S=h.tail;for(var O=null;S!==null;)S.alternate!==null&&(O=S),S=S.sibling;O===null?_||h.tail===null?h.tail=null:h.tail.sibling=null:O.sibling=null}}function gi(h){var _=h.alternate!==null&&h.alternate.child===h.child,S=0,O=0;if(_)for(var G=h.child;G!==null;)S|=G.lanes|G.childLanes,O|=G.subtreeFlags&31457280,O|=G.flags&31457280,G.return=h,G=G.sibling;else for(G=h.child;G!==null;)S|=G.lanes|G.childLanes,O|=G.subtreeFlags,O|=G.flags,G.return=h,G=G.sibling;return h.subtreeFlags|=O,h.childLanes=S,_}function pr(h,_,S){var O=_.pendingProps;switch(pp(_),_.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return gi(_),null;case 1:return gi(_),null;case 3:return S=_.stateNode,O=null,h!==null&&(O=h.memoizedState.cache),_.memoizedState.cache!==O&&(_.flags|=2048),Uo(ya),di(),S.pendingContext&&(S.context=S.pendingContext,S.pendingContext=null),(h===null||h.child===null)&&(Oc(_)?ni(_):h===null||h.memoizedState.isDehydrated&&(_.flags&256)===0||(_.flags|=1024,Ko!==null&&(G_(Ko),Ko=null))),gi(_),null;case 26:return S=_.memoizedState,h===null?(ni(_),S!==null?(gi(_),Yn(_,S)):(gi(_),_.flags&=-16777217)):S?S!==h.memoizedState?(ni(_),gi(_),Yn(_,S)):(gi(_),_.flags&=-16777217):(h.memoizedProps!==O&&ni(_),gi(_),_.flags&=-16777217),null;case 27:Mn(_),S=qn.current;var G=_.type;if(h!==null&&_.stateNode!=null)h.memoizedProps!==O&&ni(_);else{if(!O){if(_.stateNode===null)throw Error(c(166));return gi(_),null}h=Gn.current,Oc(_)?mp(_):(h=ax(G,O,S),_.stateNode=h,ni(_))}return gi(_),null;case 5:if(Mn(_),S=_.type,h!==null&&_.stateNode!=null)h.memoizedProps!==O&&ni(_);else{if(!O){if(_.stateNode===null)throw Error(c(166));return gi(_),null}if(h=Gn.current,Oc(_))mp(_);else{switch(G=Ef(qn.current),h){case 1:h=G.createElementNS("http://www.w3.org/2000/svg",S);break;case 2:h=G.createElementNS("http://www.w3.org/1998/Math/MathML",S);break;default:switch(S){case"svg":h=G.createElementNS("http://www.w3.org/2000/svg",S);break;case"math":h=G.createElementNS("http://www.w3.org/1998/Math/MathML",S);break;case"script":h=G.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild);break;case"select":h=typeof O.is=="string"?G.createElement("select",{is:O.is}):G.createElement("select"),O.multiple?h.multiple=!0:O.size&&(h.size=O.size);break;default:h=typeof O.is=="string"?G.createElement(S,{is:O.is}):G.createElement(S)}}h[_e]=_,h[Te]=O;e:for(G=_.child;G!==null;){if(G.tag===5||G.tag===6)h.appendChild(G.stateNode);else if(G.tag!==4&&G.tag!==27&&G.child!==null){G.child.return=G,G=G.child;continue}if(G===_)break e;for(;G.sibling===null;){if(G.return===null||G.return===_)break e;G=G.return}G.sibling.return=G.return,G=G.sibling}_.stateNode=h;e:switch(Po(h,S,O),S){case"button":case"input":case"select":case"textarea":h=!!O.autoFocus;break e;case"img":h=!0;break e;default:h=!1}h&&ni(_)}}return gi(_),_.flags&=-16777217,null;case 6:if(h&&_.stateNode!=null)h.memoizedProps!==O&&ni(_);else{if(typeof O!="string"&&_.stateNode===null)throw Error(c(166));if(h=qn.current,Oc(_)){if(h=_.stateNode,S=_.memoizedProps,O=null,G=Kr,G!==null)switch(G.tag){case 27:case 5:O=G.memoizedProps}h[_e]=_,h=!!(h.nodeValue===S||O!==null&&O.suppressHydrationWarning===!0||Sf(h.nodeValue,S)),h||ml(_)}else h=Ef(h).createTextNode(O),h[_e]=_,_.stateNode=h}return gi(_),null;case 13:if(O=_.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(G=Oc(_),O!==null&&O.dehydrated!==null){if(h===null){if(!G)throw Error(c(318));if(G=_.memoizedState,G=G!==null?G.dehydrated:null,!G)throw Error(c(317));G[_e]=_}else Ch(),(_.flags&128)===0&&(_.memoizedState=null),_.flags|=4;gi(_),G=!1}else Ko!==null&&(G_(Ko),Ko=null),G=!0;if(!G)return _.flags&256?(Wl(_),_):(Wl(_),null)}if(Wl(_),(_.flags&128)!==0)return _.lanes=S,_;if(S=O!==null,h=h!==null&&h.memoizedState!==null,S){O=_.child,G=null,O.alternate!==null&&O.alternate.memoizedState!==null&&O.alternate.memoizedState.cachePool!==null&&(G=O.alternate.memoizedState.cachePool.pool);var te=null;O.memoizedState!==null&&O.memoizedState.cachePool!==null&&(te=O.memoizedState.cachePool.pool),te!==G&&(O.flags|=2048)}return S!==h&&S&&(_.child.flags|=8192),Zn(_,_.updateQueue),gi(_),null;case 4:return di(),h===null&&tv(_.stateNode.containerInfo),gi(_),null;case 10:return Uo(_.type),gi(_),null;case 19:if(jn(Ja),G=_.memoizedState,G===null)return gi(_),null;if(O=(_.flags&128)!==0,te=G.rendering,te===null)if(O)mi(G,!1);else{if(Yi!==0||h!==null&&(h.flags&128)!==0)for(h=_.child;h!==null;){if(te=Zd(h),te!==null){for(_.flags|=128,mi(G,!1),h=te.updateQueue,_.updateQueue=h,Zn(_,h),_.subtreeFlags=0,h=S,S=_.child;S!==null;)Zt(S,h),S=S.sibling;return Pe(Ja,Ja.current&1|2),_.child}h=h.sibling}G.tail!==null&&gt()>mo&&(_.flags|=128,O=!0,mi(G,!1),_.lanes=4194304)}else{if(!O)if(h=Zd(te),h!==null){if(_.flags|=128,O=!0,h=h.updateQueue,_.updateQueue=h,Zn(_,h),mi(G,!0),G.tail===null&&G.tailMode==="hidden"&&!te.alternate&&!Ir)return gi(_),null}else 2*gt()-G.renderingStartTime>mo&&S!==536870912&&(_.flags|=128,O=!0,mi(G,!1),_.lanes=4194304);G.isBackwards?(te.sibling=_.child,_.child=te):(h=G.last,h!==null?h.sibling=te:_.child=te,G.last=te)}return G.tail!==null?(_=G.tail,G.rendering=_,G.tail=_.sibling,G.renderingStartTime=gt(),_.sibling=null,h=Ja.current,Pe(Ja,O?h&1|2:h&1),_):(gi(_),null);case 22:case 23:return Wl(_),Dh(),O=_.memoizedState!==null,h!==null?h.memoizedState!==null!==O&&(_.flags|=8192):O&&(_.flags|=8192),O?(S&536870912)!==0&&(_.flags&128)===0&&(gi(_),_.subtreeFlags&6&&(_.flags|=8192)):gi(_),S=_.updateQueue,S!==null&&Zn(_,S.retryQueue),S=null,h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(S=h.memoizedState.cachePool.pool),O=null,_.memoizedState!==null&&_.memoizedState.cachePool!==null&&(O=_.memoizedState.cachePool.pool),O!==S&&(_.flags|=2048),h!==null&&jn(Ln),null;case 24:return S=null,h!==null&&(S=h.memoizedState.cache),_.memoizedState.cache!==S&&(_.flags|=2048),Uo(ya),gi(_),null;case 25:return null}throw Error(c(156,_.tag))}function Qr(h,_){switch(pp(_),_.tag){case 1:return h=_.flags,h&65536?(_.flags=h&-65537|128,_):null;case 3:return Uo(ya),di(),h=_.flags,(h&65536)!==0&&(h&128)===0?(_.flags=h&-65537|128,_):null;case 26:case 27:case 5:return Mn(_),null;case 13:if(Wl(_),h=_.memoizedState,h!==null&&h.dehydrated!==null){if(_.alternate===null)throw Error(c(340));Ch()}return h=_.flags,h&65536?(_.flags=h&-65537|128,_):null;case 19:return jn(Ja),null;case 4:return di(),null;case 10:return Uo(_.type),null;case 22:case 23:return Wl(_),Dh(),h!==null&&jn(Ln),h=_.flags,h&65536?(_.flags=h&-65537|128,_):null;case 24:return Uo(ya),null;case 25:return null;default:return null}}function Pr(h,_){switch(pp(_),_.tag){case 3:Uo(ya),di();break;case 26:case 27:case 5:Mn(_);break;case 4:di();break;case 13:Wl(_);break;case 19:jn(Ja);break;case 10:Uo(_.type);break;case 22:case 23:Wl(_),Dh(),h!==null&&jn(Ln);break;case 24:Uo(ya)}}var Ei={getCacheForType:function(h){var _=Co(ya),S=_.data.get(h);return S===void 0&&(S=h(),_.data.set(h,S)),S}},Qi=typeof WeakMap=="function"?WeakMap:Map,Rn=0,li=null,ri=null,hi=0,Hi=0,Lr=null,jr=!1,ea=!1,Vo=!1,ha=0,Yi=0,hr=0,ur=0,Xi=0,Tr=0,la=0,mr=null,ca=null,ns=!1,Io=0,mo=1/0,_s=null,to=null,Do=!1,vs=null,is=0,ic=0,eu=null,tu=0,_f=null;function Bs(){if((Rn&2)!==0&&hi!==0)return hi&-hi;if(Se.T!==null){var h=_l;return h!==0?h:Q_()}return Xo()}function mb(){Tr===0&&(Tr=(hi&536870912)===0||Ir?ga():536870912);var h=Ao.current;return h!==null&&(h.flags|=32),Tr}function ys(h,_,S){(h===li&&Hi===2||h.cancelPendingCommit!==null)&&(Kh(h,0),nu(h,hi,Tr,!1)),Sr(h,S),((Rn&2)===0||h!==li)&&(h===li&&((Rn&2)===0&&(ur|=S),Yi===4&&nu(h,hi,Tr,!1)),al(h))}function Wy(h,_,S){if((Rn&6)!==0)throw Error(c(327));var O=!S&&(_&60)===0&&(_&h.expiredLanes)===0||Vi(h,_),G=O?mg(h,_):Zy(h,_,!0),te=O;do{if(G===0){ea&&!O&&nu(h,_,0,!1);break}else if(G===6)nu(h,_,0,!jr);else{if(S=h.current.alternate,te&&!gb(S)){G=Zy(h,_,!1),te=!1;continue}if(G===2){if(te=_,h.errorRecoveryDisabledLanes&te)var Me=0;else Me=h.pendingLanes&-536870913,Me=Me!==0?Me:Me&536870912?536870912:0;if(Me!==0){_=Me;e:{var He=h;G=mr;var mt=He.current.memoizedState.isDehydrated;if(mt&&(Kh(He,Me).flags|=256),Me=Zy(He,Me,!1),Me!==2){if(Vo&&!mt){He.errorRecoveryDisabledLanes|=te,ur|=te,G=4;break e}te=ca,ca=G,te!==null&&G_(te)}G=Me}if(te=!1,G!==2)continue}}if(G===1){Kh(h,0),nu(h,_,0,!0);break}e:{switch(O=h,G){case 0:case 1:throw Error(c(345));case 4:if((_&4194176)===_){nu(O,_,Tr,!jr);break e}break;case 2:ca=null;break;case 3:case 5:break;default:throw Error(c(329))}if(O.finishedWork=S,O.finishedLanes=_,(_&62914560)===_&&(te=Io+300-gt(),10<te)){if(nu(O,_,Tr,!jr),ti(O,0)!==0)break e;O.timeoutHandle=nx($y.bind(null,O,S,ca,_s,ns,_,Tr,ur,la,jr,2,-0,0),te);break e}$y(O,S,ca,_s,ns,_,Tr,ur,la,jr,0,-0,0)}}break}while(!0);al(h)}function G_(h){ca===null?ca=h:ca.push.apply(ca,h)}function $y(h,_,S,O,G,te,Me,He,mt,Vt,Sn,Fn,sn){var bn=_.subtreeFlags;if((bn&8192||(bn&16785408)===16785408)&&(Tg={stylesheets:null,count:0,unsuspend:rM},xt(_),_=oM(),_!==null)){h.cancelPendingCommit=_(yb.bind(null,h,S,O,G,Me,He,mt,1,Fn,sn)),nu(h,te,Me,!Vt);return}yb(h,S,O,G,Me,He,mt,Sn,Fn,sn)}function gb(h){for(var _=h;;){var S=_.tag;if((S===0||S===11||S===15)&&_.flags&16384&&(S=_.updateQueue,S!==null&&(S=S.stores,S!==null)))for(var O=0;O<S.length;O++){var G=S[O],te=G.getSnapshot;G=G.value;try{if(!Ya(te(),G))return!1}catch{return!1}}if(S=_.child,_.subtreeFlags&16384&&S!==null)S.return=_,_=S;else{if(_===h)break;for(;_.sibling===null;){if(_.return===null||_.return===h)return!0;_=_.return}_.sibling.return=_.return,_=_.sibling}}return!0}function nu(h,_,S,O){_&=~Xi,_&=~ur,h.suspendedLanes|=_,h.pingedLanes&=~_,O&&(h.warmLanes|=_),O=h.expirationTimes;for(var G=_;0<G;){var te=31-Si(G),Me=1<<te;O[te]=-1,G&=~Me}S!==0&&xc(h,S,_)}function pg(){return(Rn&6)===0?(_g(0),!1):!0}function H_(){if(ri!==null){if(Hi===0)var h=ri.return;else h=ri,el=ec=null,Nh(h),zc=null,kc=0,h=ri;for(;h!==null;)Pr(h.alternate,h),h=h.return;ri=null}}function Kh(h,_){h.finishedWork=null,h.finishedLanes=0;var S=h.timeoutHandle;S!==-1&&(h.timeoutHandle=-1,Cb(S)),S=h.cancelPendingCommit,S!==null&&(h.cancelPendingCommit=null,S()),H_(),li=h,ri=S=dn(h.current,null),hi=_,Hi=0,Lr=null,jr=!1,ea=Vi(h,_),Vo=!1,la=Tr=Xi=ur=hr=Yi=0,ca=mr=null,ns=!1,(_&8)!==0&&(_|=_&32);var O=h.entangledLanes;if(O!==0)for(h=h.entanglements,O&=_;0<O;){var G=31-Si(O),te=1<<G;_|=h[G],O&=~te}return ha=_,Pc(),S}function Hu(h,_){gn=null,Se.H=Os,_===gl?(_=vp(),Hi=3):_===I_?(_=vp(),Hi=4):Hi=_===hg?8:_!==null&&typeof _=="object"&&typeof _.then=="function"?6:1,Lr=_,ri===null&&(Yi=1,uf(h,us(_,h.current)))}function no(){var h=Se.H;return Se.H=Os,h===null?Os:h}function Xy(){var h=Se.A;return Se.A=Ei,h}function vf(){Yi=4,jr||(hi&4194176)!==hi&&Ao.current!==null||(ea=!0),(hr&134217727)===0&&(ur&134217727)===0||li===null||nu(li,hi,Tr,!1)}function Zy(h,_,S){var O=Rn;Rn|=2;var G=no(),te=Xy();(li!==h||hi!==_)&&(_s=null,Kh(h,_)),_=!1;var Me=Yi;e:do try{if(Hi!==0&&ri!==null){var He=ri,mt=Lr;switch(Hi){case 8:H_(),Me=6;break e;case 3:case 2:case 6:Ao.current===null&&(_=!0);var Vt=Hi;if(Hi=0,Lr=null,Vp(h,He,mt,Vt),S&&ea){Me=0;break e}break;default:Vt=Hi,Hi=0,Lr=null,Vp(h,He,mt,Vt)}}qE(),Me=Yi;break}catch(Sn){Hu(h,Sn)}while(!0);return _&&h.shellSuspendCounter++,el=ec=null,Rn=O,Se.H=G,Se.A=te,ri===null&&(li=null,hi=0,Pc()),Me}function qE(){for(;ri!==null;)Jh(ri)}function mg(h,_){var S=Rn;Rn|=2;var O=no(),G=Xy();li!==h||hi!==_?(_s=null,mo=gt()+500,Kh(h,_)):ea=Vi(h,_);e:do try{if(Hi!==0&&ri!==null){_=ri;var te=Lr;t:switch(Hi){case 1:Hi=0,Lr=null,Vp(h,_,te,1);break;case 2:if(D_(te)){Hi=0,Lr=null,Up(_);break}_=function(){Hi===2&&li===h&&(Hi=7),al(h)},te.then(_,_);break e;case 3:Hi=7;break e;case 4:Hi=5;break e;case 7:D_(te)?(Hi=0,Lr=null,Up(_)):(Hi=0,Lr=null,Vp(h,_,te,7));break;case 5:var Me=null;switch(ri.tag){case 26:Me=ri.memoizedState;case 5:case 27:var He=ri;if(!Me||Nb(Me)){Hi=0,Lr=null;var mt=He.sibling;if(mt!==null)ri=mt;else{var Vt=He.return;Vt!==null?(ri=Vt,q_(Vt)):ri=null}break t}}Hi=0,Lr=null,Vp(h,_,te,5);break;case 6:Hi=0,Lr=null,Vp(h,_,te,6);break;case 8:H_(),Yi=6;break e;default:throw Error(c(462))}}_b();break}catch(Sn){Hu(h,Sn)}while(!0);return el=ec=null,Se.H=O,Se.A=G,Rn=S,ri!==null?0:(li=null,hi=0,Pc(),Yi)}function _b(){for(;ri!==null&&!Ue();)Jh(ri)}function Jh(h){var _=Fp(h.alternate,h,ha);h.memoizedProps=h.pendingProps,_===null?q_(h):ri=_}function Up(h){var _=h,S=_.alternate;switch(_.tag){case 15:case 0:_=df(S,_,_.pendingProps,_.type,void 0,hi);break;case 11:_=df(S,_,_.pendingProps,_.type.render,_.ref,hi);break;case 5:Nh(_);default:Pr(S,_),_=ri=Zt(_,ha),_=Fp(S,_,ha)}h.memoizedProps=h.pendingProps,_===null?q_(h):ri=_}function Vp(h,_,S,O){el=ec=null,Nh(_),zc=null,kc=0;var G=_.return;try{if(B_(h,G,_,S,hi)){Yi=1,uf(h,us(S,h.current)),ri=null;return}}catch(te){if(G!==null)throw ri=G,te;Yi=1,uf(h,us(S,h.current)),ri=null;return}_.flags&32768?(Ir||O===1?h=!0:ea||(hi&536870912)!==0?h=!1:(jr=h=!0,(O===2||O===3||O===6)&&(O=Ao.current,O!==null&&O.tag===13&&(O.flags|=16384))),vb(_,h)):q_(_)}function q_(h){var _=h;do{if((_.flags&32768)!==0){vb(_,jr);return}h=_.return;var S=pr(_.alternate,_,ha);if(S!==null){ri=S;return}if(_=_.sibling,_!==null){ri=_;return}ri=_=h}while(_!==null);Yi===0&&(Yi=5)}function vb(h,_){do{var S=Qr(h.alternate,h);if(S!==null){S.flags&=32767,ri=S;return}if(S=h.return,S!==null&&(S.flags|=32768,S.subtreeFlags=0,S.deletions=null),!_&&(h=h.sibling,h!==null)){ri=h;return}ri=h=S}while(h!==null);Yi=6,ri=null}function yb(h,_,S,O,G,te,Me,He,mt,Vt){var Sn=Se.T,Fn=It.p;try{It.p=2,Se.T=null,WE(h,_,S,O,Fn,G,te,Me,He,mt,Vt)}finally{Se.T=Sn,It.p=Fn}}function WE(h,_,S,O,G,te,Me,He){do jp();while(vs!==null);if((Rn&6)!==0)throw Error(c(327));var mt=h.finishedWork;if(O=h.finishedLanes,mt===null)return null;if(h.finishedWork=null,h.finishedLanes=0,mt===h.current)throw Error(c(177));h.callbackNode=null,h.callbackPriority=0,h.cancelPendingCommit=null;var Vt=mt.lanes|mt.childLanes;if(Vt|=Dc,yc(h,O,Vt,te,Me,He),h===li&&(ri=li=null,hi=0),(mt.subtreeFlags&10256)===0&&(mt.flags&10256)===0||Do||(Do=!0,ic=Vt,eu=S,X_(On,function(){return jp(),null})),S=(mt.flags&15990)!==0,(mt.subtreeFlags&15990)!==0||S?(S=Se.T,Se.T=null,te=It.p,It.p=2,Me=Rn,Rn|=4,s(h,mt),fe(mt,h),C_(rv,h.containerInfo),Cg=!!qp,rv=qp=null,h.current=mt,m(h,mt.alternate,mt),Yt(),Rn=Me,It.p=te,Se.T=S):h.current=mt,Do?(Do=!1,vs=h,is=O):xb(h,Vt),Vt=h.pendingLanes,Vt===0&&(to=null),ui(mt.stateNode),al(h),_!==null)for(G=h.onRecoverableError,mt=0;mt<_.length;mt++)Vt=_[mt],G(Vt.value,{componentStack:Vt.stack});return(is&3)!==0&&jp(),Vt=h.pendingLanes,(O&4194218)!==0&&(Vt&42)!==0?h===_f?tu++:(tu=0,_f=h):tu=0,_g(0),null}function xb(h,_){(h.pooledCacheLanes&=_)===0&&(_=h.pooledCache,_!=null&&(h.pooledCache=null,$l(_)))}function jp(){if(vs!==null){var h=vs,_=ic;ic=0;var S=Sa(is),O=Se.T,G=It.p;try{if(It.p=32>S?32:S,Se.T=null,vs===null)var te=!1;else{S=eu,eu=null;var Me=vs,He=is;if(vs=null,is=0,(Rn&6)!==0)throw Error(c(331));var mt=Rn;if(Rn|=4,pt(Me.current),Ge(Me,Me.current,He,S),Rn=mt,_g(0,!1),_i&&typeof _i.onPostCommitFiberRoot=="function")try{_i.onPostCommitFiberRoot(ci,Me)}catch{}te=!0}return te}finally{It.p=G,Se.T=O,xb(h,_)}}return!1}function W_(h,_,S){_=us(S,_),_=Fu(h.stateNode,_,2),h=tc(h,_,2),h!==null&&(Sr(h,2),al(h))}function da(h,_,S){if(h.tag===3)W_(h,h,S);else for(;_!==null;){if(_.tag===3){W_(_,h,S);break}else if(_.tag===1){var O=_.stateNode;if(typeof _.type.getDerivedStateFromError=="function"||typeof O.componentDidCatch=="function"&&(to===null||!to.has(O))){h=us(S,h),S=cg(2),O=tc(_,S,2),O!==null&&(ug(S,O,_,h),Sr(O,2),al(O));break}}_=_.return}}function Qh(h,_,S){var O=h.pingCache;if(O===null){O=h.pingCache=new Qi;var G=new Set;O.set(_,G)}else G=O.get(_),G===void 0&&(G=new Set,O.set(_,G));G.has(S)||(Vo=!0,G.add(S),h=$E.bind(null,h,_,S),_.then(h,h))}function $E(h,_,S){var O=h.pingCache;O!==null&&O.delete(_),h.pingedLanes|=h.suspendedLanes&S,h.warmLanes&=~S,li===h&&(hi&S)===S&&(Yi===4||Yi===3&&(hi&62914560)===hi&&300>gt()-Io?(Rn&2)===0&&Kh(h,0):Xi|=S,la===hi&&(la=0)),al(h)}function Ia(h,_){_===0&&(_=Cr()),h=cs(h,_),h!==null&&(Sr(h,_),al(h))}function $_(h){var _=h.memoizedState,S=0;_!==null&&(S=_.retryLane),Ia(h,S)}function bb(h,_){var S=0;switch(h.tag){case 13:var O=h.stateNode,G=h.memoizedState;G!==null&&(S=G.retryLane);break;case 19:O=h.stateNode;break;case 22:O=h.stateNode._retryCache;break;default:throw Error(c(314))}O!==null&&O.delete(_),Ia(h,S)}function X_(h,_){return ei(h,_)}var yf=null,iu=null,Z_=!1,gg=!1,xf=!1,qu=0;function al(h){h!==iu&&h.next===null&&(iu===null?yf=iu=h:iu=iu.next=h),gg=!0,Z_||(Z_=!0,Sb(wb))}function _g(h,_){if(!xf&&gg){xf=!0;do for(var S=!1,O=yf;O!==null;){if(h!==0){var G=O.pendingLanes;if(G===0)var te=0;else{var Me=O.suspendedLanes,He=O.pingedLanes;te=(1<<31-Si(42|h)+1)-1,te&=G&~(Me&~He),te=te&201326677?te&201326677|1:te?te|2:0}te!==0&&(S=!0,J_(O,te))}else te=hi,te=ti(O,O===li?te:0),(te&3)===0||Vi(O,te)||(S=!0,J_(O,te));O=O.next}while(S);xf=!1}}function wb(){gg=Z_=!1;var h=0;qu!==0&&(KE()&&(h=qu),qu=0);for(var _=gt(),S=null,O=yf;O!==null;){var G=O.next,te=Y_(O,_);te===0?(O.next=null,S===null?yf=G:S.next=G,G===null&&(iu=S)):(S=O,(h!==0||(te&3)!==0)&&(gg=!0)),O=G}_g(h)}function Y_(h,_){for(var S=h.suspendedLanes,O=h.pingedLanes,G=h.expirationTimes,te=h.pendingLanes&-62914561;0<te;){var Me=31-Si(te),He=1<<Me,mt=G[Me];mt===-1?((He&S)===0||(He&O)!==0)&&(G[Me]=Zr(He,_)):mt<=_&&(h.expiredLanes|=He),te&=~He}if(_=li,S=hi,S=ti(h,h===_?S:0),O=h.callbackNode,S===0||h===_&&Hi===2||h.cancelPendingCommit!==null)return O!==null&&O!==null&&ot(O),h.callbackNode=null,h.callbackPriority=0;if((S&3)===0||Vi(h,S)){if(_=S&-S,_===h.callbackPriority)return _;switch(O!==null&&ot(O),Sa(S)){case 2:case 8:S=Xn;break;case 32:S=On;break;case 268435456:S=Ni;break;default:S=On}return O=K_.bind(null,h),S=ei(S,O),h.callbackPriority=_,h.callbackNode=S,_}return O!==null&&O!==null&&ot(O),h.callbackPriority=2,h.callbackNode=null,2}function K_(h,_){var S=h.callbackNode;if(jp()&&h.callbackNode!==S)return null;var O=hi;return O=ti(h,h===li?O:0),O===0?null:(Wy(h,O,_),Y_(h,gt()),h.callbackNode!=null&&h.callbackNode===S?K_.bind(null,h):null)}function J_(h,_){if(jp())return null;Wy(h,_,!0)}function Sb(h){Rb(function(){(Rn&6)!==0?ei(an,h):h()})}function Q_(){return qu===0&&(qu=ga()),qu}function Yy(h){return h==null||typeof h=="symbol"||typeof h=="boolean"?null:typeof h=="function"?h:tr(""+h)}function Ky(h,_){var S=_.ownerDocument.createElement("input");return S.name=_.name,S.value=_.value,h.id&&S.setAttribute("form",h.id),_.parentNode.insertBefore(S,_),h=new FormData(h),S.parentNode.removeChild(S),h}function Jy(h,_,S,O,G){if(_==="submit"&&S&&S.stateNode===G){var te=Yy((G[Te]||null).action),Me=O.submitter;Me&&(_=(_=Me[Te]||null)?Yy(_.formAction):Me.getAttribute("formAction"),_!==null&&(te=_,Me=null));var He=new vh("action","action",null,O,G);h.push({event:He,listeners:[{instance:null,listener:function(){if(O.defaultPrevented){if(qu!==0){var mt=Me?Ky(G,Me):new FormData(G);Qa(S,{pending:!0,data:mt,method:G.method,action:te},null,mt)}}else typeof te=="function"&&(He.preventDefault(),mt=Me?Ky(G,Me):new FormData(G),Qa(S,{pending:!0,data:mt,method:G.method,action:te},te,mt))},currentTarget:G}]})}}for(var Ml=0;Ml<Eh.length;Ml++){var ev=Eh[Ml],XE=ev.toLowerCase(),ZE=ev[0].toUpperCase()+ev.slice(1);ko(XE,"on"+ZE)}ko(Hd,"onAnimationEnd"),ko(Sh,"onAnimationIteration"),ko(qd,"onAnimationStart"),ko("dblclick","onDoubleClick"),ko("focusin","onFocus"),ko("focusout","onBlur"),ko(Rc,"onTransitionRun"),ko(fp,"onTransitionStart"),ko(Km,"onTransitionCancel"),ko(Ic,"onTransitionEnd"),En("onMouseEnter",["mouseout","mouseover"]),En("onMouseLeave",["mouseout","mouseover"]),En("onPointerEnter",["pointerout","pointerover"]),En("onPointerLeave",["pointerout","pointerover"]),Jt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Jt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Jt("onBeforeInput",["compositionend","keypress","textInput","paste"]),Jt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Jt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Jt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var vg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),YE=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(vg));function Eb(h,_){_=(_&4)!==0;for(var S=0;S<h.length;S++){var O=h[S],G=O.event;O=O.listeners;e:{var te=void 0;if(_)for(var Me=O.length-1;0<=Me;Me--){var He=O[Me],mt=He.instance,Vt=He.currentTarget;if(He=He.listener,mt!==te&&G.isPropagationStopped())break e;te=He,G.currentTarget=Vt;try{te(G)}catch(Sn){Yc(Sn)}G.currentTarget=null,te=mt}else for(Me=0;Me<O.length;Me++){if(He=O[Me],mt=He.instance,Vt=He.currentTarget,He=He.listener,mt!==te&&G.isPropagationStopped())break e;te=He,G.currentTarget=Vt;try{te(G)}catch(Sn){Yc(Sn)}G.currentTarget=null,te=mt}}}}function Or(h,_){var S=_[We];S===void 0&&(S=_[We]=new Set);var O=h+"__bubble";S.has(O)||(nv(_,h,2,!1),S.add(O))}function Qy(h,_,S){var O=0;_&&(O|=4),nv(S,h,O,_)}var Gp="_reactListening"+Math.random().toString(36).slice(2);function tv(h){if(!h[Gp]){h[Gp]=!0,ht.forEach(function(S){S!=="selectionchange"&&(YE.has(S)||Qy(S,!1,h),Qy(S,!0,h))});var _=h.nodeType===9?h:h.ownerDocument;_===null||_[Gp]||(_[Gp]=!0,Qy("selectionchange",!1,_))}}function nv(h,_,S,O){switch(Ub(_)){case 2:var G=Bb;break;case 8:G=_x;break;default:G=dv}S=G.bind(null,_,S,h),G=void 0,!Nn||_!=="touchstart"&&_!=="touchmove"&&_!=="wheel"||(G=!0),O?G!==void 0?h.addEventListener(_,S,{capture:!0,passive:G}):h.addEventListener(_,S,!0):G!==void 0?h.addEventListener(_,S,{passive:G}):h.addEventListener(_,S,!1)}function iv(h,_,S,O,G){var te=O;if((_&1)===0&&(_&2)===0&&O!==null)e:for(;;){if(O===null)return;var Me=O.tag;if(Me===3||Me===4){var He=O.stateNode.containerInfo;if(He===G||He.nodeType===8&&He.parentNode===G)break;if(Me===4)for(Me=O.return;Me!==null;){var mt=Me.tag;if((mt===3||mt===4)&&(mt=Me.stateNode.containerInfo,mt===G||mt.nodeType===8&&mt.parentNode===G))return;Me=Me.return}for(;He!==null;){if(Me=Mt(He),Me===null)return;if(mt=Me.tag,mt===5||mt===6||mt===26||mt===27){O=te=Me;continue e}He=He.parentNode}}O=O.return}Ld(function(){var Vt=te,Sn=oi(S),Fn=[];e:{var sn=bu.get(h);if(sn!==void 0){var bn=vh,Oi=h;switch(h){case"keypress":if(bc(S)===0)break e;case"keydown":case"keyup":bn=zo;break;case"focusin":Oi="focus",bn=Yr;break;case"focusout":Oi="blur",bn=Yr;break;case"beforeblur":case"afterblur":bn=Yr;break;case"click":if(S.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":bn=Ws;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":bn=Bm;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":bn=Nd;break;case Hd:case Sh:case qd:bn=Xa;break;case Ic:bn=Gy;break;case"scroll":case"scrollend":bn=ap;break;case"wheel":bn=Ud;break;case"copy":case"cut":case"paste":bn=Od;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":bn=kd;break;case"toggle":case"beforetoggle":bn=xh}var dr=(_&4)!==0,ka=!dr&&(h==="scroll"||h==="scrollend"),Ht=dr?sn!==null?sn+"Capture":null:sn;dr=[];for(var Ft=Vt,en;Ft!==null;){var Pn=Ft;if(en=Pn.stateNode,Pn=Pn.tag,Pn!==5&&Pn!==26&&Pn!==27||en===null||Ht===null||(Pn=qs(Ft,Ht),Pn!=null&&dr.push(bf(Ft,Pn,en))),ka)break;Ft=Ft.return}0<dr.length&&(sn=new bn(sn,Oi,null,S,Sn),Fn.push({event:sn,listeners:dr}))}}if((_&7)===0){e:{if(sn=h==="mouseover"||h==="pointerover",bn=h==="mouseout"||h==="pointerout",sn&&S!==Dd&&(Oi=S.relatedTarget||S.fromElement)&&(Mt(Oi)||Oi[je]))break e;if((bn||sn)&&(sn=Sn.window===Sn?Sn:(sn=Sn.ownerDocument)?sn.defaultView||sn.parentWindow:window,bn?(Oi=S.relatedTarget||S.toElement,bn=Vt,Oi=Oi?Mt(Oi):null,Oi!==null&&(ka=lt(Oi),dr=Oi.tag,Oi!==ka||dr!==5&&dr!==27&&dr!==6)&&(Oi=null)):(bn=null,Oi=Vt),bn!==Oi)){if(dr=Ws,Pn="onMouseLeave",Ht="onMouseEnter",Ft="mouse",(h==="pointerout"||h==="pointerover")&&(dr=kd,Pn="onPointerLeave",Ht="onPointerEnter",Ft="pointer"),ka=bn==null?sn:Ze(bn),en=Oi==null?sn:Ze(Oi),sn=new dr(Pn,Ft+"leave",bn,S,Sn),sn.target=ka,sn.relatedTarget=en,Pn=null,Mt(Sn)===Vt&&(dr=new dr(Ht,Ft+"enter",Oi,S,Sn),dr.target=en,dr.relatedTarget=ka,Pn=dr),ka=Pn,bn&&Oi)t:{for(dr=bn,Ht=Oi,Ft=0,en=dr;en;en=wf(en))Ft++;for(en=0,Pn=Ht;Pn;Pn=wf(Pn))en++;for(;0<Ft-en;)dr=wf(dr),Ft--;for(;0<en-Ft;)Ht=wf(Ht),en--;for(;Ft--;){if(dr===Ht||Ht!==null&&dr===Ht.alternate)break t;dr=wf(dr),Ht=wf(Ht)}dr=null}else dr=null;bn!==null&&xg(Fn,sn,bn,dr,!1),Oi!==null&&ka!==null&&xg(Fn,ka,Oi,dr,!0)}}e:{if(sn=Vt?Ze(Vt):window,bn=sn.nodeName&&sn.nodeName.toLowerCase(),bn==="select"||bn==="input"&&sn.type==="file")var Ti=cp;else if(pi(sn))if(Vd)Ti=jl;else{Ti=Ec;var lr=Gd}else bn=sn.nodeName,!bn||bn.toLowerCase()!=="input"||sn.type!=="checkbox"&&sn.type!=="radio"?Vt&&rp(Vt.elementType)&&(Ti=cp):Ti=Za;if(Ti&&(Ti=Ti(h,Vt))){yu(Fn,Ti,S,Sn);break e}lr&&lr(h,sn,Vt),h==="focusout"&&Vt&&sn.type==="number"&&Vt.memoizedProps.value!=null&&_a(sn,"number",sn.value)}switch(lr=Vt?Ze(Vt):window,h){case"focusin":(pi(lr)||lr.contentEditable==="true")&&(Tc=lr,Zm=Vt,wh=null);break;case"focusout":wh=Zm=Tc=null;break;case"mousedown":Gl=!0;break;case"contextmenu":case"mouseup":case"dragend":Gl=!1,R_(Fn,S,Sn);break;case"selectionchange":if(Xm)break;case"keydown":case"keyup":R_(Fn,S,Sn)}var ji;if(Zs)e:{switch(h){case"compositionstart":var Ki="onCompositionStart";break e;case"compositionend":Ki="onCompositionEnd";break e;case"compositionupdate":Ki="onCompositionUpdate";break e}Ki=void 0}else As?T_(h,S)&&(Ki="onCompositionEnd"):h==="keydown"&&S.keyCode===229&&(Ki="onCompositionStart");Ki&&(op&&S.locale!=="ko"&&(As||Ki!=="onCompositionStart"?Ki==="onCompositionEnd"&&As&&(ji=nr()):(Gi=Sn,Wa="value"in Gi?Gi.value:Gi.textContent,As=!0)),lr=yg(Vt,Ki),0<lr.length&&(Ki=new wc(Ki,h,null,S,Sn),Fn.push({event:Ki,listeners:lr}),ji?Ki.data=ji:(ji=sp(S),ji!==null&&(Ki.data=ji)))),(ji=qy?Ui(h,S):Qn(h,S))&&(Ki=yg(Vt,"onBeforeInput"),0<Ki.length&&(lr=new wc("onBeforeInput","beforeinput",null,S,Sn),Fn.push({event:lr,listeners:Ki}),lr.data=ji)),Jy(Fn,h,Vt,S,Sn)}Eb(Fn,_)})}function bf(h,_,S){return{instance:h,listener:_,currentTarget:S}}function yg(h,_){for(var S=_+"Capture",O=[];h!==null;){var G=h,te=G.stateNode;G=G.tag,G!==5&&G!==26&&G!==27||te===null||(G=qs(h,S),G!=null&&O.unshift(bf(h,G,te)),G=qs(h,_),G!=null&&O.push(bf(h,G,te))),h=h.return}return O}function wf(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5&&h.tag!==27);return h||null}function xg(h,_,S,O,G){for(var te=_._reactName,Me=[];S!==null&&S!==O;){var He=S,mt=He.alternate,Vt=He.stateNode;if(He=He.tag,mt!==null&&mt===O)break;He!==5&&He!==26&&He!==27||Vt===null||(mt=Vt,G?(Vt=qs(S,te),Vt!=null&&Me.unshift(bf(S,Vt,mt))):G||(Vt=qs(S,te),Vt!=null&&Me.push(bf(S,Vt,mt)))),S=S.return}Me.length!==0&&h.push({event:_,listeners:Me})}var Mb=/\r\n?/g,Tb=/\u0000|\uFFFD/g;function ex(h){return(typeof h=="string"?h:""+h).replace(Mb,`
`).replace(Tb,"")}function Sf(h,_){return _=ex(_),ex(h)===_}function ru(){}function oa(h,_,S,O,G,te){switch(S){case"children":typeof O=="string"?_==="body"||_==="textarea"&&O===""||yo(h,O):(typeof O=="number"||typeof O=="bigint")&&_!=="body"&&yo(h,""+O);break;case"className":er(h,"class",O);break;case"tabIndex":er(h,"tabindex",O);break;case"dir":case"role":case"viewBox":case"width":case"height":er(h,S,O);break;case"style":Fl(h,O,te);break;case"data":if(_!=="object"){er(h,"data",O);break}case"src":case"href":if(O===""&&(_!=="a"||S!=="href")){h.removeAttribute(S);break}if(O==null||typeof O=="function"||typeof O=="symbol"||typeof O=="boolean"){h.removeAttribute(S);break}O=tr(""+O),h.setAttribute(S,O);break;case"action":case"formAction":if(typeof O=="function"){h.setAttribute(S,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof te=="function"&&(S==="formAction"?(_!=="input"&&oa(h,_,"name",G.name,G,null),oa(h,_,"formEncType",G.formEncType,G,null),oa(h,_,"formMethod",G.formMethod,G,null),oa(h,_,"formTarget",G.formTarget,G,null)):(oa(h,_,"encType",G.encType,G,null),oa(h,_,"method",G.method,G,null),oa(h,_,"target",G.target,G,null)));if(O==null||typeof O=="symbol"||typeof O=="boolean"){h.removeAttribute(S);break}O=tr(""+O),h.setAttribute(S,O);break;case"onClick":O!=null&&(h.onclick=ru);break;case"onScroll":O!=null&&Or("scroll",h);break;case"onScrollEnd":O!=null&&Or("scrollend",h);break;case"dangerouslySetInnerHTML":if(O!=null){if(typeof O!="object"||!("__html"in O))throw Error(c(61));if(S=O.__html,S!=null){if(G.children!=null)throw Error(c(60));h.innerHTML=S}}break;case"multiple":h.multiple=O&&typeof O!="function"&&typeof O!="symbol";break;case"muted":h.muted=O&&typeof O!="function"&&typeof O!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(O==null||typeof O=="function"||typeof O=="boolean"||typeof O=="symbol"){h.removeAttribute("xlink:href");break}S=tr(""+O),h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",S);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":O!=null&&typeof O!="function"&&typeof O!="symbol"?h.setAttribute(S,""+O):h.removeAttribute(S);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":O&&typeof O!="function"&&typeof O!="symbol"?h.setAttribute(S,""):h.removeAttribute(S);break;case"capture":case"download":O===!0?h.setAttribute(S,""):O!==!1&&O!=null&&typeof O!="function"&&typeof O!="symbol"?h.setAttribute(S,O):h.removeAttribute(S);break;case"cols":case"rows":case"size":case"span":O!=null&&typeof O!="function"&&typeof O!="symbol"&&!isNaN(O)&&1<=O?h.setAttribute(S,O):h.removeAttribute(S);break;case"rowSpan":case"start":O==null||typeof O=="function"||typeof O=="symbol"||isNaN(O)?h.removeAttribute(S):h.setAttribute(S,O);break;case"popover":Or("beforetoggle",h),Or("toggle",h),or(h,"popover",O);break;case"xlinkActuate":qi(h,"http://www.w3.org/1999/xlink","xlink:actuate",O);break;case"xlinkArcrole":qi(h,"http://www.w3.org/1999/xlink","xlink:arcrole",O);break;case"xlinkRole":qi(h,"http://www.w3.org/1999/xlink","xlink:role",O);break;case"xlinkShow":qi(h,"http://www.w3.org/1999/xlink","xlink:show",O);break;case"xlinkTitle":qi(h,"http://www.w3.org/1999/xlink","xlink:title",O);break;case"xlinkType":qi(h,"http://www.w3.org/1999/xlink","xlink:type",O);break;case"xmlBase":qi(h,"http://www.w3.org/XML/1998/namespace","xml:base",O);break;case"xmlLang":qi(h,"http://www.w3.org/XML/1998/namespace","xml:lang",O);break;case"xmlSpace":qi(h,"http://www.w3.org/XML/1998/namespace","xml:space",O);break;case"is":or(h,"is",O);break;case"innerText":case"textContent":break;default:(!(2<S.length)||S[0]!=="o"&&S[0]!=="O"||S[1]!=="n"&&S[1]!=="N")&&(S=Nm.get(S)||S,or(h,S,O))}}function Hp(h,_,S,O,G,te){switch(S){case"style":Fl(h,O,te);break;case"dangerouslySetInnerHTML":if(O!=null){if(typeof O!="object"||!("__html"in O))throw Error(c(61));if(S=O.__html,S!=null){if(G.children!=null)throw Error(c(60));h.innerHTML=S}}break;case"children":typeof O=="string"?yo(h,O):(typeof O=="number"||typeof O=="bigint")&&yo(h,""+O);break;case"onScroll":O!=null&&Or("scroll",h);break;case"onScrollEnd":O!=null&&Or("scrollend",h);break;case"onClick":O!=null&&(h.onclick=ru);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!qt.hasOwnProperty(S))e:{if(S[0]==="o"&&S[1]==="n"&&(G=S.endsWith("Capture"),_=S.slice(2,G?S.length-7:void 0),te=h[Te]||null,te=te!=null?te[S]:null,typeof te=="function"&&h.removeEventListener(_,te,G),typeof O=="function")){typeof te!="function"&&te!==null&&(S in h?h[S]=null:h.hasAttribute(S)&&h.removeAttribute(S)),h.addEventListener(_,O,G);break e}S in h?h[S]=O:O===!0?h.setAttribute(S,""):or(h,S,O)}}}function Po(h,_,S){switch(_){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Or("error",h),Or("load",h);var O=!1,G=!1,te;for(te in S)if(S.hasOwnProperty(te)){var Me=S[te];if(Me!=null)switch(te){case"src":O=!0;break;case"srcSet":G=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(c(137,_));default:oa(h,_,te,Me,S,null)}}G&&oa(h,_,"srcSet",S.srcSet,S,null),O&&oa(h,_,"src",S.src,S,null);return;case"input":Or("invalid",h);var He=te=Me=G=null,mt=null,Vt=null;for(O in S)if(S.hasOwnProperty(O)){var Sn=S[O];if(Sn!=null)switch(O){case"name":G=Sn;break;case"type":Me=Sn;break;case"checked":mt=Sn;break;case"defaultChecked":Vt=Sn;break;case"value":te=Sn;break;case"defaultValue":He=Sn;break;case"children":case"dangerouslySetInnerHTML":if(Sn!=null)throw Error(c(137,_));break;default:oa(h,_,O,Sn,S,null)}}ua(h,te,He,mt,Vt,Me,G,!1),gr(h);return;case"select":Or("invalid",h),O=Me=te=null;for(G in S)if(S.hasOwnProperty(G)&&(He=S[G],He!=null))switch(G){case"value":te=He;break;case"defaultValue":Me=He;break;case"multiple":O=He;default:oa(h,_,G,He,S,null)}_=te,S=Me,h.multiple=!!O,_!=null?Vr(h,!!O,_,!1):S!=null&&Vr(h,!!O,S,!0);return;case"textarea":Or("invalid",h),te=G=O=null;for(Me in S)if(S.hasOwnProperty(Me)&&(He=S[Me],He!=null))switch(Me){case"value":O=He;break;case"defaultValue":G=He;break;case"children":te=He;break;case"dangerouslySetInnerHTML":if(He!=null)throw Error(c(91));break;default:oa(h,_,Me,He,S,null)}Oo(h,O,G,te),gr(h);return;case"option":for(mt in S)if(S.hasOwnProperty(mt)&&(O=S[mt],O!=null))switch(mt){case"selected":h.selected=O&&typeof O!="function"&&typeof O!="symbol";break;default:oa(h,_,mt,O,S,null)}return;case"dialog":Or("cancel",h),Or("close",h);break;case"iframe":case"object":Or("load",h);break;case"video":case"audio":for(O=0;O<vg.length;O++)Or(vg[O],h);break;case"image":Or("error",h),Or("load",h);break;case"details":Or("toggle",h);break;case"embed":case"source":case"link":Or("error",h),Or("load",h);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Vt in S)if(S.hasOwnProperty(Vt)&&(O=S[Vt],O!=null))switch(Vt){case"children":case"dangerouslySetInnerHTML":throw Error(c(137,_));default:oa(h,_,Vt,O,S,null)}return;default:if(rp(_)){for(Sn in S)S.hasOwnProperty(Sn)&&(O=S[Sn],O!==void 0&&Hp(h,_,Sn,O,S,void 0));return}}for(He in S)S.hasOwnProperty(He)&&(O=S[He],O!=null&&oa(h,_,He,O,S,null))}function Ab(h,_,S,O){switch(_){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var G=null,te=null,Me=null,He=null,mt=null,Vt=null,Sn=null;for(bn in S){var Fn=S[bn];if(S.hasOwnProperty(bn)&&Fn!=null)switch(bn){case"checked":break;case"value":break;case"defaultValue":mt=Fn;default:O.hasOwnProperty(bn)||oa(h,_,bn,null,O,Fn)}}for(var sn in O){var bn=O[sn];if(Fn=S[sn],O.hasOwnProperty(sn)&&(bn!=null||Fn!=null))switch(sn){case"type":te=bn;break;case"name":G=bn;break;case"checked":Vt=bn;break;case"defaultChecked":Sn=bn;break;case"value":Me=bn;break;case"defaultValue":He=bn;break;case"children":case"dangerouslySetInnerHTML":if(bn!=null)throw Error(c(137,_));break;default:bn!==Fn&&oa(h,_,sn,bn,O,Fn)}}cr(h,Me,He,mt,Vt,Sn,te,G);return;case"select":bn=Me=He=sn=null;for(te in S)if(mt=S[te],S.hasOwnProperty(te)&&mt!=null)switch(te){case"value":break;case"multiple":bn=mt;default:O.hasOwnProperty(te)||oa(h,_,te,null,O,mt)}for(G in O)if(te=O[G],mt=S[G],O.hasOwnProperty(G)&&(te!=null||mt!=null))switch(G){case"value":sn=te;break;case"defaultValue":He=te;break;case"multiple":Me=te;default:te!==mt&&oa(h,_,G,te,O,mt)}_=He,S=Me,O=bn,sn!=null?Vr(h,!!S,sn,!1):!!O!=!!S&&(_!=null?Vr(h,!!S,_,!0):Vr(h,!!S,S?[]:"",!1));return;case"textarea":bn=sn=null;for(He in S)if(G=S[He],S.hasOwnProperty(He)&&G!=null&&!O.hasOwnProperty(He))switch(He){case"value":break;case"children":break;default:oa(h,_,He,null,O,G)}for(Me in O)if(G=O[Me],te=S[Me],O.hasOwnProperty(Me)&&(G!=null||te!=null))switch(Me){case"value":sn=G;break;case"defaultValue":bn=G;break;case"children":break;case"dangerouslySetInnerHTML":if(G!=null)throw Error(c(91));break;default:G!==te&&oa(h,_,Me,G,O,te)}ra(h,sn,bn);return;case"option":for(var Oi in S)if(sn=S[Oi],S.hasOwnProperty(Oi)&&sn!=null&&!O.hasOwnProperty(Oi))switch(Oi){case"selected":h.selected=!1;break;default:oa(h,_,Oi,null,O,sn)}for(mt in O)if(sn=O[mt],bn=S[mt],O.hasOwnProperty(mt)&&sn!==bn&&(sn!=null||bn!=null))switch(mt){case"selected":h.selected=sn&&typeof sn!="function"&&typeof sn!="symbol";break;default:oa(h,_,mt,sn,O,bn)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var dr in S)sn=S[dr],S.hasOwnProperty(dr)&&sn!=null&&!O.hasOwnProperty(dr)&&oa(h,_,dr,null,O,sn);for(Vt in O)if(sn=O[Vt],bn=S[Vt],O.hasOwnProperty(Vt)&&sn!==bn&&(sn!=null||bn!=null))switch(Vt){case"children":case"dangerouslySetInnerHTML":if(sn!=null)throw Error(c(137,_));break;default:oa(h,_,Vt,sn,O,bn)}return;default:if(rp(_)){for(var ka in S)sn=S[ka],S.hasOwnProperty(ka)&&sn!==void 0&&!O.hasOwnProperty(ka)&&Hp(h,_,ka,void 0,O,sn);for(Sn in O)sn=O[Sn],bn=S[Sn],!O.hasOwnProperty(Sn)||sn===bn||sn===void 0&&bn===void 0||Hp(h,_,Sn,sn,O,bn);return}}for(var Ht in S)sn=S[Ht],S.hasOwnProperty(Ht)&&sn!=null&&!O.hasOwnProperty(Ht)&&oa(h,_,Ht,null,O,sn);for(Fn in O)sn=O[Fn],bn=S[Fn],!O.hasOwnProperty(Fn)||sn===bn||sn==null&&bn==null||oa(h,_,Fn,sn,O,bn)}var qp=null,rv=null;function Ef(h){return h.nodeType===9?h:h.ownerDocument}function tx(h){switch(h){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function av(h,_){if(h===0)switch(_){case"svg":return 1;case"math":return 2;default:return 0}return h===1&&_==="foreignObject"?0:h}function bg(h,_){return h==="textarea"||h==="noscript"||typeof _.children=="string"||typeof _.children=="number"||typeof _.children=="bigint"||typeof _.dangerouslySetInnerHTML=="object"&&_.dangerouslySetInnerHTML!==null&&_.dangerouslySetInnerHTML.__html!=null}var ov=null;function KE(){var h=window.event;return h&&h.type==="popstate"?h===ov?!1:(ov=h,!0):(ov=null,!1)}var nx=typeof setTimeout=="function"?setTimeout:void 0,Cb=typeof clearTimeout=="function"?clearTimeout:void 0,ix=typeof Promise=="function"?Promise:void 0,Rb=typeof queueMicrotask=="function"?queueMicrotask:typeof ix<"u"?function(h){return ix.resolve(null).then(h).catch(rx)}:nx;function rx(h){setTimeout(function(){throw h})}function sv(h,_){var S=_,O=0;do{var G=S.nextSibling;if(h.removeChild(S),G&&G.nodeType===8)if(S=G.data,S==="/$"){if(O===0){h.removeChild(G),Dg(_);return}O--}else S!=="$"&&S!=="$?"&&S!=="$!"||O++;S=G}while(S);Dg(_)}function wg(h){var _=h.firstChild;for(_&&_.nodeType===10&&(_=_.nextSibling);_;){var S=_;switch(_=_.nextSibling,S.nodeName){case"HTML":case"HEAD":case"BODY":wg(S),wt(S);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(S.rel.toLowerCase()==="stylesheet")continue}h.removeChild(S)}}function JE(h,_,S,O){for(;h.nodeType===1;){var G=S;if(h.nodeName.toLowerCase()!==_.toLowerCase()){if(!O&&(h.nodeName!=="INPUT"||h.type!=="hidden"))break}else if(O){if(!h[St])switch(_){case"meta":if(!h.hasAttribute("itemprop"))break;return h;case"link":if(te=h.getAttribute("rel"),te==="stylesheet"&&h.hasAttribute("data-precedence"))break;if(te!==G.rel||h.getAttribute("href")!==(G.href==null?null:G.href)||h.getAttribute("crossorigin")!==(G.crossOrigin==null?null:G.crossOrigin)||h.getAttribute("title")!==(G.title==null?null:G.title))break;return h;case"style":if(h.hasAttribute("data-precedence"))break;return h;case"script":if(te=h.getAttribute("src"),(te!==(G.src==null?null:G.src)||h.getAttribute("type")!==(G.type==null?null:G.type)||h.getAttribute("crossorigin")!==(G.crossOrigin==null?null:G.crossOrigin))&&te&&h.hasAttribute("async")&&!h.hasAttribute("itemprop"))break;return h;default:return h}}else if(_==="input"&&h.type==="hidden"){var te=G.name==null?null:""+G.name;if(G.type==="hidden"&&h.getAttribute("name")===te)return h}else return h;if(h=rc(h.nextSibling),h===null)break}return null}function QE(h,_,S){if(_==="")return null;for(;h.nodeType!==3;)if((h.nodeType!==1||h.nodeName!=="INPUT"||h.type!=="hidden")&&!S||(h=rc(h.nextSibling),h===null))return null;return h}function rc(h){for(;h!=null;h=h.nextSibling){var _=h.nodeType;if(_===1||_===3)break;if(_===8){if(_=h.data,_==="$"||_==="$!"||_==="$?"||_==="F!"||_==="F")break;if(_==="/$")return null}}return h}function Ib(h){h=h.previousSibling;for(var _=0;h;){if(h.nodeType===8){var S=h.data;if(S==="$"||S==="$!"||S==="$?"){if(_===0)return h;_--}else S==="/$"&&_++}h=h.previousSibling}return null}function ax(h,_,S){switch(_=Ef(S),h){case"html":if(h=_.documentElement,!h)throw Error(c(452));return h;case"head":if(h=_.head,!h)throw Error(c(453));return h;case"body":if(h=_.body,!h)throw Error(c(454));return h;default:throw Error(c(451))}}var So=new Map,Wp=new Set;function ed(h){return typeof h.getRootNode=="function"?h.getRootNode():h.ownerDocument}var Tl=It.d;It.d={f:Sg,r:Db,D:Pb,C:eM,L:tM,m:Lb,X:Ob,S:lv,M:nM};function Sg(){var h=Tl.f(),_=pg();return h||_}function Db(h){var _=we(h);_!==null&&_.tag===5&&_.type==="form"?jh(_):Tl.r(h)}var Mf=typeof document>"u"?null:document;function ox(h,_,S){var O=Mf;if(O&&typeof _=="string"&&_){var G=Ua(_);G='link[rel="'+h+'"][href="'+G+'"]',typeof S=="string"&&(G+='[crossorigin="'+S+'"]'),Wp.has(G)||(Wp.add(G),h={rel:h,crossOrigin:S,href:_},O.querySelector(G)===null&&(_=O.createElement("link"),Po(_,"link",h),vt(_),O.head.appendChild(_)))}}function Pb(h){Tl.D(h),ox("dns-prefetch",h,null)}function eM(h,_){Tl.C(h,_),ox("preconnect",h,_)}function tM(h,_,S){Tl.L(h,_,S);var O=Mf;if(O&&h&&_){var G='link[rel="preload"][as="'+Ua(_)+'"]';_==="image"&&S&&S.imageSrcSet?(G+='[imagesrcset="'+Ua(S.imageSrcSet)+'"]',typeof S.imageSizes=="string"&&(G+='[imagesizes="'+Ua(S.imageSizes)+'"]')):G+='[href="'+Ua(h)+'"]';var te=G;switch(_){case"style":te=td(h);break;case"script":te=Tf(h)}So.has(te)||(h=xe({rel:"preload",href:_==="image"&&S&&S.imageSrcSet?void 0:h,as:_},S),So.set(te,h),O.querySelector(G)!==null||_==="style"&&O.querySelector($p(te))||_==="script"&&O.querySelector(Xp(te))||(_=O.createElement("link"),Po(_,"link",h),vt(_),O.head.appendChild(_)))}}function Lb(h,_){Tl.m(h,_);var S=Mf;if(S&&h){var O=_&&typeof _.as=="string"?_.as:"script",G='link[rel="modulepreload"][as="'+Ua(O)+'"][href="'+Ua(h)+'"]',te=G;switch(O){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":te=Tf(h)}if(!So.has(te)&&(h=xe({rel:"modulepreload",href:h},_),So.set(te,h),S.querySelector(G)===null)){switch(O){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(S.querySelector(Xp(te)))return}O=S.createElement("link"),Po(O,"link",h),vt(O),S.head.appendChild(O)}}}function lv(h,_,S){Tl.S(h,_,S);var O=Mf;if(O&&h){var G=at(O).hoistableStyles,te=td(h);_=_||"default";var Me=G.get(te);if(!Me){var He={loading:0,preload:null};if(Me=O.querySelector($p(te)))He.loading=5;else{h=xe({rel:"stylesheet",href:h,"data-precedence":_},S),(S=So.get(te))&&cv(h,S);var mt=Me=O.createElement("link");vt(mt),Po(mt,"link",h),mt._p=new Promise(function(Vt,Sn){mt.onload=Vt,mt.onerror=Sn}),mt.addEventListener("load",function(){He.loading|=1}),mt.addEventListener("error",function(){He.loading|=2}),He.loading|=4,Eg(Me,_,O)}Me={type:"stylesheet",instance:Me,count:1,state:He},G.set(te,Me)}}}function Ob(h,_){Tl.X(h,_);var S=Mf;if(S&&h){var O=at(S).hoistableScripts,G=Tf(h),te=O.get(G);te||(te=S.querySelector(Xp(G)),te||(h=xe({src:h,async:!0},_),(_=So.get(G))&&Af(h,_),te=S.createElement("script"),vt(te),Po(te,"link",h),S.head.appendChild(te)),te={type:"script",instance:te,count:1,state:null},O.set(G,te))}}function nM(h,_){Tl.M(h,_);var S=Mf;if(S&&h){var O=at(S).hoistableScripts,G=Tf(h),te=O.get(G);te||(te=S.querySelector(Xp(G)),te||(h=xe({src:h,async:!0,type:"module"},_),(_=So.get(G))&&Af(h,_),te=S.createElement("script"),vt(te),Po(te,"link",h),S.head.appendChild(te)),te={type:"script",instance:te,count:1,state:null},O.set(G,te))}}function sx(h,_,S,O){var G=(G=qn.current)?ed(G):null;if(!G)throw Error(c(446));switch(h){case"meta":case"title":return null;case"style":return typeof S.precedence=="string"&&typeof S.href=="string"?(_=td(S.href),S=at(G).hoistableStyles,O=S.get(_),O||(O={type:"style",instance:null,count:0,state:null},S.set(_,O)),O):{type:"void",instance:null,count:0,state:null};case"link":if(S.rel==="stylesheet"&&typeof S.href=="string"&&typeof S.precedence=="string"){h=td(S.href);var te=at(G).hoistableStyles,Me=te.get(h);if(Me||(G=G.ownerDocument||G,Me={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},te.set(h,Me),(te=G.querySelector($p(h)))&&!te._p&&(Me.instance=te,Me.state.loading=5),So.has(h)||(S={rel:"preload",as:"style",href:S.href,crossOrigin:S.crossOrigin,integrity:S.integrity,media:S.media,hrefLang:S.hrefLang,referrerPolicy:S.referrerPolicy},So.set(h,S),te||zb(G,h,S,Me.state))),_&&O===null)throw Error(c(528,""));return Me}if(_&&O!==null)throw Error(c(529,""));return null;case"script":return _=S.async,S=S.src,typeof S=="string"&&_&&typeof _!="function"&&typeof _!="symbol"?(_=Tf(S),S=at(G).hoistableScripts,O=S.get(_),O||(O={type:"script",instance:null,count:0,state:null},S.set(_,O)),O):{type:"void",instance:null,count:0,state:null};default:throw Error(c(444,h))}}function td(h){return'href="'+Ua(h)+'"'}function $p(h){return'link[rel="stylesheet"]['+h+"]"}function lx(h){return xe({},h,{"data-precedence":h.precedence,precedence:null})}function zb(h,_,S,O){h.querySelector('link[rel="preload"][as="style"]['+_+"]")?O.loading=1:(_=h.createElement("link"),O.preload=_,_.addEventListener("load",function(){return O.loading|=1}),_.addEventListener("error",function(){return O.loading|=2}),Po(_,"link",S),vt(_),h.head.appendChild(_))}function Tf(h){return'[src="'+Ua(h)+'"]'}function Xp(h){return"script[async]"+h}function kb(h,_,S){if(_.count++,_.instance===null)switch(_.type){case"style":var O=h.querySelector('style[data-href~="'+Ua(S.href)+'"]');if(O)return _.instance=O,vt(O),O;var G=xe({},S,{"data-href":S.href,"data-precedence":S.precedence,href:null,precedence:null});return O=(h.ownerDocument||h).createElement("style"),vt(O),Po(O,"style",G),Eg(O,S.precedence,h),_.instance=O;case"stylesheet":G=td(S.href);var te=h.querySelector($p(G));if(te)return _.state.loading|=4,_.instance=te,vt(te),te;O=lx(S),(G=So.get(G))&&cv(O,G),te=(h.ownerDocument||h).createElement("link"),vt(te);var Me=te;return Me._p=new Promise(function(He,mt){Me.onload=He,Me.onerror=mt}),Po(te,"link",O),_.state.loading|=4,Eg(te,S.precedence,h),_.instance=te;case"script":return te=Tf(S.src),(G=h.querySelector(Xp(te)))?(_.instance=G,vt(G),G):(O=S,(G=So.get(te))&&(O=xe({},S),Af(O,G)),h=h.ownerDocument||h,G=h.createElement("script"),vt(G),Po(G,"link",O),h.head.appendChild(G),_.instance=G);case"void":return null;default:throw Error(c(443,_.type))}else _.type==="stylesheet"&&(_.state.loading&4)===0&&(O=_.instance,_.state.loading|=4,Eg(O,S.precedence,h));return _.instance}function Eg(h,_,S){for(var O=S.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),G=O.length?O[O.length-1]:null,te=G,Me=0;Me<O.length;Me++){var He=O[Me];if(He.dataset.precedence===_)te=He;else if(te!==G)break}te?te.parentNode.insertBefore(h,te.nextSibling):(_=S.nodeType===9?S.head:S,_.insertBefore(h,_.firstChild))}function cv(h,_){h.crossOrigin==null&&(h.crossOrigin=_.crossOrigin),h.referrerPolicy==null&&(h.referrerPolicy=_.referrerPolicy),h.title==null&&(h.title=_.title)}function Af(h,_){h.crossOrigin==null&&(h.crossOrigin=_.crossOrigin),h.referrerPolicy==null&&(h.referrerPolicy=_.referrerPolicy),h.integrity==null&&(h.integrity=_.integrity)}var Mg=null;function cx(h,_,S){if(Mg===null){var O=new Map,G=Mg=new Map;G.set(S,O)}else G=Mg,O=G.get(S),O||(O=new Map,G.set(S,O));if(O.has(h))return O;for(O.set(h,null),S=S.getElementsByTagName(h),G=0;G<S.length;G++){var te=S[G];if(!(te[St]||te[_e]||h==="link"&&te.getAttribute("rel")==="stylesheet")&&te.namespaceURI!=="http://www.w3.org/2000/svg"){var Me=te.getAttribute(_)||"";Me=h+Me;var He=O.get(Me);He?He.push(te):O.set(Me,[te])}}return O}function Fb(h,_,S){h=h.ownerDocument||h,h.head.insertBefore(S,_==="title"?h.querySelector("head > title"):null)}function iM(h,_,S){if(S===1||_.itemProp!=null)return!1;switch(h){case"meta":case"title":return!0;case"style":if(typeof _.precedence!="string"||typeof _.href!="string"||_.href==="")break;return!0;case"link":if(typeof _.rel!="string"||typeof _.href!="string"||_.href===""||_.onLoad||_.onError)break;switch(_.rel){case"stylesheet":return h=_.disabled,typeof _.precedence=="string"&&h==null;default:return!0}case"script":if(_.async&&typeof _.async!="function"&&typeof _.async!="symbol"&&!_.onLoad&&!_.onError&&_.src&&typeof _.src=="string")return!0}return!1}function Nb(h){return!(h.type==="stylesheet"&&(h.state.loading&3)===0)}var Tg=null;function rM(){}function aM(h,_,S){if(Tg===null)throw Error(c(475));var O=Tg;if(_.type==="stylesheet"&&(typeof S.media!="string"||matchMedia(S.media).matches!==!1)&&(_.state.loading&4)===0){if(_.instance===null){var G=td(S.href),te=h.querySelector($p(G));if(te){h=te._p,h!==null&&typeof h=="object"&&typeof h.then=="function"&&(O.count++,O=Ag.bind(O),h.then(O,O)),_.state.loading|=4,_.instance=te,vt(te);return}te=h.ownerDocument||h,S=lx(S),(G=So.get(G))&&cv(S,G),te=te.createElement("link"),vt(te);var Me=te;Me._p=new Promise(function(He,mt){Me.onload=He,Me.onerror=mt}),Po(te,"link",S),_.instance=te}O.stylesheets===null&&(O.stylesheets=new Map),O.stylesheets.set(_,h),(h=_.state.preload)&&(_.state.loading&3)===0&&(O.count++,_=Ag.bind(O),h.addEventListener("load",_),h.addEventListener("error",_))}}function oM(){if(Tg===null)throw Error(c(475));var h=Tg;return h.stylesheets&&h.count===0&&ux(h,h.stylesheets),0<h.count?function(_){var S=setTimeout(function(){if(h.stylesheets&&ux(h,h.stylesheets),h.unsuspend){var O=h.unsuspend;h.unsuspend=null,O()}},6e4);return h.unsuspend=_,function(){h.unsuspend=null,clearTimeout(S)}}:null}function Ag(){if(this.count--,this.count===0){if(this.stylesheets)ux(this,this.stylesheets);else if(this.unsuspend){var h=this.unsuspend;this.unsuspend=null,h()}}}var uv=null;function ux(h,_){h.stylesheets=null,h.unsuspend!==null&&(h.count++,uv=new Map,_.forEach(sM,h),uv=null,Ag.call(h))}function sM(h,_){if(!(_.state.loading&4)){var S=uv.get(h);if(S)var O=S.get(null);else{S=new Map,uv.set(h,S);for(var G=h.querySelectorAll("link[data-precedence],style[data-precedence]"),te=0;te<G.length;te++){var Me=G[te];(Me.nodeName==="LINK"||Me.getAttribute("media")!=="not all")&&(S.set(Me.dataset.precedence,Me),O=Me)}O&&S.set(null,O)}G=_.instance,Me=G.getAttribute("data-precedence"),te=S.get(Me)||O,te===O&&S.set(null,G),S.set(Me,G),this.count++,O=Ag.bind(this),G.addEventListener("load",O),G.addEventListener("error",O),te?te.parentNode.insertBefore(G,te.nextSibling):(h=h.nodeType===9?h.head:h,h.insertBefore(G,h.firstChild)),_.state.loading|=4}}var Cf={$$typeof:Y,Provider:null,Consumer:null,_currentValue:ln,_currentValue2:ln,_threadCount:0};function hx(h,_,S,O,G,te,Me,He){this.tag=1,this.containerInfo=h,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=oo(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=oo(0),this.hiddenUpdates=oo(null),this.identifierPrefix=O,this.onUncaughtError=G,this.onCaughtError=te,this.onRecoverableError=Me,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=He,this.incompleteTransitions=new Map}function dx(h,_,S,O,G,te,Me,He,mt,Vt,Sn,Fn){return h=new hx(h,_,S,Me,He,mt,Vt,Fn),_=1,te===!0&&(_|=24),te=Ut(3,null,null,_),h.current=te,te.stateNode=h,_=Lh(),_.refCount++,h.pooledCache=_,_.refCount++,te.memoizedState={element:O,isDehydrated:S,cache:_},Bp(te),h}function fx(h){return h?(h=Eu,h):Eu}function px(h,_,S,O,G,te){G=fx(G),O.context===null?O.context=G:O.pendingContext=G,O=ms(_),O.payload={element:S},te=te===void 0?null:te,te!==null&&(O.callback=te),S=tc(h,O,_),S!==null&&(ys(S,h,_),Zh(S,h,_))}function mx(h,_){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var S=h.retryLane;h.retryLane=S!==0&&S<_?S:_}}function hv(h,_){mx(h,_),(h=h.alternate)&&mx(h,_)}function gx(h){if(h.tag===13){var _=cs(h,67108864);_!==null&&ys(_,h,67108864),hv(h,67108864)}}var Cg=!0;function Bb(h,_,S,O){var G=Se.T;Se.T=null;var te=It.p;try{It.p=2,dv(h,_,S,O)}finally{It.p=te,Se.T=G}}function _x(h,_,S,O){var G=Se.T;Se.T=null;var te=It.p;try{It.p=8,dv(h,_,S,O)}finally{It.p=te,Se.T=G}}function dv(h,_,S,O){if(Cg){var G=vx(O);if(G===null)iv(h,_,O,nd,S),go(h,O);else if(xx(G,h,_,S,O))O.stopPropagation();else if(go(h,O),_&4&&-1<lM.indexOf(h)){for(;G!==null;){var te=we(G);if(te!==null)switch(te.tag){case 3:if(te=te.stateNode,te.current.memoizedState.isDehydrated){var Me=Kn(te.pendingLanes);if(Me!==0){var He=te;for(He.pendingLanes|=2,He.entangledLanes|=2;Me;){var mt=1<<31-Si(Me);He.entanglements[1]|=mt,Me&=~mt}al(te),(Rn&6)===0&&(mo=gt()+500,_g(0))}}break;case 13:He=cs(te,2),He!==null&&ys(He,te,2),pg(),hv(te,2)}if(te=vx(O),te===null&&iv(h,_,O,nd,S),te===G)break;G=te}G!==null&&O.stopPropagation()}else iv(h,_,O,null,S)}}function vx(h){return h=oi(h),fv(h)}var nd=null;function fv(h){if(nd=null,h=Mt(h),h!==null){var _=lt(h);if(_===null)h=null;else{var S=_.tag;if(S===13){if(h=ut(_),h!==null)return h;h=null}else if(S===3){if(_.stateNode.current.memoizedState.isDehydrated)return _.tag===3?_.stateNode.containerInfo:null;h=null}else _!==h&&(h=null)}}return nd=h,null}function Ub(h){switch(h){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Kt()){case an:return 2;case Xn:return 8;case On:case Jn:return 32;case Ni:return 268435456;default:return 32}default:return 32}}var yx=!1,id=null,rd=null,ad=null,Rg=new Map,Ig=new Map,Wu=[],lM="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function go(h,_){switch(h){case"focusin":case"focusout":id=null;break;case"dragenter":case"dragleave":rd=null;break;case"mouseover":case"mouseout":ad=null;break;case"pointerover":case"pointerout":Rg.delete(_.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ig.delete(_.pointerId)}}function xs(h,_,S,O,G,te){return h===null||h.nativeEvent!==te?(h={blockedOn:_,domEventName:S,eventSystemFlags:O,nativeEvent:te,targetContainers:[G]},_!==null&&(_=we(_),_!==null&&gx(_)),h):(h.eventSystemFlags|=O,_=h.targetContainers,G!==null&&_.indexOf(G)===-1&&_.push(G),h)}function xx(h,_,S,O,G){switch(_){case"focusin":return id=xs(id,h,_,S,O,G),!0;case"dragenter":return rd=xs(rd,h,_,S,O,G),!0;case"mouseover":return ad=xs(ad,h,_,S,O,G),!0;case"pointerover":var te=G.pointerId;return Rg.set(te,xs(Rg.get(te)||null,h,_,S,O,G)),!0;case"gotpointercapture":return te=G.pointerId,Ig.set(te,xs(Ig.get(te)||null,h,_,S,O,G)),!0}return!1}function pv(h){var _=Mt(h.target);if(_!==null){var S=lt(_);if(S!==null){if(_=S.tag,_===13){if(_=ut(S),_!==null){h.blockedOn=_,At(h.priority,function(){if(S.tag===13){var O=Bs(),G=cs(S,O);G!==null&&ys(G,S,O),hv(S,O)}});return}}else if(_===3&&S.stateNode.current.memoizedState.isDehydrated){h.blockedOn=S.tag===3?S.stateNode.containerInfo:null;return}}}h.blockedOn=null}function Rf(h){if(h.blockedOn!==null)return!1;for(var _=h.targetContainers;0<_.length;){var S=vx(h.nativeEvent);if(S===null){S=h.nativeEvent;var O=new S.constructor(S.type,S);Dd=O,S.target.dispatchEvent(O),Dd=null}else return _=we(S),_!==null&&gx(_),h.blockedOn=S,!1;_.shift()}return!0}function If(h,_,S){Rf(h)&&S.delete(_)}function cM(){yx=!1,id!==null&&Rf(id)&&(id=null),rd!==null&&Rf(rd)&&(rd=null),ad!==null&&Rf(ad)&&(ad=null),Rg.forEach(If),Ig.forEach(If)}function mv(h,_){h.blockedOn===_&&(h.blockedOn=null,yx||(yx=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,cM)))}var od=null;function Vb(h){od!==h&&(od=h,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){od===h&&(od=null);for(var _=0;_<h.length;_+=3){var S=h[_],O=h[_+1],G=h[_+2];if(typeof O!="function"){if(fv(O||S)===null)continue;break}var te=we(S);te!==null&&(h.splice(_,3),_-=3,Qa(te,{pending:!0,data:G,method:S.method,action:O},O,G))}}))}function Dg(h){function _(mt){return mv(mt,h)}id!==null&&mv(id,h),rd!==null&&mv(rd,h),ad!==null&&mv(ad,h),Rg.forEach(_),Ig.forEach(_);for(var S=0;S<Wu.length;S++){var O=Wu[S];O.blockedOn===h&&(O.blockedOn=null)}for(;0<Wu.length&&(S=Wu[0],S.blockedOn===null);)pv(S),S.blockedOn===null&&Wu.shift();if(S=(h.ownerDocument||h).$$reactFormReplay,S!=null)for(O=0;O<S.length;O+=3){var G=S[O],te=S[O+1],Me=G[Te]||null;if(typeof te=="function")Me||Vb(S);else if(Me){var He=null;if(te&&te.hasAttribute("formAction")){if(G=te,Me=te[Te]||null)He=Me.formAction;else if(fv(G)!==null)continue}else He=Me.action;typeof He=="function"?S[O+1]=He:(S.splice(O,3),O-=3),Vb(S)}}}function gv(h){this._internalRoot=h}Zp.prototype.render=gv.prototype.render=function(h){var _=this._internalRoot;if(_===null)throw Error(c(409));var S=_.current,O=Bs();px(S,O,h,_,null,null)},Zp.prototype.unmount=gv.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var _=h.containerInfo;h.tag===0&&jp(),px(h.current,2,null,h,null,null),pg(),_[je]=null}};function Zp(h){this._internalRoot=h}Zp.prototype.unstable_scheduleHydration=function(h){if(h){var _=Xo();h={blockedOn:null,target:h,priority:_};for(var S=0;S<Wu.length&&_!==0&&_<Wu[S].priority;S++);Wu.splice(S,0,h),S===0&&pv(h)}};var bx=e.version;if(bx!=="19.0.0")throw Error(c(527,bx,"19.0.0"));It.findDOMNode=function(h){var _=h._reactInternals;if(_===void 0)throw typeof h.render=="function"?Error(c(188)):(h=Object.keys(h).join(","),Error(c(268,h)));return h=kt(_),h=h!==null?_n(h):null,h=h===null?null:h.stateNode,h};var wx={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:Se,findFiberByHostInstance:Mt,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _v=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_v.isDisabled&&_v.supportsFiber)try{ci=_v.inject(wx),_i=_v}catch{}}return Wx.createRoot=function(h,_){if(!p(h))throw Error(c(299));var S=!1,O="",G=qh,te=Pp,Me=cf,He=null;return _!=null&&(_.unstable_strictMode===!0&&(S=!0),_.identifierPrefix!==void 0&&(O=_.identifierPrefix),_.onUncaughtError!==void 0&&(G=_.onUncaughtError),_.onCaughtError!==void 0&&(te=_.onCaughtError),_.onRecoverableError!==void 0&&(Me=_.onRecoverableError),_.unstable_transitionCallbacks!==void 0&&(He=_.unstable_transitionCallbacks)),_=dx(h,1,!1,null,null,S,O,G,te,Me,He,null),h[je]=_.current,tv(h.nodeType===8?h.parentNode:h),new gv(_)},Wx.hydrateRoot=function(h,_,S){if(!p(h))throw Error(c(299));var O=!1,G="",te=qh,Me=Pp,He=cf,mt=null,Vt=null;return S!=null&&(S.unstable_strictMode===!0&&(O=!0),S.identifierPrefix!==void 0&&(G=S.identifierPrefix),S.onUncaughtError!==void 0&&(te=S.onUncaughtError),S.onCaughtError!==void 0&&(Me=S.onCaughtError),S.onRecoverableError!==void 0&&(He=S.onRecoverableError),S.unstable_transitionCallbacks!==void 0&&(mt=S.unstable_transitionCallbacks),S.formState!==void 0&&(Vt=S.formState)),_=dx(h,1,!0,_,S??null,O,G,te,Me,He,mt,Vt),_.context=fx(null),S=_.current,O=Bs(),G=ms(O),G.callback=null,tc(S,G,O),_.current.lanes=O,Sr(_,O),al(_),h[je]=_.current,tv(h),new Zp(_)},Wx.version="19.0.0",Wx}var dP;function nU(){if(dP)return iT.exports;dP=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),iT.exports=tU(),iT.exports}var iU=nU(),$x={},fP;function rU(){if(fP)return $x;fP=1,Object.defineProperty($x,"__esModule",{value:!0}),$x.parse=M,$x.serialize=k;const t=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,a=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,c=/^[\u0020-\u003A\u003D-\u007E]*$/,p=Object.prototype.toString,y=(()=>{const H=function(){};return H.prototype=Object.create(null),H})();function M(H,Y){const X=new y,Q=H.length;if(Q<2)return X;const J=(Y==null?void 0:Y.decode)||B;let j=0;do{const oe=H.indexOf("=",j);if(oe===-1)break;const ce=H.indexOf(";",j),pe=ce===-1?Q:ce;if(oe>pe){j=H.lastIndexOf(";",oe-1)+1;continue}const Ae=r(H,j,oe),Ee=I(H,oe,Ae),be=H.slice(Ae,Ee);if(X[be]===void 0){let Ve=r(H,oe+1,pe),Se=I(H,pe,Ve);const xe=J(H.slice(Ve,Se));X[be]=xe}j=pe+1}while(j<Q);return X}function r(H,Y,X){do{const Q=H.charCodeAt(Y);if(Q!==32&&Q!==9)return Y}while(++Y<X);return X}function I(H,Y,X){for(;Y>X;){const Q=H.charCodeAt(--Y);if(Q!==32&&Q!==9)return Y+1}return X}function k(H,Y,X){const Q=(X==null?void 0:X.encode)||encodeURIComponent;if(!t.test(H))throw new TypeError(`argument name is invalid: ${H}`);const J=Q(Y);if(!e.test(J))throw new TypeError(`argument val is invalid: ${Y}`);let j=H+"="+J;if(!X)return j;if(X.maxAge!==void 0){if(!Number.isInteger(X.maxAge))throw new TypeError(`option maxAge is invalid: ${X.maxAge}`);j+="; Max-Age="+X.maxAge}if(X.domain){if(!a.test(X.domain))throw new TypeError(`option domain is invalid: ${X.domain}`);j+="; Domain="+X.domain}if(X.path){if(!c.test(X.path))throw new TypeError(`option path is invalid: ${X.path}`);j+="; Path="+X.path}if(X.expires){if(!U(X.expires)||!Number.isFinite(X.expires.valueOf()))throw new TypeError(`option expires is invalid: ${X.expires}`);j+="; Expires="+X.expires.toUTCString()}if(X.httpOnly&&(j+="; HttpOnly"),X.secure&&(j+="; Secure"),X.partitioned&&(j+="; Partitioned"),X.priority)switch(typeof X.priority=="string"?X.priority.toLowerCase():void 0){case"low":j+="; Priority=Low";break;case"medium":j+="; Priority=Medium";break;case"high":j+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${X.priority}`)}if(X.sameSite)switch(typeof X.sameSite=="string"?X.sameSite.toLowerCase():X.sameSite){case!0:case"strict":j+="; SameSite=Strict";break;case"lax":j+="; SameSite=Lax";break;case"none":j+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${X.sameSite}`)}return j}function B(H){if(H.indexOf("%")===-1)return H;try{return decodeURIComponent(H)}catch{return H}}function U(H){return p.call(H)==="[object Date]"}return $x}rU();/**
 * react-router v7.3.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var pP="popstate";function aU(t={}){function e(c,p){let{pathname:y,search:M,hash:r}=c.location;return S2("",{pathname:y,search:M,hash:r},p.state&&p.state.usr||null,p.state&&p.state.key||"default")}function a(c,p){return typeof p=="string"?p:F0(p)}return sU(e,a,null,t)}function ao(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function dh(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function oU(){return Math.random().toString(36).substring(2,10)}function mP(t,e){return{usr:t.state,key:t.key,idx:e}}function S2(t,e,a=null,c){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Py(e):e,state:a,key:e&&e.key||c||oU()}}function F0({pathname:t="/",search:e="",hash:a=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),a&&a!=="#"&&(t+=a.charAt(0)==="#"?a:"#"+a),t}function Py(t){let e={};if(t){let a=t.indexOf("#");a>=0&&(e.hash=t.substring(a),t=t.substring(0,a));let c=t.indexOf("?");c>=0&&(e.search=t.substring(c),t=t.substring(0,c)),t&&(e.pathname=t)}return e}function sU(t,e,a,c={}){let{window:p=document.defaultView,v5Compat:y=!1}=c,M=p.history,r="POP",I=null,k=B();k==null&&(k=0,M.replaceState({...M.state,idx:k},""));function B(){return(M.state||{idx:null}).idx}function U(){r="POP";let J=B(),j=J==null?null:J-k;k=J,I&&I({action:r,location:Q.location,delta:j})}function H(J,j){r="PUSH";let oe=S2(Q.location,J,j);k=B()+1;let ce=mP(oe,k),pe=Q.createHref(oe);try{M.pushState(ce,"",pe)}catch(Ae){if(Ae instanceof DOMException&&Ae.name==="DataCloneError")throw Ae;p.location.assign(pe)}y&&I&&I({action:r,location:Q.location,delta:1})}function Y(J,j){r="REPLACE";let oe=S2(Q.location,J,j);k=B();let ce=mP(oe,k),pe=Q.createHref(oe);M.replaceState(ce,"",pe),y&&I&&I({action:r,location:Q.location,delta:0})}function X(J){let j=p.location.origin!=="null"?p.location.origin:p.location.href,oe=typeof J=="string"?J:F0(J);return oe=oe.replace(/ $/,"%20"),ao(j,`No window.location.(origin|href) available to create URL for href: ${oe}`),new URL(oe,j)}let Q={get action(){return r},get location(){return t(p,M)},listen(J){if(I)throw new Error("A history only accepts one active listener");return p.addEventListener(pP,U),I=J,()=>{p.removeEventListener(pP,U),I=null}},createHref(J){return e(p,J)},createURL:X,encodeLocation(J){let j=X(J);return{pathname:j.pathname,search:j.search,hash:j.hash}},push:H,replace:Y,go(J){return M.go(J)}};return Q}function YL(t,e,a="/"){return lU(t,e,a,!1)}function lU(t,e,a,c){let p=typeof e=="string"?Py(e):e,y=Kf(p.pathname||"/",a);if(y==null)return null;let M=KL(t);cU(M);let r=null;for(let I=0;r==null&&I<M.length;++I){let k=xU(y);r=vU(M[I],k,c)}return r}function KL(t,e=[],a=[],c=""){let p=(y,M,r)=>{let I={relativePath:r===void 0?y.path||"":r,caseSensitive:y.caseSensitive===!0,childrenIndex:M,route:y};I.relativePath.startsWith("/")&&(ao(I.relativePath.startsWith(c),`Absolute route path "${I.relativePath}" nested under path "${c}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),I.relativePath=I.relativePath.slice(c.length));let k=$f([c,I.relativePath]),B=a.concat(I);y.children&&y.children.length>0&&(ao(y.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${k}".`),KL(y.children,e,B,k)),!(y.path==null&&!y.index)&&e.push({path:k,score:gU(k,y.index),routesMeta:B})};return t.forEach((y,M)=>{var r;if(y.path===""||!((r=y.path)!=null&&r.includes("?")))p(y,M);else for(let I of JL(y.path))p(y,M,I)}),e}function JL(t){let e=t.split("/");if(e.length===0)return[];let[a,...c]=e,p=a.endsWith("?"),y=a.replace(/\?$/,"");if(c.length===0)return p?[y,""]:[y];let M=JL(c.join("/")),r=[];return r.push(...M.map(I=>I===""?y:[y,I].join("/"))),p&&r.push(...M),r.map(I=>t.startsWith("/")&&I===""?"/":I)}function cU(t){t.sort((e,a)=>e.score!==a.score?a.score-e.score:_U(e.routesMeta.map(c=>c.childrenIndex),a.routesMeta.map(c=>c.childrenIndex)))}var uU=/^:[\w-]+$/,hU=3,dU=2,fU=1,pU=10,mU=-2,gP=t=>t==="*";function gU(t,e){let a=t.split("/"),c=a.length;return a.some(gP)&&(c+=mU),e&&(c+=dU),a.filter(p=>!gP(p)).reduce((p,y)=>p+(uU.test(y)?hU:y===""?fU:pU),c)}function _U(t,e){return t.length===e.length&&t.slice(0,-1).every((c,p)=>c===e[p])?t[t.length-1]-e[e.length-1]:0}function vU(t,e,a=!1){let{routesMeta:c}=t,p={},y="/",M=[];for(let r=0;r<c.length;++r){let I=c[r],k=r===c.length-1,B=y==="/"?e:e.slice(y.length)||"/",U=VS({path:I.relativePath,caseSensitive:I.caseSensitive,end:k},B),H=I.route;if(!U&&k&&a&&!c[c.length-1].route.index&&(U=VS({path:I.relativePath,caseSensitive:I.caseSensitive,end:!1},B)),!U)return null;Object.assign(p,U.params),M.push({params:p,pathname:$f([y,U.pathname]),pathnameBase:EU($f([y,U.pathnameBase])),route:H}),U.pathnameBase!=="/"&&(y=$f([y,U.pathnameBase]))}return M}function VS(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[a,c]=yU(t.path,t.caseSensitive,t.end),p=e.match(a);if(!p)return null;let y=p[0],M=y.replace(/(.)\/+$/,"$1"),r=p.slice(1);return{params:c.reduce((k,{paramName:B,isOptional:U},H)=>{if(B==="*"){let X=r[H]||"";M=y.slice(0,y.length-X.length).replace(/(.)\/+$/,"$1")}const Y=r[H];return U&&!Y?k[B]=void 0:k[B]=(Y||"").replace(/%2F/g,"/"),k},{}),pathname:y,pathnameBase:M,pattern:t}}function yU(t,e=!1,a=!0){dh(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let c=[],p="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(M,r,I)=>(c.push({paramName:r,isOptional:I!=null}),I?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(c.push({paramName:"*"}),p+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?p+="\\/*$":t!==""&&t!=="/"&&(p+="(?:(?=\\/|$))"),[new RegExp(p,e?void 0:"i"),c]}function xU(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return dh(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Kf(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let a=e.endsWith("/")?e.length-1:e.length,c=t.charAt(a);return c&&c!=="/"?null:t.slice(a)||"/"}function bU(t,e="/"){let{pathname:a,search:c="",hash:p=""}=typeof t=="string"?Py(t):t;return{pathname:a?a.startsWith("/")?a:wU(a,e):e,search:MU(c),hash:TU(p)}}function wU(t,e){let a=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(p=>{p===".."?a.length>1&&a.pop():p!=="."&&a.push(p)}),a.length>1?a.join("/"):"/"}function sT(t,e,a,c){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(c)}].  Please separate it out to the \`to.${a}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function SU(t){return t.filter((e,a)=>a===0||e.route.path&&e.route.path.length>0)}function QL(t){let e=SU(t);return e.map((a,c)=>c===e.length-1?a.pathname:a.pathnameBase)}function eO(t,e,a,c=!1){let p;typeof t=="string"?p=Py(t):(p={...t},ao(!p.pathname||!p.pathname.includes("?"),sT("?","pathname","search",p)),ao(!p.pathname||!p.pathname.includes("#"),sT("#","pathname","hash",p)),ao(!p.search||!p.search.includes("#"),sT("#","search","hash",p)));let y=t===""||p.pathname==="",M=y?"/":p.pathname,r;if(M==null)r=a;else{let U=e.length-1;if(!c&&M.startsWith("..")){let H=M.split("/");for(;H[0]==="..";)H.shift(),U-=1;p.pathname=H.join("/")}r=U>=0?e[U]:"/"}let I=bU(p,r),k=M&&M!=="/"&&M.endsWith("/"),B=(y||M===".")&&a.endsWith("/");return!I.pathname.endsWith("/")&&(k||B)&&(I.pathname+="/"),I}var $f=t=>t.join("/").replace(/\/\/+/g,"/"),EU=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),MU=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,TU=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function AU(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var tO=["POST","PUT","PATCH","DELETE"];new Set(tO);var CU=["GET",...tO];new Set(CU);var Ly=le.createContext(null);Ly.displayName="DataRouter";var fE=le.createContext(null);fE.displayName="DataRouterState";var nO=le.createContext({isTransitioning:!1});nO.displayName="ViewTransition";var RU=le.createContext(new Map);RU.displayName="Fetchers";var IU=le.createContext(null);IU.displayName="Await";var Rd=le.createContext(null);Rd.displayName="Navigation";var Z0=le.createContext(null);Z0.displayName="Location";var np=le.createContext({outlet:null,matches:[],isDataRoute:!1});np.displayName="Route";var PC=le.createContext(null);PC.displayName="RouteError";function DU(t,{relative:e}={}){ao(Y0(),"useHref() may be used only in the context of a <Router> component.");let{basename:a,navigator:c}=le.useContext(Rd),{hash:p,pathname:y,search:M}=K0(t,{relative:e}),r=y;return a!=="/"&&(r=y==="/"?a:$f([a,y])),c.createHref({pathname:r,search:M,hash:p})}function Y0(){return le.useContext(Z0)!=null}function Dm(){return ao(Y0(),"useLocation() may be used only in the context of a <Router> component."),le.useContext(Z0).location}var iO="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function rO(t){le.useContext(Rd).static||le.useLayoutEffect(t)}function aO(){let{isDataRoute:t}=le.useContext(np);return t?HU():PU()}function PU(){ao(Y0(),"useNavigate() may be used only in the context of a <Router> component.");let t=le.useContext(Ly),{basename:e,navigator:a}=le.useContext(Rd),{matches:c}=le.useContext(np),{pathname:p}=Dm(),y=JSON.stringify(QL(c)),M=le.useRef(!1);return rO(()=>{M.current=!0}),le.useCallback((I,k={})=>{if(dh(M.current,iO),!M.current)return;if(typeof I=="number"){a.go(I);return}let B=eO(I,JSON.parse(y),p,k.relative==="path");t==null&&e!=="/"&&(B.pathname=B.pathname==="/"?e:$f([e,B.pathname])),(k.replace?a.replace:a.push)(B,k.state,k)},[e,a,y,p,t])}le.createContext(null);function K0(t,{relative:e}={}){let{matches:a}=le.useContext(np),{pathname:c}=Dm(),p=JSON.stringify(QL(a));return le.useMemo(()=>eO(t,JSON.parse(p),c,e==="path"),[t,p,c,e])}function LU(t,e){return oO(t,e)}function oO(t,e,a,c){var oe;ao(Y0(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:p,static:y}=le.useContext(Rd),{matches:M}=le.useContext(np),r=M[M.length-1],I=r?r.params:{},k=r?r.pathname:"/",B=r?r.pathnameBase:"/",U=r&&r.route;{let ce=U&&U.path||"";sO(k,!U||ce.endsWith("*")||ce.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${k}" (under <Route path="${ce}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${ce}"> to <Route path="${ce==="/"?"*":`${ce}/*`}">.`)}let H=Dm(),Y;if(e){let ce=typeof e=="string"?Py(e):e;ao(B==="/"||((oe=ce.pathname)==null?void 0:oe.startsWith(B)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${B}" but pathname "${ce.pathname}" was given in the \`location\` prop.`),Y=ce}else Y=H;let X=Y.pathname||"/",Q=X;if(B!=="/"){let ce=B.replace(/^\//,"").split("/");Q="/"+X.replace(/^\//,"").split("/").slice(ce.length).join("/")}let J=!y&&a&&a.matches&&a.matches.length>0?a.matches:YL(t,{pathname:Q});dh(U||J!=null,`No routes matched location "${Y.pathname}${Y.search}${Y.hash}" `),dh(J==null||J[J.length-1].route.element!==void 0||J[J.length-1].route.Component!==void 0||J[J.length-1].route.lazy!==void 0,`Matched leaf route at location "${Y.pathname}${Y.search}${Y.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let j=NU(J&&J.map(ce=>Object.assign({},ce,{params:Object.assign({},I,ce.params),pathname:$f([B,p.encodeLocation?p.encodeLocation(ce.pathname).pathname:ce.pathname]),pathnameBase:ce.pathnameBase==="/"?B:$f([B,p.encodeLocation?p.encodeLocation(ce.pathnameBase).pathname:ce.pathnameBase])})),M,a,c);return e&&j?le.createElement(Z0.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...Y},navigationType:"POP"}},j):j}function OU(){let t=GU(),e=AU(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),a=t instanceof Error?t.stack:null,c="rgba(200,200,200, 0.5)",p={padding:"0.5rem",backgroundColor:c},y={padding:"2px 4px",backgroundColor:c},M=null;return console.error("Error handled by React Router default ErrorBoundary:",t),M=le.createElement(le.Fragment,null,le.createElement("p",null,"💿 Hey developer 👋"),le.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",le.createElement("code",{style:y},"ErrorBoundary")," or"," ",le.createElement("code",{style:y},"errorElement")," prop on your route.")),le.createElement(le.Fragment,null,le.createElement("h2",null,"Unexpected Application Error!"),le.createElement("h3",{style:{fontStyle:"italic"}},e),a?le.createElement("pre",{style:p},a):null,M)}var zU=le.createElement(OU,null),kU=class extends le.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return this.state.error!==void 0?le.createElement(np.Provider,{value:this.props.routeContext},le.createElement(PC.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function FU({routeContext:t,match:e,children:a}){let c=le.useContext(Ly);return c&&c.static&&c.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(c.staticContext._deepestRenderedBoundaryId=e.route.id),le.createElement(np.Provider,{value:t},a)}function NU(t,e=[],a=null,c=null){if(t==null){if(!a)return null;if(a.errors)t=a.matches;else if(e.length===0&&!a.initialized&&a.matches.length>0)t=a.matches;else return null}let p=t,y=a==null?void 0:a.errors;if(y!=null){let I=p.findIndex(k=>k.route.id&&(y==null?void 0:y[k.route.id])!==void 0);ao(I>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(y).join(",")}`),p=p.slice(0,Math.min(p.length,I+1))}let M=!1,r=-1;if(a)for(let I=0;I<p.length;I++){let k=p[I];if((k.route.HydrateFallback||k.route.hydrateFallbackElement)&&(r=I),k.route.id){let{loaderData:B,errors:U}=a,H=k.route.loader&&!B.hasOwnProperty(k.route.id)&&(!U||U[k.route.id]===void 0);if(k.route.lazy||H){M=!0,r>=0?p=p.slice(0,r+1):p=[p[0]];break}}}return p.reduceRight((I,k,B)=>{let U,H=!1,Y=null,X=null;a&&(U=y&&k.route.id?y[k.route.id]:void 0,Y=k.route.errorElement||zU,M&&(r<0&&B===0?(sO("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),H=!0,X=null):r===B&&(H=!0,X=k.route.hydrateFallbackElement||null)));let Q=e.concat(p.slice(0,B+1)),J=()=>{let j;return U?j=Y:H?j=X:k.route.Component?j=le.createElement(k.route.Component,null):k.route.element?j=k.route.element:j=I,le.createElement(FU,{match:k,routeContext:{outlet:I,matches:Q,isDataRoute:a!=null},children:j})};return a&&(k.route.ErrorBoundary||k.route.errorElement||B===0)?le.createElement(kU,{location:a.location,revalidation:a.revalidation,component:Y,error:U,children:J(),routeContext:{outlet:null,matches:Q,isDataRoute:!0}}):J()},null)}function LC(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function BU(t){let e=le.useContext(Ly);return ao(e,LC(t)),e}function UU(t){let e=le.useContext(fE);return ao(e,LC(t)),e}function VU(t){let e=le.useContext(np);return ao(e,LC(t)),e}function OC(t){let e=VU(t),a=e.matches[e.matches.length-1];return ao(a.route.id,`${t} can only be used on routes that contain a unique "id"`),a.route.id}function jU(){return OC("useRouteId")}function GU(){var c;let t=le.useContext(PC),e=UU("useRouteError"),a=OC("useRouteError");return t!==void 0?t:(c=e.errors)==null?void 0:c[a]}function HU(){let{router:t}=BU("useNavigate"),e=OC("useNavigate"),a=le.useRef(!1);return rO(()=>{a.current=!0}),le.useCallback(async(p,y={})=>{dh(a.current,iO),a.current&&(typeof p=="number"?t.navigate(p):await t.navigate(p,{fromRouteId:e,...y}))},[t,e])}var _P={};function sO(t,e,a){!e&&!_P[t]&&(_P[t]=!0,dh(!1,a))}le.memo(qU);function qU({routes:t,future:e,state:a}){return oO(t,void 0,a,e)}function n0(t){ao(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function WU({basename:t="/",children:e=null,location:a,navigationType:c="POP",navigator:p,static:y=!1}){ao(!Y0(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let M=t.replace(/^\/*/,"/"),r=le.useMemo(()=>({basename:M,navigator:p,static:y,future:{}}),[M,p,y]);typeof a=="string"&&(a=Py(a));let{pathname:I="/",search:k="",hash:B="",state:U=null,key:H="default"}=a,Y=le.useMemo(()=>{let X=Kf(I,M);return X==null?null:{location:{pathname:X,search:k,hash:B,state:U,key:H},navigationType:c}},[M,I,k,B,U,H,c]);return dh(Y!=null,`<Router basename="${M}"> is not able to match the URL "${I}${k}${B}" because it does not start with the basename, so the <Router> won't render anything.`),Y==null?null:le.createElement(Rd.Provider,{value:r},le.createElement(Z0.Provider,{children:e,value:Y}))}function $U({children:t,location:e}){return LU(E2(t),e)}function E2(t,e=[]){let a=[];return le.Children.forEach(t,(c,p)=>{if(!le.isValidElement(c))return;let y=[...e,p];if(c.type===le.Fragment){a.push.apply(a,E2(c.props.children,y));return}ao(c.type===n0,`[${typeof c.type=="string"?c.type:c.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ao(!c.props.index||!c.props.children,"An index route cannot have child routes.");let M={id:c.props.id||y.join("-"),caseSensitive:c.props.caseSensitive,element:c.props.element,Component:c.props.Component,index:c.props.index,path:c.props.path,loader:c.props.loader,action:c.props.action,hydrateFallbackElement:c.props.hydrateFallbackElement,HydrateFallback:c.props.HydrateFallback,errorElement:c.props.errorElement,ErrorBoundary:c.props.ErrorBoundary,hasErrorBoundary:c.props.hasErrorBoundary===!0||c.props.ErrorBoundary!=null||c.props.errorElement!=null,shouldRevalidate:c.props.shouldRevalidate,handle:c.props.handle,lazy:c.props.lazy};c.props.children&&(M.children=E2(c.props.children,y)),a.push(M)}),a}var ew="get",tw="application/x-www-form-urlencoded";function pE(t){return t!=null&&typeof t.tagName=="string"}function XU(t){return pE(t)&&t.tagName.toLowerCase()==="button"}function ZU(t){return pE(t)&&t.tagName.toLowerCase()==="form"}function YU(t){return pE(t)&&t.tagName.toLowerCase()==="input"}function KU(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function JU(t,e){return t.button===0&&(!e||e==="_self")&&!KU(t)}function M2(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,a)=>{let c=t[a];return e.concat(Array.isArray(c)?c.map(p=>[a,p]):[[a,c]])},[]))}function QU(t,e){let a=M2(t);return e&&e.forEach((c,p)=>{a.has(p)||e.getAll(p).forEach(y=>{a.append(p,y)})}),a}var v1=null;function e5(){if(v1===null)try{new FormData(document.createElement("form"),0),v1=!1}catch{v1=!0}return v1}var t5=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function lT(t){return t!=null&&!t5.has(t)?(dh(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${tw}"`),null):t}function n5(t,e){let a,c,p,y,M;if(ZU(t)){let r=t.getAttribute("action");c=r?Kf(r,e):null,a=t.getAttribute("method")||ew,p=lT(t.getAttribute("enctype"))||tw,y=new FormData(t)}else if(XU(t)||YU(t)&&(t.type==="submit"||t.type==="image")){let r=t.form;if(r==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let I=t.getAttribute("formaction")||r.getAttribute("action");if(c=I?Kf(I,e):null,a=t.getAttribute("formmethod")||r.getAttribute("method")||ew,p=lT(t.getAttribute("formenctype"))||lT(r.getAttribute("enctype"))||tw,y=new FormData(r,t),!e5()){let{name:k,type:B,value:U}=t;if(B==="image"){let H=k?`${k}.`:"";y.append(`${H}x`,"0"),y.append(`${H}y`,"0")}else k&&y.append(k,U)}}else{if(pE(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');a=ew,c=null,p=tw,M=t}return y&&p==="text/plain"&&(M=y,y=void 0),{action:c,method:a.toLowerCase(),encType:p,formData:y,body:M}}function zC(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}async function i5(t,e){if(t.id in e)return e[t.id];try{let a=await import(t.module);return e[t.id]=a,a}catch(a){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(a),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function r5(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function a5(t,e,a){let c=await Promise.all(t.map(async p=>{let y=e.routes[p.route.id];if(y){let M=await i5(y,a);return M.links?M.links():[]}return[]}));return c5(c.flat(1).filter(r5).filter(p=>p.rel==="stylesheet"||p.rel==="preload").map(p=>p.rel==="stylesheet"?{...p,rel:"prefetch",as:"style"}:{...p,rel:"prefetch"}))}function vP(t,e,a,c,p,y){let M=(I,k)=>a[k]?I.route.id!==a[k].route.id:!0,r=(I,k)=>{var B;return a[k].pathname!==I.pathname||((B=a[k].route.path)==null?void 0:B.endsWith("*"))&&a[k].params["*"]!==I.params["*"]};return y==="assets"?e.filter((I,k)=>M(I,k)||r(I,k)):y==="data"?e.filter((I,k)=>{var U;let B=c.routes[I.route.id];if(!B||!B.hasLoader)return!1;if(M(I,k)||r(I,k))return!0;if(I.route.shouldRevalidate){let H=I.route.shouldRevalidate({currentUrl:new URL(p.pathname+p.search+p.hash,window.origin),currentParams:((U=a[0])==null?void 0:U.params)||{},nextUrl:new URL(t,window.origin),nextParams:I.params,defaultShouldRevalidate:!0});if(typeof H=="boolean")return H}return!0}):[]}function o5(t,e,{includeHydrateFallback:a}={}){return s5(t.map(c=>{let p=e.routes[c.route.id];if(!p)return[];let y=[p.module];return p.clientActionModule&&(y=y.concat(p.clientActionModule)),p.clientLoaderModule&&(y=y.concat(p.clientLoaderModule)),a&&p.hydrateFallbackModule&&(y=y.concat(p.hydrateFallbackModule)),p.imports&&(y=y.concat(p.imports)),y}).flat(1))}function s5(t){return[...new Set(t)]}function l5(t){let e={},a=Object.keys(t).sort();for(let c of a)e[c]=t[c];return e}function c5(t,e){let a=new Set;return new Set(e),t.reduce((c,p)=>{let y=JSON.stringify(l5(p));return a.has(y)||(a.add(y),c.push({key:y,link:p})),c},[])}function u5(t,e){let a=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return a.pathname==="/"?a.pathname="_root.data":e&&Kf(a.pathname,e)==="/"?a.pathname=`${e.replace(/\/$/,"")}/_root.data`:a.pathname=`${a.pathname.replace(/\/$/,"")}.data`,a}function lO(){let t=le.useContext(Ly);return zC(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function h5(){let t=le.useContext(fE);return zC(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var kC=le.createContext(void 0);kC.displayName="FrameworkContext";function cO(){let t=le.useContext(kC);return zC(t,"You must render this element inside a <HydratedRouter> element"),t}function d5(t,e){let a=le.useContext(kC),[c,p]=le.useState(!1),[y,M]=le.useState(!1),{onFocus:r,onBlur:I,onMouseEnter:k,onMouseLeave:B,onTouchStart:U}=e,H=le.useRef(null);le.useEffect(()=>{if(t==="render"&&M(!0),t==="viewport"){let Q=j=>{j.forEach(oe=>{M(oe.isIntersecting)})},J=new IntersectionObserver(Q,{threshold:.5});return H.current&&J.observe(H.current),()=>{J.disconnect()}}},[t]),le.useEffect(()=>{if(c){let Q=setTimeout(()=>{M(!0)},100);return()=>{clearTimeout(Q)}}},[c]);let Y=()=>{p(!0)},X=()=>{p(!1),M(!1)};return a?t!=="intent"?[y,H,{}]:[y,H,{onFocus:Xx(r,Y),onBlur:Xx(I,X),onMouseEnter:Xx(k,Y),onMouseLeave:Xx(B,X),onTouchStart:Xx(U,Y)}]:[!1,H,{}]}function Xx(t,e){return a=>{t&&t(a),a.defaultPrevented||e(a)}}function f5({page:t,...e}){let{router:a}=lO(),c=le.useMemo(()=>YL(a.routes,t,a.basename),[a.routes,t,a.basename]);return c?le.createElement(m5,{page:t,matches:c,...e}):null}function p5(t){let{manifest:e,routeModules:a}=cO(),[c,p]=le.useState([]);return le.useEffect(()=>{let y=!1;return a5(t,e,a).then(M=>{y||p(M)}),()=>{y=!0}},[t,e,a]),c}function m5({page:t,matches:e,...a}){let c=Dm(),{manifest:p,routeModules:y}=cO(),{basename:M}=lO(),{loaderData:r,matches:I}=h5(),k=le.useMemo(()=>vP(t,e,I,p,c,"data"),[t,e,I,p,c]),B=le.useMemo(()=>vP(t,e,I,p,c,"assets"),[t,e,I,p,c]),U=le.useMemo(()=>{if(t===c.pathname+c.search+c.hash)return[];let X=new Set,Q=!1;if(e.forEach(j=>{var ce;let oe=p.routes[j.route.id];!oe||!oe.hasLoader||(!k.some(pe=>pe.route.id===j.route.id)&&j.route.id in r&&((ce=y[j.route.id])!=null&&ce.shouldRevalidate)||oe.hasClientLoader?Q=!0:X.add(j.route.id))}),X.size===0)return[];let J=u5(t,M);return Q&&X.size>0&&J.searchParams.set("_routes",e.filter(j=>X.has(j.route.id)).map(j=>j.route.id).join(",")),[J.pathname+J.search]},[M,r,c,p,k,e,t,y]),H=le.useMemo(()=>o5(B,p),[B,p]),Y=p5(B);return le.createElement(le.Fragment,null,U.map(X=>le.createElement("link",{key:X,rel:"prefetch",as:"fetch",href:X,...a})),H.map(X=>le.createElement("link",{key:X,rel:"modulepreload",href:X,...a})),Y.map(({key:X,link:Q})=>le.createElement("link",{key:X,...Q})))}function g5(...t){return e=>{t.forEach(a=>{typeof a=="function"?a(e):a!=null&&(a.current=e)})}}var uO=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{uO&&(window.__reactRouterVersion="7.3.0")}catch{}function _5({basename:t,children:e,window:a}){let c=le.useRef();c.current==null&&(c.current=aU({window:a,v5Compat:!0}));let p=c.current,[y,M]=le.useState({action:p.action,location:p.location}),r=le.useCallback(I=>{le.startTransition(()=>M(I))},[M]);return le.useLayoutEffect(()=>p.listen(r),[p,r]),le.createElement(WU,{basename:t,children:e,location:y.location,navigationType:y.action,navigator:p})}var hO=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,dO=le.forwardRef(function({onClick:e,discover:a="render",prefetch:c="none",relative:p,reloadDocument:y,replace:M,state:r,target:I,to:k,preventScrollReset:B,viewTransition:U,...H},Y){let{basename:X}=le.useContext(Rd),Q=typeof k=="string"&&hO.test(k),J,j=!1;if(typeof k=="string"&&Q&&(J=k,uO))try{let Se=new URL(window.location.href),xe=k.startsWith("//")?new URL(Se.protocol+k):new URL(k),Fe=Kf(xe.pathname,X);xe.origin===Se.origin&&Fe!=null?k=Fe+xe.search+xe.hash:j=!0}catch{dh(!1,`<Link to="${k}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let oe=DU(k,{relative:p}),[ce,pe,Ae]=d5(c,H),Ee=x5(k,{replace:M,state:r,target:I,preventScrollReset:B,relative:p,viewTransition:U});function be(Se){e&&e(Se),Se.defaultPrevented||Ee(Se)}let Ve=le.createElement("a",{...H,...Ae,href:J||oe,onClick:j||y?e:be,ref:g5(Y,pe),target:I,"data-discover":!Q&&a==="render"?"true":void 0});return ce&&!Q?le.createElement(le.Fragment,null,Ve,le.createElement(f5,{page:oe})):Ve});dO.displayName="Link";var _m=le.forwardRef(function({"aria-current":e="page",caseSensitive:a=!1,className:c="",end:p=!1,style:y,to:M,viewTransition:r,children:I,...k},B){let U=K0(M,{relative:k.relative}),H=Dm(),Y=le.useContext(fE),{navigator:X,basename:Q}=le.useContext(Rd),J=Y!=null&&T5(U)&&r===!0,j=X.encodeLocation?X.encodeLocation(U).pathname:U.pathname,oe=H.pathname,ce=Y&&Y.navigation&&Y.navigation.location?Y.navigation.location.pathname:null;a||(oe=oe.toLowerCase(),ce=ce?ce.toLowerCase():null,j=j.toLowerCase()),ce&&Q&&(ce=Kf(ce,Q)||ce);const pe=j!=="/"&&j.endsWith("/")?j.length-1:j.length;let Ae=oe===j||!p&&oe.startsWith(j)&&oe.charAt(pe)==="/",Ee=ce!=null&&(ce===j||!p&&ce.startsWith(j)&&ce.charAt(j.length)==="/"),be={isActive:Ae,isPending:Ee,isTransitioning:J},Ve=Ae?e:void 0,Se;typeof c=="function"?Se=c(be):Se=[c,Ae?"active":null,Ee?"pending":null,J?"transitioning":null].filter(Boolean).join(" ");let xe=typeof y=="function"?y(be):y;return le.createElement(dO,{...k,"aria-current":Ve,className:Se,ref:B,style:xe,to:M,viewTransition:r},typeof I=="function"?I(be):I)});_m.displayName="NavLink";var v5=le.forwardRef(({discover:t="render",fetcherKey:e,navigate:a,reloadDocument:c,replace:p,state:y,method:M=ew,action:r,onSubmit:I,relative:k,preventScrollReset:B,viewTransition:U,...H},Y)=>{let X=E5(),Q=M5(r,{relative:k}),J=M.toLowerCase()==="get"?"get":"post",j=typeof r=="string"&&hO.test(r),oe=ce=>{if(I&&I(ce),ce.defaultPrevented)return;ce.preventDefault();let pe=ce.nativeEvent.submitter,Ae=(pe==null?void 0:pe.getAttribute("formmethod"))||M;X(pe||ce.currentTarget,{fetcherKey:e,method:Ae,navigate:a,replace:p,state:y,relative:k,preventScrollReset:B,viewTransition:U})};return le.createElement("form",{ref:Y,method:J,action:Q,onSubmit:c?I:oe,...H,"data-discover":!j&&t==="render"?"true":void 0})});v5.displayName="Form";function y5(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function fO(t){let e=le.useContext(Ly);return ao(e,y5(t)),e}function x5(t,{target:e,replace:a,state:c,preventScrollReset:p,relative:y,viewTransition:M}={}){let r=aO(),I=Dm(),k=K0(t,{relative:y});return le.useCallback(B=>{if(JU(B,e)){B.preventDefault();let U=a!==void 0?a:F0(I)===F0(k);r(t,{replace:U,state:c,preventScrollReset:p,relative:y,viewTransition:M})}},[I,r,k,a,c,e,t,p,y,M])}function b5(t){dh(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=le.useRef(M2(t)),a=le.useRef(!1),c=Dm(),p=le.useMemo(()=>QU(c.search,a.current?null:e.current),[c.search]),y=aO(),M=le.useCallback((r,I)=>{const k=M2(typeof r=="function"?r(p):r);a.current=!0,y("?"+k,I)},[y,p]);return[p,M]}var w5=0,S5=()=>`__${String(++w5)}__`;function E5(){let{router:t}=fO("useSubmit"),{basename:e}=le.useContext(Rd),a=jU();return le.useCallback(async(c,p={})=>{let{action:y,method:M,encType:r,formData:I,body:k}=n5(c,e);if(p.navigate===!1){let B=p.fetcherKey||S5();await t.fetch(B,a,p.action||y,{preventScrollReset:p.preventScrollReset,formData:I,body:k,formMethod:p.method||M,formEncType:p.encType||r,flushSync:p.flushSync})}else await t.navigate(p.action||y,{preventScrollReset:p.preventScrollReset,formData:I,body:k,formMethod:p.method||M,formEncType:p.encType||r,replace:p.replace,state:p.state,fromRouteId:a,flushSync:p.flushSync,viewTransition:p.viewTransition})},[t,e,a])}function M5(t,{relative:e}={}){let{basename:a}=le.useContext(Rd),c=le.useContext(np);ao(c,"useFormAction must be used inside a RouteContext");let[p]=c.matches.slice(-1),y={...K0(t||".",{relative:e})},M=Dm();if(t==null){y.search=M.search;let r=new URLSearchParams(y.search),I=r.getAll("index");if(I.some(B=>B==="")){r.delete("index"),I.filter(U=>U).forEach(U=>r.append("index",U));let B=r.toString();y.search=B?`?${B}`:""}}return(!t||t===".")&&p.route.index&&(y.search=y.search?y.search.replace(/^\?/,"?index&"):"?index"),a!=="/"&&(y.pathname=y.pathname==="/"?a:$f([a,y.pathname])),F0(y)}function T5(t,e={}){let a=le.useContext(nO);ao(a!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:c}=fO("useViewTransitionState"),p=K0(t,{relative:e.relative});if(!a.isTransitioning)return!1;let y=Kf(a.currentLocation.pathname,c)||a.currentLocation.pathname,M=Kf(a.nextLocation.pathname,c)||a.nextLocation.pathname;return VS(p.pathname,M)!=null||VS(p.pathname,y)!=null}new TextEncoder;/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A5=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),pO=(...t)=>t.filter((e,a,c)=>!!e&&e.trim()!==""&&c.indexOf(e)===a).join(" ").trim();/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var C5={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R5=le.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:a=2,absoluteStrokeWidth:c,className:p="",children:y,iconNode:M,...r},I)=>le.createElement("svg",{ref:I,...C5,width:e,height:e,stroke:t,strokeWidth:c?Number(a)*24/Number(e):a,className:pO("lucide",p),...r},[...M.map(([k,B])=>le.createElement(k,B)),...Array.isArray(y)?y:[y]]));/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vc=(t,e)=>{const a=le.forwardRef(({className:c,...p},y)=>le.createElement(R5,{ref:y,iconNode:e,className:pO(`lucide-${A5(t)}`,c),...p}));return a.displayName=`${t}`,a};/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I5=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],D5=vc("ArrowLeft",I5);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P5=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],L5=vc("ArrowRight",P5);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O5=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],z5=vc("ArrowUpDown",O5);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k5=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],mO=vc("Check",k5);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F5=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],gO=vc("ChevronDown",F5);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N5=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],B5=vc("ChevronUp",N5);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U5=[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54",key:"1djwo0"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3a2 2 0 0 1 2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2c0-1.1.9-2 2-2h3.17",key:"1tzkfa"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05",key:"14pb5j"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],V5=vc("Earth",U5);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j5=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],G5=vc("Ellipsis",j5);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H5=[["path",{d:"M10.3 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10l-3.1-3.1a2 2 0 0 0-2.814.014L6 21",key:"9csbqa"}],["path",{d:"m14 19.5 3-3 3 3",key:"9vmjn0"}],["path",{d:"M17 22v-5.5",key:"1aa6fl"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]],q5=vc("ImageUp",H5);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W5=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],$5=vc("Loader",W5);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X5=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],Z5=vc("Upload",X5);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y5=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"M2 5h20",key:"1fs1ex"}],["path",{d:"M3 3v2",key:"9imdir"}],["path",{d:"M7 3v2",key:"n0os7"}],["path",{d:"M17 3v2",key:"1l2re6"}],["path",{d:"M21 3v2",key:"1duuac"}],["path",{d:"m19 5-7 7-7-7",key:"133zxf"}]],K5=vc("UtilityPole",Y5);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J5=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Q5=vc("X",J5);var J0=ZL();const _O=Im(J0);function eV(t,e){const a=le.createContext(e),c=y=>{const{children:M,...r}=y,I=le.useMemo(()=>r,Object.values(r));return se.jsx(a.Provider,{value:I,children:M})};c.displayName=t+"Provider";function p(y){const M=le.useContext(a);if(M)return M;if(e!==void 0)return e;throw new Error(`\`${y}\` must be used within \`${t}\``)}return[c,p]}function Pm(t,e=[]){let a=[];function c(y,M){const r=le.createContext(M),I=a.length;a=[...a,M];const k=U=>{var j;const{scope:H,children:Y,...X}=U,Q=((j=H==null?void 0:H[t])==null?void 0:j[I])||r,J=le.useMemo(()=>X,Object.values(X));return se.jsx(Q.Provider,{value:J,children:Y})};k.displayName=y+"Provider";function B(U,H){var Q;const Y=((Q=H==null?void 0:H[t])==null?void 0:Q[I])||r,X=le.useContext(Y);if(X)return X;if(M!==void 0)return M;throw new Error(`\`${U}\` must be used within \`${y}\``)}return[k,B]}const p=()=>{const y=a.map(M=>le.createContext(M));return function(r){const I=(r==null?void 0:r[t])||y;return le.useMemo(()=>({[`__scope${t}`]:{...r,[t]:I}}),[r,I])}};return p.scopeName=t,[c,tV(p,...e)]}function tV(...t){const e=t[0];if(t.length===1)return e;const a=()=>{const c=t.map(p=>({useScope:p(),scopeName:p.scopeName}));return function(y){const M=c.reduce((r,{useScope:I,scopeName:k})=>{const U=I(y)[`__scope${k}`];return{...r,...U}},{});return le.useMemo(()=>({[`__scope${e.scopeName}`]:M}),[M])}};return a.scopeName=e.scopeName,a}function xi(t,e,{checkForDefaultPrevented:a=!0}={}){return function(p){if(t==null||t(p),a===!1||!p.defaultPrevented)return e==null?void 0:e(p)}}function yP(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Q0(...t){return e=>{let a=!1;const c=t.map(p=>{const y=yP(p,e);return!a&&typeof y=="function"&&(a=!0),y});if(a)return()=>{for(let p=0;p<c.length;p++){const y=c[p];typeof y=="function"?y():yP(t[p],null)}}}}function na(...t){return le.useCallback(Q0(...t),t)}var Jf=le.forwardRef((t,e)=>{const{children:a,...c}=t,p=le.Children.toArray(a),y=p.find(iV);if(y){const M=y.props.children,r=p.map(I=>I===y?le.Children.count(M)>1?le.Children.only(null):le.isValidElement(M)?M.props.children:null:I);return se.jsx(T2,{...c,ref:e,children:le.isValidElement(M)?le.cloneElement(M,void 0,r):null})}return se.jsx(T2,{...c,ref:e,children:a})});Jf.displayName="Slot";var T2=le.forwardRef((t,e)=>{const{children:a,...c}=t;if(le.isValidElement(a)){const p=aV(a),y=rV(c,a.props);return a.type!==le.Fragment&&(y.ref=e?Q0(e,p):p),le.cloneElement(a,y)}return le.Children.count(a)>1?le.Children.only(null):null});T2.displayName="SlotClone";var nV=({children:t})=>se.jsx(se.Fragment,{children:t});function iV(t){return le.isValidElement(t)&&t.type===nV}function rV(t,e){const a={...e};for(const c in e){const p=t[c],y=e[c];/^on[A-Z]/.test(c)?p&&y?a[c]=(...r)=>{y(...r),p(...r)}:p&&(a[c]=p):c==="style"?a[c]={...p,...y}:c==="className"&&(a[c]=[p,y].filter(Boolean).join(" "))}return{...t,...a}}function aV(t){var c,p;let e=(c=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:c.get,a=e&&"isReactWarning"in e&&e.isReactWarning;return a?t.ref:(e=(p=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:p.get,a=e&&"isReactWarning"in e&&e.isReactWarning,a?t.props.ref:t.props.ref||t.ref)}var oV=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],fr=oV.reduce((t,e)=>{const a=le.forwardRef((c,p)=>{const{asChild:y,...M}=c,r=y?Jf:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),se.jsx(r,{...M,ref:p})});return a.displayName=`Primitive.${e}`,{...t,[e]:a}},{});function jS(t,e){t&&J0.flushSync(()=>t.dispatchEvent(e))}function Ho(t){const e=le.useRef(t);return le.useEffect(()=>{e.current=t}),le.useMemo(()=>(...a)=>{var c;return(c=e.current)==null?void 0:c.call(e,...a)},[])}function u_({prop:t,defaultProp:e,onChange:a=()=>{}}){const[c,p]=sV({defaultProp:e,onChange:a}),y=t!==void 0,M=y?t:c,r=Ho(a),I=le.useCallback(k=>{if(y){const U=typeof k=="function"?k(t):k;U!==t&&r(U)}else p(k)},[y,t,p,r]);return[M,I]}function sV({defaultProp:t,onChange:e}){const a=le.useState(t),[c]=a,p=le.useRef(c),y=Ho(e);return le.useEffect(()=>{p.current!==c&&(y(c),p.current=c)},[c,p,y]),a}var lV=le.createContext(void 0);function mE(t){const e=le.useContext(lV);return t||e||"ltr"}var ss=globalThis!=null&&globalThis.document?le.useLayoutEffect:()=>{};function cV(t,e){return le.useReducer((a,c)=>e[a][c]??a,t)}var mu=t=>{const{present:e,children:a}=t,c=uV(e),p=typeof a=="function"?a({present:c.isPresent}):le.Children.only(a),y=na(c.ref,hV(p));return typeof a=="function"||c.isPresent?le.cloneElement(p,{ref:y}):null};mu.displayName="Presence";function uV(t){const[e,a]=le.useState(),c=le.useRef({}),p=le.useRef(t),y=le.useRef("none"),M=t?"mounted":"unmounted",[r,I]=cV(M,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return le.useEffect(()=>{const k=y1(c.current);y.current=r==="mounted"?k:"none"},[r]),ss(()=>{const k=c.current,B=p.current;if(B!==t){const H=y.current,Y=y1(k);t?I("MOUNT"):Y==="none"||(k==null?void 0:k.display)==="none"?I("UNMOUNT"):I(B&&H!==Y?"ANIMATION_OUT":"UNMOUNT"),p.current=t}},[t,I]),ss(()=>{if(e){let k;const B=e.ownerDocument.defaultView??window,U=Y=>{const Q=y1(c.current).includes(Y.animationName);if(Y.target===e&&Q&&(I("ANIMATION_END"),!p.current)){const J=e.style.animationFillMode;e.style.animationFillMode="forwards",k=B.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=J)})}},H=Y=>{Y.target===e&&(y.current=y1(c.current))};return e.addEventListener("animationstart",H),e.addEventListener("animationcancel",U),e.addEventListener("animationend",U),()=>{B.clearTimeout(k),e.removeEventListener("animationstart",H),e.removeEventListener("animationcancel",U),e.removeEventListener("animationend",U)}}else I("ANIMATION_END")},[e,I]),{isPresent:["mounted","unmountSuspended"].includes(r),ref:le.useCallback(k=>{k&&(c.current=getComputedStyle(k)),a(k)},[])}}function y1(t){return(t==null?void 0:t.animationName)||"none"}function hV(t){var c,p;let e=(c=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:c.get,a=e&&"isReactWarning"in e&&e.isReactWarning;return a?t.ref:(e=(p=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:p.get,a=e&&"isReactWarning"in e&&e.isReactWarning,a?t.props.ref:t.props.ref||t.ref)}var dV=K4.useId||(()=>{}),fV=0;function sh(t){const[e,a]=le.useState(dV());return ss(()=>{a(c=>c??String(fV++))},[t]),t||(e?`radix-${e}`:"")}function eb(t){const e=t+"CollectionProvider",[a,c]=Pm(e),[p,y]=a(e,{collectionRef:{current:null},itemMap:new Map}),M=Y=>{const{scope:X,children:Q}=Y,J=Go.useRef(null),j=Go.useRef(new Map).current;return se.jsx(p,{scope:X,itemMap:j,collectionRef:J,children:Q})};M.displayName=e;const r=t+"CollectionSlot",I=Go.forwardRef((Y,X)=>{const{scope:Q,children:J}=Y,j=y(r,Q),oe=na(X,j.collectionRef);return se.jsx(Jf,{ref:oe,children:J})});I.displayName=r;const k=t+"CollectionItemSlot",B="data-radix-collection-item",U=Go.forwardRef((Y,X)=>{const{scope:Q,children:J,...j}=Y,oe=Go.useRef(null),ce=na(X,oe),pe=y(k,Q);return Go.useEffect(()=>(pe.itemMap.set(oe,{ref:oe,...j}),()=>void pe.itemMap.delete(oe))),se.jsx(Jf,{[B]:"",ref:ce,children:J})});U.displayName=k;function H(Y){const X=y(t+"CollectionConsumer",Y);return Go.useCallback(()=>{const J=X.collectionRef.current;if(!J)return[];const j=Array.from(J.querySelectorAll(`[${B}]`));return Array.from(X.itemMap.values()).sort((pe,Ae)=>j.indexOf(pe.ref.current)-j.indexOf(Ae.ref.current))},[X.collectionRef,X.itemMap])}return[{Provider:M,Slot:I,ItemSlot:U},H,c]}function pV(t,e=globalThis==null?void 0:globalThis.document){const a=Ho(t);le.useEffect(()=>{const c=p=>{p.key==="Escape"&&a(p)};return e.addEventListener("keydown",c,{capture:!0}),()=>e.removeEventListener("keydown",c,{capture:!0})},[a,e])}var mV="DismissableLayer",A2="dismissableLayer.update",gV="dismissableLayer.pointerDownOutside",_V="dismissableLayer.focusOutside",xP,vO=le.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),tb=le.forwardRef((t,e)=>{const{disableOutsidePointerEvents:a=!1,onEscapeKeyDown:c,onPointerDownOutside:p,onFocusOutside:y,onInteractOutside:M,onDismiss:r,...I}=t,k=le.useContext(vO),[B,U]=le.useState(null),H=(B==null?void 0:B.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,Y]=le.useState({}),X=na(e,be=>U(be)),Q=Array.from(k.layers),[J]=[...k.layersWithOutsidePointerEventsDisabled].slice(-1),j=Q.indexOf(J),oe=B?Q.indexOf(B):-1,ce=k.layersWithOutsidePointerEventsDisabled.size>0,pe=oe>=j,Ae=xV(be=>{const Ve=be.target,Se=[...k.branches].some(xe=>xe.contains(Ve));!pe||Se||(p==null||p(be),M==null||M(be),be.defaultPrevented||r==null||r())},H),Ee=bV(be=>{const Ve=be.target;[...k.branches].some(xe=>xe.contains(Ve))||(y==null||y(be),M==null||M(be),be.defaultPrevented||r==null||r())},H);return pV(be=>{oe===k.layers.size-1&&(c==null||c(be),!be.defaultPrevented&&r&&(be.preventDefault(),r()))},H),le.useEffect(()=>{if(B)return a&&(k.layersWithOutsidePointerEventsDisabled.size===0&&(xP=H.body.style.pointerEvents,H.body.style.pointerEvents="none"),k.layersWithOutsidePointerEventsDisabled.add(B)),k.layers.add(B),bP(),()=>{a&&k.layersWithOutsidePointerEventsDisabled.size===1&&(H.body.style.pointerEvents=xP)}},[B,H,a,k]),le.useEffect(()=>()=>{B&&(k.layers.delete(B),k.layersWithOutsidePointerEventsDisabled.delete(B),bP())},[B,k]),le.useEffect(()=>{const be=()=>Y({});return document.addEventListener(A2,be),()=>document.removeEventListener(A2,be)},[]),se.jsx(fr.div,{...I,ref:X,style:{pointerEvents:ce?pe?"auto":"none":void 0,...t.style},onFocusCapture:xi(t.onFocusCapture,Ee.onFocusCapture),onBlurCapture:xi(t.onBlurCapture,Ee.onBlurCapture),onPointerDownCapture:xi(t.onPointerDownCapture,Ae.onPointerDownCapture)})});tb.displayName=mV;var vV="DismissableLayerBranch",yV=le.forwardRef((t,e)=>{const a=le.useContext(vO),c=le.useRef(null),p=na(e,c);return le.useEffect(()=>{const y=c.current;if(y)return a.branches.add(y),()=>{a.branches.delete(y)}},[a.branches]),se.jsx(fr.div,{...t,ref:p})});yV.displayName=vV;function xV(t,e=globalThis==null?void 0:globalThis.document){const a=Ho(t),c=le.useRef(!1),p=le.useRef(()=>{});return le.useEffect(()=>{const y=r=>{if(r.target&&!c.current){let I=function(){yO(gV,a,k,{discrete:!0})};const k={originalEvent:r};r.pointerType==="touch"?(e.removeEventListener("click",p.current),p.current=I,e.addEventListener("click",p.current,{once:!0})):I()}else e.removeEventListener("click",p.current);c.current=!1},M=window.setTimeout(()=>{e.addEventListener("pointerdown",y)},0);return()=>{window.clearTimeout(M),e.removeEventListener("pointerdown",y),e.removeEventListener("click",p.current)}},[e,a]),{onPointerDownCapture:()=>c.current=!0}}function bV(t,e=globalThis==null?void 0:globalThis.document){const a=Ho(t),c=le.useRef(!1);return le.useEffect(()=>{const p=y=>{y.target&&!c.current&&yO(_V,a,{originalEvent:y},{discrete:!1})};return e.addEventListener("focusin",p),()=>e.removeEventListener("focusin",p)},[e,a]),{onFocusCapture:()=>c.current=!0,onBlurCapture:()=>c.current=!1}}function bP(){const t=new CustomEvent(A2);document.dispatchEvent(t)}function yO(t,e,a,{discrete:c}){const p=a.originalEvent.target,y=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:a});e&&p.addEventListener(t,e,{once:!0}),c?jS(p,y):p.dispatchEvent(y)}function xO(t){const e=le.useRef({value:t,previous:t});return le.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var wV="VisuallyHidden",FC=le.forwardRef((t,e)=>se.jsx(fr.span,{...t,ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...t.style}}));FC.displayName=wV;var SV=FC,Oy="NavigationMenu",[NC,bO,EV]=eb(Oy),[C2,MV,TV]=eb(Oy),[BC,Nte]=Pm(Oy,[EV,TV]),[AV,gu]=BC(Oy),[CV,RV]=BC(Oy),wO=le.forwardRef((t,e)=>{const{__scopeNavigationMenu:a,value:c,onValueChange:p,defaultValue:y,delayDuration:M=200,skipDelayDuration:r=300,orientation:I="horizontal",dir:k,...B}=t,[U,H]=le.useState(null),Y=na(e,Se=>H(Se)),X=mE(k),Q=le.useRef(0),J=le.useRef(0),j=le.useRef(0),[oe,ce]=le.useState(!0),[pe="",Ae]=u_({prop:c,onChange:Se=>{const xe=Se!=="",Fe=r>0;xe?(window.clearTimeout(j.current),Fe&&ce(!1)):(window.clearTimeout(j.current),j.current=window.setTimeout(()=>ce(!0),r)),p==null||p(Se)},defaultProp:y}),Ee=le.useCallback(()=>{window.clearTimeout(J.current),J.current=window.setTimeout(()=>Ae(""),150)},[Ae]),be=le.useCallback(Se=>{window.clearTimeout(J.current),Ae(Se)},[Ae]),Ve=le.useCallback(Se=>{pe===Se?window.clearTimeout(J.current):Q.current=window.setTimeout(()=>{window.clearTimeout(J.current),Ae(Se)},M)},[pe,Ae,M]);return le.useEffect(()=>()=>{window.clearTimeout(Q.current),window.clearTimeout(J.current),window.clearTimeout(j.current)},[]),se.jsx(EO,{scope:a,isRootMenu:!0,value:pe,dir:X,orientation:I,rootNavigationMenu:U,onTriggerEnter:Se=>{window.clearTimeout(Q.current),oe?Ve(Se):be(Se)},onTriggerLeave:()=>{window.clearTimeout(Q.current),Ee()},onContentEnter:()=>window.clearTimeout(J.current),onContentLeave:Ee,onItemSelect:Se=>{Ae(xe=>xe===Se?"":Se)},onItemDismiss:()=>Ae(""),children:se.jsx(fr.nav,{"aria-label":"Main","data-orientation":I,dir:X,...B,ref:Y})})});wO.displayName=Oy;var SO="NavigationMenuSub",IV=le.forwardRef((t,e)=>{const{__scopeNavigationMenu:a,value:c,onValueChange:p,defaultValue:y,orientation:M="horizontal",...r}=t,I=gu(SO,a),[k="",B]=u_({prop:c,onChange:p,defaultProp:y});return se.jsx(EO,{scope:a,isRootMenu:!1,value:k,dir:I.dir,orientation:M,rootNavigationMenu:I.rootNavigationMenu,onTriggerEnter:U=>B(U),onItemSelect:U=>B(U),onItemDismiss:()=>B(""),children:se.jsx(fr.div,{"data-orientation":M,...r,ref:e})})});IV.displayName=SO;var EO=t=>{const{scope:e,isRootMenu:a,rootNavigationMenu:c,dir:p,orientation:y,children:M,value:r,onItemSelect:I,onItemDismiss:k,onTriggerEnter:B,onTriggerLeave:U,onContentEnter:H,onContentLeave:Y}=t,[X,Q]=le.useState(null),[J,j]=le.useState(new Map),[oe,ce]=le.useState(null);return se.jsx(AV,{scope:e,isRootMenu:a,rootNavigationMenu:c,value:r,previousValue:xO(r),baseId:sh(),dir:p,orientation:y,viewport:X,onViewportChange:Q,indicatorTrack:oe,onIndicatorTrackChange:ce,onTriggerEnter:Ho(B),onTriggerLeave:Ho(U),onContentEnter:Ho(H),onContentLeave:Ho(Y),onItemSelect:Ho(I),onItemDismiss:Ho(k),onViewportContentChange:le.useCallback((pe,Ae)=>{j(Ee=>(Ee.set(pe,Ae),new Map(Ee)))},[]),onViewportContentRemove:le.useCallback(pe=>{j(Ae=>Ae.has(pe)?(Ae.delete(pe),new Map(Ae)):Ae)},[]),children:se.jsx(NC.Provider,{scope:e,children:se.jsx(CV,{scope:e,items:J,children:M})})})},MO="NavigationMenuList",TO=le.forwardRef((t,e)=>{const{__scopeNavigationMenu:a,...c}=t,p=gu(MO,a),y=se.jsx(fr.ul,{"data-orientation":p.orientation,...c,ref:e});return se.jsx(fr.div,{style:{position:"relative"},ref:p.onIndicatorTrackChange,children:se.jsx(NC.Slot,{scope:a,children:p.isRootMenu?se.jsx(PO,{asChild:!0,children:y}):y})})});TO.displayName=MO;var AO="NavigationMenuItem",[DV,CO]=BC(AO),RO=le.forwardRef((t,e)=>{const{__scopeNavigationMenu:a,value:c,...p}=t,y=sh(),M=c||y||"LEGACY_REACT_AUTO_VALUE",r=le.useRef(null),I=le.useRef(null),k=le.useRef(null),B=le.useRef(()=>{}),U=le.useRef(!1),H=le.useCallback((X="start")=>{if(r.current){B.current();const Q=I2(r.current);Q.length&&jC(X==="start"?Q:Q.reverse())}},[]),Y=le.useCallback(()=>{if(r.current){const X=I2(r.current);X.length&&(B.current=jV(X))}},[]);return se.jsx(DV,{scope:a,value:M,triggerRef:I,contentRef:r,focusProxyRef:k,wasEscapeCloseRef:U,onEntryKeyDown:H,onFocusProxyEnter:H,onRootContentClose:Y,onContentFocusOutside:Y,children:se.jsx(fr.li,{...p,ref:e})})});RO.displayName=AO;var R2="NavigationMenuTrigger",PV=le.forwardRef((t,e)=>{const{__scopeNavigationMenu:a,disabled:c,...p}=t,y=gu(R2,t.__scopeNavigationMenu),M=CO(R2,t.__scopeNavigationMenu),r=le.useRef(null),I=na(r,M.triggerRef,e),k=OO(y.baseId,M.value),B=zO(y.baseId,M.value),U=le.useRef(!1),H=le.useRef(!1),Y=M.value===y.value;return se.jsxs(se.Fragment,{children:[se.jsx(NC.ItemSlot,{scope:a,value:M.value,children:se.jsx(LO,{asChild:!0,children:se.jsx(fr.button,{id:k,disabled:c,"data-disabled":c?"":void 0,"data-state":GC(Y),"aria-expanded":Y,"aria-controls":B,...p,ref:I,onPointerEnter:xi(t.onPointerEnter,()=>{H.current=!1,M.wasEscapeCloseRef.current=!1}),onPointerMove:xi(t.onPointerMove,GS(()=>{c||H.current||M.wasEscapeCloseRef.current||U.current||(y.onTriggerEnter(M.value),U.current=!0)})),onPointerLeave:xi(t.onPointerLeave,GS(()=>{c||(y.onTriggerLeave(),U.current=!1)})),onClick:xi(t.onClick,()=>{y.onItemSelect(M.value),H.current=Y}),onKeyDown:xi(t.onKeyDown,X=>{const J={horizontal:"ArrowDown",vertical:y.dir==="rtl"?"ArrowLeft":"ArrowRight"}[y.orientation];Y&&X.key===J&&(M.onEntryKeyDown(),X.preventDefault())})})})}),Y&&se.jsxs(se.Fragment,{children:[se.jsx(SV,{"aria-hidden":!0,tabIndex:0,ref:M.focusProxyRef,onFocus:X=>{const Q=M.contentRef.current,J=X.relatedTarget,j=J===r.current,oe=Q==null?void 0:Q.contains(J);(j||!oe)&&M.onFocusProxyEnter(j?"start":"end")}}),y.viewport&&se.jsx("span",{"aria-owns":B})]})]})});PV.displayName=R2;var LV="NavigationMenuLink",wP="navigationMenu.linkSelect",OV=le.forwardRef((t,e)=>{const{__scopeNavigationMenu:a,active:c,onSelect:p,...y}=t;return se.jsx(LO,{asChild:!0,children:se.jsx(fr.a,{"data-active":c?"":void 0,"aria-current":c?"page":void 0,...y,ref:e,onClick:xi(t.onClick,M=>{const r=M.target,I=new CustomEvent(wP,{bubbles:!0,cancelable:!0});if(r.addEventListener(wP,k=>p==null?void 0:p(k),{once:!0}),jS(r,I),!I.defaultPrevented&&!M.metaKey){const k=new CustomEvent(nw,{bubbles:!0,cancelable:!0});jS(r,k)}},{checkForDefaultPrevented:!1})})})});OV.displayName=LV;var UC="NavigationMenuIndicator",zV=le.forwardRef((t,e)=>{const{forceMount:a,...c}=t,p=gu(UC,t.__scopeNavigationMenu),y=!!p.value;return p.indicatorTrack?_O.createPortal(se.jsx(mu,{present:a||y,children:se.jsx(kV,{...c,ref:e})}),p.indicatorTrack):null});zV.displayName=UC;var kV=le.forwardRef((t,e)=>{const{__scopeNavigationMenu:a,...c}=t,p=gu(UC,a),y=bO(a),[M,r]=le.useState(null),[I,k]=le.useState(null),B=p.orientation==="horizontal",U=!!p.value;le.useEffect(()=>{var Q;const X=(Q=y().find(J=>J.value===p.value))==null?void 0:Q.ref.current;X&&r(X)},[y,p.value]);const H=()=>{M&&k({size:B?M.offsetWidth:M.offsetHeight,offset:B?M.offsetLeft:M.offsetTop})};return D2(M,H),D2(p.indicatorTrack,H),I?se.jsx(fr.div,{"aria-hidden":!0,"data-state":U?"visible":"hidden","data-orientation":p.orientation,...c,ref:e,style:{position:"absolute",...B?{left:0,width:I.size+"px",transform:`translateX(${I.offset}px)`}:{top:0,height:I.size+"px",transform:`translateY(${I.offset}px)`},...c.style}}):null}),yy="NavigationMenuContent",FV=le.forwardRef((t,e)=>{const{forceMount:a,...c}=t,p=gu(yy,t.__scopeNavigationMenu),y=CO(yy,t.__scopeNavigationMenu),M=na(y.contentRef,e),r=y.value===p.value,I={value:y.value,triggerRef:y.triggerRef,focusProxyRef:y.focusProxyRef,wasEscapeCloseRef:y.wasEscapeCloseRef,onContentFocusOutside:y.onContentFocusOutside,onRootContentClose:y.onRootContentClose,...c};return p.viewport?se.jsx(NV,{forceMount:a,...I,ref:M}):se.jsx(mu,{present:a||r,children:se.jsx(IO,{"data-state":GC(r),...I,ref:M,onPointerEnter:xi(t.onPointerEnter,p.onContentEnter),onPointerLeave:xi(t.onPointerLeave,GS(p.onContentLeave)),style:{pointerEvents:!r&&p.isRootMenu?"none":void 0,...I.style}})})});FV.displayName=yy;var NV=le.forwardRef((t,e)=>{const a=gu(yy,t.__scopeNavigationMenu),{onViewportContentChange:c,onViewportContentRemove:p}=a;return ss(()=>{c(t.value,{ref:e,...t})},[t,e,c]),ss(()=>()=>p(t.value),[t.value,p]),null}),nw="navigationMenu.rootContentDismiss",IO=le.forwardRef((t,e)=>{const{__scopeNavigationMenu:a,value:c,triggerRef:p,focusProxyRef:y,wasEscapeCloseRef:M,onRootContentClose:r,onContentFocusOutside:I,...k}=t,B=gu(yy,a),U=le.useRef(null),H=na(U,e),Y=OO(B.baseId,c),X=zO(B.baseId,c),Q=bO(a),J=le.useRef(null),{onItemDismiss:j}=B;le.useEffect(()=>{const ce=U.current;if(B.isRootMenu&&ce){const pe=()=>{var Ae;j(),r(),ce.contains(document.activeElement)&&((Ae=p.current)==null||Ae.focus())};return ce.addEventListener(nw,pe),()=>ce.removeEventListener(nw,pe)}},[B.isRootMenu,t.value,p,j,r]);const oe=le.useMemo(()=>{const pe=Q().map(xe=>xe.value);B.dir==="rtl"&&pe.reverse();const Ae=pe.indexOf(B.value),Ee=pe.indexOf(B.previousValue),be=c===B.value,Ve=Ee===pe.indexOf(c);if(!be&&!Ve)return J.current;const Se=(()=>{if(Ae!==Ee){if(be&&Ee!==-1)return Ae>Ee?"from-end":"from-start";if(Ve&&Ae!==-1)return Ae>Ee?"to-start":"to-end"}return null})();return J.current=Se,Se},[B.previousValue,B.value,B.dir,Q,c]);return se.jsx(PO,{asChild:!0,children:se.jsx(tb,{id:X,"aria-labelledby":Y,"data-motion":oe,"data-orientation":B.orientation,...k,ref:H,disableOutsidePointerEvents:!1,onDismiss:()=>{var pe;const ce=new Event(nw,{bubbles:!0,cancelable:!0});(pe=U.current)==null||pe.dispatchEvent(ce)},onFocusOutside:xi(t.onFocusOutside,ce=>{var Ae;I();const pe=ce.target;(Ae=B.rootNavigationMenu)!=null&&Ae.contains(pe)&&ce.preventDefault()}),onPointerDownOutside:xi(t.onPointerDownOutside,ce=>{var be;const pe=ce.target,Ae=Q().some(Ve=>{var Se;return(Se=Ve.ref.current)==null?void 0:Se.contains(pe)}),Ee=B.isRootMenu&&((be=B.viewport)==null?void 0:be.contains(pe));(Ae||Ee||!B.isRootMenu)&&ce.preventDefault()}),onKeyDown:xi(t.onKeyDown,ce=>{var Ee;const pe=ce.altKey||ce.ctrlKey||ce.metaKey;if(ce.key==="Tab"&&!pe){const be=I2(ce.currentTarget),Ve=document.activeElement,Se=be.findIndex(Ct=>Ct===Ve),Fe=ce.shiftKey?be.slice(0,Se).reverse():be.slice(Se+1,be.length);jC(Fe)?ce.preventDefault():(Ee=y.current)==null||Ee.focus()}}),onEscapeKeyDown:xi(t.onEscapeKeyDown,ce=>{M.current=!0})})})}),VC="NavigationMenuViewport",DO=le.forwardRef((t,e)=>{const{forceMount:a,...c}=t,y=!!gu(VC,t.__scopeNavigationMenu).value;return se.jsx(mu,{present:a||y,children:se.jsx(BV,{...c,ref:e})})});DO.displayName=VC;var BV=le.forwardRef((t,e)=>{const{__scopeNavigationMenu:a,children:c,...p}=t,y=gu(VC,a),M=na(e,y.onViewportChange),r=RV(yy,t.__scopeNavigationMenu),[I,k]=le.useState(null),[B,U]=le.useState(null),H=I?(I==null?void 0:I.width)+"px":void 0,Y=I?(I==null?void 0:I.height)+"px":void 0,X=!!y.value,Q=X?y.value:y.previousValue;return D2(B,()=>{B&&k({width:B.offsetWidth,height:B.offsetHeight})}),se.jsx(fr.div,{"data-state":GC(X),"data-orientation":y.orientation,...p,ref:M,style:{pointerEvents:!X&&y.isRootMenu?"none":void 0,"--radix-navigation-menu-viewport-width":H,"--radix-navigation-menu-viewport-height":Y,...p.style},onPointerEnter:xi(t.onPointerEnter,y.onContentEnter),onPointerLeave:xi(t.onPointerLeave,GS(y.onContentLeave)),children:Array.from(r.items).map(([j,{ref:oe,forceMount:ce,...pe}])=>{const Ae=Q===j;return se.jsx(mu,{present:ce||Ae,children:se.jsx(IO,{...pe,ref:Q0(oe,Ee=>{Ae&&Ee&&U(Ee)})})},j)})})}),UV="FocusGroup",PO=le.forwardRef((t,e)=>{const{__scopeNavigationMenu:a,...c}=t,p=gu(UV,a);return se.jsx(C2.Provider,{scope:a,children:se.jsx(C2.Slot,{scope:a,children:se.jsx(fr.div,{dir:p.dir,...c,ref:e})})})}),SP=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],VV="FocusGroupItem",LO=le.forwardRef((t,e)=>{const{__scopeNavigationMenu:a,...c}=t,p=MV(a),y=gu(VV,a);return se.jsx(C2.ItemSlot,{scope:a,children:se.jsx(fr.button,{...c,ref:e,onKeyDown:xi(t.onKeyDown,M=>{if(["Home","End",...SP].includes(M.key)){let I=p().map(U=>U.ref.current);if([y.dir==="rtl"?"ArrowRight":"ArrowLeft","ArrowUp","End"].includes(M.key)&&I.reverse(),SP.includes(M.key)){const U=I.indexOf(M.currentTarget);I=I.slice(U+1)}setTimeout(()=>jC(I)),M.preventDefault()}})})})});function I2(t){const e=[],a=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:c=>{const p=c.tagName==="INPUT"&&c.type==="hidden";return c.disabled||c.hidden||p?NodeFilter.FILTER_SKIP:c.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;a.nextNode();)e.push(a.currentNode);return e}function jC(t){const e=document.activeElement;return t.some(a=>a===e?!0:(a.focus(),document.activeElement!==e))}function jV(t){return t.forEach(e=>{e.dataset.tabindex=e.getAttribute("tabindex")||"",e.setAttribute("tabindex","-1")}),()=>{t.forEach(e=>{const a=e.dataset.tabindex;e.setAttribute("tabindex",a)})}}function D2(t,e){const a=Ho(e);ss(()=>{let c=0;if(t){const p=new ResizeObserver(()=>{cancelAnimationFrame(c),c=window.requestAnimationFrame(a)});return p.observe(t),()=>{window.cancelAnimationFrame(c),p.unobserve(t)}}},[t,a])}function GC(t){return t?"open":"closed"}function OO(t,e){return`${t}-trigger-${e}`}function zO(t,e){return`${t}-content-${e}`}function GS(t){return e=>e.pointerType==="mouse"?t(e):void 0}var GV=wO,HV=TO,qV=RO,WV=DO;function kO(t){var e,a,c="";if(typeof t=="string"||typeof t=="number")c+=t;else if(typeof t=="object")if(Array.isArray(t)){var p=t.length;for(e=0;e<p;e++)t[e]&&(a=kO(t[e]))&&(c&&(c+=" "),c+=a)}else for(a in t)t[a]&&(c&&(c+=" "),c+=a);return c}function FO(){for(var t,e,a=0,c="",p=arguments.length;a<p;a++)(t=arguments[a])&&(e=kO(t))&&(c&&(c+=" "),c+=e);return c}const EP=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,MP=FO,NO=(t,e)=>a=>{var c;if((e==null?void 0:e.variants)==null)return MP(t,a==null?void 0:a.class,a==null?void 0:a.className);const{variants:p,defaultVariants:y}=e,M=Object.keys(p).map(k=>{const B=a==null?void 0:a[k],U=y==null?void 0:y[k];if(B===null)return null;const H=EP(B)||EP(U);return p[k][H]}),r=a&&Object.entries(a).reduce((k,B)=>{let[U,H]=B;return H===void 0||(k[U]=H),k},{}),I=e==null||(c=e.compoundVariants)===null||c===void 0?void 0:c.reduce((k,B)=>{let{class:U,className:H,...Y}=B;return Object.entries(Y).every(X=>{let[Q,J]=X;return Array.isArray(J)?J.includes({...y,...r}[Q]):{...y,...r}[Q]===J})?[...k,U,H]:k},[]);return MP(t,M,I,a==null?void 0:a.class,a==null?void 0:a.className)},HC="-",$V=t=>{const e=ZV(t),{conflictingClassGroups:a,conflictingClassGroupModifiers:c}=t;return{getClassGroupId:M=>{const r=M.split(HC);return r[0]===""&&r.length!==1&&r.shift(),BO(r,e)||XV(M)},getConflictingClassGroupIds:(M,r)=>{const I=a[M]||[];return r&&c[M]?[...I,...c[M]]:I}}},BO=(t,e)=>{var M;if(t.length===0)return e.classGroupId;const a=t[0],c=e.nextPart.get(a),p=c?BO(t.slice(1),c):void 0;if(p)return p;if(e.validators.length===0)return;const y=t.join(HC);return(M=e.validators.find(({validator:r})=>r(y)))==null?void 0:M.classGroupId},TP=/^\[(.+)\]$/,XV=t=>{if(TP.test(t)){const e=TP.exec(t)[1],a=e==null?void 0:e.substring(0,e.indexOf(":"));if(a)return"arbitrary.."+a}},ZV=t=>{const{theme:e,classGroups:a}=t,c={nextPart:new Map,validators:[]};for(const p in a)P2(a[p],c,p,e);return c},P2=(t,e,a,c)=>{t.forEach(p=>{if(typeof p=="string"){const y=p===""?e:AP(e,p);y.classGroupId=a;return}if(typeof p=="function"){if(YV(p)){P2(p(c),e,a,c);return}e.validators.push({validator:p,classGroupId:a});return}Object.entries(p).forEach(([y,M])=>{P2(M,AP(e,y),a,c)})})},AP=(t,e)=>{let a=t;return e.split(HC).forEach(c=>{a.nextPart.has(c)||a.nextPart.set(c,{nextPart:new Map,validators:[]}),a=a.nextPart.get(c)}),a},YV=t=>t.isThemeGetter,KV=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,a=new Map,c=new Map;const p=(y,M)=>{a.set(y,M),e++,e>t&&(e=0,c=a,a=new Map)};return{get(y){let M=a.get(y);if(M!==void 0)return M;if((M=c.get(y))!==void 0)return p(y,M),M},set(y,M){a.has(y)?a.set(y,M):p(y,M)}}},L2="!",O2=":",JV=O2.length,QV=t=>{const{prefix:e,experimentalParseClassName:a}=t;let c=p=>{const y=[];let M=0,r=0,I=0,k;for(let X=0;X<p.length;X++){let Q=p[X];if(M===0&&r===0){if(Q===O2){y.push(p.slice(I,X)),I=X+JV;continue}if(Q==="/"){k=X;continue}}Q==="["?M++:Q==="]"?M--:Q==="("?r++:Q===")"&&r--}const B=y.length===0?p:p.substring(I),U=e6(B),H=U!==B,Y=k&&k>I?k-I:void 0;return{modifiers:y,hasImportantModifier:H,baseClassName:U,maybePostfixModifierPosition:Y}};if(e){const p=e+O2,y=c;c=M=>M.startsWith(p)?y(M.substring(p.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:M,maybePostfixModifierPosition:void 0}}if(a){const p=c;c=y=>a({className:y,parseClassName:p})}return c},e6=t=>t.endsWith(L2)?t.substring(0,t.length-1):t.startsWith(L2)?t.substring(1):t,t6=t=>{const e=Object.fromEntries(t.orderSensitiveModifiers.map(c=>[c,!0]));return c=>{if(c.length<=1)return c;const p=[];let y=[];return c.forEach(M=>{M[0]==="["||e[M]?(p.push(...y.sort(),M),y=[]):y.push(M)}),p.push(...y.sort()),p}},n6=t=>({cache:KV(t.cacheSize),parseClassName:QV(t),sortModifiers:t6(t),...$V(t)}),i6=/\s+/,r6=(t,e)=>{const{parseClassName:a,getClassGroupId:c,getConflictingClassGroupIds:p,sortModifiers:y}=e,M=[],r=t.trim().split(i6);let I="";for(let k=r.length-1;k>=0;k-=1){const B=r[k],{isExternal:U,modifiers:H,hasImportantModifier:Y,baseClassName:X,maybePostfixModifierPosition:Q}=a(B);if(U){I=B+(I.length>0?" "+I:I);continue}let J=!!Q,j=c(J?X.substring(0,Q):X);if(!j){if(!J){I=B+(I.length>0?" "+I:I);continue}if(j=c(X),!j){I=B+(I.length>0?" "+I:I);continue}J=!1}const oe=y(H).join(":"),ce=Y?oe+L2:oe,pe=ce+j;if(M.includes(pe))continue;M.push(pe);const Ae=p(j,J);for(let Ee=0;Ee<Ae.length;++Ee){const be=Ae[Ee];M.push(ce+be)}I=B+(I.length>0?" "+I:I)}return I};function a6(){let t=0,e,a,c="";for(;t<arguments.length;)(e=arguments[t++])&&(a=UO(e))&&(c&&(c+=" "),c+=a);return c}const UO=t=>{if(typeof t=="string")return t;let e,a="";for(let c=0;c<t.length;c++)t[c]&&(e=UO(t[c]))&&(a&&(a+=" "),a+=e);return a};function o6(t,...e){let a,c,p,y=M;function M(I){const k=e.reduce((B,U)=>U(B),t());return a=n6(k),c=a.cache.get,p=a.cache.set,y=r,r(I)}function r(I){const k=c(I);if(k)return k;const B=r6(I,a);return p(I,B),B}return function(){return y(a6.apply(null,arguments))}}const rs=t=>{const e=a=>a[t]||[];return e.isThemeGetter=!0,e},VO=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,jO=/^\((?:(\w[\w-]*):)?(.+)\)$/i,s6=/^\d+\/\d+$/,l6=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,c6=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,u6=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,h6=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,d6=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Iv=t=>s6.test(t),Ur=t=>!!t&&!Number.isNaN(Number(t)),Vg=t=>!!t&&Number.isInteger(Number(t)),CP=t=>t.endsWith("%")&&Ur(t.slice(0,-1)),nm=t=>l6.test(t),f6=()=>!0,p6=t=>c6.test(t)&&!u6.test(t),qC=()=>!1,m6=t=>h6.test(t),g6=t=>d6.test(t),_6=t=>!Ii(t)&&!Di(t),v6=t=>zy(t,qO,qC),Ii=t=>VO.test(t),jg=t=>zy(t,WO,p6),cT=t=>zy(t,R6,Ur),y6=t=>zy(t,GO,qC),x6=t=>zy(t,HO,g6),b6=t=>zy(t,qC,m6),Di=t=>jO.test(t),x1=t=>ky(t,WO),w6=t=>ky(t,I6),S6=t=>ky(t,GO),E6=t=>ky(t,qO),M6=t=>ky(t,HO),T6=t=>ky(t,D6,!0),zy=(t,e,a)=>{const c=VO.exec(t);return c?c[1]?e(c[1]):a(c[2]):!1},ky=(t,e,a=!1)=>{const c=jO.exec(t);return c?c[1]?e(c[1]):a:!1},GO=t=>t==="position",A6=new Set(["image","url"]),HO=t=>A6.has(t),C6=new Set(["length","size","percentage"]),qO=t=>C6.has(t),WO=t=>t==="length",R6=t=>t==="number",I6=t=>t==="family-name",D6=t=>t==="shadow",P6=()=>{const t=rs("color"),e=rs("font"),a=rs("text"),c=rs("font-weight"),p=rs("tracking"),y=rs("leading"),M=rs("breakpoint"),r=rs("container"),I=rs("spacing"),k=rs("radius"),B=rs("shadow"),U=rs("inset-shadow"),H=rs("drop-shadow"),Y=rs("blur"),X=rs("perspective"),Q=rs("aspect"),J=rs("ease"),j=rs("animate"),oe=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ce=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],pe=()=>["auto","hidden","clip","visible","scroll"],Ae=()=>["auto","contain","none"],Ee=()=>[Di,Ii,I],be=()=>[Iv,"full","auto",...Ee()],Ve=()=>[Vg,"none","subgrid",Di,Ii],Se=()=>["auto",{span:["full",Vg,Di,Ii]},Di,Ii],xe=()=>[Vg,"auto",Di,Ii],Fe=()=>["auto","min","max","fr",Di,Ii],Ct=()=>["start","end","center","between","around","evenly","stretch","baseline"],Et=()=>["start","end","center","stretch"],Tt=()=>["auto",...Ee()],_t=()=>[Iv,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...Ee()],et=()=>[t,Di,Ii],Lt=()=>[CP,jg],lt=()=>["","none","full",k,Di,Ii],ut=()=>["",Ur,x1,jg],Xe=()=>["solid","dashed","dotted","double"],kt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],_n=()=>["","none",Y,Di,Ii],Xt=()=>["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Di,Ii],It=()=>["none",Ur,Di,Ii],ln=()=>["none",Ur,Di,Ii],fn=()=>[Ur,Di,Ii],$t=()=>[Iv,"full",...Ee()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[nm],breakpoint:[nm],color:[f6],container:[nm],"drop-shadow":[nm],ease:["in","out","in-out"],font:[_6],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[nm],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[nm],shadow:[nm],spacing:["px",Ur],text:[nm],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Iv,Ii,Di,Q]}],container:["container"],columns:[{columns:[Ur,Ii,Di,r]}],"break-after":[{"break-after":oe()}],"break-before":[{"break-before":oe()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...ce(),Ii,Di]}],overflow:[{overflow:pe()}],"overflow-x":[{"overflow-x":pe()}],"overflow-y":[{"overflow-y":pe()}],overscroll:[{overscroll:Ae()}],"overscroll-x":[{"overscroll-x":Ae()}],"overscroll-y":[{"overscroll-y":Ae()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:be()}],"inset-x":[{"inset-x":be()}],"inset-y":[{"inset-y":be()}],start:[{start:be()}],end:[{end:be()}],top:[{top:be()}],right:[{right:be()}],bottom:[{bottom:be()}],left:[{left:be()}],visibility:["visible","invisible","collapse"],z:[{z:[Vg,"auto",Di,Ii]}],basis:[{basis:[Iv,"full","auto",r,...Ee()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Ur,Iv,"auto","initial","none",Ii]}],grow:[{grow:["",Ur,Di,Ii]}],shrink:[{shrink:["",Ur,Di,Ii]}],order:[{order:[Vg,"first","last","none",Di,Ii]}],"grid-cols":[{"grid-cols":Ve()}],"col-start-end":[{col:Se()}],"col-start":[{"col-start":xe()}],"col-end":[{"col-end":xe()}],"grid-rows":[{"grid-rows":Ve()}],"row-start-end":[{row:Se()}],"row-start":[{"row-start":xe()}],"row-end":[{"row-end":xe()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":Fe()}],"auto-rows":[{"auto-rows":Fe()}],gap:[{gap:Ee()}],"gap-x":[{"gap-x":Ee()}],"gap-y":[{"gap-y":Ee()}],"justify-content":[{justify:[...Ct(),"normal"]}],"justify-items":[{"justify-items":[...Et(),"normal"]}],"justify-self":[{"justify-self":["auto",...Et()]}],"align-content":[{content:["normal",...Ct()]}],"align-items":[{items:[...Et(),"baseline"]}],"align-self":[{self:["auto",...Et(),"baseline"]}],"place-content":[{"place-content":Ct()}],"place-items":[{"place-items":[...Et(),"baseline"]}],"place-self":[{"place-self":["auto",...Et()]}],p:[{p:Ee()}],px:[{px:Ee()}],py:[{py:Ee()}],ps:[{ps:Ee()}],pe:[{pe:Ee()}],pt:[{pt:Ee()}],pr:[{pr:Ee()}],pb:[{pb:Ee()}],pl:[{pl:Ee()}],m:[{m:Tt()}],mx:[{mx:Tt()}],my:[{my:Tt()}],ms:[{ms:Tt()}],me:[{me:Tt()}],mt:[{mt:Tt()}],mr:[{mr:Tt()}],mb:[{mb:Tt()}],ml:[{ml:Tt()}],"space-x":[{"space-x":Ee()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":Ee()}],"space-y-reverse":["space-y-reverse"],size:[{size:_t()}],w:[{w:[r,"screen",..._t()]}],"min-w":[{"min-w":[r,"screen","none",..._t()]}],"max-w":[{"max-w":[r,"screen","none","prose",{screen:[M]},..._t()]}],h:[{h:["screen",..._t()]}],"min-h":[{"min-h":["screen","none",..._t()]}],"max-h":[{"max-h":["screen",..._t()]}],"font-size":[{text:["base",a,x1,jg]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[c,Di,cT]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",CP,Ii]}],"font-family":[{font:[w6,Ii,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[p,Di,Ii]}],"line-clamp":[{"line-clamp":[Ur,"none",Di,cT]}],leading:[{leading:[y,...Ee()]}],"list-image":[{"list-image":["none",Di,Ii]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Di,Ii]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:et()}],"text-color":[{text:et()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Xe(),"wavy"]}],"text-decoration-thickness":[{decoration:[Ur,"from-font","auto",Di,jg]}],"text-decoration-color":[{decoration:et()}],"underline-offset":[{"underline-offset":[Ur,"auto",Di,Ii]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ee()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Di,Ii]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Di,Ii]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...ce(),S6,y6]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","space","round"]}]}],"bg-size":[{bg:["auto","cover","contain",E6,v6]}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Vg,Di,Ii],radial:["",Di,Ii],conic:[Vg,Di,Ii]},M6,x6]}],"bg-color":[{bg:et()}],"gradient-from-pos":[{from:Lt()}],"gradient-via-pos":[{via:Lt()}],"gradient-to-pos":[{to:Lt()}],"gradient-from":[{from:et()}],"gradient-via":[{via:et()}],"gradient-to":[{to:et()}],rounded:[{rounded:lt()}],"rounded-s":[{"rounded-s":lt()}],"rounded-e":[{"rounded-e":lt()}],"rounded-t":[{"rounded-t":lt()}],"rounded-r":[{"rounded-r":lt()}],"rounded-b":[{"rounded-b":lt()}],"rounded-l":[{"rounded-l":lt()}],"rounded-ss":[{"rounded-ss":lt()}],"rounded-se":[{"rounded-se":lt()}],"rounded-ee":[{"rounded-ee":lt()}],"rounded-es":[{"rounded-es":lt()}],"rounded-tl":[{"rounded-tl":lt()}],"rounded-tr":[{"rounded-tr":lt()}],"rounded-br":[{"rounded-br":lt()}],"rounded-bl":[{"rounded-bl":lt()}],"border-w":[{border:ut()}],"border-w-x":[{"border-x":ut()}],"border-w-y":[{"border-y":ut()}],"border-w-s":[{"border-s":ut()}],"border-w-e":[{"border-e":ut()}],"border-w-t":[{"border-t":ut()}],"border-w-r":[{"border-r":ut()}],"border-w-b":[{"border-b":ut()}],"border-w-l":[{"border-l":ut()}],"divide-x":[{"divide-x":ut()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":ut()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Xe(),"hidden","none"]}],"divide-style":[{divide:[...Xe(),"hidden","none"]}],"border-color":[{border:et()}],"border-color-x":[{"border-x":et()}],"border-color-y":[{"border-y":et()}],"border-color-s":[{"border-s":et()}],"border-color-e":[{"border-e":et()}],"border-color-t":[{"border-t":et()}],"border-color-r":[{"border-r":et()}],"border-color-b":[{"border-b":et()}],"border-color-l":[{"border-l":et()}],"divide-color":[{divide:et()}],"outline-style":[{outline:[...Xe(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Ur,Di,Ii]}],"outline-w":[{outline:["",Ur,x1,jg]}],"outline-color":[{outline:[t]}],shadow:[{shadow:["","none",B,T6,b6]}],"shadow-color":[{shadow:et()}],"inset-shadow":[{"inset-shadow":["none",Di,Ii,U]}],"inset-shadow-color":[{"inset-shadow":et()}],"ring-w":[{ring:ut()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:et()}],"ring-offset-w":[{"ring-offset":[Ur,jg]}],"ring-offset-color":[{"ring-offset":et()}],"inset-ring-w":[{"inset-ring":ut()}],"inset-ring-color":[{"inset-ring":et()}],opacity:[{opacity:[Ur,Di,Ii]}],"mix-blend":[{"mix-blend":[...kt(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":kt()}],filter:[{filter:["","none",Di,Ii]}],blur:[{blur:_n()}],brightness:[{brightness:[Ur,Di,Ii]}],contrast:[{contrast:[Ur,Di,Ii]}],"drop-shadow":[{"drop-shadow":["","none",H,Di,Ii]}],grayscale:[{grayscale:["",Ur,Di,Ii]}],"hue-rotate":[{"hue-rotate":[Ur,Di,Ii]}],invert:[{invert:["",Ur,Di,Ii]}],saturate:[{saturate:[Ur,Di,Ii]}],sepia:[{sepia:["",Ur,Di,Ii]}],"backdrop-filter":[{"backdrop-filter":["","none",Di,Ii]}],"backdrop-blur":[{"backdrop-blur":_n()}],"backdrop-brightness":[{"backdrop-brightness":[Ur,Di,Ii]}],"backdrop-contrast":[{"backdrop-contrast":[Ur,Di,Ii]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Ur,Di,Ii]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Ur,Di,Ii]}],"backdrop-invert":[{"backdrop-invert":["",Ur,Di,Ii]}],"backdrop-opacity":[{"backdrop-opacity":[Ur,Di,Ii]}],"backdrop-saturate":[{"backdrop-saturate":[Ur,Di,Ii]}],"backdrop-sepia":[{"backdrop-sepia":["",Ur,Di,Ii]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":Ee()}],"border-spacing-x":[{"border-spacing-x":Ee()}],"border-spacing-y":[{"border-spacing-y":Ee()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Di,Ii]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Ur,"initial",Di,Ii]}],ease:[{ease:["linear","initial",J,Di,Ii]}],delay:[{delay:[Ur,Di,Ii]}],animate:[{animate:["none",j,Di,Ii]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[X,Di,Ii]}],"perspective-origin":[{"perspective-origin":Xt()}],rotate:[{rotate:It()}],"rotate-x":[{"rotate-x":It()}],"rotate-y":[{"rotate-y":It()}],"rotate-z":[{"rotate-z":It()}],scale:[{scale:ln()}],"scale-x":[{"scale-x":ln()}],"scale-y":[{"scale-y":ln()}],"scale-z":[{"scale-z":ln()}],"scale-3d":["scale-3d"],skew:[{skew:fn()}],"skew-x":[{"skew-x":fn()}],"skew-y":[{"skew-y":fn()}],transform:[{transform:[Di,Ii,"","none","gpu","cpu"]}],"transform-origin":[{origin:Xt()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:$t()}],"translate-x":[{"translate-x":$t()}],"translate-y":[{"translate-y":$t()}],"translate-z":[{"translate-z":$t()}],"translate-none":["translate-none"],accent:[{accent:et()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:et()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Di,Ii]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ee()}],"scroll-mx":[{"scroll-mx":Ee()}],"scroll-my":[{"scroll-my":Ee()}],"scroll-ms":[{"scroll-ms":Ee()}],"scroll-me":[{"scroll-me":Ee()}],"scroll-mt":[{"scroll-mt":Ee()}],"scroll-mr":[{"scroll-mr":Ee()}],"scroll-mb":[{"scroll-mb":Ee()}],"scroll-ml":[{"scroll-ml":Ee()}],"scroll-p":[{"scroll-p":Ee()}],"scroll-px":[{"scroll-px":Ee()}],"scroll-py":[{"scroll-py":Ee()}],"scroll-ps":[{"scroll-ps":Ee()}],"scroll-pe":[{"scroll-pe":Ee()}],"scroll-pt":[{"scroll-pt":Ee()}],"scroll-pr":[{"scroll-pr":Ee()}],"scroll-pb":[{"scroll-pb":Ee()}],"scroll-pl":[{"scroll-pl":Ee()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Di,Ii]}],fill:[{fill:["none",...et()]}],"stroke-w":[{stroke:[Ur,x1,jg,cT]}],stroke:[{stroke:["none",...et()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["before","after","placeholder","file","marker","selection","first-line","first-letter","backdrop","*","**"]}},L6=o6(P6);function yr(...t){return L6(FO(t))}function O6({className:t,children:e,viewport:a=!0,...c}){return se.jsxs(GV,{"data-slot":"navigation-menu","data-viewport":a,className:yr("group/navigation-menu relative flex max-w-max flex-1 items-center justify-center",t),...c,children:[e,a&&se.jsx(k6,{})]})}function z6({className:t,...e}){return se.jsx(HV,{"data-slot":"navigation-menu-list",className:yr("group flex flex-1 list-none items-center justify-center gap-1",t),...e})}function uT({className:t,...e}){return se.jsx(qV,{"data-slot":"navigation-menu-item",className:yr("relative",t),...e})}function k6({className:t,...e}){return se.jsx("div",{className:yr("absolute top-full left-0 isolate z-50 flex justify-center"),children:se.jsx(WV,{"data-slot":"navigation-menu-viewport",className:yr("origin-top-center bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border shadow md:w-[var(--radix-navigation-menu-viewport-width)]",t),...e})})}function gE(){return se.jsxs("div",{style:{maxHeight:"100%"},className:" drop-shadow-lg absolute top-0  sticky w-full border-b bg-zinc-50 backdrop-blur flex flex-row items-center justify-between px-6 h-17 z-50",children:[se.jsx("div",{className:"",style:{height:"100%"},children:se.jsx(_m,{to:"/",className:"",children:se.jsx("img",{src:"./Energy.png",alt:"Object Detected Pole",style:{height:"100%"}})})}),se.jsx("div",{className:"text-black font-bold flex items-center space-x-10",children:se.jsx(O6,{children:se.jsxs(z6,{className:"space-x-8",children:[se.jsx(uT,{children:se.jsx(_m,{to:"/map",children:"Map"})}),se.jsx(uT,{children:se.jsx(_m,{to:"/query",children:"Query"})}),se.jsx(uT,{children:se.jsx(_m,{to:"/upload",children:"Upload"})})]})})})]})}function F6(){return se.jsxs("div",{className:"w-full  py-6 px-4",children:[se.jsx("h2",{className:"text-xl font-bold text-center mb-6",children:"Quick Links"}),se.jsxs("div",{className:"max-w-4xl mx-auto grid justify-between grid-cols-1 sm:grid-cols-3 gap-y-4",children:[se.jsxs(_m,{to:"/query",className:"flex flex-col items-center mx-4 p-4 bg-white rounded-lg shadow-md hover:bg-blue-50 transition-colors",children:[se.jsx(K5,{className:"h-12 w-12 text-black-600 mb-2"}),se.jsx("span",{className:"text-lg font-medium",children:"Inventory"}),se.jsx("p",{className:"text-sm text-rose-500 text-center mt-1",children:"Filter database and find Poles "})]}),se.jsxs(_m,{to:"/map",className:"flex flex-col items-center mx-4 p-4 bg-white rounded-lg shadow-md hover:bg-blue-50 transition-colors",children:[se.jsx(V5,{className:"h-12 w-12 text-black-600 mb-2"}),se.jsx("span",{className:"text-lg font-medium",children:"Map"}),se.jsx("p",{className:"text-sm text-rose-500 text-center mt-1",children:"Explore geographic data on our map"})]}),se.jsxs(_m,{to:"/upload",className:"flex flex-col items-center mx-4 p-4 bg-white rounded-lg shadow-md hover:bg-blue-50 transition-colors",children:[se.jsx(q5,{className:"h-12 w-12 text-black-600 mb-2"}),se.jsx("span",{className:"text-lg font-medium",children:"Upload"}),se.jsx("p",{className:"text-sm text-rose-500 text-center mt-1",children:"Upload new Images and Analzye data "})]})]})]})}const N6=NO("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function fh({className:t,variant:e,size:a,asChild:c=!1,...p}){const y=c?Jf:"button";return se.jsx(y,{"data-slot":"button",className:yr(N6({variant:e,size:a,className:t})),...p})}function B6(t){return Object.prototype.toString.call(t)==="[object Object]"}function RP(t){return B6(t)||Array.isArray(t)}function U6(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function WC(t,e){const a=Object.keys(t),c=Object.keys(e);if(a.length!==c.length)return!1;const p=JSON.stringify(Object.keys(t.breakpoints||{})),y=JSON.stringify(Object.keys(e.breakpoints||{}));return p!==y?!1:a.every(M=>{const r=t[M],I=e[M];return typeof r=="function"?`${r}`==`${I}`:!RP(r)||!RP(I)?r===I:WC(r,I)})}function IP(t){return t.concat().sort((e,a)=>e.name>a.name?1:-1).map(e=>e.options)}function V6(t,e){if(t.length!==e.length)return!1;const a=IP(t),c=IP(e);return a.every((p,y)=>{const M=c[y];return WC(p,M)})}function $C(t){return typeof t=="number"}function z2(t){return typeof t=="string"}function _E(t){return typeof t=="boolean"}function DP(t){return Object.prototype.toString.call(t)==="[object Object]"}function ro(t){return Math.abs(t)}function XC(t){return Math.sign(t)}function P0(t,e){return ro(t-e)}function j6(t,e){if(t===0||e===0||ro(t)<=ro(e))return 0;const a=P0(ro(t),ro(e));return ro(a/t)}function G6(t){return Math.round(t*100)/100}function N0(t){return B0(t).map(Number)}function lh(t){return t[nb(t)]}function nb(t){return Math.max(0,t.length-1)}function ZC(t,e){return e===nb(t)}function PP(t,e=0){return Array.from(Array(t),(a,c)=>e+c)}function B0(t){return Object.keys(t)}function $O(t,e){return[t,e].reduce((a,c)=>(B0(c).forEach(p=>{const y=a[p],M=c[p],r=DP(y)&&DP(M);a[p]=r?$O(y,M):M}),a),{})}function k2(t,e){return typeof e.MouseEvent<"u"&&t instanceof e.MouseEvent}function H6(t,e){const a={start:c,center:p,end:y};function c(){return 0}function p(I){return y(I)/2}function y(I){return e-I}function M(I,k){return z2(t)?a[t](I):t(e,I,k)}return{measure:M}}function U0(){let t=[];function e(p,y,M,r={passive:!0}){let I;if("addEventListener"in p)p.addEventListener(y,M,r),I=()=>p.removeEventListener(y,M,r);else{const k=p;k.addListener(M),I=()=>k.removeListener(M)}return t.push(I),c}function a(){t=t.filter(p=>p())}const c={add:e,clear:a};return c}function q6(t,e,a,c){const p=U0(),y=1e3/60;let M=null,r=0,I=0;function k(){p.add(t,"visibilitychange",()=>{t.hidden&&X()})}function B(){Y(),p.clear()}function U(J){if(!I)return;M||(M=J,a(),a());const j=J-M;for(M=J,r+=j;r>=y;)a(),r-=y;const oe=r/y;c(oe),I&&(I=e.requestAnimationFrame(U))}function H(){I||(I=e.requestAnimationFrame(U))}function Y(){e.cancelAnimationFrame(I),M=null,r=0,I=0}function X(){M=null,r=0}return{init:k,destroy:B,start:H,stop:Y,update:a,render:c}}function W6(t,e){const a=e==="rtl",c=t==="y",p=c?"y":"x",y=c?"x":"y",M=!c&&a?-1:1,r=B(),I=U();function k(X){const{height:Q,width:J}=X;return c?Q:J}function B(){return c?"top":a?"right":"left"}function U(){return c?"bottom":a?"left":"right"}function H(X){return X*M}return{scroll:p,cross:y,startEdge:r,endEdge:I,measureSize:k,direction:H}}function h_(t=0,e=0){const a=ro(t-e);function c(k){return k<t}function p(k){return k>e}function y(k){return c(k)||p(k)}function M(k){return y(k)?c(k)?t:e:k}function r(k){return a?k-a*Math.ceil((k-e)/a):k}return{length:a,max:e,min:t,constrain:M,reachedAny:y,reachedMax:p,reachedMin:c,removeOffset:r}}function XO(t,e,a){const{constrain:c}=h_(0,t),p=t+1;let y=M(e);function M(H){return a?ro((p+H)%p):c(H)}function r(){return y}function I(H){return y=M(H),U}function k(H){return B().set(r()+H)}function B(){return XO(t,r(),a)}const U={get:r,set:I,add:k,clone:B};return U}function $6(t,e,a,c,p,y,M,r,I,k,B,U,H,Y,X,Q,J,j,oe){const{cross:ce,direction:pe}=t,Ae=["INPUT","SELECT","TEXTAREA"],Ee={passive:!1},be=U0(),Ve=U0(),Se=h_(50,225).constrain(Y.measure(20)),xe={mouse:300,touch:400},Fe={mouse:500,touch:600},Ct=X?43:25;let Et=!1,Tt=0,_t=0,et=!1,Lt=!1,lt=!1,ut=!1;function Xe(vn){if(!oe)return;function qn(Fi){(_E(oe)||oe(vn,Fi))&&fn(Fi)}const ke=e;be.add(ke,"dragstart",Fi=>Fi.preventDefault(),Ee).add(ke,"touchmove",()=>{},Ee).add(ke,"touchend",()=>{}).add(ke,"touchstart",qn).add(ke,"mousedown",qn).add(ke,"touchcancel",pn).add(ke,"contextmenu",pn).add(ke,"click",jn,!0)}function kt(){be.clear(),Ve.clear()}function _n(){const vn=ut?a:e;Ve.add(vn,"touchmove",$t,Ee).add(vn,"touchend",pn).add(vn,"mousemove",$t,Ee).add(vn,"mouseup",pn)}function Xt(vn){const qn=vn.nodeName||"";return Ae.includes(qn)}function It(){return(X?Fe:xe)[ut?"mouse":"touch"]}function ln(vn,qn){const ke=U.add(XC(vn)*-1),Fi=B.byDistance(vn,!X).distance;return X||ro(vn)<Se?Fi:J&&qn?Fi*.5:B.byIndex(ke.get(),0).distance}function fn(vn){const qn=k2(vn,c);ut=qn,lt=X&&qn&&!vn.buttons&&Et,Et=P0(p.get(),M.get())>=2,!(qn&&vn.button!==0)&&(Xt(vn.target)||(et=!0,y.pointerDown(vn),k.useFriction(0).useDuration(0),p.set(M),_n(),Tt=y.readPoint(vn),_t=y.readPoint(vn,ce),H.emit("pointerDown")))}function $t(vn){if(!k2(vn,c)&&vn.touches.length>=2)return pn(vn);const ke=y.readPoint(vn),Fi=y.readPoint(vn,ce),di=P0(ke,Tt),bi=P0(Fi,_t);if(!Lt&&!ut&&(!vn.cancelable||(Lt=di>bi,!Lt)))return pn(vn);const Mn=y.pointerMove(vn);di>Q&&(lt=!0),k.useFriction(.3).useDuration(.75),r.start(),p.add(pe(Mn)),vn.preventDefault()}function pn(vn){const ke=B.byDistance(0,!1).index!==U.get(),Fi=y.pointerUp(vn)*It(),di=ln(pe(Fi),ke),bi=j6(Fi,di),Mn=Ct-10*bi,wi=j+bi/50;Lt=!1,et=!1,Ve.clear(),k.useDuration(Mn).useFriction(wi),I.distance(di,!X),ut=!1,H.emit("pointerUp")}function jn(vn){lt&&(vn.stopPropagation(),vn.preventDefault(),lt=!1)}function Pe(){return et}return{init:Xe,destroy:kt,pointerDown:Pe}}function X6(t,e){let c,p;function y(U){return U.timeStamp}function M(U,H){const X=`client${(H||t.scroll)==="x"?"X":"Y"}`;return(k2(U,e)?U:U.touches[0])[X]}function r(U){return c=U,p=U,M(U)}function I(U){const H=M(U)-M(p),Y=y(U)-y(c)>170;return p=U,Y&&(c=U),H}function k(U){if(!c||!p)return 0;const H=M(p)-M(c),Y=y(U)-y(c),X=y(U)-y(p)>170,Q=H/Y;return Y&&!X&&ro(Q)>.1?Q:0}return{pointerDown:r,pointerMove:I,pointerUp:k,readPoint:M}}function Z6(){function t(a){const{offsetTop:c,offsetLeft:p,offsetWidth:y,offsetHeight:M}=a;return{top:c,right:p+y,bottom:c+M,left:p,width:y,height:M}}return{measure:t}}function Y6(t){function e(c){return t*(c/100)}return{measure:e}}function K6(t,e,a,c,p,y,M){const r=[t].concat(c);let I,k,B=[],U=!1;function H(J){return p.measureSize(M.measure(J))}function Y(J){if(!y)return;k=H(t),B=c.map(H);function j(oe){for(const ce of oe){if(U)return;const pe=ce.target===t,Ae=c.indexOf(ce.target),Ee=pe?k:B[Ae],be=H(pe?t:c[Ae]);if(ro(be-Ee)>=.5){J.reInit(),e.emit("resize");break}}}I=new ResizeObserver(oe=>{(_E(y)||y(J,oe))&&j(oe)}),a.requestAnimationFrame(()=>{r.forEach(oe=>I.observe(oe))})}function X(){U=!0,I&&I.disconnect()}return{init:Y,destroy:X}}function J6(t,e,a,c,p,y){let M=0,r=0,I=p,k=y,B=t.get(),U=0;function H(){const Ee=c.get()-t.get(),be=!I;let Ve=0;return be?(M=0,a.set(c),t.set(c),Ve=Ee):(a.set(t),M+=Ee/I,M*=k,B+=M,t.add(M),Ve=B-U),r=XC(Ve),U=B,Ae}function Y(){const Ee=c.get()-e.get();return ro(Ee)<.001}function X(){return I}function Q(){return r}function J(){return M}function j(){return ce(p)}function oe(){return pe(y)}function ce(Ee){return I=Ee,Ae}function pe(Ee){return k=Ee,Ae}const Ae={direction:Q,duration:X,velocity:J,seek:H,settled:Y,useBaseFriction:oe,useBaseDuration:j,useFriction:pe,useDuration:ce};return Ae}function Q6(t,e,a,c,p){const y=p.measure(10),M=p.measure(50),r=h_(.1,.99);let I=!1;function k(){return!(I||!t.reachedAny(a.get())||!t.reachedAny(e.get()))}function B(Y){if(!k())return;const X=t.reachedMin(e.get())?"min":"max",Q=ro(t[X]-e.get()),J=a.get()-e.get(),j=r.constrain(Q/M);a.subtract(J*j),!Y&&ro(J)<y&&(a.set(t.constrain(a.get())),c.useDuration(25).useBaseFriction())}function U(Y){I=!Y}return{shouldConstrain:k,constrain:B,toggleActive:U}}function ej(t,e,a,c,p){const y=h_(-e+t,0),M=U(),r=B(),I=H();function k(X,Q){return P0(X,Q)<=1}function B(){const X=M[0],Q=lh(M),J=M.lastIndexOf(X),j=M.indexOf(Q)+1;return h_(J,j)}function U(){return a.map((X,Q)=>{const{min:J,max:j}=y,oe=y.constrain(X),ce=!Q,pe=ZC(a,Q);return ce?j:pe||k(J,oe)?J:k(j,oe)?j:oe}).map(X=>parseFloat(X.toFixed(3)))}function H(){if(e<=t+p)return[y.max];if(c==="keepSnaps")return M;const{min:X,max:Q}=r;return M.slice(X,Q)}return{snapsContained:I,scrollContainLimit:r}}function tj(t,e,a){const c=e[0],p=a?c-t:lh(e);return{limit:h_(p,c)}}function nj(t,e,a,c){const y=e.min+.1,M=e.max+.1,{reachedMin:r,reachedMax:I}=h_(y,M);function k(H){return H===1?I(a.get()):H===-1?r(a.get()):!1}function B(H){if(!k(H))return;const Y=t*(H*-1);c.forEach(X=>X.add(Y))}return{loop:B}}function ij(t){const{max:e,length:a}=t;function c(y){const M=y-e;return a?M/-a:0}return{get:c}}function rj(t,e,a,c,p){const{startEdge:y,endEdge:M}=t,{groupSlides:r}=p,I=U().map(e.measure),k=H(),B=Y();function U(){return r(c).map(Q=>lh(Q)[M]-Q[0][y]).map(ro)}function H(){return c.map(Q=>a[y]-Q[y]).map(Q=>-ro(Q))}function Y(){return r(k).map(Q=>Q[0]).map((Q,J)=>Q+I[J])}return{snaps:k,snapsAligned:B}}function aj(t,e,a,c,p,y){const{groupSlides:M}=p,{min:r,max:I}=c,k=B();function B(){const H=M(y),Y=!t||e==="keepSnaps";return a.length===1?[y]:Y?H:H.slice(r,I).map((X,Q,J)=>{const j=!Q,oe=ZC(J,Q);if(j){const ce=lh(J[0])+1;return PP(ce)}if(oe){const ce=nb(y)-lh(J)[0]+1;return PP(ce,lh(J)[0])}return X})}return{slideRegistry:k}}function oj(t,e,a,c,p){const{reachedAny:y,removeOffset:M,constrain:r}=c;function I(X){return X.concat().sort((Q,J)=>ro(Q)-ro(J))[0]}function k(X){const Q=t?M(X):r(X),J=e.map((oe,ce)=>({diff:B(oe-Q,0),index:ce})).sort((oe,ce)=>ro(oe.diff)-ro(ce.diff)),{index:j}=J[0];return{index:j,distance:Q}}function B(X,Q){const J=[X,X+a,X-a];if(!t)return X;if(!Q)return I(J);const j=J.filter(oe=>XC(oe)===Q);return j.length?I(j):lh(J)-a}function U(X,Q){const J=e[X]-p.get(),j=B(J,Q);return{index:X,distance:j}}function H(X,Q){const J=p.get()+X,{index:j,distance:oe}=k(J),ce=!t&&y(J);if(!Q||ce)return{index:j,distance:X};const pe=e[j]-oe,Ae=X+B(pe,0);return{index:j,distance:Ae}}return{byDistance:H,byIndex:U,shortcut:B}}function sj(t,e,a,c,p,y,M){function r(U){const H=U.distance,Y=U.index!==e.get();y.add(H),H&&(c.duration()?t.start():(t.update(),t.render(1),t.update())),Y&&(a.set(e.get()),e.set(U.index),M.emit("select"))}function I(U,H){const Y=p.byDistance(U,H);r(Y)}function k(U,H){const Y=e.clone().set(U),X=p.byIndex(Y.get(),H);r(X)}return{distance:I,index:k}}function lj(t,e,a,c,p,y,M,r){const I={passive:!0,capture:!0};let k=0;function B(Y){if(!r)return;function X(Q){if(new Date().getTime()-k>10)return;M.emit("slideFocusStart"),t.scrollLeft=0;const oe=a.findIndex(ce=>ce.includes(Q));$C(oe)&&(p.useDuration(0),c.index(oe,0),M.emit("slideFocus"))}y.add(document,"keydown",U,!1),e.forEach((Q,J)=>{y.add(Q,"focus",j=>{(_E(r)||r(Y,j))&&X(J)},I)})}function U(Y){Y.code==="Tab"&&(k=new Date().getTime())}return{init:B}}function i0(t){let e=t;function a(){return e}function c(I){e=M(I)}function p(I){e+=M(I)}function y(I){e-=M(I)}function M(I){return $C(I)?I:I.get()}return{get:a,set:c,add:p,subtract:y}}function ZO(t,e){const a=t.scroll==="x"?M:r,c=e.style;let p=null,y=!1;function M(H){return`translate3d(${H}px,0px,0px)`}function r(H){return`translate3d(0px,${H}px,0px)`}function I(H){if(y)return;const Y=G6(t.direction(H));Y!==p&&(c.transform=a(Y),p=Y)}function k(H){y=!H}function B(){y||(c.transform="",e.getAttribute("style")||e.removeAttribute("style"))}return{clear:B,to:I,toggleActive:k}}function cj(t,e,a,c,p,y,M,r,I){const B=N0(p),U=N0(p).reverse(),H=j().concat(oe());function Y(be,Ve){return be.reduce((Se,xe)=>Se-p[xe],Ve)}function X(be,Ve){return be.reduce((Se,xe)=>Y(Se,Ve)>0?Se.concat([xe]):Se,[])}function Q(be){return y.map((Ve,Se)=>({start:Ve-c[Se]+.5+be,end:Ve+e-.5+be}))}function J(be,Ve,Se){const xe=Q(Ve);return be.map(Fe=>{const Ct=Se?0:-a,Et=Se?a:0,Tt=Se?"end":"start",_t=xe[Fe][Tt];return{index:Fe,loopPoint:_t,slideLocation:i0(-1),translate:ZO(t,I[Fe]),target:()=>r.get()>_t?Ct:Et}})}function j(){const be=M[0],Ve=X(U,be);return J(Ve,a,!1)}function oe(){const be=e-M[0]-1,Ve=X(B,be);return J(Ve,-a,!0)}function ce(){return H.every(({index:be})=>{const Ve=B.filter(Se=>Se!==be);return Y(Ve,e)<=.1})}function pe(){H.forEach(be=>{const{target:Ve,translate:Se,slideLocation:xe}=be,Fe=Ve();Fe!==xe.get()&&(Se.to(Fe),xe.set(Fe))})}function Ae(){H.forEach(be=>be.translate.clear())}return{canLoop:ce,clear:Ae,loop:pe,loopPoints:H}}function uj(t,e,a){let c,p=!1;function y(I){if(!a)return;function k(B){for(const U of B)if(U.type==="childList"){I.reInit(),e.emit("slidesChanged");break}}c=new MutationObserver(B=>{p||(_E(a)||a(I,B))&&k(B)}),c.observe(t,{childList:!0})}function M(){c&&c.disconnect(),p=!0}return{init:y,destroy:M}}function hj(t,e,a,c){const p={};let y=null,M=null,r,I=!1;function k(){r=new IntersectionObserver(X=>{I||(X.forEach(Q=>{const J=e.indexOf(Q.target);p[J]=Q}),y=null,M=null,a.emit("slidesInView"))},{root:t.parentElement,threshold:c}),e.forEach(X=>r.observe(X))}function B(){r&&r.disconnect(),I=!0}function U(X){return B0(p).reduce((Q,J)=>{const j=parseInt(J),{isIntersecting:oe}=p[j];return(X&&oe||!X&&!oe)&&Q.push(j),Q},[])}function H(X=!0){if(X&&y)return y;if(!X&&M)return M;const Q=U(X);return X&&(y=Q),X||(M=Q),Q}return{init:k,destroy:B,get:H}}function dj(t,e,a,c,p,y){const{measureSize:M,startEdge:r,endEdge:I}=t,k=a[0]&&p,B=X(),U=Q(),H=a.map(M),Y=J();function X(){if(!k)return 0;const oe=a[0];return ro(e[r]-oe[r])}function Q(){if(!k)return 0;const oe=y.getComputedStyle(lh(c));return parseFloat(oe.getPropertyValue(`margin-${I}`))}function J(){return a.map((oe,ce,pe)=>{const Ae=!ce,Ee=ZC(pe,ce);return Ae?H[ce]+B:Ee?H[ce]+U:pe[ce+1][r]-oe[r]}).map(ro)}return{slideSizes:H,slideSizesWithGaps:Y,startGap:B,endGap:U}}function fj(t,e,a,c,p,y,M,r,I){const{startEdge:k,endEdge:B,direction:U}=t,H=$C(a);function Y(j,oe){return N0(j).filter(ce=>ce%oe===0).map(ce=>j.slice(ce,ce+oe))}function X(j){return j.length?N0(j).reduce((oe,ce,pe)=>{const Ae=lh(oe)||0,Ee=Ae===0,be=ce===nb(j),Ve=p[k]-y[Ae][k],Se=p[k]-y[ce][B],xe=!c&&Ee?U(M):0,Fe=!c&&be?U(r):0,Ct=ro(Se-Fe-(Ve+xe));return pe&&Ct>e+I&&oe.push(ce),be&&oe.push(j.length),oe},[]).map((oe,ce,pe)=>{const Ae=Math.max(pe[ce-1]||0);return j.slice(Ae,oe)}):[]}function Q(j){return H?Y(j,a):X(j)}return{groupSlides:Q}}function pj(t,e,a,c,p,y,M){const{align:r,axis:I,direction:k,startIndex:B,loop:U,duration:H,dragFree:Y,dragThreshold:X,inViewThreshold:Q,slidesToScroll:J,skipSnaps:j,containScroll:oe,watchResize:ce,watchSlides:pe,watchDrag:Ae,watchFocus:Ee}=y,be=2,Ve=Z6(),Se=Ve.measure(e),xe=a.map(Ve.measure),Fe=W6(I,k),Ct=Fe.measureSize(Se),Et=Y6(Ct),Tt=H6(r,Ct),_t=!U&&!!oe,et=U||!!oe,{slideSizes:Lt,slideSizesWithGaps:lt,startGap:ut,endGap:Xe}=dj(Fe,Se,xe,a,et,p),kt=fj(Fe,Ct,J,U,Se,xe,ut,Xe,be),{snaps:_n,snapsAligned:Xt}=rj(Fe,Tt,Se,xe,kt),It=-lh(_n)+lh(lt),{snapsContained:ln,scrollContainLimit:fn}=ej(Ct,It,Xt,oe,be),$t=_t?ln:Xt,{limit:pn}=tj(It,$t,U),jn=XO(nb($t),B,U),Pe=jn.clone(),Gn=N0(a),vn=({dragHandler:Ni,scrollBody:Un,scrollBounds:si,options:{loop:ci}})=>{ci||si.constrain(Ni.pointerDown()),Un.seek()},qn=({scrollBody:Ni,translate:Un,location:si,offsetLocation:ci,previousLocation:_i,scrollLooper:ui,slideLooper:Ai,dragHandler:Si,animation:Wn,eventHandler:Ot,scrollBounds:ai,options:{loop:on}},wn)=>{const Kn=Ni.settled(),ti=!ai.shouldConstrain(),Vi=on?Kn:Kn&&ti;Vi&&!Si.pointerDown()&&(Wn.stop(),Ot.emit("settle")),Vi||Ot.emit("scroll");const Zr=si.get()*wn+_i.get()*(1-wn);ci.set(Zr),on&&(ui.loop(Ni.direction()),Ai.loop()),Un.to(ci.get())},ke=q6(c,p,()=>vn(Jn),Ni=>qn(Jn,Ni)),Fi=.68,di=$t[jn.get()],bi=i0(di),Mn=i0(di),wi=i0(di),ei=i0(di),ot=J6(bi,wi,Mn,ei,H,Fi),Ue=oj(U,$t,It,pn,ei),Yt=sj(ke,jn,Pe,ot,Ue,ei,M),gt=ij(pn),Kt=U0(),an=hj(e,a,M,Q),{slideRegistry:Xn}=aj(_t,oe,$t,fn,kt,Gn),On=lj(t,a,Xn,Yt,ot,Kt,M,Ee),Jn={ownerDocument:c,ownerWindow:p,eventHandler:M,containerRect:Se,slideRects:xe,animation:ke,axis:Fe,dragHandler:$6(Fe,t,c,p,ei,X6(Fe,p),bi,ke,Yt,ot,Ue,jn,M,Et,Y,X,j,Fi,Ae),eventStore:Kt,percentOfView:Et,index:jn,indexPrevious:Pe,limit:pn,location:bi,offsetLocation:wi,previousLocation:Mn,options:y,resizeHandler:K6(e,M,p,a,Fe,ce,Ve),scrollBody:ot,scrollBounds:Q6(pn,wi,ei,ot,Et),scrollLooper:nj(It,pn,wi,[bi,wi,Mn,ei]),scrollProgress:gt,scrollSnapList:$t.map(gt.get),scrollSnaps:$t,scrollTarget:Ue,scrollTo:Yt,slideLooper:cj(Fe,Ct,It,Lt,lt,_n,$t,wi,a),slideFocus:On,slidesHandler:uj(e,M,pe),slidesInView:an,slideIndexes:Gn,slideRegistry:Xn,slidesToScroll:kt,target:ei,translate:ZO(Fe,e)};return Jn}function mj(){let t={},e;function a(k){e=k}function c(k){return t[k]||[]}function p(k){return c(k).forEach(B=>B(e,k)),I}function y(k,B){return t[k]=c(k).concat([B]),I}function M(k,B){return t[k]=c(k).filter(U=>U!==B),I}function r(){t={}}const I={init:a,emit:p,off:M,on:y,clear:r};return I}const gj={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function _j(t){function e(y,M){return $O(y,M||{})}function a(y){const M=y.breakpoints||{},r=B0(M).filter(I=>t.matchMedia(I).matches).map(I=>M[I]).reduce((I,k)=>e(I,k),{});return e(y,r)}function c(y){return y.map(M=>B0(M.breakpoints||{})).reduce((M,r)=>M.concat(r),[]).map(t.matchMedia)}return{mergeOptions:e,optionsAtMedia:a,optionsMediaQueries:c}}function vj(t){let e=[];function a(y,M){return e=M.filter(({options:r})=>t.optionsAtMedia(r).active!==!1),e.forEach(r=>r.init(y,t)),M.reduce((r,I)=>Object.assign(r,{[I.name]:I}),{})}function c(){e=e.filter(y=>y.destroy())}return{init:a,destroy:c}}function HS(t,e,a){const c=t.ownerDocument,p=c.defaultView,y=_j(p),M=vj(y),r=U0(),I=mj(),{mergeOptions:k,optionsAtMedia:B,optionsMediaQueries:U}=y,{on:H,off:Y,emit:X}=I,Q=Fe;let J=!1,j,oe=k(gj,HS.globalOptions),ce=k(oe),pe=[],Ae,Ee,be;function Ve(){const{container:Gn,slides:vn}=ce;Ee=(z2(Gn)?t.querySelector(Gn):Gn)||t.children[0];const ke=z2(vn)?Ee.querySelectorAll(vn):vn;be=[].slice.call(ke||Ee.children)}function Se(Gn){const vn=pj(t,Ee,be,c,p,Gn,I);if(Gn.loop&&!vn.slideLooper.canLoop()){const qn=Object.assign({},Gn,{loop:!1});return Se(qn)}return vn}function xe(Gn,vn){J||(oe=k(oe,Gn),ce=B(oe),pe=vn||pe,Ve(),j=Se(ce),U([oe,...pe.map(({options:qn})=>qn)]).forEach(qn=>r.add(qn,"change",Fe)),ce.active&&(j.translate.to(j.location.get()),j.animation.init(),j.slidesInView.init(),j.slideFocus.init(Pe),j.eventHandler.init(Pe),j.resizeHandler.init(Pe),j.slidesHandler.init(Pe),j.options.loop&&j.slideLooper.loop(),Ee.offsetParent&&be.length&&j.dragHandler.init(Pe),Ae=M.init(Pe,pe)))}function Fe(Gn,vn){const qn=kt();Ct(),xe(k({startIndex:qn},Gn),vn),I.emit("reInit")}function Ct(){j.dragHandler.destroy(),j.eventStore.clear(),j.translate.clear(),j.slideLooper.clear(),j.resizeHandler.destroy(),j.slidesHandler.destroy(),j.slidesInView.destroy(),j.animation.destroy(),M.destroy(),r.clear()}function Et(){J||(J=!0,r.clear(),Ct(),I.emit("destroy"),I.clear())}function Tt(Gn,vn,qn){!ce.active||J||(j.scrollBody.useBaseFriction().useDuration(vn===!0?0:ce.duration),j.scrollTo.index(Gn,qn||0))}function _t(Gn){const vn=j.index.add(1).get();Tt(vn,Gn,-1)}function et(Gn){const vn=j.index.add(-1).get();Tt(vn,Gn,1)}function Lt(){return j.index.add(1).get()!==kt()}function lt(){return j.index.add(-1).get()!==kt()}function ut(){return j.scrollSnapList}function Xe(){return j.scrollProgress.get(j.location.get())}function kt(){return j.index.get()}function _n(){return j.indexPrevious.get()}function Xt(){return j.slidesInView.get()}function It(){return j.slidesInView.get(!1)}function ln(){return Ae}function fn(){return j}function $t(){return t}function pn(){return Ee}function jn(){return be}const Pe={canScrollNext:Lt,canScrollPrev:lt,containerNode:pn,internalEngine:fn,destroy:Et,off:Y,on:H,emit:X,plugins:ln,previousScrollSnap:_n,reInit:Q,rootNode:$t,scrollNext:_t,scrollPrev:et,scrollProgress:Xe,scrollSnapList:ut,scrollTo:Tt,selectedScrollSnap:kt,slideNodes:jn,slidesInView:Xt,slidesNotInView:It};return xe(e,a),setTimeout(()=>I.emit("init"),0),Pe}HS.globalOptions=void 0;function YC(t={},e=[]){const a=le.useRef(t),c=le.useRef(e),[p,y]=le.useState(),[M,r]=le.useState(),I=le.useCallback(()=>{p&&p.reInit(a.current,c.current)},[p]);return le.useEffect(()=>{WC(a.current,t)||(a.current=t,I())},[t,I]),le.useEffect(()=>{V6(c.current,e)||(c.current=e,I())},[e,I]),le.useEffect(()=>{if(U6()&&M){HS.globalOptions=YC.globalOptions;const k=HS(M,a.current,c.current);return y(k),()=>k.destroy()}else y(void 0)},[M,y]),[r,p]}YC.globalOptions=void 0;const YO=le.createContext(null);function vE(){const t=le.useContext(YO);if(!t)throw new Error("useCarousel must be used within a <Carousel />");return t}function yj({orientation:t="horizontal",opts:e,setApi:a,plugins:c,className:p,children:y,...M}){const[r,I]=YC({...e,axis:t==="horizontal"?"x":"y"},c),[k,B]=le.useState(!1),[U,H]=le.useState(!1),Y=le.useCallback(j=>{j&&(B(j.canScrollPrev()),H(j.canScrollNext()))},[]),X=le.useCallback(()=>{I==null||I.scrollPrev()},[I]),Q=le.useCallback(()=>{I==null||I.scrollNext()},[I]),J=le.useCallback(j=>{j.key==="ArrowLeft"?(j.preventDefault(),X()):j.key==="ArrowRight"&&(j.preventDefault(),Q())},[X,Q]);return le.useEffect(()=>{!I||!a||a(I)},[I,a]),le.useEffect(()=>{if(I)return Y(I),I.on("reInit",Y),I.on("select",Y),()=>{I==null||I.off("select",Y)}},[I,Y]),se.jsx(YO.Provider,{value:{carouselRef:r,api:I,opts:e,orientation:t||((e==null?void 0:e.axis)==="y"?"vertical":"horizontal"),scrollPrev:X,scrollNext:Q,canScrollPrev:k,canScrollNext:U},children:se.jsx("div",{onKeyDownCapture:J,className:yr("relative",p),role:"region","aria-roledescription":"carousel","data-slot":"carousel",...M,children:y})})}function xj({className:t,...e}){const{carouselRef:a,orientation:c}=vE();return se.jsx("div",{ref:a,className:"overflow-hidden","data-slot":"carousel-content",children:se.jsx("div",{className:yr("flex",c==="horizontal"?"-ml-4":"-mt-4 flex-col",t),...e})})}function hT({className:t,...e}){const{orientation:a}=vE();return se.jsx("div",{role:"group","aria-roledescription":"slide","data-slot":"carousel-item",className:yr("min-w-0 shrink-0 grow-0 basis-full",a==="horizontal"?"pl-4":"pt-4",t),...e})}function bj({className:t,variant:e="outline",size:a="icon",...c}){const{orientation:p,scrollPrev:y,canScrollPrev:M}=vE();return se.jsxs(fh,{"data-slot":"carousel-previous",variant:e,size:a,className:yr("absolute size-8 rounded-full",p==="horizontal"?"top-1/2 -left-12 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",t),disabled:!M,onClick:y,...c,children:[se.jsx(D5,{}),se.jsx("span",{className:"sr-only",children:"Previous slide"})]})}function wj({className:t,variant:e="outline",size:a="icon",...c}){const{orientation:p,scrollNext:y,canScrollNext:M}=vE();return se.jsxs(fh,{"data-slot":"carousel-next",variant:e,size:a,className:yr("absolute size-8 rounded-full",p==="horizontal"?"top-1/2 -right-12 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",t),disabled:!M,onClick:y,...c,children:[se.jsx(L5,{}),se.jsx("span",{className:"sr-only",children:"Next slide"})]})}function xd({className:t,...e}){return se.jsx("div",{"data-slot":"card",className:yr("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...e})}function F2({className:t,...e}){return se.jsx("div",{"data-slot":"card-header",className:yr("flex flex-col gap-1.5 px-6",t),...e})}function qS({className:t,...e}){return se.jsx("div",{"data-slot":"card-title",className:yr("leading-none font-semibold",t),...e})}function Sj({className:t,...e}){return se.jsx("div",{"data-slot":"card-description",className:yr("text-muted-foreground text-sm",t),...e})}function yE({className:t,...e}){return se.jsx("div",{"data-slot":"card-content",className:yr("px-6",t),...e})}var Ej="Label",KO=le.forwardRef((t,e)=>se.jsx(fr.label,{...t,ref:e,onMouseDown:a=>{var p;a.target.closest("button, input, select, textarea")||((p=t.onMouseDown)==null||p.call(t,a),!a.defaultPrevented&&a.detail>1&&a.preventDefault())}}));KO.displayName=Ej;var Mj=KO;function LP({className:t,...e}){return se.jsx(Mj,{"data-slot":"label",className:yr("text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...e})}var Tj="Separator",OP="horizontal",Aj=["horizontal","vertical"],JO=le.forwardRef((t,e)=>{const{decorative:a,orientation:c=OP,...p}=t,y=Cj(c)?c:OP,r=a?{role:"none"}:{"aria-orientation":y==="vertical"?y:void 0,role:"separator"};return se.jsx(fr.div,{"data-orientation":y,...r,...p,ref:e})});JO.displayName=Tj;function Cj(t){return Aj.includes(t)}var Rj=JO;function Ij({className:t,orientation:e="horizontal",decorative:a=!0,...c}){return se.jsx(Rj,{"data-slot":"separator-root",decorative:a,orientation:e,className:yr("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",t),...c})}const dT=({imagePath:t,initialTitle:e="",initialDescription:a="",onTitleChange:c,onDescriptionChange:p})=>{const[y,M]=le.useState(e),[r,I]=le.useState(a);return se.jsx(xd,{className:"w-full max-w-4xl",children:se.jsxs(yE,{className:"grid md:grid-cols-2 gap-6 p-6",children:[se.jsx("div",{className:"flex items-center justify-center bg-gray-100 ",children:t?se.jsx("img",{src:t,alt:"Description",className:"max-h-[400px] max-w-full object-contain"}):se.jsx("div",{className:"text-gray-500 text-center p-6",children:"No image selected"})}),se.jsxs("div",{className:"space-y-4",children:[se.jsx("div",{className:"space-y-2 text-black font-bold",children:se.jsx(LP,{className:"text-black font-bold",htmlFor:"title",children:y})}),se.jsx(Ij,{className:"bg-purple-500 "}),se.jsx("div",{className:"space-y-2",children:se.jsx(LP,{className:"font-semibold",htmlFor:"description",children:r})})]})]})})},Dj={active:!0,breakpoints:{},delay:4e3,jump:!1,playOnInit:!0,stopOnFocusIn:!0,stopOnInteraction:!0,stopOnMouseEnter:!1,stopOnLastSnap:!1,rootNode:null};function Pj(t,e){const a=t.scrollSnapList();return typeof e=="number"?a.map(()=>e):e(a,t)}function Lj(t,e){const a=t.rootNode();return e&&e(a)||a}function KC(t={}){let e,a,c,p,y=null,M=0,r=!1,I=!1,k=!1,B=!1;function U(Tt,_t){a=Tt;const{mergeOptions:et,optionsAtMedia:Lt}=_t,lt=et(Dj,KC.globalOptions),ut=et(lt,t);if(e=Lt(ut),a.scrollSnapList().length<=1)return;B=e.jump,c=!1,p=Pj(a,e.delay);const{eventStore:Xe,ownerDocument:kt}=a.internalEngine(),_n=!!a.internalEngine().options.watchDrag,Xt=Lj(a,e.rootNode);Xe.add(kt,"visibilitychange",j),_n&&a.on("pointerDown",ce),_n&&!e.stopOnInteraction&&a.on("pointerUp",pe),e.stopOnMouseEnter&&Xe.add(Xt,"mouseenter",Ae),e.stopOnMouseEnter&&!e.stopOnInteraction&&Xe.add(Xt,"mouseleave",Ee),e.stopOnFocusIn&&a.on("slideFocusStart",J),e.stopOnFocusIn&&!e.stopOnInteraction&&Xe.add(a.containerNode(),"focusout",Q),e.playOnInit&&Q()}function H(){a.off("pointerDown",ce).off("pointerUp",pe).off("slideFocusStart",J),J(),c=!0,r=!1}function Y(){const{ownerWindow:Tt}=a.internalEngine();Tt.clearTimeout(M),M=Tt.setTimeout(Fe,p[a.selectedScrollSnap()]),y=new Date().getTime(),a.emit("autoplay:timerset")}function X(){const{ownerWindow:Tt}=a.internalEngine();Tt.clearTimeout(M),M=0,y=null,a.emit("autoplay:timerstopped")}function Q(){if(!c){if(oe()){k=!0;return}r||a.emit("autoplay:play"),Y(),r=!0}}function J(){c||(r&&a.emit("autoplay:stop"),X(),r=!1)}function j(){if(oe())return k=r,J();k&&Q()}function oe(){const{ownerDocument:Tt}=a.internalEngine();return Tt.visibilityState==="hidden"}function ce(){I||J()}function pe(){I||Q()}function Ae(){I=!0,J()}function Ee(){I=!1,Q()}function be(Tt){typeof Tt<"u"&&(B=Tt),Q()}function Ve(){r&&J()}function Se(){r&&Q()}function xe(){return r}function Fe(){const{index:Tt}=a.internalEngine(),_t=Tt.clone().add(1).get(),et=a.scrollSnapList().length-1,Lt=e.stopOnLastSnap&&_t===et;if(a.canScrollNext()?a.scrollNext(B):a.scrollTo(0,B),a.emit("autoplay:select"),Lt)return J();Q()}function Ct(){if(!y)return null;const Tt=p[a.selectedScrollSnap()],_t=new Date().getTime()-y;return Tt-_t}return{name:"autoplay",options:t,init:U,destroy:H,play:be,stop:Ve,reset:Se,isPlaying:xe,timeUntilNext:Ct}}KC.globalOptions=void 0;function Oj(){const t=le.useRef(null);return se.jsxs("div",{className:"min-h-screen bg-zinc-300 flex flex-col w-full",children:[se.jsx(gE,{}),se.jsx("main",{className:"flex-col flex items-center justify-center w-full px-4 py-8",children:se.jsxs("div",{className:"bg-zinc-50   rounded-lg shadow-lg overflow-hidden",style:{maxWidth:"100%"},children:[se.jsxs("div",{className:"flex flex-col items-center py-12 px-4 md:px-8 lg:px-12",children:[se.jsxs("div",{className:"text-center w-full max-w-3xl mx-auto mb-12",children:[se.jsxs("h1",{className:"text-3xl md:text-5xl font-bold mb-6 text-black",children:[se.jsx("span",{className:"text-transparent bg-gradient-to-r from-blue-500 to-green-400 bg-clip-text",children:"ERIC"})," ","powered by <Energy Company>"]}),se.jsxs("div",{className:"relative w-full bg-rose-100 border border-rose-300 rounded-lg p-4 mb-6",children:[se.jsx("div",{className:"absolute top-2 right-2",children:se.jsx("button",{"aria-label":"Close",className:"text-rose-500 hover:text-rose-700",onClick:e=>{const a=e.currentTarget.closest("div.w-full");a&&(a.style.display="none")},children:"✕"})}),se.jsx("p",{className:"text-zinc-600 text-sm",children:"This project was made in partnership with a local New Orleans power transmission company. The company's logos and branding have been removed for this publicly hosted version."})]}),se.jsx("p",{className:"text-zinc-600 text-lg mb-8 max-w-2xl mx-auto",children:"Harnessing AI to Help <Energy Company> Technicians Quickly Locate and Repair Damaged Power Poles with Precision and Efficiency."}),se.jsx(fh,{className:"bg-rose-500",onClick:()=>{var e;return(e=t.current)==null?void 0:e.scrollIntoView({behavior:"smooth"})},children:"Learn More"})]}),se.jsxs("div",{className:" relative w-full flex flex-col items-center justify-center mt-4 ",children:[se.jsx("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2 w-[90%] h-40 bg-rose-500/30 rounded-full blur-3xl"}),se.jsxs(yj,{className:"max-w-4xl w-full",plugins:[KC({delay:1e4})],children:[se.jsxs(xj,{children:[se.jsx(hT,{children:se.jsx("div",{className:"flex justify-center p-4 ",children:se.jsx(dT,{imagePath:"./carousel/carousel1.png",initialTitle:"LLM-Powered Damage Analytics",initialDescription:"Get in-depth breakdowns of pole components and damage severity with our AI-driven analytics. Our system provides clear, concise descriptions, ensuring you understand the condition of each structure at a glance.",onTitleChange:e=>console.log(e),onDescriptionChange:e=>console.log(e)})})}),se.jsx(hT,{children:se.jsx("div",{className:"flex justify-center p-4",children:se.jsx(dT,{imagePath:"./carousel/carousel2.png",initialTitle:"Intelligent Pole Database",initialDescription:"Effortlessly store and retrieve utility pole data with our intuitive database system. Navigate through records seamlessly, query specific poles with ease, and access structured insights—all in one streamlined interface.",onTitleChange:e=>console.log(e),onDescriptionChange:e=>console.log(e)})})}),se.jsx(hT,{children:se.jsx("div",{className:"flex justify-center p-4",children:se.jsx(dT,{imagePath:"./carousel/carousel3.png",initialTitle:"AI Generated Damage Reports",initialDescription:"Transform raw data into comprehensive reports with a single click. Our AI compiles detailed component analyses, damage assessments, and key takeaways, giving you professional-grade insights instantly.",onTitleChange:e=>console.log(e),onDescriptionChange:e=>console.log(e)})})})]}),se.jsxs("div",{className:"flex justify-center items-center space-x-4 mt-4",children:[se.jsx(bj,{}),se.jsx(wj,{})]})]})]})]}),se.jsx("div",{ref:t}),se.jsx(F6,{}),se.jsxs("div",{className:"flex flex-col w-full max-w-4xl items-center justify-center text-center mx-auto mt-4",children:[se.jsx("h2",{className:"text-xl font-bold mb-6 text-black",children:"About Us"}),se.jsx("img",{src:"./team.jpeg",alt:"dashboard",className:" w-2/3 rounded-lg border border-gray-200 shadow-lg mb-4"}),se.jsx("p",{className:"text-zinc-600 text-sm mb-8 max-w-2xl mx-auto",children:"We are a team of LSU students passionate about leveraging AI to solve real-world challenges. Collaborating with experienced mentors from <Energy Company>, Our goal is to streamline damage assessment with intelligent databases, AI-powered analytics, and automated reporting—helping industries make faster, data-driven decisions."})]})]})})]})}function zj({imageId:t,setStatus:e,setImageDetails:a,setImageSrc:c}){const p=async M=>{console.log("Fetching Image Details");try{const r=await fetch(`/api/images/${M}.json`);if(r.ok){const I=await r.json();if(I.id)return a(I),y(I.id),console.log(I),!0}else console.error("Error fetching image details:",r.statusText)}catch(r){console.error("Error fetching image details:",r)}return console.log("return"),!1},y=async M=>{console.log("Fetching Image Src");try{const r=await fetch(`/api/images/${M}/data`);if(r.ok){const I=await r.blob(),k=URL.createObjectURL(I);c(k),e("result")}else console.error("Error fetching image:",r.statusText)}catch(r){console.error("Error fetching image:",r)}};return le.useEffect(()=>{let M=!0;function r(){console.log("Get Image"),p(96).then(I=>!I&&M&&setTimeout(r,300)),console.log("Get Image 12")}return setTimeout(r,3e3),()=>{M=!1}},[t]),se.jsxs("div",{className:"text-black  flex flex-col items-center justify-center space-y-4 p-8",children:[se.jsx("div",{className:"animate-spin",children:se.jsx($5,{className:"h-12 w-12 text-violet-700"})}),se.jsx("div",{className:"text-lg font-semibold",children:"Analyzing Pole Components for Damage with AI..."})]})}const kj=NO("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function JC({className:t,variant:e,asChild:a=!1,...c}){const p=a?Jf:"span";return se.jsx(p,{"data-slot":"badge",className:yr(kj({variant:e}),t),...c})}function Fj({imageDetails:t,imageSrc:e}){const a=c=>{switch(c==null?void 0:c.toLowerCase()){case"good":return"bg-green-500";case"fair":return"bg-yellow-500";case"poor":return"bg-orange-500";case"bad":return"bg-red-500";default:return"bg-gray-500"}};return se.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6",children:[se.jsxs("div",{className:"text-lg font-semibold",children:[se.jsxs("h2",{className:"text-2xl font-bold text-center mb-4",children:[" Inspection Report ID: #",t.id]}),se.jsx("img",{src:e,alt:`Image ${t.id}`,className:"rounded-lg shadow-md mb-6 max-w-full h-auto",width:"400"})]}),se.jsxs(xd,{className:"w-full max-w-2xl shadow-lg",children:[se.jsx(F2,{className:"bg-rose-500 border-b",children:se.jsx(qS,{className:"text-xl text-white font-bold",children:"Components Status"})}),se.jsx(yE,{className:"p-6",children:se.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(t.components).map(([c,p])=>se.jsxs(xd,{className:"overflow-hidden",children:[se.jsxs("div",{className:"p-4 border-b bg-slate-50 flex justify-between items-center",children:[se.jsx("h3",{className:"font-medium capitalize",children:c}),se.jsx(JC,{className:`${a(p.condition)}`,children:p.condition})]}),se.jsxs("div",{className:"p-4 space-y-2",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{className:"text-sm text-gray-500",children:"Quantity:"}),se.jsx("span",{className:"font-semibold",children:p.quantity})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{className:"text-sm text-gray-500",children:"Description:"}),se.jsx("span",{className:"text-sm mt-1",children:p.description})]})]})]},c))})})]}),se.jsxs("p",{className:"text-sm text-gray-500",children:[se.jsx("strong",{children:"Logged into dataset at:"})," ",new Date(t.time_created).toLocaleString()]})]})}var fT={exports:{}},pT,zP;function Nj(){if(zP)return pT;zP=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return pT=t,pT}var mT,kP;function Bj(){if(kP)return mT;kP=1;var t=Nj();function e(){}function a(){}return a.resetWarningCache=e,mT=function(){function c(M,r,I,k,B,U){if(U!==t){var H=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw H.name="Invariant Violation",H}}c.isRequired=c;function p(){return c}var y={array:c,bigint:c,bool:c,func:c,number:c,object:c,string:c,symbol:c,any:c,arrayOf:p,element:c,elementType:c,instanceOf:p,node:c,objectOf:p,oneOf:p,oneOfType:p,shape:p,exact:p,checkPropTypes:a,resetWarningCache:e};return y.PropTypes=y,y},mT}var FP;function Uj(){return FP||(FP=1,fT.exports=Bj()()),fT.exports}var Vj=Uj();const Ta=Im(Vj);var yd=function(){return yd=Object.assign||function(e){for(var a,c=1,p=arguments.length;c<p;c++){a=arguments[c];for(var y in a)Object.prototype.hasOwnProperty.call(a,y)&&(e[y]=a[y])}return e},yd.apply(this,arguments)};function QO(t,e){var a={};for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&e.indexOf(c)<0&&(a[c]=t[c]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var p=0,c=Object.getOwnPropertySymbols(t);p<c.length;p++)e.indexOf(c[p])<0&&Object.prototype.propertyIsEnumerable.call(t,c[p])&&(a[c[p]]=t[c[p]]);return a}function x_(t,e,a,c){function p(y){return y instanceof a?y:new a(function(M){M(y)})}return new(a||(a=Promise))(function(y,M){function r(B){try{k(c.next(B))}catch(U){M(U)}}function I(B){try{k(c.throw(B))}catch(U){M(U)}}function k(B){B.done?y(B.value):p(B.value).then(r,I)}k((c=c.apply(t,e||[])).next())})}function jj(t,e,a){if(a||arguments.length===2)for(var c=0,p=e.length,y;c<p;c++)(y||!(c in e))&&(y||(y=Array.prototype.slice.call(e,0,c)),y[c]=e[c]);return t.concat(y||Array.prototype.slice.call(e))}const Gj=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function xy(t,e,a){const c=Hj(t),{webkitRelativePath:p}=t,y=typeof e=="string"?e:typeof p=="string"&&p.length>0?p:`./${t.name}`;return typeof c.path!="string"&&NP(c,"path",y),NP(c,"relativePath",y),c}function Hj(t){const{name:e}=t;if(e&&e.lastIndexOf(".")!==-1&&!t.type){const c=e.split(".").pop().toLowerCase(),p=Gj.get(c);p&&Object.defineProperty(t,"type",{value:p,writable:!1,configurable:!1,enumerable:!0})}return t}function NP(t,e,a){Object.defineProperty(t,e,{value:a,writable:!1,configurable:!1,enumerable:!0})}const qj=[".DS_Store","Thumbs.db"];function Wj(t){return x_(this,void 0,void 0,function*(){return WS(t)&&$j(t.dataTransfer)?Kj(t.dataTransfer,t.type):Xj(t)?Zj(t):Array.isArray(t)&&t.every(e=>"getFile"in e&&typeof e.getFile=="function")?Yj(t):[]})}function $j(t){return WS(t)}function Xj(t){return WS(t)&&WS(t.target)}function WS(t){return typeof t=="object"&&t!==null}function Zj(t){return N2(t.target.files).map(e=>xy(e))}function Yj(t){return x_(this,void 0,void 0,function*(){return(yield Promise.all(t.map(a=>a.getFile()))).map(a=>xy(a))})}function Kj(t,e){return x_(this,void 0,void 0,function*(){if(t.items){const a=N2(t.items).filter(p=>p.kind==="file");if(e!=="drop")return a;const c=yield Promise.all(a.map(Jj));return BP(ez(c))}return BP(N2(t.files).map(a=>xy(a)))})}function BP(t){return t.filter(e=>qj.indexOf(e.name)===-1)}function N2(t){if(t===null)return[];const e=[];for(let a=0;a<t.length;a++){const c=t[a];e.push(c)}return e}function Jj(t){if(typeof t.webkitGetAsEntry!="function")return UP(t);const e=t.webkitGetAsEntry();return e&&e.isDirectory?tz(e):UP(t,e)}function ez(t){return t.reduce((e,a)=>[...e,...Array.isArray(a)?ez(a):[a]],[])}function UP(t,e){return x_(this,void 0,void 0,function*(){var a;if(globalThis.isSecureContext&&typeof t.getAsFileSystemHandle=="function"){const y=yield t.getAsFileSystemHandle();if(y===null)throw new Error(`${t} is not a File`);if(y!==void 0){const M=yield y.getFile();return M.handle=y,xy(M)}}const c=t.getAsFile();if(!c)throw new Error(`${t} is not a File`);return xy(c,(a=e==null?void 0:e.fullPath)!==null&&a!==void 0?a:void 0)})}function Qj(t){return x_(this,void 0,void 0,function*(){return t.isDirectory?tz(t):eG(t)})}function tz(t){const e=t.createReader();return new Promise((a,c)=>{const p=[];function y(){e.readEntries(M=>x_(this,void 0,void 0,function*(){if(M.length){const r=Promise.all(M.map(Qj));p.push(r),y()}else try{const r=yield Promise.all(p);a(r)}catch(r){c(r)}}),M=>{c(M)})}y()})}function eG(t){return x_(this,void 0,void 0,function*(){return new Promise((e,a)=>{t.file(c=>{const p=xy(c,t.fullPath);e(p)},c=>{a(c)})})})}var b1={},VP;function tG(){return VP||(VP=1,b1.__esModule=!0,b1.default=function(t,e){if(t&&e){var a=Array.isArray(e)?e:e.split(",");if(a.length===0)return!0;var c=t.name||"",p=(t.type||"").toLowerCase(),y=p.replace(/\/.*$/,"");return a.some(function(M){var r=M.trim().toLowerCase();return r.charAt(0)==="."?c.toLowerCase().endsWith(r):r.endsWith("/*")?y===r.replace(/\/.*$/,""):p===r})}return!0}),b1}var nG=tG();const gT=Im(nG);function jP(t){return aG(t)||rG(t)||iz(t)||iG()}function iG(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rG(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function aG(t){if(Array.isArray(t))return B2(t)}function GP(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);e&&(c=c.filter(function(p){return Object.getOwnPropertyDescriptor(t,p).enumerable})),a.push.apply(a,c)}return a}function HP(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?GP(Object(a),!0).forEach(function(c){nz(t,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):GP(Object(a)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(a,c))})}return t}function nz(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function V0(t,e){return lG(t)||sG(t,e)||iz(t,e)||oG()}function oG(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iz(t,e){if(t){if(typeof t=="string")return B2(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);if(a==="Object"&&t.constructor&&(a=t.constructor.name),a==="Map"||a==="Set")return Array.from(t);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return B2(t,e)}}function B2(t,e){(e==null||e>t.length)&&(e=t.length);for(var a=0,c=new Array(e);a<e;a++)c[a]=t[a];return c}function sG(t,e){var a=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(a!=null){var c=[],p=!0,y=!1,M,r;try{for(a=a.call(t);!(p=(M=a.next()).done)&&(c.push(M.value),!(e&&c.length===e));p=!0);}catch(I){y=!0,r=I}finally{try{!p&&a.return!=null&&a.return()}finally{if(y)throw r}}return c}}function lG(t){if(Array.isArray(t))return t}var cG=typeof gT=="function"?gT:gT.default,uG="file-invalid-type",hG="file-too-large",dG="file-too-small",fG="too-many-files",pG=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=e.split(","),c=a.length>1?"one of ".concat(a.join(", ")):a[0];return{code:uG,message:"File type must be ".concat(c)}},qP=function(e){return{code:hG,message:"File is larger than ".concat(e," ").concat(e===1?"byte":"bytes")}},WP=function(e){return{code:dG,message:"File is smaller than ".concat(e," ").concat(e===1?"byte":"bytes")}},mG={code:fG,message:"Too many files"};function rz(t,e){var a=t.type==="application/x-moz-file"||cG(t,e);return[a,a?null:pG(e)]}function az(t,e,a){if(r_(t.size))if(r_(e)&&r_(a)){if(t.size>a)return[!1,qP(a)];if(t.size<e)return[!1,WP(e)]}else{if(r_(e)&&t.size<e)return[!1,WP(e)];if(r_(a)&&t.size>a)return[!1,qP(a)]}return[!0,null]}function r_(t){return t!=null}function gG(t){var e=t.files,a=t.accept,c=t.minSize,p=t.maxSize,y=t.multiple,M=t.maxFiles,r=t.validator;return!y&&e.length>1||y&&M>=1&&e.length>M?!1:e.every(function(I){var k=rz(I,a),B=V0(k,1),U=B[0],H=az(I,c,p),Y=V0(H,1),X=Y[0],Q=r?r(I):null;return U&&X&&!Q})}function $S(t){return typeof t.isPropagationStopped=="function"?t.isPropagationStopped():typeof t.cancelBubble<"u"?t.cancelBubble:!1}function w1(t){return t.dataTransfer?Array.prototype.some.call(t.dataTransfer.types,function(e){return e==="Files"||e==="application/x-moz-file"}):!!t.target&&!!t.target.files}function $P(t){t.preventDefault()}function _G(t){return t.indexOf("MSIE")!==-1||t.indexOf("Trident/")!==-1}function vG(t){return t.indexOf("Edge/")!==-1}function yG(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return _G(t)||vG(t)}function cd(){for(var t=arguments.length,e=new Array(t),a=0;a<t;a++)e[a]=arguments[a];return function(c){for(var p=arguments.length,y=new Array(p>1?p-1:0),M=1;M<p;M++)y[M-1]=arguments[M];return e.some(function(r){return!$S(c)&&r&&r.apply(void 0,[c].concat(y)),$S(c)})}}function xG(){return"showOpenFilePicker"in window}function bG(t){if(r_(t)){var e=Object.entries(t).filter(function(a){var c=V0(a,2),p=c[0],y=c[1],M=!0;return oz(p)||(console.warn('Skipped "'.concat(p,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),M=!1),(!Array.isArray(y)||!y.every(sz))&&(console.warn('Skipped "'.concat(p,'" because an invalid file extension was provided.')),M=!1),M}).reduce(function(a,c){var p=V0(c,2),y=p[0],M=p[1];return HP(HP({},a),{},nz({},y,M))},{});return[{description:"Files",accept:e}]}return t}function wG(t){if(r_(t))return Object.entries(t).reduce(function(e,a){var c=V0(a,2),p=c[0],y=c[1];return[].concat(jP(e),[p],jP(y))},[]).filter(function(e){return oz(e)||sz(e)}).join(",")}function SG(t){return t instanceof DOMException&&(t.name==="AbortError"||t.code===t.ABORT_ERR)}function EG(t){return t instanceof DOMException&&(t.name==="SecurityError"||t.code===t.SECURITY_ERR)}function oz(t){return t==="audio/*"||t==="video/*"||t==="image/*"||t==="text/*"||t==="application/*"||/\w+\/[-+.\w]+/g.test(t)}function sz(t){return/^.*\.[\w]+$/.test(t)}var MG=["children"],TG=["open"],AG=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],CG=["refKey","onChange","onClick"];function RG(t){return PG(t)||DG(t)||lz(t)||IG()}function IG(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DG(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function PG(t){if(Array.isArray(t))return U2(t)}function _T(t,e){return zG(t)||OG(t,e)||lz(t,e)||LG()}function LG(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lz(t,e){if(t){if(typeof t=="string")return U2(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);if(a==="Object"&&t.constructor&&(a=t.constructor.name),a==="Map"||a==="Set")return Array.from(t);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return U2(t,e)}}function U2(t,e){(e==null||e>t.length)&&(e=t.length);for(var a=0,c=new Array(e);a<e;a++)c[a]=t[a];return c}function OG(t,e){var a=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(a!=null){var c=[],p=!0,y=!1,M,r;try{for(a=a.call(t);!(p=(M=a.next()).done)&&(c.push(M.value),!(e&&c.length===e));p=!0);}catch(I){y=!0,r=I}finally{try{!p&&a.return!=null&&a.return()}finally{if(y)throw r}}return c}}function zG(t){if(Array.isArray(t))return t}function XP(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);e&&(c=c.filter(function(p){return Object.getOwnPropertyDescriptor(t,p).enumerable})),a.push.apply(a,c)}return a}function io(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?XP(Object(a),!0).forEach(function(c){V2(t,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):XP(Object(a)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(a,c))})}return t}function V2(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function XS(t,e){if(t==null)return{};var a=kG(t,e),c,p;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(t);for(p=0;p<y.length;p++)c=y[p],!(e.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(a[c]=t[c])}return a}function kG(t,e){if(t==null)return{};var a={},c=Object.keys(t),p,y;for(y=0;y<c.length;y++)p=c[y],!(e.indexOf(p)>=0)&&(a[p]=t[p]);return a}var QC=le.forwardRef(function(t,e){var a=t.children,c=XS(t,MG),p=uz(c),y=p.open,M=XS(p,TG);return le.useImperativeHandle(e,function(){return{open:y}},[y]),Go.createElement(le.Fragment,null,a(io(io({},M),{},{open:y})))});QC.displayName="Dropzone";var cz={disabled:!1,getFilesFromEvent:Wj,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};QC.defaultProps=cz;QC.propTypes={children:Ta.func,accept:Ta.objectOf(Ta.arrayOf(Ta.string)),multiple:Ta.bool,preventDropOnDocument:Ta.bool,noClick:Ta.bool,noKeyboard:Ta.bool,noDrag:Ta.bool,noDragEventsBubbling:Ta.bool,minSize:Ta.number,maxSize:Ta.number,maxFiles:Ta.number,disabled:Ta.bool,getFilesFromEvent:Ta.func,onFileDialogCancel:Ta.func,onFileDialogOpen:Ta.func,useFsAccessApi:Ta.bool,autoFocus:Ta.bool,onDragEnter:Ta.func,onDragLeave:Ta.func,onDragOver:Ta.func,onDrop:Ta.func,onDropAccepted:Ta.func,onDropRejected:Ta.func,onError:Ta.func,validator:Ta.func};var j2={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function uz(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=io(io({},cz),t),a=e.accept,c=e.disabled,p=e.getFilesFromEvent,y=e.maxSize,M=e.minSize,r=e.multiple,I=e.maxFiles,k=e.onDragEnter,B=e.onDragLeave,U=e.onDragOver,H=e.onDrop,Y=e.onDropAccepted,X=e.onDropRejected,Q=e.onFileDialogCancel,J=e.onFileDialogOpen,j=e.useFsAccessApi,oe=e.autoFocus,ce=e.preventDropOnDocument,pe=e.noClick,Ae=e.noKeyboard,Ee=e.noDrag,be=e.noDragEventsBubbling,Ve=e.onError,Se=e.validator,xe=le.useMemo(function(){return wG(a)},[a]),Fe=le.useMemo(function(){return bG(a)},[a]),Ct=le.useMemo(function(){return typeof J=="function"?J:ZP},[J]),Et=le.useMemo(function(){return typeof Q=="function"?Q:ZP},[Q]),Tt=le.useRef(null),_t=le.useRef(null),et=le.useReducer(FG,j2),Lt=_T(et,2),lt=Lt[0],ut=Lt[1],Xe=lt.isFocused,kt=lt.isFileDialogActive,_n=le.useRef(typeof window<"u"&&window.isSecureContext&&j&&xG()),Xt=function(){!_n.current&&kt&&setTimeout(function(){if(_t.current){var Kt=_t.current.files;Kt.length||(ut({type:"closeDialog"}),Et())}},300)};le.useEffect(function(){return window.addEventListener("focus",Xt,!1),function(){window.removeEventListener("focus",Xt,!1)}},[_t,kt,Et,_n]);var It=le.useRef([]),ln=function(Kt){Tt.current&&Tt.current.contains(Kt.target)||(Kt.preventDefault(),It.current=[])};le.useEffect(function(){return ce&&(document.addEventListener("dragover",$P,!1),document.addEventListener("drop",ln,!1)),function(){ce&&(document.removeEventListener("dragover",$P),document.removeEventListener("drop",ln))}},[Tt,ce]),le.useEffect(function(){return!c&&oe&&Tt.current&&Tt.current.focus(),function(){}},[Tt,oe,c]);var fn=le.useCallback(function(gt){Ve?Ve(gt):console.error(gt)},[Ve]),$t=le.useCallback(function(gt){gt.preventDefault(),gt.persist(),ei(gt),It.current=[].concat(RG(It.current),[gt.target]),w1(gt)&&Promise.resolve(p(gt)).then(function(Kt){if(!($S(gt)&&!be)){var an=Kt.length,Xn=an>0&&gG({files:Kt,accept:xe,minSize:M,maxSize:y,multiple:r,maxFiles:I,validator:Se}),On=an>0&&!Xn;ut({isDragAccept:Xn,isDragReject:On,isDragActive:!0,type:"setDraggedFiles"}),k&&k(gt)}}).catch(function(Kt){return fn(Kt)})},[p,k,fn,be,xe,M,y,r,I,Se]),pn=le.useCallback(function(gt){gt.preventDefault(),gt.persist(),ei(gt);var Kt=w1(gt);if(Kt&&gt.dataTransfer)try{gt.dataTransfer.dropEffect="copy"}catch{}return Kt&&U&&U(gt),!1},[U,be]),jn=le.useCallback(function(gt){gt.preventDefault(),gt.persist(),ei(gt);var Kt=It.current.filter(function(Xn){return Tt.current&&Tt.current.contains(Xn)}),an=Kt.indexOf(gt.target);an!==-1&&Kt.splice(an,1),It.current=Kt,!(Kt.length>0)&&(ut({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),w1(gt)&&B&&B(gt))},[Tt,B,be]),Pe=le.useCallback(function(gt,Kt){var an=[],Xn=[];gt.forEach(function(On){var Jn=rz(On,xe),Ni=_T(Jn,2),Un=Ni[0],si=Ni[1],ci=az(On,M,y),_i=_T(ci,2),ui=_i[0],Ai=_i[1],Si=Se?Se(On):null;if(Un&&ui&&!Si)an.push(On);else{var Wn=[si,Ai];Si&&(Wn=Wn.concat(Si)),Xn.push({file:On,errors:Wn.filter(function(Ot){return Ot})})}}),(!r&&an.length>1||r&&I>=1&&an.length>I)&&(an.forEach(function(On){Xn.push({file:On,errors:[mG]})}),an.splice(0)),ut({acceptedFiles:an,fileRejections:Xn,isDragReject:Xn.length>0,type:"setFiles"}),H&&H(an,Xn,Kt),Xn.length>0&&X&&X(Xn,Kt),an.length>0&&Y&&Y(an,Kt)},[ut,r,xe,M,y,I,H,Y,X,Se]),Gn=le.useCallback(function(gt){gt.preventDefault(),gt.persist(),ei(gt),It.current=[],w1(gt)&&Promise.resolve(p(gt)).then(function(Kt){$S(gt)&&!be||Pe(Kt,gt)}).catch(function(Kt){return fn(Kt)}),ut({type:"reset"})},[p,Pe,fn,be]),vn=le.useCallback(function(){if(_n.current){ut({type:"openDialog"}),Ct();var gt={multiple:r,types:Fe};window.showOpenFilePicker(gt).then(function(Kt){return p(Kt)}).then(function(Kt){Pe(Kt,null),ut({type:"closeDialog"})}).catch(function(Kt){SG(Kt)?(Et(Kt),ut({type:"closeDialog"})):EG(Kt)?(_n.current=!1,_t.current?(_t.current.value=null,_t.current.click()):fn(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):fn(Kt)});return}_t.current&&(ut({type:"openDialog"}),Ct(),_t.current.value=null,_t.current.click())},[ut,Ct,Et,j,Pe,fn,Fe,r]),qn=le.useCallback(function(gt){!Tt.current||!Tt.current.isEqualNode(gt.target)||(gt.key===" "||gt.key==="Enter"||gt.keyCode===32||gt.keyCode===13)&&(gt.preventDefault(),vn())},[Tt,vn]),ke=le.useCallback(function(){ut({type:"focus"})},[]),Fi=le.useCallback(function(){ut({type:"blur"})},[]),di=le.useCallback(function(){pe||(yG()?setTimeout(vn,0):vn())},[pe,vn]),bi=function(Kt){return c?null:Kt},Mn=function(Kt){return Ae?null:bi(Kt)},wi=function(Kt){return Ee?null:bi(Kt)},ei=function(Kt){be&&Kt.stopPropagation()},ot=le.useMemo(function(){return function(){var gt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Kt=gt.refKey,an=Kt===void 0?"ref":Kt,Xn=gt.role,On=gt.onKeyDown,Jn=gt.onFocus,Ni=gt.onBlur,Un=gt.onClick,si=gt.onDragEnter,ci=gt.onDragOver,_i=gt.onDragLeave,ui=gt.onDrop,Ai=XS(gt,AG);return io(io(V2({onKeyDown:Mn(cd(On,qn)),onFocus:Mn(cd(Jn,ke)),onBlur:Mn(cd(Ni,Fi)),onClick:bi(cd(Un,di)),onDragEnter:wi(cd(si,$t)),onDragOver:wi(cd(ci,pn)),onDragLeave:wi(cd(_i,jn)),onDrop:wi(cd(ui,Gn)),role:typeof Xn=="string"&&Xn!==""?Xn:"presentation"},an,Tt),!c&&!Ae?{tabIndex:0}:{}),Ai)}},[Tt,qn,ke,Fi,di,$t,pn,jn,Gn,Ae,Ee,c]),Ue=le.useCallback(function(gt){gt.stopPropagation()},[]),Yt=le.useMemo(function(){return function(){var gt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Kt=gt.refKey,an=Kt===void 0?"ref":Kt,Xn=gt.onChange,On=gt.onClick,Jn=XS(gt,CG),Ni=V2({accept:xe,multiple:r,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:bi(cd(Xn,Gn)),onClick:bi(cd(On,Ue)),tabIndex:-1},an,_t);return io(io({},Ni),Jn)}},[_t,a,r,Gn,c]);return io(io({},lt),{},{isFocused:Xe&&!c,getRootProps:ot,getInputProps:Yt,rootRef:Tt,inputRef:_t,open:bi(vn)})}function FG(t,e){switch(e.type){case"focus":return io(io({},t),{},{isFocused:!0});case"blur":return io(io({},t),{},{isFocused:!1});case"openDialog":return io(io({},j2),{},{isFileDialogActive:!0});case"closeDialog":return io(io({},t),{},{isFileDialogActive:!1});case"setDraggedFiles":return io(io({},t),{},{isDragActive:e.isDragActive,isDragAccept:e.isDragAccept,isDragReject:e.isDragReject});case"setFiles":return io(io({},t),{},{acceptedFiles:e.acceptedFiles,fileRejections:e.fileRejections,isDragReject:e.isDragReject});case"reset":return io({},j2);default:return t}}function ZP(){}function NG({setImageId:t,setStatus:e}){const a=le.useRef(null),[c,p]=le.useState([]),[y,M]=le.useState(""),[r,I]=le.useState(!1),k=async()=>{if(c.length===0&&!r){M("Please select at least one file first!");return}console.log("Upload Clicked"),e("processing"),t(96)},{getRootProps:B,getInputProps:U,open:H,acceptedFiles:Y}=uz({onDrop:(J,j)=>{if(p(J),j.length>0&&M(`Some files were rejected: ${j.map(oe=>oe.file.name).join(", ")}`),a.current){const oe=new DataTransfer;J.forEach(ce=>{oe.items.add(ce)}),a.current.files=oe.files}},multiple:!0,maxFiles:20,accept:{"image/*":[".png",".jpeg",".jpg"]}}),X=J=>{console.log("Being clicked"),J.stopPropagation(),I(!0)},Q=Y.map(J=>se.jsxs("li",{className:"text-sm text-gray-700",children:["📄 ",J.name," - ",(J.size/1024).toFixed(2)," KB"]},J.name));return se.jsxs("div",{className:"container",children:[se.jsxs("div",{...B(),className:"border-2 border-dashed border-blue-500 rounded-lg p-6 text-center cursor-pointer hover:bg-blue-50",onClick:X,children:[se.jsx(Z5,{className:"w-12 h-12 mb-4 mx-auto text-gray-600"}),se.jsx("input",{...U(),ref:a}),se.jsxs("p",{className:"text-gray-600",children:["Drag & drop some files here or"," ",se.jsx("span",{className:"text-blue-500 underline",children:"click to select"}),"."]})]}),(r||Q.length>0)&&se.jsxs("aside",{className:"mt-4",children:[se.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Files Selected"}),se.jsx("ul",{className:"list-disc pl-5 mt-1",children:"Pole 96"})]}),se.jsxs("div",{className:"mt-4",children:[se.jsx(fh,{onClick:k,className:"mr-2 bg-rose-500 text-white",children:"Upload Files"}),y&&se.jsx("p",{className:"mt-2",children:y})]})]})}function BG(){const[t,e]=le.useState(null),[a,c]=le.useState(null),[p,y]=le.useState(null),[M,r]=le.useState("upload"),I={upload:"./uploadingImages/SelectFiles.png",processing:"./uploadingImages/Processing.png",result:"./uploadingImages/Results.png"};return se.jsxs("div",{className:"min-h-screen bg-zinc-300 flex flex-col w-full ",children:[se.jsx(gE,{}),se.jsxs("main",{className:" flex flex-col items-center  w-full px-4 py-8",children:[se.jsx("img",{src:I[M],alt:"Status",className:"w-150 mb-19"}),se.jsxs("div",{className:"bg-blue-50 border border-blue-200 text-blue-700 rounded-md p-4 mb-6 w-full relative",children:[se.jsx("span",{children:"To save on hosting costs, a previous AI result will be replicated regardless of the image uploaded."}),se.jsx("button",{onClick:k=>{var B;return(B=k.currentTarget.parentElement)==null?void 0:B.remove()},className:"absolute top-2 right-2 text-blue-500 hover:text-blue-700","aria-label":"Close",children:"✕"})]}),se.jsxs(xd,{className:"bg-zinc-50 border-blue-500 border-l-5",style:{width:"600px",maxWidth:"100%",padding:M==="result"?"1rem":"2rem"},children:[M==="upload"&&se.jsxs(se.Fragment,{children:[" ",se.jsx(NG,{setImageId:e,setStatus:r})]}),M==="processing"&&se.jsx(zj,{imageId:t,setStatus:r,setImageDetails:c,setImageSrc:y}),M==="result"&&se.jsx(Fj,{imageDetails:a,imageSrc:p})]})]})]})}/**
   * table-core
   *
   * Copyright (c) TanStack
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE.md file in the root directory of this source tree.
   *
   * @license MIT
   */function vm(t,e){return typeof t=="function"?t(e):t}function gc(t,e){return a=>{e.setState(c=>({...c,[t]:vm(a,c[t])}))}}function xE(t){return t instanceof Function}function UG(t){return Array.isArray(t)&&t.every(e=>typeof e=="number")}function VG(t,e){const a=[],c=p=>{p.forEach(y=>{a.push(y);const M=e(y);M!=null&&M.length&&c(M)})};return c(t),a}function rr(t,e,a){let c=[],p;return y=>{let M;a.key&&a.debug&&(M=Date.now());const r=t(y);if(!(r.length!==c.length||r.some((B,U)=>c[U]!==B)))return p;c=r;let k;if(a.key&&a.debug&&(k=Date.now()),p=e(...r),a==null||a.onChange==null||a.onChange(p),a.key&&a.debug&&a!=null&&a.debug()){const B=Math.round((Date.now()-M)*100)/100,U=Math.round((Date.now()-k)*100)/100,H=U/16,Y=(X,Q)=>{for(X=String(X);X.length<Q;)X=" "+X;return X};console.info(`%c⏱ ${Y(U,5)} /${Y(B,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*H,120))}deg 100% 31%);`,a==null?void 0:a.key)}return p}}function ar(t,e,a,c){return{debug:()=>{var p;return(p=t==null?void 0:t.debugAll)!=null?p:t[e]},key:!1,onChange:c}}function jG(t,e,a,c){const p=()=>{var M;return(M=y.getValue())!=null?M:t.options.renderFallbackValue},y={id:`${e.id}_${a.id}`,row:e,column:a,getValue:()=>e.getValue(c),renderValue:p,getContext:rr(()=>[t,a,e,y],(M,r,I,k)=>({table:M,column:r,row:I,cell:k,getValue:k.getValue,renderValue:k.renderValue}),ar(t.options,"debugCells"))};return t._features.forEach(M=>{M.createCell==null||M.createCell(y,a,e,t)},{}),y}function GG(t,e,a,c){var p,y;const r={...t._getDefaultColumnDef(),...e},I=r.accessorKey;let k=(p=(y=r.id)!=null?y:I?typeof String.prototype.replaceAll=="function"?I.replaceAll(".","_"):I.replace(/\./g,"_"):void 0)!=null?p:typeof r.header=="string"?r.header:void 0,B;if(r.accessorFn?B=r.accessorFn:I&&(I.includes(".")?B=H=>{let Y=H;for(const Q of I.split(".")){var X;Y=(X=Y)==null?void 0:X[Q]}return Y}:B=H=>H[r.accessorKey]),!k)throw new Error;let U={id:`${String(k)}`,accessorFn:B,parent:c,depth:a,columnDef:r,columns:[],getFlatColumns:rr(()=>[!0],()=>{var H;return[U,...(H=U.columns)==null?void 0:H.flatMap(Y=>Y.getFlatColumns())]},ar(t.options,"debugColumns")),getLeafColumns:rr(()=>[t._getOrderColumnsFn()],H=>{var Y;if((Y=U.columns)!=null&&Y.length){let X=U.columns.flatMap(Q=>Q.getLeafColumns());return H(X)}return[U]},ar(t.options,"debugColumns"))};for(const H of t._features)H.createColumn==null||H.createColumn(U,t);return U}const Vs="debugHeaders";function YP(t,e,a){var c;let y={id:(c=a.id)!=null?c:e.id,column:e,index:a.index,isPlaceholder:!!a.isPlaceholder,placeholderId:a.placeholderId,depth:a.depth,subHeaders:[],colSpan:0,rowSpan:0,headerGroup:null,getLeafHeaders:()=>{const M=[],r=I=>{I.subHeaders&&I.subHeaders.length&&I.subHeaders.map(r),M.push(I)};return r(y),M},getContext:()=>({table:t,header:y,column:e})};return t._features.forEach(M=>{M.createHeader==null||M.createHeader(y,t)}),y}const HG={createTable:t=>{t.getHeaderGroups=rr(()=>[t.getAllColumns(),t.getVisibleLeafColumns(),t.getState().columnPinning.left,t.getState().columnPinning.right],(e,a,c,p)=>{var y,M;const r=(y=c==null?void 0:c.map(U=>a.find(H=>H.id===U)).filter(Boolean))!=null?y:[],I=(M=p==null?void 0:p.map(U=>a.find(H=>H.id===U)).filter(Boolean))!=null?M:[],k=a.filter(U=>!(c!=null&&c.includes(U.id))&&!(p!=null&&p.includes(U.id)));return S1(e,[...r,...k,...I],t)},ar(t.options,Vs)),t.getCenterHeaderGroups=rr(()=>[t.getAllColumns(),t.getVisibleLeafColumns(),t.getState().columnPinning.left,t.getState().columnPinning.right],(e,a,c,p)=>(a=a.filter(y=>!(c!=null&&c.includes(y.id))&&!(p!=null&&p.includes(y.id))),S1(e,a,t,"center")),ar(t.options,Vs)),t.getLeftHeaderGroups=rr(()=>[t.getAllColumns(),t.getVisibleLeafColumns(),t.getState().columnPinning.left],(e,a,c)=>{var p;const y=(p=c==null?void 0:c.map(M=>a.find(r=>r.id===M)).filter(Boolean))!=null?p:[];return S1(e,y,t,"left")},ar(t.options,Vs)),t.getRightHeaderGroups=rr(()=>[t.getAllColumns(),t.getVisibleLeafColumns(),t.getState().columnPinning.right],(e,a,c)=>{var p;const y=(p=c==null?void 0:c.map(M=>a.find(r=>r.id===M)).filter(Boolean))!=null?p:[];return S1(e,y,t,"right")},ar(t.options,Vs)),t.getFooterGroups=rr(()=>[t.getHeaderGroups()],e=>[...e].reverse(),ar(t.options,Vs)),t.getLeftFooterGroups=rr(()=>[t.getLeftHeaderGroups()],e=>[...e].reverse(),ar(t.options,Vs)),t.getCenterFooterGroups=rr(()=>[t.getCenterHeaderGroups()],e=>[...e].reverse(),ar(t.options,Vs)),t.getRightFooterGroups=rr(()=>[t.getRightHeaderGroups()],e=>[...e].reverse(),ar(t.options,Vs)),t.getFlatHeaders=rr(()=>[t.getHeaderGroups()],e=>e.map(a=>a.headers).flat(),ar(t.options,Vs)),t.getLeftFlatHeaders=rr(()=>[t.getLeftHeaderGroups()],e=>e.map(a=>a.headers).flat(),ar(t.options,Vs)),t.getCenterFlatHeaders=rr(()=>[t.getCenterHeaderGroups()],e=>e.map(a=>a.headers).flat(),ar(t.options,Vs)),t.getRightFlatHeaders=rr(()=>[t.getRightHeaderGroups()],e=>e.map(a=>a.headers).flat(),ar(t.options,Vs)),t.getCenterLeafHeaders=rr(()=>[t.getCenterFlatHeaders()],e=>e.filter(a=>{var c;return!((c=a.subHeaders)!=null&&c.length)}),ar(t.options,Vs)),t.getLeftLeafHeaders=rr(()=>[t.getLeftFlatHeaders()],e=>e.filter(a=>{var c;return!((c=a.subHeaders)!=null&&c.length)}),ar(t.options,Vs)),t.getRightLeafHeaders=rr(()=>[t.getRightFlatHeaders()],e=>e.filter(a=>{var c;return!((c=a.subHeaders)!=null&&c.length)}),ar(t.options,Vs)),t.getLeafHeaders=rr(()=>[t.getLeftHeaderGroups(),t.getCenterHeaderGroups(),t.getRightHeaderGroups()],(e,a,c)=>{var p,y,M,r,I,k;return[...(p=(y=e[0])==null?void 0:y.headers)!=null?p:[],...(M=(r=a[0])==null?void 0:r.headers)!=null?M:[],...(I=(k=c[0])==null?void 0:k.headers)!=null?I:[]].map(B=>B.getLeafHeaders()).flat()},ar(t.options,Vs))}};function S1(t,e,a,c){var p,y;let M=0;const r=function(H,Y){Y===void 0&&(Y=1),M=Math.max(M,Y),H.filter(X=>X.getIsVisible()).forEach(X=>{var Q;(Q=X.columns)!=null&&Q.length&&r(X.columns,Y+1)},0)};r(t);let I=[];const k=(H,Y)=>{const X={depth:Y,id:[c,`${Y}`].filter(Boolean).join("_"),headers:[]},Q=[];H.forEach(J=>{const j=[...Q].reverse()[0],oe=J.column.depth===X.depth;let ce,pe=!1;if(oe&&J.column.parent?ce=J.column.parent:(ce=J.column,pe=!0),j&&(j==null?void 0:j.column)===ce)j.subHeaders.push(J);else{const Ae=YP(a,ce,{id:[c,Y,ce.id,J==null?void 0:J.id].filter(Boolean).join("_"),isPlaceholder:pe,placeholderId:pe?`${Q.filter(Ee=>Ee.column===ce).length}`:void 0,depth:Y,index:Q.length});Ae.subHeaders.push(J),Q.push(Ae)}X.headers.push(J),J.headerGroup=X}),I.push(X),Y>0&&k(Q,Y-1)},B=e.map((H,Y)=>YP(a,H,{depth:M,index:Y}));k(B,M-1),I.reverse();const U=H=>H.filter(X=>X.column.getIsVisible()).map(X=>{let Q=0,J=0,j=[0];X.subHeaders&&X.subHeaders.length?(j=[],U(X.subHeaders).forEach(ce=>{let{colSpan:pe,rowSpan:Ae}=ce;Q+=pe,j.push(Ae)})):Q=1;const oe=Math.min(...j);return J=J+oe,X.colSpan=Q,X.rowSpan=J,{colSpan:Q,rowSpan:J}});return U((p=(y=I[0])==null?void 0:y.headers)!=null?p:[]),I}const qG=(t,e,a,c,p,y,M)=>{let r={id:e,index:c,original:a,depth:p,parentId:M,_valuesCache:{},_uniqueValuesCache:{},getValue:I=>{if(r._valuesCache.hasOwnProperty(I))return r._valuesCache[I];const k=t.getColumn(I);if(k!=null&&k.accessorFn)return r._valuesCache[I]=k.accessorFn(r.original,c),r._valuesCache[I]},getUniqueValues:I=>{if(r._uniqueValuesCache.hasOwnProperty(I))return r._uniqueValuesCache[I];const k=t.getColumn(I);if(k!=null&&k.accessorFn)return k.columnDef.getUniqueValues?(r._uniqueValuesCache[I]=k.columnDef.getUniqueValues(r.original,c),r._uniqueValuesCache[I]):(r._uniqueValuesCache[I]=[r.getValue(I)],r._uniqueValuesCache[I])},renderValue:I=>{var k;return(k=r.getValue(I))!=null?k:t.options.renderFallbackValue},subRows:[],getLeafRows:()=>VG(r.subRows,I=>I.subRows),getParentRow:()=>r.parentId?t.getRow(r.parentId,!0):void 0,getParentRows:()=>{let I=[],k=r;for(;;){const B=k.getParentRow();if(!B)break;I.push(B),k=B}return I.reverse()},getAllCells:rr(()=>[t.getAllLeafColumns()],I=>I.map(k=>jG(t,r,k,k.id)),ar(t.options,"debugRows")),_getAllCellsByColumnId:rr(()=>[r.getAllCells()],I=>I.reduce((k,B)=>(k[B.column.id]=B,k),{}),ar(t.options,"debugRows"))};for(let I=0;I<t._features.length;I++){const k=t._features[I];k==null||k.createRow==null||k.createRow(r,t)}return r},WG={createColumn:(t,e)=>{t._getFacetedRowModel=e.options.getFacetedRowModel&&e.options.getFacetedRowModel(e,t.id),t.getFacetedRowModel=()=>t._getFacetedRowModel?t._getFacetedRowModel():e.getPreFilteredRowModel(),t._getFacetedUniqueValues=e.options.getFacetedUniqueValues&&e.options.getFacetedUniqueValues(e,t.id),t.getFacetedUniqueValues=()=>t._getFacetedUniqueValues?t._getFacetedUniqueValues():new Map,t._getFacetedMinMaxValues=e.options.getFacetedMinMaxValues&&e.options.getFacetedMinMaxValues(e,t.id),t.getFacetedMinMaxValues=()=>{if(t._getFacetedMinMaxValues)return t._getFacetedMinMaxValues()}}},hz=(t,e,a)=>{var c,p;const y=a==null||(c=a.toString())==null?void 0:c.toLowerCase();return!!(!((p=t.getValue(e))==null||(p=p.toString())==null||(p=p.toLowerCase())==null)&&p.includes(y))};hz.autoRemove=t=>ch(t);const dz=(t,e,a)=>{var c;return!!(!((c=t.getValue(e))==null||(c=c.toString())==null)&&c.includes(a))};dz.autoRemove=t=>ch(t);const fz=(t,e,a)=>{var c;return((c=t.getValue(e))==null||(c=c.toString())==null?void 0:c.toLowerCase())===(a==null?void 0:a.toLowerCase())};fz.autoRemove=t=>ch(t);const pz=(t,e,a)=>{var c;return(c=t.getValue(e))==null?void 0:c.includes(a)};pz.autoRemove=t=>ch(t);const mz=(t,e,a)=>!a.some(c=>{var p;return!((p=t.getValue(e))!=null&&p.includes(c))});mz.autoRemove=t=>ch(t)||!(t!=null&&t.length);const gz=(t,e,a)=>a.some(c=>{var p;return(p=t.getValue(e))==null?void 0:p.includes(c)});gz.autoRemove=t=>ch(t)||!(t!=null&&t.length);const _z=(t,e,a)=>t.getValue(e)===a;_z.autoRemove=t=>ch(t);const vz=(t,e,a)=>t.getValue(e)==a;vz.autoRemove=t=>ch(t);const eR=(t,e,a)=>{let[c,p]=a;const y=t.getValue(e);return y>=c&&y<=p};eR.resolveFilterValue=t=>{let[e,a]=t,c=typeof e!="number"?parseFloat(e):e,p=typeof a!="number"?parseFloat(a):a,y=e===null||Number.isNaN(c)?-1/0:c,M=a===null||Number.isNaN(p)?1/0:p;if(y>M){const r=y;y=M,M=r}return[y,M]};eR.autoRemove=t=>ch(t)||ch(t[0])&&ch(t[1]);const jf={includesString:hz,includesStringSensitive:dz,equalsString:fz,arrIncludes:pz,arrIncludesAll:mz,arrIncludesSome:gz,equals:_z,weakEquals:vz,inNumberRange:eR};function ch(t){return t==null||t===""}const $G={getDefaultColumnDef:()=>({filterFn:"auto"}),getInitialState:t=>({columnFilters:[],...t}),getDefaultOptions:t=>({onColumnFiltersChange:gc("columnFilters",t),filterFromLeafRows:!1,maxLeafRowFilterDepth:100}),createColumn:(t,e)=>{t.getAutoFilterFn=()=>{const a=e.getCoreRowModel().flatRows[0],c=a==null?void 0:a.getValue(t.id);return typeof c=="string"?jf.includesString:typeof c=="number"?jf.inNumberRange:typeof c=="boolean"||c!==null&&typeof c=="object"?jf.equals:Array.isArray(c)?jf.arrIncludes:jf.weakEquals},t.getFilterFn=()=>{var a,c;return xE(t.columnDef.filterFn)?t.columnDef.filterFn:t.columnDef.filterFn==="auto"?t.getAutoFilterFn():(a=(c=e.options.filterFns)==null?void 0:c[t.columnDef.filterFn])!=null?a:jf[t.columnDef.filterFn]},t.getCanFilter=()=>{var a,c,p;return((a=t.columnDef.enableColumnFilter)!=null?a:!0)&&((c=e.options.enableColumnFilters)!=null?c:!0)&&((p=e.options.enableFilters)!=null?p:!0)&&!!t.accessorFn},t.getIsFiltered=()=>t.getFilterIndex()>-1,t.getFilterValue=()=>{var a;return(a=e.getState().columnFilters)==null||(a=a.find(c=>c.id===t.id))==null?void 0:a.value},t.getFilterIndex=()=>{var a,c;return(a=(c=e.getState().columnFilters)==null?void 0:c.findIndex(p=>p.id===t.id))!=null?a:-1},t.setFilterValue=a=>{e.setColumnFilters(c=>{const p=t.getFilterFn(),y=c==null?void 0:c.find(B=>B.id===t.id),M=vm(a,y?y.value:void 0);if(KP(p,M,t)){var r;return(r=c==null?void 0:c.filter(B=>B.id!==t.id))!=null?r:[]}const I={id:t.id,value:M};if(y){var k;return(k=c==null?void 0:c.map(B=>B.id===t.id?I:B))!=null?k:[]}return c!=null&&c.length?[...c,I]:[I]})}},createRow:(t,e)=>{t.columnFilters={},t.columnFiltersMeta={}},createTable:t=>{t.setColumnFilters=e=>{const a=t.getAllLeafColumns(),c=p=>{var y;return(y=vm(e,p))==null?void 0:y.filter(M=>{const r=a.find(I=>I.id===M.id);if(r){const I=r.getFilterFn();if(KP(I,M.value,r))return!1}return!0})};t.options.onColumnFiltersChange==null||t.options.onColumnFiltersChange(c)},t.resetColumnFilters=e=>{var a,c;t.setColumnFilters(e?[]:(a=(c=t.initialState)==null?void 0:c.columnFilters)!=null?a:[])},t.getPreFilteredRowModel=()=>t.getCoreRowModel(),t.getFilteredRowModel=()=>(!t._getFilteredRowModel&&t.options.getFilteredRowModel&&(t._getFilteredRowModel=t.options.getFilteredRowModel(t)),t.options.manualFiltering||!t._getFilteredRowModel?t.getPreFilteredRowModel():t._getFilteredRowModel())}};function KP(t,e,a){return(t&&t.autoRemove?t.autoRemove(e,a):!1)||typeof e>"u"||typeof e=="string"&&!e}const XG=(t,e,a)=>a.reduce((c,p)=>{const y=p.getValue(t);return c+(typeof y=="number"?y:0)},0),ZG=(t,e,a)=>{let c;return a.forEach(p=>{const y=p.getValue(t);y!=null&&(c>y||c===void 0&&y>=y)&&(c=y)}),c},YG=(t,e,a)=>{let c;return a.forEach(p=>{const y=p.getValue(t);y!=null&&(c<y||c===void 0&&y>=y)&&(c=y)}),c},KG=(t,e,a)=>{let c,p;return a.forEach(y=>{const M=y.getValue(t);M!=null&&(c===void 0?M>=M&&(c=p=M):(c>M&&(c=M),p<M&&(p=M)))}),[c,p]},JG=(t,e)=>{let a=0,c=0;if(e.forEach(p=>{let y=p.getValue(t);y!=null&&(y=+y)>=y&&(++a,c+=y)}),a)return c/a},QG=(t,e)=>{if(!e.length)return;const a=e.map(y=>y.getValue(t));if(!UG(a))return;if(a.length===1)return a[0];const c=Math.floor(a.length/2),p=a.sort((y,M)=>y-M);return a.length%2!==0?p[c]:(p[c-1]+p[c])/2},eH=(t,e)=>Array.from(new Set(e.map(a=>a.getValue(t))).values()),tH=(t,e)=>new Set(e.map(a=>a.getValue(t))).size,nH=(t,e)=>e.length,vT={sum:XG,min:ZG,max:YG,extent:KG,mean:JG,median:QG,unique:eH,uniqueCount:tH,count:nH},iH={getDefaultColumnDef:()=>({aggregatedCell:t=>{var e,a;return(e=(a=t.getValue())==null||a.toString==null?void 0:a.toString())!=null?e:null},aggregationFn:"auto"}),getInitialState:t=>({grouping:[],...t}),getDefaultOptions:t=>({onGroupingChange:gc("grouping",t),groupedColumnMode:"reorder"}),createColumn:(t,e)=>{t.toggleGrouping=()=>{e.setGrouping(a=>a!=null&&a.includes(t.id)?a.filter(c=>c!==t.id):[...a??[],t.id])},t.getCanGroup=()=>{var a,c;return((a=t.columnDef.enableGrouping)!=null?a:!0)&&((c=e.options.enableGrouping)!=null?c:!0)&&(!!t.accessorFn||!!t.columnDef.getGroupingValue)},t.getIsGrouped=()=>{var a;return(a=e.getState().grouping)==null?void 0:a.includes(t.id)},t.getGroupedIndex=()=>{var a;return(a=e.getState().grouping)==null?void 0:a.indexOf(t.id)},t.getToggleGroupingHandler=()=>{const a=t.getCanGroup();return()=>{a&&t.toggleGrouping()}},t.getAutoAggregationFn=()=>{const a=e.getCoreRowModel().flatRows[0],c=a==null?void 0:a.getValue(t.id);if(typeof c=="number")return vT.sum;if(Object.prototype.toString.call(c)==="[object Date]")return vT.extent},t.getAggregationFn=()=>{var a,c;if(!t)throw new Error;return xE(t.columnDef.aggregationFn)?t.columnDef.aggregationFn:t.columnDef.aggregationFn==="auto"?t.getAutoAggregationFn():(a=(c=e.options.aggregationFns)==null?void 0:c[t.columnDef.aggregationFn])!=null?a:vT[t.columnDef.aggregationFn]}},createTable:t=>{t.setGrouping=e=>t.options.onGroupingChange==null?void 0:t.options.onGroupingChange(e),t.resetGrouping=e=>{var a,c;t.setGrouping(e?[]:(a=(c=t.initialState)==null?void 0:c.grouping)!=null?a:[])},t.getPreGroupedRowModel=()=>t.getFilteredRowModel(),t.getGroupedRowModel=()=>(!t._getGroupedRowModel&&t.options.getGroupedRowModel&&(t._getGroupedRowModel=t.options.getGroupedRowModel(t)),t.options.manualGrouping||!t._getGroupedRowModel?t.getPreGroupedRowModel():t._getGroupedRowModel())},createRow:(t,e)=>{t.getIsGrouped=()=>!!t.groupingColumnId,t.getGroupingValue=a=>{if(t._groupingValuesCache.hasOwnProperty(a))return t._groupingValuesCache[a];const c=e.getColumn(a);return c!=null&&c.columnDef.getGroupingValue?(t._groupingValuesCache[a]=c.columnDef.getGroupingValue(t.original),t._groupingValuesCache[a]):t.getValue(a)},t._groupingValuesCache={}},createCell:(t,e,a,c)=>{t.getIsGrouped=()=>e.getIsGrouped()&&e.id===a.groupingColumnId,t.getIsPlaceholder=()=>!t.getIsGrouped()&&e.getIsGrouped(),t.getIsAggregated=()=>{var p;return!t.getIsGrouped()&&!t.getIsPlaceholder()&&!!((p=a.subRows)!=null&&p.length)}}};function rH(t,e,a){if(!(e!=null&&e.length)||!a)return t;const c=t.filter(y=>!e.includes(y.id));return a==="remove"?c:[...e.map(y=>t.find(M=>M.id===y)).filter(Boolean),...c]}const aH={getInitialState:t=>({columnOrder:[],...t}),getDefaultOptions:t=>({onColumnOrderChange:gc("columnOrder",t)}),createColumn:(t,e)=>{t.getIndex=rr(a=>[L0(e,a)],a=>a.findIndex(c=>c.id===t.id),ar(e.options,"debugColumns")),t.getIsFirstColumn=a=>{var c;return((c=L0(e,a)[0])==null?void 0:c.id)===t.id},t.getIsLastColumn=a=>{var c;const p=L0(e,a);return((c=p[p.length-1])==null?void 0:c.id)===t.id}},createTable:t=>{t.setColumnOrder=e=>t.options.onColumnOrderChange==null?void 0:t.options.onColumnOrderChange(e),t.resetColumnOrder=e=>{var a;t.setColumnOrder(e?[]:(a=t.initialState.columnOrder)!=null?a:[])},t._getOrderColumnsFn=rr(()=>[t.getState().columnOrder,t.getState().grouping,t.options.groupedColumnMode],(e,a,c)=>p=>{let y=[];if(!(e!=null&&e.length))y=p;else{const M=[...e],r=[...p];for(;r.length&&M.length;){const I=M.shift(),k=r.findIndex(B=>B.id===I);k>-1&&y.push(r.splice(k,1)[0])}y=[...y,...r]}return rH(y,a,c)},ar(t.options,"debugTable"))}},yT=()=>({left:[],right:[]}),oH={getInitialState:t=>({columnPinning:yT(),...t}),getDefaultOptions:t=>({onColumnPinningChange:gc("columnPinning",t)}),createColumn:(t,e)=>{t.pin=a=>{const c=t.getLeafColumns().map(p=>p.id).filter(Boolean);e.setColumnPinning(p=>{var y,M;if(a==="right"){var r,I;return{left:((r=p==null?void 0:p.left)!=null?r:[]).filter(U=>!(c!=null&&c.includes(U))),right:[...((I=p==null?void 0:p.right)!=null?I:[]).filter(U=>!(c!=null&&c.includes(U))),...c]}}if(a==="left"){var k,B;return{left:[...((k=p==null?void 0:p.left)!=null?k:[]).filter(U=>!(c!=null&&c.includes(U))),...c],right:((B=p==null?void 0:p.right)!=null?B:[]).filter(U=>!(c!=null&&c.includes(U)))}}return{left:((y=p==null?void 0:p.left)!=null?y:[]).filter(U=>!(c!=null&&c.includes(U))),right:((M=p==null?void 0:p.right)!=null?M:[]).filter(U=>!(c!=null&&c.includes(U)))}})},t.getCanPin=()=>t.getLeafColumns().some(c=>{var p,y,M;return((p=c.columnDef.enablePinning)!=null?p:!0)&&((y=(M=e.options.enableColumnPinning)!=null?M:e.options.enablePinning)!=null?y:!0)}),t.getIsPinned=()=>{const a=t.getLeafColumns().map(r=>r.id),{left:c,right:p}=e.getState().columnPinning,y=a.some(r=>c==null?void 0:c.includes(r)),M=a.some(r=>p==null?void 0:p.includes(r));return y?"left":M?"right":!1},t.getPinnedIndex=()=>{var a,c;const p=t.getIsPinned();return p?(a=(c=e.getState().columnPinning)==null||(c=c[p])==null?void 0:c.indexOf(t.id))!=null?a:-1:0}},createRow:(t,e)=>{t.getCenterVisibleCells=rr(()=>[t._getAllVisibleCells(),e.getState().columnPinning.left,e.getState().columnPinning.right],(a,c,p)=>{const y=[...c??[],...p??[]];return a.filter(M=>!y.includes(M.column.id))},ar(e.options,"debugRows")),t.getLeftVisibleCells=rr(()=>[t._getAllVisibleCells(),e.getState().columnPinning.left],(a,c)=>(c??[]).map(y=>a.find(M=>M.column.id===y)).filter(Boolean).map(y=>({...y,position:"left"})),ar(e.options,"debugRows")),t.getRightVisibleCells=rr(()=>[t._getAllVisibleCells(),e.getState().columnPinning.right],(a,c)=>(c??[]).map(y=>a.find(M=>M.column.id===y)).filter(Boolean).map(y=>({...y,position:"right"})),ar(e.options,"debugRows"))},createTable:t=>{t.setColumnPinning=e=>t.options.onColumnPinningChange==null?void 0:t.options.onColumnPinningChange(e),t.resetColumnPinning=e=>{var a,c;return t.setColumnPinning(e?yT():(a=(c=t.initialState)==null?void 0:c.columnPinning)!=null?a:yT())},t.getIsSomeColumnsPinned=e=>{var a;const c=t.getState().columnPinning;if(!e){var p,y;return!!((p=c.left)!=null&&p.length||(y=c.right)!=null&&y.length)}return!!((a=c[e])!=null&&a.length)},t.getLeftLeafColumns=rr(()=>[t.getAllLeafColumns(),t.getState().columnPinning.left],(e,a)=>(a??[]).map(c=>e.find(p=>p.id===c)).filter(Boolean),ar(t.options,"debugColumns")),t.getRightLeafColumns=rr(()=>[t.getAllLeafColumns(),t.getState().columnPinning.right],(e,a)=>(a??[]).map(c=>e.find(p=>p.id===c)).filter(Boolean),ar(t.options,"debugColumns")),t.getCenterLeafColumns=rr(()=>[t.getAllLeafColumns(),t.getState().columnPinning.left,t.getState().columnPinning.right],(e,a,c)=>{const p=[...a??[],...c??[]];return e.filter(y=>!p.includes(y.id))},ar(t.options,"debugColumns"))}},E1={size:150,minSize:20,maxSize:Number.MAX_SAFE_INTEGER},xT=()=>({startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,isResizingColumn:!1,columnSizingStart:[]}),sH={getDefaultColumnDef:()=>E1,getInitialState:t=>({columnSizing:{},columnSizingInfo:xT(),...t}),getDefaultOptions:t=>({columnResizeMode:"onEnd",columnResizeDirection:"ltr",onColumnSizingChange:gc("columnSizing",t),onColumnSizingInfoChange:gc("columnSizingInfo",t)}),createColumn:(t,e)=>{t.getSize=()=>{var a,c,p;const y=e.getState().columnSizing[t.id];return Math.min(Math.max((a=t.columnDef.minSize)!=null?a:E1.minSize,(c=y??t.columnDef.size)!=null?c:E1.size),(p=t.columnDef.maxSize)!=null?p:E1.maxSize)},t.getStart=rr(a=>[a,L0(e,a),e.getState().columnSizing],(a,c)=>c.slice(0,t.getIndex(a)).reduce((p,y)=>p+y.getSize(),0),ar(e.options,"debugColumns")),t.getAfter=rr(a=>[a,L0(e,a),e.getState().columnSizing],(a,c)=>c.slice(t.getIndex(a)+1).reduce((p,y)=>p+y.getSize(),0),ar(e.options,"debugColumns")),t.resetSize=()=>{e.setColumnSizing(a=>{let{[t.id]:c,...p}=a;return p})},t.getCanResize=()=>{var a,c;return((a=t.columnDef.enableResizing)!=null?a:!0)&&((c=e.options.enableColumnResizing)!=null?c:!0)},t.getIsResizing=()=>e.getState().columnSizingInfo.isResizingColumn===t.id},createHeader:(t,e)=>{t.getSize=()=>{let a=0;const c=p=>{if(p.subHeaders.length)p.subHeaders.forEach(c);else{var y;a+=(y=p.column.getSize())!=null?y:0}};return c(t),a},t.getStart=()=>{if(t.index>0){const a=t.headerGroup.headers[t.index-1];return a.getStart()+a.getSize()}return 0},t.getResizeHandler=a=>{const c=e.getColumn(t.column.id),p=c==null?void 0:c.getCanResize();return y=>{if(!c||!p||(y.persist==null||y.persist(),bT(y)&&y.touches&&y.touches.length>1))return;const M=t.getSize(),r=t?t.getLeafHeaders().map(j=>[j.column.id,j.column.getSize()]):[[c.id,c.getSize()]],I=bT(y)?Math.round(y.touches[0].clientX):y.clientX,k={},B=(j,oe)=>{typeof oe=="number"&&(e.setColumnSizingInfo(ce=>{var pe,Ae;const Ee=e.options.columnResizeDirection==="rtl"?-1:1,be=(oe-((pe=ce==null?void 0:ce.startOffset)!=null?pe:0))*Ee,Ve=Math.max(be/((Ae=ce==null?void 0:ce.startSize)!=null?Ae:0),-.999999);return ce.columnSizingStart.forEach(Se=>{let[xe,Fe]=Se;k[xe]=Math.round(Math.max(Fe+Fe*Ve,0)*100)/100}),{...ce,deltaOffset:be,deltaPercentage:Ve}}),(e.options.columnResizeMode==="onChange"||j==="end")&&e.setColumnSizing(ce=>({...ce,...k})))},U=j=>B("move",j),H=j=>{B("end",j),e.setColumnSizingInfo(oe=>({...oe,isResizingColumn:!1,startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,columnSizingStart:[]}))},Y=a||typeof document<"u"?document:null,X={moveHandler:j=>U(j.clientX),upHandler:j=>{Y==null||Y.removeEventListener("mousemove",X.moveHandler),Y==null||Y.removeEventListener("mouseup",X.upHandler),H(j.clientX)}},Q={moveHandler:j=>(j.cancelable&&(j.preventDefault(),j.stopPropagation()),U(j.touches[0].clientX),!1),upHandler:j=>{var oe;Y==null||Y.removeEventListener("touchmove",Q.moveHandler),Y==null||Y.removeEventListener("touchend",Q.upHandler),j.cancelable&&(j.preventDefault(),j.stopPropagation()),H((oe=j.touches[0])==null?void 0:oe.clientX)}},J=lH()?{passive:!1}:!1;bT(y)?(Y==null||Y.addEventListener("touchmove",Q.moveHandler,J),Y==null||Y.addEventListener("touchend",Q.upHandler,J)):(Y==null||Y.addEventListener("mousemove",X.moveHandler,J),Y==null||Y.addEventListener("mouseup",X.upHandler,J)),e.setColumnSizingInfo(j=>({...j,startOffset:I,startSize:M,deltaOffset:0,deltaPercentage:0,columnSizingStart:r,isResizingColumn:c.id}))}}},createTable:t=>{t.setColumnSizing=e=>t.options.onColumnSizingChange==null?void 0:t.options.onColumnSizingChange(e),t.setColumnSizingInfo=e=>t.options.onColumnSizingInfoChange==null?void 0:t.options.onColumnSizingInfoChange(e),t.resetColumnSizing=e=>{var a;t.setColumnSizing(e?{}:(a=t.initialState.columnSizing)!=null?a:{})},t.resetHeaderSizeInfo=e=>{var a;t.setColumnSizingInfo(e?xT():(a=t.initialState.columnSizingInfo)!=null?a:xT())},t.getTotalSize=()=>{var e,a;return(e=(a=t.getHeaderGroups()[0])==null?void 0:a.headers.reduce((c,p)=>c+p.getSize(),0))!=null?e:0},t.getLeftTotalSize=()=>{var e,a;return(e=(a=t.getLeftHeaderGroups()[0])==null?void 0:a.headers.reduce((c,p)=>c+p.getSize(),0))!=null?e:0},t.getCenterTotalSize=()=>{var e,a;return(e=(a=t.getCenterHeaderGroups()[0])==null?void 0:a.headers.reduce((c,p)=>c+p.getSize(),0))!=null?e:0},t.getRightTotalSize=()=>{var e,a;return(e=(a=t.getRightHeaderGroups()[0])==null?void 0:a.headers.reduce((c,p)=>c+p.getSize(),0))!=null?e:0}}};let M1=null;function lH(){if(typeof M1=="boolean")return M1;let t=!1;try{const e={get passive(){return t=!0,!1}},a=()=>{};window.addEventListener("test",a,e),window.removeEventListener("test",a)}catch{t=!1}return M1=t,M1}function bT(t){return t.type==="touchstart"}const cH={getInitialState:t=>({columnVisibility:{},...t}),getDefaultOptions:t=>({onColumnVisibilityChange:gc("columnVisibility",t)}),createColumn:(t,e)=>{t.toggleVisibility=a=>{t.getCanHide()&&e.setColumnVisibility(c=>({...c,[t.id]:a??!t.getIsVisible()}))},t.getIsVisible=()=>{var a,c;const p=t.columns;return(a=p.length?p.some(y=>y.getIsVisible()):(c=e.getState().columnVisibility)==null?void 0:c[t.id])!=null?a:!0},t.getCanHide=()=>{var a,c;return((a=t.columnDef.enableHiding)!=null?a:!0)&&((c=e.options.enableHiding)!=null?c:!0)},t.getToggleVisibilityHandler=()=>a=>{t.toggleVisibility==null||t.toggleVisibility(a.target.checked)}},createRow:(t,e)=>{t._getAllVisibleCells=rr(()=>[t.getAllCells(),e.getState().columnVisibility],a=>a.filter(c=>c.column.getIsVisible()),ar(e.options,"debugRows")),t.getVisibleCells=rr(()=>[t.getLeftVisibleCells(),t.getCenterVisibleCells(),t.getRightVisibleCells()],(a,c,p)=>[...a,...c,...p],ar(e.options,"debugRows"))},createTable:t=>{const e=(a,c)=>rr(()=>[c(),c().filter(p=>p.getIsVisible()).map(p=>p.id).join("_")],p=>p.filter(y=>y.getIsVisible==null?void 0:y.getIsVisible()),ar(t.options,"debugColumns"));t.getVisibleFlatColumns=e("getVisibleFlatColumns",()=>t.getAllFlatColumns()),t.getVisibleLeafColumns=e("getVisibleLeafColumns",()=>t.getAllLeafColumns()),t.getLeftVisibleLeafColumns=e("getLeftVisibleLeafColumns",()=>t.getLeftLeafColumns()),t.getRightVisibleLeafColumns=e("getRightVisibleLeafColumns",()=>t.getRightLeafColumns()),t.getCenterVisibleLeafColumns=e("getCenterVisibleLeafColumns",()=>t.getCenterLeafColumns()),t.setColumnVisibility=a=>t.options.onColumnVisibilityChange==null?void 0:t.options.onColumnVisibilityChange(a),t.resetColumnVisibility=a=>{var c;t.setColumnVisibility(a?{}:(c=t.initialState.columnVisibility)!=null?c:{})},t.toggleAllColumnsVisible=a=>{var c;a=(c=a)!=null?c:!t.getIsAllColumnsVisible(),t.setColumnVisibility(t.getAllLeafColumns().reduce((p,y)=>({...p,[y.id]:a||!(y.getCanHide!=null&&y.getCanHide())}),{}))},t.getIsAllColumnsVisible=()=>!t.getAllLeafColumns().some(a=>!(a.getIsVisible!=null&&a.getIsVisible())),t.getIsSomeColumnsVisible=()=>t.getAllLeafColumns().some(a=>a.getIsVisible==null?void 0:a.getIsVisible()),t.getToggleAllColumnsVisibilityHandler=()=>a=>{var c;t.toggleAllColumnsVisible((c=a.target)==null?void 0:c.checked)}}};function L0(t,e){return e?e==="center"?t.getCenterVisibleLeafColumns():e==="left"?t.getLeftVisibleLeafColumns():t.getRightVisibleLeafColumns():t.getVisibleLeafColumns()}const uH={createTable:t=>{t._getGlobalFacetedRowModel=t.options.getFacetedRowModel&&t.options.getFacetedRowModel(t,"__global__"),t.getGlobalFacetedRowModel=()=>t.options.manualFiltering||!t._getGlobalFacetedRowModel?t.getPreFilteredRowModel():t._getGlobalFacetedRowModel(),t._getGlobalFacetedUniqueValues=t.options.getFacetedUniqueValues&&t.options.getFacetedUniqueValues(t,"__global__"),t.getGlobalFacetedUniqueValues=()=>t._getGlobalFacetedUniqueValues?t._getGlobalFacetedUniqueValues():new Map,t._getGlobalFacetedMinMaxValues=t.options.getFacetedMinMaxValues&&t.options.getFacetedMinMaxValues(t,"__global__"),t.getGlobalFacetedMinMaxValues=()=>{if(t._getGlobalFacetedMinMaxValues)return t._getGlobalFacetedMinMaxValues()}}},hH={getInitialState:t=>({globalFilter:void 0,...t}),getDefaultOptions:t=>({onGlobalFilterChange:gc("globalFilter",t),globalFilterFn:"auto",getColumnCanGlobalFilter:e=>{var a;const c=(a=t.getCoreRowModel().flatRows[0])==null||(a=a._getAllCellsByColumnId()[e.id])==null?void 0:a.getValue();return typeof c=="string"||typeof c=="number"}}),createColumn:(t,e)=>{t.getCanGlobalFilter=()=>{var a,c,p,y;return((a=t.columnDef.enableGlobalFilter)!=null?a:!0)&&((c=e.options.enableGlobalFilter)!=null?c:!0)&&((p=e.options.enableFilters)!=null?p:!0)&&((y=e.options.getColumnCanGlobalFilter==null?void 0:e.options.getColumnCanGlobalFilter(t))!=null?y:!0)&&!!t.accessorFn}},createTable:t=>{t.getGlobalAutoFilterFn=()=>jf.includesString,t.getGlobalFilterFn=()=>{var e,a;const{globalFilterFn:c}=t.options;return xE(c)?c:c==="auto"?t.getGlobalAutoFilterFn():(e=(a=t.options.filterFns)==null?void 0:a[c])!=null?e:jf[c]},t.setGlobalFilter=e=>{t.options.onGlobalFilterChange==null||t.options.onGlobalFilterChange(e)},t.resetGlobalFilter=e=>{t.setGlobalFilter(e?void 0:t.initialState.globalFilter)}}},dH={getInitialState:t=>({expanded:{},...t}),getDefaultOptions:t=>({onExpandedChange:gc("expanded",t),paginateExpandedRows:!0}),createTable:t=>{let e=!1,a=!1;t._autoResetExpanded=()=>{var c,p;if(!e){t._queue(()=>{e=!0});return}if((c=(p=t.options.autoResetAll)!=null?p:t.options.autoResetExpanded)!=null?c:!t.options.manualExpanding){if(a)return;a=!0,t._queue(()=>{t.resetExpanded(),a=!1})}},t.setExpanded=c=>t.options.onExpandedChange==null?void 0:t.options.onExpandedChange(c),t.toggleAllRowsExpanded=c=>{c??!t.getIsAllRowsExpanded()?t.setExpanded(!0):t.setExpanded({})},t.resetExpanded=c=>{var p,y;t.setExpanded(c?{}:(p=(y=t.initialState)==null?void 0:y.expanded)!=null?p:{})},t.getCanSomeRowsExpand=()=>t.getPrePaginationRowModel().flatRows.some(c=>c.getCanExpand()),t.getToggleAllRowsExpandedHandler=()=>c=>{c.persist==null||c.persist(),t.toggleAllRowsExpanded()},t.getIsSomeRowsExpanded=()=>{const c=t.getState().expanded;return c===!0||Object.values(c).some(Boolean)},t.getIsAllRowsExpanded=()=>{const c=t.getState().expanded;return typeof c=="boolean"?c===!0:!(!Object.keys(c).length||t.getRowModel().flatRows.some(p=>!p.getIsExpanded()))},t.getExpandedDepth=()=>{let c=0;return(t.getState().expanded===!0?Object.keys(t.getRowModel().rowsById):Object.keys(t.getState().expanded)).forEach(y=>{const M=y.split(".");c=Math.max(c,M.length)}),c},t.getPreExpandedRowModel=()=>t.getSortedRowModel(),t.getExpandedRowModel=()=>(!t._getExpandedRowModel&&t.options.getExpandedRowModel&&(t._getExpandedRowModel=t.options.getExpandedRowModel(t)),t.options.manualExpanding||!t._getExpandedRowModel?t.getPreExpandedRowModel():t._getExpandedRowModel())},createRow:(t,e)=>{t.toggleExpanded=a=>{e.setExpanded(c=>{var p;const y=c===!0?!0:!!(c!=null&&c[t.id]);let M={};if(c===!0?Object.keys(e.getRowModel().rowsById).forEach(r=>{M[r]=!0}):M=c,a=(p=a)!=null?p:!y,!y&&a)return{...M,[t.id]:!0};if(y&&!a){const{[t.id]:r,...I}=M;return I}return c})},t.getIsExpanded=()=>{var a;const c=e.getState().expanded;return!!((a=e.options.getIsRowExpanded==null?void 0:e.options.getIsRowExpanded(t))!=null?a:c===!0||c!=null&&c[t.id])},t.getCanExpand=()=>{var a,c,p;return(a=e.options.getRowCanExpand==null?void 0:e.options.getRowCanExpand(t))!=null?a:((c=e.options.enableExpanding)!=null?c:!0)&&!!((p=t.subRows)!=null&&p.length)},t.getIsAllParentsExpanded=()=>{let a=!0,c=t;for(;a&&c.parentId;)c=e.getRow(c.parentId,!0),a=c.getIsExpanded();return a},t.getToggleExpandedHandler=()=>{const a=t.getCanExpand();return()=>{a&&t.toggleExpanded()}}}},G2=0,H2=10,wT=()=>({pageIndex:G2,pageSize:H2}),fH={getInitialState:t=>({...t,pagination:{...wT(),...t==null?void 0:t.pagination}}),getDefaultOptions:t=>({onPaginationChange:gc("pagination",t)}),createTable:t=>{let e=!1,a=!1;t._autoResetPageIndex=()=>{var c,p;if(!e){t._queue(()=>{e=!0});return}if((c=(p=t.options.autoResetAll)!=null?p:t.options.autoResetPageIndex)!=null?c:!t.options.manualPagination){if(a)return;a=!0,t._queue(()=>{t.resetPageIndex(),a=!1})}},t.setPagination=c=>{const p=y=>vm(c,y);return t.options.onPaginationChange==null?void 0:t.options.onPaginationChange(p)},t.resetPagination=c=>{var p;t.setPagination(c?wT():(p=t.initialState.pagination)!=null?p:wT())},t.setPageIndex=c=>{t.setPagination(p=>{let y=vm(c,p.pageIndex);const M=typeof t.options.pageCount>"u"||t.options.pageCount===-1?Number.MAX_SAFE_INTEGER:t.options.pageCount-1;return y=Math.max(0,Math.min(y,M)),{...p,pageIndex:y}})},t.resetPageIndex=c=>{var p,y;t.setPageIndex(c?G2:(p=(y=t.initialState)==null||(y=y.pagination)==null?void 0:y.pageIndex)!=null?p:G2)},t.resetPageSize=c=>{var p,y;t.setPageSize(c?H2:(p=(y=t.initialState)==null||(y=y.pagination)==null?void 0:y.pageSize)!=null?p:H2)},t.setPageSize=c=>{t.setPagination(p=>{const y=Math.max(1,vm(c,p.pageSize)),M=p.pageSize*p.pageIndex,r=Math.floor(M/y);return{...p,pageIndex:r,pageSize:y}})},t.setPageCount=c=>t.setPagination(p=>{var y;let M=vm(c,(y=t.options.pageCount)!=null?y:-1);return typeof M=="number"&&(M=Math.max(-1,M)),{...p,pageCount:M}}),t.getPageOptions=rr(()=>[t.getPageCount()],c=>{let p=[];return c&&c>0&&(p=[...new Array(c)].fill(null).map((y,M)=>M)),p},ar(t.options,"debugTable")),t.getCanPreviousPage=()=>t.getState().pagination.pageIndex>0,t.getCanNextPage=()=>{const{pageIndex:c}=t.getState().pagination,p=t.getPageCount();return p===-1?!0:p===0?!1:c<p-1},t.previousPage=()=>t.setPageIndex(c=>c-1),t.nextPage=()=>t.setPageIndex(c=>c+1),t.firstPage=()=>t.setPageIndex(0),t.lastPage=()=>t.setPageIndex(t.getPageCount()-1),t.getPrePaginationRowModel=()=>t.getExpandedRowModel(),t.getPaginationRowModel=()=>(!t._getPaginationRowModel&&t.options.getPaginationRowModel&&(t._getPaginationRowModel=t.options.getPaginationRowModel(t)),t.options.manualPagination||!t._getPaginationRowModel?t.getPrePaginationRowModel():t._getPaginationRowModel()),t.getPageCount=()=>{var c;return(c=t.options.pageCount)!=null?c:Math.ceil(t.getRowCount()/t.getState().pagination.pageSize)},t.getRowCount=()=>{var c;return(c=t.options.rowCount)!=null?c:t.getPrePaginationRowModel().rows.length}}},ST=()=>({top:[],bottom:[]}),pH={getInitialState:t=>({rowPinning:ST(),...t}),getDefaultOptions:t=>({onRowPinningChange:gc("rowPinning",t)}),createRow:(t,e)=>{t.pin=(a,c,p)=>{const y=c?t.getLeafRows().map(I=>{let{id:k}=I;return k}):[],M=p?t.getParentRows().map(I=>{let{id:k}=I;return k}):[],r=new Set([...M,t.id,...y]);e.setRowPinning(I=>{var k,B;if(a==="bottom"){var U,H;return{top:((U=I==null?void 0:I.top)!=null?U:[]).filter(Q=>!(r!=null&&r.has(Q))),bottom:[...((H=I==null?void 0:I.bottom)!=null?H:[]).filter(Q=>!(r!=null&&r.has(Q))),...Array.from(r)]}}if(a==="top"){var Y,X;return{top:[...((Y=I==null?void 0:I.top)!=null?Y:[]).filter(Q=>!(r!=null&&r.has(Q))),...Array.from(r)],bottom:((X=I==null?void 0:I.bottom)!=null?X:[]).filter(Q=>!(r!=null&&r.has(Q)))}}return{top:((k=I==null?void 0:I.top)!=null?k:[]).filter(Q=>!(r!=null&&r.has(Q))),bottom:((B=I==null?void 0:I.bottom)!=null?B:[]).filter(Q=>!(r!=null&&r.has(Q)))}})},t.getCanPin=()=>{var a;const{enableRowPinning:c,enablePinning:p}=e.options;return typeof c=="function"?c(t):(a=c??p)!=null?a:!0},t.getIsPinned=()=>{const a=[t.id],{top:c,bottom:p}=e.getState().rowPinning,y=a.some(r=>c==null?void 0:c.includes(r)),M=a.some(r=>p==null?void 0:p.includes(r));return y?"top":M?"bottom":!1},t.getPinnedIndex=()=>{var a,c;const p=t.getIsPinned();if(!p)return-1;const y=(a=p==="top"?e.getTopRows():e.getBottomRows())==null?void 0:a.map(M=>{let{id:r}=M;return r});return(c=y==null?void 0:y.indexOf(t.id))!=null?c:-1}},createTable:t=>{t.setRowPinning=e=>t.options.onRowPinningChange==null?void 0:t.options.onRowPinningChange(e),t.resetRowPinning=e=>{var a,c;return t.setRowPinning(e?ST():(a=(c=t.initialState)==null?void 0:c.rowPinning)!=null?a:ST())},t.getIsSomeRowsPinned=e=>{var a;const c=t.getState().rowPinning;if(!e){var p,y;return!!((p=c.top)!=null&&p.length||(y=c.bottom)!=null&&y.length)}return!!((a=c[e])!=null&&a.length)},t._getPinnedRows=(e,a,c)=>{var p;return((p=t.options.keepPinnedRows)==null||p?(a??[]).map(M=>{const r=t.getRow(M,!0);return r.getIsAllParentsExpanded()?r:null}):(a??[]).map(M=>e.find(r=>r.id===M))).filter(Boolean).map(M=>({...M,position:c}))},t.getTopRows=rr(()=>[t.getRowModel().rows,t.getState().rowPinning.top],(e,a)=>t._getPinnedRows(e,a,"top"),ar(t.options,"debugRows")),t.getBottomRows=rr(()=>[t.getRowModel().rows,t.getState().rowPinning.bottom],(e,a)=>t._getPinnedRows(e,a,"bottom"),ar(t.options,"debugRows")),t.getCenterRows=rr(()=>[t.getRowModel().rows,t.getState().rowPinning.top,t.getState().rowPinning.bottom],(e,a,c)=>{const p=new Set([...a??[],...c??[]]);return e.filter(y=>!p.has(y.id))},ar(t.options,"debugRows"))}},mH={getInitialState:t=>({rowSelection:{},...t}),getDefaultOptions:t=>({onRowSelectionChange:gc("rowSelection",t),enableRowSelection:!0,enableMultiRowSelection:!0,enableSubRowSelection:!0}),createTable:t=>{t.setRowSelection=e=>t.options.onRowSelectionChange==null?void 0:t.options.onRowSelectionChange(e),t.resetRowSelection=e=>{var a;return t.setRowSelection(e?{}:(a=t.initialState.rowSelection)!=null?a:{})},t.toggleAllRowsSelected=e=>{t.setRowSelection(a=>{e=typeof e<"u"?e:!t.getIsAllRowsSelected();const c={...a},p=t.getPreGroupedRowModel().flatRows;return e?p.forEach(y=>{y.getCanSelect()&&(c[y.id]=!0)}):p.forEach(y=>{delete c[y.id]}),c})},t.toggleAllPageRowsSelected=e=>t.setRowSelection(a=>{const c=typeof e<"u"?e:!t.getIsAllPageRowsSelected(),p={...a};return t.getRowModel().rows.forEach(y=>{q2(p,y.id,c,!0,t)}),p}),t.getPreSelectedRowModel=()=>t.getCoreRowModel(),t.getSelectedRowModel=rr(()=>[t.getState().rowSelection,t.getCoreRowModel()],(e,a)=>Object.keys(e).length?ET(t,a):{rows:[],flatRows:[],rowsById:{}},ar(t.options,"debugTable")),t.getFilteredSelectedRowModel=rr(()=>[t.getState().rowSelection,t.getFilteredRowModel()],(e,a)=>Object.keys(e).length?ET(t,a):{rows:[],flatRows:[],rowsById:{}},ar(t.options,"debugTable")),t.getGroupedSelectedRowModel=rr(()=>[t.getState().rowSelection,t.getSortedRowModel()],(e,a)=>Object.keys(e).length?ET(t,a):{rows:[],flatRows:[],rowsById:{}},ar(t.options,"debugTable")),t.getIsAllRowsSelected=()=>{const e=t.getFilteredRowModel().flatRows,{rowSelection:a}=t.getState();let c=!!(e.length&&Object.keys(a).length);return c&&e.some(p=>p.getCanSelect()&&!a[p.id])&&(c=!1),c},t.getIsAllPageRowsSelected=()=>{const e=t.getPaginationRowModel().flatRows.filter(p=>p.getCanSelect()),{rowSelection:a}=t.getState();let c=!!e.length;return c&&e.some(p=>!a[p.id])&&(c=!1),c},t.getIsSomeRowsSelected=()=>{var e;const a=Object.keys((e=t.getState().rowSelection)!=null?e:{}).length;return a>0&&a<t.getFilteredRowModel().flatRows.length},t.getIsSomePageRowsSelected=()=>{const e=t.getPaginationRowModel().flatRows;return t.getIsAllPageRowsSelected()?!1:e.filter(a=>a.getCanSelect()).some(a=>a.getIsSelected()||a.getIsSomeSelected())},t.getToggleAllRowsSelectedHandler=()=>e=>{t.toggleAllRowsSelected(e.target.checked)},t.getToggleAllPageRowsSelectedHandler=()=>e=>{t.toggleAllPageRowsSelected(e.target.checked)}},createRow:(t,e)=>{t.toggleSelected=(a,c)=>{const p=t.getIsSelected();e.setRowSelection(y=>{var M;if(a=typeof a<"u"?a:!p,t.getCanSelect()&&p===a)return y;const r={...y};return q2(r,t.id,a,(M=c==null?void 0:c.selectChildren)!=null?M:!0,e),r})},t.getIsSelected=()=>{const{rowSelection:a}=e.getState();return tR(t,a)},t.getIsSomeSelected=()=>{const{rowSelection:a}=e.getState();return W2(t,a)==="some"},t.getIsAllSubRowsSelected=()=>{const{rowSelection:a}=e.getState();return W2(t,a)==="all"},t.getCanSelect=()=>{var a;return typeof e.options.enableRowSelection=="function"?e.options.enableRowSelection(t):(a=e.options.enableRowSelection)!=null?a:!0},t.getCanSelectSubRows=()=>{var a;return typeof e.options.enableSubRowSelection=="function"?e.options.enableSubRowSelection(t):(a=e.options.enableSubRowSelection)!=null?a:!0},t.getCanMultiSelect=()=>{var a;return typeof e.options.enableMultiRowSelection=="function"?e.options.enableMultiRowSelection(t):(a=e.options.enableMultiRowSelection)!=null?a:!0},t.getToggleSelectedHandler=()=>{const a=t.getCanSelect();return c=>{var p;a&&t.toggleSelected((p=c.target)==null?void 0:p.checked)}}}},q2=(t,e,a,c,p)=>{var y;const M=p.getRow(e,!0);a?(M.getCanMultiSelect()||Object.keys(t).forEach(r=>delete t[r]),M.getCanSelect()&&(t[e]=!0)):delete t[e],c&&(y=M.subRows)!=null&&y.length&&M.getCanSelectSubRows()&&M.subRows.forEach(r=>q2(t,r.id,a,c,p))};function ET(t,e){const a=t.getState().rowSelection,c=[],p={},y=function(M,r){return M.map(I=>{var k;const B=tR(I,a);if(B&&(c.push(I),p[I.id]=I),(k=I.subRows)!=null&&k.length&&(I={...I,subRows:y(I.subRows)}),B)return I}).filter(Boolean)};return{rows:y(e.rows),flatRows:c,rowsById:p}}function tR(t,e){var a;return(a=e[t.id])!=null?a:!1}function W2(t,e,a){var c;if(!((c=t.subRows)!=null&&c.length))return!1;let p=!0,y=!1;return t.subRows.forEach(M=>{if(!(y&&!p)&&(M.getCanSelect()&&(tR(M,e)?y=!0:p=!1),M.subRows&&M.subRows.length)){const r=W2(M,e);r==="all"?y=!0:(r==="some"&&(y=!0),p=!1)}}),p?"all":y?"some":!1}const $2=/([0-9]+)/gm,gH=(t,e,a)=>yz(Sm(t.getValue(a)).toLowerCase(),Sm(e.getValue(a)).toLowerCase()),_H=(t,e,a)=>yz(Sm(t.getValue(a)),Sm(e.getValue(a))),vH=(t,e,a)=>nR(Sm(t.getValue(a)).toLowerCase(),Sm(e.getValue(a)).toLowerCase()),yH=(t,e,a)=>nR(Sm(t.getValue(a)),Sm(e.getValue(a))),xH=(t,e,a)=>{const c=t.getValue(a),p=e.getValue(a);return c>p?1:c<p?-1:0},bH=(t,e,a)=>nR(t.getValue(a),e.getValue(a));function nR(t,e){return t===e?0:t>e?1:-1}function Sm(t){return typeof t=="number"?isNaN(t)||t===1/0||t===-1/0?"":String(t):typeof t=="string"?t:""}function yz(t,e){const a=t.split($2).filter(Boolean),c=e.split($2).filter(Boolean);for(;a.length&&c.length;){const p=a.shift(),y=c.shift(),M=parseInt(p,10),r=parseInt(y,10),I=[M,r].sort();if(isNaN(I[0])){if(p>y)return 1;if(y>p)return-1;continue}if(isNaN(I[1]))return isNaN(M)?-1:1;if(M>r)return 1;if(r>M)return-1}return a.length-c.length}const Zx={alphanumeric:gH,alphanumericCaseSensitive:_H,text:vH,textCaseSensitive:yH,datetime:xH,basic:bH},wH={getInitialState:t=>({sorting:[],...t}),getDefaultColumnDef:()=>({sortingFn:"auto",sortUndefined:1}),getDefaultOptions:t=>({onSortingChange:gc("sorting",t),isMultiSortEvent:e=>e.shiftKey}),createColumn:(t,e)=>{t.getAutoSortingFn=()=>{const a=e.getFilteredRowModel().flatRows.slice(10);let c=!1;for(const p of a){const y=p==null?void 0:p.getValue(t.id);if(Object.prototype.toString.call(y)==="[object Date]")return Zx.datetime;if(typeof y=="string"&&(c=!0,y.split($2).length>1))return Zx.alphanumeric}return c?Zx.text:Zx.basic},t.getAutoSortDir=()=>{const a=e.getFilteredRowModel().flatRows[0];return typeof(a==null?void 0:a.getValue(t.id))=="string"?"asc":"desc"},t.getSortingFn=()=>{var a,c;if(!t)throw new Error;return xE(t.columnDef.sortingFn)?t.columnDef.sortingFn:t.columnDef.sortingFn==="auto"?t.getAutoSortingFn():(a=(c=e.options.sortingFns)==null?void 0:c[t.columnDef.sortingFn])!=null?a:Zx[t.columnDef.sortingFn]},t.toggleSorting=(a,c)=>{const p=t.getNextSortingOrder(),y=typeof a<"u"&&a!==null;e.setSorting(M=>{const r=M==null?void 0:M.find(Y=>Y.id===t.id),I=M==null?void 0:M.findIndex(Y=>Y.id===t.id);let k=[],B,U=y?a:p==="desc";if(M!=null&&M.length&&t.getCanMultiSort()&&c?r?B="toggle":B="add":M!=null&&M.length&&I!==M.length-1?B="replace":r?B="toggle":B="replace",B==="toggle"&&(y||p||(B="remove")),B==="add"){var H;k=[...M,{id:t.id,desc:U}],k.splice(0,k.length-((H=e.options.maxMultiSortColCount)!=null?H:Number.MAX_SAFE_INTEGER))}else B==="toggle"?k=M.map(Y=>Y.id===t.id?{...Y,desc:U}:Y):B==="remove"?k=M.filter(Y=>Y.id!==t.id):k=[{id:t.id,desc:U}];return k})},t.getFirstSortDir=()=>{var a,c;return((a=(c=t.columnDef.sortDescFirst)!=null?c:e.options.sortDescFirst)!=null?a:t.getAutoSortDir()==="desc")?"desc":"asc"},t.getNextSortingOrder=a=>{var c,p;const y=t.getFirstSortDir(),M=t.getIsSorted();return M?M!==y&&((c=e.options.enableSortingRemoval)==null||c)&&(!(a&&(p=e.options.enableMultiRemove)!=null)||p)?!1:M==="desc"?"asc":"desc":y},t.getCanSort=()=>{var a,c;return((a=t.columnDef.enableSorting)!=null?a:!0)&&((c=e.options.enableSorting)!=null?c:!0)&&!!t.accessorFn},t.getCanMultiSort=()=>{var a,c;return(a=(c=t.columnDef.enableMultiSort)!=null?c:e.options.enableMultiSort)!=null?a:!!t.accessorFn},t.getIsSorted=()=>{var a;const c=(a=e.getState().sorting)==null?void 0:a.find(p=>p.id===t.id);return c?c.desc?"desc":"asc":!1},t.getSortIndex=()=>{var a,c;return(a=(c=e.getState().sorting)==null?void 0:c.findIndex(p=>p.id===t.id))!=null?a:-1},t.clearSorting=()=>{e.setSorting(a=>a!=null&&a.length?a.filter(c=>c.id!==t.id):[])},t.getToggleSortingHandler=()=>{const a=t.getCanSort();return c=>{a&&(c.persist==null||c.persist(),t.toggleSorting==null||t.toggleSorting(void 0,t.getCanMultiSort()?e.options.isMultiSortEvent==null?void 0:e.options.isMultiSortEvent(c):!1))}}},createTable:t=>{t.setSorting=e=>t.options.onSortingChange==null?void 0:t.options.onSortingChange(e),t.resetSorting=e=>{var a,c;t.setSorting(e?[]:(a=(c=t.initialState)==null?void 0:c.sorting)!=null?a:[])},t.getPreSortedRowModel=()=>t.getGroupedRowModel(),t.getSortedRowModel=()=>(!t._getSortedRowModel&&t.options.getSortedRowModel&&(t._getSortedRowModel=t.options.getSortedRowModel(t)),t.options.manualSorting||!t._getSortedRowModel?t.getPreSortedRowModel():t._getSortedRowModel())}},SH=[HG,cH,aH,oH,WG,$G,uH,hH,wH,iH,dH,fH,pH,mH,sH];function EH(t){var e,a;const c=[...SH,...(e=t._features)!=null?e:[]];let p={_features:c};const y=p._features.reduce((H,Y)=>Object.assign(H,Y.getDefaultOptions==null?void 0:Y.getDefaultOptions(p)),{}),M=H=>p.options.mergeOptions?p.options.mergeOptions(y,H):{...y,...H};let I={...{},...(a=t.initialState)!=null?a:{}};p._features.forEach(H=>{var Y;I=(Y=H.getInitialState==null?void 0:H.getInitialState(I))!=null?Y:I});const k=[];let B=!1;const U={_features:c,options:{...y,...t},initialState:I,_queue:H=>{k.push(H),B||(B=!0,Promise.resolve().then(()=>{for(;k.length;)k.shift()();B=!1}).catch(Y=>setTimeout(()=>{throw Y})))},reset:()=>{p.setState(p.initialState)},setOptions:H=>{const Y=vm(H,p.options);p.options=M(Y)},getState:()=>p.options.state,setState:H=>{p.options.onStateChange==null||p.options.onStateChange(H)},_getRowId:(H,Y,X)=>{var Q;return(Q=p.options.getRowId==null?void 0:p.options.getRowId(H,Y,X))!=null?Q:`${X?[X.id,Y].join("."):Y}`},getCoreRowModel:()=>(p._getCoreRowModel||(p._getCoreRowModel=p.options.getCoreRowModel(p)),p._getCoreRowModel()),getRowModel:()=>p.getPaginationRowModel(),getRow:(H,Y)=>{let X=(Y?p.getPrePaginationRowModel():p.getRowModel()).rowsById[H];if(!X&&(X=p.getCoreRowModel().rowsById[H],!X))throw new Error;return X},_getDefaultColumnDef:rr(()=>[p.options.defaultColumn],H=>{var Y;return H=(Y=H)!=null?Y:{},{header:X=>{const Q=X.header.column.columnDef;return Q.accessorKey?Q.accessorKey:Q.accessorFn?Q.id:null},cell:X=>{var Q,J;return(Q=(J=X.renderValue())==null||J.toString==null?void 0:J.toString())!=null?Q:null},...p._features.reduce((X,Q)=>Object.assign(X,Q.getDefaultColumnDef==null?void 0:Q.getDefaultColumnDef()),{}),...H}},ar(t,"debugColumns")),_getColumnDefs:()=>p.options.columns,getAllColumns:rr(()=>[p._getColumnDefs()],H=>{const Y=function(X,Q,J){return J===void 0&&(J=0),X.map(j=>{const oe=GG(p,j,J,Q),ce=j;return oe.columns=ce.columns?Y(ce.columns,oe,J+1):[],oe})};return Y(H)},ar(t,"debugColumns")),getAllFlatColumns:rr(()=>[p.getAllColumns()],H=>H.flatMap(Y=>Y.getFlatColumns()),ar(t,"debugColumns")),_getAllFlatColumnsById:rr(()=>[p.getAllFlatColumns()],H=>H.reduce((Y,X)=>(Y[X.id]=X,Y),{}),ar(t,"debugColumns")),getAllLeafColumns:rr(()=>[p.getAllColumns(),p._getOrderColumnsFn()],(H,Y)=>{let X=H.flatMap(Q=>Q.getLeafColumns());return Y(X)},ar(t,"debugColumns")),getColumn:H=>p._getAllFlatColumnsById()[H]};Object.assign(p,U);for(let H=0;H<p._features.length;H++){const Y=p._features[H];Y==null||Y.createTable==null||Y.createTable(p)}return p}function MH(){return t=>rr(()=>[t.options.data],e=>{const a={rows:[],flatRows:[],rowsById:{}},c=function(p,y,M){y===void 0&&(y=0);const r=[];for(let k=0;k<p.length;k++){const B=qG(t,t._getRowId(p[k],k,M),p[k],k,y,void 0,M==null?void 0:M.id);if(a.flatRows.push(B),a.rowsById[B.id]=B,r.push(B),t.options.getSubRows){var I;B.originalSubRows=t.options.getSubRows(p[k],k),(I=B.originalSubRows)!=null&&I.length&&(B.subRows=c(B.originalSubRows,y+1,B))}}return r};return a.rows=c(e),a},ar(t.options,"debugTable","getRowModel",()=>t._autoResetPageIndex()))}function TH(t){const e=[],a=c=>{var p;e.push(c),(p=c.subRows)!=null&&p.length&&c.getIsExpanded()&&c.subRows.forEach(a)};return t.rows.forEach(a),{rows:e,flatRows:t.flatRows,rowsById:t.rowsById}}function AH(t){return e=>rr(()=>[e.getState().pagination,e.getPrePaginationRowModel(),e.options.paginateExpandedRows?void 0:e.getState().expanded],(a,c)=>{if(!c.rows.length)return c;const{pageSize:p,pageIndex:y}=a;let{rows:M,flatRows:r,rowsById:I}=c;const k=p*y,B=k+p;M=M.slice(k,B);let U;e.options.paginateExpandedRows?U={rows:M,flatRows:r,rowsById:I}:U=TH({rows:M,flatRows:r,rowsById:I}),U.flatRows=[];const H=Y=>{U.flatRows.push(Y),Y.subRows.length&&Y.subRows.forEach(H)};return U.rows.forEach(H),U},ar(e.options,"debugTable"))}function CH(){return t=>rr(()=>[t.getState().sorting,t.getPreSortedRowModel()],(e,a)=>{if(!a.rows.length||!(e!=null&&e.length))return a;const c=t.getState().sorting,p=[],y=c.filter(I=>{var k;return(k=t.getColumn(I.id))==null?void 0:k.getCanSort()}),M={};y.forEach(I=>{const k=t.getColumn(I.id);k&&(M[I.id]={sortUndefined:k.columnDef.sortUndefined,invertSorting:k.columnDef.invertSorting,sortingFn:k.getSortingFn()})});const r=I=>{const k=I.map(B=>({...B}));return k.sort((B,U)=>{for(let Y=0;Y<y.length;Y+=1){var H;const X=y[Y],Q=M[X.id],J=Q.sortUndefined,j=(H=X==null?void 0:X.desc)!=null?H:!1;let oe=0;if(J){const ce=B.getValue(X.id),pe=U.getValue(X.id),Ae=ce===void 0,Ee=pe===void 0;if(Ae||Ee){if(J==="first")return Ae?-1:1;if(J==="last")return Ae?1:-1;oe=Ae&&Ee?0:Ae?J:-J}}if(oe===0&&(oe=Q.sortingFn(B,U,X.id)),oe!==0)return j&&(oe*=-1),Q.invertSorting&&(oe*=-1),oe}return B.index-U.index}),k.forEach(B=>{var U;p.push(B),(U=B.subRows)!=null&&U.length&&(B.subRows=r(B.subRows))}),k};return{rows:r(a.rows),flatRows:p,rowsById:a.rowsById}},ar(t.options,"debugTable","getSortedRowModel",()=>t._autoResetPageIndex()))}/**
   * react-table
   *
   * Copyright (c) TanStack
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE.md file in the root directory of this source tree.
   *
   * @license MIT
   */function JP(t,e){return t?RH(t)?le.createElement(t,e):t:null}function RH(t){return IH(t)||typeof t=="function"||DH(t)}function IH(t){return typeof t=="function"&&(()=>{const e=Object.getPrototypeOf(t);return e.prototype&&e.prototype.isReactComponent})()}function DH(t){return typeof t=="object"&&typeof t.$$typeof=="symbol"&&["react.memo","react.forward_ref"].includes(t.$$typeof.description)}function PH(t){const e={state:{},onStateChange:()=>{},renderFallbackValue:null,...t},[a]=le.useState(()=>({current:EH(e)})),[c,p]=le.useState(()=>a.current.initialState);return a.current.setOptions(y=>({...y,...t,state:{...c,...t.state},onStateChange:M=>{p(M),t.onStateChange==null||t.onStateChange(M)}})),a.current}function LH({className:t,...e}){return se.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:se.jsx("table",{"data-slot":"table",className:yr("w-full caption-bottom text-sm",t),...e})})}function OH({className:t,...e}){return se.jsx("thead",{"data-slot":"table-header",className:yr("[&_tr]:border-b",t),...e})}function zH({className:t,...e}){return se.jsx("tbody",{"data-slot":"table-body",className:yr("[&_tr:last-child]:border-0",t),...e})}function MT({className:t,...e}){return se.jsx("tr",{"data-slot":"table-row",className:yr("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...e})}function kH({className:t,...e}){return se.jsx("th",{"data-slot":"table-head",className:yr("text-muted-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...e})}function QP({className:t,...e}){return se.jsx("td",{"data-slot":"table-cell",className:yr("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...e})}var TT=0;function iR(){le.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??e3()),document.body.insertAdjacentElement("beforeend",t[1]??e3()),TT++,()=>{TT===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),TT--}},[])}function e3(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var AT="focusScope.autoFocusOnMount",CT="focusScope.autoFocusOnUnmount",t3={bubbles:!1,cancelable:!0},FH="FocusScope",bE=le.forwardRef((t,e)=>{const{loop:a=!1,trapped:c=!1,onMountAutoFocus:p,onUnmountAutoFocus:y,...M}=t,[r,I]=le.useState(null),k=Ho(p),B=Ho(y),U=le.useRef(null),H=na(e,Q=>I(Q)),Y=le.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;le.useEffect(()=>{if(c){let Q=function(ce){if(Y.paused||!r)return;const pe=ce.target;r.contains(pe)?U.current=pe:cm(U.current,{select:!0})},J=function(ce){if(Y.paused||!r)return;const pe=ce.relatedTarget;pe!==null&&(r.contains(pe)||cm(U.current,{select:!0}))},j=function(ce){if(document.activeElement===document.body)for(const Ae of ce)Ae.removedNodes.length>0&&cm(r)};document.addEventListener("focusin",Q),document.addEventListener("focusout",J);const oe=new MutationObserver(j);return r&&oe.observe(r,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",Q),document.removeEventListener("focusout",J),oe.disconnect()}}},[c,r,Y.paused]),le.useEffect(()=>{if(r){i3.add(Y);const Q=document.activeElement;if(!r.contains(Q)){const j=new CustomEvent(AT,t3);r.addEventListener(AT,k),r.dispatchEvent(j),j.defaultPrevented||(NH(GH(xz(r)),{select:!0}),document.activeElement===Q&&cm(r))}return()=>{r.removeEventListener(AT,k),setTimeout(()=>{const j=new CustomEvent(CT,t3);r.addEventListener(CT,B),r.dispatchEvent(j),j.defaultPrevented||cm(Q??document.body,{select:!0}),r.removeEventListener(CT,B),i3.remove(Y)},0)}}},[r,k,B,Y]);const X=le.useCallback(Q=>{if(!a&&!c||Y.paused)return;const J=Q.key==="Tab"&&!Q.altKey&&!Q.ctrlKey&&!Q.metaKey,j=document.activeElement;if(J&&j){const oe=Q.currentTarget,[ce,pe]=BH(oe);ce&&pe?!Q.shiftKey&&j===pe?(Q.preventDefault(),a&&cm(ce,{select:!0})):Q.shiftKey&&j===ce&&(Q.preventDefault(),a&&cm(pe,{select:!0})):j===oe&&Q.preventDefault()}},[a,c,Y.paused]);return se.jsx(fr.div,{tabIndex:-1,...M,ref:H,onKeyDown:X})});bE.displayName=FH;function NH(t,{select:e=!1}={}){const a=document.activeElement;for(const c of t)if(cm(c,{select:e}),document.activeElement!==a)return}function BH(t){const e=xz(t),a=n3(e,t),c=n3(e.reverse(),t);return[a,c]}function xz(t){const e=[],a=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:c=>{const p=c.tagName==="INPUT"&&c.type==="hidden";return c.disabled||c.hidden||p?NodeFilter.FILTER_SKIP:c.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;a.nextNode();)e.push(a.currentNode);return e}function n3(t,e){for(const a of t)if(!UH(a,{upTo:e}))return a}function UH(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function VH(t){return t instanceof HTMLInputElement&&"select"in t}function cm(t,{select:e=!1}={}){if(t&&t.focus){const a=document.activeElement;t.focus({preventScroll:!0}),t!==a&&VH(t)&&e&&t.select()}}var i3=jH();function jH(){let t=[];return{add(e){const a=t[0];e!==a&&(a==null||a.pause()),t=r3(t,e),t.unshift(e)},remove(e){var a;t=r3(t,e),(a=t[0])==null||a.resume()}}}function r3(t,e){const a=[...t],c=a.indexOf(e);return c!==-1&&a.splice(c,1),a}function GH(t){return t.filter(e=>e.tagName!=="A")}const HH=["top","right","bottom","left"],Em=Math.min,uc=Math.max,ZS=Math.round,T1=Math.floor,Sd=t=>({x:t,y:t}),qH={left:"right",right:"left",bottom:"top",top:"bottom"},WH={start:"end",end:"start"};function X2(t,e,a){return uc(t,Em(e,a))}function Qf(t,e){return typeof t=="function"?t(e):t}function ep(t){return t.split("-")[0]}function Fy(t){return t.split("-")[1]}function rR(t){return t==="x"?"y":"x"}function aR(t){return t==="y"?"height":"width"}function Mm(t){return["top","bottom"].includes(ep(t))?"y":"x"}function oR(t){return rR(Mm(t))}function $H(t,e,a){a===void 0&&(a=!1);const c=Fy(t),p=oR(t),y=aR(p);let M=p==="x"?c===(a?"end":"start")?"right":"left":c==="start"?"bottom":"top";return e.reference[y]>e.floating[y]&&(M=YS(M)),[M,YS(M)]}function XH(t){const e=YS(t);return[Z2(t),e,Z2(e)]}function Z2(t){return t.replace(/start|end/g,e=>WH[e])}function ZH(t,e,a){const c=["left","right"],p=["right","left"],y=["top","bottom"],M=["bottom","top"];switch(t){case"top":case"bottom":return a?e?p:c:e?c:p;case"left":case"right":return e?y:M;default:return[]}}function YH(t,e,a,c){const p=Fy(t);let y=ZH(ep(t),a==="start",c);return p&&(y=y.map(M=>M+"-"+p),e&&(y=y.concat(y.map(Z2)))),y}function YS(t){return t.replace(/left|right|bottom|top/g,e=>qH[e])}function KH(t){return{top:0,right:0,bottom:0,left:0,...t}}function bz(t){return typeof t!="number"?KH(t):{top:t,right:t,bottom:t,left:t}}function KS(t){const{x:e,y:a,width:c,height:p}=t;return{width:c,height:p,top:a,left:e,right:e+c,bottom:a+p,x:e,y:a}}function a3(t,e,a){let{reference:c,floating:p}=t;const y=Mm(e),M=oR(e),r=aR(M),I=ep(e),k=y==="y",B=c.x+c.width/2-p.width/2,U=c.y+c.height/2-p.height/2,H=c[r]/2-p[r]/2;let Y;switch(I){case"top":Y={x:B,y:c.y-p.height};break;case"bottom":Y={x:B,y:c.y+c.height};break;case"right":Y={x:c.x+c.width,y:U};break;case"left":Y={x:c.x-p.width,y:U};break;default:Y={x:c.x,y:c.y}}switch(Fy(e)){case"start":Y[M]-=H*(a&&k?-1:1);break;case"end":Y[M]+=H*(a&&k?-1:1);break}return Y}const JH=async(t,e,a)=>{const{placement:c="bottom",strategy:p="absolute",middleware:y=[],platform:M}=a,r=y.filter(Boolean),I=await(M.isRTL==null?void 0:M.isRTL(e));let k=await M.getElementRects({reference:t,floating:e,strategy:p}),{x:B,y:U}=a3(k,c,I),H=c,Y={},X=0;for(let Q=0;Q<r.length;Q++){const{name:J,fn:j}=r[Q],{x:oe,y:ce,data:pe,reset:Ae}=await j({x:B,y:U,initialPlacement:c,placement:H,strategy:p,middlewareData:Y,rects:k,platform:M,elements:{reference:t,floating:e}});B=oe??B,U=ce??U,Y={...Y,[J]:{...Y[J],...pe}},Ae&&X<=50&&(X++,typeof Ae=="object"&&(Ae.placement&&(H=Ae.placement),Ae.rects&&(k=Ae.rects===!0?await M.getElementRects({reference:t,floating:e,strategy:p}):Ae.rects),{x:B,y:U}=a3(k,H,I)),Q=-1)}return{x:B,y:U,placement:H,strategy:p,middlewareData:Y}};async function j0(t,e){var a;e===void 0&&(e={});const{x:c,y:p,platform:y,rects:M,elements:r,strategy:I}=t,{boundary:k="clippingAncestors",rootBoundary:B="viewport",elementContext:U="floating",altBoundary:H=!1,padding:Y=0}=Qf(e,t),X=bz(Y),J=r[H?U==="floating"?"reference":"floating":U],j=KS(await y.getClippingRect({element:(a=await(y.isElement==null?void 0:y.isElement(J)))==null||a?J:J.contextElement||await(y.getDocumentElement==null?void 0:y.getDocumentElement(r.floating)),boundary:k,rootBoundary:B,strategy:I})),oe=U==="floating"?{x:c,y:p,width:M.floating.width,height:M.floating.height}:M.reference,ce=await(y.getOffsetParent==null?void 0:y.getOffsetParent(r.floating)),pe=await(y.isElement==null?void 0:y.isElement(ce))?await(y.getScale==null?void 0:y.getScale(ce))||{x:1,y:1}:{x:1,y:1},Ae=KS(y.convertOffsetParentRelativeRectToViewportRelativeRect?await y.convertOffsetParentRelativeRectToViewportRelativeRect({elements:r,rect:oe,offsetParent:ce,strategy:I}):oe);return{top:(j.top-Ae.top+X.top)/pe.y,bottom:(Ae.bottom-j.bottom+X.bottom)/pe.y,left:(j.left-Ae.left+X.left)/pe.x,right:(Ae.right-j.right+X.right)/pe.x}}const QH=t=>({name:"arrow",options:t,async fn(e){const{x:a,y:c,placement:p,rects:y,platform:M,elements:r,middlewareData:I}=e,{element:k,padding:B=0}=Qf(t,e)||{};if(k==null)return{};const U=bz(B),H={x:a,y:c},Y=oR(p),X=aR(Y),Q=await M.getDimensions(k),J=Y==="y",j=J?"top":"left",oe=J?"bottom":"right",ce=J?"clientHeight":"clientWidth",pe=y.reference[X]+y.reference[Y]-H[Y]-y.floating[X],Ae=H[Y]-y.reference[Y],Ee=await(M.getOffsetParent==null?void 0:M.getOffsetParent(k));let be=Ee?Ee[ce]:0;(!be||!await(M.isElement==null?void 0:M.isElement(Ee)))&&(be=r.floating[ce]||y.floating[X]);const Ve=pe/2-Ae/2,Se=be/2-Q[X]/2-1,xe=Em(U[j],Se),Fe=Em(U[oe],Se),Ct=xe,Et=be-Q[X]-Fe,Tt=be/2-Q[X]/2+Ve,_t=X2(Ct,Tt,Et),et=!I.arrow&&Fy(p)!=null&&Tt!==_t&&y.reference[X]/2-(Tt<Ct?xe:Fe)-Q[X]/2<0,Lt=et?Tt<Ct?Tt-Ct:Tt-Et:0;return{[Y]:H[Y]+Lt,data:{[Y]:_t,centerOffset:Tt-_t-Lt,...et&&{alignmentOffset:Lt}},reset:et}}}),e8=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var a,c;const{placement:p,middlewareData:y,rects:M,initialPlacement:r,platform:I,elements:k}=e,{mainAxis:B=!0,crossAxis:U=!0,fallbackPlacements:H,fallbackStrategy:Y="bestFit",fallbackAxisSideDirection:X="none",flipAlignment:Q=!0,...J}=Qf(t,e);if((a=y.arrow)!=null&&a.alignmentOffset)return{};const j=ep(p),oe=Mm(r),ce=ep(r)===r,pe=await(I.isRTL==null?void 0:I.isRTL(k.floating)),Ae=H||(ce||!Q?[YS(r)]:XH(r)),Ee=X!=="none";!H&&Ee&&Ae.push(...YH(r,Q,X,pe));const be=[r,...Ae],Ve=await j0(e,J),Se=[];let xe=((c=y.flip)==null?void 0:c.overflows)||[];if(B&&Se.push(Ve[j]),U){const Tt=$H(p,M,pe);Se.push(Ve[Tt[0]],Ve[Tt[1]])}if(xe=[...xe,{placement:p,overflows:Se}],!Se.every(Tt=>Tt<=0)){var Fe,Ct;const Tt=(((Fe=y.flip)==null?void 0:Fe.index)||0)+1,_t=be[Tt];if(_t)return{data:{index:Tt,overflows:xe},reset:{placement:_t}};let et=(Ct=xe.filter(Lt=>Lt.overflows[0]<=0).sort((Lt,lt)=>Lt.overflows[1]-lt.overflows[1])[0])==null?void 0:Ct.placement;if(!et)switch(Y){case"bestFit":{var Et;const Lt=(Et=xe.filter(lt=>{if(Ee){const ut=Mm(lt.placement);return ut===oe||ut==="y"}return!0}).map(lt=>[lt.placement,lt.overflows.filter(ut=>ut>0).reduce((ut,Xe)=>ut+Xe,0)]).sort((lt,ut)=>lt[1]-ut[1])[0])==null?void 0:Et[0];Lt&&(et=Lt);break}case"initialPlacement":et=r;break}if(p!==et)return{reset:{placement:et}}}return{}}}};function o3(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function s3(t){return HH.some(e=>t[e]>=0)}const t8=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:a}=e,{strategy:c="referenceHidden",...p}=Qf(t,e);switch(c){case"referenceHidden":{const y=await j0(e,{...p,elementContext:"reference"}),M=o3(y,a.reference);return{data:{referenceHiddenOffsets:M,referenceHidden:s3(M)}}}case"escaped":{const y=await j0(e,{...p,altBoundary:!0}),M=o3(y,a.floating);return{data:{escapedOffsets:M,escaped:s3(M)}}}default:return{}}}}};async function n8(t,e){const{placement:a,platform:c,elements:p}=t,y=await(c.isRTL==null?void 0:c.isRTL(p.floating)),M=ep(a),r=Fy(a),I=Mm(a)==="y",k=["left","top"].includes(M)?-1:1,B=y&&I?-1:1,U=Qf(e,t);let{mainAxis:H,crossAxis:Y,alignmentAxis:X}=typeof U=="number"?{mainAxis:U,crossAxis:0,alignmentAxis:null}:{mainAxis:U.mainAxis||0,crossAxis:U.crossAxis||0,alignmentAxis:U.alignmentAxis};return r&&typeof X=="number"&&(Y=r==="end"?X*-1:X),I?{x:Y*B,y:H*k}:{x:H*k,y:Y*B}}const i8=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var a,c;const{x:p,y,placement:M,middlewareData:r}=e,I=await n8(e,t);return M===((a=r.offset)==null?void 0:a.placement)&&(c=r.arrow)!=null&&c.alignmentOffset?{}:{x:p+I.x,y:y+I.y,data:{...I,placement:M}}}}},r8=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:a,y:c,placement:p}=e,{mainAxis:y=!0,crossAxis:M=!1,limiter:r={fn:J=>{let{x:j,y:oe}=J;return{x:j,y:oe}}},...I}=Qf(t,e),k={x:a,y:c},B=await j0(e,I),U=Mm(ep(p)),H=rR(U);let Y=k[H],X=k[U];if(y){const J=H==="y"?"top":"left",j=H==="y"?"bottom":"right",oe=Y+B[J],ce=Y-B[j];Y=X2(oe,Y,ce)}if(M){const J=U==="y"?"top":"left",j=U==="y"?"bottom":"right",oe=X+B[J],ce=X-B[j];X=X2(oe,X,ce)}const Q=r.fn({...e,[H]:Y,[U]:X});return{...Q,data:{x:Q.x-a,y:Q.y-c,enabled:{[H]:y,[U]:M}}}}}},a8=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:a,y:c,placement:p,rects:y,middlewareData:M}=e,{offset:r=0,mainAxis:I=!0,crossAxis:k=!0}=Qf(t,e),B={x:a,y:c},U=Mm(p),H=rR(U);let Y=B[H],X=B[U];const Q=Qf(r,e),J=typeof Q=="number"?{mainAxis:Q,crossAxis:0}:{mainAxis:0,crossAxis:0,...Q};if(I){const ce=H==="y"?"height":"width",pe=y.reference[H]-y.floating[ce]+J.mainAxis,Ae=y.reference[H]+y.reference[ce]-J.mainAxis;Y<pe?Y=pe:Y>Ae&&(Y=Ae)}if(k){var j,oe;const ce=H==="y"?"width":"height",pe=["top","left"].includes(ep(p)),Ae=y.reference[U]-y.floating[ce]+(pe&&((j=M.offset)==null?void 0:j[U])||0)+(pe?0:J.crossAxis),Ee=y.reference[U]+y.reference[ce]+(pe?0:((oe=M.offset)==null?void 0:oe[U])||0)-(pe?J.crossAxis:0);X<Ae?X=Ae:X>Ee&&(X=Ee)}return{[H]:Y,[U]:X}}}},o8=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var a,c;const{placement:p,rects:y,platform:M,elements:r}=e,{apply:I=()=>{},...k}=Qf(t,e),B=await j0(e,k),U=ep(p),H=Fy(p),Y=Mm(p)==="y",{width:X,height:Q}=y.floating;let J,j;U==="top"||U==="bottom"?(J=U,j=H===(await(M.isRTL==null?void 0:M.isRTL(r.floating))?"start":"end")?"left":"right"):(j=U,J=H==="end"?"top":"bottom");const oe=Q-B.top-B.bottom,ce=X-B.left-B.right,pe=Em(Q-B[J],oe),Ae=Em(X-B[j],ce),Ee=!e.middlewareData.shift;let be=pe,Ve=Ae;if((a=e.middlewareData.shift)!=null&&a.enabled.x&&(Ve=ce),(c=e.middlewareData.shift)!=null&&c.enabled.y&&(be=oe),Ee&&!H){const xe=uc(B.left,0),Fe=uc(B.right,0),Ct=uc(B.top,0),Et=uc(B.bottom,0);Y?Ve=X-2*(xe!==0||Fe!==0?xe+Fe:uc(B.left,B.right)):be=Q-2*(Ct!==0||Et!==0?Ct+Et:uc(B.top,B.bottom))}await I({...e,availableWidth:Ve,availableHeight:be});const Se=await M.getDimensions(r.floating);return X!==Se.width||Q!==Se.height?{reset:{rects:!0}}:{}}}};function wE(){return typeof window<"u"}function Ny(t){return wz(t)?(t.nodeName||"").toLowerCase():"#document"}function pc(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Id(t){var e;return(e=(wz(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function wz(t){return wE()?t instanceof Node||t instanceof pc(t).Node:!1}function ph(t){return wE()?t instanceof Element||t instanceof pc(t).Element:!1}function Td(t){return wE()?t instanceof HTMLElement||t instanceof pc(t).HTMLElement:!1}function l3(t){return!wE()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof pc(t).ShadowRoot}function ib(t){const{overflow:e,overflowX:a,overflowY:c,display:p}=mh(t);return/auto|scroll|overlay|hidden|clip/.test(e+c+a)&&!["inline","contents"].includes(p)}function s8(t){return["table","td","th"].includes(Ny(t))}function SE(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function sR(t){const e=lR(),a=ph(t)?mh(t):t;return["transform","translate","scale","rotate","perspective"].some(c=>a[c]?a[c]!=="none":!1)||(a.containerType?a.containerType!=="normal":!1)||!e&&(a.backdropFilter?a.backdropFilter!=="none":!1)||!e&&(a.filter?a.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(c=>(a.willChange||"").includes(c))||["paint","layout","strict","content"].some(c=>(a.contain||"").includes(c))}function l8(t){let e=Tm(t);for(;Td(e)&&!by(e);){if(sR(e))return e;if(SE(e))return null;e=Tm(e)}return null}function lR(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function by(t){return["html","body","#document"].includes(Ny(t))}function mh(t){return pc(t).getComputedStyle(t)}function EE(t){return ph(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Tm(t){if(Ny(t)==="html")return t;const e=t.assignedSlot||t.parentNode||l3(t)&&t.host||Id(t);return l3(e)?e.host:e}function Sz(t){const e=Tm(t);return by(e)?t.ownerDocument?t.ownerDocument.body:t.body:Td(e)&&ib(e)?e:Sz(e)}function G0(t,e,a){var c;e===void 0&&(e=[]),a===void 0&&(a=!0);const p=Sz(t),y=p===((c=t.ownerDocument)==null?void 0:c.body),M=pc(p);if(y){const r=Y2(M);return e.concat(M,M.visualViewport||[],ib(p)?p:[],r&&a?G0(r):[])}return e.concat(p,G0(p,[],a))}function Y2(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function Ez(t){const e=mh(t);let a=parseFloat(e.width)||0,c=parseFloat(e.height)||0;const p=Td(t),y=p?t.offsetWidth:a,M=p?t.offsetHeight:c,r=ZS(a)!==y||ZS(c)!==M;return r&&(a=y,c=M),{width:a,height:c,$:r}}function cR(t){return ph(t)?t:t.contextElement}function py(t){const e=cR(t);if(!Td(e))return Sd(1);const a=e.getBoundingClientRect(),{width:c,height:p,$:y}=Ez(e);let M=(y?ZS(a.width):a.width)/c,r=(y?ZS(a.height):a.height)/p;return(!M||!Number.isFinite(M))&&(M=1),(!r||!Number.isFinite(r))&&(r=1),{x:M,y:r}}const c8=Sd(0);function Mz(t){const e=pc(t);return!lR()||!e.visualViewport?c8:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function u8(t,e,a){return e===void 0&&(e=!1),!a||e&&a!==pc(t)?!1:e}function d_(t,e,a,c){e===void 0&&(e=!1),a===void 0&&(a=!1);const p=t.getBoundingClientRect(),y=cR(t);let M=Sd(1);e&&(c?ph(c)&&(M=py(c)):M=py(t));const r=u8(y,a,c)?Mz(y):Sd(0);let I=(p.left+r.x)/M.x,k=(p.top+r.y)/M.y,B=p.width/M.x,U=p.height/M.y;if(y){const H=pc(y),Y=c&&ph(c)?pc(c):c;let X=H,Q=Y2(X);for(;Q&&c&&Y!==X;){const J=py(Q),j=Q.getBoundingClientRect(),oe=mh(Q),ce=j.left+(Q.clientLeft+parseFloat(oe.paddingLeft))*J.x,pe=j.top+(Q.clientTop+parseFloat(oe.paddingTop))*J.y;I*=J.x,k*=J.y,B*=J.x,U*=J.y,I+=ce,k+=pe,X=pc(Q),Q=Y2(X)}}return KS({width:B,height:U,x:I,y:k})}function uR(t,e){const a=EE(t).scrollLeft;return e?e.left+a:d_(Id(t)).left+a}function Tz(t,e,a){a===void 0&&(a=!1);const c=t.getBoundingClientRect(),p=c.left+e.scrollLeft-(a?0:uR(t,c)),y=c.top+e.scrollTop;return{x:p,y}}function h8(t){let{elements:e,rect:a,offsetParent:c,strategy:p}=t;const y=p==="fixed",M=Id(c),r=e?SE(e.floating):!1;if(c===M||r&&y)return a;let I={scrollLeft:0,scrollTop:0},k=Sd(1);const B=Sd(0),U=Td(c);if((U||!U&&!y)&&((Ny(c)!=="body"||ib(M))&&(I=EE(c)),Td(c))){const Y=d_(c);k=py(c),B.x=Y.x+c.clientLeft,B.y=Y.y+c.clientTop}const H=M&&!U&&!y?Tz(M,I,!0):Sd(0);return{width:a.width*k.x,height:a.height*k.y,x:a.x*k.x-I.scrollLeft*k.x+B.x+H.x,y:a.y*k.y-I.scrollTop*k.y+B.y+H.y}}function d8(t){return Array.from(t.getClientRects())}function f8(t){const e=Id(t),a=EE(t),c=t.ownerDocument.body,p=uc(e.scrollWidth,e.clientWidth,c.scrollWidth,c.clientWidth),y=uc(e.scrollHeight,e.clientHeight,c.scrollHeight,c.clientHeight);let M=-a.scrollLeft+uR(t);const r=-a.scrollTop;return mh(c).direction==="rtl"&&(M+=uc(e.clientWidth,c.clientWidth)-p),{width:p,height:y,x:M,y:r}}function p8(t,e){const a=pc(t),c=Id(t),p=a.visualViewport;let y=c.clientWidth,M=c.clientHeight,r=0,I=0;if(p){y=p.width,M=p.height;const k=lR();(!k||k&&e==="fixed")&&(r=p.offsetLeft,I=p.offsetTop)}return{width:y,height:M,x:r,y:I}}function m8(t,e){const a=d_(t,!0,e==="fixed"),c=a.top+t.clientTop,p=a.left+t.clientLeft,y=Td(t)?py(t):Sd(1),M=t.clientWidth*y.x,r=t.clientHeight*y.y,I=p*y.x,k=c*y.y;return{width:M,height:r,x:I,y:k}}function c3(t,e,a){let c;if(e==="viewport")c=p8(t,a);else if(e==="document")c=f8(Id(t));else if(ph(e))c=m8(e,a);else{const p=Mz(t);c={x:e.x-p.x,y:e.y-p.y,width:e.width,height:e.height}}return KS(c)}function Az(t,e){const a=Tm(t);return a===e||!ph(a)||by(a)?!1:mh(a).position==="fixed"||Az(a,e)}function g8(t,e){const a=e.get(t);if(a)return a;let c=G0(t,[],!1).filter(r=>ph(r)&&Ny(r)!=="body"),p=null;const y=mh(t).position==="fixed";let M=y?Tm(t):t;for(;ph(M)&&!by(M);){const r=mh(M),I=sR(M);!I&&r.position==="fixed"&&(p=null),(y?!I&&!p:!I&&r.position==="static"&&!!p&&["absolute","fixed"].includes(p.position)||ib(M)&&!I&&Az(t,M))?c=c.filter(B=>B!==M):p=r,M=Tm(M)}return e.set(t,c),c}function _8(t){let{element:e,boundary:a,rootBoundary:c,strategy:p}=t;const M=[...a==="clippingAncestors"?SE(e)?[]:g8(e,this._c):[].concat(a),c],r=M[0],I=M.reduce((k,B)=>{const U=c3(e,B,p);return k.top=uc(U.top,k.top),k.right=Em(U.right,k.right),k.bottom=Em(U.bottom,k.bottom),k.left=uc(U.left,k.left),k},c3(e,r,p));return{width:I.right-I.left,height:I.bottom-I.top,x:I.left,y:I.top}}function v8(t){const{width:e,height:a}=Ez(t);return{width:e,height:a}}function y8(t,e,a){const c=Td(e),p=Id(e),y=a==="fixed",M=d_(t,!0,y,e);let r={scrollLeft:0,scrollTop:0};const I=Sd(0);if(c||!c&&!y)if((Ny(e)!=="body"||ib(p))&&(r=EE(e)),c){const H=d_(e,!0,y,e);I.x=H.x+e.clientLeft,I.y=H.y+e.clientTop}else p&&(I.x=uR(p));const k=p&&!c&&!y?Tz(p,r):Sd(0),B=M.left+r.scrollLeft-I.x-k.x,U=M.top+r.scrollTop-I.y-k.y;return{x:B,y:U,width:M.width,height:M.height}}function RT(t){return mh(t).position==="static"}function u3(t,e){if(!Td(t)||mh(t).position==="fixed")return null;if(e)return e(t);let a=t.offsetParent;return Id(t)===a&&(a=a.ownerDocument.body),a}function Cz(t,e){const a=pc(t);if(SE(t))return a;if(!Td(t)){let p=Tm(t);for(;p&&!by(p);){if(ph(p)&&!RT(p))return p;p=Tm(p)}return a}let c=u3(t,e);for(;c&&s8(c)&&RT(c);)c=u3(c,e);return c&&by(c)&&RT(c)&&!sR(c)?a:c||l8(t)||a}const x8=async function(t){const e=this.getOffsetParent||Cz,a=this.getDimensions,c=await a(t.floating);return{reference:y8(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:c.width,height:c.height}}};function b8(t){return mh(t).direction==="rtl"}const w8={convertOffsetParentRelativeRectToViewportRelativeRect:h8,getDocumentElement:Id,getClippingRect:_8,getOffsetParent:Cz,getElementRects:x8,getClientRects:d8,getDimensions:v8,getScale:py,isElement:ph,isRTL:b8};function Rz(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function S8(t,e){let a=null,c;const p=Id(t);function y(){var r;clearTimeout(c),(r=a)==null||r.disconnect(),a=null}function M(r,I){r===void 0&&(r=!1),I===void 0&&(I=1),y();const k=t.getBoundingClientRect(),{left:B,top:U,width:H,height:Y}=k;if(r||e(),!H||!Y)return;const X=T1(U),Q=T1(p.clientWidth-(B+H)),J=T1(p.clientHeight-(U+Y)),j=T1(B),ce={rootMargin:-X+"px "+-Q+"px "+-J+"px "+-j+"px",threshold:uc(0,Em(1,I))||1};let pe=!0;function Ae(Ee){const be=Ee[0].intersectionRatio;if(be!==I){if(!pe)return M();be?M(!1,be):c=setTimeout(()=>{M(!1,1e-7)},1e3)}be===1&&!Rz(k,t.getBoundingClientRect())&&M(),pe=!1}try{a=new IntersectionObserver(Ae,{...ce,root:p.ownerDocument})}catch{a=new IntersectionObserver(Ae,ce)}a.observe(t)}return M(!0),y}function E8(t,e,a,c){c===void 0&&(c={});const{ancestorScroll:p=!0,ancestorResize:y=!0,elementResize:M=typeof ResizeObserver=="function",layoutShift:r=typeof IntersectionObserver=="function",animationFrame:I=!1}=c,k=cR(t),B=p||y?[...k?G0(k):[],...G0(e)]:[];B.forEach(j=>{p&&j.addEventListener("scroll",a,{passive:!0}),y&&j.addEventListener("resize",a)});const U=k&&r?S8(k,a):null;let H=-1,Y=null;M&&(Y=new ResizeObserver(j=>{let[oe]=j;oe&&oe.target===k&&Y&&(Y.unobserve(e),cancelAnimationFrame(H),H=requestAnimationFrame(()=>{var ce;(ce=Y)==null||ce.observe(e)})),a()}),k&&!I&&Y.observe(k),Y.observe(e));let X,Q=I?d_(t):null;I&&J();function J(){const j=d_(t);Q&&!Rz(Q,j)&&a(),Q=j,X=requestAnimationFrame(J)}return a(),()=>{var j;B.forEach(oe=>{p&&oe.removeEventListener("scroll",a),y&&oe.removeEventListener("resize",a)}),U==null||U(),(j=Y)==null||j.disconnect(),Y=null,I&&cancelAnimationFrame(X)}}const M8=i8,T8=r8,A8=e8,C8=o8,R8=t8,h3=QH,I8=a8,D8=(t,e,a)=>{const c=new Map,p={platform:w8,...a},y={...p.platform,_c:c};return JH(t,e,{...p,platform:y})};var iw=typeof document<"u"?le.useLayoutEffect:le.useEffect;function JS(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let a,c,p;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(a=t.length,a!==e.length)return!1;for(c=a;c--!==0;)if(!JS(t[c],e[c]))return!1;return!0}if(p=Object.keys(t),a=p.length,a!==Object.keys(e).length)return!1;for(c=a;c--!==0;)if(!{}.hasOwnProperty.call(e,p[c]))return!1;for(c=a;c--!==0;){const y=p[c];if(!(y==="_owner"&&t.$$typeof)&&!JS(t[y],e[y]))return!1}return!0}return t!==t&&e!==e}function Iz(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function d3(t,e){const a=Iz(t);return Math.round(e*a)/a}function IT(t){const e=le.useRef(t);return iw(()=>{e.current=t}),e}function P8(t){t===void 0&&(t={});const{placement:e="bottom",strategy:a="absolute",middleware:c=[],platform:p,elements:{reference:y,floating:M}={},transform:r=!0,whileElementsMounted:I,open:k}=t,[B,U]=le.useState({x:0,y:0,strategy:a,placement:e,middlewareData:{},isPositioned:!1}),[H,Y]=le.useState(c);JS(H,c)||Y(c);const[X,Q]=le.useState(null),[J,j]=le.useState(null),oe=le.useCallback(lt=>{lt!==Ee.current&&(Ee.current=lt,Q(lt))},[]),ce=le.useCallback(lt=>{lt!==be.current&&(be.current=lt,j(lt))},[]),pe=y||X,Ae=M||J,Ee=le.useRef(null),be=le.useRef(null),Ve=le.useRef(B),Se=I!=null,xe=IT(I),Fe=IT(p),Ct=IT(k),Et=le.useCallback(()=>{if(!Ee.current||!be.current)return;const lt={placement:e,strategy:a,middleware:H};Fe.current&&(lt.platform=Fe.current),D8(Ee.current,be.current,lt).then(ut=>{const Xe={...ut,isPositioned:Ct.current!==!1};Tt.current&&!JS(Ve.current,Xe)&&(Ve.current=Xe,J0.flushSync(()=>{U(Xe)}))})},[H,e,a,Fe,Ct]);iw(()=>{k===!1&&Ve.current.isPositioned&&(Ve.current.isPositioned=!1,U(lt=>({...lt,isPositioned:!1})))},[k]);const Tt=le.useRef(!1);iw(()=>(Tt.current=!0,()=>{Tt.current=!1}),[]),iw(()=>{if(pe&&(Ee.current=pe),Ae&&(be.current=Ae),pe&&Ae){if(xe.current)return xe.current(pe,Ae,Et);Et()}},[pe,Ae,Et,xe,Se]);const _t=le.useMemo(()=>({reference:Ee,floating:be,setReference:oe,setFloating:ce}),[oe,ce]),et=le.useMemo(()=>({reference:pe,floating:Ae}),[pe,Ae]),Lt=le.useMemo(()=>{const lt={position:a,left:0,top:0};if(!et.floating)return lt;const ut=d3(et.floating,B.x),Xe=d3(et.floating,B.y);return r?{...lt,transform:"translate("+ut+"px, "+Xe+"px)",...Iz(et.floating)>=1.5&&{willChange:"transform"}}:{position:a,left:ut,top:Xe}},[a,r,et.floating,B.x,B.y]);return le.useMemo(()=>({...B,update:Et,refs:_t,elements:et,floatingStyles:Lt}),[B,Et,_t,et,Lt])}const L8=t=>{function e(a){return{}.hasOwnProperty.call(a,"current")}return{name:"arrow",options:t,fn(a){const{element:c,padding:p}=typeof t=="function"?t(a):t;return c&&e(c)?c.current!=null?h3({element:c.current,padding:p}).fn(a):{}:c?h3({element:c,padding:p}).fn(a):{}}}},O8=(t,e)=>({...M8(t),options:[t,e]}),z8=(t,e)=>({...T8(t),options:[t,e]}),k8=(t,e)=>({...I8(t),options:[t,e]}),F8=(t,e)=>({...A8(t),options:[t,e]}),N8=(t,e)=>({...C8(t),options:[t,e]}),B8=(t,e)=>({...R8(t),options:[t,e]}),U8=(t,e)=>({...L8(t),options:[t,e]});var V8="Arrow",Dz=le.forwardRef((t,e)=>{const{children:a,width:c=10,height:p=5,...y}=t;return se.jsx(fr.svg,{...y,ref:e,width:c,height:p,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?a:se.jsx("polygon",{points:"0,0 30,0 15,10"})})});Dz.displayName=V8;var j8=Dz;function G8(t){const[e,a]=le.useState(void 0);return ss(()=>{if(t){a({width:t.offsetWidth,height:t.offsetHeight});const c=new ResizeObserver(p=>{if(!Array.isArray(p)||!p.length)return;const y=p[0];let M,r;if("borderBoxSize"in y){const I=y.borderBoxSize,k=Array.isArray(I)?I[0]:I;M=k.inlineSize,r=k.blockSize}else M=t.offsetWidth,r=t.offsetHeight;a({width:M,height:r})});return c.observe(t,{box:"border-box"}),()=>c.unobserve(t)}else a(void 0)},[t]),e}var hR="Popper",[Pz,ME]=Pm(hR),[H8,Lz]=Pz(hR),Oz=t=>{const{__scopePopper:e,children:a}=t,[c,p]=le.useState(null);return se.jsx(H8,{scope:e,anchor:c,onAnchorChange:p,children:a})};Oz.displayName=hR;var zz="PopperAnchor",kz=le.forwardRef((t,e)=>{const{__scopePopper:a,virtualRef:c,...p}=t,y=Lz(zz,a),M=le.useRef(null),r=na(e,M);return le.useEffect(()=>{y.onAnchorChange((c==null?void 0:c.current)||M.current)}),c?null:se.jsx(fr.div,{...p,ref:r})});kz.displayName=zz;var dR="PopperContent",[q8,W8]=Pz(dR),Fz=le.forwardRef((t,e)=>{var $t,pn,jn,Pe,Gn,vn;const{__scopePopper:a,side:c="bottom",sideOffset:p=0,align:y="center",alignOffset:M=0,arrowPadding:r=0,avoidCollisions:I=!0,collisionBoundary:k=[],collisionPadding:B=0,sticky:U="partial",hideWhenDetached:H=!1,updatePositionStrategy:Y="optimized",onPlaced:X,...Q}=t,J=Lz(dR,a),[j,oe]=le.useState(null),ce=na(e,qn=>oe(qn)),[pe,Ae]=le.useState(null),Ee=G8(pe),be=(Ee==null?void 0:Ee.width)??0,Ve=(Ee==null?void 0:Ee.height)??0,Se=c+(y!=="center"?"-"+y:""),xe=typeof B=="number"?B:{top:0,right:0,bottom:0,left:0,...B},Fe=Array.isArray(k)?k:[k],Ct=Fe.length>0,Et={padding:xe,boundary:Fe.filter(X8),altBoundary:Ct},{refs:Tt,floatingStyles:_t,placement:et,isPositioned:Lt,middlewareData:lt}=P8({strategy:"fixed",placement:Se,whileElementsMounted:(...qn)=>E8(...qn,{animationFrame:Y==="always"}),elements:{reference:J.anchor},middleware:[O8({mainAxis:p+Ve,alignmentAxis:M}),I&&z8({mainAxis:!0,crossAxis:!1,limiter:U==="partial"?k8():void 0,...Et}),I&&F8({...Et}),N8({...Et,apply:({elements:qn,rects:ke,availableWidth:Fi,availableHeight:di})=>{const{width:bi,height:Mn}=ke.reference,wi=qn.floating.style;wi.setProperty("--radix-popper-available-width",`${Fi}px`),wi.setProperty("--radix-popper-available-height",`${di}px`),wi.setProperty("--radix-popper-anchor-width",`${bi}px`),wi.setProperty("--radix-popper-anchor-height",`${Mn}px`)}}),pe&&U8({element:pe,padding:r}),Z8({arrowWidth:be,arrowHeight:Ve}),H&&B8({strategy:"referenceHidden",...Et})]}),[ut,Xe]=Uz(et),kt=Ho(X);ss(()=>{Lt&&(kt==null||kt())},[Lt,kt]);const _n=($t=lt.arrow)==null?void 0:$t.x,Xt=(pn=lt.arrow)==null?void 0:pn.y,It=((jn=lt.arrow)==null?void 0:jn.centerOffset)!==0,[ln,fn]=le.useState();return ss(()=>{j&&fn(window.getComputedStyle(j).zIndex)},[j]),se.jsx("div",{ref:Tt.setFloating,"data-radix-popper-content-wrapper":"",style:{..._t,transform:Lt?_t.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ln,"--radix-popper-transform-origin":[(Pe=lt.transformOrigin)==null?void 0:Pe.x,(Gn=lt.transformOrigin)==null?void 0:Gn.y].join(" "),...((vn=lt.hide)==null?void 0:vn.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:se.jsx(q8,{scope:a,placedSide:ut,onArrowChange:Ae,arrowX:_n,arrowY:Xt,shouldHideArrow:It,children:se.jsx(fr.div,{"data-side":ut,"data-align":Xe,...Q,ref:ce,style:{...Q.style,animation:Lt?void 0:"none"}})})})});Fz.displayName=dR;var Nz="PopperArrow",$8={top:"bottom",right:"left",bottom:"top",left:"right"},Bz=le.forwardRef(function(e,a){const{__scopePopper:c,...p}=e,y=W8(Nz,c),M=$8[y.placedSide];return se.jsx("span",{ref:y.onArrowChange,style:{position:"absolute",left:y.arrowX,top:y.arrowY,[M]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[y.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[y.placedSide],visibility:y.shouldHideArrow?"hidden":void 0},children:se.jsx(j8,{...p,ref:a,style:{...p.style,display:"block"}})})});Bz.displayName=Nz;function X8(t){return t!==null}var Z8=t=>({name:"transformOrigin",options:t,fn(e){var J,j,oe;const{placement:a,rects:c,middlewareData:p}=e,M=((J=p.arrow)==null?void 0:J.centerOffset)!==0,r=M?0:t.arrowWidth,I=M?0:t.arrowHeight,[k,B]=Uz(a),U={start:"0%",center:"50%",end:"100%"}[B],H=(((j=p.arrow)==null?void 0:j.x)??0)+r/2,Y=(((oe=p.arrow)==null?void 0:oe.y)??0)+I/2;let X="",Q="";return k==="bottom"?(X=M?U:`${H}px`,Q=`${-I}px`):k==="top"?(X=M?U:`${H}px`,Q=`${c.floating.height+I}px`):k==="right"?(X=`${-I}px`,Q=M?U:`${Y}px`):k==="left"&&(X=`${c.floating.width+I}px`,Q=M?U:`${Y}px`),{data:{x:X,y:Q}}}});function Uz(t){const[e,a="center"]=t.split("-");return[e,a]}var Vz=Oz,jz=kz,Gz=Fz,Hz=Bz,Y8="Portal",TE=le.forwardRef((t,e)=>{var r;const{container:a,...c}=t,[p,y]=le.useState(!1);ss(()=>y(!0),[]);const M=a||p&&((r=globalThis==null?void 0:globalThis.document)==null?void 0:r.body);return M?_O.createPortal(se.jsx(fr.div,{...c,ref:e}),M):null});TE.displayName=Y8;var DT="rovingFocusGroup.onEntryFocus",K8={bubbles:!1,cancelable:!0},AE="RovingFocusGroup",[K2,qz,J8]=eb(AE),[Q8,Wz]=Pm(AE,[J8]),[eq,tq]=Q8(AE),$z=le.forwardRef((t,e)=>se.jsx(K2.Provider,{scope:t.__scopeRovingFocusGroup,children:se.jsx(K2.Slot,{scope:t.__scopeRovingFocusGroup,children:se.jsx(nq,{...t,ref:e})})}));$z.displayName=AE;var nq=le.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:a,orientation:c,loop:p=!1,dir:y,currentTabStopId:M,defaultCurrentTabStopId:r,onCurrentTabStopIdChange:I,onEntryFocus:k,preventScrollOnEntryFocus:B=!1,...U}=t,H=le.useRef(null),Y=na(e,H),X=mE(y),[Q=null,J]=u_({prop:M,defaultProp:r,onChange:I}),[j,oe]=le.useState(!1),ce=Ho(k),pe=qz(a),Ae=le.useRef(!1),[Ee,be]=le.useState(0);return le.useEffect(()=>{const Ve=H.current;if(Ve)return Ve.addEventListener(DT,ce),()=>Ve.removeEventListener(DT,ce)},[ce]),se.jsx(eq,{scope:a,orientation:c,dir:X,loop:p,currentTabStopId:Q,onItemFocus:le.useCallback(Ve=>J(Ve),[J]),onItemShiftTab:le.useCallback(()=>oe(!0),[]),onFocusableItemAdd:le.useCallback(()=>be(Ve=>Ve+1),[]),onFocusableItemRemove:le.useCallback(()=>be(Ve=>Ve-1),[]),children:se.jsx(fr.div,{tabIndex:j||Ee===0?-1:0,"data-orientation":c,...U,ref:Y,style:{outline:"none",...t.style},onMouseDown:xi(t.onMouseDown,()=>{Ae.current=!0}),onFocus:xi(t.onFocus,Ve=>{const Se=!Ae.current;if(Ve.target===Ve.currentTarget&&Se&&!j){const xe=new CustomEvent(DT,K8);if(Ve.currentTarget.dispatchEvent(xe),!xe.defaultPrevented){const Fe=pe().filter(et=>et.focusable),Ct=Fe.find(et=>et.active),Et=Fe.find(et=>et.id===Q),_t=[Ct,Et,...Fe].filter(Boolean).map(et=>et.ref.current);Yz(_t,B)}}Ae.current=!1}),onBlur:xi(t.onBlur,()=>oe(!1))})})}),Xz="RovingFocusGroupItem",Zz=le.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:a,focusable:c=!0,active:p=!1,tabStopId:y,...M}=t,r=sh(),I=y||r,k=tq(Xz,a),B=k.currentTabStopId===I,U=qz(a),{onFocusableItemAdd:H,onFocusableItemRemove:Y}=k;return le.useEffect(()=>{if(c)return H(),()=>Y()},[c,H,Y]),se.jsx(K2.ItemSlot,{scope:a,id:I,focusable:c,active:p,children:se.jsx(fr.span,{tabIndex:B?0:-1,"data-orientation":k.orientation,...M,ref:e,onMouseDown:xi(t.onMouseDown,X=>{c?k.onItemFocus(I):X.preventDefault()}),onFocus:xi(t.onFocus,()=>k.onItemFocus(I)),onKeyDown:xi(t.onKeyDown,X=>{if(X.key==="Tab"&&X.shiftKey){k.onItemShiftTab();return}if(X.target!==X.currentTarget)return;const Q=aq(X,k.orientation,k.dir);if(Q!==void 0){if(X.metaKey||X.ctrlKey||X.altKey||X.shiftKey)return;X.preventDefault();let j=U().filter(oe=>oe.focusable).map(oe=>oe.ref.current);if(Q==="last")j.reverse();else if(Q==="prev"||Q==="next"){Q==="prev"&&j.reverse();const oe=j.indexOf(X.currentTarget);j=k.loop?oq(j,oe+1):j.slice(oe+1)}setTimeout(()=>Yz(j))}})})})});Zz.displayName=Xz;var iq={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function rq(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function aq(t,e,a){const c=rq(t.key,a);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(c))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(c)))return iq[c]}function Yz(t,e=!1){const a=document.activeElement;for(const c of t)if(c===a||(c.focus({preventScroll:e}),document.activeElement!==a))return}function oq(t,e){return t.map((a,c)=>t[(e+c)%t.length])}var sq=$z,lq=Zz,cq=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},Dv=new WeakMap,A1=new WeakMap,C1={},PT=0,Kz=function(t){return t&&(t.host||Kz(t.parentNode))},uq=function(t,e){return e.map(function(a){if(t.contains(a))return a;var c=Kz(a);return c&&t.contains(c)?c:(console.error("aria-hidden",a,"in not contained inside",t,". Doing nothing"),null)}).filter(function(a){return!!a})},hq=function(t,e,a,c){var p=uq(e,Array.isArray(t)?t:[t]);C1[a]||(C1[a]=new WeakMap);var y=C1[a],M=[],r=new Set,I=new Set(p),k=function(U){!U||r.has(U)||(r.add(U),k(U.parentNode))};p.forEach(k);var B=function(U){!U||I.has(U)||Array.prototype.forEach.call(U.children,function(H){if(r.has(H))B(H);else try{var Y=H.getAttribute(c),X=Y!==null&&Y!=="false",Q=(Dv.get(H)||0)+1,J=(y.get(H)||0)+1;Dv.set(H,Q),y.set(H,J),M.push(H),Q===1&&X&&A1.set(H,!0),J===1&&H.setAttribute(a,"true"),X||H.setAttribute(c,"true")}catch(j){console.error("aria-hidden: cannot operate on ",H,j)}})};return B(e),r.clear(),PT++,function(){M.forEach(function(U){var H=Dv.get(U)-1,Y=y.get(U)-1;Dv.set(U,H),y.set(U,Y),H||(A1.has(U)||U.removeAttribute(c),A1.delete(U)),Y||U.removeAttribute(a)}),PT--,PT||(Dv=new WeakMap,Dv=new WeakMap,A1=new WeakMap,C1={})}},fR=function(t,e,a){a===void 0&&(a="data-aria-hidden");var c=Array.from(Array.isArray(t)?t:[t]),p=cq(t);return p?(c.push.apply(c,Array.from(p.querySelectorAll("[aria-live]"))),hq(c,p,a,"aria-hidden")):function(){return null}},rw="right-scroll-bar-position",aw="width-before-scroll-bar",dq="with-scroll-bars-hidden",fq="--removed-body-scroll-bar-size";function LT(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function pq(t,e){var a=le.useState(function(){return{value:t,callback:e,facade:{get current(){return a.value},set current(c){var p=a.value;p!==c&&(a.value=c,a.callback(c,p))}}}})[0];return a.callback=e,a.facade}var mq=typeof window<"u"?le.useLayoutEffect:le.useEffect,f3=new WeakMap;function gq(t,e){var a=pq(null,function(c){return t.forEach(function(p){return LT(p,c)})});return mq(function(){var c=f3.get(a);if(c){var p=new Set(c),y=new Set(t),M=a.current;p.forEach(function(r){y.has(r)||LT(r,null)}),y.forEach(function(r){p.has(r)||LT(r,M)})}f3.set(a,t)},[t]),a}function _q(t){return t}function vq(t,e){e===void 0&&(e=_q);var a=[],c=!1,p={read:function(){if(c)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return a.length?a[a.length-1]:t},useMedium:function(y){var M=e(y,c);return a.push(M),function(){a=a.filter(function(r){return r!==M})}},assignSyncMedium:function(y){for(c=!0;a.length;){var M=a;a=[],M.forEach(y)}a={push:function(r){return y(r)},filter:function(){return a}}},assignMedium:function(y){c=!0;var M=[];if(a.length){var r=a;a=[],r.forEach(y),M=a}var I=function(){var B=M;M=[],B.forEach(y)},k=function(){return Promise.resolve().then(I)};k(),a={push:function(B){M.push(B),k()},filter:function(B){return M=M.filter(B),a}}}};return p}function yq(t){t===void 0&&(t={});var e=vq(null);return e.options=yd({async:!0,ssr:!1},t),e}var Jz=function(t){var e=t.sideCar,a=QO(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var c=e.read();if(!c)throw new Error("Sidecar medium not found");return le.createElement(c,yd({},a))};Jz.isSideCarExport=!0;function xq(t,e){return t.useMedium(e),Jz}var Qz=yq(),OT=function(){},CE=le.forwardRef(function(t,e){var a=le.useRef(null),c=le.useState({onScrollCapture:OT,onWheelCapture:OT,onTouchMoveCapture:OT}),p=c[0],y=c[1],M=t.forwardProps,r=t.children,I=t.className,k=t.removeScrollBar,B=t.enabled,U=t.shards,H=t.sideCar,Y=t.noIsolation,X=t.inert,Q=t.allowPinchZoom,J=t.as,j=J===void 0?"div":J,oe=t.gapMode,ce=QO(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),pe=H,Ae=gq([a,e]),Ee=yd(yd({},ce),p);return le.createElement(le.Fragment,null,B&&le.createElement(pe,{sideCar:Qz,removeScrollBar:k,shards:U,noIsolation:Y,inert:X,setCallbacks:y,allowPinchZoom:!!Q,lockRef:a,gapMode:oe}),M?le.cloneElement(le.Children.only(r),yd(yd({},Ee),{ref:Ae})):le.createElement(j,yd({},Ee,{className:I,ref:Ae}),r))});CE.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};CE.classNames={fullWidth:aw,zeroRight:rw};var bq=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function wq(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=bq();return e&&t.setAttribute("nonce",e),t}function Sq(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function Eq(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var Mq=function(){var t=0,e=null;return{add:function(a){t==0&&(e=wq())&&(Sq(e,a),Eq(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Tq=function(){var t=Mq();return function(e,a){le.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&a])}},ek=function(){var t=Tq(),e=function(a){var c=a.styles,p=a.dynamic;return t(c,p),null};return e},Aq={left:0,top:0,right:0,gap:0},zT=function(t){return parseInt(t||"",10)||0},Cq=function(t){var e=window.getComputedStyle(document.body),a=e[t==="padding"?"paddingLeft":"marginLeft"],c=e[t==="padding"?"paddingTop":"marginTop"],p=e[t==="padding"?"paddingRight":"marginRight"];return[zT(a),zT(c),zT(p)]},Rq=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return Aq;var e=Cq(t),a=document.documentElement.clientWidth,c=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,c-a+e[2]-e[0])}},Iq=ek(),my="data-scroll-locked",Dq=function(t,e,a,c){var p=t.left,y=t.top,M=t.right,r=t.gap;return a===void 0&&(a="margin"),`
  .`.concat(dq,` {
   overflow: hidden `).concat(c,`;
   padding-right: `).concat(r,"px ").concat(c,`;
  }
  body[`).concat(my,`] {
    overflow: hidden `).concat(c,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(c,";"),a==="margin"&&`
    padding-left: `.concat(p,`px;
    padding-top: `).concat(y,`px;
    padding-right: `).concat(M,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(r,"px ").concat(c,`;
    `),a==="padding"&&"padding-right: ".concat(r,"px ").concat(c,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(rw,` {
    right: `).concat(r,"px ").concat(c,`;
  }
  
  .`).concat(aw,` {
    margin-right: `).concat(r,"px ").concat(c,`;
  }
  
  .`).concat(rw," .").concat(rw,` {
    right: 0 `).concat(c,`;
  }
  
  .`).concat(aw," .").concat(aw,` {
    margin-right: 0 `).concat(c,`;
  }
  
  body[`).concat(my,`] {
    `).concat(fq,": ").concat(r,`px;
  }
`)},p3=function(){var t=parseInt(document.body.getAttribute(my)||"0",10);return isFinite(t)?t:0},Pq=function(){le.useEffect(function(){return document.body.setAttribute(my,(p3()+1).toString()),function(){var t=p3()-1;t<=0?document.body.removeAttribute(my):document.body.setAttribute(my,t.toString())}},[])},Lq=function(t){var e=t.noRelative,a=t.noImportant,c=t.gapMode,p=c===void 0?"margin":c;Pq();var y=le.useMemo(function(){return Rq(p)},[p]);return le.createElement(Iq,{styles:Dq(y,!e,p,a?"":"!important")})},J2=!1;if(typeof window<"u")try{var R1=Object.defineProperty({},"passive",{get:function(){return J2=!0,!0}});window.addEventListener("test",R1,R1),window.removeEventListener("test",R1,R1)}catch{J2=!1}var Pv=J2?{passive:!1}:!1,Oq=function(t){return t.tagName==="TEXTAREA"},tk=function(t,e){if(!(t instanceof Element))return!1;var a=window.getComputedStyle(t);return a[e]!=="hidden"&&!(a.overflowY===a.overflowX&&!Oq(t)&&a[e]==="visible")},zq=function(t){return tk(t,"overflowY")},kq=function(t){return tk(t,"overflowX")},m3=function(t,e){var a=e.ownerDocument,c=e;do{typeof ShadowRoot<"u"&&c instanceof ShadowRoot&&(c=c.host);var p=nk(t,c);if(p){var y=ik(t,c),M=y[1],r=y[2];if(M>r)return!0}c=c.parentNode}while(c&&c!==a.body);return!1},Fq=function(t){var e=t.scrollTop,a=t.scrollHeight,c=t.clientHeight;return[e,a,c]},Nq=function(t){var e=t.scrollLeft,a=t.scrollWidth,c=t.clientWidth;return[e,a,c]},nk=function(t,e){return t==="v"?zq(e):kq(e)},ik=function(t,e){return t==="v"?Fq(e):Nq(e)},Bq=function(t,e){return t==="h"&&e==="rtl"?-1:1},Uq=function(t,e,a,c,p){var y=Bq(t,window.getComputedStyle(e).direction),M=y*c,r=a.target,I=e.contains(r),k=!1,B=M>0,U=0,H=0;do{var Y=ik(t,r),X=Y[0],Q=Y[1],J=Y[2],j=Q-J-y*X;(X||j)&&nk(t,r)&&(U+=j,H+=X),r instanceof ShadowRoot?r=r.host:r=r.parentNode}while(!I&&r!==document.body||I&&(e.contains(r)||e===r));return(B&&Math.abs(U)<1||!B&&Math.abs(H)<1)&&(k=!0),k},I1=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},g3=function(t){return[t.deltaX,t.deltaY]},_3=function(t){return t&&"current"in t?t.current:t},Vq=function(t,e){return t[0]===e[0]&&t[1]===e[1]},jq=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},Gq=0,Lv=[];function Hq(t){var e=le.useRef([]),a=le.useRef([0,0]),c=le.useRef(),p=le.useState(Gq++)[0],y=le.useState(ek)[0],M=le.useRef(t);le.useEffect(function(){M.current=t},[t]),le.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(p));var Q=jj([t.lockRef.current],(t.shards||[]).map(_3),!0).filter(Boolean);return Q.forEach(function(J){return J.classList.add("allow-interactivity-".concat(p))}),function(){document.body.classList.remove("block-interactivity-".concat(p)),Q.forEach(function(J){return J.classList.remove("allow-interactivity-".concat(p))})}}},[t.inert,t.lockRef.current,t.shards]);var r=le.useCallback(function(Q,J){if("touches"in Q&&Q.touches.length===2||Q.type==="wheel"&&Q.ctrlKey)return!M.current.allowPinchZoom;var j=I1(Q),oe=a.current,ce="deltaX"in Q?Q.deltaX:oe[0]-j[0],pe="deltaY"in Q?Q.deltaY:oe[1]-j[1],Ae,Ee=Q.target,be=Math.abs(ce)>Math.abs(pe)?"h":"v";if("touches"in Q&&be==="h"&&Ee.type==="range")return!1;var Ve=m3(be,Ee);if(!Ve)return!0;if(Ve?Ae=be:(Ae=be==="v"?"h":"v",Ve=m3(be,Ee)),!Ve)return!1;if(!c.current&&"changedTouches"in Q&&(ce||pe)&&(c.current=Ae),!Ae)return!0;var Se=c.current||Ae;return Uq(Se,J,Q,Se==="h"?ce:pe)},[]),I=le.useCallback(function(Q){var J=Q;if(!(!Lv.length||Lv[Lv.length-1]!==y)){var j="deltaY"in J?g3(J):I1(J),oe=e.current.filter(function(Ae){return Ae.name===J.type&&(Ae.target===J.target||J.target===Ae.shadowParent)&&Vq(Ae.delta,j)})[0];if(oe&&oe.should){J.cancelable&&J.preventDefault();return}if(!oe){var ce=(M.current.shards||[]).map(_3).filter(Boolean).filter(function(Ae){return Ae.contains(J.target)}),pe=ce.length>0?r(J,ce[0]):!M.current.noIsolation;pe&&J.cancelable&&J.preventDefault()}}},[]),k=le.useCallback(function(Q,J,j,oe){var ce={name:Q,delta:J,target:j,should:oe,shadowParent:qq(j)};e.current.push(ce),setTimeout(function(){e.current=e.current.filter(function(pe){return pe!==ce})},1)},[]),B=le.useCallback(function(Q){a.current=I1(Q),c.current=void 0},[]),U=le.useCallback(function(Q){k(Q.type,g3(Q),Q.target,r(Q,t.lockRef.current))},[]),H=le.useCallback(function(Q){k(Q.type,I1(Q),Q.target,r(Q,t.lockRef.current))},[]);le.useEffect(function(){return Lv.push(y),t.setCallbacks({onScrollCapture:U,onWheelCapture:U,onTouchMoveCapture:H}),document.addEventListener("wheel",I,Pv),document.addEventListener("touchmove",I,Pv),document.addEventListener("touchstart",B,Pv),function(){Lv=Lv.filter(function(Q){return Q!==y}),document.removeEventListener("wheel",I,Pv),document.removeEventListener("touchmove",I,Pv),document.removeEventListener("touchstart",B,Pv)}},[]);var Y=t.removeScrollBar,X=t.inert;return le.createElement(le.Fragment,null,X?le.createElement(y,{styles:jq(p)}):null,Y?le.createElement(Lq,{gapMode:t.gapMode}):null)}function qq(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const Wq=xq(Qz,Hq);var RE=le.forwardRef(function(t,e){return le.createElement(CE,yd({},t,{ref:e,sideCar:Wq}))});RE.classNames=CE.classNames;var Q2=["Enter"," "],$q=["ArrowDown","PageUp","Home"],rk=["ArrowUp","PageDown","End"],Xq=[...$q,...rk],Zq={ltr:[...Q2,"ArrowRight"],rtl:[...Q2,"ArrowLeft"]},Yq={ltr:["ArrowLeft"],rtl:["ArrowRight"]},rb="Menu",[H0,Kq,Jq]=eb(rb),[b_,ak]=Pm(rb,[Jq,ME,Wz]),IE=ME(),ok=Wz(),[Qq,w_]=b_(rb),[e7,ab]=b_(rb),sk=t=>{const{__scopeMenu:e,open:a=!1,children:c,dir:p,onOpenChange:y,modal:M=!0}=t,r=IE(e),[I,k]=le.useState(null),B=le.useRef(!1),U=Ho(y),H=mE(p);return le.useEffect(()=>{const Y=()=>{B.current=!0,document.addEventListener("pointerdown",X,{capture:!0,once:!0}),document.addEventListener("pointermove",X,{capture:!0,once:!0})},X=()=>B.current=!1;return document.addEventListener("keydown",Y,{capture:!0}),()=>{document.removeEventListener("keydown",Y,{capture:!0}),document.removeEventListener("pointerdown",X,{capture:!0}),document.removeEventListener("pointermove",X,{capture:!0})}},[]),se.jsx(Vz,{...r,children:se.jsx(Qq,{scope:e,open:a,onOpenChange:U,content:I,onContentChange:k,children:se.jsx(e7,{scope:e,onClose:le.useCallback(()=>U(!1),[U]),isUsingKeyboardRef:B,dir:H,modal:M,children:c})})})};sk.displayName=rb;var t7="MenuAnchor",pR=le.forwardRef((t,e)=>{const{__scopeMenu:a,...c}=t,p=IE(a);return se.jsx(jz,{...p,...c,ref:e})});pR.displayName=t7;var mR="MenuPortal",[n7,lk]=b_(mR,{forceMount:void 0}),ck=t=>{const{__scopeMenu:e,forceMount:a,children:c,container:p}=t,y=w_(mR,e);return se.jsx(n7,{scope:e,forceMount:a,children:se.jsx(mu,{present:a||y.open,children:se.jsx(TE,{asChild:!0,container:p,children:c})})})};ck.displayName=mR;var fu="MenuContent",[i7,gR]=b_(fu),uk=le.forwardRef((t,e)=>{const a=lk(fu,t.__scopeMenu),{forceMount:c=a.forceMount,...p}=t,y=w_(fu,t.__scopeMenu),M=ab(fu,t.__scopeMenu);return se.jsx(H0.Provider,{scope:t.__scopeMenu,children:se.jsx(mu,{present:c||y.open,children:se.jsx(H0.Slot,{scope:t.__scopeMenu,children:M.modal?se.jsx(r7,{...p,ref:e}):se.jsx(a7,{...p,ref:e})})})})}),r7=le.forwardRef((t,e)=>{const a=w_(fu,t.__scopeMenu),c=le.useRef(null),p=na(e,c);return le.useEffect(()=>{const y=c.current;if(y)return fR(y)},[]),se.jsx(_R,{...t,ref:p,trapFocus:a.open,disableOutsidePointerEvents:a.open,disableOutsideScroll:!0,onFocusOutside:xi(t.onFocusOutside,y=>y.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>a.onOpenChange(!1)})}),a7=le.forwardRef((t,e)=>{const a=w_(fu,t.__scopeMenu);return se.jsx(_R,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>a.onOpenChange(!1)})}),_R=le.forwardRef((t,e)=>{const{__scopeMenu:a,loop:c=!1,trapFocus:p,onOpenAutoFocus:y,onCloseAutoFocus:M,disableOutsidePointerEvents:r,onEntryFocus:I,onEscapeKeyDown:k,onPointerDownOutside:B,onFocusOutside:U,onInteractOutside:H,onDismiss:Y,disableOutsideScroll:X,...Q}=t,J=w_(fu,a),j=ab(fu,a),oe=IE(a),ce=ok(a),pe=Kq(a),[Ae,Ee]=le.useState(null),be=le.useRef(null),Ve=na(e,be,J.onContentChange),Se=le.useRef(0),xe=le.useRef(""),Fe=le.useRef(0),Ct=le.useRef(null),Et=le.useRef("right"),Tt=le.useRef(0),_t=X?RE:le.Fragment,et=X?{as:Jf,allowPinchZoom:!0}:void 0,Lt=ut=>{var $t,pn;const Xe=xe.current+ut,kt=pe().filter(jn=>!jn.disabled),_n=document.activeElement,Xt=($t=kt.find(jn=>jn.ref.current===_n))==null?void 0:$t.textValue,It=kt.map(jn=>jn.textValue),ln=_7(It,Xe,Xt),fn=(pn=kt.find(jn=>jn.textValue===ln))==null?void 0:pn.ref.current;(function jn(Pe){xe.current=Pe,window.clearTimeout(Se.current),Pe!==""&&(Se.current=window.setTimeout(()=>jn(""),1e3))})(Xe),fn&&setTimeout(()=>fn.focus())};le.useEffect(()=>()=>window.clearTimeout(Se.current),[]),iR();const lt=le.useCallback(ut=>{var kt,_n;return Et.current===((kt=Ct.current)==null?void 0:kt.side)&&y7(ut,(_n=Ct.current)==null?void 0:_n.area)},[]);return se.jsx(i7,{scope:a,searchRef:xe,onItemEnter:le.useCallback(ut=>{lt(ut)&&ut.preventDefault()},[lt]),onItemLeave:le.useCallback(ut=>{var Xe;lt(ut)||((Xe=be.current)==null||Xe.focus(),Ee(null))},[lt]),onTriggerLeave:le.useCallback(ut=>{lt(ut)&&ut.preventDefault()},[lt]),pointerGraceTimerRef:Fe,onPointerGraceIntentChange:le.useCallback(ut=>{Ct.current=ut},[]),children:se.jsx(_t,{...et,children:se.jsx(bE,{asChild:!0,trapped:p,onMountAutoFocus:xi(y,ut=>{var Xe;ut.preventDefault(),(Xe=be.current)==null||Xe.focus({preventScroll:!0})}),onUnmountAutoFocus:M,children:se.jsx(tb,{asChild:!0,disableOutsidePointerEvents:r,onEscapeKeyDown:k,onPointerDownOutside:B,onFocusOutside:U,onInteractOutside:H,onDismiss:Y,children:se.jsx(sq,{asChild:!0,...ce,dir:j.dir,orientation:"vertical",loop:c,currentTabStopId:Ae,onCurrentTabStopIdChange:Ee,onEntryFocus:xi(I,ut=>{j.isUsingKeyboardRef.current||ut.preventDefault()}),preventScrollOnEntryFocus:!0,children:se.jsx(Gz,{role:"menu","aria-orientation":"vertical","data-state":Tk(J.open),"data-radix-menu-content":"",dir:j.dir,...oe,...Q,ref:Ve,style:{outline:"none",...Q.style},onKeyDown:xi(Q.onKeyDown,ut=>{const kt=ut.target.closest("[data-radix-menu-content]")===ut.currentTarget,_n=ut.ctrlKey||ut.altKey||ut.metaKey,Xt=ut.key.length===1;kt&&(ut.key==="Tab"&&ut.preventDefault(),!_n&&Xt&&Lt(ut.key));const It=be.current;if(ut.target!==It||!Xq.includes(ut.key))return;ut.preventDefault();const fn=pe().filter($t=>!$t.disabled).map($t=>$t.ref.current);rk.includes(ut.key)&&fn.reverse(),m7(fn)}),onBlur:xi(t.onBlur,ut=>{ut.currentTarget.contains(ut.target)||(window.clearTimeout(Se.current),xe.current="")}),onPointerMove:xi(t.onPointerMove,q0(ut=>{const Xe=ut.target,kt=Tt.current!==ut.clientX;if(ut.currentTarget.contains(Xe)&&kt){const _n=ut.clientX>Tt.current?"right":"left";Et.current=_n,Tt.current=ut.clientX}}))})})})})})})});uk.displayName=fu;var o7="MenuGroup",vR=le.forwardRef((t,e)=>{const{__scopeMenu:a,...c}=t;return se.jsx(fr.div,{role:"group",...c,ref:e})});vR.displayName=o7;var s7="MenuLabel",hk=le.forwardRef((t,e)=>{const{__scopeMenu:a,...c}=t;return se.jsx(fr.div,{...c,ref:e})});hk.displayName=s7;var QS="MenuItem",v3="menu.itemSelect",DE=le.forwardRef((t,e)=>{const{disabled:a=!1,onSelect:c,...p}=t,y=le.useRef(null),M=ab(QS,t.__scopeMenu),r=gR(QS,t.__scopeMenu),I=na(e,y),k=le.useRef(!1),B=()=>{const U=y.current;if(!a&&U){const H=new CustomEvent(v3,{bubbles:!0,cancelable:!0});U.addEventListener(v3,Y=>c==null?void 0:c(Y),{once:!0}),jS(U,H),H.defaultPrevented?k.current=!1:M.onClose()}};return se.jsx(dk,{...p,ref:I,disabled:a,onClick:xi(t.onClick,B),onPointerDown:U=>{var H;(H=t.onPointerDown)==null||H.call(t,U),k.current=!0},onPointerUp:xi(t.onPointerUp,U=>{var H;k.current||(H=U.currentTarget)==null||H.click()}),onKeyDown:xi(t.onKeyDown,U=>{const H=r.searchRef.current!=="";a||H&&U.key===" "||Q2.includes(U.key)&&(U.currentTarget.click(),U.preventDefault())})})});DE.displayName=QS;var dk=le.forwardRef((t,e)=>{const{__scopeMenu:a,disabled:c=!1,textValue:p,...y}=t,M=gR(QS,a),r=ok(a),I=le.useRef(null),k=na(e,I),[B,U]=le.useState(!1),[H,Y]=le.useState("");return le.useEffect(()=>{const X=I.current;X&&Y((X.textContent??"").trim())},[y.children]),se.jsx(H0.ItemSlot,{scope:a,disabled:c,textValue:p??H,children:se.jsx(lq,{asChild:!0,...r,focusable:!c,children:se.jsx(fr.div,{role:"menuitem","data-highlighted":B?"":void 0,"aria-disabled":c||void 0,"data-disabled":c?"":void 0,...y,ref:k,onPointerMove:xi(t.onPointerMove,q0(X=>{c?M.onItemLeave(X):(M.onItemEnter(X),X.defaultPrevented||X.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:xi(t.onPointerLeave,q0(X=>M.onItemLeave(X))),onFocus:xi(t.onFocus,()=>U(!0)),onBlur:xi(t.onBlur,()=>U(!1))})})})}),l7="MenuCheckboxItem",fk=le.forwardRef((t,e)=>{const{checked:a=!1,onCheckedChange:c,...p}=t;return se.jsx(vk,{scope:t.__scopeMenu,checked:a,children:se.jsx(DE,{role:"menuitemcheckbox","aria-checked":eE(a)?"mixed":a,...p,ref:e,"data-state":xR(a),onSelect:xi(p.onSelect,()=>c==null?void 0:c(eE(a)?!0:!a),{checkForDefaultPrevented:!1})})})});fk.displayName=l7;var pk="MenuRadioGroup",[c7,u7]=b_(pk,{value:void 0,onValueChange:()=>{}}),mk=le.forwardRef((t,e)=>{const{value:a,onValueChange:c,...p}=t,y=Ho(c);return se.jsx(c7,{scope:t.__scopeMenu,value:a,onValueChange:y,children:se.jsx(vR,{...p,ref:e})})});mk.displayName=pk;var gk="MenuRadioItem",_k=le.forwardRef((t,e)=>{const{value:a,...c}=t,p=u7(gk,t.__scopeMenu),y=a===p.value;return se.jsx(vk,{scope:t.__scopeMenu,checked:y,children:se.jsx(DE,{role:"menuitemradio","aria-checked":y,...c,ref:e,"data-state":xR(y),onSelect:xi(c.onSelect,()=>{var M;return(M=p.onValueChange)==null?void 0:M.call(p,a)},{checkForDefaultPrevented:!1})})})});_k.displayName=gk;var yR="MenuItemIndicator",[vk,h7]=b_(yR,{checked:!1}),yk=le.forwardRef((t,e)=>{const{__scopeMenu:a,forceMount:c,...p}=t,y=h7(yR,a);return se.jsx(mu,{present:c||eE(y.checked)||y.checked===!0,children:se.jsx(fr.span,{...p,ref:e,"data-state":xR(y.checked)})})});yk.displayName=yR;var d7="MenuSeparator",xk=le.forwardRef((t,e)=>{const{__scopeMenu:a,...c}=t;return se.jsx(fr.div,{role:"separator","aria-orientation":"horizontal",...c,ref:e})});xk.displayName=d7;var f7="MenuArrow",bk=le.forwardRef((t,e)=>{const{__scopeMenu:a,...c}=t,p=IE(a);return se.jsx(Hz,{...p,...c,ref:e})});bk.displayName=f7;var p7="MenuSub",[Bte,wk]=b_(p7),r0="MenuSubTrigger",Sk=le.forwardRef((t,e)=>{const a=w_(r0,t.__scopeMenu),c=ab(r0,t.__scopeMenu),p=wk(r0,t.__scopeMenu),y=gR(r0,t.__scopeMenu),M=le.useRef(null),{pointerGraceTimerRef:r,onPointerGraceIntentChange:I}=y,k={__scopeMenu:t.__scopeMenu},B=le.useCallback(()=>{M.current&&window.clearTimeout(M.current),M.current=null},[]);return le.useEffect(()=>B,[B]),le.useEffect(()=>{const U=r.current;return()=>{window.clearTimeout(U),I(null)}},[r,I]),se.jsx(pR,{asChild:!0,...k,children:se.jsx(dk,{id:p.triggerId,"aria-haspopup":"menu","aria-expanded":a.open,"aria-controls":p.contentId,"data-state":Tk(a.open),...t,ref:Q0(e,p.onTriggerChange),onClick:U=>{var H;(H=t.onClick)==null||H.call(t,U),!(t.disabled||U.defaultPrevented)&&(U.currentTarget.focus(),a.open||a.onOpenChange(!0))},onPointerMove:xi(t.onPointerMove,q0(U=>{y.onItemEnter(U),!U.defaultPrevented&&!t.disabled&&!a.open&&!M.current&&(y.onPointerGraceIntentChange(null),M.current=window.setTimeout(()=>{a.onOpenChange(!0),B()},100))})),onPointerLeave:xi(t.onPointerLeave,q0(U=>{var Y,X;B();const H=(Y=a.content)==null?void 0:Y.getBoundingClientRect();if(H){const Q=(X=a.content)==null?void 0:X.dataset.side,J=Q==="right",j=J?-5:5,oe=H[J?"left":"right"],ce=H[J?"right":"left"];y.onPointerGraceIntentChange({area:[{x:U.clientX+j,y:U.clientY},{x:oe,y:H.top},{x:ce,y:H.top},{x:ce,y:H.bottom},{x:oe,y:H.bottom}],side:Q}),window.clearTimeout(r.current),r.current=window.setTimeout(()=>y.onPointerGraceIntentChange(null),300)}else{if(y.onTriggerLeave(U),U.defaultPrevented)return;y.onPointerGraceIntentChange(null)}})),onKeyDown:xi(t.onKeyDown,U=>{var Y;const H=y.searchRef.current!=="";t.disabled||H&&U.key===" "||Zq[c.dir].includes(U.key)&&(a.onOpenChange(!0),(Y=a.content)==null||Y.focus(),U.preventDefault())})})})});Sk.displayName=r0;var Ek="MenuSubContent",Mk=le.forwardRef((t,e)=>{const a=lk(fu,t.__scopeMenu),{forceMount:c=a.forceMount,...p}=t,y=w_(fu,t.__scopeMenu),M=ab(fu,t.__scopeMenu),r=wk(Ek,t.__scopeMenu),I=le.useRef(null),k=na(e,I);return se.jsx(H0.Provider,{scope:t.__scopeMenu,children:se.jsx(mu,{present:c||y.open,children:se.jsx(H0.Slot,{scope:t.__scopeMenu,children:se.jsx(_R,{id:r.contentId,"aria-labelledby":r.triggerId,...p,ref:k,align:"start",side:M.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:B=>{var U;M.isUsingKeyboardRef.current&&((U=I.current)==null||U.focus()),B.preventDefault()},onCloseAutoFocus:B=>B.preventDefault(),onFocusOutside:xi(t.onFocusOutside,B=>{B.target!==r.trigger&&y.onOpenChange(!1)}),onEscapeKeyDown:xi(t.onEscapeKeyDown,B=>{M.onClose(),B.preventDefault()}),onKeyDown:xi(t.onKeyDown,B=>{var Y;const U=B.currentTarget.contains(B.target),H=Yq[M.dir].includes(B.key);U&&H&&(y.onOpenChange(!1),(Y=r.trigger)==null||Y.focus(),B.preventDefault())})})})})})});Mk.displayName=Ek;function Tk(t){return t?"open":"closed"}function eE(t){return t==="indeterminate"}function xR(t){return eE(t)?"indeterminate":t?"checked":"unchecked"}function m7(t){const e=document.activeElement;for(const a of t)if(a===e||(a.focus(),document.activeElement!==e))return}function g7(t,e){return t.map((a,c)=>t[(e+c)%t.length])}function _7(t,e,a){const p=e.length>1&&Array.from(e).every(k=>k===e[0])?e[0]:e,y=a?t.indexOf(a):-1;let M=g7(t,Math.max(y,0));p.length===1&&(M=M.filter(k=>k!==a));const I=M.find(k=>k.toLowerCase().startsWith(p.toLowerCase()));return I!==a?I:void 0}function v7(t,e){const{x:a,y:c}=t;let p=!1;for(let y=0,M=e.length-1;y<e.length;M=y++){const r=e[y].x,I=e[y].y,k=e[M].x,B=e[M].y;I>c!=B>c&&a<(k-r)*(c-I)/(B-I)+r&&(p=!p)}return p}function y7(t,e){if(!e)return!1;const a={x:t.clientX,y:t.clientY};return v7(a,e)}function q0(t){return e=>e.pointerType==="mouse"?t(e):void 0}var x7=sk,b7=pR,w7=ck,S7=uk,E7=vR,M7=hk,T7=DE,A7=fk,C7=mk,R7=_k,I7=yk,D7=xk,P7=bk,L7=Sk,O7=Mk,bR="DropdownMenu",[z7,Ute]=Pm(bR,[ak]),hl=ak(),[k7,Ak]=z7(bR),Ck=t=>{const{__scopeDropdownMenu:e,children:a,dir:c,open:p,defaultOpen:y,onOpenChange:M,modal:r=!0}=t,I=hl(e),k=le.useRef(null),[B=!1,U]=u_({prop:p,defaultProp:y,onChange:M});return se.jsx(k7,{scope:e,triggerId:sh(),triggerRef:k,contentId:sh(),open:B,onOpenChange:U,onOpenToggle:le.useCallback(()=>U(H=>!H),[U]),modal:r,children:se.jsx(x7,{...I,open:B,onOpenChange:U,dir:c,modal:r,children:a})})};Ck.displayName=bR;var Rk="DropdownMenuTrigger",Ik=le.forwardRef((t,e)=>{const{__scopeDropdownMenu:a,disabled:c=!1,...p}=t,y=Ak(Rk,a),M=hl(a);return se.jsx(b7,{asChild:!0,...M,children:se.jsx(fr.button,{type:"button",id:y.triggerId,"aria-haspopup":"menu","aria-expanded":y.open,"aria-controls":y.open?y.contentId:void 0,"data-state":y.open?"open":"closed","data-disabled":c?"":void 0,disabled:c,...p,ref:Q0(e,y.triggerRef),onPointerDown:xi(t.onPointerDown,r=>{!c&&r.button===0&&r.ctrlKey===!1&&(y.onOpenToggle(),y.open||r.preventDefault())}),onKeyDown:xi(t.onKeyDown,r=>{c||(["Enter"," "].includes(r.key)&&y.onOpenToggle(),r.key==="ArrowDown"&&y.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(r.key)&&r.preventDefault())})})})});Ik.displayName=Rk;var F7="DropdownMenuPortal",Dk=t=>{const{__scopeDropdownMenu:e,...a}=t,c=hl(e);return se.jsx(w7,{...c,...a})};Dk.displayName=F7;var Pk="DropdownMenuContent",Lk=le.forwardRef((t,e)=>{const{__scopeDropdownMenu:a,...c}=t,p=Ak(Pk,a),y=hl(a),M=le.useRef(!1);return se.jsx(S7,{id:p.contentId,"aria-labelledby":p.triggerId,...y,...c,ref:e,onCloseAutoFocus:xi(t.onCloseAutoFocus,r=>{var I;M.current||(I=p.triggerRef.current)==null||I.focus(),M.current=!1,r.preventDefault()}),onInteractOutside:xi(t.onInteractOutside,r=>{const I=r.detail.originalEvent,k=I.button===0&&I.ctrlKey===!0,B=I.button===2||k;(!p.modal||B)&&(M.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Lk.displayName=Pk;var N7="DropdownMenuGroup",B7=le.forwardRef((t,e)=>{const{__scopeDropdownMenu:a,...c}=t,p=hl(a);return se.jsx(E7,{...p,...c,ref:e})});B7.displayName=N7;var U7="DropdownMenuLabel",Ok=le.forwardRef((t,e)=>{const{__scopeDropdownMenu:a,...c}=t,p=hl(a);return se.jsx(M7,{...p,...c,ref:e})});Ok.displayName=U7;var V7="DropdownMenuItem",zk=le.forwardRef((t,e)=>{const{__scopeDropdownMenu:a,...c}=t,p=hl(a);return se.jsx(T7,{...p,...c,ref:e})});zk.displayName=V7;var j7="DropdownMenuCheckboxItem",kk=le.forwardRef((t,e)=>{const{__scopeDropdownMenu:a,...c}=t,p=hl(a);return se.jsx(A7,{...p,...c,ref:e})});kk.displayName=j7;var G7="DropdownMenuRadioGroup",H7=le.forwardRef((t,e)=>{const{__scopeDropdownMenu:a,...c}=t,p=hl(a);return se.jsx(C7,{...p,...c,ref:e})});H7.displayName=G7;var q7="DropdownMenuRadioItem",W7=le.forwardRef((t,e)=>{const{__scopeDropdownMenu:a,...c}=t,p=hl(a);return se.jsx(R7,{...p,...c,ref:e})});W7.displayName=q7;var $7="DropdownMenuItemIndicator",Fk=le.forwardRef((t,e)=>{const{__scopeDropdownMenu:a,...c}=t,p=hl(a);return se.jsx(I7,{...p,...c,ref:e})});Fk.displayName=$7;var X7="DropdownMenuSeparator",Nk=le.forwardRef((t,e)=>{const{__scopeDropdownMenu:a,...c}=t,p=hl(a);return se.jsx(D7,{...p,...c,ref:e})});Nk.displayName=X7;var Z7="DropdownMenuArrow",Y7=le.forwardRef((t,e)=>{const{__scopeDropdownMenu:a,...c}=t,p=hl(a);return se.jsx(P7,{...p,...c,ref:e})});Y7.displayName=Z7;var K7="DropdownMenuSubTrigger",J7=le.forwardRef((t,e)=>{const{__scopeDropdownMenu:a,...c}=t,p=hl(a);return se.jsx(L7,{...p,...c,ref:e})});J7.displayName=K7;var Q7="DropdownMenuSubContent",eW=le.forwardRef((t,e)=>{const{__scopeDropdownMenu:a,...c}=t,p=hl(a);return se.jsx(O7,{...p,...c,ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});eW.displayName=Q7;var tW=Ck,nW=Ik,iW=Dk,rW=Lk,aW=Ok,oW=zk,sW=kk,lW=Fk,cW=Nk;function Bk({...t}){return se.jsx(tW,{"data-slot":"dropdown-menu",...t})}function Uk({...t}){return se.jsx(nW,{"data-slot":"dropdown-menu-trigger",...t})}function Vk({className:t,sideOffset:e=4,...a}){return se.jsx(iW,{children:se.jsx(rW,{"data-slot":"dropdown-menu-content",sideOffset:e,className:yr("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...a})})}function uW({className:t,inset:e,variant:a="default",...c}){return se.jsx(oW,{"data-slot":"dropdown-menu-item","data-inset":e,"data-variant":a,className:yr("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive-foreground data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/40 data-[variant=destructive]:focus:text-destructive-foreground data-[variant=destructive]:*:[svg]:!text-destructive-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...c})}function hW({className:t,children:e,checked:a,...c}){return se.jsxs(sW,{"data-slot":"dropdown-menu-checkbox-item",className:yr("focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),checked:a,...c,children:[se.jsx("span",{className:"pointer-events-none absolute left-2 flex size-3.5 items-center justify-center",children:se.jsx(lW,{children:se.jsx(mO,{className:"size-4"})})}),e]})}function dW({className:t,inset:e,...a}){return se.jsx(aW,{"data-slot":"dropdown-menu-label","data-inset":e,className:yr("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",t),...a})}function fW({className:t,...e}){return se.jsx(cW,{"data-slot":"dropdown-menu-separator",className:yr("bg-border -mx-1 my-1 h-px",t),...e})}function pW({table:t}){const e=["components_customer night lights_condition","components_fault indicators_condition","components_guy wires_condition"];return le.useEffect(()=>{e.forEach(a=>{const c=t.getColumn(a);c&&c.toggleVisibility(!1)})},[t]),se.jsxs(Bk,{children:[se.jsx(Uk,{asChild:!0,children:se.jsx(fh,{variant:"outline",className:"ml-auto",children:"Edit Columns"})}),se.jsx(Vk,{align:"end",children:t.getAllColumns().filter(a=>a.getCanHide()).map(a=>se.jsx(hW,{className:"capitalize",checked:a.getIsVisible(),onCheckedChange:c=>a.toggleVisibility(!!c),children:a.id},a.id))})]})}function mW({columns:t,data:e}){var r;const[a,c]=le.useState([]),[p,y]=le.useState({}),M=PH({data:e,columns:t,getCoreRowModel:MH(),getPaginationRowModel:AH(),onSortingChange:c,getSortedRowModel:CH(),onColumnVisibilityChange:y,state:{sorting:a,columnVisibility:p}});return se.jsxs("div",{children:[se.jsx("div",{className:"rounded-md border",children:se.jsxs(LH,{children:[se.jsx(OH,{children:M.getHeaderGroups().map(I=>se.jsx(MT,{children:I.headers.map(k=>se.jsx(kH,{children:k.isPlaceholder?null:JP(k.column.columnDef.header,k.getContext())},k.id))},I.id))}),se.jsx(zH,{children:(r=M.getRowModel().rows)!=null&&r.length?M.getRowModel().rows.map(I=>se.jsx(MT,{"data-state":I.getIsSelected()&&"selected",children:I.getVisibleCells().map(k=>se.jsx(QP,{children:JP(k.column.columnDef.cell,k.getContext())},k.id))},I.id)):se.jsx(MT,{children:se.jsx(QP,{colSpan:t.length,className:"h-24 text-center",children:"No results."})})})]})}),se.jsxs("div",{className:"flex items-center justify-center space-x-2 py-4 ",children:[se.jsx(fh,{variant:"outline",size:"sm",onClick:()=>M.previousPage(),disabled:!M.getCanPreviousPage(),children:"Previous"}),se.jsx(fh,{variant:"outline",size:"sm",onClick:()=>M.nextPage(),disabled:!M.getCanNextPage(),children:"Next"})]}),se.jsx("div",{className:"flex justify-end space-x-2 py-4 m-3",children:se.jsx(pW,{table:M})})]})}var wR="Dialog",[jk,Vte]=Pm(wR),[gW,gh]=jk(wR),Gk=t=>{const{__scopeDialog:e,children:a,open:c,defaultOpen:p,onOpenChange:y,modal:M=!0}=t,r=le.useRef(null),I=le.useRef(null),[k=!1,B]=u_({prop:c,defaultProp:p,onChange:y});return se.jsx(gW,{scope:e,triggerRef:r,contentRef:I,contentId:sh(),titleId:sh(),descriptionId:sh(),open:k,onOpenChange:B,onOpenToggle:le.useCallback(()=>B(U=>!U),[B]),modal:M,children:a})};Gk.displayName=wR;var Hk="DialogTrigger",qk=le.forwardRef((t,e)=>{const{__scopeDialog:a,...c}=t,p=gh(Hk,a),y=na(e,p.triggerRef);return se.jsx(fr.button,{type:"button","aria-haspopup":"dialog","aria-expanded":p.open,"aria-controls":p.contentId,"data-state":MR(p.open),...c,ref:y,onClick:xi(t.onClick,p.onOpenToggle)})});qk.displayName=Hk;var SR="DialogPortal",[_W,Wk]=jk(SR,{forceMount:void 0}),$k=t=>{const{__scopeDialog:e,forceMount:a,children:c,container:p}=t,y=gh(SR,e);return se.jsx(_W,{scope:e,forceMount:a,children:le.Children.map(c,M=>se.jsx(mu,{present:a||y.open,children:se.jsx(TE,{asChild:!0,container:p,children:M})}))})};$k.displayName=SR;var tE="DialogOverlay",Xk=le.forwardRef((t,e)=>{const a=Wk(tE,t.__scopeDialog),{forceMount:c=a.forceMount,...p}=t,y=gh(tE,t.__scopeDialog);return y.modal?se.jsx(mu,{present:c||y.open,children:se.jsx(vW,{...p,ref:e})}):null});Xk.displayName=tE;var vW=le.forwardRef((t,e)=>{const{__scopeDialog:a,...c}=t,p=gh(tE,a);return se.jsx(RE,{as:Jf,allowPinchZoom:!0,shards:[p.contentRef],children:se.jsx(fr.div,{"data-state":MR(p.open),...c,ref:e,style:{pointerEvents:"auto",...c.style}})})}),f_="DialogContent",Zk=le.forwardRef((t,e)=>{const a=Wk(f_,t.__scopeDialog),{forceMount:c=a.forceMount,...p}=t,y=gh(f_,t.__scopeDialog);return se.jsx(mu,{present:c||y.open,children:y.modal?se.jsx(yW,{...p,ref:e}):se.jsx(xW,{...p,ref:e})})});Zk.displayName=f_;var yW=le.forwardRef((t,e)=>{const a=gh(f_,t.__scopeDialog),c=le.useRef(null),p=na(e,a.contentRef,c);return le.useEffect(()=>{const y=c.current;if(y)return fR(y)},[]),se.jsx(Yk,{...t,ref:p,trapFocus:a.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:xi(t.onCloseAutoFocus,y=>{var M;y.preventDefault(),(M=a.triggerRef.current)==null||M.focus()}),onPointerDownOutside:xi(t.onPointerDownOutside,y=>{const M=y.detail.originalEvent,r=M.button===0&&M.ctrlKey===!0;(M.button===2||r)&&y.preventDefault()}),onFocusOutside:xi(t.onFocusOutside,y=>y.preventDefault())})}),xW=le.forwardRef((t,e)=>{const a=gh(f_,t.__scopeDialog),c=le.useRef(!1),p=le.useRef(!1);return se.jsx(Yk,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:y=>{var M,r;(M=t.onCloseAutoFocus)==null||M.call(t,y),y.defaultPrevented||(c.current||(r=a.triggerRef.current)==null||r.focus(),y.preventDefault()),c.current=!1,p.current=!1},onInteractOutside:y=>{var I,k;(I=t.onInteractOutside)==null||I.call(t,y),y.defaultPrevented||(c.current=!0,y.detail.originalEvent.type==="pointerdown"&&(p.current=!0));const M=y.target;((k=a.triggerRef.current)==null?void 0:k.contains(M))&&y.preventDefault(),y.detail.originalEvent.type==="focusin"&&p.current&&y.preventDefault()}})}),Yk=le.forwardRef((t,e)=>{const{__scopeDialog:a,trapFocus:c,onOpenAutoFocus:p,onCloseAutoFocus:y,...M}=t,r=gh(f_,a),I=le.useRef(null),k=na(e,I);return iR(),se.jsxs(se.Fragment,{children:[se.jsx(bE,{asChild:!0,loop:!0,trapped:c,onMountAutoFocus:p,onUnmountAutoFocus:y,children:se.jsx(tb,{role:"dialog",id:r.contentId,"aria-describedby":r.descriptionId,"aria-labelledby":r.titleId,"data-state":MR(r.open),...M,ref:k,onDismiss:()=>r.onOpenChange(!1)})}),se.jsxs(se.Fragment,{children:[se.jsx(bW,{titleId:r.titleId}),se.jsx(SW,{contentRef:I,descriptionId:r.descriptionId})]})]})}),ER="DialogTitle",Kk=le.forwardRef((t,e)=>{const{__scopeDialog:a,...c}=t,p=gh(ER,a);return se.jsx(fr.h2,{id:p.titleId,...c,ref:e})});Kk.displayName=ER;var Jk="DialogDescription",Qk=le.forwardRef((t,e)=>{const{__scopeDialog:a,...c}=t,p=gh(Jk,a);return se.jsx(fr.p,{id:p.descriptionId,...c,ref:e})});Qk.displayName=Jk;var eF="DialogClose",tF=le.forwardRef((t,e)=>{const{__scopeDialog:a,...c}=t,p=gh(eF,a);return se.jsx(fr.button,{type:"button",...c,ref:e,onClick:xi(t.onClick,()=>p.onOpenChange(!1))})});tF.displayName=eF;function MR(t){return t?"open":"closed"}var nF="DialogTitleWarning",[jte,iF]=eV(nF,{contentName:f_,titleName:ER,docsSlug:"dialog"}),bW=({titleId:t})=>{const e=iF(nF),a=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return le.useEffect(()=>{t&&(document.getElementById(t)||console.error(a))},[a,t]),null},wW="DialogDescriptionWarning",SW=({contentRef:t,descriptionId:e})=>{const c=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${iF(wW).contentName}}.`;return le.useEffect(()=>{var y;const p=(y=t.current)==null?void 0:y.getAttribute("aria-describedby");e&&p&&(document.getElementById(e)||console.warn(c))},[c,t,e]),null},EW=Gk,MW=qk,TW=$k,AW=Xk,CW=Zk,RW=Kk,IW=Qk,rF=tF;function aF({...t}){return se.jsx(EW,{"data-slot":"dialog",...t})}function oF({...t}){return se.jsx(MW,{"data-slot":"dialog-trigger",...t})}function DW({...t}){return se.jsx(TW,{"data-slot":"dialog-portal",...t})}function PW({className:t,...e}){return se.jsx(AW,{"data-slot":"dialog-overlay",className:yr("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/80",t),...e})}function LW({className:t,children:e,...a}){return se.jsxs(DW,{"data-slot":"dialog-portal",children:[se.jsx(PW,{}),se.jsxs(CW,{"data-slot":"dialog-content",className:yr("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...a,children:[e,se.jsxs(rF,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[se.jsx(Q5,{}),se.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function OW({className:t,...e}){return se.jsx("div",{"data-slot":"dialog-header",className:yr("flex flex-col gap-2 text-center sm:text-left",t),...e})}function zW({className:t,...e}){return se.jsx("div",{"data-slot":"dialog-footer",className:yr("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...e})}function kW({className:t,...e}){return se.jsx(RW,{"data-slot":"dialog-title",className:yr("text-lg leading-none font-semibold",t),...e})}function FW({className:t,...e}){return se.jsx(IW,{"data-slot":"dialog-description",className:yr("text-muted-foreground text-sm",t),...e})}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const TR="174",NW=0,y3=1,BW=2,sF=1,UW=2,kf=3,Am=0,Ll=1,Gf=2,ym=0,gy=1,x3=2,b3=3,w3=4,VW=5,a_=100,jW=101,GW=102,HW=103,qW=104,WW=200,$W=201,XW=202,ZW=203,eA=204,tA=205,YW=206,KW=207,JW=208,QW=209,e9=210,t9=211,n9=212,i9=213,r9=214,nA=0,iA=1,rA=2,wy=3,aA=4,oA=5,sA=6,lA=7,lF=0,a9=1,o9=2,xm=0,s9=1,l9=2,c9=3,u9=4,h9=5,d9=6,f9=7,cF=300,Sy=301,Ey=302,cA=303,uA=304,PE=306,hA=1e3,s_=1001,dA=1002,uh=1003,p9=1004,D1=1005,bd=1006,kT=1007,l_=1008,tp=1009,uF=1010,hF=1011,W0=1012,AR=1013,p_=1014,Hf=1015,ob=1016,CR=1017,RR=1018,My=1020,dF=35902,fF=1021,pF=1022,oh=1023,mF=1024,gF=1025,_y=1026,Ty=1027,_F=1028,IR=1029,vF=1030,DR=1031,PR=1033,ow=33776,sw=33777,lw=33778,cw=33779,fA=35840,pA=35841,mA=35842,gA=35843,_A=36196,vA=37492,yA=37496,xA=37808,bA=37809,wA=37810,SA=37811,EA=37812,MA=37813,TA=37814,AA=37815,CA=37816,RA=37817,IA=37818,DA=37819,PA=37820,LA=37821,uw=36492,OA=36494,zA=36495,yF=36283,kA=36284,FA=36285,NA=36286,m9=3200,g9=3201,xF=0,_9=1,gm="",uu="srgb",Ay="srgb-linear",nE="linear",ba="srgb",Ov=7680,S3=519,v9=512,y9=513,x9=514,bF=515,b9=516,w9=517,S9=518,E9=519,E3=35044,M3="300 es",qf=2e3,iE=2001;class By{addEventListener(e,a){this._listeners===void 0&&(this._listeners={});const c=this._listeners;c[e]===void 0&&(c[e]=[]),c[e].indexOf(a)===-1&&c[e].push(a)}hasEventListener(e,a){const c=this._listeners;return c===void 0?!1:c[e]!==void 0&&c[e].indexOf(a)!==-1}removeEventListener(e,a){const c=this._listeners;if(c===void 0)return;const p=c[e];if(p!==void 0){const y=p.indexOf(a);y!==-1&&p.splice(y,1)}}dispatchEvent(e){const a=this._listeners;if(a===void 0)return;const c=a[e.type];if(c!==void 0){e.target=this;const p=c.slice(0);for(let y=0,M=p.length;y<M;y++)p[y].call(this,e);e.target=null}}}const js=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],FT=Math.PI/180,BA=180/Math.PI;function sb(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,a=Math.random()*4294967295|0,c=Math.random()*4294967295|0;return(js[t&255]+js[t>>8&255]+js[t>>16&255]+js[t>>24&255]+"-"+js[e&255]+js[e>>8&255]+"-"+js[e>>16&15|64]+js[e>>24&255]+"-"+js[a&63|128]+js[a>>8&255]+"-"+js[a>>16&255]+js[a>>24&255]+js[c&255]+js[c>>8&255]+js[c>>16&255]+js[c>>24&255]).toLowerCase()}function qr(t,e,a){return Math.max(e,Math.min(a,t))}function M9(t,e){return(t%e+e)%e}function NT(t,e,a){return(1-a)*t+a*e}function Yx(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Al(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}class ma{constructor(e=0,a=0){ma.prototype.isVector2=!0,this.x=e,this.y=a}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,a){return this.x=e,this.y=a,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,a){switch(e){case 0:this.x=a;break;case 1:this.y=a;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,a){return this.x=e.x+a.x,this.y=e.y+a.y,this}addScaledVector(e,a){return this.x+=e.x*a,this.y+=e.y*a,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,a){return this.x=e.x-a.x,this.y=e.y-a.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const a=this.x,c=this.y,p=e.elements;return this.x=p[0]*a+p[3]*c+p[6],this.y=p[1]*a+p[4]*c+p[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,a){return this.x=qr(this.x,e.x,a.x),this.y=qr(this.y,e.y,a.y),this}clampScalar(e,a){return this.x=qr(this.x,e,a),this.y=qr(this.y,e,a),this}clampLength(e,a){const c=this.length();return this.divideScalar(c||1).multiplyScalar(qr(c,e,a))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const a=Math.sqrt(this.lengthSq()*e.lengthSq());if(a===0)return Math.PI/2;const c=this.dot(e)/a;return Math.acos(qr(c,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const a=this.x-e.x,c=this.y-e.y;return a*a+c*c}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,a){return this.x+=(e.x-this.x)*a,this.y+=(e.y-this.y)*a,this}lerpVectors(e,a,c){return this.x=e.x+(a.x-e.x)*c,this.y=e.y+(a.y-e.y)*c,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,a=0){return this.x=e[a],this.y=e[a+1],this}toArray(e=[],a=0){return e[a]=this.x,e[a+1]=this.y,e}fromBufferAttribute(e,a){return this.x=e.getX(a),this.y=e.getY(a),this}rotateAround(e,a){const c=Math.cos(a),p=Math.sin(a),y=this.x-e.x,M=this.y-e.y;return this.x=y*c-M*p+e.x,this.y=y*p+M*c+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class wr{constructor(e,a,c,p,y,M,r,I,k){wr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,a,c,p,y,M,r,I,k)}set(e,a,c,p,y,M,r,I,k){const B=this.elements;return B[0]=e,B[1]=p,B[2]=r,B[3]=a,B[4]=y,B[5]=I,B[6]=c,B[7]=M,B[8]=k,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const a=this.elements,c=e.elements;return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[8]=c[8],this}extractBasis(e,a,c){return e.setFromMatrix3Column(this,0),a.setFromMatrix3Column(this,1),c.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const a=e.elements;return this.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,a){const c=e.elements,p=a.elements,y=this.elements,M=c[0],r=c[3],I=c[6],k=c[1],B=c[4],U=c[7],H=c[2],Y=c[5],X=c[8],Q=p[0],J=p[3],j=p[6],oe=p[1],ce=p[4],pe=p[7],Ae=p[2],Ee=p[5],be=p[8];return y[0]=M*Q+r*oe+I*Ae,y[3]=M*J+r*ce+I*Ee,y[6]=M*j+r*pe+I*be,y[1]=k*Q+B*oe+U*Ae,y[4]=k*J+B*ce+U*Ee,y[7]=k*j+B*pe+U*be,y[2]=H*Q+Y*oe+X*Ae,y[5]=H*J+Y*ce+X*Ee,y[8]=H*j+Y*pe+X*be,this}multiplyScalar(e){const a=this.elements;return a[0]*=e,a[3]*=e,a[6]*=e,a[1]*=e,a[4]*=e,a[7]*=e,a[2]*=e,a[5]*=e,a[8]*=e,this}determinant(){const e=this.elements,a=e[0],c=e[1],p=e[2],y=e[3],M=e[4],r=e[5],I=e[6],k=e[7],B=e[8];return a*M*B-a*r*k-c*y*B+c*r*I+p*y*k-p*M*I}invert(){const e=this.elements,a=e[0],c=e[1],p=e[2],y=e[3],M=e[4],r=e[5],I=e[6],k=e[7],B=e[8],U=B*M-r*k,H=r*I-B*y,Y=k*y-M*I,X=a*U+c*H+p*Y;if(X===0)return this.set(0,0,0,0,0,0,0,0,0);const Q=1/X;return e[0]=U*Q,e[1]=(p*k-B*c)*Q,e[2]=(r*c-p*M)*Q,e[3]=H*Q,e[4]=(B*a-p*I)*Q,e[5]=(p*y-r*a)*Q,e[6]=Y*Q,e[7]=(c*I-k*a)*Q,e[8]=(M*a-c*y)*Q,this}transpose(){let e;const a=this.elements;return e=a[1],a[1]=a[3],a[3]=e,e=a[2],a[2]=a[6],a[6]=e,e=a[5],a[5]=a[7],a[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const a=this.elements;return e[0]=a[0],e[1]=a[3],e[2]=a[6],e[3]=a[1],e[4]=a[4],e[5]=a[7],e[6]=a[2],e[7]=a[5],e[8]=a[8],this}setUvTransform(e,a,c,p,y,M,r){const I=Math.cos(y),k=Math.sin(y);return this.set(c*I,c*k,-c*(I*M+k*r)+M+e,-p*k,p*I,-p*(-k*M+I*r)+r+a,0,0,1),this}scale(e,a){return this.premultiply(BT.makeScale(e,a)),this}rotate(e){return this.premultiply(BT.makeRotation(-e)),this}translate(e,a){return this.premultiply(BT.makeTranslation(e,a)),this}makeTranslation(e,a){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,a,0,0,1),this}makeRotation(e){const a=Math.cos(e),c=Math.sin(e);return this.set(a,-c,0,c,a,0,0,0,1),this}makeScale(e,a){return this.set(e,0,0,0,a,0,0,0,1),this}equals(e){const a=this.elements,c=e.elements;for(let p=0;p<9;p++)if(a[p]!==c[p])return!1;return!0}fromArray(e,a=0){for(let c=0;c<9;c++)this.elements[c]=e[c+a];return this}toArray(e=[],a=0){const c=this.elements;return e[a]=c[0],e[a+1]=c[1],e[a+2]=c[2],e[a+3]=c[3],e[a+4]=c[4],e[a+5]=c[5],e[a+6]=c[6],e[a+7]=c[7],e[a+8]=c[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const BT=new wr;function wF(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function $0(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function T9(){const t=$0("canvas");return t.style.display="block",t}const T3={};function Zg(t){t in T3||(T3[t]=!0,console.warn(t))}function A9(t,e,a){return new Promise(function(c,p){function y(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:p();break;case t.TIMEOUT_EXPIRED:setTimeout(y,a);break;default:c()}}setTimeout(y,a)})}function C9(t){const e=t.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function R9(t){const e=t.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const A3=new wr().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),C3=new wr().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function I9(){const t={enabled:!0,workingColorSpace:Ay,spaces:{},convert:function(p,y,M){return this.enabled===!1||y===M||!y||!M||(this.spaces[y].transfer===ba&&(p.r=Xf(p.r),p.g=Xf(p.g),p.b=Xf(p.b)),this.spaces[y].primaries!==this.spaces[M].primaries&&(p.applyMatrix3(this.spaces[y].toXYZ),p.applyMatrix3(this.spaces[M].fromXYZ)),this.spaces[M].transfer===ba&&(p.r=vy(p.r),p.g=vy(p.g),p.b=vy(p.b))),p},fromWorkingColorSpace:function(p,y){return this.convert(p,this.workingColorSpace,y)},toWorkingColorSpace:function(p,y){return this.convert(p,y,this.workingColorSpace)},getPrimaries:function(p){return this.spaces[p].primaries},getTransfer:function(p){return p===gm?nE:this.spaces[p].transfer},getLuminanceCoefficients:function(p,y=this.workingColorSpace){return p.fromArray(this.spaces[y].luminanceCoefficients)},define:function(p){Object.assign(this.spaces,p)},_getMatrix:function(p,y,M){return p.copy(this.spaces[y].toXYZ).multiply(this.spaces[M].fromXYZ)},_getDrawingBufferColorSpace:function(p){return this.spaces[p].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(p=this.workingColorSpace){return this.spaces[p].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],a=[.2126,.7152,.0722],c=[.3127,.329];return t.define({[Ay]:{primaries:e,whitePoint:c,transfer:nE,toXYZ:A3,fromXYZ:C3,luminanceCoefficients:a,workingColorSpaceConfig:{unpackColorSpace:uu},outputColorSpaceConfig:{drawingBufferColorSpace:uu}},[uu]:{primaries:e,whitePoint:c,transfer:ba,toXYZ:A3,fromXYZ:C3,luminanceCoefficients:a,outputColorSpaceConfig:{drawingBufferColorSpace:uu}}}),t}const ta=I9();function Xf(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function vy(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}let zv;class D9{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let a;if(e instanceof HTMLCanvasElement)a=e;else{zv===void 0&&(zv=$0("canvas")),zv.width=e.width,zv.height=e.height;const c=zv.getContext("2d");e instanceof ImageData?c.putImageData(e,0,0):c.drawImage(e,0,0,e.width,e.height),a=zv}return a.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const a=$0("canvas");a.width=e.width,a.height=e.height;const c=a.getContext("2d");c.drawImage(e,0,0,e.width,e.height);const p=c.getImageData(0,0,e.width,e.height),y=p.data;for(let M=0;M<y.length;M++)y[M]=Xf(y[M]/255)*255;return c.putImageData(p,0,0),a}else if(e.data){const a=e.data.slice(0);for(let c=0;c<a.length;c++)a instanceof Uint8Array||a instanceof Uint8ClampedArray?a[c]=Math.floor(Xf(a[c]/255)*255):a[c]=Xf(a[c]);return{data:a,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let P9=0;class LR{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:P9++}),this.uuid=sb(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const a=e===void 0||typeof e=="string";if(!a&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const c={uuid:this.uuid,url:""},p=this.data;if(p!==null){let y;if(Array.isArray(p)){y=[];for(let M=0,r=p.length;M<r;M++)p[M].isDataTexture?y.push(UT(p[M].image)):y.push(UT(p[M]))}else y=UT(p);c.url=y}return a||(e.images[this.uuid]=c),c}}function UT(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?D9.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let L9=0;class ul extends By{constructor(e=ul.DEFAULT_IMAGE,a=ul.DEFAULT_MAPPING,c=s_,p=s_,y=bd,M=l_,r=oh,I=tp,k=ul.DEFAULT_ANISOTROPY,B=gm){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:L9++}),this.uuid=sb(),this.name="",this.source=new LR(e),this.mipmaps=[],this.mapping=a,this.channel=0,this.wrapS=c,this.wrapT=p,this.magFilter=y,this.minFilter=M,this.anisotropy=k,this.format=r,this.internalFormat=null,this.type=I,this.offset=new ma(0,0),this.repeat=new ma(1,1),this.center=new ma(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new wr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=B,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const a=e===void 0||typeof e=="string";if(!a&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const c={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(c.userData=this.userData),a||(e.textures[this.uuid]=c),c}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==cF)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case hA:e.x=e.x-Math.floor(e.x);break;case s_:e.x=e.x<0?0:1;break;case dA:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case hA:e.y=e.y-Math.floor(e.y);break;case s_:e.y=e.y<0?0:1;break;case dA:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}ul.DEFAULT_IMAGE=null;ul.DEFAULT_MAPPING=cF;ul.DEFAULT_ANISOTROPY=1;class Mo{constructor(e=0,a=0,c=0,p=1){Mo.prototype.isVector4=!0,this.x=e,this.y=a,this.z=c,this.w=p}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,a,c,p){return this.x=e,this.y=a,this.z=c,this.w=p,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,a){switch(e){case 0:this.x=a;break;case 1:this.y=a;break;case 2:this.z=a;break;case 3:this.w=a;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,a){return this.x=e.x+a.x,this.y=e.y+a.y,this.z=e.z+a.z,this.w=e.w+a.w,this}addScaledVector(e,a){return this.x+=e.x*a,this.y+=e.y*a,this.z+=e.z*a,this.w+=e.w*a,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,a){return this.x=e.x-a.x,this.y=e.y-a.y,this.z=e.z-a.z,this.w=e.w-a.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const a=this.x,c=this.y,p=this.z,y=this.w,M=e.elements;return this.x=M[0]*a+M[4]*c+M[8]*p+M[12]*y,this.y=M[1]*a+M[5]*c+M[9]*p+M[13]*y,this.z=M[2]*a+M[6]*c+M[10]*p+M[14]*y,this.w=M[3]*a+M[7]*c+M[11]*p+M[15]*y,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const a=Math.sqrt(1-e.w*e.w);return a<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/a,this.y=e.y/a,this.z=e.z/a),this}setAxisAngleFromRotationMatrix(e){let a,c,p,y;const I=e.elements,k=I[0],B=I[4],U=I[8],H=I[1],Y=I[5],X=I[9],Q=I[2],J=I[6],j=I[10];if(Math.abs(B-H)<.01&&Math.abs(U-Q)<.01&&Math.abs(X-J)<.01){if(Math.abs(B+H)<.1&&Math.abs(U+Q)<.1&&Math.abs(X+J)<.1&&Math.abs(k+Y+j-3)<.1)return this.set(1,0,0,0),this;a=Math.PI;const ce=(k+1)/2,pe=(Y+1)/2,Ae=(j+1)/2,Ee=(B+H)/4,be=(U+Q)/4,Ve=(X+J)/4;return ce>pe&&ce>Ae?ce<.01?(c=0,p=.707106781,y=.707106781):(c=Math.sqrt(ce),p=Ee/c,y=be/c):pe>Ae?pe<.01?(c=.707106781,p=0,y=.707106781):(p=Math.sqrt(pe),c=Ee/p,y=Ve/p):Ae<.01?(c=.707106781,p=.707106781,y=0):(y=Math.sqrt(Ae),c=be/y,p=Ve/y),this.set(c,p,y,a),this}let oe=Math.sqrt((J-X)*(J-X)+(U-Q)*(U-Q)+(H-B)*(H-B));return Math.abs(oe)<.001&&(oe=1),this.x=(J-X)/oe,this.y=(U-Q)/oe,this.z=(H-B)/oe,this.w=Math.acos((k+Y+j-1)/2),this}setFromMatrixPosition(e){const a=e.elements;return this.x=a[12],this.y=a[13],this.z=a[14],this.w=a[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,a){return this.x=qr(this.x,e.x,a.x),this.y=qr(this.y,e.y,a.y),this.z=qr(this.z,e.z,a.z),this.w=qr(this.w,e.w,a.w),this}clampScalar(e,a){return this.x=qr(this.x,e,a),this.y=qr(this.y,e,a),this.z=qr(this.z,e,a),this.w=qr(this.w,e,a),this}clampLength(e,a){const c=this.length();return this.divideScalar(c||1).multiplyScalar(qr(c,e,a))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,a){return this.x+=(e.x-this.x)*a,this.y+=(e.y-this.y)*a,this.z+=(e.z-this.z)*a,this.w+=(e.w-this.w)*a,this}lerpVectors(e,a,c){return this.x=e.x+(a.x-e.x)*c,this.y=e.y+(a.y-e.y)*c,this.z=e.z+(a.z-e.z)*c,this.w=e.w+(a.w-e.w)*c,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,a=0){return this.x=e[a],this.y=e[a+1],this.z=e[a+2],this.w=e[a+3],this}toArray(e=[],a=0){return e[a]=this.x,e[a+1]=this.y,e[a+2]=this.z,e[a+3]=this.w,e}fromBufferAttribute(e,a){return this.x=e.getX(a),this.y=e.getY(a),this.z=e.getZ(a),this.w=e.getW(a),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class O9 extends By{constructor(e=1,a=1,c={}){super(),this.isRenderTarget=!0,this.width=e,this.height=a,this.depth=1,this.scissor=new Mo(0,0,e,a),this.scissorTest=!1,this.viewport=new Mo(0,0,e,a);const p={width:e,height:a,depth:1};c=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:bd,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},c);const y=new ul(p,c.mapping,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.colorSpace);y.flipY=!1,y.generateMipmaps=c.generateMipmaps,y.internalFormat=c.internalFormat,this.textures=[];const M=c.count;for(let r=0;r<M;r++)this.textures[r]=y.clone(),this.textures[r].isRenderTargetTexture=!0,this.textures[r].renderTarget=this;this.depthBuffer=c.depthBuffer,this.stencilBuffer=c.stencilBuffer,this.resolveDepthBuffer=c.resolveDepthBuffer,this.resolveStencilBuffer=c.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=c.depthTexture,this.samples=c.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,a,c=1){if(this.width!==e||this.height!==a||this.depth!==c){this.width=e,this.height=a,this.depth=c;for(let p=0,y=this.textures.length;p<y;p++)this.textures[p].image.width=e,this.textures[p].image.height=a,this.textures[p].image.depth=c;this.dispose()}this.viewport.set(0,0,e,a),this.scissor.set(0,0,e,a)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let a=0,c=e.textures.length;a<c;a++){this.textures[a]=e.textures[a].clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;const p=Object.assign({},e.textures[a].image);this.textures[a].source=new LR(p)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class m_ extends O9{constructor(e=1,a=1,c={}){super(e,a,c),this.isWebGLRenderTarget=!0}}class SF extends ul{constructor(e=null,a=1,c=1,p=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:a,height:c,depth:p},this.magFilter=uh,this.minFilter=uh,this.wrapR=s_,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class z9 extends ul{constructor(e=null,a=1,c=1,p=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:a,height:c,depth:p},this.magFilter=uh,this.minFilter=uh,this.wrapR=s_,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class lb{constructor(e=0,a=0,c=0,p=1){this.isQuaternion=!0,this._x=e,this._y=a,this._z=c,this._w=p}static slerpFlat(e,a,c,p,y,M,r){let I=c[p+0],k=c[p+1],B=c[p+2],U=c[p+3];const H=y[M+0],Y=y[M+1],X=y[M+2],Q=y[M+3];if(r===0){e[a+0]=I,e[a+1]=k,e[a+2]=B,e[a+3]=U;return}if(r===1){e[a+0]=H,e[a+1]=Y,e[a+2]=X,e[a+3]=Q;return}if(U!==Q||I!==H||k!==Y||B!==X){let J=1-r;const j=I*H+k*Y+B*X+U*Q,oe=j>=0?1:-1,ce=1-j*j;if(ce>Number.EPSILON){const Ae=Math.sqrt(ce),Ee=Math.atan2(Ae,j*oe);J=Math.sin(J*Ee)/Ae,r=Math.sin(r*Ee)/Ae}const pe=r*oe;if(I=I*J+H*pe,k=k*J+Y*pe,B=B*J+X*pe,U=U*J+Q*pe,J===1-r){const Ae=1/Math.sqrt(I*I+k*k+B*B+U*U);I*=Ae,k*=Ae,B*=Ae,U*=Ae}}e[a]=I,e[a+1]=k,e[a+2]=B,e[a+3]=U}static multiplyQuaternionsFlat(e,a,c,p,y,M){const r=c[p],I=c[p+1],k=c[p+2],B=c[p+3],U=y[M],H=y[M+1],Y=y[M+2],X=y[M+3];return e[a]=r*X+B*U+I*Y-k*H,e[a+1]=I*X+B*H+k*U-r*Y,e[a+2]=k*X+B*Y+r*H-I*U,e[a+3]=B*X-r*U-I*H-k*Y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,a,c,p){return this._x=e,this._y=a,this._z=c,this._w=p,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,a=!0){const c=e._x,p=e._y,y=e._z,M=e._order,r=Math.cos,I=Math.sin,k=r(c/2),B=r(p/2),U=r(y/2),H=I(c/2),Y=I(p/2),X=I(y/2);switch(M){case"XYZ":this._x=H*B*U+k*Y*X,this._y=k*Y*U-H*B*X,this._z=k*B*X+H*Y*U,this._w=k*B*U-H*Y*X;break;case"YXZ":this._x=H*B*U+k*Y*X,this._y=k*Y*U-H*B*X,this._z=k*B*X-H*Y*U,this._w=k*B*U+H*Y*X;break;case"ZXY":this._x=H*B*U-k*Y*X,this._y=k*Y*U+H*B*X,this._z=k*B*X+H*Y*U,this._w=k*B*U-H*Y*X;break;case"ZYX":this._x=H*B*U-k*Y*X,this._y=k*Y*U+H*B*X,this._z=k*B*X-H*Y*U,this._w=k*B*U+H*Y*X;break;case"YZX":this._x=H*B*U+k*Y*X,this._y=k*Y*U+H*B*X,this._z=k*B*X-H*Y*U,this._w=k*B*U-H*Y*X;break;case"XZY":this._x=H*B*U-k*Y*X,this._y=k*Y*U-H*B*X,this._z=k*B*X+H*Y*U,this._w=k*B*U+H*Y*X;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+M)}return a===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,a){const c=a/2,p=Math.sin(c);return this._x=e.x*p,this._y=e.y*p,this._z=e.z*p,this._w=Math.cos(c),this._onChangeCallback(),this}setFromRotationMatrix(e){const a=e.elements,c=a[0],p=a[4],y=a[8],M=a[1],r=a[5],I=a[9],k=a[2],B=a[6],U=a[10],H=c+r+U;if(H>0){const Y=.5/Math.sqrt(H+1);this._w=.25/Y,this._x=(B-I)*Y,this._y=(y-k)*Y,this._z=(M-p)*Y}else if(c>r&&c>U){const Y=2*Math.sqrt(1+c-r-U);this._w=(B-I)/Y,this._x=.25*Y,this._y=(p+M)/Y,this._z=(y+k)/Y}else if(r>U){const Y=2*Math.sqrt(1+r-c-U);this._w=(y-k)/Y,this._x=(p+M)/Y,this._y=.25*Y,this._z=(I+B)/Y}else{const Y=2*Math.sqrt(1+U-c-r);this._w=(M-p)/Y,this._x=(y+k)/Y,this._y=(I+B)/Y,this._z=.25*Y}return this._onChangeCallback(),this}setFromUnitVectors(e,a){let c=e.dot(a)+1;return c<Number.EPSILON?(c=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=c):(this._x=0,this._y=-e.z,this._z=e.y,this._w=c)):(this._x=e.y*a.z-e.z*a.y,this._y=e.z*a.x-e.x*a.z,this._z=e.x*a.y-e.y*a.x,this._w=c),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(qr(this.dot(e),-1,1)))}rotateTowards(e,a){const c=this.angleTo(e);if(c===0)return this;const p=Math.min(1,a/c);return this.slerp(e,p),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,a){const c=e._x,p=e._y,y=e._z,M=e._w,r=a._x,I=a._y,k=a._z,B=a._w;return this._x=c*B+M*r+p*k-y*I,this._y=p*B+M*I+y*r-c*k,this._z=y*B+M*k+c*I-p*r,this._w=M*B-c*r-p*I-y*k,this._onChangeCallback(),this}slerp(e,a){if(a===0)return this;if(a===1)return this.copy(e);const c=this._x,p=this._y,y=this._z,M=this._w;let r=M*e._w+c*e._x+p*e._y+y*e._z;if(r<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,r=-r):this.copy(e),r>=1)return this._w=M,this._x=c,this._y=p,this._z=y,this;const I=1-r*r;if(I<=Number.EPSILON){const Y=1-a;return this._w=Y*M+a*this._w,this._x=Y*c+a*this._x,this._y=Y*p+a*this._y,this._z=Y*y+a*this._z,this.normalize(),this}const k=Math.sqrt(I),B=Math.atan2(k,r),U=Math.sin((1-a)*B)/k,H=Math.sin(a*B)/k;return this._w=M*U+this._w*H,this._x=c*U+this._x*H,this._y=p*U+this._y*H,this._z=y*U+this._z*H,this._onChangeCallback(),this}slerpQuaternions(e,a,c){return this.copy(e).slerp(a,c)}random(){const e=2*Math.PI*Math.random(),a=2*Math.PI*Math.random(),c=Math.random(),p=Math.sqrt(1-c),y=Math.sqrt(c);return this.set(p*Math.sin(e),p*Math.cos(e),y*Math.sin(a),y*Math.cos(a))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,a=0){return this._x=e[a],this._y=e[a+1],this._z=e[a+2],this._w=e[a+3],this._onChangeCallback(),this}toArray(e=[],a=0){return e[a]=this._x,e[a+1]=this._y,e[a+2]=this._z,e[a+3]=this._w,e}fromBufferAttribute(e,a){return this._x=e.getX(a),this._y=e.getY(a),this._z=e.getZ(a),this._w=e.getW(a),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class un{constructor(e=0,a=0,c=0){un.prototype.isVector3=!0,this.x=e,this.y=a,this.z=c}set(e,a,c){return c===void 0&&(c=this.z),this.x=e,this.y=a,this.z=c,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,a){switch(e){case 0:this.x=a;break;case 1:this.y=a;break;case 2:this.z=a;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,a){return this.x=e.x+a.x,this.y=e.y+a.y,this.z=e.z+a.z,this}addScaledVector(e,a){return this.x+=e.x*a,this.y+=e.y*a,this.z+=e.z*a,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,a){return this.x=e.x-a.x,this.y=e.y-a.y,this.z=e.z-a.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,a){return this.x=e.x*a.x,this.y=e.y*a.y,this.z=e.z*a.z,this}applyEuler(e){return this.applyQuaternion(R3.setFromEuler(e))}applyAxisAngle(e,a){return this.applyQuaternion(R3.setFromAxisAngle(e,a))}applyMatrix3(e){const a=this.x,c=this.y,p=this.z,y=e.elements;return this.x=y[0]*a+y[3]*c+y[6]*p,this.y=y[1]*a+y[4]*c+y[7]*p,this.z=y[2]*a+y[5]*c+y[8]*p,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const a=this.x,c=this.y,p=this.z,y=e.elements,M=1/(y[3]*a+y[7]*c+y[11]*p+y[15]);return this.x=(y[0]*a+y[4]*c+y[8]*p+y[12])*M,this.y=(y[1]*a+y[5]*c+y[9]*p+y[13])*M,this.z=(y[2]*a+y[6]*c+y[10]*p+y[14])*M,this}applyQuaternion(e){const a=this.x,c=this.y,p=this.z,y=e.x,M=e.y,r=e.z,I=e.w,k=2*(M*p-r*c),B=2*(r*a-y*p),U=2*(y*c-M*a);return this.x=a+I*k+M*U-r*B,this.y=c+I*B+r*k-y*U,this.z=p+I*U+y*B-M*k,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const a=this.x,c=this.y,p=this.z,y=e.elements;return this.x=y[0]*a+y[4]*c+y[8]*p,this.y=y[1]*a+y[5]*c+y[9]*p,this.z=y[2]*a+y[6]*c+y[10]*p,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,a){return this.x=qr(this.x,e.x,a.x),this.y=qr(this.y,e.y,a.y),this.z=qr(this.z,e.z,a.z),this}clampScalar(e,a){return this.x=qr(this.x,e,a),this.y=qr(this.y,e,a),this.z=qr(this.z,e,a),this}clampLength(e,a){const c=this.length();return this.divideScalar(c||1).multiplyScalar(qr(c,e,a))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,a){return this.x+=(e.x-this.x)*a,this.y+=(e.y-this.y)*a,this.z+=(e.z-this.z)*a,this}lerpVectors(e,a,c){return this.x=e.x+(a.x-e.x)*c,this.y=e.y+(a.y-e.y)*c,this.z=e.z+(a.z-e.z)*c,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,a){const c=e.x,p=e.y,y=e.z,M=a.x,r=a.y,I=a.z;return this.x=p*I-y*r,this.y=y*M-c*I,this.z=c*r-p*M,this}projectOnVector(e){const a=e.lengthSq();if(a===0)return this.set(0,0,0);const c=e.dot(this)/a;return this.copy(e).multiplyScalar(c)}projectOnPlane(e){return VT.copy(this).projectOnVector(e),this.sub(VT)}reflect(e){return this.sub(VT.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const a=Math.sqrt(this.lengthSq()*e.lengthSq());if(a===0)return Math.PI/2;const c=this.dot(e)/a;return Math.acos(qr(c,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const a=this.x-e.x,c=this.y-e.y,p=this.z-e.z;return a*a+c*c+p*p}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,a,c){const p=Math.sin(a)*e;return this.x=p*Math.sin(c),this.y=Math.cos(a)*e,this.z=p*Math.cos(c),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,a,c){return this.x=e*Math.sin(a),this.y=c,this.z=e*Math.cos(a),this}setFromMatrixPosition(e){const a=e.elements;return this.x=a[12],this.y=a[13],this.z=a[14],this}setFromMatrixScale(e){const a=this.setFromMatrixColumn(e,0).length(),c=this.setFromMatrixColumn(e,1).length(),p=this.setFromMatrixColumn(e,2).length();return this.x=a,this.y=c,this.z=p,this}setFromMatrixColumn(e,a){return this.fromArray(e.elements,a*4)}setFromMatrix3Column(e,a){return this.fromArray(e.elements,a*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,a=0){return this.x=e[a],this.y=e[a+1],this.z=e[a+2],this}toArray(e=[],a=0){return e[a]=this.x,e[a+1]=this.y,e[a+2]=this.z,e}fromBufferAttribute(e,a){return this.x=e.getX(a),this.y=e.getY(a),this.z=e.getZ(a),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,a=Math.random()*2-1,c=Math.sqrt(1-a*a);return this.x=c*Math.cos(e),this.y=a,this.z=c*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const VT=new un,R3=new lb;class cb{constructor(e=new un(1/0,1/0,1/0),a=new un(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=a}set(e,a){return this.min.copy(e),this.max.copy(a),this}setFromArray(e){this.makeEmpty();for(let a=0,c=e.length;a<c;a+=3)this.expandByPoint(Ju.fromArray(e,a));return this}setFromBufferAttribute(e){this.makeEmpty();for(let a=0,c=e.count;a<c;a++)this.expandByPoint(Ju.fromBufferAttribute(e,a));return this}setFromPoints(e){this.makeEmpty();for(let a=0,c=e.length;a<c;a++)this.expandByPoint(e[a]);return this}setFromCenterAndSize(e,a){const c=Ju.copy(a).multiplyScalar(.5);return this.min.copy(e).sub(c),this.max.copy(e).add(c),this}setFromObject(e,a=!1){return this.makeEmpty(),this.expandByObject(e,a)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,a=!1){e.updateWorldMatrix(!1,!1);const c=e.geometry;if(c!==void 0){const y=c.getAttribute("position");if(a===!0&&y!==void 0&&e.isInstancedMesh!==!0)for(let M=0,r=y.count;M<r;M++)e.isMesh===!0?e.getVertexPosition(M,Ju):Ju.fromBufferAttribute(y,M),Ju.applyMatrix4(e.matrixWorld),this.expandByPoint(Ju);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),P1.copy(e.boundingBox)):(c.boundingBox===null&&c.computeBoundingBox(),P1.copy(c.boundingBox)),P1.applyMatrix4(e.matrixWorld),this.union(P1)}const p=e.children;for(let y=0,M=p.length;y<M;y++)this.expandByObject(p[y],a);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,a){return a.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Ju),Ju.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let a,c;return e.normal.x>0?(a=e.normal.x*this.min.x,c=e.normal.x*this.max.x):(a=e.normal.x*this.max.x,c=e.normal.x*this.min.x),e.normal.y>0?(a+=e.normal.y*this.min.y,c+=e.normal.y*this.max.y):(a+=e.normal.y*this.max.y,c+=e.normal.y*this.min.y),e.normal.z>0?(a+=e.normal.z*this.min.z,c+=e.normal.z*this.max.z):(a+=e.normal.z*this.max.z,c+=e.normal.z*this.min.z),a<=-e.constant&&c>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Kx),L1.subVectors(this.max,Kx),kv.subVectors(e.a,Kx),Fv.subVectors(e.b,Kx),Nv.subVectors(e.c,Kx),im.subVectors(Fv,kv),rm.subVectors(Nv,Fv),Gg.subVectors(kv,Nv);let a=[0,-im.z,im.y,0,-rm.z,rm.y,0,-Gg.z,Gg.y,im.z,0,-im.x,rm.z,0,-rm.x,Gg.z,0,-Gg.x,-im.y,im.x,0,-rm.y,rm.x,0,-Gg.y,Gg.x,0];return!jT(a,kv,Fv,Nv,L1)||(a=[1,0,0,0,1,0,0,0,1],!jT(a,kv,Fv,Nv,L1))?!1:(O1.crossVectors(im,rm),a=[O1.x,O1.y,O1.z],jT(a,kv,Fv,Nv,L1))}clampPoint(e,a){return a.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ju).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Ju).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Df[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Df[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Df[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Df[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Df[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Df[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Df[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Df[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Df),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Df=[new un,new un,new un,new un,new un,new un,new un,new un],Ju=new un,P1=new cb,kv=new un,Fv=new un,Nv=new un,im=new un,rm=new un,Gg=new un,Kx=new un,L1=new un,O1=new un,Hg=new un;function jT(t,e,a,c,p){for(let y=0,M=t.length-3;y<=M;y+=3){Hg.fromArray(t,y);const r=p.x*Math.abs(Hg.x)+p.y*Math.abs(Hg.y)+p.z*Math.abs(Hg.z),I=e.dot(Hg),k=a.dot(Hg),B=c.dot(Hg);if(Math.max(-Math.max(I,k,B),Math.min(I,k,B))>r)return!1}return!0}const k9=new cb,Jx=new un,GT=new un;class OR{constructor(e=new un,a=-1){this.isSphere=!0,this.center=e,this.radius=a}set(e,a){return this.center.copy(e),this.radius=a,this}setFromPoints(e,a){const c=this.center;a!==void 0?c.copy(a):k9.setFromPoints(e).getCenter(c);let p=0;for(let y=0,M=e.length;y<M;y++)p=Math.max(p,c.distanceToSquared(e[y]));return this.radius=Math.sqrt(p),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const a=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=a*a}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,a){const c=this.center.distanceToSquared(e);return a.copy(e),c>this.radius*this.radius&&(a.sub(this.center).normalize(),a.multiplyScalar(this.radius).add(this.center)),a}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Jx.subVectors(e,this.center);const a=Jx.lengthSq();if(a>this.radius*this.radius){const c=Math.sqrt(a),p=(c-this.radius)*.5;this.center.addScaledVector(Jx,p/c),this.radius+=p}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(GT.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Jx.copy(e.center).add(GT)),this.expandByPoint(Jx.copy(e.center).sub(GT))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Pf=new un,HT=new un,z1=new un,am=new un,qT=new un,k1=new un,WT=new un;class F9{constructor(e=new un,a=new un(0,0,-1)){this.origin=e,this.direction=a}set(e,a){return this.origin.copy(e),this.direction.copy(a),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,a){return a.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Pf)),this}closestPointToPoint(e,a){a.subVectors(e,this.origin);const c=a.dot(this.direction);return c<0?a.copy(this.origin):a.copy(this.origin).addScaledVector(this.direction,c)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const a=Pf.subVectors(e,this.origin).dot(this.direction);return a<0?this.origin.distanceToSquared(e):(Pf.copy(this.origin).addScaledVector(this.direction,a),Pf.distanceToSquared(e))}distanceSqToSegment(e,a,c,p){HT.copy(e).add(a).multiplyScalar(.5),z1.copy(a).sub(e).normalize(),am.copy(this.origin).sub(HT);const y=e.distanceTo(a)*.5,M=-this.direction.dot(z1),r=am.dot(this.direction),I=-am.dot(z1),k=am.lengthSq(),B=Math.abs(1-M*M);let U,H,Y,X;if(B>0)if(U=M*I-r,H=M*r-I,X=y*B,U>=0)if(H>=-X)if(H<=X){const Q=1/B;U*=Q,H*=Q,Y=U*(U+M*H+2*r)+H*(M*U+H+2*I)+k}else H=y,U=Math.max(0,-(M*H+r)),Y=-U*U+H*(H+2*I)+k;else H=-y,U=Math.max(0,-(M*H+r)),Y=-U*U+H*(H+2*I)+k;else H<=-X?(U=Math.max(0,-(-M*y+r)),H=U>0?-y:Math.min(Math.max(-y,-I),y),Y=-U*U+H*(H+2*I)+k):H<=X?(U=0,H=Math.min(Math.max(-y,-I),y),Y=H*(H+2*I)+k):(U=Math.max(0,-(M*y+r)),H=U>0?y:Math.min(Math.max(-y,-I),y),Y=-U*U+H*(H+2*I)+k);else H=M>0?-y:y,U=Math.max(0,-(M*H+r)),Y=-U*U+H*(H+2*I)+k;return c&&c.copy(this.origin).addScaledVector(this.direction,U),p&&p.copy(HT).addScaledVector(z1,H),Y}intersectSphere(e,a){Pf.subVectors(e.center,this.origin);const c=Pf.dot(this.direction),p=Pf.dot(Pf)-c*c,y=e.radius*e.radius;if(p>y)return null;const M=Math.sqrt(y-p),r=c-M,I=c+M;return I<0?null:r<0?this.at(I,a):this.at(r,a)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const a=e.normal.dot(this.direction);if(a===0)return e.distanceToPoint(this.origin)===0?0:null;const c=-(this.origin.dot(e.normal)+e.constant)/a;return c>=0?c:null}intersectPlane(e,a){const c=this.distanceToPlane(e);return c===null?null:this.at(c,a)}intersectsPlane(e){const a=e.distanceToPoint(this.origin);return a===0||e.normal.dot(this.direction)*a<0}intersectBox(e,a){let c,p,y,M,r,I;const k=1/this.direction.x,B=1/this.direction.y,U=1/this.direction.z,H=this.origin;return k>=0?(c=(e.min.x-H.x)*k,p=(e.max.x-H.x)*k):(c=(e.max.x-H.x)*k,p=(e.min.x-H.x)*k),B>=0?(y=(e.min.y-H.y)*B,M=(e.max.y-H.y)*B):(y=(e.max.y-H.y)*B,M=(e.min.y-H.y)*B),c>M||y>p||((y>c||isNaN(c))&&(c=y),(M<p||isNaN(p))&&(p=M),U>=0?(r=(e.min.z-H.z)*U,I=(e.max.z-H.z)*U):(r=(e.max.z-H.z)*U,I=(e.min.z-H.z)*U),c>I||r>p)||((r>c||c!==c)&&(c=r),(I<p||p!==p)&&(p=I),p<0)?null:this.at(c>=0?c:p,a)}intersectsBox(e){return this.intersectBox(e,Pf)!==null}intersectTriangle(e,a,c,p,y){qT.subVectors(a,e),k1.subVectors(c,e),WT.crossVectors(qT,k1);let M=this.direction.dot(WT),r;if(M>0){if(p)return null;r=1}else if(M<0)r=-1,M=-M;else return null;am.subVectors(this.origin,e);const I=r*this.direction.dot(k1.crossVectors(am,k1));if(I<0)return null;const k=r*this.direction.dot(qT.cross(am));if(k<0||I+k>M)return null;const B=-r*am.dot(WT);return B<0?null:this.at(B/M,y)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ba{constructor(e,a,c,p,y,M,r,I,k,B,U,H,Y,X,Q,J){Ba.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,a,c,p,y,M,r,I,k,B,U,H,Y,X,Q,J)}set(e,a,c,p,y,M,r,I,k,B,U,H,Y,X,Q,J){const j=this.elements;return j[0]=e,j[4]=a,j[8]=c,j[12]=p,j[1]=y,j[5]=M,j[9]=r,j[13]=I,j[2]=k,j[6]=B,j[10]=U,j[14]=H,j[3]=Y,j[7]=X,j[11]=Q,j[15]=J,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ba().fromArray(this.elements)}copy(e){const a=this.elements,c=e.elements;return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15],this}copyPosition(e){const a=this.elements,c=e.elements;return a[12]=c[12],a[13]=c[13],a[14]=c[14],this}setFromMatrix3(e){const a=e.elements;return this.set(a[0],a[3],a[6],0,a[1],a[4],a[7],0,a[2],a[5],a[8],0,0,0,0,1),this}extractBasis(e,a,c){return e.setFromMatrixColumn(this,0),a.setFromMatrixColumn(this,1),c.setFromMatrixColumn(this,2),this}makeBasis(e,a,c){return this.set(e.x,a.x,c.x,0,e.y,a.y,c.y,0,e.z,a.z,c.z,0,0,0,0,1),this}extractRotation(e){const a=this.elements,c=e.elements,p=1/Bv.setFromMatrixColumn(e,0).length(),y=1/Bv.setFromMatrixColumn(e,1).length(),M=1/Bv.setFromMatrixColumn(e,2).length();return a[0]=c[0]*p,a[1]=c[1]*p,a[2]=c[2]*p,a[3]=0,a[4]=c[4]*y,a[5]=c[5]*y,a[6]=c[6]*y,a[7]=0,a[8]=c[8]*M,a[9]=c[9]*M,a[10]=c[10]*M,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this}makeRotationFromEuler(e){const a=this.elements,c=e.x,p=e.y,y=e.z,M=Math.cos(c),r=Math.sin(c),I=Math.cos(p),k=Math.sin(p),B=Math.cos(y),U=Math.sin(y);if(e.order==="XYZ"){const H=M*B,Y=M*U,X=r*B,Q=r*U;a[0]=I*B,a[4]=-I*U,a[8]=k,a[1]=Y+X*k,a[5]=H-Q*k,a[9]=-r*I,a[2]=Q-H*k,a[6]=X+Y*k,a[10]=M*I}else if(e.order==="YXZ"){const H=I*B,Y=I*U,X=k*B,Q=k*U;a[0]=H+Q*r,a[4]=X*r-Y,a[8]=M*k,a[1]=M*U,a[5]=M*B,a[9]=-r,a[2]=Y*r-X,a[6]=Q+H*r,a[10]=M*I}else if(e.order==="ZXY"){const H=I*B,Y=I*U,X=k*B,Q=k*U;a[0]=H-Q*r,a[4]=-M*U,a[8]=X+Y*r,a[1]=Y+X*r,a[5]=M*B,a[9]=Q-H*r,a[2]=-M*k,a[6]=r,a[10]=M*I}else if(e.order==="ZYX"){const H=M*B,Y=M*U,X=r*B,Q=r*U;a[0]=I*B,a[4]=X*k-Y,a[8]=H*k+Q,a[1]=I*U,a[5]=Q*k+H,a[9]=Y*k-X,a[2]=-k,a[6]=r*I,a[10]=M*I}else if(e.order==="YZX"){const H=M*I,Y=M*k,X=r*I,Q=r*k;a[0]=I*B,a[4]=Q-H*U,a[8]=X*U+Y,a[1]=U,a[5]=M*B,a[9]=-r*B,a[2]=-k*B,a[6]=Y*U+X,a[10]=H-Q*U}else if(e.order==="XZY"){const H=M*I,Y=M*k,X=r*I,Q=r*k;a[0]=I*B,a[4]=-U,a[8]=k*B,a[1]=H*U+Q,a[5]=M*B,a[9]=Y*U-X,a[2]=X*U-Y,a[6]=r*B,a[10]=Q*U+H}return a[3]=0,a[7]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this}makeRotationFromQuaternion(e){return this.compose(N9,e,B9)}lookAt(e,a,c){const p=this.elements;return sc.subVectors(e,a),sc.lengthSq()===0&&(sc.z=1),sc.normalize(),om.crossVectors(c,sc),om.lengthSq()===0&&(Math.abs(c.z)===1?sc.x+=1e-4:sc.z+=1e-4,sc.normalize(),om.crossVectors(c,sc)),om.normalize(),F1.crossVectors(sc,om),p[0]=om.x,p[4]=F1.x,p[8]=sc.x,p[1]=om.y,p[5]=F1.y,p[9]=sc.y,p[2]=om.z,p[6]=F1.z,p[10]=sc.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,a){const c=e.elements,p=a.elements,y=this.elements,M=c[0],r=c[4],I=c[8],k=c[12],B=c[1],U=c[5],H=c[9],Y=c[13],X=c[2],Q=c[6],J=c[10],j=c[14],oe=c[3],ce=c[7],pe=c[11],Ae=c[15],Ee=p[0],be=p[4],Ve=p[8],Se=p[12],xe=p[1],Fe=p[5],Ct=p[9],Et=p[13],Tt=p[2],_t=p[6],et=p[10],Lt=p[14],lt=p[3],ut=p[7],Xe=p[11],kt=p[15];return y[0]=M*Ee+r*xe+I*Tt+k*lt,y[4]=M*be+r*Fe+I*_t+k*ut,y[8]=M*Ve+r*Ct+I*et+k*Xe,y[12]=M*Se+r*Et+I*Lt+k*kt,y[1]=B*Ee+U*xe+H*Tt+Y*lt,y[5]=B*be+U*Fe+H*_t+Y*ut,y[9]=B*Ve+U*Ct+H*et+Y*Xe,y[13]=B*Se+U*Et+H*Lt+Y*kt,y[2]=X*Ee+Q*xe+J*Tt+j*lt,y[6]=X*be+Q*Fe+J*_t+j*ut,y[10]=X*Ve+Q*Ct+J*et+j*Xe,y[14]=X*Se+Q*Et+J*Lt+j*kt,y[3]=oe*Ee+ce*xe+pe*Tt+Ae*lt,y[7]=oe*be+ce*Fe+pe*_t+Ae*ut,y[11]=oe*Ve+ce*Ct+pe*et+Ae*Xe,y[15]=oe*Se+ce*Et+pe*Lt+Ae*kt,this}multiplyScalar(e){const a=this.elements;return a[0]*=e,a[4]*=e,a[8]*=e,a[12]*=e,a[1]*=e,a[5]*=e,a[9]*=e,a[13]*=e,a[2]*=e,a[6]*=e,a[10]*=e,a[14]*=e,a[3]*=e,a[7]*=e,a[11]*=e,a[15]*=e,this}determinant(){const e=this.elements,a=e[0],c=e[4],p=e[8],y=e[12],M=e[1],r=e[5],I=e[9],k=e[13],B=e[2],U=e[6],H=e[10],Y=e[14],X=e[3],Q=e[7],J=e[11],j=e[15];return X*(+y*I*U-p*k*U-y*r*H+c*k*H+p*r*Y-c*I*Y)+Q*(+a*I*Y-a*k*H+y*M*H-p*M*Y+p*k*B-y*I*B)+J*(+a*k*U-a*r*Y-y*M*U+c*M*Y+y*r*B-c*k*B)+j*(-p*r*B-a*I*U+a*r*H+p*M*U-c*M*H+c*I*B)}transpose(){const e=this.elements;let a;return a=e[1],e[1]=e[4],e[4]=a,a=e[2],e[2]=e[8],e[8]=a,a=e[6],e[6]=e[9],e[9]=a,a=e[3],e[3]=e[12],e[12]=a,a=e[7],e[7]=e[13],e[13]=a,a=e[11],e[11]=e[14],e[14]=a,this}setPosition(e,a,c){const p=this.elements;return e.isVector3?(p[12]=e.x,p[13]=e.y,p[14]=e.z):(p[12]=e,p[13]=a,p[14]=c),this}invert(){const e=this.elements,a=e[0],c=e[1],p=e[2],y=e[3],M=e[4],r=e[5],I=e[6],k=e[7],B=e[8],U=e[9],H=e[10],Y=e[11],X=e[12],Q=e[13],J=e[14],j=e[15],oe=U*J*k-Q*H*k+Q*I*Y-r*J*Y-U*I*j+r*H*j,ce=X*H*k-B*J*k-X*I*Y+M*J*Y+B*I*j-M*H*j,pe=B*Q*k-X*U*k+X*r*Y-M*Q*Y-B*r*j+M*U*j,Ae=X*U*I-B*Q*I-X*r*H+M*Q*H+B*r*J-M*U*J,Ee=a*oe+c*ce+p*pe+y*Ae;if(Ee===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const be=1/Ee;return e[0]=oe*be,e[1]=(Q*H*y-U*J*y-Q*p*Y+c*J*Y+U*p*j-c*H*j)*be,e[2]=(r*J*y-Q*I*y+Q*p*k-c*J*k-r*p*j+c*I*j)*be,e[3]=(U*I*y-r*H*y-U*p*k+c*H*k+r*p*Y-c*I*Y)*be,e[4]=ce*be,e[5]=(B*J*y-X*H*y+X*p*Y-a*J*Y-B*p*j+a*H*j)*be,e[6]=(X*I*y-M*J*y-X*p*k+a*J*k+M*p*j-a*I*j)*be,e[7]=(M*H*y-B*I*y+B*p*k-a*H*k-M*p*Y+a*I*Y)*be,e[8]=pe*be,e[9]=(X*U*y-B*Q*y-X*c*Y+a*Q*Y+B*c*j-a*U*j)*be,e[10]=(M*Q*y-X*r*y+X*c*k-a*Q*k-M*c*j+a*r*j)*be,e[11]=(B*r*y-M*U*y-B*c*k+a*U*k+M*c*Y-a*r*Y)*be,e[12]=Ae*be,e[13]=(B*Q*p-X*U*p+X*c*H-a*Q*H-B*c*J+a*U*J)*be,e[14]=(X*r*p-M*Q*p-X*c*I+a*Q*I+M*c*J-a*r*J)*be,e[15]=(M*U*p-B*r*p+B*c*I-a*U*I-M*c*H+a*r*H)*be,this}scale(e){const a=this.elements,c=e.x,p=e.y,y=e.z;return a[0]*=c,a[4]*=p,a[8]*=y,a[1]*=c,a[5]*=p,a[9]*=y,a[2]*=c,a[6]*=p,a[10]*=y,a[3]*=c,a[7]*=p,a[11]*=y,this}getMaxScaleOnAxis(){const e=this.elements,a=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],c=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],p=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(a,c,p))}makeTranslation(e,a,c){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,a,0,0,1,c,0,0,0,1),this}makeRotationX(e){const a=Math.cos(e),c=Math.sin(e);return this.set(1,0,0,0,0,a,-c,0,0,c,a,0,0,0,0,1),this}makeRotationY(e){const a=Math.cos(e),c=Math.sin(e);return this.set(a,0,c,0,0,1,0,0,-c,0,a,0,0,0,0,1),this}makeRotationZ(e){const a=Math.cos(e),c=Math.sin(e);return this.set(a,-c,0,0,c,a,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,a){const c=Math.cos(a),p=Math.sin(a),y=1-c,M=e.x,r=e.y,I=e.z,k=y*M,B=y*r;return this.set(k*M+c,k*r-p*I,k*I+p*r,0,k*r+p*I,B*r+c,B*I-p*M,0,k*I-p*r,B*I+p*M,y*I*I+c,0,0,0,0,1),this}makeScale(e,a,c){return this.set(e,0,0,0,0,a,0,0,0,0,c,0,0,0,0,1),this}makeShear(e,a,c,p,y,M){return this.set(1,c,y,0,e,1,M,0,a,p,1,0,0,0,0,1),this}compose(e,a,c){const p=this.elements,y=a._x,M=a._y,r=a._z,I=a._w,k=y+y,B=M+M,U=r+r,H=y*k,Y=y*B,X=y*U,Q=M*B,J=M*U,j=r*U,oe=I*k,ce=I*B,pe=I*U,Ae=c.x,Ee=c.y,be=c.z;return p[0]=(1-(Q+j))*Ae,p[1]=(Y+pe)*Ae,p[2]=(X-ce)*Ae,p[3]=0,p[4]=(Y-pe)*Ee,p[5]=(1-(H+j))*Ee,p[6]=(J+oe)*Ee,p[7]=0,p[8]=(X+ce)*be,p[9]=(J-oe)*be,p[10]=(1-(H+Q))*be,p[11]=0,p[12]=e.x,p[13]=e.y,p[14]=e.z,p[15]=1,this}decompose(e,a,c){const p=this.elements;let y=Bv.set(p[0],p[1],p[2]).length();const M=Bv.set(p[4],p[5],p[6]).length(),r=Bv.set(p[8],p[9],p[10]).length();this.determinant()<0&&(y=-y),e.x=p[12],e.y=p[13],e.z=p[14],Qu.copy(this);const k=1/y,B=1/M,U=1/r;return Qu.elements[0]*=k,Qu.elements[1]*=k,Qu.elements[2]*=k,Qu.elements[4]*=B,Qu.elements[5]*=B,Qu.elements[6]*=B,Qu.elements[8]*=U,Qu.elements[9]*=U,Qu.elements[10]*=U,a.setFromRotationMatrix(Qu),c.x=y,c.y=M,c.z=r,this}makePerspective(e,a,c,p,y,M,r=qf){const I=this.elements,k=2*y/(a-e),B=2*y/(c-p),U=(a+e)/(a-e),H=(c+p)/(c-p);let Y,X;if(r===qf)Y=-(M+y)/(M-y),X=-2*M*y/(M-y);else if(r===iE)Y=-M/(M-y),X=-M*y/(M-y);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+r);return I[0]=k,I[4]=0,I[8]=U,I[12]=0,I[1]=0,I[5]=B,I[9]=H,I[13]=0,I[2]=0,I[6]=0,I[10]=Y,I[14]=X,I[3]=0,I[7]=0,I[11]=-1,I[15]=0,this}makeOrthographic(e,a,c,p,y,M,r=qf){const I=this.elements,k=1/(a-e),B=1/(c-p),U=1/(M-y),H=(a+e)*k,Y=(c+p)*B;let X,Q;if(r===qf)X=(M+y)*U,Q=-2*U;else if(r===iE)X=y*U,Q=-1*U;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+r);return I[0]=2*k,I[4]=0,I[8]=0,I[12]=-H,I[1]=0,I[5]=2*B,I[9]=0,I[13]=-Y,I[2]=0,I[6]=0,I[10]=Q,I[14]=-X,I[3]=0,I[7]=0,I[11]=0,I[15]=1,this}equals(e){const a=this.elements,c=e.elements;for(let p=0;p<16;p++)if(a[p]!==c[p])return!1;return!0}fromArray(e,a=0){for(let c=0;c<16;c++)this.elements[c]=e[c+a];return this}toArray(e=[],a=0){const c=this.elements;return e[a]=c[0],e[a+1]=c[1],e[a+2]=c[2],e[a+3]=c[3],e[a+4]=c[4],e[a+5]=c[5],e[a+6]=c[6],e[a+7]=c[7],e[a+8]=c[8],e[a+9]=c[9],e[a+10]=c[10],e[a+11]=c[11],e[a+12]=c[12],e[a+13]=c[13],e[a+14]=c[14],e[a+15]=c[15],e}}const Bv=new un,Qu=new Ba,N9=new un(0,0,0),B9=new un(1,1,1),om=new un,F1=new un,sc=new un,I3=new Ba,D3=new lb;class Ad{constructor(e=0,a=0,c=0,p=Ad.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=a,this._z=c,this._order=p}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,a,c,p=this._order){return this._x=e,this._y=a,this._z=c,this._order=p,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,a=this._order,c=!0){const p=e.elements,y=p[0],M=p[4],r=p[8],I=p[1],k=p[5],B=p[9],U=p[2],H=p[6],Y=p[10];switch(a){case"XYZ":this._y=Math.asin(qr(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(-B,Y),this._z=Math.atan2(-M,y)):(this._x=Math.atan2(H,k),this._z=0);break;case"YXZ":this._x=Math.asin(-qr(B,-1,1)),Math.abs(B)<.9999999?(this._y=Math.atan2(r,Y),this._z=Math.atan2(I,k)):(this._y=Math.atan2(-U,y),this._z=0);break;case"ZXY":this._x=Math.asin(qr(H,-1,1)),Math.abs(H)<.9999999?(this._y=Math.atan2(-U,Y),this._z=Math.atan2(-M,k)):(this._y=0,this._z=Math.atan2(I,y));break;case"ZYX":this._y=Math.asin(-qr(U,-1,1)),Math.abs(U)<.9999999?(this._x=Math.atan2(H,Y),this._z=Math.atan2(I,y)):(this._x=0,this._z=Math.atan2(-M,k));break;case"YZX":this._z=Math.asin(qr(I,-1,1)),Math.abs(I)<.9999999?(this._x=Math.atan2(-B,k),this._y=Math.atan2(-U,y)):(this._x=0,this._y=Math.atan2(r,Y));break;case"XZY":this._z=Math.asin(-qr(M,-1,1)),Math.abs(M)<.9999999?(this._x=Math.atan2(H,k),this._y=Math.atan2(r,y)):(this._x=Math.atan2(-B,Y),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+a)}return this._order=a,c===!0&&this._onChangeCallback(),this}setFromQuaternion(e,a,c){return I3.makeRotationFromQuaternion(e),this.setFromRotationMatrix(I3,a,c)}setFromVector3(e,a=this._order){return this.set(e.x,e.y,e.z,a)}reorder(e){return D3.setFromEuler(this),this.setFromQuaternion(D3,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],a=0){return e[a]=this._x,e[a+1]=this._y,e[a+2]=this._z,e[a+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ad.DEFAULT_ORDER="XYZ";class EF{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let U9=0;const P3=new un,Uv=new lb,Lf=new Ba,N1=new un,Qx=new un,V9=new un,j9=new lb,L3=new un(1,0,0),O3=new un(0,1,0),z3=new un(0,0,1),k3={type:"added"},G9={type:"removed"},Vv={type:"childadded",child:null},$T={type:"childremoved",child:null};class Ol extends By{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:U9++}),this.uuid=sb(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ol.DEFAULT_UP.clone();const e=new un,a=new Ad,c=new lb,p=new un(1,1,1);function y(){c.setFromEuler(a,!1)}function M(){a.setFromQuaternion(c,void 0,!1)}a._onChange(y),c._onChange(M),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:a},quaternion:{configurable:!0,enumerable:!0,value:c},scale:{configurable:!0,enumerable:!0,value:p},modelViewMatrix:{value:new Ba},normalMatrix:{value:new wr}}),this.matrix=new Ba,this.matrixWorld=new Ba,this.matrixAutoUpdate=Ol.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ol.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new EF,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,a){this.quaternion.setFromAxisAngle(e,a)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,a){return Uv.setFromAxisAngle(e,a),this.quaternion.multiply(Uv),this}rotateOnWorldAxis(e,a){return Uv.setFromAxisAngle(e,a),this.quaternion.premultiply(Uv),this}rotateX(e){return this.rotateOnAxis(L3,e)}rotateY(e){return this.rotateOnAxis(O3,e)}rotateZ(e){return this.rotateOnAxis(z3,e)}translateOnAxis(e,a){return P3.copy(e).applyQuaternion(this.quaternion),this.position.add(P3.multiplyScalar(a)),this}translateX(e){return this.translateOnAxis(L3,e)}translateY(e){return this.translateOnAxis(O3,e)}translateZ(e){return this.translateOnAxis(z3,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Lf.copy(this.matrixWorld).invert())}lookAt(e,a,c){e.isVector3?N1.copy(e):N1.set(e,a,c);const p=this.parent;this.updateWorldMatrix(!0,!1),Qx.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Lf.lookAt(Qx,N1,this.up):Lf.lookAt(N1,Qx,this.up),this.quaternion.setFromRotationMatrix(Lf),p&&(Lf.extractRotation(p.matrixWorld),Uv.setFromRotationMatrix(Lf),this.quaternion.premultiply(Uv.invert()))}add(e){if(arguments.length>1){for(let a=0;a<arguments.length;a++)this.add(arguments[a]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(k3),Vv.child=e,this.dispatchEvent(Vv),Vv.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let c=0;c<arguments.length;c++)this.remove(arguments[c]);return this}const a=this.children.indexOf(e);return a!==-1&&(e.parent=null,this.children.splice(a,1),e.dispatchEvent(G9),$T.child=e,this.dispatchEvent($T),$T.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Lf.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Lf.multiply(e.parent.matrixWorld)),e.applyMatrix4(Lf),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(k3),Vv.child=e,this.dispatchEvent(Vv),Vv.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,a){if(this[e]===a)return this;for(let c=0,p=this.children.length;c<p;c++){const M=this.children[c].getObjectByProperty(e,a);if(M!==void 0)return M}}getObjectsByProperty(e,a,c=[]){this[e]===a&&c.push(this);const p=this.children;for(let y=0,M=p.length;y<M;y++)p[y].getObjectsByProperty(e,a,c);return c}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qx,e,V9),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qx,j9,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const a=this.matrixWorld.elements;return e.set(a[8],a[9],a[10]).normalize()}raycast(){}traverse(e){e(this);const a=this.children;for(let c=0,p=a.length;c<p;c++)a[c].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const a=this.children;for(let c=0,p=a.length;c<p;c++)a[c].traverseVisible(e)}traverseAncestors(e){const a=this.parent;a!==null&&(e(a),a.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const a=this.children;for(let c=0,p=a.length;c<p;c++)a[c].updateMatrixWorld(e)}updateWorldMatrix(e,a){const c=this.parent;if(e===!0&&c!==null&&c.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),a===!0){const p=this.children;for(let y=0,M=p.length;y<M;y++)p[y].updateWorldMatrix(!1,!0)}}toJSON(e){const a=e===void 0||typeof e=="string",c={};a&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},c.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const p={};p.uuid=this.uuid,p.type=this.type,this.name!==""&&(p.name=this.name),this.castShadow===!0&&(p.castShadow=!0),this.receiveShadow===!0&&(p.receiveShadow=!0),this.visible===!1&&(p.visible=!1),this.frustumCulled===!1&&(p.frustumCulled=!1),this.renderOrder!==0&&(p.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(p.userData=this.userData),p.layers=this.layers.mask,p.matrix=this.matrix.toArray(),p.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(p.matrixAutoUpdate=!1),this.isInstancedMesh&&(p.type="InstancedMesh",p.count=this.count,p.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(p.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(p.type="BatchedMesh",p.perObjectFrustumCulled=this.perObjectFrustumCulled,p.sortObjects=this.sortObjects,p.drawRanges=this._drawRanges,p.reservedRanges=this._reservedRanges,p.visibility=this._visibility,p.active=this._active,p.bounds=this._bounds.map(r=>({boxInitialized:r.boxInitialized,boxMin:r.box.min.toArray(),boxMax:r.box.max.toArray(),sphereInitialized:r.sphereInitialized,sphereRadius:r.sphere.radius,sphereCenter:r.sphere.center.toArray()})),p.maxInstanceCount=this._maxInstanceCount,p.maxVertexCount=this._maxVertexCount,p.maxIndexCount=this._maxIndexCount,p.geometryInitialized=this._geometryInitialized,p.geometryCount=this._geometryCount,p.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(p.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(p.boundingSphere={center:p.boundingSphere.center.toArray(),radius:p.boundingSphere.radius}),this.boundingBox!==null&&(p.boundingBox={min:p.boundingBox.min.toArray(),max:p.boundingBox.max.toArray()}));function y(r,I){return r[I.uuid]===void 0&&(r[I.uuid]=I.toJSON(e)),I.uuid}if(this.isScene)this.background&&(this.background.isColor?p.background=this.background.toJSON():this.background.isTexture&&(p.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(p.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){p.geometry=y(e.geometries,this.geometry);const r=this.geometry.parameters;if(r!==void 0&&r.shapes!==void 0){const I=r.shapes;if(Array.isArray(I))for(let k=0,B=I.length;k<B;k++){const U=I[k];y(e.shapes,U)}else y(e.shapes,I)}}if(this.isSkinnedMesh&&(p.bindMode=this.bindMode,p.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(y(e.skeletons,this.skeleton),p.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const r=[];for(let I=0,k=this.material.length;I<k;I++)r.push(y(e.materials,this.material[I]));p.material=r}else p.material=y(e.materials,this.material);if(this.children.length>0){p.children=[];for(let r=0;r<this.children.length;r++)p.children.push(this.children[r].toJSON(e).object)}if(this.animations.length>0){p.animations=[];for(let r=0;r<this.animations.length;r++){const I=this.animations[r];p.animations.push(y(e.animations,I))}}if(a){const r=M(e.geometries),I=M(e.materials),k=M(e.textures),B=M(e.images),U=M(e.shapes),H=M(e.skeletons),Y=M(e.animations),X=M(e.nodes);r.length>0&&(c.geometries=r),I.length>0&&(c.materials=I),k.length>0&&(c.textures=k),B.length>0&&(c.images=B),U.length>0&&(c.shapes=U),H.length>0&&(c.skeletons=H),Y.length>0&&(c.animations=Y),X.length>0&&(c.nodes=X)}return c.object=p,c;function M(r){const I=[];for(const k in r){const B=r[k];delete B.metadata,I.push(B)}return I}}clone(e){return new this.constructor().copy(this,e)}copy(e,a=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),a===!0)for(let c=0;c<e.children.length;c++){const p=e.children[c];this.add(p.clone())}return this}}Ol.DEFAULT_UP=new un(0,1,0);Ol.DEFAULT_MATRIX_AUTO_UPDATE=!0;Ol.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const eh=new un,Of=new un,XT=new un,zf=new un,jv=new un,Gv=new un,F3=new un,ZT=new un,YT=new un,KT=new un,JT=new Mo,QT=new Mo,e2=new Mo;class ah{constructor(e=new un,a=new un,c=new un){this.a=e,this.b=a,this.c=c}static getNormal(e,a,c,p){p.subVectors(c,a),eh.subVectors(e,a),p.cross(eh);const y=p.lengthSq();return y>0?p.multiplyScalar(1/Math.sqrt(y)):p.set(0,0,0)}static getBarycoord(e,a,c,p,y){eh.subVectors(p,a),Of.subVectors(c,a),XT.subVectors(e,a);const M=eh.dot(eh),r=eh.dot(Of),I=eh.dot(XT),k=Of.dot(Of),B=Of.dot(XT),U=M*k-r*r;if(U===0)return y.set(0,0,0),null;const H=1/U,Y=(k*I-r*B)*H,X=(M*B-r*I)*H;return y.set(1-Y-X,X,Y)}static containsPoint(e,a,c,p){return this.getBarycoord(e,a,c,p,zf)===null?!1:zf.x>=0&&zf.y>=0&&zf.x+zf.y<=1}static getInterpolation(e,a,c,p,y,M,r,I){return this.getBarycoord(e,a,c,p,zf)===null?(I.x=0,I.y=0,"z"in I&&(I.z=0),"w"in I&&(I.w=0),null):(I.setScalar(0),I.addScaledVector(y,zf.x),I.addScaledVector(M,zf.y),I.addScaledVector(r,zf.z),I)}static getInterpolatedAttribute(e,a,c,p,y,M){return JT.setScalar(0),QT.setScalar(0),e2.setScalar(0),JT.fromBufferAttribute(e,a),QT.fromBufferAttribute(e,c),e2.fromBufferAttribute(e,p),M.setScalar(0),M.addScaledVector(JT,y.x),M.addScaledVector(QT,y.y),M.addScaledVector(e2,y.z),M}static isFrontFacing(e,a,c,p){return eh.subVectors(c,a),Of.subVectors(e,a),eh.cross(Of).dot(p)<0}set(e,a,c){return this.a.copy(e),this.b.copy(a),this.c.copy(c),this}setFromPointsAndIndices(e,a,c,p){return this.a.copy(e[a]),this.b.copy(e[c]),this.c.copy(e[p]),this}setFromAttributeAndIndices(e,a,c,p){return this.a.fromBufferAttribute(e,a),this.b.fromBufferAttribute(e,c),this.c.fromBufferAttribute(e,p),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return eh.subVectors(this.c,this.b),Of.subVectors(this.a,this.b),eh.cross(Of).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ah.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,a){return ah.getBarycoord(e,this.a,this.b,this.c,a)}getInterpolation(e,a,c,p,y){return ah.getInterpolation(e,this.a,this.b,this.c,a,c,p,y)}containsPoint(e){return ah.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ah.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,a){const c=this.a,p=this.b,y=this.c;let M,r;jv.subVectors(p,c),Gv.subVectors(y,c),ZT.subVectors(e,c);const I=jv.dot(ZT),k=Gv.dot(ZT);if(I<=0&&k<=0)return a.copy(c);YT.subVectors(e,p);const B=jv.dot(YT),U=Gv.dot(YT);if(B>=0&&U<=B)return a.copy(p);const H=I*U-B*k;if(H<=0&&I>=0&&B<=0)return M=I/(I-B),a.copy(c).addScaledVector(jv,M);KT.subVectors(e,y);const Y=jv.dot(KT),X=Gv.dot(KT);if(X>=0&&Y<=X)return a.copy(y);const Q=Y*k-I*X;if(Q<=0&&k>=0&&X<=0)return r=k/(k-X),a.copy(c).addScaledVector(Gv,r);const J=B*X-Y*U;if(J<=0&&U-B>=0&&Y-X>=0)return F3.subVectors(y,p),r=(U-B)/(U-B+(Y-X)),a.copy(p).addScaledVector(F3,r);const j=1/(J+Q+H);return M=Q*j,r=H*j,a.copy(c).addScaledVector(jv,M).addScaledVector(Gv,r)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const MF={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},sm={h:0,s:0,l:0},B1={h:0,s:0,l:0};function t2(t,e,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?t+(e-t)*6*a:a<1/2?e:a<2/3?t+(e-t)*6*(2/3-a):t}class sa{constructor(e,a,c){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,a,c)}set(e,a,c){if(a===void 0&&c===void 0){const p=e;p&&p.isColor?this.copy(p):typeof p=="number"?this.setHex(p):typeof p=="string"&&this.setStyle(p)}else this.setRGB(e,a,c);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,a=uu){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ta.toWorkingColorSpace(this,a),this}setRGB(e,a,c,p=ta.workingColorSpace){return this.r=e,this.g=a,this.b=c,ta.toWorkingColorSpace(this,p),this}setHSL(e,a,c,p=ta.workingColorSpace){if(e=M9(e,1),a=qr(a,0,1),c=qr(c,0,1),a===0)this.r=this.g=this.b=c;else{const y=c<=.5?c*(1+a):c+a-c*a,M=2*c-y;this.r=t2(M,y,e+1/3),this.g=t2(M,y,e),this.b=t2(M,y,e-1/3)}return ta.toWorkingColorSpace(this,p),this}setStyle(e,a=uu){function c(y){y!==void 0&&parseFloat(y)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let p;if(p=/^(\w+)\(([^\)]*)\)/.exec(e)){let y;const M=p[1],r=p[2];switch(M){case"rgb":case"rgba":if(y=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return c(y[4]),this.setRGB(Math.min(255,parseInt(y[1],10))/255,Math.min(255,parseInt(y[2],10))/255,Math.min(255,parseInt(y[3],10))/255,a);if(y=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return c(y[4]),this.setRGB(Math.min(100,parseInt(y[1],10))/100,Math.min(100,parseInt(y[2],10))/100,Math.min(100,parseInt(y[3],10))/100,a);break;case"hsl":case"hsla":if(y=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return c(y[4]),this.setHSL(parseFloat(y[1])/360,parseFloat(y[2])/100,parseFloat(y[3])/100,a);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(p=/^\#([A-Fa-f\d]+)$/.exec(e)){const y=p[1],M=y.length;if(M===3)return this.setRGB(parseInt(y.charAt(0),16)/15,parseInt(y.charAt(1),16)/15,parseInt(y.charAt(2),16)/15,a);if(M===6)return this.setHex(parseInt(y,16),a);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,a);return this}setColorName(e,a=uu){const c=MF[e.toLowerCase()];return c!==void 0?this.setHex(c,a):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Xf(e.r),this.g=Xf(e.g),this.b=Xf(e.b),this}copyLinearToSRGB(e){return this.r=vy(e.r),this.g=vy(e.g),this.b=vy(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=uu){return ta.fromWorkingColorSpace(Gs.copy(this),e),Math.round(qr(Gs.r*255,0,255))*65536+Math.round(qr(Gs.g*255,0,255))*256+Math.round(qr(Gs.b*255,0,255))}getHexString(e=uu){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,a=ta.workingColorSpace){ta.fromWorkingColorSpace(Gs.copy(this),a);const c=Gs.r,p=Gs.g,y=Gs.b,M=Math.max(c,p,y),r=Math.min(c,p,y);let I,k;const B=(r+M)/2;if(r===M)I=0,k=0;else{const U=M-r;switch(k=B<=.5?U/(M+r):U/(2-M-r),M){case c:I=(p-y)/U+(p<y?6:0);break;case p:I=(y-c)/U+2;break;case y:I=(c-p)/U+4;break}I/=6}return e.h=I,e.s=k,e.l=B,e}getRGB(e,a=ta.workingColorSpace){return ta.fromWorkingColorSpace(Gs.copy(this),a),e.r=Gs.r,e.g=Gs.g,e.b=Gs.b,e}getStyle(e=uu){ta.fromWorkingColorSpace(Gs.copy(this),e);const a=Gs.r,c=Gs.g,p=Gs.b;return e!==uu?`color(${e} ${a.toFixed(3)} ${c.toFixed(3)} ${p.toFixed(3)})`:`rgb(${Math.round(a*255)},${Math.round(c*255)},${Math.round(p*255)})`}offsetHSL(e,a,c){return this.getHSL(sm),this.setHSL(sm.h+e,sm.s+a,sm.l+c)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,a){return this.r=e.r+a.r,this.g=e.g+a.g,this.b=e.b+a.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,a){return this.r+=(e.r-this.r)*a,this.g+=(e.g-this.g)*a,this.b+=(e.b-this.b)*a,this}lerpColors(e,a,c){return this.r=e.r+(a.r-e.r)*c,this.g=e.g+(a.g-e.g)*c,this.b=e.b+(a.b-e.b)*c,this}lerpHSL(e,a){this.getHSL(sm),e.getHSL(B1);const c=NT(sm.h,B1.h,a),p=NT(sm.s,B1.s,a),y=NT(sm.l,B1.l,a);return this.setHSL(c,p,y),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const a=this.r,c=this.g,p=this.b,y=e.elements;return this.r=y[0]*a+y[3]*c+y[6]*p,this.g=y[1]*a+y[4]*c+y[7]*p,this.b=y[2]*a+y[5]*c+y[8]*p,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,a=0){return this.r=e[a],this.g=e[a+1],this.b=e[a+2],this}toArray(e=[],a=0){return e[a]=this.r,e[a+1]=this.g,e[a+2]=this.b,e}fromBufferAttribute(e,a){return this.r=e.getX(a),this.g=e.getY(a),this.b=e.getZ(a),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Gs=new sa;sa.NAMES=MF;let H9=0;class ub extends By{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:H9++}),this.uuid=sb(),this.name="",this.type="Material",this.blending=gy,this.side=Am,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=eA,this.blendDst=tA,this.blendEquation=a_,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new sa(0,0,0),this.blendAlpha=0,this.depthFunc=wy,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=S3,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ov,this.stencilZFail=Ov,this.stencilZPass=Ov,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const a in e){const c=e[a];if(c===void 0){console.warn(`THREE.Material: parameter '${a}' has value of undefined.`);continue}const p=this[a];if(p===void 0){console.warn(`THREE.Material: '${a}' is not a property of THREE.${this.type}.`);continue}p&&p.isColor?p.set(c):p&&p.isVector3&&c&&c.isVector3?p.copy(c):this[a]=c}}toJSON(e){const a=e===void 0||typeof e=="string";a&&(e={textures:{},images:{}});const c={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};c.uuid=this.uuid,c.type=this.type,this.name!==""&&(c.name=this.name),this.color&&this.color.isColor&&(c.color=this.color.getHex()),this.roughness!==void 0&&(c.roughness=this.roughness),this.metalness!==void 0&&(c.metalness=this.metalness),this.sheen!==void 0&&(c.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(c.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(c.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(c.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(c.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(c.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(c.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(c.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(c.shininess=this.shininess),this.clearcoat!==void 0&&(c.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(c.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(c.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(c.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(c.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,c.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(c.dispersion=this.dispersion),this.iridescence!==void 0&&(c.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(c.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(c.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(c.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(c.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(c.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(c.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(c.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(c.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(c.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(c.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(c.lightMap=this.lightMap.toJSON(e).uuid,c.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(c.aoMap=this.aoMap.toJSON(e).uuid,c.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(c.bumpMap=this.bumpMap.toJSON(e).uuid,c.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(c.normalMap=this.normalMap.toJSON(e).uuid,c.normalMapType=this.normalMapType,c.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(c.displacementMap=this.displacementMap.toJSON(e).uuid,c.displacementScale=this.displacementScale,c.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(c.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(c.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(c.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(c.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(c.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(c.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(c.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(c.combine=this.combine)),this.envMapRotation!==void 0&&(c.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(c.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(c.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(c.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(c.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(c.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(c.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(c.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(c.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(c.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(c.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(c.size=this.size),this.shadowSide!==null&&(c.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(c.sizeAttenuation=this.sizeAttenuation),this.blending!==gy&&(c.blending=this.blending),this.side!==Am&&(c.side=this.side),this.vertexColors===!0&&(c.vertexColors=!0),this.opacity<1&&(c.opacity=this.opacity),this.transparent===!0&&(c.transparent=!0),this.blendSrc!==eA&&(c.blendSrc=this.blendSrc),this.blendDst!==tA&&(c.blendDst=this.blendDst),this.blendEquation!==a_&&(c.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(c.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(c.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(c.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(c.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(c.blendAlpha=this.blendAlpha),this.depthFunc!==wy&&(c.depthFunc=this.depthFunc),this.depthTest===!1&&(c.depthTest=this.depthTest),this.depthWrite===!1&&(c.depthWrite=this.depthWrite),this.colorWrite===!1&&(c.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(c.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==S3&&(c.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(c.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(c.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Ov&&(c.stencilFail=this.stencilFail),this.stencilZFail!==Ov&&(c.stencilZFail=this.stencilZFail),this.stencilZPass!==Ov&&(c.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(c.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(c.rotation=this.rotation),this.polygonOffset===!0&&(c.polygonOffset=!0),this.polygonOffsetFactor!==0&&(c.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(c.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(c.linewidth=this.linewidth),this.dashSize!==void 0&&(c.dashSize=this.dashSize),this.gapSize!==void 0&&(c.gapSize=this.gapSize),this.scale!==void 0&&(c.scale=this.scale),this.dithering===!0&&(c.dithering=!0),this.alphaTest>0&&(c.alphaTest=this.alphaTest),this.alphaHash===!0&&(c.alphaHash=!0),this.alphaToCoverage===!0&&(c.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(c.premultipliedAlpha=!0),this.forceSinglePass===!0&&(c.forceSinglePass=!0),this.wireframe===!0&&(c.wireframe=!0),this.wireframeLinewidth>1&&(c.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(c.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(c.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(c.flatShading=!0),this.visible===!1&&(c.visible=!1),this.toneMapped===!1&&(c.toneMapped=!1),this.fog===!1&&(c.fog=!1),Object.keys(this.userData).length>0&&(c.userData=this.userData);function p(y){const M=[];for(const r in y){const I=y[r];delete I.metadata,M.push(I)}return M}if(a){const y=p(e.textures),M=p(e.images);y.length>0&&(c.textures=y),M.length>0&&(c.images=M)}return c}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const a=e.clippingPlanes;let c=null;if(a!==null){const p=a.length;c=new Array(p);for(let y=0;y!==p;++y)c[y]=a[y].clone()}return this.clippingPlanes=c,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class X0 extends ub{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new sa(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ad,this.combine=lF,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Lo=new un,U1=new ma;let q9=0;class Ed{constructor(e,a,c=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:q9++}),this.name="",this.array=e,this.itemSize=a,this.count=e!==void 0?e.length/a:0,this.normalized=c,this.usage=E3,this.updateRanges=[],this.gpuType=Hf,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,a){this.updateRanges.push({start:e,count:a})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,a,c){e*=this.itemSize,c*=a.itemSize;for(let p=0,y=this.itemSize;p<y;p++)this.array[e+p]=a.array[c+p];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let a=0,c=this.count;a<c;a++)U1.fromBufferAttribute(this,a),U1.applyMatrix3(e),this.setXY(a,U1.x,U1.y);else if(this.itemSize===3)for(let a=0,c=this.count;a<c;a++)Lo.fromBufferAttribute(this,a),Lo.applyMatrix3(e),this.setXYZ(a,Lo.x,Lo.y,Lo.z);return this}applyMatrix4(e){for(let a=0,c=this.count;a<c;a++)Lo.fromBufferAttribute(this,a),Lo.applyMatrix4(e),this.setXYZ(a,Lo.x,Lo.y,Lo.z);return this}applyNormalMatrix(e){for(let a=0,c=this.count;a<c;a++)Lo.fromBufferAttribute(this,a),Lo.applyNormalMatrix(e),this.setXYZ(a,Lo.x,Lo.y,Lo.z);return this}transformDirection(e){for(let a=0,c=this.count;a<c;a++)Lo.fromBufferAttribute(this,a),Lo.transformDirection(e),this.setXYZ(a,Lo.x,Lo.y,Lo.z);return this}set(e,a=0){return this.array.set(e,a),this}getComponent(e,a){let c=this.array[e*this.itemSize+a];return this.normalized&&(c=Yx(c,this.array)),c}setComponent(e,a,c){return this.normalized&&(c=Al(c,this.array)),this.array[e*this.itemSize+a]=c,this}getX(e){let a=this.array[e*this.itemSize];return this.normalized&&(a=Yx(a,this.array)),a}setX(e,a){return this.normalized&&(a=Al(a,this.array)),this.array[e*this.itemSize]=a,this}getY(e){let a=this.array[e*this.itemSize+1];return this.normalized&&(a=Yx(a,this.array)),a}setY(e,a){return this.normalized&&(a=Al(a,this.array)),this.array[e*this.itemSize+1]=a,this}getZ(e){let a=this.array[e*this.itemSize+2];return this.normalized&&(a=Yx(a,this.array)),a}setZ(e,a){return this.normalized&&(a=Al(a,this.array)),this.array[e*this.itemSize+2]=a,this}getW(e){let a=this.array[e*this.itemSize+3];return this.normalized&&(a=Yx(a,this.array)),a}setW(e,a){return this.normalized&&(a=Al(a,this.array)),this.array[e*this.itemSize+3]=a,this}setXY(e,a,c){return e*=this.itemSize,this.normalized&&(a=Al(a,this.array),c=Al(c,this.array)),this.array[e+0]=a,this.array[e+1]=c,this}setXYZ(e,a,c,p){return e*=this.itemSize,this.normalized&&(a=Al(a,this.array),c=Al(c,this.array),p=Al(p,this.array)),this.array[e+0]=a,this.array[e+1]=c,this.array[e+2]=p,this}setXYZW(e,a,c,p,y){return e*=this.itemSize,this.normalized&&(a=Al(a,this.array),c=Al(c,this.array),p=Al(p,this.array),y=Al(y,this.array)),this.array[e+0]=a,this.array[e+1]=c,this.array[e+2]=p,this.array[e+3]=y,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==E3&&(e.usage=this.usage),e}}class TF extends Ed{constructor(e,a,c){super(new Uint16Array(e),a,c)}}class AF extends Ed{constructor(e,a,c){super(new Uint32Array(e),a,c)}}class Md extends Ed{constructor(e,a,c){super(new Float32Array(e),a,c)}}let W9=0;const lu=new Ba,n2=new Ol,Hv=new un,lc=new cb,e0=new cb,as=new un;class Lm extends By{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:W9++}),this.uuid=sb(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(wF(e)?AF:TF)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,a){return this.attributes[e]=a,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,a,c=0){this.groups.push({start:e,count:a,materialIndex:c})}clearGroups(){this.groups=[]}setDrawRange(e,a){this.drawRange.start=e,this.drawRange.count=a}applyMatrix4(e){const a=this.attributes.position;a!==void 0&&(a.applyMatrix4(e),a.needsUpdate=!0);const c=this.attributes.normal;if(c!==void 0){const y=new wr().getNormalMatrix(e);c.applyNormalMatrix(y),c.needsUpdate=!0}const p=this.attributes.tangent;return p!==void 0&&(p.transformDirection(e),p.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return lu.makeRotationFromQuaternion(e),this.applyMatrix4(lu),this}rotateX(e){return lu.makeRotationX(e),this.applyMatrix4(lu),this}rotateY(e){return lu.makeRotationY(e),this.applyMatrix4(lu),this}rotateZ(e){return lu.makeRotationZ(e),this.applyMatrix4(lu),this}translate(e,a,c){return lu.makeTranslation(e,a,c),this.applyMatrix4(lu),this}scale(e,a,c){return lu.makeScale(e,a,c),this.applyMatrix4(lu),this}lookAt(e){return n2.lookAt(e),n2.updateMatrix(),this.applyMatrix4(n2.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Hv).negate(),this.translate(Hv.x,Hv.y,Hv.z),this}setFromPoints(e){const a=this.getAttribute("position");if(a===void 0){const c=[];for(let p=0,y=e.length;p<y;p++){const M=e[p];c.push(M.x,M.y,M.z||0)}this.setAttribute("position",new Md(c,3))}else{const c=Math.min(e.length,a.count);for(let p=0;p<c;p++){const y=e[p];a.setXYZ(p,y.x,y.y,y.z||0)}e.length>a.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),a.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new cb);const e=this.attributes.position,a=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new un(-1/0,-1/0,-1/0),new un(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),a)for(let c=0,p=a.length;c<p;c++){const y=a[c];lc.setFromBufferAttribute(y),this.morphTargetsRelative?(as.addVectors(this.boundingBox.min,lc.min),this.boundingBox.expandByPoint(as),as.addVectors(this.boundingBox.max,lc.max),this.boundingBox.expandByPoint(as)):(this.boundingBox.expandByPoint(lc.min),this.boundingBox.expandByPoint(lc.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new OR);const e=this.attributes.position,a=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new un,1/0);return}if(e){const c=this.boundingSphere.center;if(lc.setFromBufferAttribute(e),a)for(let y=0,M=a.length;y<M;y++){const r=a[y];e0.setFromBufferAttribute(r),this.morphTargetsRelative?(as.addVectors(lc.min,e0.min),lc.expandByPoint(as),as.addVectors(lc.max,e0.max),lc.expandByPoint(as)):(lc.expandByPoint(e0.min),lc.expandByPoint(e0.max))}lc.getCenter(c);let p=0;for(let y=0,M=e.count;y<M;y++)as.fromBufferAttribute(e,y),p=Math.max(p,c.distanceToSquared(as));if(a)for(let y=0,M=a.length;y<M;y++){const r=a[y],I=this.morphTargetsRelative;for(let k=0,B=r.count;k<B;k++)as.fromBufferAttribute(r,k),I&&(Hv.fromBufferAttribute(e,k),as.add(Hv)),p=Math.max(p,c.distanceToSquared(as))}this.boundingSphere.radius=Math.sqrt(p),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,a=this.attributes;if(e===null||a.position===void 0||a.normal===void 0||a.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const c=a.position,p=a.normal,y=a.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ed(new Float32Array(4*c.count),4));const M=this.getAttribute("tangent"),r=[],I=[];for(let Ve=0;Ve<c.count;Ve++)r[Ve]=new un,I[Ve]=new un;const k=new un,B=new un,U=new un,H=new ma,Y=new ma,X=new ma,Q=new un,J=new un;function j(Ve,Se,xe){k.fromBufferAttribute(c,Ve),B.fromBufferAttribute(c,Se),U.fromBufferAttribute(c,xe),H.fromBufferAttribute(y,Ve),Y.fromBufferAttribute(y,Se),X.fromBufferAttribute(y,xe),B.sub(k),U.sub(k),Y.sub(H),X.sub(H);const Fe=1/(Y.x*X.y-X.x*Y.y);isFinite(Fe)&&(Q.copy(B).multiplyScalar(X.y).addScaledVector(U,-Y.y).multiplyScalar(Fe),J.copy(U).multiplyScalar(Y.x).addScaledVector(B,-X.x).multiplyScalar(Fe),r[Ve].add(Q),r[Se].add(Q),r[xe].add(Q),I[Ve].add(J),I[Se].add(J),I[xe].add(J))}let oe=this.groups;oe.length===0&&(oe=[{start:0,count:e.count}]);for(let Ve=0,Se=oe.length;Ve<Se;++Ve){const xe=oe[Ve],Fe=xe.start,Ct=xe.count;for(let Et=Fe,Tt=Fe+Ct;Et<Tt;Et+=3)j(e.getX(Et+0),e.getX(Et+1),e.getX(Et+2))}const ce=new un,pe=new un,Ae=new un,Ee=new un;function be(Ve){Ae.fromBufferAttribute(p,Ve),Ee.copy(Ae);const Se=r[Ve];ce.copy(Se),ce.sub(Ae.multiplyScalar(Ae.dot(Se))).normalize(),pe.crossVectors(Ee,Se);const Fe=pe.dot(I[Ve])<0?-1:1;M.setXYZW(Ve,ce.x,ce.y,ce.z,Fe)}for(let Ve=0,Se=oe.length;Ve<Se;++Ve){const xe=oe[Ve],Fe=xe.start,Ct=xe.count;for(let Et=Fe,Tt=Fe+Ct;Et<Tt;Et+=3)be(e.getX(Et+0)),be(e.getX(Et+1)),be(e.getX(Et+2))}}computeVertexNormals(){const e=this.index,a=this.getAttribute("position");if(a!==void 0){let c=this.getAttribute("normal");if(c===void 0)c=new Ed(new Float32Array(a.count*3),3),this.setAttribute("normal",c);else for(let H=0,Y=c.count;H<Y;H++)c.setXYZ(H,0,0,0);const p=new un,y=new un,M=new un,r=new un,I=new un,k=new un,B=new un,U=new un;if(e)for(let H=0,Y=e.count;H<Y;H+=3){const X=e.getX(H+0),Q=e.getX(H+1),J=e.getX(H+2);p.fromBufferAttribute(a,X),y.fromBufferAttribute(a,Q),M.fromBufferAttribute(a,J),B.subVectors(M,y),U.subVectors(p,y),B.cross(U),r.fromBufferAttribute(c,X),I.fromBufferAttribute(c,Q),k.fromBufferAttribute(c,J),r.add(B),I.add(B),k.add(B),c.setXYZ(X,r.x,r.y,r.z),c.setXYZ(Q,I.x,I.y,I.z),c.setXYZ(J,k.x,k.y,k.z)}else for(let H=0,Y=a.count;H<Y;H+=3)p.fromBufferAttribute(a,H+0),y.fromBufferAttribute(a,H+1),M.fromBufferAttribute(a,H+2),B.subVectors(M,y),U.subVectors(p,y),B.cross(U),c.setXYZ(H+0,B.x,B.y,B.z),c.setXYZ(H+1,B.x,B.y,B.z),c.setXYZ(H+2,B.x,B.y,B.z);this.normalizeNormals(),c.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let a=0,c=e.count;a<c;a++)as.fromBufferAttribute(e,a),as.normalize(),e.setXYZ(a,as.x,as.y,as.z)}toNonIndexed(){function e(r,I){const k=r.array,B=r.itemSize,U=r.normalized,H=new k.constructor(I.length*B);let Y=0,X=0;for(let Q=0,J=I.length;Q<J;Q++){r.isInterleavedBufferAttribute?Y=I[Q]*r.data.stride+r.offset:Y=I[Q]*B;for(let j=0;j<B;j++)H[X++]=k[Y++]}return new Ed(H,B,U)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const a=new Lm,c=this.index.array,p=this.attributes;for(const r in p){const I=p[r],k=e(I,c);a.setAttribute(r,k)}const y=this.morphAttributes;for(const r in y){const I=[],k=y[r];for(let B=0,U=k.length;B<U;B++){const H=k[B],Y=e(H,c);I.push(Y)}a.morphAttributes[r]=I}a.morphTargetsRelative=this.morphTargetsRelative;const M=this.groups;for(let r=0,I=M.length;r<I;r++){const k=M[r];a.addGroup(k.start,k.count,k.materialIndex)}return a}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const I=this.parameters;for(const k in I)I[k]!==void 0&&(e[k]=I[k]);return e}e.data={attributes:{}};const a=this.index;a!==null&&(e.data.index={type:a.array.constructor.name,array:Array.prototype.slice.call(a.array)});const c=this.attributes;for(const I in c){const k=c[I];e.data.attributes[I]=k.toJSON(e.data)}const p={};let y=!1;for(const I in this.morphAttributes){const k=this.morphAttributes[I],B=[];for(let U=0,H=k.length;U<H;U++){const Y=k[U];B.push(Y.toJSON(e.data))}B.length>0&&(p[I]=B,y=!0)}y&&(e.data.morphAttributes=p,e.data.morphTargetsRelative=this.morphTargetsRelative);const M=this.groups;M.length>0&&(e.data.groups=JSON.parse(JSON.stringify(M)));const r=this.boundingSphere;return r!==null&&(e.data.boundingSphere={center:r.center.toArray(),radius:r.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const a={};this.name=e.name;const c=e.index;c!==null&&this.setIndex(c.clone(a));const p=e.attributes;for(const k in p){const B=p[k];this.setAttribute(k,B.clone(a))}const y=e.morphAttributes;for(const k in y){const B=[],U=y[k];for(let H=0,Y=U.length;H<Y;H++)B.push(U[H].clone(a));this.morphAttributes[k]=B}this.morphTargetsRelative=e.morphTargetsRelative;const M=e.groups;for(let k=0,B=M.length;k<B;k++){const U=M[k];this.addGroup(U.start,U.count,U.materialIndex)}const r=e.boundingBox;r!==null&&(this.boundingBox=r.clone());const I=e.boundingSphere;return I!==null&&(this.boundingSphere=I.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const N3=new Ba,qg=new F9,V1=new OR,B3=new un,j1=new un,G1=new un,H1=new un,i2=new un,q1=new un,U3=new un,W1=new un;class dc extends Ol{constructor(e=new Lm,a=new X0){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=a,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,a){return super.copy(e,a),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const a=this.geometry.morphAttributes,c=Object.keys(a);if(c.length>0){const p=a[c[0]];if(p!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let y=0,M=p.length;y<M;y++){const r=p[y].name||String(y);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=y}}}}getVertexPosition(e,a){const c=this.geometry,p=c.attributes.position,y=c.morphAttributes.position,M=c.morphTargetsRelative;a.fromBufferAttribute(p,e);const r=this.morphTargetInfluences;if(y&&r){q1.set(0,0,0);for(let I=0,k=y.length;I<k;I++){const B=r[I],U=y[I];B!==0&&(i2.fromBufferAttribute(U,e),M?q1.addScaledVector(i2,B):q1.addScaledVector(i2.sub(a),B))}a.add(q1)}return a}raycast(e,a){const c=this.geometry,p=this.material,y=this.matrixWorld;p!==void 0&&(c.boundingSphere===null&&c.computeBoundingSphere(),V1.copy(c.boundingSphere),V1.applyMatrix4(y),qg.copy(e.ray).recast(e.near),!(V1.containsPoint(qg.origin)===!1&&(qg.intersectSphere(V1,B3)===null||qg.origin.distanceToSquared(B3)>(e.far-e.near)**2))&&(N3.copy(y).invert(),qg.copy(e.ray).applyMatrix4(N3),!(c.boundingBox!==null&&qg.intersectsBox(c.boundingBox)===!1)&&this._computeIntersections(e,a,qg)))}_computeIntersections(e,a,c){let p;const y=this.geometry,M=this.material,r=y.index,I=y.attributes.position,k=y.attributes.uv,B=y.attributes.uv1,U=y.attributes.normal,H=y.groups,Y=y.drawRange;if(r!==null)if(Array.isArray(M))for(let X=0,Q=H.length;X<Q;X++){const J=H[X],j=M[J.materialIndex],oe=Math.max(J.start,Y.start),ce=Math.min(r.count,Math.min(J.start+J.count,Y.start+Y.count));for(let pe=oe,Ae=ce;pe<Ae;pe+=3){const Ee=r.getX(pe),be=r.getX(pe+1),Ve=r.getX(pe+2);p=$1(this,j,e,c,k,B,U,Ee,be,Ve),p&&(p.faceIndex=Math.floor(pe/3),p.face.materialIndex=J.materialIndex,a.push(p))}}else{const X=Math.max(0,Y.start),Q=Math.min(r.count,Y.start+Y.count);for(let J=X,j=Q;J<j;J+=3){const oe=r.getX(J),ce=r.getX(J+1),pe=r.getX(J+2);p=$1(this,M,e,c,k,B,U,oe,ce,pe),p&&(p.faceIndex=Math.floor(J/3),a.push(p))}}else if(I!==void 0)if(Array.isArray(M))for(let X=0,Q=H.length;X<Q;X++){const J=H[X],j=M[J.materialIndex],oe=Math.max(J.start,Y.start),ce=Math.min(I.count,Math.min(J.start+J.count,Y.start+Y.count));for(let pe=oe,Ae=ce;pe<Ae;pe+=3){const Ee=pe,be=pe+1,Ve=pe+2;p=$1(this,j,e,c,k,B,U,Ee,be,Ve),p&&(p.faceIndex=Math.floor(pe/3),p.face.materialIndex=J.materialIndex,a.push(p))}}else{const X=Math.max(0,Y.start),Q=Math.min(I.count,Y.start+Y.count);for(let J=X,j=Q;J<j;J+=3){const oe=J,ce=J+1,pe=J+2;p=$1(this,M,e,c,k,B,U,oe,ce,pe),p&&(p.faceIndex=Math.floor(J/3),a.push(p))}}}}function $9(t,e,a,c,p,y,M,r){let I;if(e.side===Ll?I=c.intersectTriangle(M,y,p,!0,r):I=c.intersectTriangle(p,y,M,e.side===Am,r),I===null)return null;W1.copy(r),W1.applyMatrix4(t.matrixWorld);const k=a.ray.origin.distanceTo(W1);return k<a.near||k>a.far?null:{distance:k,point:W1.clone(),object:t}}function $1(t,e,a,c,p,y,M,r,I,k){t.getVertexPosition(r,j1),t.getVertexPosition(I,G1),t.getVertexPosition(k,H1);const B=$9(t,e,a,c,j1,G1,H1,U3);if(B){const U=new un;ah.getBarycoord(U3,j1,G1,H1,U),p&&(B.uv=ah.getInterpolatedAttribute(p,r,I,k,U,new ma)),y&&(B.uv1=ah.getInterpolatedAttribute(y,r,I,k,U,new ma)),M&&(B.normal=ah.getInterpolatedAttribute(M,r,I,k,U,new un),B.normal.dot(c.direction)>0&&B.normal.multiplyScalar(-1));const H={a:r,b:I,c:k,normal:new un,materialIndex:0};ah.getNormal(j1,G1,H1,H.normal),B.face=H,B.barycoord=U}return B}class g_ extends Lm{constructor(e=1,a=1,c=1,p=1,y=1,M=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:a,depth:c,widthSegments:p,heightSegments:y,depthSegments:M};const r=this;p=Math.floor(p),y=Math.floor(y),M=Math.floor(M);const I=[],k=[],B=[],U=[];let H=0,Y=0;X("z","y","x",-1,-1,c,a,e,M,y,0),X("z","y","x",1,-1,c,a,-e,M,y,1),X("x","z","y",1,1,e,c,a,p,M,2),X("x","z","y",1,-1,e,c,-a,p,M,3),X("x","y","z",1,-1,e,a,c,p,y,4),X("x","y","z",-1,-1,e,a,-c,p,y,5),this.setIndex(I),this.setAttribute("position",new Md(k,3)),this.setAttribute("normal",new Md(B,3)),this.setAttribute("uv",new Md(U,2));function X(Q,J,j,oe,ce,pe,Ae,Ee,be,Ve,Se){const xe=pe/be,Fe=Ae/Ve,Ct=pe/2,Et=Ae/2,Tt=Ee/2,_t=be+1,et=Ve+1;let Lt=0,lt=0;const ut=new un;for(let Xe=0;Xe<et;Xe++){const kt=Xe*Fe-Et;for(let _n=0;_n<_t;_n++){const Xt=_n*xe-Ct;ut[Q]=Xt*oe,ut[J]=kt*ce,ut[j]=Tt,k.push(ut.x,ut.y,ut.z),ut[Q]=0,ut[J]=0,ut[j]=Ee>0?1:-1,B.push(ut.x,ut.y,ut.z),U.push(_n/be),U.push(1-Xe/Ve),Lt+=1}}for(let Xe=0;Xe<Ve;Xe++)for(let kt=0;kt<be;kt++){const _n=H+kt+_t*Xe,Xt=H+kt+_t*(Xe+1),It=H+(kt+1)+_t*(Xe+1),ln=H+(kt+1)+_t*Xe;I.push(_n,Xt,ln),I.push(Xt,It,ln),lt+=6}r.addGroup(Y,lt,Se),Y+=lt,H+=Lt}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new g_(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Cy(t){const e={};for(const a in t){e[a]={};for(const c in t[a]){const p=t[a][c];p&&(p.isColor||p.isMatrix3||p.isMatrix4||p.isVector2||p.isVector3||p.isVector4||p.isTexture||p.isQuaternion)?p.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[a][c]=null):e[a][c]=p.clone():Array.isArray(p)?e[a][c]=p.slice():e[a][c]=p}}return e}function ll(t){const e={};for(let a=0;a<t.length;a++){const c=Cy(t[a]);for(const p in c)e[p]=c[p]}return e}function X9(t){const e=[];for(let a=0;a<t.length;a++)e.push(t[a].clone());return e}function CF(t){const e=t.getRenderTarget();return e===null?t.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:ta.workingColorSpace}const Z9={clone:Cy,merge:ll};var Y9=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,K9=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Cm extends ub{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Y9,this.fragmentShader=K9,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Cy(e.uniforms),this.uniformsGroups=X9(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const a=super.toJSON(e);a.glslVersion=this.glslVersion,a.uniforms={};for(const p in this.uniforms){const M=this.uniforms[p].value;M&&M.isTexture?a.uniforms[p]={type:"t",value:M.toJSON(e).uuid}:M&&M.isColor?a.uniforms[p]={type:"c",value:M.getHex()}:M&&M.isVector2?a.uniforms[p]={type:"v2",value:M.toArray()}:M&&M.isVector3?a.uniforms[p]={type:"v3",value:M.toArray()}:M&&M.isVector4?a.uniforms[p]={type:"v4",value:M.toArray()}:M&&M.isMatrix3?a.uniforms[p]={type:"m3",value:M.toArray()}:M&&M.isMatrix4?a.uniforms[p]={type:"m4",value:M.toArray()}:a.uniforms[p]={value:M}}Object.keys(this.defines).length>0&&(a.defines=this.defines),a.vertexShader=this.vertexShader,a.fragmentShader=this.fragmentShader,a.lights=this.lights,a.clipping=this.clipping;const c={};for(const p in this.extensions)this.extensions[p]===!0&&(c[p]=!0);return Object.keys(c).length>0&&(a.extensions=c),a}}class RF extends Ol{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ba,this.projectionMatrix=new Ba,this.projectionMatrixInverse=new Ba,this.coordinateSystem=qf}copy(e,a){return super.copy(e,a),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,a){super.updateWorldMatrix(e,a),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const lm=new un,V3=new ma,j3=new ma;class hu extends RF{constructor(e=50,a=1,c=.1,p=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=c,this.far=p,this.focus=10,this.aspect=a,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,a){return super.copy(e,a),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const a=.5*this.getFilmHeight()/e;this.fov=BA*2*Math.atan(a),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(FT*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return BA*2*Math.atan(Math.tan(FT*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,a,c){lm.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),a.set(lm.x,lm.y).multiplyScalar(-e/lm.z),lm.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),c.set(lm.x,lm.y).multiplyScalar(-e/lm.z)}getViewSize(e,a){return this.getViewBounds(e,V3,j3),a.subVectors(j3,V3)}setViewOffset(e,a,c,p,y,M){this.aspect=e/a,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=a,this.view.offsetX=c,this.view.offsetY=p,this.view.width=y,this.view.height=M,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let a=e*Math.tan(FT*.5*this.fov)/this.zoom,c=2*a,p=this.aspect*c,y=-.5*p;const M=this.view;if(this.view!==null&&this.view.enabled){const I=M.fullWidth,k=M.fullHeight;y+=M.offsetX*p/I,a-=M.offsetY*c/k,p*=M.width/I,c*=M.height/k}const r=this.filmOffset;r!==0&&(y+=e*r/this.getFilmWidth()),this.projectionMatrix.makePerspective(y,y+p,a,a-c,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const a=super.toJSON(e);return a.object.fov=this.fov,a.object.zoom=this.zoom,a.object.near=this.near,a.object.far=this.far,a.object.focus=this.focus,a.object.aspect=this.aspect,this.view!==null&&(a.object.view=Object.assign({},this.view)),a.object.filmGauge=this.filmGauge,a.object.filmOffset=this.filmOffset,a}}const qv=-90,Wv=1;class J9 extends Ol{constructor(e,a,c){super(),this.type="CubeCamera",this.renderTarget=c,this.coordinateSystem=null,this.activeMipmapLevel=0;const p=new hu(qv,Wv,e,a);p.layers=this.layers,this.add(p);const y=new hu(qv,Wv,e,a);y.layers=this.layers,this.add(y);const M=new hu(qv,Wv,e,a);M.layers=this.layers,this.add(M);const r=new hu(qv,Wv,e,a);r.layers=this.layers,this.add(r);const I=new hu(qv,Wv,e,a);I.layers=this.layers,this.add(I);const k=new hu(qv,Wv,e,a);k.layers=this.layers,this.add(k)}updateCoordinateSystem(){const e=this.coordinateSystem,a=this.children.concat(),[c,p,y,M,r,I]=a;for(const k of a)this.remove(k);if(e===qf)c.up.set(0,1,0),c.lookAt(1,0,0),p.up.set(0,1,0),p.lookAt(-1,0,0),y.up.set(0,0,-1),y.lookAt(0,1,0),M.up.set(0,0,1),M.lookAt(0,-1,0),r.up.set(0,1,0),r.lookAt(0,0,1),I.up.set(0,1,0),I.lookAt(0,0,-1);else if(e===iE)c.up.set(0,-1,0),c.lookAt(-1,0,0),p.up.set(0,-1,0),p.lookAt(1,0,0),y.up.set(0,0,1),y.lookAt(0,1,0),M.up.set(0,0,-1),M.lookAt(0,-1,0),r.up.set(0,-1,0),r.lookAt(0,0,1),I.up.set(0,-1,0),I.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const k of a)this.add(k),k.updateMatrixWorld()}update(e,a){this.parent===null&&this.updateMatrixWorld();const{renderTarget:c,activeMipmapLevel:p}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[y,M,r,I,k,B]=this.children,U=e.getRenderTarget(),H=e.getActiveCubeFace(),Y=e.getActiveMipmapLevel(),X=e.xr.enabled;e.xr.enabled=!1;const Q=c.texture.generateMipmaps;c.texture.generateMipmaps=!1,e.setRenderTarget(c,0,p),e.render(a,y),e.setRenderTarget(c,1,p),e.render(a,M),e.setRenderTarget(c,2,p),e.render(a,r),e.setRenderTarget(c,3,p),e.render(a,I),e.setRenderTarget(c,4,p),e.render(a,k),c.texture.generateMipmaps=Q,e.setRenderTarget(c,5,p),e.render(a,B),e.setRenderTarget(U,H,Y),e.xr.enabled=X,c.texture.needsPMREMUpdate=!0}}class IF extends ul{constructor(e,a,c,p,y,M,r,I,k,B){e=e!==void 0?e:[],a=a!==void 0?a:Sy,super(e,a,c,p,y,M,r,I,k,B),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Q9 extends m_{constructor(e=1,a={}){super(e,e,a),this.isWebGLCubeRenderTarget=!0;const c={width:e,height:e,depth:1},p=[c,c,c,c,c,c];this.texture=new IF(p,a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=a.generateMipmaps!==void 0?a.generateMipmaps:!1,this.texture.minFilter=a.minFilter!==void 0?a.minFilter:bd}fromEquirectangularTexture(e,a){this.texture.type=a.type,this.texture.colorSpace=a.colorSpace,this.texture.generateMipmaps=a.generateMipmaps,this.texture.minFilter=a.minFilter,this.texture.magFilter=a.magFilter;const c={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},p=new g_(5,5,5),y=new Cm({name:"CubemapFromEquirect",uniforms:Cy(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,side:Ll,blending:ym});y.uniforms.tEquirect.value=a;const M=new dc(p,y),r=a.minFilter;return a.minFilter===l_&&(a.minFilter=bd),new J9(1,10,this).update(e,M),a.minFilter=r,M.geometry.dispose(),M.material.dispose(),this}clear(e,a,c,p){const y=e.getRenderTarget();for(let M=0;M<6;M++)e.setRenderTarget(this,M),e.clear(a,c,p);e.setRenderTarget(y)}}class a0 extends Ol{constructor(){super(),this.isGroup=!0,this.type="Group"}}const e$={type:"move"};class r2{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new a0,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new a0,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new un,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new un),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new a0,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new un,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new un),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const a=this._hand;if(a)for(const c of e.hand.values())this._getHandJoint(a,c)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,a,c){let p=null,y=null,M=null;const r=this._targetRay,I=this._grip,k=this._hand;if(e&&a.session.visibilityState!=="visible-blurred"){if(k&&e.hand){M=!0;for(const Q of e.hand.values()){const J=a.getJointPose(Q,c),j=this._getHandJoint(k,Q);J!==null&&(j.matrix.fromArray(J.transform.matrix),j.matrix.decompose(j.position,j.rotation,j.scale),j.matrixWorldNeedsUpdate=!0,j.jointRadius=J.radius),j.visible=J!==null}const B=k.joints["index-finger-tip"],U=k.joints["thumb-tip"],H=B.position.distanceTo(U.position),Y=.02,X=.005;k.inputState.pinching&&H>Y+X?(k.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!k.inputState.pinching&&H<=Y-X&&(k.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else I!==null&&e.gripSpace&&(y=a.getPose(e.gripSpace,c),y!==null&&(I.matrix.fromArray(y.transform.matrix),I.matrix.decompose(I.position,I.rotation,I.scale),I.matrixWorldNeedsUpdate=!0,y.linearVelocity?(I.hasLinearVelocity=!0,I.linearVelocity.copy(y.linearVelocity)):I.hasLinearVelocity=!1,y.angularVelocity?(I.hasAngularVelocity=!0,I.angularVelocity.copy(y.angularVelocity)):I.hasAngularVelocity=!1));r!==null&&(p=a.getPose(e.targetRaySpace,c),p===null&&y!==null&&(p=y),p!==null&&(r.matrix.fromArray(p.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,p.linearVelocity?(r.hasLinearVelocity=!0,r.linearVelocity.copy(p.linearVelocity)):r.hasLinearVelocity=!1,p.angularVelocity?(r.hasAngularVelocity=!0,r.angularVelocity.copy(p.angularVelocity)):r.hasAngularVelocity=!1,this.dispatchEvent(e$)))}return r!==null&&(r.visible=p!==null),I!==null&&(I.visible=y!==null),k!==null&&(k.visible=M!==null),this}_getHandJoint(e,a){if(e.joints[a.jointName]===void 0){const c=new a0;c.matrixAutoUpdate=!1,c.visible=!1,e.joints[a.jointName]=c,e.add(c)}return e.joints[a.jointName]}}class t$ extends Ol{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Ad,this.environmentIntensity=1,this.environmentRotation=new Ad,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,a){return super.copy(e,a),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const a=super.toJSON(e);return this.fog!==null&&(a.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(a.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(a.object.backgroundIntensity=this.backgroundIntensity),a.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(a.object.environmentIntensity=this.environmentIntensity),a.object.environmentRotation=this.environmentRotation.toArray(),a}}const a2=new un,n$=new un,i$=new wr;class Yg{constructor(e=new un(1,0,0),a=0){this.isPlane=!0,this.normal=e,this.constant=a}set(e,a){return this.normal.copy(e),this.constant=a,this}setComponents(e,a,c,p){return this.normal.set(e,a,c),this.constant=p,this}setFromNormalAndCoplanarPoint(e,a){return this.normal.copy(e),this.constant=-a.dot(this.normal),this}setFromCoplanarPoints(e,a,c){const p=a2.subVectors(c,a).cross(n$.subVectors(e,a)).normalize();return this.setFromNormalAndCoplanarPoint(p,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,a){return a.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,a){const c=e.delta(a2),p=this.normal.dot(c);if(p===0)return this.distanceToPoint(e.start)===0?a.copy(e.start):null;const y=-(e.start.dot(this.normal)+this.constant)/p;return y<0||y>1?null:a.copy(e.start).addScaledVector(c,y)}intersectsLine(e){const a=this.distanceToPoint(e.start),c=this.distanceToPoint(e.end);return a<0&&c>0||c<0&&a>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,a){const c=a||i$.getNormalMatrix(e),p=this.coplanarPoint(a2).applyMatrix4(e),y=this.normal.applyMatrix3(c).normalize();return this.constant=-p.dot(y),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Wg=new OR,X1=new un;class DF{constructor(e=new Yg,a=new Yg,c=new Yg,p=new Yg,y=new Yg,M=new Yg){this.planes=[e,a,c,p,y,M]}set(e,a,c,p,y,M){const r=this.planes;return r[0].copy(e),r[1].copy(a),r[2].copy(c),r[3].copy(p),r[4].copy(y),r[5].copy(M),this}copy(e){const a=this.planes;for(let c=0;c<6;c++)a[c].copy(e.planes[c]);return this}setFromProjectionMatrix(e,a=qf){const c=this.planes,p=e.elements,y=p[0],M=p[1],r=p[2],I=p[3],k=p[4],B=p[5],U=p[6],H=p[7],Y=p[8],X=p[9],Q=p[10],J=p[11],j=p[12],oe=p[13],ce=p[14],pe=p[15];if(c[0].setComponents(I-y,H-k,J-Y,pe-j).normalize(),c[1].setComponents(I+y,H+k,J+Y,pe+j).normalize(),c[2].setComponents(I+M,H+B,J+X,pe+oe).normalize(),c[3].setComponents(I-M,H-B,J-X,pe-oe).normalize(),c[4].setComponents(I-r,H-U,J-Q,pe-ce).normalize(),a===qf)c[5].setComponents(I+r,H+U,J+Q,pe+ce).normalize();else if(a===iE)c[5].setComponents(r,U,Q,ce).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+a);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Wg.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const a=e.geometry;a.boundingSphere===null&&a.computeBoundingSphere(),Wg.copy(a.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Wg)}intersectsSprite(e){return Wg.center.set(0,0,0),Wg.radius=.7071067811865476,Wg.applyMatrix4(e.matrixWorld),this.intersectsSphere(Wg)}intersectsSphere(e){const a=this.planes,c=e.center,p=-e.radius;for(let y=0;y<6;y++)if(a[y].distanceToPoint(c)<p)return!1;return!0}intersectsBox(e){const a=this.planes;for(let c=0;c<6;c++){const p=a[c];if(X1.x=p.normal.x>0?e.max.x:e.min.x,X1.y=p.normal.y>0?e.max.y:e.min.y,X1.z=p.normal.z>0?e.max.z:e.min.z,p.distanceToPoint(X1)<0)return!1}return!0}containsPoint(e){const a=this.planes;for(let c=0;c<6;c++)if(a[c].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class PF extends ul{constructor(e,a,c,p,y,M,r,I,k,B=_y){if(B!==_y&&B!==Ty)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");c===void 0&&B===_y&&(c=p_),c===void 0&&B===Ty&&(c=My),super(null,p,y,M,r,I,B,c,k),this.isDepthTexture=!0,this.image={width:e,height:a},this.magFilter=r!==void 0?r:uh,this.minFilter=I!==void 0?I:uh,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new LR(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const a=super.toJSON(e);return this.compareFunction!==null&&(a.compareFunction=this.compareFunction),a}}class LE extends Lm{constructor(e=1,a=1,c=1,p=32,y=1,M=!1,r=0,I=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:a,height:c,radialSegments:p,heightSegments:y,openEnded:M,thetaStart:r,thetaLength:I};const k=this;p=Math.floor(p),y=Math.floor(y);const B=[],U=[],H=[],Y=[];let X=0;const Q=[],J=c/2;let j=0;oe(),M===!1&&(e>0&&ce(!0),a>0&&ce(!1)),this.setIndex(B),this.setAttribute("position",new Md(U,3)),this.setAttribute("normal",new Md(H,3)),this.setAttribute("uv",new Md(Y,2));function oe(){const pe=new un,Ae=new un;let Ee=0;const be=(a-e)/c;for(let Ve=0;Ve<=y;Ve++){const Se=[],xe=Ve/y,Fe=xe*(a-e)+e;for(let Ct=0;Ct<=p;Ct++){const Et=Ct/p,Tt=Et*I+r,_t=Math.sin(Tt),et=Math.cos(Tt);Ae.x=Fe*_t,Ae.y=-xe*c+J,Ae.z=Fe*et,U.push(Ae.x,Ae.y,Ae.z),pe.set(_t,be,et).normalize(),H.push(pe.x,pe.y,pe.z),Y.push(Et,1-xe),Se.push(X++)}Q.push(Se)}for(let Ve=0;Ve<p;Ve++)for(let Se=0;Se<y;Se++){const xe=Q[Se][Ve],Fe=Q[Se+1][Ve],Ct=Q[Se+1][Ve+1],Et=Q[Se][Ve+1];(e>0||Se!==0)&&(B.push(xe,Fe,Et),Ee+=3),(a>0||Se!==y-1)&&(B.push(Fe,Ct,Et),Ee+=3)}k.addGroup(j,Ee,0),j+=Ee}function ce(pe){const Ae=X,Ee=new ma,be=new un;let Ve=0;const Se=pe===!0?e:a,xe=pe===!0?1:-1;for(let Ct=1;Ct<=p;Ct++)U.push(0,J*xe,0),H.push(0,xe,0),Y.push(.5,.5),X++;const Fe=X;for(let Ct=0;Ct<=p;Ct++){const Tt=Ct/p*I+r,_t=Math.cos(Tt),et=Math.sin(Tt);be.x=Se*et,be.y=J*xe,be.z=Se*_t,U.push(be.x,be.y,be.z),H.push(0,xe,0),Ee.x=_t*.5+.5,Ee.y=et*.5*xe+.5,Y.push(Ee.x,Ee.y),X++}for(let Ct=0;Ct<p;Ct++){const Et=Ae+Ct,Tt=Fe+Ct;pe===!0?B.push(Tt,Tt+1,Et):B.push(Tt+1,Tt,Et),Ve+=3}k.addGroup(j,Ve,pe===!0?1:2),j+=Ve}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new LE(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class zR extends LE{constructor(e=1,a=1,c=32,p=1,y=!1,M=0,r=Math.PI*2){super(0,e,a,c,p,y,M,r),this.type="ConeGeometry",this.parameters={radius:e,height:a,radialSegments:c,heightSegments:p,openEnded:y,thetaStart:M,thetaLength:r}}static fromJSON(e){return new zR(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class OE extends Lm{constructor(e=1,a=1,c=1,p=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:a,widthSegments:c,heightSegments:p};const y=e/2,M=a/2,r=Math.floor(c),I=Math.floor(p),k=r+1,B=I+1,U=e/r,H=a/I,Y=[],X=[],Q=[],J=[];for(let j=0;j<B;j++){const oe=j*H-M;for(let ce=0;ce<k;ce++){const pe=ce*U-y;X.push(pe,-oe,0),Q.push(0,0,1),J.push(ce/r),J.push(1-j/I)}}for(let j=0;j<I;j++)for(let oe=0;oe<r;oe++){const ce=oe+k*j,pe=oe+k*(j+1),Ae=oe+1+k*(j+1),Ee=oe+1+k*j;Y.push(ce,pe,Ee),Y.push(pe,Ae,Ee)}this.setIndex(Y),this.setAttribute("position",new Md(X,3)),this.setAttribute("normal",new Md(Q,3)),this.setAttribute("uv",new Md(J,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new OE(e.width,e.height,e.widthSegments,e.heightSegments)}}class r$ extends ub{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new sa(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new sa(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xF,this.normalScale=new ma(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ad,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class a$ extends ub{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=m9,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class o$ extends ub{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const G3={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class s${constructor(e,a,c){const p=this;let y=!1,M=0,r=0,I;const k=[];this.onStart=void 0,this.onLoad=e,this.onProgress=a,this.onError=c,this.itemStart=function(B){r++,y===!1&&p.onStart!==void 0&&p.onStart(B,M,r),y=!0},this.itemEnd=function(B){M++,p.onProgress!==void 0&&p.onProgress(B,M,r),M===r&&(y=!1,p.onLoad!==void 0&&p.onLoad())},this.itemError=function(B){p.onError!==void 0&&p.onError(B)},this.resolveURL=function(B){return I?I(B):B},this.setURLModifier=function(B){return I=B,this},this.addHandler=function(B,U){return k.push(B,U),this},this.removeHandler=function(B){const U=k.indexOf(B);return U!==-1&&k.splice(U,2),this},this.getHandler=function(B){for(let U=0,H=k.length;U<H;U+=2){const Y=k[U],X=k[U+1];if(Y.global&&(Y.lastIndex=0),Y.test(B))return X}return null}}}const l$=new s$;class kR{constructor(e){this.manager=e!==void 0?e:l$,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,a){const c=this;return new Promise(function(p,y){c.load(e,p,a,y)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}kR.DEFAULT_MATERIAL_NAME="__DEFAULT";class c$ extends kR{constructor(e){super(e)}load(e,a,c,p){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const y=this,M=G3.get(e);if(M!==void 0)return y.manager.itemStart(e),setTimeout(function(){a&&a(M),y.manager.itemEnd(e)},0),M;const r=$0("img");function I(){B(),G3.add(e,this),a&&a(this),y.manager.itemEnd(e)}function k(U){B(),p&&p(U),y.manager.itemError(e),y.manager.itemEnd(e)}function B(){r.removeEventListener("load",I,!1),r.removeEventListener("error",k,!1)}return r.addEventListener("load",I,!1),r.addEventListener("error",k,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(r.crossOrigin=this.crossOrigin),y.manager.itemStart(e),r.src=e,r}}class u$ extends kR{constructor(e){super(e)}load(e,a,c,p){const y=new ul,M=new c$(this.manager);return M.setCrossOrigin(this.crossOrigin),M.setPath(this.path),M.load(e,function(r){y.image=r,y.needsUpdate=!0,a!==void 0&&a(y)},c,p),y}}class h$ extends Ol{constructor(e,a=1){super(),this.isLight=!0,this.type="Light",this.color=new sa(e),this.intensity=a}dispose(){}copy(e,a){return super.copy(e,a),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const a=super.toJSON(e);return a.object.color=this.color.getHex(),a.object.intensity=this.intensity,this.groundColor!==void 0&&(a.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(a.object.distance=this.distance),this.angle!==void 0&&(a.object.angle=this.angle),this.decay!==void 0&&(a.object.decay=this.decay),this.penumbra!==void 0&&(a.object.penumbra=this.penumbra),this.shadow!==void 0&&(a.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(a.object.target=this.target.uuid),a}}class d$ extends RF{constructor(e=-1,a=1,c=1,p=-1,y=.1,M=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=a,this.top=c,this.bottom=p,this.near=y,this.far=M,this.updateProjectionMatrix()}copy(e,a){return super.copy(e,a),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,a,c,p,y,M){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=a,this.view.offsetX=c,this.view.offsetY=p,this.view.width=y,this.view.height=M,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),a=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,p=(this.top+this.bottom)/2;let y=c-e,M=c+e,r=p+a,I=p-a;if(this.view!==null&&this.view.enabled){const k=(this.right-this.left)/this.view.fullWidth/this.zoom,B=(this.top-this.bottom)/this.view.fullHeight/this.zoom;y+=k*this.view.offsetX,M=y+k*this.view.width,r-=B*this.view.offsetY,I=r-B*this.view.height}this.projectionMatrix.makeOrthographic(y,M,r,I,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const a=super.toJSON(e);return a.object.zoom=this.zoom,a.object.left=this.left,a.object.right=this.right,a.object.top=this.top,a.object.bottom=this.bottom,a.object.near=this.near,a.object.far=this.far,this.view!==null&&(a.object.view=Object.assign({},this.view)),a}}class f$ extends h${constructor(e,a){super(e,a),this.isAmbientLight=!0,this.type="AmbientLight"}}class p$ extends hu{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e,this.index=0}}function H3(t,e,a,c){const p=m$(c);switch(a){case fF:return t*e;case mF:return t*e;case gF:return t*e*2;case _F:return t*e/p.components*p.byteLength;case IR:return t*e/p.components*p.byteLength;case vF:return t*e*2/p.components*p.byteLength;case DR:return t*e*2/p.components*p.byteLength;case pF:return t*e*3/p.components*p.byteLength;case oh:return t*e*4/p.components*p.byteLength;case PR:return t*e*4/p.components*p.byteLength;case ow:case sw:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case lw:case cw:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case pA:case gA:return Math.max(t,16)*Math.max(e,8)/4;case fA:case mA:return Math.max(t,8)*Math.max(e,8)/2;case _A:case vA:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case yA:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case xA:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case bA:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case wA:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case SA:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case EA:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case MA:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case TA:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case AA:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case CA:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case RA:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case IA:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case DA:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case PA:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case LA:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case uw:case OA:case zA:return Math.ceil(t/4)*Math.ceil(e/4)*16;case yF:case kA:return Math.ceil(t/4)*Math.ceil(e/4)*8;case FA:case NA:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${a} format.`)}function m$(t){switch(t){case tp:case uF:return{byteLength:1,components:1};case W0:case hF:case ob:return{byteLength:2,components:1};case CR:case RR:return{byteLength:2,components:4};case p_:case AR:case Hf:return{byteLength:4,components:1};case dF:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:TR}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=TR);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function LF(){let t=null,e=!1,a=null,c=null;function p(y,M){a(y,M),c=t.requestAnimationFrame(p)}return{start:function(){e!==!0&&a!==null&&(c=t.requestAnimationFrame(p),e=!0)},stop:function(){t.cancelAnimationFrame(c),e=!1},setAnimationLoop:function(y){a=y},setContext:function(y){t=y}}}function g$(t){const e=new WeakMap;function a(r,I){const k=r.array,B=r.usage,U=k.byteLength,H=t.createBuffer();t.bindBuffer(I,H),t.bufferData(I,k,B),r.onUploadCallback();let Y;if(k instanceof Float32Array)Y=t.FLOAT;else if(k instanceof Uint16Array)r.isFloat16BufferAttribute?Y=t.HALF_FLOAT:Y=t.UNSIGNED_SHORT;else if(k instanceof Int16Array)Y=t.SHORT;else if(k instanceof Uint32Array)Y=t.UNSIGNED_INT;else if(k instanceof Int32Array)Y=t.INT;else if(k instanceof Int8Array)Y=t.BYTE;else if(k instanceof Uint8Array)Y=t.UNSIGNED_BYTE;else if(k instanceof Uint8ClampedArray)Y=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+k);return{buffer:H,type:Y,bytesPerElement:k.BYTES_PER_ELEMENT,version:r.version,size:U}}function c(r,I,k){const B=I.array,U=I.updateRanges;if(t.bindBuffer(k,r),U.length===0)t.bufferSubData(k,0,B);else{U.sort((Y,X)=>Y.start-X.start);let H=0;for(let Y=1;Y<U.length;Y++){const X=U[H],Q=U[Y];Q.start<=X.start+X.count+1?X.count=Math.max(X.count,Q.start+Q.count-X.start):(++H,U[H]=Q)}U.length=H+1;for(let Y=0,X=U.length;Y<X;Y++){const Q=U[Y];t.bufferSubData(k,Q.start*B.BYTES_PER_ELEMENT,B,Q.start,Q.count)}I.clearUpdateRanges()}I.onUploadCallback()}function p(r){return r.isInterleavedBufferAttribute&&(r=r.data),e.get(r)}function y(r){r.isInterleavedBufferAttribute&&(r=r.data);const I=e.get(r);I&&(t.deleteBuffer(I.buffer),e.delete(r))}function M(r,I){if(r.isInterleavedBufferAttribute&&(r=r.data),r.isGLBufferAttribute){const B=e.get(r);(!B||B.version<r.version)&&e.set(r,{buffer:r.buffer,type:r.type,bytesPerElement:r.elementSize,version:r.version});return}const k=e.get(r);if(k===void 0)e.set(r,a(r,I));else if(k.version<r.version){if(k.size!==r.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");c(k.buffer,r,I),k.version=r.version}}return{get:p,remove:y,update:M}}var _$=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,v$=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,y$=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,x$=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,b$=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,w$=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,S$=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,E$=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,M$=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,T$=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,A$=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,C$=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,R$=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,I$=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,D$=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,P$=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,L$=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,O$=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,z$=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,k$=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,F$=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,N$=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,B$=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,U$=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,V$=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,j$=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,G$=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,H$=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,q$=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,W$=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,$$="gl_FragColor = linearToOutputTexel( gl_FragColor );",X$=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Z$=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Y$=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,K$=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,J$=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Q$=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,eX=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,tX=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,nX=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,iX=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,rX=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,aX=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,oX=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,sX=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lX=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,cX=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,uX=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,hX=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,dX=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,fX=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,pX=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,mX=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,gX=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,_X=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,vX=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,yX=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,xX=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,bX=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,wX=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,SX=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,EX=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,MX=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,TX=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,AX=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,CX=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,RX=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,IX=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,DX=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,PX=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,LX=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,OX=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,zX=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,kX=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,FX=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,NX=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,BX=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,UX=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,VX=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,jX=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,GX=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,HX=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,qX=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,WX=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,$X=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,XX=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,ZX=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,YX=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,KX=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,JX=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,QX=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,eZ=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,tZ=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,nZ=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,iZ=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,rZ=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,aZ=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,oZ=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,sZ=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,lZ=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,cZ=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,uZ=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,hZ=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,dZ=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,fZ=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,pZ=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,mZ=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const gZ=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,_Z=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vZ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,yZ=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,xZ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,bZ=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,wZ=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,SZ=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,EZ=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,MZ=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,TZ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,AZ=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,CZ=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,RZ=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,IZ=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,DZ=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,PZ=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,LZ=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,OZ=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,zZ=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,kZ=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,FZ=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,NZ=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,BZ=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,UZ=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,VZ=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,jZ=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,GZ=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,HZ=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,qZ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,WZ=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,$Z=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,XZ=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,ZZ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Ar={alphahash_fragment:_$,alphahash_pars_fragment:v$,alphamap_fragment:y$,alphamap_pars_fragment:x$,alphatest_fragment:b$,alphatest_pars_fragment:w$,aomap_fragment:S$,aomap_pars_fragment:E$,batching_pars_vertex:M$,batching_vertex:T$,begin_vertex:A$,beginnormal_vertex:C$,bsdfs:R$,iridescence_fragment:I$,bumpmap_pars_fragment:D$,clipping_planes_fragment:P$,clipping_planes_pars_fragment:L$,clipping_planes_pars_vertex:O$,clipping_planes_vertex:z$,color_fragment:k$,color_pars_fragment:F$,color_pars_vertex:N$,color_vertex:B$,common:U$,cube_uv_reflection_fragment:V$,defaultnormal_vertex:j$,displacementmap_pars_vertex:G$,displacementmap_vertex:H$,emissivemap_fragment:q$,emissivemap_pars_fragment:W$,colorspace_fragment:$$,colorspace_pars_fragment:X$,envmap_fragment:Z$,envmap_common_pars_fragment:Y$,envmap_pars_fragment:K$,envmap_pars_vertex:J$,envmap_physical_pars_fragment:cX,envmap_vertex:Q$,fog_vertex:eX,fog_pars_vertex:tX,fog_fragment:nX,fog_pars_fragment:iX,gradientmap_pars_fragment:rX,lightmap_pars_fragment:aX,lights_lambert_fragment:oX,lights_lambert_pars_fragment:sX,lights_pars_begin:lX,lights_toon_fragment:uX,lights_toon_pars_fragment:hX,lights_phong_fragment:dX,lights_phong_pars_fragment:fX,lights_physical_fragment:pX,lights_physical_pars_fragment:mX,lights_fragment_begin:gX,lights_fragment_maps:_X,lights_fragment_end:vX,logdepthbuf_fragment:yX,logdepthbuf_pars_fragment:xX,logdepthbuf_pars_vertex:bX,logdepthbuf_vertex:wX,map_fragment:SX,map_pars_fragment:EX,map_particle_fragment:MX,map_particle_pars_fragment:TX,metalnessmap_fragment:AX,metalnessmap_pars_fragment:CX,morphinstance_vertex:RX,morphcolor_vertex:IX,morphnormal_vertex:DX,morphtarget_pars_vertex:PX,morphtarget_vertex:LX,normal_fragment_begin:OX,normal_fragment_maps:zX,normal_pars_fragment:kX,normal_pars_vertex:FX,normal_vertex:NX,normalmap_pars_fragment:BX,clearcoat_normal_fragment_begin:UX,clearcoat_normal_fragment_maps:VX,clearcoat_pars_fragment:jX,iridescence_pars_fragment:GX,opaque_fragment:HX,packing:qX,premultiplied_alpha_fragment:WX,project_vertex:$X,dithering_fragment:XX,dithering_pars_fragment:ZX,roughnessmap_fragment:YX,roughnessmap_pars_fragment:KX,shadowmap_pars_fragment:JX,shadowmap_pars_vertex:QX,shadowmap_vertex:eZ,shadowmask_pars_fragment:tZ,skinbase_vertex:nZ,skinning_pars_vertex:iZ,skinning_vertex:rZ,skinnormal_vertex:aZ,specularmap_fragment:oZ,specularmap_pars_fragment:sZ,tonemapping_fragment:lZ,tonemapping_pars_fragment:cZ,transmission_fragment:uZ,transmission_pars_fragment:hZ,uv_pars_fragment:dZ,uv_pars_vertex:fZ,uv_vertex:pZ,worldpos_vertex:mZ,background_vert:gZ,background_frag:_Z,backgroundCube_vert:vZ,backgroundCube_frag:yZ,cube_vert:xZ,cube_frag:bZ,depth_vert:wZ,depth_frag:SZ,distanceRGBA_vert:EZ,distanceRGBA_frag:MZ,equirect_vert:TZ,equirect_frag:AZ,linedashed_vert:CZ,linedashed_frag:RZ,meshbasic_vert:IZ,meshbasic_frag:DZ,meshlambert_vert:PZ,meshlambert_frag:LZ,meshmatcap_vert:OZ,meshmatcap_frag:zZ,meshnormal_vert:kZ,meshnormal_frag:FZ,meshphong_vert:NZ,meshphong_frag:BZ,meshphysical_vert:UZ,meshphysical_frag:VZ,meshtoon_vert:jZ,meshtoon_frag:GZ,points_vert:HZ,points_frag:qZ,shadow_vert:WZ,shadow_frag:$Z,sprite_vert:XZ,sprite_frag:ZZ},vi={common:{diffuse:{value:new sa(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new wr},alphaMap:{value:null},alphaMapTransform:{value:new wr},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new wr}},envmap:{envMap:{value:null},envMapRotation:{value:new wr},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new wr}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new wr}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new wr},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new wr},normalScale:{value:new ma(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new wr},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new wr}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new wr}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new wr}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new sa(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new sa(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new wr},alphaTest:{value:0},uvTransform:{value:new wr}},sprite:{diffuse:{value:new sa(16777215)},opacity:{value:1},center:{value:new ma(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new wr},alphaMap:{value:null},alphaMapTransform:{value:new wr},alphaTest:{value:0}}},vd={basic:{uniforms:ll([vi.common,vi.specularmap,vi.envmap,vi.aomap,vi.lightmap,vi.fog]),vertexShader:Ar.meshbasic_vert,fragmentShader:Ar.meshbasic_frag},lambert:{uniforms:ll([vi.common,vi.specularmap,vi.envmap,vi.aomap,vi.lightmap,vi.emissivemap,vi.bumpmap,vi.normalmap,vi.displacementmap,vi.fog,vi.lights,{emissive:{value:new sa(0)}}]),vertexShader:Ar.meshlambert_vert,fragmentShader:Ar.meshlambert_frag},phong:{uniforms:ll([vi.common,vi.specularmap,vi.envmap,vi.aomap,vi.lightmap,vi.emissivemap,vi.bumpmap,vi.normalmap,vi.displacementmap,vi.fog,vi.lights,{emissive:{value:new sa(0)},specular:{value:new sa(1118481)},shininess:{value:30}}]),vertexShader:Ar.meshphong_vert,fragmentShader:Ar.meshphong_frag},standard:{uniforms:ll([vi.common,vi.envmap,vi.aomap,vi.lightmap,vi.emissivemap,vi.bumpmap,vi.normalmap,vi.displacementmap,vi.roughnessmap,vi.metalnessmap,vi.fog,vi.lights,{emissive:{value:new sa(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ar.meshphysical_vert,fragmentShader:Ar.meshphysical_frag},toon:{uniforms:ll([vi.common,vi.aomap,vi.lightmap,vi.emissivemap,vi.bumpmap,vi.normalmap,vi.displacementmap,vi.gradientmap,vi.fog,vi.lights,{emissive:{value:new sa(0)}}]),vertexShader:Ar.meshtoon_vert,fragmentShader:Ar.meshtoon_frag},matcap:{uniforms:ll([vi.common,vi.bumpmap,vi.normalmap,vi.displacementmap,vi.fog,{matcap:{value:null}}]),vertexShader:Ar.meshmatcap_vert,fragmentShader:Ar.meshmatcap_frag},points:{uniforms:ll([vi.points,vi.fog]),vertexShader:Ar.points_vert,fragmentShader:Ar.points_frag},dashed:{uniforms:ll([vi.common,vi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ar.linedashed_vert,fragmentShader:Ar.linedashed_frag},depth:{uniforms:ll([vi.common,vi.displacementmap]),vertexShader:Ar.depth_vert,fragmentShader:Ar.depth_frag},normal:{uniforms:ll([vi.common,vi.bumpmap,vi.normalmap,vi.displacementmap,{opacity:{value:1}}]),vertexShader:Ar.meshnormal_vert,fragmentShader:Ar.meshnormal_frag},sprite:{uniforms:ll([vi.sprite,vi.fog]),vertexShader:Ar.sprite_vert,fragmentShader:Ar.sprite_frag},background:{uniforms:{uvTransform:{value:new wr},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ar.background_vert,fragmentShader:Ar.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new wr}},vertexShader:Ar.backgroundCube_vert,fragmentShader:Ar.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ar.cube_vert,fragmentShader:Ar.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ar.equirect_vert,fragmentShader:Ar.equirect_frag},distanceRGBA:{uniforms:ll([vi.common,vi.displacementmap,{referencePosition:{value:new un},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ar.distanceRGBA_vert,fragmentShader:Ar.distanceRGBA_frag},shadow:{uniforms:ll([vi.lights,vi.fog,{color:{value:new sa(0)},opacity:{value:1}}]),vertexShader:Ar.shadow_vert,fragmentShader:Ar.shadow_frag}};vd.physical={uniforms:ll([vd.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new wr},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new wr},clearcoatNormalScale:{value:new ma(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new wr},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new wr},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new wr},sheen:{value:0},sheenColor:{value:new sa(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new wr},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new wr},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new wr},transmissionSamplerSize:{value:new ma},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new wr},attenuationDistance:{value:0},attenuationColor:{value:new sa(0)},specularColor:{value:new sa(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new wr},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new wr},anisotropyVector:{value:new ma},anisotropyMap:{value:null},anisotropyMapTransform:{value:new wr}}]),vertexShader:Ar.meshphysical_vert,fragmentShader:Ar.meshphysical_frag};const Z1={r:0,b:0,g:0},$g=new Ad,YZ=new Ba;function KZ(t,e,a,c,p,y,M){const r=new sa(0);let I=y===!0?0:1,k,B,U=null,H=0,Y=null;function X(ce){let pe=ce.isScene===!0?ce.background:null;return pe&&pe.isTexture&&(pe=(ce.backgroundBlurriness>0?a:e).get(pe)),pe}function Q(ce){let pe=!1;const Ae=X(ce);Ae===null?j(r,I):Ae&&Ae.isColor&&(j(Ae,1),pe=!0);const Ee=t.xr.getEnvironmentBlendMode();Ee==="additive"?c.buffers.color.setClear(0,0,0,1,M):Ee==="alpha-blend"&&c.buffers.color.setClear(0,0,0,0,M),(t.autoClear||pe)&&(c.buffers.depth.setTest(!0),c.buffers.depth.setMask(!0),c.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))}function J(ce,pe){const Ae=X(pe);Ae&&(Ae.isCubeTexture||Ae.mapping===PE)?(B===void 0&&(B=new dc(new g_(1,1,1),new Cm({name:"BackgroundCubeMaterial",uniforms:Cy(vd.backgroundCube.uniforms),vertexShader:vd.backgroundCube.vertexShader,fragmentShader:vd.backgroundCube.fragmentShader,side:Ll,depthTest:!1,depthWrite:!1,fog:!1})),B.geometry.deleteAttribute("normal"),B.geometry.deleteAttribute("uv"),B.onBeforeRender=function(Ee,be,Ve){this.matrixWorld.copyPosition(Ve.matrixWorld)},Object.defineProperty(B.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),p.update(B)),$g.copy(pe.backgroundRotation),$g.x*=-1,$g.y*=-1,$g.z*=-1,Ae.isCubeTexture&&Ae.isRenderTargetTexture===!1&&($g.y*=-1,$g.z*=-1),B.material.uniforms.envMap.value=Ae,B.material.uniforms.flipEnvMap.value=Ae.isCubeTexture&&Ae.isRenderTargetTexture===!1?-1:1,B.material.uniforms.backgroundBlurriness.value=pe.backgroundBlurriness,B.material.uniforms.backgroundIntensity.value=pe.backgroundIntensity,B.material.uniforms.backgroundRotation.value.setFromMatrix4(YZ.makeRotationFromEuler($g)),B.material.toneMapped=ta.getTransfer(Ae.colorSpace)!==ba,(U!==Ae||H!==Ae.version||Y!==t.toneMapping)&&(B.material.needsUpdate=!0,U=Ae,H=Ae.version,Y=t.toneMapping),B.layers.enableAll(),ce.unshift(B,B.geometry,B.material,0,0,null)):Ae&&Ae.isTexture&&(k===void 0&&(k=new dc(new OE(2,2),new Cm({name:"BackgroundMaterial",uniforms:Cy(vd.background.uniforms),vertexShader:vd.background.vertexShader,fragmentShader:vd.background.fragmentShader,side:Am,depthTest:!1,depthWrite:!1,fog:!1})),k.geometry.deleteAttribute("normal"),Object.defineProperty(k.material,"map",{get:function(){return this.uniforms.t2D.value}}),p.update(k)),k.material.uniforms.t2D.value=Ae,k.material.uniforms.backgroundIntensity.value=pe.backgroundIntensity,k.material.toneMapped=ta.getTransfer(Ae.colorSpace)!==ba,Ae.matrixAutoUpdate===!0&&Ae.updateMatrix(),k.material.uniforms.uvTransform.value.copy(Ae.matrix),(U!==Ae||H!==Ae.version||Y!==t.toneMapping)&&(k.material.needsUpdate=!0,U=Ae,H=Ae.version,Y=t.toneMapping),k.layers.enableAll(),ce.unshift(k,k.geometry,k.material,0,0,null))}function j(ce,pe){ce.getRGB(Z1,CF(t)),c.buffers.color.setClear(Z1.r,Z1.g,Z1.b,pe,M)}function oe(){B!==void 0&&(B.geometry.dispose(),B.material.dispose(),B=void 0),k!==void 0&&(k.geometry.dispose(),k.material.dispose(),k=void 0)}return{getClearColor:function(){return r},setClearColor:function(ce,pe=1){r.set(ce),I=pe,j(r,I)},getClearAlpha:function(){return I},setClearAlpha:function(ce){I=ce,j(r,I)},render:Q,addToRenderList:J,dispose:oe}}function JZ(t,e){const a=t.getParameter(t.MAX_VERTEX_ATTRIBS),c={},p=H(null);let y=p,M=!1;function r(xe,Fe,Ct,Et,Tt){let _t=!1;const et=U(Et,Ct,Fe);y!==et&&(y=et,k(y.object)),_t=Y(xe,Et,Ct,Tt),_t&&X(xe,Et,Ct,Tt),Tt!==null&&e.update(Tt,t.ELEMENT_ARRAY_BUFFER),(_t||M)&&(M=!1,pe(xe,Fe,Ct,Et),Tt!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(Tt).buffer))}function I(){return t.createVertexArray()}function k(xe){return t.bindVertexArray(xe)}function B(xe){return t.deleteVertexArray(xe)}function U(xe,Fe,Ct){const Et=Ct.wireframe===!0;let Tt=c[xe.id];Tt===void 0&&(Tt={},c[xe.id]=Tt);let _t=Tt[Fe.id];_t===void 0&&(_t={},Tt[Fe.id]=_t);let et=_t[Et];return et===void 0&&(et=H(I()),_t[Et]=et),et}function H(xe){const Fe=[],Ct=[],Et=[];for(let Tt=0;Tt<a;Tt++)Fe[Tt]=0,Ct[Tt]=0,Et[Tt]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Fe,enabledAttributes:Ct,attributeDivisors:Et,object:xe,attributes:{},index:null}}function Y(xe,Fe,Ct,Et){const Tt=y.attributes,_t=Fe.attributes;let et=0;const Lt=Ct.getAttributes();for(const lt in Lt)if(Lt[lt].location>=0){const Xe=Tt[lt];let kt=_t[lt];if(kt===void 0&&(lt==="instanceMatrix"&&xe.instanceMatrix&&(kt=xe.instanceMatrix),lt==="instanceColor"&&xe.instanceColor&&(kt=xe.instanceColor)),Xe===void 0||Xe.attribute!==kt||kt&&Xe.data!==kt.data)return!0;et++}return y.attributesNum!==et||y.index!==Et}function X(xe,Fe,Ct,Et){const Tt={},_t=Fe.attributes;let et=0;const Lt=Ct.getAttributes();for(const lt in Lt)if(Lt[lt].location>=0){let Xe=_t[lt];Xe===void 0&&(lt==="instanceMatrix"&&xe.instanceMatrix&&(Xe=xe.instanceMatrix),lt==="instanceColor"&&xe.instanceColor&&(Xe=xe.instanceColor));const kt={};kt.attribute=Xe,Xe&&Xe.data&&(kt.data=Xe.data),Tt[lt]=kt,et++}y.attributes=Tt,y.attributesNum=et,y.index=Et}function Q(){const xe=y.newAttributes;for(let Fe=0,Ct=xe.length;Fe<Ct;Fe++)xe[Fe]=0}function J(xe){j(xe,0)}function j(xe,Fe){const Ct=y.newAttributes,Et=y.enabledAttributes,Tt=y.attributeDivisors;Ct[xe]=1,Et[xe]===0&&(t.enableVertexAttribArray(xe),Et[xe]=1),Tt[xe]!==Fe&&(t.vertexAttribDivisor(xe,Fe),Tt[xe]=Fe)}function oe(){const xe=y.newAttributes,Fe=y.enabledAttributes;for(let Ct=0,Et=Fe.length;Ct<Et;Ct++)Fe[Ct]!==xe[Ct]&&(t.disableVertexAttribArray(Ct),Fe[Ct]=0)}function ce(xe,Fe,Ct,Et,Tt,_t,et){et===!0?t.vertexAttribIPointer(xe,Fe,Ct,Tt,_t):t.vertexAttribPointer(xe,Fe,Ct,Et,Tt,_t)}function pe(xe,Fe,Ct,Et){Q();const Tt=Et.attributes,_t=Ct.getAttributes(),et=Fe.defaultAttributeValues;for(const Lt in _t){const lt=_t[Lt];if(lt.location>=0){let ut=Tt[Lt];if(ut===void 0&&(Lt==="instanceMatrix"&&xe.instanceMatrix&&(ut=xe.instanceMatrix),Lt==="instanceColor"&&xe.instanceColor&&(ut=xe.instanceColor)),ut!==void 0){const Xe=ut.normalized,kt=ut.itemSize,_n=e.get(ut);if(_n===void 0)continue;const Xt=_n.buffer,It=_n.type,ln=_n.bytesPerElement,fn=It===t.INT||It===t.UNSIGNED_INT||ut.gpuType===AR;if(ut.isInterleavedBufferAttribute){const $t=ut.data,pn=$t.stride,jn=ut.offset;if($t.isInstancedInterleavedBuffer){for(let Pe=0;Pe<lt.locationSize;Pe++)j(lt.location+Pe,$t.meshPerAttribute);xe.isInstancedMesh!==!0&&Et._maxInstanceCount===void 0&&(Et._maxInstanceCount=$t.meshPerAttribute*$t.count)}else for(let Pe=0;Pe<lt.locationSize;Pe++)J(lt.location+Pe);t.bindBuffer(t.ARRAY_BUFFER,Xt);for(let Pe=0;Pe<lt.locationSize;Pe++)ce(lt.location+Pe,kt/lt.locationSize,It,Xe,pn*ln,(jn+kt/lt.locationSize*Pe)*ln,fn)}else{if(ut.isInstancedBufferAttribute){for(let $t=0;$t<lt.locationSize;$t++)j(lt.location+$t,ut.meshPerAttribute);xe.isInstancedMesh!==!0&&Et._maxInstanceCount===void 0&&(Et._maxInstanceCount=ut.meshPerAttribute*ut.count)}else for(let $t=0;$t<lt.locationSize;$t++)J(lt.location+$t);t.bindBuffer(t.ARRAY_BUFFER,Xt);for(let $t=0;$t<lt.locationSize;$t++)ce(lt.location+$t,kt/lt.locationSize,It,Xe,kt*ln,kt/lt.locationSize*$t*ln,fn)}}else if(et!==void 0){const Xe=et[Lt];if(Xe!==void 0)switch(Xe.length){case 2:t.vertexAttrib2fv(lt.location,Xe);break;case 3:t.vertexAttrib3fv(lt.location,Xe);break;case 4:t.vertexAttrib4fv(lt.location,Xe);break;default:t.vertexAttrib1fv(lt.location,Xe)}}}}oe()}function Ae(){Ve();for(const xe in c){const Fe=c[xe];for(const Ct in Fe){const Et=Fe[Ct];for(const Tt in Et)B(Et[Tt].object),delete Et[Tt];delete Fe[Ct]}delete c[xe]}}function Ee(xe){if(c[xe.id]===void 0)return;const Fe=c[xe.id];for(const Ct in Fe){const Et=Fe[Ct];for(const Tt in Et)B(Et[Tt].object),delete Et[Tt];delete Fe[Ct]}delete c[xe.id]}function be(xe){for(const Fe in c){const Ct=c[Fe];if(Ct[xe.id]===void 0)continue;const Et=Ct[xe.id];for(const Tt in Et)B(Et[Tt].object),delete Et[Tt];delete Ct[xe.id]}}function Ve(){Se(),M=!0,y!==p&&(y=p,k(y.object))}function Se(){p.geometry=null,p.program=null,p.wireframe=!1}return{setup:r,reset:Ve,resetDefaultState:Se,dispose:Ae,releaseStatesOfGeometry:Ee,releaseStatesOfProgram:be,initAttributes:Q,enableAttribute:J,disableUnusedAttributes:oe}}function QZ(t,e,a){let c;function p(k){c=k}function y(k,B){t.drawArrays(c,k,B),a.update(B,c,1)}function M(k,B,U){U!==0&&(t.drawArraysInstanced(c,k,B,U),a.update(B,c,U))}function r(k,B,U){if(U===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(c,k,0,B,0,U);let Y=0;for(let X=0;X<U;X++)Y+=B[X];a.update(Y,c,1)}function I(k,B,U,H){if(U===0)return;const Y=e.get("WEBGL_multi_draw");if(Y===null)for(let X=0;X<k.length;X++)M(k[X],B[X],H[X]);else{Y.multiDrawArraysInstancedWEBGL(c,k,0,B,0,H,0,U);let X=0;for(let Q=0;Q<U;Q++)X+=B[Q]*H[Q];a.update(X,c,1)}}this.setMode=p,this.render=y,this.renderInstances=M,this.renderMultiDraw=r,this.renderMultiDrawInstances=I}function eY(t,e,a,c){let p;function y(){if(p!==void 0)return p;if(e.has("EXT_texture_filter_anisotropic")===!0){const be=e.get("EXT_texture_filter_anisotropic");p=t.getParameter(be.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else p=0;return p}function M(be){return!(be!==oh&&c.convert(be)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT))}function r(be){const Ve=be===ob&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(be!==tp&&c.convert(be)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&be!==Hf&&!Ve)}function I(be){if(be==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";be="mediump"}return be==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let k=a.precision!==void 0?a.precision:"highp";const B=I(k);B!==k&&(console.warn("THREE.WebGLRenderer:",k,"not supported, using",B,"instead."),k=B);const U=a.logarithmicDepthBuffer===!0,H=a.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),Y=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),X=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Q=t.getParameter(t.MAX_TEXTURE_SIZE),J=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),j=t.getParameter(t.MAX_VERTEX_ATTRIBS),oe=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),ce=t.getParameter(t.MAX_VARYING_VECTORS),pe=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),Ae=X>0,Ee=t.getParameter(t.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:y,getMaxPrecision:I,textureFormatReadable:M,textureTypeReadable:r,precision:k,logarithmicDepthBuffer:U,reverseDepthBuffer:H,maxTextures:Y,maxVertexTextures:X,maxTextureSize:Q,maxCubemapSize:J,maxAttributes:j,maxVertexUniforms:oe,maxVaryings:ce,maxFragmentUniforms:pe,vertexTextures:Ae,maxSamples:Ee}}function tY(t){const e=this;let a=null,c=0,p=!1,y=!1;const M=new Yg,r=new wr,I={value:null,needsUpdate:!1};this.uniform=I,this.numPlanes=0,this.numIntersection=0,this.init=function(U,H){const Y=U.length!==0||H||c!==0||p;return p=H,c=U.length,Y},this.beginShadows=function(){y=!0,B(null)},this.endShadows=function(){y=!1},this.setGlobalState=function(U,H){a=B(U,H,0)},this.setState=function(U,H,Y){const X=U.clippingPlanes,Q=U.clipIntersection,J=U.clipShadows,j=t.get(U);if(!p||X===null||X.length===0||y&&!J)y?B(null):k();else{const oe=y?0:c,ce=oe*4;let pe=j.clippingState||null;I.value=pe,pe=B(X,H,ce,Y);for(let Ae=0;Ae!==ce;++Ae)pe[Ae]=a[Ae];j.clippingState=pe,this.numIntersection=Q?this.numPlanes:0,this.numPlanes+=oe}};function k(){I.value!==a&&(I.value=a,I.needsUpdate=c>0),e.numPlanes=c,e.numIntersection=0}function B(U,H,Y,X){const Q=U!==null?U.length:0;let J=null;if(Q!==0){if(J=I.value,X!==!0||J===null){const j=Y+Q*4,oe=H.matrixWorldInverse;r.getNormalMatrix(oe),(J===null||J.length<j)&&(J=new Float32Array(j));for(let ce=0,pe=Y;ce!==Q;++ce,pe+=4)M.copy(U[ce]).applyMatrix4(oe,r),M.normal.toArray(J,pe),J[pe+3]=M.constant}I.value=J,I.needsUpdate=!0}return e.numPlanes=Q,e.numIntersection=0,J}}function nY(t){let e=new WeakMap;function a(M,r){return r===cA?M.mapping=Sy:r===uA&&(M.mapping=Ey),M}function c(M){if(M&&M.isTexture){const r=M.mapping;if(r===cA||r===uA)if(e.has(M)){const I=e.get(M).texture;return a(I,M.mapping)}else{const I=M.image;if(I&&I.height>0){const k=new Q9(I.height);return k.fromEquirectangularTexture(t,M),e.set(M,k),M.addEventListener("dispose",p),a(k.texture,M.mapping)}else return null}}return M}function p(M){const r=M.target;r.removeEventListener("dispose",p);const I=e.get(r);I!==void 0&&(e.delete(r),I.dispose())}function y(){e=new WeakMap}return{get:c,dispose:y}}const dy=4,q3=[.125,.215,.35,.446,.526,.582],o_=20,o2=new d$,W3=new sa;let s2=null,l2=0,c2=0,u2=!1;const Kg=(1+Math.sqrt(5))/2,$v=1/Kg,$3=[new un(-Kg,$v,0),new un(Kg,$v,0),new un(-$v,0,Kg),new un($v,0,Kg),new un(0,Kg,-$v),new un(0,Kg,$v),new un(-1,1,-1),new un(1,1,-1),new un(-1,1,1),new un(1,1,1)],iY=new un;class X3{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,a=0,c=.1,p=100,y={}){const{size:M=256,position:r=iY}=y;s2=this._renderer.getRenderTarget(),l2=this._renderer.getActiveCubeFace(),c2=this._renderer.getActiveMipmapLevel(),u2=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(M);const I=this._allocateTargets();return I.depthBuffer=!0,this._sceneToCubeUV(e,c,p,I,r),a>0&&this._blur(I,0,0,a),this._applyPMREM(I),this._cleanup(I),I}fromEquirectangular(e,a=null){return this._fromTexture(e,a)}fromCubemap(e,a=null){return this._fromTexture(e,a)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=K3(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Y3(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(s2,l2,c2),this._renderer.xr.enabled=u2,e.scissorTest=!1,Y1(e,0,0,e.width,e.height)}_fromTexture(e,a){e.mapping===Sy||e.mapping===Ey?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),s2=this._renderer.getRenderTarget(),l2=this._renderer.getActiveCubeFace(),c2=this._renderer.getActiveMipmapLevel(),u2=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const c=a||this._allocateTargets();return this._textureToCubeUV(e,c),this._applyPMREM(c),this._cleanup(c),c}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),a=4*this._cubeSize,c={magFilter:bd,minFilter:bd,generateMipmaps:!1,type:ob,format:oh,colorSpace:Ay,depthBuffer:!1},p=Z3(e,a,c);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==a){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Z3(e,a,c);const{_lodMax:y}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=rY(y)),this._blurMaterial=aY(y,e,a)}return p}_compileMaterial(e){const a=new dc(this._lodPlanes[0],e);this._renderer.compile(a,o2)}_sceneToCubeUV(e,a,c,p,y){const I=new hu(90,1,a,c),k=[1,-1,1,1,1,1],B=[1,1,1,-1,-1,-1],U=this._renderer,H=U.autoClear,Y=U.toneMapping;U.getClearColor(W3),U.toneMapping=xm,U.autoClear=!1;const X=new X0({name:"PMREM.Background",side:Ll,depthWrite:!1,depthTest:!1}),Q=new dc(new g_,X);let J=!1;const j=e.background;j?j.isColor&&(X.color.copy(j),e.background=null,J=!0):(X.color.copy(W3),J=!0);for(let oe=0;oe<6;oe++){const ce=oe%3;ce===0?(I.up.set(0,k[oe],0),I.position.set(y.x,y.y,y.z),I.lookAt(y.x+B[oe],y.y,y.z)):ce===1?(I.up.set(0,0,k[oe]),I.position.set(y.x,y.y,y.z),I.lookAt(y.x,y.y+B[oe],y.z)):(I.up.set(0,k[oe],0),I.position.set(y.x,y.y,y.z),I.lookAt(y.x,y.y,y.z+B[oe]));const pe=this._cubeSize;Y1(p,ce*pe,oe>2?pe:0,pe,pe),U.setRenderTarget(p),J&&U.render(Q,I),U.render(e,I)}Q.geometry.dispose(),Q.material.dispose(),U.toneMapping=Y,U.autoClear=H,e.background=j}_textureToCubeUV(e,a){const c=this._renderer,p=e.mapping===Sy||e.mapping===Ey;p?(this._cubemapMaterial===null&&(this._cubemapMaterial=K3()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Y3());const y=p?this._cubemapMaterial:this._equirectMaterial,M=new dc(this._lodPlanes[0],y),r=y.uniforms;r.envMap.value=e;const I=this._cubeSize;Y1(a,0,0,3*I,2*I),c.setRenderTarget(a),c.render(M,o2)}_applyPMREM(e){const a=this._renderer,c=a.autoClear;a.autoClear=!1;const p=this._lodPlanes.length;for(let y=1;y<p;y++){const M=Math.sqrt(this._sigmas[y]*this._sigmas[y]-this._sigmas[y-1]*this._sigmas[y-1]),r=$3[(p-y-1)%$3.length];this._blur(e,y-1,y,M,r)}a.autoClear=c}_blur(e,a,c,p,y){const M=this._pingPongRenderTarget;this._halfBlur(e,M,a,c,p,"latitudinal",y),this._halfBlur(M,e,c,c,p,"longitudinal",y)}_halfBlur(e,a,c,p,y,M,r){const I=this._renderer,k=this._blurMaterial;M!=="latitudinal"&&M!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const B=3,U=new dc(this._lodPlanes[p],k),H=k.uniforms,Y=this._sizeLods[c]-1,X=isFinite(y)?Math.PI/(2*Y):2*Math.PI/(2*o_-1),Q=y/X,J=isFinite(y)?1+Math.floor(B*Q):o_;J>o_&&console.warn(`sigmaRadians, ${y}, is too large and will clip, as it requested ${J} samples when the maximum is set to ${o_}`);const j=[];let oe=0;for(let be=0;be<o_;++be){const Ve=be/Q,Se=Math.exp(-Ve*Ve/2);j.push(Se),be===0?oe+=Se:be<J&&(oe+=2*Se)}for(let be=0;be<j.length;be++)j[be]=j[be]/oe;H.envMap.value=e.texture,H.samples.value=J,H.weights.value=j,H.latitudinal.value=M==="latitudinal",r&&(H.poleAxis.value=r);const{_lodMax:ce}=this;H.dTheta.value=X,H.mipInt.value=ce-c;const pe=this._sizeLods[p],Ae=3*pe*(p>ce-dy?p-ce+dy:0),Ee=4*(this._cubeSize-pe);Y1(a,Ae,Ee,3*pe,2*pe),I.setRenderTarget(a),I.render(U,o2)}}function rY(t){const e=[],a=[],c=[];let p=t;const y=t-dy+1+q3.length;for(let M=0;M<y;M++){const r=Math.pow(2,p);a.push(r);let I=1/r;M>t-dy?I=q3[M-t+dy-1]:M===0&&(I=0),c.push(I);const k=1/(r-2),B=-k,U=1+k,H=[B,B,U,B,U,U,B,B,U,U,B,U],Y=6,X=6,Q=3,J=2,j=1,oe=new Float32Array(Q*X*Y),ce=new Float32Array(J*X*Y),pe=new Float32Array(j*X*Y);for(let Ee=0;Ee<Y;Ee++){const be=Ee%3*2/3-1,Ve=Ee>2?0:-1,Se=[be,Ve,0,be+2/3,Ve,0,be+2/3,Ve+1,0,be,Ve,0,be+2/3,Ve+1,0,be,Ve+1,0];oe.set(Se,Q*X*Ee),ce.set(H,J*X*Ee);const xe=[Ee,Ee,Ee,Ee,Ee,Ee];pe.set(xe,j*X*Ee)}const Ae=new Lm;Ae.setAttribute("position",new Ed(oe,Q)),Ae.setAttribute("uv",new Ed(ce,J)),Ae.setAttribute("faceIndex",new Ed(pe,j)),e.push(Ae),p>dy&&p--}return{lodPlanes:e,sizeLods:a,sigmas:c}}function Z3(t,e,a){const c=new m_(t,e,a);return c.texture.mapping=PE,c.texture.name="PMREM.cubeUv",c.scissorTest=!0,c}function Y1(t,e,a,c,p){t.viewport.set(e,a,c,p),t.scissor.set(e,a,c,p)}function aY(t,e,a){const c=new Float32Array(o_),p=new un(0,1,0);return new Cm({name:"SphericalGaussianBlur",defines:{n:o_,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/a,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:c},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:p}},vertexShader:FR(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:ym,depthTest:!1,depthWrite:!1})}function Y3(){return new Cm({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:FR(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:ym,depthTest:!1,depthWrite:!1})}function K3(){return new Cm({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:FR(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:ym,depthTest:!1,depthWrite:!1})}function FR(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function oY(t){let e=new WeakMap,a=null;function c(r){if(r&&r.isTexture){const I=r.mapping,k=I===cA||I===uA,B=I===Sy||I===Ey;if(k||B){let U=e.get(r);const H=U!==void 0?U.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==H)return a===null&&(a=new X3(t)),U=k?a.fromEquirectangular(r,U):a.fromCubemap(r,U),U.texture.pmremVersion=r.pmremVersion,e.set(r,U),U.texture;if(U!==void 0)return U.texture;{const Y=r.image;return k&&Y&&Y.height>0||B&&Y&&p(Y)?(a===null&&(a=new X3(t)),U=k?a.fromEquirectangular(r):a.fromCubemap(r),U.texture.pmremVersion=r.pmremVersion,e.set(r,U),r.addEventListener("dispose",y),U.texture):null}}}return r}function p(r){let I=0;const k=6;for(let B=0;B<k;B++)r[B]!==void 0&&I++;return I===k}function y(r){const I=r.target;I.removeEventListener("dispose",y);const k=e.get(I);k!==void 0&&(e.delete(I),k.dispose())}function M(){e=new WeakMap,a!==null&&(a.dispose(),a=null)}return{get:c,dispose:M}}function sY(t){const e={};function a(c){if(e[c]!==void 0)return e[c];let p;switch(c){case"WEBGL_depth_texture":p=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":p=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":p=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":p=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:p=t.getExtension(c)}return e[c]=p,p}return{has:function(c){return a(c)!==null},init:function(){a("EXT_color_buffer_float"),a("WEBGL_clip_cull_distance"),a("OES_texture_float_linear"),a("EXT_color_buffer_half_float"),a("WEBGL_multisampled_render_to_texture"),a("WEBGL_render_shared_exponent")},get:function(c){const p=a(c);return p===null&&Zg("THREE.WebGLRenderer: "+c+" extension not supported."),p}}}function lY(t,e,a,c){const p={},y=new WeakMap;function M(U){const H=U.target;H.index!==null&&e.remove(H.index);for(const X in H.attributes)e.remove(H.attributes[X]);H.removeEventListener("dispose",M),delete p[H.id];const Y=y.get(H);Y&&(e.remove(Y),y.delete(H)),c.releaseStatesOfGeometry(H),H.isInstancedBufferGeometry===!0&&delete H._maxInstanceCount,a.memory.geometries--}function r(U,H){return p[H.id]===!0||(H.addEventListener("dispose",M),p[H.id]=!0,a.memory.geometries++),H}function I(U){const H=U.attributes;for(const Y in H)e.update(H[Y],t.ARRAY_BUFFER)}function k(U){const H=[],Y=U.index,X=U.attributes.position;let Q=0;if(Y!==null){const oe=Y.array;Q=Y.version;for(let ce=0,pe=oe.length;ce<pe;ce+=3){const Ae=oe[ce+0],Ee=oe[ce+1],be=oe[ce+2];H.push(Ae,Ee,Ee,be,be,Ae)}}else if(X!==void 0){const oe=X.array;Q=X.version;for(let ce=0,pe=oe.length/3-1;ce<pe;ce+=3){const Ae=ce+0,Ee=ce+1,be=ce+2;H.push(Ae,Ee,Ee,be,be,Ae)}}else return;const J=new(wF(H)?AF:TF)(H,1);J.version=Q;const j=y.get(U);j&&e.remove(j),y.set(U,J)}function B(U){const H=y.get(U);if(H){const Y=U.index;Y!==null&&H.version<Y.version&&k(U)}else k(U);return y.get(U)}return{get:r,update:I,getWireframeAttribute:B}}function cY(t,e,a){let c;function p(H){c=H}let y,M;function r(H){y=H.type,M=H.bytesPerElement}function I(H,Y){t.drawElements(c,Y,y,H*M),a.update(Y,c,1)}function k(H,Y,X){X!==0&&(t.drawElementsInstanced(c,Y,y,H*M,X),a.update(Y,c,X))}function B(H,Y,X){if(X===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(c,Y,0,y,H,0,X);let J=0;for(let j=0;j<X;j++)J+=Y[j];a.update(J,c,1)}function U(H,Y,X,Q){if(X===0)return;const J=e.get("WEBGL_multi_draw");if(J===null)for(let j=0;j<H.length;j++)k(H[j]/M,Y[j],Q[j]);else{J.multiDrawElementsInstancedWEBGL(c,Y,0,y,H,0,Q,0,X);let j=0;for(let oe=0;oe<X;oe++)j+=Y[oe]*Q[oe];a.update(j,c,1)}}this.setMode=p,this.setIndex=r,this.render=I,this.renderInstances=k,this.renderMultiDraw=B,this.renderMultiDrawInstances=U}function uY(t){const e={geometries:0,textures:0},a={frame:0,calls:0,triangles:0,points:0,lines:0};function c(y,M,r){switch(a.calls++,M){case t.TRIANGLES:a.triangles+=r*(y/3);break;case t.LINES:a.lines+=r*(y/2);break;case t.LINE_STRIP:a.lines+=r*(y-1);break;case t.LINE_LOOP:a.lines+=r*y;break;case t.POINTS:a.points+=r*y;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",M);break}}function p(){a.calls=0,a.triangles=0,a.points=0,a.lines=0}return{memory:e,render:a,programs:null,autoReset:!0,reset:p,update:c}}function hY(t,e,a){const c=new WeakMap,p=new Mo;function y(M,r,I){const k=M.morphTargetInfluences,B=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,U=B!==void 0?B.length:0;let H=c.get(r);if(H===void 0||H.count!==U){let xe=function(){Ve.dispose(),c.delete(r),r.removeEventListener("dispose",xe)};var Y=xe;H!==void 0&&H.texture.dispose();const X=r.morphAttributes.position!==void 0,Q=r.morphAttributes.normal!==void 0,J=r.morphAttributes.color!==void 0,j=r.morphAttributes.position||[],oe=r.morphAttributes.normal||[],ce=r.morphAttributes.color||[];let pe=0;X===!0&&(pe=1),Q===!0&&(pe=2),J===!0&&(pe=3);let Ae=r.attributes.position.count*pe,Ee=1;Ae>e.maxTextureSize&&(Ee=Math.ceil(Ae/e.maxTextureSize),Ae=e.maxTextureSize);const be=new Float32Array(Ae*Ee*4*U),Ve=new SF(be,Ae,Ee,U);Ve.type=Hf,Ve.needsUpdate=!0;const Se=pe*4;for(let Fe=0;Fe<U;Fe++){const Ct=j[Fe],Et=oe[Fe],Tt=ce[Fe],_t=Ae*Ee*4*Fe;for(let et=0;et<Ct.count;et++){const Lt=et*Se;X===!0&&(p.fromBufferAttribute(Ct,et),be[_t+Lt+0]=p.x,be[_t+Lt+1]=p.y,be[_t+Lt+2]=p.z,be[_t+Lt+3]=0),Q===!0&&(p.fromBufferAttribute(Et,et),be[_t+Lt+4]=p.x,be[_t+Lt+5]=p.y,be[_t+Lt+6]=p.z,be[_t+Lt+7]=0),J===!0&&(p.fromBufferAttribute(Tt,et),be[_t+Lt+8]=p.x,be[_t+Lt+9]=p.y,be[_t+Lt+10]=p.z,be[_t+Lt+11]=Tt.itemSize===4?p.w:1)}}H={count:U,texture:Ve,size:new ma(Ae,Ee)},c.set(r,H),r.addEventListener("dispose",xe)}if(M.isInstancedMesh===!0&&M.morphTexture!==null)I.getUniforms().setValue(t,"morphTexture",M.morphTexture,a);else{let X=0;for(let J=0;J<k.length;J++)X+=k[J];const Q=r.morphTargetsRelative?1:1-X;I.getUniforms().setValue(t,"morphTargetBaseInfluence",Q),I.getUniforms().setValue(t,"morphTargetInfluences",k)}I.getUniforms().setValue(t,"morphTargetsTexture",H.texture,a),I.getUniforms().setValue(t,"morphTargetsTextureSize",H.size)}return{update:y}}function dY(t,e,a,c){let p=new WeakMap;function y(I){const k=c.render.frame,B=I.geometry,U=e.get(I,B);if(p.get(U)!==k&&(e.update(U),p.set(U,k)),I.isInstancedMesh&&(I.hasEventListener("dispose",r)===!1&&I.addEventListener("dispose",r),p.get(I)!==k&&(a.update(I.instanceMatrix,t.ARRAY_BUFFER),I.instanceColor!==null&&a.update(I.instanceColor,t.ARRAY_BUFFER),p.set(I,k))),I.isSkinnedMesh){const H=I.skeleton;p.get(H)!==k&&(H.update(),p.set(H,k))}return U}function M(){p=new WeakMap}function r(I){const k=I.target;k.removeEventListener("dispose",r),a.remove(k.instanceMatrix),k.instanceColor!==null&&a.remove(k.instanceColor)}return{update:y,dispose:M}}const OF=new ul,J3=new PF(1,1),zF=new SF,kF=new z9,FF=new IF,Q3=[],eL=[],tL=new Float32Array(16),nL=new Float32Array(9),iL=new Float32Array(4);function Uy(t,e,a){const c=t[0];if(c<=0||c>0)return t;const p=e*a;let y=Q3[p];if(y===void 0&&(y=new Float32Array(p),Q3[p]=y),e!==0){c.toArray(y,0);for(let M=1,r=0;M!==e;++M)r+=a,t[M].toArray(y,r)}return y}function qo(t,e){if(t.length!==e.length)return!1;for(let a=0,c=t.length;a<c;a++)if(t[a]!==e[a])return!1;return!0}function Wo(t,e){for(let a=0,c=e.length;a<c;a++)t[a]=e[a]}function zE(t,e){let a=eL[e];a===void 0&&(a=new Int32Array(e),eL[e]=a);for(let c=0;c!==e;++c)a[c]=t.allocateTextureUnit();return a}function fY(t,e){const a=this.cache;a[0]!==e&&(t.uniform1f(this.addr,e),a[0]=e)}function pY(t,e){const a=this.cache;if(e.x!==void 0)(a[0]!==e.x||a[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),a[0]=e.x,a[1]=e.y);else{if(qo(a,e))return;t.uniform2fv(this.addr,e),Wo(a,e)}}function mY(t,e){const a=this.cache;if(e.x!==void 0)(a[0]!==e.x||a[1]!==e.y||a[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),a[0]=e.x,a[1]=e.y,a[2]=e.z);else if(e.r!==void 0)(a[0]!==e.r||a[1]!==e.g||a[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),a[0]=e.r,a[1]=e.g,a[2]=e.b);else{if(qo(a,e))return;t.uniform3fv(this.addr,e),Wo(a,e)}}function gY(t,e){const a=this.cache;if(e.x!==void 0)(a[0]!==e.x||a[1]!==e.y||a[2]!==e.z||a[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),a[0]=e.x,a[1]=e.y,a[2]=e.z,a[3]=e.w);else{if(qo(a,e))return;t.uniform4fv(this.addr,e),Wo(a,e)}}function _Y(t,e){const a=this.cache,c=e.elements;if(c===void 0){if(qo(a,e))return;t.uniformMatrix2fv(this.addr,!1,e),Wo(a,e)}else{if(qo(a,c))return;iL.set(c),t.uniformMatrix2fv(this.addr,!1,iL),Wo(a,c)}}function vY(t,e){const a=this.cache,c=e.elements;if(c===void 0){if(qo(a,e))return;t.uniformMatrix3fv(this.addr,!1,e),Wo(a,e)}else{if(qo(a,c))return;nL.set(c),t.uniformMatrix3fv(this.addr,!1,nL),Wo(a,c)}}function yY(t,e){const a=this.cache,c=e.elements;if(c===void 0){if(qo(a,e))return;t.uniformMatrix4fv(this.addr,!1,e),Wo(a,e)}else{if(qo(a,c))return;tL.set(c),t.uniformMatrix4fv(this.addr,!1,tL),Wo(a,c)}}function xY(t,e){const a=this.cache;a[0]!==e&&(t.uniform1i(this.addr,e),a[0]=e)}function bY(t,e){const a=this.cache;if(e.x!==void 0)(a[0]!==e.x||a[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),a[0]=e.x,a[1]=e.y);else{if(qo(a,e))return;t.uniform2iv(this.addr,e),Wo(a,e)}}function wY(t,e){const a=this.cache;if(e.x!==void 0)(a[0]!==e.x||a[1]!==e.y||a[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),a[0]=e.x,a[1]=e.y,a[2]=e.z);else{if(qo(a,e))return;t.uniform3iv(this.addr,e),Wo(a,e)}}function SY(t,e){const a=this.cache;if(e.x!==void 0)(a[0]!==e.x||a[1]!==e.y||a[2]!==e.z||a[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),a[0]=e.x,a[1]=e.y,a[2]=e.z,a[3]=e.w);else{if(qo(a,e))return;t.uniform4iv(this.addr,e),Wo(a,e)}}function EY(t,e){const a=this.cache;a[0]!==e&&(t.uniform1ui(this.addr,e),a[0]=e)}function MY(t,e){const a=this.cache;if(e.x!==void 0)(a[0]!==e.x||a[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),a[0]=e.x,a[1]=e.y);else{if(qo(a,e))return;t.uniform2uiv(this.addr,e),Wo(a,e)}}function TY(t,e){const a=this.cache;if(e.x!==void 0)(a[0]!==e.x||a[1]!==e.y||a[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),a[0]=e.x,a[1]=e.y,a[2]=e.z);else{if(qo(a,e))return;t.uniform3uiv(this.addr,e),Wo(a,e)}}function AY(t,e){const a=this.cache;if(e.x!==void 0)(a[0]!==e.x||a[1]!==e.y||a[2]!==e.z||a[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),a[0]=e.x,a[1]=e.y,a[2]=e.z,a[3]=e.w);else{if(qo(a,e))return;t.uniform4uiv(this.addr,e),Wo(a,e)}}function CY(t,e,a){const c=this.cache,p=a.allocateTextureUnit();c[0]!==p&&(t.uniform1i(this.addr,p),c[0]=p);let y;this.type===t.SAMPLER_2D_SHADOW?(J3.compareFunction=bF,y=J3):y=OF,a.setTexture2D(e||y,p)}function RY(t,e,a){const c=this.cache,p=a.allocateTextureUnit();c[0]!==p&&(t.uniform1i(this.addr,p),c[0]=p),a.setTexture3D(e||kF,p)}function IY(t,e,a){const c=this.cache,p=a.allocateTextureUnit();c[0]!==p&&(t.uniform1i(this.addr,p),c[0]=p),a.setTextureCube(e||FF,p)}function DY(t,e,a){const c=this.cache,p=a.allocateTextureUnit();c[0]!==p&&(t.uniform1i(this.addr,p),c[0]=p),a.setTexture2DArray(e||zF,p)}function PY(t){switch(t){case 5126:return fY;case 35664:return pY;case 35665:return mY;case 35666:return gY;case 35674:return _Y;case 35675:return vY;case 35676:return yY;case 5124:case 35670:return xY;case 35667:case 35671:return bY;case 35668:case 35672:return wY;case 35669:case 35673:return SY;case 5125:return EY;case 36294:return MY;case 36295:return TY;case 36296:return AY;case 35678:case 36198:case 36298:case 36306:case 35682:return CY;case 35679:case 36299:case 36307:return RY;case 35680:case 36300:case 36308:case 36293:return IY;case 36289:case 36303:case 36311:case 36292:return DY}}function LY(t,e){t.uniform1fv(this.addr,e)}function OY(t,e){const a=Uy(e,this.size,2);t.uniform2fv(this.addr,a)}function zY(t,e){const a=Uy(e,this.size,3);t.uniform3fv(this.addr,a)}function kY(t,e){const a=Uy(e,this.size,4);t.uniform4fv(this.addr,a)}function FY(t,e){const a=Uy(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,a)}function NY(t,e){const a=Uy(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,a)}function BY(t,e){const a=Uy(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,a)}function UY(t,e){t.uniform1iv(this.addr,e)}function VY(t,e){t.uniform2iv(this.addr,e)}function jY(t,e){t.uniform3iv(this.addr,e)}function GY(t,e){t.uniform4iv(this.addr,e)}function HY(t,e){t.uniform1uiv(this.addr,e)}function qY(t,e){t.uniform2uiv(this.addr,e)}function WY(t,e){t.uniform3uiv(this.addr,e)}function $Y(t,e){t.uniform4uiv(this.addr,e)}function XY(t,e,a){const c=this.cache,p=e.length,y=zE(a,p);qo(c,y)||(t.uniform1iv(this.addr,y),Wo(c,y));for(let M=0;M!==p;++M)a.setTexture2D(e[M]||OF,y[M])}function ZY(t,e,a){const c=this.cache,p=e.length,y=zE(a,p);qo(c,y)||(t.uniform1iv(this.addr,y),Wo(c,y));for(let M=0;M!==p;++M)a.setTexture3D(e[M]||kF,y[M])}function YY(t,e,a){const c=this.cache,p=e.length,y=zE(a,p);qo(c,y)||(t.uniform1iv(this.addr,y),Wo(c,y));for(let M=0;M!==p;++M)a.setTextureCube(e[M]||FF,y[M])}function KY(t,e,a){const c=this.cache,p=e.length,y=zE(a,p);qo(c,y)||(t.uniform1iv(this.addr,y),Wo(c,y));for(let M=0;M!==p;++M)a.setTexture2DArray(e[M]||zF,y[M])}function JY(t){switch(t){case 5126:return LY;case 35664:return OY;case 35665:return zY;case 35666:return kY;case 35674:return FY;case 35675:return NY;case 35676:return BY;case 5124:case 35670:return UY;case 35667:case 35671:return VY;case 35668:case 35672:return jY;case 35669:case 35673:return GY;case 5125:return HY;case 36294:return qY;case 36295:return WY;case 36296:return $Y;case 35678:case 36198:case 36298:case 36306:case 35682:return XY;case 35679:case 36299:case 36307:return ZY;case 35680:case 36300:case 36308:case 36293:return YY;case 36289:case 36303:case 36311:case 36292:return KY}}class QY{constructor(e,a,c){this.id=e,this.addr=c,this.cache=[],this.type=a.type,this.setValue=PY(a.type)}}class eK{constructor(e,a,c){this.id=e,this.addr=c,this.cache=[],this.type=a.type,this.size=a.size,this.setValue=JY(a.type)}}class tK{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,a,c){const p=this.seq;for(let y=0,M=p.length;y!==M;++y){const r=p[y];r.setValue(e,a[r.id],c)}}}const h2=/(\w+)(\])?(\[|\.)?/g;function rL(t,e){t.seq.push(e),t.map[e.id]=e}function nK(t,e,a){const c=t.name,p=c.length;for(h2.lastIndex=0;;){const y=h2.exec(c),M=h2.lastIndex;let r=y[1];const I=y[2]==="]",k=y[3];if(I&&(r=r|0),k===void 0||k==="["&&M+2===p){rL(a,k===void 0?new QY(r,t,e):new eK(r,t,e));break}else{let U=a.map[r];U===void 0&&(U=new tK(r),rL(a,U)),a=U}}}class hw{constructor(e,a){this.seq=[],this.map={};const c=e.getProgramParameter(a,e.ACTIVE_UNIFORMS);for(let p=0;p<c;++p){const y=e.getActiveUniform(a,p),M=e.getUniformLocation(a,y.name);nK(y,M,this)}}setValue(e,a,c,p){const y=this.map[a];y!==void 0&&y.setValue(e,c,p)}setOptional(e,a,c){const p=a[c];p!==void 0&&this.setValue(e,c,p)}static upload(e,a,c,p){for(let y=0,M=a.length;y!==M;++y){const r=a[y],I=c[r.id];I.needsUpdate!==!1&&r.setValue(e,I.value,p)}}static seqWithValue(e,a){const c=[];for(let p=0,y=e.length;p!==y;++p){const M=e[p];M.id in a&&c.push(M)}return c}}function aL(t,e,a){const c=t.createShader(e);return t.shaderSource(c,a),t.compileShader(c),c}const iK=37297;let rK=0;function aK(t,e){const a=t.split(`
`),c=[],p=Math.max(e-6,0),y=Math.min(e+6,a.length);for(let M=p;M<y;M++){const r=M+1;c.push(`${r===e?">":" "} ${r}: ${a[M]}`)}return c.join(`
`)}const oL=new wr;function oK(t){ta._getMatrix(oL,ta.workingColorSpace,t);const e=`mat3( ${oL.elements.map(a=>a.toFixed(4))} )`;switch(ta.getTransfer(t)){case nE:return[e,"LinearTransferOETF"];case ba:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",t),[e,"LinearTransferOETF"]}}function sL(t,e,a){const c=t.getShaderParameter(e,t.COMPILE_STATUS),p=t.getShaderInfoLog(e).trim();if(c&&p==="")return"";const y=/ERROR: 0:(\d+)/.exec(p);if(y){const M=parseInt(y[1]);return a.toUpperCase()+`

`+p+`

`+aK(t.getShaderSource(e),M)}else return p}function sK(t,e){const a=oK(e);return[`vec4 ${t}( vec4 value ) {`,`	return ${a[1]}( vec4( value.rgb * ${a[0]}, value.a ) );`,"}"].join(`
`)}function lK(t,e){let a;switch(e){case s9:a="Linear";break;case l9:a="Reinhard";break;case c9:a="Cineon";break;case u9:a="ACESFilmic";break;case d9:a="AgX";break;case f9:a="Neutral";break;case h9:a="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),a="Linear"}return"vec3 "+t+"( vec3 color ) { return "+a+"ToneMapping( color ); }"}const K1=new un;function cK(){ta.getLuminanceCoefficients(K1);const t=K1.x.toFixed(4),e=K1.y.toFixed(4),a=K1.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${t}, ${e}, ${a} );`,"	return dot( weights, rgb );","}"].join(`
`)}function uK(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(o0).join(`
`)}function hK(t){const e=[];for(const a in t){const c=t[a];c!==!1&&e.push("#define "+a+" "+c)}return e.join(`
`)}function dK(t,e){const a={},c=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let p=0;p<c;p++){const y=t.getActiveAttrib(e,p),M=y.name;let r=1;y.type===t.FLOAT_MAT2&&(r=2),y.type===t.FLOAT_MAT3&&(r=3),y.type===t.FLOAT_MAT4&&(r=4),a[M]={type:y.type,location:t.getAttribLocation(e,M),locationSize:r}}return a}function o0(t){return t!==""}function lL(t,e){const a=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,a).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function cL(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const fK=/^[ \t]*#include +<([\w\d./]+)>/gm;function UA(t){return t.replace(fK,mK)}const pK=new Map;function mK(t,e){let a=Ar[e];if(a===void 0){const c=pK.get(e);if(c!==void 0)a=Ar[c],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,c);else throw new Error("Can not resolve #include <"+e+">")}return UA(a)}const gK=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function uL(t){return t.replace(gK,_K)}function _K(t,e,a,c){let p="";for(let y=parseInt(e);y<parseInt(a);y++)p+=c.replace(/\[\s*i\s*\]/g,"[ "+y+" ]").replace(/UNROLLED_LOOP_INDEX/g,y);return p}function hL(t){let e=`precision ${t.precision} float;
	precision ${t.precision} int;
	precision ${t.precision} sampler2D;
	precision ${t.precision} samplerCube;
	precision ${t.precision} sampler3D;
	precision ${t.precision} sampler2DArray;
	precision ${t.precision} sampler2DShadow;
	precision ${t.precision} samplerCubeShadow;
	precision ${t.precision} sampler2DArrayShadow;
	precision ${t.precision} isampler2D;
	precision ${t.precision} isampler3D;
	precision ${t.precision} isamplerCube;
	precision ${t.precision} isampler2DArray;
	precision ${t.precision} usampler2D;
	precision ${t.precision} usampler3D;
	precision ${t.precision} usamplerCube;
	precision ${t.precision} usampler2DArray;
	`;return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function vK(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===sF?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===UW?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===kf&&(e="SHADOWMAP_TYPE_VSM"),e}function yK(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Sy:case Ey:e="ENVMAP_TYPE_CUBE";break;case PE:e="ENVMAP_TYPE_CUBE_UV";break}return e}function xK(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case Ey:e="ENVMAP_MODE_REFRACTION";break}return e}function bK(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case lF:e="ENVMAP_BLENDING_MULTIPLY";break;case a9:e="ENVMAP_BLENDING_MIX";break;case o9:e="ENVMAP_BLENDING_ADD";break}return e}function wK(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const a=Math.log2(e)-2,c=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,a),7*16)),texelHeight:c,maxMip:a}}function SK(t,e,a,c){const p=t.getContext(),y=a.defines;let M=a.vertexShader,r=a.fragmentShader;const I=vK(a),k=yK(a),B=xK(a),U=bK(a),H=wK(a),Y=uK(a),X=hK(y),Q=p.createProgram();let J,j,oe=a.glslVersion?"#version "+a.glslVersion+`
`:"";a.isRawShaderMaterial?(J=["#define SHADER_TYPE "+a.shaderType,"#define SHADER_NAME "+a.shaderName,X].filter(o0).join(`
`),J.length>0&&(J+=`
`),j=["#define SHADER_TYPE "+a.shaderType,"#define SHADER_NAME "+a.shaderName,X].filter(o0).join(`
`),j.length>0&&(j+=`
`)):(J=[hL(a),"#define SHADER_TYPE "+a.shaderType,"#define SHADER_NAME "+a.shaderName,X,a.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",a.batching?"#define USE_BATCHING":"",a.batchingColor?"#define USE_BATCHING_COLOR":"",a.instancing?"#define USE_INSTANCING":"",a.instancingColor?"#define USE_INSTANCING_COLOR":"",a.instancingMorph?"#define USE_INSTANCING_MORPH":"",a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+B:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",a.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",a.displacementMap?"#define USE_DISPLACEMENTMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.anisotropy?"#define USE_ANISOTROPY":"",a.anisotropyMap?"#define USE_ANISOTROPYMAP":"",a.clearcoatMap?"#define USE_CLEARCOATMAP":"",a.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",a.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",a.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.alphaHash?"#define USE_ALPHAHASH":"",a.transmission?"#define USE_TRANSMISSION":"",a.transmissionMap?"#define USE_TRANSMISSIONMAP":"",a.thicknessMap?"#define USE_THICKNESSMAP":"",a.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",a.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",a.mapUv?"#define MAP_UV "+a.mapUv:"",a.alphaMapUv?"#define ALPHAMAP_UV "+a.alphaMapUv:"",a.lightMapUv?"#define LIGHTMAP_UV "+a.lightMapUv:"",a.aoMapUv?"#define AOMAP_UV "+a.aoMapUv:"",a.emissiveMapUv?"#define EMISSIVEMAP_UV "+a.emissiveMapUv:"",a.bumpMapUv?"#define BUMPMAP_UV "+a.bumpMapUv:"",a.normalMapUv?"#define NORMALMAP_UV "+a.normalMapUv:"",a.displacementMapUv?"#define DISPLACEMENTMAP_UV "+a.displacementMapUv:"",a.metalnessMapUv?"#define METALNESSMAP_UV "+a.metalnessMapUv:"",a.roughnessMapUv?"#define ROUGHNESSMAP_UV "+a.roughnessMapUv:"",a.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+a.anisotropyMapUv:"",a.clearcoatMapUv?"#define CLEARCOATMAP_UV "+a.clearcoatMapUv:"",a.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+a.clearcoatNormalMapUv:"",a.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+a.clearcoatRoughnessMapUv:"",a.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+a.iridescenceMapUv:"",a.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+a.iridescenceThicknessMapUv:"",a.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+a.sheenColorMapUv:"",a.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+a.sheenRoughnessMapUv:"",a.specularMapUv?"#define SPECULARMAP_UV "+a.specularMapUv:"",a.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+a.specularColorMapUv:"",a.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+a.specularIntensityMapUv:"",a.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+a.transmissionMapUv:"",a.thicknessMapUv?"#define THICKNESSMAP_UV "+a.thicknessMapUv:"",a.vertexTangents&&a.flatShading===!1?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.vertexAlphas?"#define USE_COLOR_ALPHA":"",a.vertexUv1s?"#define USE_UV1":"",a.vertexUv2s?"#define USE_UV2":"",a.vertexUv3s?"#define USE_UV3":"",a.pointsUvs?"#define USE_POINTS_UV":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&a.flatShading===!1?"#define USE_MORPHNORMALS":"",a.morphColors?"#define USE_MORPHCOLORS":"",a.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+a.morphTextureStride:"",a.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+a.morphTargetsCount:"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+I:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.numLightProbes>0?"#define USE_LIGHT_PROBES":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(o0).join(`
`),j=[hL(a),"#define SHADER_TYPE "+a.shaderType,"#define SHADER_NAME "+a.shaderName,X,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",a.map?"#define USE_MAP":"",a.matcap?"#define USE_MATCAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+k:"",a.envMap?"#define "+B:"",a.envMap?"#define "+U:"",H?"#define CUBEUV_TEXEL_WIDTH "+H.texelWidth:"",H?"#define CUBEUV_TEXEL_HEIGHT "+H.texelHeight:"",H?"#define CUBEUV_MAX_MIP "+H.maxMip+".0":"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",a.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.anisotropy?"#define USE_ANISOTROPY":"",a.anisotropyMap?"#define USE_ANISOTROPYMAP":"",a.clearcoat?"#define USE_CLEARCOAT":"",a.clearcoatMap?"#define USE_CLEARCOATMAP":"",a.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.dispersion?"#define USE_DISPERSION":"",a.iridescence?"#define USE_IRIDESCENCE":"",a.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",a.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",a.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.alphaTest?"#define USE_ALPHATEST":"",a.alphaHash?"#define USE_ALPHAHASH":"",a.sheen?"#define USE_SHEEN":"",a.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",a.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",a.transmission?"#define USE_TRANSMISSION":"",a.transmissionMap?"#define USE_TRANSMISSIONMAP":"",a.thicknessMap?"#define USE_THICKNESSMAP":"",a.vertexTangents&&a.flatShading===!1?"#define USE_TANGENT":"",a.vertexColors||a.instancingColor||a.batchingColor?"#define USE_COLOR":"",a.vertexAlphas?"#define USE_COLOR_ALPHA":"",a.vertexUv1s?"#define USE_UV1":"",a.vertexUv2s?"#define USE_UV2":"",a.vertexUv3s?"#define USE_UV3":"",a.pointsUvs?"#define USE_POINTS_UV":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+I:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.numLightProbes>0?"#define USE_LIGHT_PROBES":"",a.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",a.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",a.toneMapping!==xm?"#define TONE_MAPPING":"",a.toneMapping!==xm?Ar.tonemapping_pars_fragment:"",a.toneMapping!==xm?lK("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.opaque?"#define OPAQUE":"",Ar.colorspace_pars_fragment,sK("linearToOutputTexel",a.outputColorSpace),cK(),a.useDepthPacking?"#define DEPTH_PACKING "+a.depthPacking:"",`
`].filter(o0).join(`
`)),M=UA(M),M=lL(M,a),M=cL(M,a),r=UA(r),r=lL(r,a),r=cL(r,a),M=uL(M),r=uL(r),a.isRawShaderMaterial!==!0&&(oe=`#version 300 es
`,J=[Y,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+J,j=["#define varying in",a.glslVersion===M3?"":"layout(location = 0) out highp vec4 pc_fragColor;",a.glslVersion===M3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+j);const ce=oe+J+M,pe=oe+j+r,Ae=aL(p,p.VERTEX_SHADER,ce),Ee=aL(p,p.FRAGMENT_SHADER,pe);p.attachShader(Q,Ae),p.attachShader(Q,Ee),a.index0AttributeName!==void 0?p.bindAttribLocation(Q,0,a.index0AttributeName):a.morphTargets===!0&&p.bindAttribLocation(Q,0,"position"),p.linkProgram(Q);function be(Fe){if(t.debug.checkShaderErrors){const Ct=p.getProgramInfoLog(Q).trim(),Et=p.getShaderInfoLog(Ae).trim(),Tt=p.getShaderInfoLog(Ee).trim();let _t=!0,et=!0;if(p.getProgramParameter(Q,p.LINK_STATUS)===!1)if(_t=!1,typeof t.debug.onShaderError=="function")t.debug.onShaderError(p,Q,Ae,Ee);else{const Lt=sL(p,Ae,"vertex"),lt=sL(p,Ee,"fragment");console.error("THREE.WebGLProgram: Shader Error "+p.getError()+" - VALIDATE_STATUS "+p.getProgramParameter(Q,p.VALIDATE_STATUS)+`

Material Name: `+Fe.name+`
Material Type: `+Fe.type+`

Program Info Log: `+Ct+`
`+Lt+`
`+lt)}else Ct!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Ct):(Et===""||Tt==="")&&(et=!1);et&&(Fe.diagnostics={runnable:_t,programLog:Ct,vertexShader:{log:Et,prefix:J},fragmentShader:{log:Tt,prefix:j}})}p.deleteShader(Ae),p.deleteShader(Ee),Ve=new hw(p,Q),Se=dK(p,Q)}let Ve;this.getUniforms=function(){return Ve===void 0&&be(this),Ve};let Se;this.getAttributes=function(){return Se===void 0&&be(this),Se};let xe=a.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return xe===!1&&(xe=p.getProgramParameter(Q,iK)),xe},this.destroy=function(){c.releaseStatesOfProgram(this),p.deleteProgram(Q),this.program=void 0},this.type=a.shaderType,this.name=a.shaderName,this.id=rK++,this.cacheKey=e,this.usedTimes=1,this.program=Q,this.vertexShader=Ae,this.fragmentShader=Ee,this}let EK=0;class MK{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const a=e.vertexShader,c=e.fragmentShader,p=this._getShaderStage(a),y=this._getShaderStage(c),M=this._getShaderCacheForMaterial(e);return M.has(p)===!1&&(M.add(p),p.usedTimes++),M.has(y)===!1&&(M.add(y),y.usedTimes++),this}remove(e){const a=this.materialCache.get(e);for(const c of a)c.usedTimes--,c.usedTimes===0&&this.shaderCache.delete(c.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const a=this.materialCache;let c=a.get(e);return c===void 0&&(c=new Set,a.set(e,c)),c}_getShaderStage(e){const a=this.shaderCache;let c=a.get(e);return c===void 0&&(c=new TK(e),a.set(e,c)),c}}class TK{constructor(e){this.id=EK++,this.code=e,this.usedTimes=0}}function AK(t,e,a,c,p,y,M){const r=new EF,I=new MK,k=new Set,B=[],U=p.logarithmicDepthBuffer,H=p.vertexTextures;let Y=p.precision;const X={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function Q(Se){return k.add(Se),Se===0?"uv":`uv${Se}`}function J(Se,xe,Fe,Ct,Et){const Tt=Ct.fog,_t=Et.geometry,et=Se.isMeshStandardMaterial?Ct.environment:null,Lt=(Se.isMeshStandardMaterial?a:e).get(Se.envMap||et),lt=Lt&&Lt.mapping===PE?Lt.image.height:null,ut=X[Se.type];Se.precision!==null&&(Y=p.getMaxPrecision(Se.precision),Y!==Se.precision&&console.warn("THREE.WebGLProgram.getParameters:",Se.precision,"not supported, using",Y,"instead."));const Xe=_t.morphAttributes.position||_t.morphAttributes.normal||_t.morphAttributes.color,kt=Xe!==void 0?Xe.length:0;let _n=0;_t.morphAttributes.position!==void 0&&(_n=1),_t.morphAttributes.normal!==void 0&&(_n=2),_t.morphAttributes.color!==void 0&&(_n=3);let Xt,It,ln,fn;if(ut){const Cr=vd[ut];Xt=Cr.vertexShader,It=Cr.fragmentShader}else Xt=Se.vertexShader,It=Se.fragmentShader,I.update(Se),ln=I.getVertexShaderID(Se),fn=I.getFragmentShaderID(Se);const $t=t.getRenderTarget(),pn=t.state.buffers.depth.getReversed(),jn=Et.isInstancedMesh===!0,Pe=Et.isBatchedMesh===!0,Gn=!!Se.map,vn=!!Se.matcap,qn=!!Lt,ke=!!Se.aoMap,Fi=!!Se.lightMap,di=!!Se.bumpMap,bi=!!Se.normalMap,Mn=!!Se.displacementMap,wi=!!Se.emissiveMap,ei=!!Se.metalnessMap,ot=!!Se.roughnessMap,Ue=Se.anisotropy>0,Yt=Se.clearcoat>0,gt=Se.dispersion>0,Kt=Se.iridescence>0,an=Se.sheen>0,Xn=Se.transmission>0,On=Ue&&!!Se.anisotropyMap,Jn=Yt&&!!Se.clearcoatMap,Ni=Yt&&!!Se.clearcoatNormalMap,Un=Yt&&!!Se.clearcoatRoughnessMap,si=Kt&&!!Se.iridescenceMap,ci=Kt&&!!Se.iridescenceThicknessMap,_i=an&&!!Se.sheenColorMap,ui=an&&!!Se.sheenRoughnessMap,Ai=!!Se.specularMap,Si=!!Se.specularColorMap,Wn=!!Se.specularIntensityMap,Ot=Xn&&!!Se.transmissionMap,ai=Xn&&!!Se.thicknessMap,on=!!Se.gradientMap,wn=!!Se.alphaMap,Kn=Se.alphaTest>0,ti=!!Se.alphaHash,Vi=!!Se.extensions;let Zr=xm;Se.toneMapped&&($t===null||$t.isXRRenderTarget===!0)&&(Zr=t.toneMapping);const ga={shaderID:ut,shaderType:Se.type,shaderName:Se.name,vertexShader:Xt,fragmentShader:It,defines:Se.defines,customVertexShaderID:ln,customFragmentShaderID:fn,isRawShaderMaterial:Se.isRawShaderMaterial===!0,glslVersion:Se.glslVersion,precision:Y,batching:Pe,batchingColor:Pe&&Et._colorsTexture!==null,instancing:jn,instancingColor:jn&&Et.instanceColor!==null,instancingMorph:jn&&Et.morphTexture!==null,supportsVertexTextures:H,outputColorSpace:$t===null?t.outputColorSpace:$t.isXRRenderTarget===!0?$t.texture.colorSpace:Ay,alphaToCoverage:!!Se.alphaToCoverage,map:Gn,matcap:vn,envMap:qn,envMapMode:qn&&Lt.mapping,envMapCubeUVHeight:lt,aoMap:ke,lightMap:Fi,bumpMap:di,normalMap:bi,displacementMap:H&&Mn,emissiveMap:wi,normalMapObjectSpace:bi&&Se.normalMapType===_9,normalMapTangentSpace:bi&&Se.normalMapType===xF,metalnessMap:ei,roughnessMap:ot,anisotropy:Ue,anisotropyMap:On,clearcoat:Yt,clearcoatMap:Jn,clearcoatNormalMap:Ni,clearcoatRoughnessMap:Un,dispersion:gt,iridescence:Kt,iridescenceMap:si,iridescenceThicknessMap:ci,sheen:an,sheenColorMap:_i,sheenRoughnessMap:ui,specularMap:Ai,specularColorMap:Si,specularIntensityMap:Wn,transmission:Xn,transmissionMap:Ot,thicknessMap:ai,gradientMap:on,opaque:Se.transparent===!1&&Se.blending===gy&&Se.alphaToCoverage===!1,alphaMap:wn,alphaTest:Kn,alphaHash:ti,combine:Se.combine,mapUv:Gn&&Q(Se.map.channel),aoMapUv:ke&&Q(Se.aoMap.channel),lightMapUv:Fi&&Q(Se.lightMap.channel),bumpMapUv:di&&Q(Se.bumpMap.channel),normalMapUv:bi&&Q(Se.normalMap.channel),displacementMapUv:Mn&&Q(Se.displacementMap.channel),emissiveMapUv:wi&&Q(Se.emissiveMap.channel),metalnessMapUv:ei&&Q(Se.metalnessMap.channel),roughnessMapUv:ot&&Q(Se.roughnessMap.channel),anisotropyMapUv:On&&Q(Se.anisotropyMap.channel),clearcoatMapUv:Jn&&Q(Se.clearcoatMap.channel),clearcoatNormalMapUv:Ni&&Q(Se.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Un&&Q(Se.clearcoatRoughnessMap.channel),iridescenceMapUv:si&&Q(Se.iridescenceMap.channel),iridescenceThicknessMapUv:ci&&Q(Se.iridescenceThicknessMap.channel),sheenColorMapUv:_i&&Q(Se.sheenColorMap.channel),sheenRoughnessMapUv:ui&&Q(Se.sheenRoughnessMap.channel),specularMapUv:Ai&&Q(Se.specularMap.channel),specularColorMapUv:Si&&Q(Se.specularColorMap.channel),specularIntensityMapUv:Wn&&Q(Se.specularIntensityMap.channel),transmissionMapUv:Ot&&Q(Se.transmissionMap.channel),thicknessMapUv:ai&&Q(Se.thicknessMap.channel),alphaMapUv:wn&&Q(Se.alphaMap.channel),vertexTangents:!!_t.attributes.tangent&&(bi||Ue),vertexColors:Se.vertexColors,vertexAlphas:Se.vertexColors===!0&&!!_t.attributes.color&&_t.attributes.color.itemSize===4,pointsUvs:Et.isPoints===!0&&!!_t.attributes.uv&&(Gn||wn),fog:!!Tt,useFog:Se.fog===!0,fogExp2:!!Tt&&Tt.isFogExp2,flatShading:Se.flatShading===!0,sizeAttenuation:Se.sizeAttenuation===!0,logarithmicDepthBuffer:U,reverseDepthBuffer:pn,skinning:Et.isSkinnedMesh===!0,morphTargets:_t.morphAttributes.position!==void 0,morphNormals:_t.morphAttributes.normal!==void 0,morphColors:_t.morphAttributes.color!==void 0,morphTargetsCount:kt,morphTextureStride:_n,numDirLights:xe.directional.length,numPointLights:xe.point.length,numSpotLights:xe.spot.length,numSpotLightMaps:xe.spotLightMap.length,numRectAreaLights:xe.rectArea.length,numHemiLights:xe.hemi.length,numDirLightShadows:xe.directionalShadowMap.length,numPointLightShadows:xe.pointShadowMap.length,numSpotLightShadows:xe.spotShadowMap.length,numSpotLightShadowsWithMaps:xe.numSpotLightShadowsWithMaps,numLightProbes:xe.numLightProbes,numClippingPlanes:M.numPlanes,numClipIntersection:M.numIntersection,dithering:Se.dithering,shadowMapEnabled:t.shadowMap.enabled&&Fe.length>0,shadowMapType:t.shadowMap.type,toneMapping:Zr,decodeVideoTexture:Gn&&Se.map.isVideoTexture===!0&&ta.getTransfer(Se.map.colorSpace)===ba,decodeVideoTextureEmissive:wi&&Se.emissiveMap.isVideoTexture===!0&&ta.getTransfer(Se.emissiveMap.colorSpace)===ba,premultipliedAlpha:Se.premultipliedAlpha,doubleSided:Se.side===Gf,flipSided:Se.side===Ll,useDepthPacking:Se.depthPacking>=0,depthPacking:Se.depthPacking||0,index0AttributeName:Se.index0AttributeName,extensionClipCullDistance:Vi&&Se.extensions.clipCullDistance===!0&&c.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Vi&&Se.extensions.multiDraw===!0||Pe)&&c.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:c.has("KHR_parallel_shader_compile"),customProgramCacheKey:Se.customProgramCacheKey()};return ga.vertexUv1s=k.has(1),ga.vertexUv2s=k.has(2),ga.vertexUv3s=k.has(3),k.clear(),ga}function j(Se){const xe=[];if(Se.shaderID?xe.push(Se.shaderID):(xe.push(Se.customVertexShaderID),xe.push(Se.customFragmentShaderID)),Se.defines!==void 0)for(const Fe in Se.defines)xe.push(Fe),xe.push(Se.defines[Fe]);return Se.isRawShaderMaterial===!1&&(oe(xe,Se),ce(xe,Se),xe.push(t.outputColorSpace)),xe.push(Se.customProgramCacheKey),xe.join()}function oe(Se,xe){Se.push(xe.precision),Se.push(xe.outputColorSpace),Se.push(xe.envMapMode),Se.push(xe.envMapCubeUVHeight),Se.push(xe.mapUv),Se.push(xe.alphaMapUv),Se.push(xe.lightMapUv),Se.push(xe.aoMapUv),Se.push(xe.bumpMapUv),Se.push(xe.normalMapUv),Se.push(xe.displacementMapUv),Se.push(xe.emissiveMapUv),Se.push(xe.metalnessMapUv),Se.push(xe.roughnessMapUv),Se.push(xe.anisotropyMapUv),Se.push(xe.clearcoatMapUv),Se.push(xe.clearcoatNormalMapUv),Se.push(xe.clearcoatRoughnessMapUv),Se.push(xe.iridescenceMapUv),Se.push(xe.iridescenceThicknessMapUv),Se.push(xe.sheenColorMapUv),Se.push(xe.sheenRoughnessMapUv),Se.push(xe.specularMapUv),Se.push(xe.specularColorMapUv),Se.push(xe.specularIntensityMapUv),Se.push(xe.transmissionMapUv),Se.push(xe.thicknessMapUv),Se.push(xe.combine),Se.push(xe.fogExp2),Se.push(xe.sizeAttenuation),Se.push(xe.morphTargetsCount),Se.push(xe.morphAttributeCount),Se.push(xe.numDirLights),Se.push(xe.numPointLights),Se.push(xe.numSpotLights),Se.push(xe.numSpotLightMaps),Se.push(xe.numHemiLights),Se.push(xe.numRectAreaLights),Se.push(xe.numDirLightShadows),Se.push(xe.numPointLightShadows),Se.push(xe.numSpotLightShadows),Se.push(xe.numSpotLightShadowsWithMaps),Se.push(xe.numLightProbes),Se.push(xe.shadowMapType),Se.push(xe.toneMapping),Se.push(xe.numClippingPlanes),Se.push(xe.numClipIntersection),Se.push(xe.depthPacking)}function ce(Se,xe){r.disableAll(),xe.supportsVertexTextures&&r.enable(0),xe.instancing&&r.enable(1),xe.instancingColor&&r.enable(2),xe.instancingMorph&&r.enable(3),xe.matcap&&r.enable(4),xe.envMap&&r.enable(5),xe.normalMapObjectSpace&&r.enable(6),xe.normalMapTangentSpace&&r.enable(7),xe.clearcoat&&r.enable(8),xe.iridescence&&r.enable(9),xe.alphaTest&&r.enable(10),xe.vertexColors&&r.enable(11),xe.vertexAlphas&&r.enable(12),xe.vertexUv1s&&r.enable(13),xe.vertexUv2s&&r.enable(14),xe.vertexUv3s&&r.enable(15),xe.vertexTangents&&r.enable(16),xe.anisotropy&&r.enable(17),xe.alphaHash&&r.enable(18),xe.batching&&r.enable(19),xe.dispersion&&r.enable(20),xe.batchingColor&&r.enable(21),Se.push(r.mask),r.disableAll(),xe.fog&&r.enable(0),xe.useFog&&r.enable(1),xe.flatShading&&r.enable(2),xe.logarithmicDepthBuffer&&r.enable(3),xe.reverseDepthBuffer&&r.enable(4),xe.skinning&&r.enable(5),xe.morphTargets&&r.enable(6),xe.morphNormals&&r.enable(7),xe.morphColors&&r.enable(8),xe.premultipliedAlpha&&r.enable(9),xe.shadowMapEnabled&&r.enable(10),xe.doubleSided&&r.enable(11),xe.flipSided&&r.enable(12),xe.useDepthPacking&&r.enable(13),xe.dithering&&r.enable(14),xe.transmission&&r.enable(15),xe.sheen&&r.enable(16),xe.opaque&&r.enable(17),xe.pointsUvs&&r.enable(18),xe.decodeVideoTexture&&r.enable(19),xe.decodeVideoTextureEmissive&&r.enable(20),xe.alphaToCoverage&&r.enable(21),Se.push(r.mask)}function pe(Se){const xe=X[Se.type];let Fe;if(xe){const Ct=vd[xe];Fe=Z9.clone(Ct.uniforms)}else Fe=Se.uniforms;return Fe}function Ae(Se,xe){let Fe;for(let Ct=0,Et=B.length;Ct<Et;Ct++){const Tt=B[Ct];if(Tt.cacheKey===xe){Fe=Tt,++Fe.usedTimes;break}}return Fe===void 0&&(Fe=new SK(t,xe,Se,y),B.push(Fe)),Fe}function Ee(Se){if(--Se.usedTimes===0){const xe=B.indexOf(Se);B[xe]=B[B.length-1],B.pop(),Se.destroy()}}function be(Se){I.remove(Se)}function Ve(){I.dispose()}return{getParameters:J,getProgramCacheKey:j,getUniforms:pe,acquireProgram:Ae,releaseProgram:Ee,releaseShaderCache:be,programs:B,dispose:Ve}}function CK(){let t=new WeakMap;function e(M){return t.has(M)}function a(M){let r=t.get(M);return r===void 0&&(r={},t.set(M,r)),r}function c(M){t.delete(M)}function p(M,r,I){t.get(M)[r]=I}function y(){t=new WeakMap}return{has:e,get:a,remove:c,update:p,dispose:y}}function RK(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function dL(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function fL(){const t=[];let e=0;const a=[],c=[],p=[];function y(){e=0,a.length=0,c.length=0,p.length=0}function M(U,H,Y,X,Q,J){let j=t[e];return j===void 0?(j={id:U.id,object:U,geometry:H,material:Y,groupOrder:X,renderOrder:U.renderOrder,z:Q,group:J},t[e]=j):(j.id=U.id,j.object=U,j.geometry=H,j.material=Y,j.groupOrder=X,j.renderOrder=U.renderOrder,j.z=Q,j.group=J),e++,j}function r(U,H,Y,X,Q,J){const j=M(U,H,Y,X,Q,J);Y.transmission>0?c.push(j):Y.transparent===!0?p.push(j):a.push(j)}function I(U,H,Y,X,Q,J){const j=M(U,H,Y,X,Q,J);Y.transmission>0?c.unshift(j):Y.transparent===!0?p.unshift(j):a.unshift(j)}function k(U,H){a.length>1&&a.sort(U||RK),c.length>1&&c.sort(H||dL),p.length>1&&p.sort(H||dL)}function B(){for(let U=e,H=t.length;U<H;U++){const Y=t[U];if(Y.id===null)break;Y.id=null,Y.object=null,Y.geometry=null,Y.material=null,Y.group=null}}return{opaque:a,transmissive:c,transparent:p,init:y,push:r,unshift:I,finish:B,sort:k}}function IK(){let t=new WeakMap;function e(c,p){const y=t.get(c);let M;return y===void 0?(M=new fL,t.set(c,[M])):p>=y.length?(M=new fL,y.push(M)):M=y[p],M}function a(){t=new WeakMap}return{get:e,dispose:a}}function DK(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let a;switch(e.type){case"DirectionalLight":a={direction:new un,color:new sa};break;case"SpotLight":a={position:new un,direction:new un,color:new sa,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":a={position:new un,color:new sa,distance:0,decay:0};break;case"HemisphereLight":a={direction:new un,skyColor:new sa,groundColor:new sa};break;case"RectAreaLight":a={color:new sa,position:new un,halfWidth:new un,halfHeight:new un};break}return t[e.id]=a,a}}}function PK(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let a;switch(e.type){case"DirectionalLight":a={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ma};break;case"SpotLight":a={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ma};break;case"PointLight":a={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ma,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=a,a}}}let LK=0;function OK(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function zK(t){const e=new DK,a=PK(),c={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let k=0;k<9;k++)c.probe.push(new un);const p=new un,y=new Ba,M=new Ba;function r(k){let B=0,U=0,H=0;for(let Se=0;Se<9;Se++)c.probe[Se].set(0,0,0);let Y=0,X=0,Q=0,J=0,j=0,oe=0,ce=0,pe=0,Ae=0,Ee=0,be=0;k.sort(OK);for(let Se=0,xe=k.length;Se<xe;Se++){const Fe=k[Se],Ct=Fe.color,Et=Fe.intensity,Tt=Fe.distance,_t=Fe.shadow&&Fe.shadow.map?Fe.shadow.map.texture:null;if(Fe.isAmbientLight)B+=Ct.r*Et,U+=Ct.g*Et,H+=Ct.b*Et;else if(Fe.isLightProbe){for(let et=0;et<9;et++)c.probe[et].addScaledVector(Fe.sh.coefficients[et],Et);be++}else if(Fe.isDirectionalLight){const et=e.get(Fe);if(et.color.copy(Fe.color).multiplyScalar(Fe.intensity),Fe.castShadow){const Lt=Fe.shadow,lt=a.get(Fe);lt.shadowIntensity=Lt.intensity,lt.shadowBias=Lt.bias,lt.shadowNormalBias=Lt.normalBias,lt.shadowRadius=Lt.radius,lt.shadowMapSize=Lt.mapSize,c.directionalShadow[Y]=lt,c.directionalShadowMap[Y]=_t,c.directionalShadowMatrix[Y]=Fe.shadow.matrix,oe++}c.directional[Y]=et,Y++}else if(Fe.isSpotLight){const et=e.get(Fe);et.position.setFromMatrixPosition(Fe.matrixWorld),et.color.copy(Ct).multiplyScalar(Et),et.distance=Tt,et.coneCos=Math.cos(Fe.angle),et.penumbraCos=Math.cos(Fe.angle*(1-Fe.penumbra)),et.decay=Fe.decay,c.spot[Q]=et;const Lt=Fe.shadow;if(Fe.map&&(c.spotLightMap[Ae]=Fe.map,Ae++,Lt.updateMatrices(Fe),Fe.castShadow&&Ee++),c.spotLightMatrix[Q]=Lt.matrix,Fe.castShadow){const lt=a.get(Fe);lt.shadowIntensity=Lt.intensity,lt.shadowBias=Lt.bias,lt.shadowNormalBias=Lt.normalBias,lt.shadowRadius=Lt.radius,lt.shadowMapSize=Lt.mapSize,c.spotShadow[Q]=lt,c.spotShadowMap[Q]=_t,pe++}Q++}else if(Fe.isRectAreaLight){const et=e.get(Fe);et.color.copy(Ct).multiplyScalar(Et),et.halfWidth.set(Fe.width*.5,0,0),et.halfHeight.set(0,Fe.height*.5,0),c.rectArea[J]=et,J++}else if(Fe.isPointLight){const et=e.get(Fe);if(et.color.copy(Fe.color).multiplyScalar(Fe.intensity),et.distance=Fe.distance,et.decay=Fe.decay,Fe.castShadow){const Lt=Fe.shadow,lt=a.get(Fe);lt.shadowIntensity=Lt.intensity,lt.shadowBias=Lt.bias,lt.shadowNormalBias=Lt.normalBias,lt.shadowRadius=Lt.radius,lt.shadowMapSize=Lt.mapSize,lt.shadowCameraNear=Lt.camera.near,lt.shadowCameraFar=Lt.camera.far,c.pointShadow[X]=lt,c.pointShadowMap[X]=_t,c.pointShadowMatrix[X]=Fe.shadow.matrix,ce++}c.point[X]=et,X++}else if(Fe.isHemisphereLight){const et=e.get(Fe);et.skyColor.copy(Fe.color).multiplyScalar(Et),et.groundColor.copy(Fe.groundColor).multiplyScalar(Et),c.hemi[j]=et,j++}}J>0&&(t.has("OES_texture_float_linear")===!0?(c.rectAreaLTC1=vi.LTC_FLOAT_1,c.rectAreaLTC2=vi.LTC_FLOAT_2):(c.rectAreaLTC1=vi.LTC_HALF_1,c.rectAreaLTC2=vi.LTC_HALF_2)),c.ambient[0]=B,c.ambient[1]=U,c.ambient[2]=H;const Ve=c.hash;(Ve.directionalLength!==Y||Ve.pointLength!==X||Ve.spotLength!==Q||Ve.rectAreaLength!==J||Ve.hemiLength!==j||Ve.numDirectionalShadows!==oe||Ve.numPointShadows!==ce||Ve.numSpotShadows!==pe||Ve.numSpotMaps!==Ae||Ve.numLightProbes!==be)&&(c.directional.length=Y,c.spot.length=Q,c.rectArea.length=J,c.point.length=X,c.hemi.length=j,c.directionalShadow.length=oe,c.directionalShadowMap.length=oe,c.pointShadow.length=ce,c.pointShadowMap.length=ce,c.spotShadow.length=pe,c.spotShadowMap.length=pe,c.directionalShadowMatrix.length=oe,c.pointShadowMatrix.length=ce,c.spotLightMatrix.length=pe+Ae-Ee,c.spotLightMap.length=Ae,c.numSpotLightShadowsWithMaps=Ee,c.numLightProbes=be,Ve.directionalLength=Y,Ve.pointLength=X,Ve.spotLength=Q,Ve.rectAreaLength=J,Ve.hemiLength=j,Ve.numDirectionalShadows=oe,Ve.numPointShadows=ce,Ve.numSpotShadows=pe,Ve.numSpotMaps=Ae,Ve.numLightProbes=be,c.version=LK++)}function I(k,B){let U=0,H=0,Y=0,X=0,Q=0;const J=B.matrixWorldInverse;for(let j=0,oe=k.length;j<oe;j++){const ce=k[j];if(ce.isDirectionalLight){const pe=c.directional[U];pe.direction.setFromMatrixPosition(ce.matrixWorld),p.setFromMatrixPosition(ce.target.matrixWorld),pe.direction.sub(p),pe.direction.transformDirection(J),U++}else if(ce.isSpotLight){const pe=c.spot[Y];pe.position.setFromMatrixPosition(ce.matrixWorld),pe.position.applyMatrix4(J),pe.direction.setFromMatrixPosition(ce.matrixWorld),p.setFromMatrixPosition(ce.target.matrixWorld),pe.direction.sub(p),pe.direction.transformDirection(J),Y++}else if(ce.isRectAreaLight){const pe=c.rectArea[X];pe.position.setFromMatrixPosition(ce.matrixWorld),pe.position.applyMatrix4(J),M.identity(),y.copy(ce.matrixWorld),y.premultiply(J),M.extractRotation(y),pe.halfWidth.set(ce.width*.5,0,0),pe.halfHeight.set(0,ce.height*.5,0),pe.halfWidth.applyMatrix4(M),pe.halfHeight.applyMatrix4(M),X++}else if(ce.isPointLight){const pe=c.point[H];pe.position.setFromMatrixPosition(ce.matrixWorld),pe.position.applyMatrix4(J),H++}else if(ce.isHemisphereLight){const pe=c.hemi[Q];pe.direction.setFromMatrixPosition(ce.matrixWorld),pe.direction.transformDirection(J),Q++}}}return{setup:r,setupView:I,state:c}}function pL(t){const e=new zK(t),a=[],c=[];function p(B){k.camera=B,a.length=0,c.length=0}function y(B){a.push(B)}function M(B){c.push(B)}function r(){e.setup(a)}function I(B){e.setupView(a,B)}const k={lightsArray:a,shadowsArray:c,camera:null,lights:e,transmissionRenderTarget:{}};return{init:p,state:k,setupLights:r,setupLightsView:I,pushLight:y,pushShadow:M}}function kK(t){let e=new WeakMap;function a(p,y=0){const M=e.get(p);let r;return M===void 0?(r=new pL(t),e.set(p,[r])):y>=M.length?(r=new pL(t),M.push(r)):r=M[y],r}function c(){e=new WeakMap}return{get:a,dispose:c}}const FK=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,NK=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function BK(t,e,a){let c=new DF;const p=new ma,y=new ma,M=new Mo,r=new a$({depthPacking:g9}),I=new o$,k={},B=a.maxTextureSize,U={[Am]:Ll,[Ll]:Am,[Gf]:Gf},H=new Cm({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ma},radius:{value:4}},vertexShader:FK,fragmentShader:NK}),Y=H.clone();Y.defines.HORIZONTAL_PASS=1;const X=new Lm;X.setAttribute("position",new Ed(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const Q=new dc(X,H),J=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=sF;let j=this.type;this.render=function(Ee,be,Ve){if(J.enabled===!1||J.autoUpdate===!1&&J.needsUpdate===!1||Ee.length===0)return;const Se=t.getRenderTarget(),xe=t.getActiveCubeFace(),Fe=t.getActiveMipmapLevel(),Ct=t.state;Ct.setBlending(ym),Ct.buffers.color.setClear(1,1,1,1),Ct.buffers.depth.setTest(!0),Ct.setScissorTest(!1);const Et=j!==kf&&this.type===kf,Tt=j===kf&&this.type!==kf;for(let _t=0,et=Ee.length;_t<et;_t++){const Lt=Ee[_t],lt=Lt.shadow;if(lt===void 0){console.warn("THREE.WebGLShadowMap:",Lt,"has no shadow.");continue}if(lt.autoUpdate===!1&&lt.needsUpdate===!1)continue;p.copy(lt.mapSize);const ut=lt.getFrameExtents();if(p.multiply(ut),y.copy(lt.mapSize),(p.x>B||p.y>B)&&(p.x>B&&(y.x=Math.floor(B/ut.x),p.x=y.x*ut.x,lt.mapSize.x=y.x),p.y>B&&(y.y=Math.floor(B/ut.y),p.y=y.y*ut.y,lt.mapSize.y=y.y)),lt.map===null||Et===!0||Tt===!0){const kt=this.type!==kf?{minFilter:uh,magFilter:uh}:{};lt.map!==null&&lt.map.dispose(),lt.map=new m_(p.x,p.y,kt),lt.map.texture.name=Lt.name+".shadowMap",lt.camera.updateProjectionMatrix()}t.setRenderTarget(lt.map),t.clear();const Xe=lt.getViewportCount();for(let kt=0;kt<Xe;kt++){const _n=lt.getViewport(kt);M.set(y.x*_n.x,y.y*_n.y,y.x*_n.z,y.y*_n.w),Ct.viewport(M),lt.updateMatrices(Lt,kt),c=lt.getFrustum(),pe(be,Ve,lt.camera,Lt,this.type)}lt.isPointLightShadow!==!0&&this.type===kf&&oe(lt,Ve),lt.needsUpdate=!1}j=this.type,J.needsUpdate=!1,t.setRenderTarget(Se,xe,Fe)};function oe(Ee,be){const Ve=e.update(Q);H.defines.VSM_SAMPLES!==Ee.blurSamples&&(H.defines.VSM_SAMPLES=Ee.blurSamples,Y.defines.VSM_SAMPLES=Ee.blurSamples,H.needsUpdate=!0,Y.needsUpdate=!0),Ee.mapPass===null&&(Ee.mapPass=new m_(p.x,p.y)),H.uniforms.shadow_pass.value=Ee.map.texture,H.uniforms.resolution.value=Ee.mapSize,H.uniforms.radius.value=Ee.radius,t.setRenderTarget(Ee.mapPass),t.clear(),t.renderBufferDirect(be,null,Ve,H,Q,null),Y.uniforms.shadow_pass.value=Ee.mapPass.texture,Y.uniforms.resolution.value=Ee.mapSize,Y.uniforms.radius.value=Ee.radius,t.setRenderTarget(Ee.map),t.clear(),t.renderBufferDirect(be,null,Ve,Y,Q,null)}function ce(Ee,be,Ve,Se){let xe=null;const Fe=Ve.isPointLight===!0?Ee.customDistanceMaterial:Ee.customDepthMaterial;if(Fe!==void 0)xe=Fe;else if(xe=Ve.isPointLight===!0?I:r,t.localClippingEnabled&&be.clipShadows===!0&&Array.isArray(be.clippingPlanes)&&be.clippingPlanes.length!==0||be.displacementMap&&be.displacementScale!==0||be.alphaMap&&be.alphaTest>0||be.map&&be.alphaTest>0){const Ct=xe.uuid,Et=be.uuid;let Tt=k[Ct];Tt===void 0&&(Tt={},k[Ct]=Tt);let _t=Tt[Et];_t===void 0&&(_t=xe.clone(),Tt[Et]=_t,be.addEventListener("dispose",Ae)),xe=_t}if(xe.visible=be.visible,xe.wireframe=be.wireframe,Se===kf?xe.side=be.shadowSide!==null?be.shadowSide:be.side:xe.side=be.shadowSide!==null?be.shadowSide:U[be.side],xe.alphaMap=be.alphaMap,xe.alphaTest=be.alphaTest,xe.map=be.map,xe.clipShadows=be.clipShadows,xe.clippingPlanes=be.clippingPlanes,xe.clipIntersection=be.clipIntersection,xe.displacementMap=be.displacementMap,xe.displacementScale=be.displacementScale,xe.displacementBias=be.displacementBias,xe.wireframeLinewidth=be.wireframeLinewidth,xe.linewidth=be.linewidth,Ve.isPointLight===!0&&xe.isMeshDistanceMaterial===!0){const Ct=t.properties.get(xe);Ct.light=Ve}return xe}function pe(Ee,be,Ve,Se,xe){if(Ee.visible===!1)return;if(Ee.layers.test(be.layers)&&(Ee.isMesh||Ee.isLine||Ee.isPoints)&&(Ee.castShadow||Ee.receiveShadow&&xe===kf)&&(!Ee.frustumCulled||c.intersectsObject(Ee))){Ee.modelViewMatrix.multiplyMatrices(Ve.matrixWorldInverse,Ee.matrixWorld);const Et=e.update(Ee),Tt=Ee.material;if(Array.isArray(Tt)){const _t=Et.groups;for(let et=0,Lt=_t.length;et<Lt;et++){const lt=_t[et],ut=Tt[lt.materialIndex];if(ut&&ut.visible){const Xe=ce(Ee,ut,Se,xe);Ee.onBeforeShadow(t,Ee,be,Ve,Et,Xe,lt),t.renderBufferDirect(Ve,null,Et,Xe,Ee,lt),Ee.onAfterShadow(t,Ee,be,Ve,Et,Xe,lt)}}}else if(Tt.visible){const _t=ce(Ee,Tt,Se,xe);Ee.onBeforeShadow(t,Ee,be,Ve,Et,_t,null),t.renderBufferDirect(Ve,null,Et,_t,Ee,null),Ee.onAfterShadow(t,Ee,be,Ve,Et,_t,null)}}const Ct=Ee.children;for(let Et=0,Tt=Ct.length;Et<Tt;Et++)pe(Ct[Et],be,Ve,Se,xe)}function Ae(Ee){Ee.target.removeEventListener("dispose",Ae);for(const Ve in k){const Se=k[Ve],xe=Ee.target.uuid;xe in Se&&(Se[xe].dispose(),delete Se[xe])}}}const UK={[nA]:iA,[rA]:sA,[aA]:lA,[wy]:oA,[iA]:nA,[sA]:rA,[lA]:aA,[oA]:wy};function VK(t,e){function a(){let Ot=!1;const ai=new Mo;let on=null;const wn=new Mo(0,0,0,0);return{setMask:function(Kn){on!==Kn&&!Ot&&(t.colorMask(Kn,Kn,Kn,Kn),on=Kn)},setLocked:function(Kn){Ot=Kn},setClear:function(Kn,ti,Vi,Zr,ga){ga===!0&&(Kn*=Zr,ti*=Zr,Vi*=Zr),ai.set(Kn,ti,Vi,Zr),wn.equals(ai)===!1&&(t.clearColor(Kn,ti,Vi,Zr),wn.copy(ai))},reset:function(){Ot=!1,on=null,wn.set(-1,0,0,0)}}}function c(){let Ot=!1,ai=!1,on=null,wn=null,Kn=null;return{setReversed:function(ti){if(ai!==ti){const Vi=e.get("EXT_clip_control");ai?Vi.clipControlEXT(Vi.LOWER_LEFT_EXT,Vi.ZERO_TO_ONE_EXT):Vi.clipControlEXT(Vi.LOWER_LEFT_EXT,Vi.NEGATIVE_ONE_TO_ONE_EXT);const Zr=Kn;Kn=null,this.setClear(Zr)}ai=ti},getReversed:function(){return ai},setTest:function(ti){ti?$t(t.DEPTH_TEST):pn(t.DEPTH_TEST)},setMask:function(ti){on!==ti&&!Ot&&(t.depthMask(ti),on=ti)},setFunc:function(ti){if(ai&&(ti=UK[ti]),wn!==ti){switch(ti){case nA:t.depthFunc(t.NEVER);break;case iA:t.depthFunc(t.ALWAYS);break;case rA:t.depthFunc(t.LESS);break;case wy:t.depthFunc(t.LEQUAL);break;case aA:t.depthFunc(t.EQUAL);break;case oA:t.depthFunc(t.GEQUAL);break;case sA:t.depthFunc(t.GREATER);break;case lA:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}wn=ti}},setLocked:function(ti){Ot=ti},setClear:function(ti){Kn!==ti&&(ai&&(ti=1-ti),t.clearDepth(ti),Kn=ti)},reset:function(){Ot=!1,on=null,wn=null,Kn=null,ai=!1}}}function p(){let Ot=!1,ai=null,on=null,wn=null,Kn=null,ti=null,Vi=null,Zr=null,ga=null;return{setTest:function(Cr){Ot||(Cr?$t(t.STENCIL_TEST):pn(t.STENCIL_TEST))},setMask:function(Cr){ai!==Cr&&!Ot&&(t.stencilMask(Cr),ai=Cr)},setFunc:function(Cr,oo,Sr){(on!==Cr||wn!==oo||Kn!==Sr)&&(t.stencilFunc(Cr,oo,Sr),on=Cr,wn=oo,Kn=Sr)},setOp:function(Cr,oo,Sr){(ti!==Cr||Vi!==oo||Zr!==Sr)&&(t.stencilOp(Cr,oo,Sr),ti=Cr,Vi=oo,Zr=Sr)},setLocked:function(Cr){Ot=Cr},setClear:function(Cr){ga!==Cr&&(t.clearStencil(Cr),ga=Cr)},reset:function(){Ot=!1,ai=null,on=null,wn=null,Kn=null,ti=null,Vi=null,Zr=null,ga=null}}}const y=new a,M=new c,r=new p,I=new WeakMap,k=new WeakMap;let B={},U={},H=new WeakMap,Y=[],X=null,Q=!1,J=null,j=null,oe=null,ce=null,pe=null,Ae=null,Ee=null,be=new sa(0,0,0),Ve=0,Se=!1,xe=null,Fe=null,Ct=null,Et=null,Tt=null;const _t=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let et=!1,Lt=0;const lt=t.getParameter(t.VERSION);lt.indexOf("WebGL")!==-1?(Lt=parseFloat(/^WebGL (\d)/.exec(lt)[1]),et=Lt>=1):lt.indexOf("OpenGL ES")!==-1&&(Lt=parseFloat(/^OpenGL ES (\d)/.exec(lt)[1]),et=Lt>=2);let ut=null,Xe={};const kt=t.getParameter(t.SCISSOR_BOX),_n=t.getParameter(t.VIEWPORT),Xt=new Mo().fromArray(kt),It=new Mo().fromArray(_n);function ln(Ot,ai,on,wn){const Kn=new Uint8Array(4),ti=t.createTexture();t.bindTexture(Ot,ti),t.texParameteri(Ot,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(Ot,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let Vi=0;Vi<on;Vi++)Ot===t.TEXTURE_3D||Ot===t.TEXTURE_2D_ARRAY?t.texImage3D(ai,0,t.RGBA,1,1,wn,0,t.RGBA,t.UNSIGNED_BYTE,Kn):t.texImage2D(ai+Vi,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,Kn);return ti}const fn={};fn[t.TEXTURE_2D]=ln(t.TEXTURE_2D,t.TEXTURE_2D,1),fn[t.TEXTURE_CUBE_MAP]=ln(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),fn[t.TEXTURE_2D_ARRAY]=ln(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),fn[t.TEXTURE_3D]=ln(t.TEXTURE_3D,t.TEXTURE_3D,1,1),y.setClear(0,0,0,1),M.setClear(1),r.setClear(0),$t(t.DEPTH_TEST),M.setFunc(wy),di(!1),bi(y3),$t(t.CULL_FACE),ke(ym);function $t(Ot){B[Ot]!==!0&&(t.enable(Ot),B[Ot]=!0)}function pn(Ot){B[Ot]!==!1&&(t.disable(Ot),B[Ot]=!1)}function jn(Ot,ai){return U[Ot]!==ai?(t.bindFramebuffer(Ot,ai),U[Ot]=ai,Ot===t.DRAW_FRAMEBUFFER&&(U[t.FRAMEBUFFER]=ai),Ot===t.FRAMEBUFFER&&(U[t.DRAW_FRAMEBUFFER]=ai),!0):!1}function Pe(Ot,ai){let on=Y,wn=!1;if(Ot){on=H.get(ai),on===void 0&&(on=[],H.set(ai,on));const Kn=Ot.textures;if(on.length!==Kn.length||on[0]!==t.COLOR_ATTACHMENT0){for(let ti=0,Vi=Kn.length;ti<Vi;ti++)on[ti]=t.COLOR_ATTACHMENT0+ti;on.length=Kn.length,wn=!0}}else on[0]!==t.BACK&&(on[0]=t.BACK,wn=!0);wn&&t.drawBuffers(on)}function Gn(Ot){return X!==Ot?(t.useProgram(Ot),X=Ot,!0):!1}const vn={[a_]:t.FUNC_ADD,[jW]:t.FUNC_SUBTRACT,[GW]:t.FUNC_REVERSE_SUBTRACT};vn[HW]=t.MIN,vn[qW]=t.MAX;const qn={[WW]:t.ZERO,[$W]:t.ONE,[XW]:t.SRC_COLOR,[eA]:t.SRC_ALPHA,[e9]:t.SRC_ALPHA_SATURATE,[JW]:t.DST_COLOR,[YW]:t.DST_ALPHA,[ZW]:t.ONE_MINUS_SRC_COLOR,[tA]:t.ONE_MINUS_SRC_ALPHA,[QW]:t.ONE_MINUS_DST_COLOR,[KW]:t.ONE_MINUS_DST_ALPHA,[t9]:t.CONSTANT_COLOR,[n9]:t.ONE_MINUS_CONSTANT_COLOR,[i9]:t.CONSTANT_ALPHA,[r9]:t.ONE_MINUS_CONSTANT_ALPHA};function ke(Ot,ai,on,wn,Kn,ti,Vi,Zr,ga,Cr){if(Ot===ym){Q===!0&&(pn(t.BLEND),Q=!1);return}if(Q===!1&&($t(t.BLEND),Q=!0),Ot!==VW){if(Ot!==J||Cr!==Se){if((j!==a_||pe!==a_)&&(t.blendEquation(t.FUNC_ADD),j=a_,pe=a_),Cr)switch(Ot){case gy:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case x3:t.blendFunc(t.ONE,t.ONE);break;case b3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case w3:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ot);break}else switch(Ot){case gy:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case x3:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case b3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case w3:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ot);break}oe=null,ce=null,Ae=null,Ee=null,be.set(0,0,0),Ve=0,J=Ot,Se=Cr}return}Kn=Kn||ai,ti=ti||on,Vi=Vi||wn,(ai!==j||Kn!==pe)&&(t.blendEquationSeparate(vn[ai],vn[Kn]),j=ai,pe=Kn),(on!==oe||wn!==ce||ti!==Ae||Vi!==Ee)&&(t.blendFuncSeparate(qn[on],qn[wn],qn[ti],qn[Vi]),oe=on,ce=wn,Ae=ti,Ee=Vi),(Zr.equals(be)===!1||ga!==Ve)&&(t.blendColor(Zr.r,Zr.g,Zr.b,ga),be.copy(Zr),Ve=ga),J=Ot,Se=!1}function Fi(Ot,ai){Ot.side===Gf?pn(t.CULL_FACE):$t(t.CULL_FACE);let on=Ot.side===Ll;ai&&(on=!on),di(on),Ot.blending===gy&&Ot.transparent===!1?ke(ym):ke(Ot.blending,Ot.blendEquation,Ot.blendSrc,Ot.blendDst,Ot.blendEquationAlpha,Ot.blendSrcAlpha,Ot.blendDstAlpha,Ot.blendColor,Ot.blendAlpha,Ot.premultipliedAlpha),M.setFunc(Ot.depthFunc),M.setTest(Ot.depthTest),M.setMask(Ot.depthWrite),y.setMask(Ot.colorWrite);const wn=Ot.stencilWrite;r.setTest(wn),wn&&(r.setMask(Ot.stencilWriteMask),r.setFunc(Ot.stencilFunc,Ot.stencilRef,Ot.stencilFuncMask),r.setOp(Ot.stencilFail,Ot.stencilZFail,Ot.stencilZPass)),wi(Ot.polygonOffset,Ot.polygonOffsetFactor,Ot.polygonOffsetUnits),Ot.alphaToCoverage===!0?$t(t.SAMPLE_ALPHA_TO_COVERAGE):pn(t.SAMPLE_ALPHA_TO_COVERAGE)}function di(Ot){xe!==Ot&&(Ot?t.frontFace(t.CW):t.frontFace(t.CCW),xe=Ot)}function bi(Ot){Ot!==NW?($t(t.CULL_FACE),Ot!==Fe&&(Ot===y3?t.cullFace(t.BACK):Ot===BW?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):pn(t.CULL_FACE),Fe=Ot}function Mn(Ot){Ot!==Ct&&(et&&t.lineWidth(Ot),Ct=Ot)}function wi(Ot,ai,on){Ot?($t(t.POLYGON_OFFSET_FILL),(Et!==ai||Tt!==on)&&(t.polygonOffset(ai,on),Et=ai,Tt=on)):pn(t.POLYGON_OFFSET_FILL)}function ei(Ot){Ot?$t(t.SCISSOR_TEST):pn(t.SCISSOR_TEST)}function ot(Ot){Ot===void 0&&(Ot=t.TEXTURE0+_t-1),ut!==Ot&&(t.activeTexture(Ot),ut=Ot)}function Ue(Ot,ai,on){on===void 0&&(ut===null?on=t.TEXTURE0+_t-1:on=ut);let wn=Xe[on];wn===void 0&&(wn={type:void 0,texture:void 0},Xe[on]=wn),(wn.type!==Ot||wn.texture!==ai)&&(ut!==on&&(t.activeTexture(on),ut=on),t.bindTexture(Ot,ai||fn[Ot]),wn.type=Ot,wn.texture=ai)}function Yt(){const Ot=Xe[ut];Ot!==void 0&&Ot.type!==void 0&&(t.bindTexture(Ot.type,null),Ot.type=void 0,Ot.texture=void 0)}function gt(){try{t.compressedTexImage2D(...arguments)}catch(Ot){console.error("THREE.WebGLState:",Ot)}}function Kt(){try{t.compressedTexImage3D(...arguments)}catch(Ot){console.error("THREE.WebGLState:",Ot)}}function an(){try{t.texSubImage2D(...arguments)}catch(Ot){console.error("THREE.WebGLState:",Ot)}}function Xn(){try{t.texSubImage3D(...arguments)}catch(Ot){console.error("THREE.WebGLState:",Ot)}}function On(){try{t.compressedTexSubImage2D(...arguments)}catch(Ot){console.error("THREE.WebGLState:",Ot)}}function Jn(){try{t.compressedTexSubImage3D(...arguments)}catch(Ot){console.error("THREE.WebGLState:",Ot)}}function Ni(){try{t.texStorage2D(...arguments)}catch(Ot){console.error("THREE.WebGLState:",Ot)}}function Un(){try{t.texStorage3D(...arguments)}catch(Ot){console.error("THREE.WebGLState:",Ot)}}function si(){try{t.texImage2D(...arguments)}catch(Ot){console.error("THREE.WebGLState:",Ot)}}function ci(){try{t.texImage3D(...arguments)}catch(Ot){console.error("THREE.WebGLState:",Ot)}}function _i(Ot){Xt.equals(Ot)===!1&&(t.scissor(Ot.x,Ot.y,Ot.z,Ot.w),Xt.copy(Ot))}function ui(Ot){It.equals(Ot)===!1&&(t.viewport(Ot.x,Ot.y,Ot.z,Ot.w),It.copy(Ot))}function Ai(Ot,ai){let on=k.get(ai);on===void 0&&(on=new WeakMap,k.set(ai,on));let wn=on.get(Ot);wn===void 0&&(wn=t.getUniformBlockIndex(ai,Ot.name),on.set(Ot,wn))}function Si(Ot,ai){const wn=k.get(ai).get(Ot);I.get(ai)!==wn&&(t.uniformBlockBinding(ai,wn,Ot.__bindingPointIndex),I.set(ai,wn))}function Wn(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),M.setReversed(!1),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),B={},ut=null,Xe={},U={},H=new WeakMap,Y=[],X=null,Q=!1,J=null,j=null,oe=null,ce=null,pe=null,Ae=null,Ee=null,be=new sa(0,0,0),Ve=0,Se=!1,xe=null,Fe=null,Ct=null,Et=null,Tt=null,Xt.set(0,0,t.canvas.width,t.canvas.height),It.set(0,0,t.canvas.width,t.canvas.height),y.reset(),M.reset(),r.reset()}return{buffers:{color:y,depth:M,stencil:r},enable:$t,disable:pn,bindFramebuffer:jn,drawBuffers:Pe,useProgram:Gn,setBlending:ke,setMaterial:Fi,setFlipSided:di,setCullFace:bi,setLineWidth:Mn,setPolygonOffset:wi,setScissorTest:ei,activeTexture:ot,bindTexture:Ue,unbindTexture:Yt,compressedTexImage2D:gt,compressedTexImage3D:Kt,texImage2D:si,texImage3D:ci,updateUBOMapping:Ai,uniformBlockBinding:Si,texStorage2D:Ni,texStorage3D:Un,texSubImage2D:an,texSubImage3D:Xn,compressedTexSubImage2D:On,compressedTexSubImage3D:Jn,scissor:_i,viewport:ui,reset:Wn}}function jK(t,e,a,c,p,y,M){const r=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,I=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),k=new ma,B=new WeakMap;let U;const H=new WeakMap;let Y=!1;try{Y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function X(ot,Ue){return Y?new OffscreenCanvas(ot,Ue):$0("canvas")}function Q(ot,Ue,Yt){let gt=1;const Kt=ei(ot);if((Kt.width>Yt||Kt.height>Yt)&&(gt=Yt/Math.max(Kt.width,Kt.height)),gt<1)if(typeof HTMLImageElement<"u"&&ot instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ot instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ot instanceof ImageBitmap||typeof VideoFrame<"u"&&ot instanceof VideoFrame){const an=Math.floor(gt*Kt.width),Xn=Math.floor(gt*Kt.height);U===void 0&&(U=X(an,Xn));const On=Ue?X(an,Xn):U;return On.width=an,On.height=Xn,On.getContext("2d").drawImage(ot,0,0,an,Xn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Kt.width+"x"+Kt.height+") to ("+an+"x"+Xn+")."),On}else return"data"in ot&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Kt.width+"x"+Kt.height+")."),ot;return ot}function J(ot){return ot.generateMipmaps}function j(ot){t.generateMipmap(ot)}function oe(ot){return ot.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:ot.isWebGL3DRenderTarget?t.TEXTURE_3D:ot.isWebGLArrayRenderTarget||ot.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D}function ce(ot,Ue,Yt,gt,Kt=!1){if(ot!==null){if(t[ot]!==void 0)return t[ot];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ot+"'")}let an=Ue;if(Ue===t.RED&&(Yt===t.FLOAT&&(an=t.R32F),Yt===t.HALF_FLOAT&&(an=t.R16F),Yt===t.UNSIGNED_BYTE&&(an=t.R8)),Ue===t.RED_INTEGER&&(Yt===t.UNSIGNED_BYTE&&(an=t.R8UI),Yt===t.UNSIGNED_SHORT&&(an=t.R16UI),Yt===t.UNSIGNED_INT&&(an=t.R32UI),Yt===t.BYTE&&(an=t.R8I),Yt===t.SHORT&&(an=t.R16I),Yt===t.INT&&(an=t.R32I)),Ue===t.RG&&(Yt===t.FLOAT&&(an=t.RG32F),Yt===t.HALF_FLOAT&&(an=t.RG16F),Yt===t.UNSIGNED_BYTE&&(an=t.RG8)),Ue===t.RG_INTEGER&&(Yt===t.UNSIGNED_BYTE&&(an=t.RG8UI),Yt===t.UNSIGNED_SHORT&&(an=t.RG16UI),Yt===t.UNSIGNED_INT&&(an=t.RG32UI),Yt===t.BYTE&&(an=t.RG8I),Yt===t.SHORT&&(an=t.RG16I),Yt===t.INT&&(an=t.RG32I)),Ue===t.RGB_INTEGER&&(Yt===t.UNSIGNED_BYTE&&(an=t.RGB8UI),Yt===t.UNSIGNED_SHORT&&(an=t.RGB16UI),Yt===t.UNSIGNED_INT&&(an=t.RGB32UI),Yt===t.BYTE&&(an=t.RGB8I),Yt===t.SHORT&&(an=t.RGB16I),Yt===t.INT&&(an=t.RGB32I)),Ue===t.RGBA_INTEGER&&(Yt===t.UNSIGNED_BYTE&&(an=t.RGBA8UI),Yt===t.UNSIGNED_SHORT&&(an=t.RGBA16UI),Yt===t.UNSIGNED_INT&&(an=t.RGBA32UI),Yt===t.BYTE&&(an=t.RGBA8I),Yt===t.SHORT&&(an=t.RGBA16I),Yt===t.INT&&(an=t.RGBA32I)),Ue===t.RGB&&Yt===t.UNSIGNED_INT_5_9_9_9_REV&&(an=t.RGB9_E5),Ue===t.RGBA){const Xn=Kt?nE:ta.getTransfer(gt);Yt===t.FLOAT&&(an=t.RGBA32F),Yt===t.HALF_FLOAT&&(an=t.RGBA16F),Yt===t.UNSIGNED_BYTE&&(an=Xn===ba?t.SRGB8_ALPHA8:t.RGBA8),Yt===t.UNSIGNED_SHORT_4_4_4_4&&(an=t.RGBA4),Yt===t.UNSIGNED_SHORT_5_5_5_1&&(an=t.RGB5_A1)}return(an===t.R16F||an===t.R32F||an===t.RG16F||an===t.RG32F||an===t.RGBA16F||an===t.RGBA32F)&&e.get("EXT_color_buffer_float"),an}function pe(ot,Ue){let Yt;return ot?Ue===null||Ue===p_||Ue===My?Yt=t.DEPTH24_STENCIL8:Ue===Hf?Yt=t.DEPTH32F_STENCIL8:Ue===W0&&(Yt=t.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):Ue===null||Ue===p_||Ue===My?Yt=t.DEPTH_COMPONENT24:Ue===Hf?Yt=t.DEPTH_COMPONENT32F:Ue===W0&&(Yt=t.DEPTH_COMPONENT16),Yt}function Ae(ot,Ue){return J(ot)===!0||ot.isFramebufferTexture&&ot.minFilter!==uh&&ot.minFilter!==bd?Math.log2(Math.max(Ue.width,Ue.height))+1:ot.mipmaps!==void 0&&ot.mipmaps.length>0?ot.mipmaps.length:ot.isCompressedTexture&&Array.isArray(ot.image)?Ue.mipmaps.length:1}function Ee(ot){const Ue=ot.target;Ue.removeEventListener("dispose",Ee),Ve(Ue),Ue.isVideoTexture&&B.delete(Ue)}function be(ot){const Ue=ot.target;Ue.removeEventListener("dispose",be),xe(Ue)}function Ve(ot){const Ue=c.get(ot);if(Ue.__webglInit===void 0)return;const Yt=ot.source,gt=H.get(Yt);if(gt){const Kt=gt[Ue.__cacheKey];Kt.usedTimes--,Kt.usedTimes===0&&Se(ot),Object.keys(gt).length===0&&H.delete(Yt)}c.remove(ot)}function Se(ot){const Ue=c.get(ot);t.deleteTexture(Ue.__webglTexture);const Yt=ot.source,gt=H.get(Yt);delete gt[Ue.__cacheKey],M.memory.textures--}function xe(ot){const Ue=c.get(ot);if(ot.depthTexture&&(ot.depthTexture.dispose(),c.remove(ot.depthTexture)),ot.isWebGLCubeRenderTarget)for(let gt=0;gt<6;gt++){if(Array.isArray(Ue.__webglFramebuffer[gt]))for(let Kt=0;Kt<Ue.__webglFramebuffer[gt].length;Kt++)t.deleteFramebuffer(Ue.__webglFramebuffer[gt][Kt]);else t.deleteFramebuffer(Ue.__webglFramebuffer[gt]);Ue.__webglDepthbuffer&&t.deleteRenderbuffer(Ue.__webglDepthbuffer[gt])}else{if(Array.isArray(Ue.__webglFramebuffer))for(let gt=0;gt<Ue.__webglFramebuffer.length;gt++)t.deleteFramebuffer(Ue.__webglFramebuffer[gt]);else t.deleteFramebuffer(Ue.__webglFramebuffer);if(Ue.__webglDepthbuffer&&t.deleteRenderbuffer(Ue.__webglDepthbuffer),Ue.__webglMultisampledFramebuffer&&t.deleteFramebuffer(Ue.__webglMultisampledFramebuffer),Ue.__webglColorRenderbuffer)for(let gt=0;gt<Ue.__webglColorRenderbuffer.length;gt++)Ue.__webglColorRenderbuffer[gt]&&t.deleteRenderbuffer(Ue.__webglColorRenderbuffer[gt]);Ue.__webglDepthRenderbuffer&&t.deleteRenderbuffer(Ue.__webglDepthRenderbuffer)}const Yt=ot.textures;for(let gt=0,Kt=Yt.length;gt<Kt;gt++){const an=c.get(Yt[gt]);an.__webglTexture&&(t.deleteTexture(an.__webglTexture),M.memory.textures--),c.remove(Yt[gt])}c.remove(ot)}let Fe=0;function Ct(){Fe=0}function Et(){const ot=Fe;return ot>=p.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+ot+" texture units while this GPU supports only "+p.maxTextures),Fe+=1,ot}function Tt(ot){const Ue=[];return Ue.push(ot.wrapS),Ue.push(ot.wrapT),Ue.push(ot.wrapR||0),Ue.push(ot.magFilter),Ue.push(ot.minFilter),Ue.push(ot.anisotropy),Ue.push(ot.internalFormat),Ue.push(ot.format),Ue.push(ot.type),Ue.push(ot.generateMipmaps),Ue.push(ot.premultiplyAlpha),Ue.push(ot.flipY),Ue.push(ot.unpackAlignment),Ue.push(ot.colorSpace),Ue.join()}function _t(ot,Ue){const Yt=c.get(ot);if(ot.isVideoTexture&&Mn(ot),ot.isRenderTargetTexture===!1&&ot.version>0&&Yt.__version!==ot.version){const gt=ot.image;if(gt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(gt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{It(Yt,ot,Ue);return}}a.bindTexture(t.TEXTURE_2D,Yt.__webglTexture,t.TEXTURE0+Ue)}function et(ot,Ue){const Yt=c.get(ot);if(ot.version>0&&Yt.__version!==ot.version){It(Yt,ot,Ue);return}a.bindTexture(t.TEXTURE_2D_ARRAY,Yt.__webglTexture,t.TEXTURE0+Ue)}function Lt(ot,Ue){const Yt=c.get(ot);if(ot.version>0&&Yt.__version!==ot.version){It(Yt,ot,Ue);return}a.bindTexture(t.TEXTURE_3D,Yt.__webglTexture,t.TEXTURE0+Ue)}function lt(ot,Ue){const Yt=c.get(ot);if(ot.version>0&&Yt.__version!==ot.version){ln(Yt,ot,Ue);return}a.bindTexture(t.TEXTURE_CUBE_MAP,Yt.__webglTexture,t.TEXTURE0+Ue)}const ut={[hA]:t.REPEAT,[s_]:t.CLAMP_TO_EDGE,[dA]:t.MIRRORED_REPEAT},Xe={[uh]:t.NEAREST,[p9]:t.NEAREST_MIPMAP_NEAREST,[D1]:t.NEAREST_MIPMAP_LINEAR,[bd]:t.LINEAR,[kT]:t.LINEAR_MIPMAP_NEAREST,[l_]:t.LINEAR_MIPMAP_LINEAR},kt={[v9]:t.NEVER,[E9]:t.ALWAYS,[y9]:t.LESS,[bF]:t.LEQUAL,[x9]:t.EQUAL,[S9]:t.GEQUAL,[b9]:t.GREATER,[w9]:t.NOTEQUAL};function _n(ot,Ue){if(Ue.type===Hf&&e.has("OES_texture_float_linear")===!1&&(Ue.magFilter===bd||Ue.magFilter===kT||Ue.magFilter===D1||Ue.magFilter===l_||Ue.minFilter===bd||Ue.minFilter===kT||Ue.minFilter===D1||Ue.minFilter===l_)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(ot,t.TEXTURE_WRAP_S,ut[Ue.wrapS]),t.texParameteri(ot,t.TEXTURE_WRAP_T,ut[Ue.wrapT]),(ot===t.TEXTURE_3D||ot===t.TEXTURE_2D_ARRAY)&&t.texParameteri(ot,t.TEXTURE_WRAP_R,ut[Ue.wrapR]),t.texParameteri(ot,t.TEXTURE_MAG_FILTER,Xe[Ue.magFilter]),t.texParameteri(ot,t.TEXTURE_MIN_FILTER,Xe[Ue.minFilter]),Ue.compareFunction&&(t.texParameteri(ot,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(ot,t.TEXTURE_COMPARE_FUNC,kt[Ue.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(Ue.magFilter===uh||Ue.minFilter!==D1&&Ue.minFilter!==l_||Ue.type===Hf&&e.has("OES_texture_float_linear")===!1)return;if(Ue.anisotropy>1||c.get(Ue).__currentAnisotropy){const Yt=e.get("EXT_texture_filter_anisotropic");t.texParameterf(ot,Yt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Ue.anisotropy,p.getMaxAnisotropy())),c.get(Ue).__currentAnisotropy=Ue.anisotropy}}}function Xt(ot,Ue){let Yt=!1;ot.__webglInit===void 0&&(ot.__webglInit=!0,Ue.addEventListener("dispose",Ee));const gt=Ue.source;let Kt=H.get(gt);Kt===void 0&&(Kt={},H.set(gt,Kt));const an=Tt(Ue);if(an!==ot.__cacheKey){Kt[an]===void 0&&(Kt[an]={texture:t.createTexture(),usedTimes:0},M.memory.textures++,Yt=!0),Kt[an].usedTimes++;const Xn=Kt[ot.__cacheKey];Xn!==void 0&&(Kt[ot.__cacheKey].usedTimes--,Xn.usedTimes===0&&Se(Ue)),ot.__cacheKey=an,ot.__webglTexture=Kt[an].texture}return Yt}function It(ot,Ue,Yt){let gt=t.TEXTURE_2D;(Ue.isDataArrayTexture||Ue.isCompressedArrayTexture)&&(gt=t.TEXTURE_2D_ARRAY),Ue.isData3DTexture&&(gt=t.TEXTURE_3D);const Kt=Xt(ot,Ue),an=Ue.source;a.bindTexture(gt,ot.__webglTexture,t.TEXTURE0+Yt);const Xn=c.get(an);if(an.version!==Xn.__version||Kt===!0){a.activeTexture(t.TEXTURE0+Yt);const On=ta.getPrimaries(ta.workingColorSpace),Jn=Ue.colorSpace===gm?null:ta.getPrimaries(Ue.colorSpace),Ni=Ue.colorSpace===gm||On===Jn?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,Ue.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ue.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,Ue.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ni);let Un=Q(Ue.image,!1,p.maxTextureSize);Un=wi(Ue,Un);const si=y.convert(Ue.format,Ue.colorSpace),ci=y.convert(Ue.type);let _i=ce(Ue.internalFormat,si,ci,Ue.colorSpace,Ue.isVideoTexture);_n(gt,Ue);let ui;const Ai=Ue.mipmaps,Si=Ue.isVideoTexture!==!0,Wn=Xn.__version===void 0||Kt===!0,Ot=an.dataReady,ai=Ae(Ue,Un);if(Ue.isDepthTexture)_i=pe(Ue.format===Ty,Ue.type),Wn&&(Si?a.texStorage2D(t.TEXTURE_2D,1,_i,Un.width,Un.height):a.texImage2D(t.TEXTURE_2D,0,_i,Un.width,Un.height,0,si,ci,null));else if(Ue.isDataTexture)if(Ai.length>0){Si&&Wn&&a.texStorage2D(t.TEXTURE_2D,ai,_i,Ai[0].width,Ai[0].height);for(let on=0,wn=Ai.length;on<wn;on++)ui=Ai[on],Si?Ot&&a.texSubImage2D(t.TEXTURE_2D,on,0,0,ui.width,ui.height,si,ci,ui.data):a.texImage2D(t.TEXTURE_2D,on,_i,ui.width,ui.height,0,si,ci,ui.data);Ue.generateMipmaps=!1}else Si?(Wn&&a.texStorage2D(t.TEXTURE_2D,ai,_i,Un.width,Un.height),Ot&&a.texSubImage2D(t.TEXTURE_2D,0,0,0,Un.width,Un.height,si,ci,Un.data)):a.texImage2D(t.TEXTURE_2D,0,_i,Un.width,Un.height,0,si,ci,Un.data);else if(Ue.isCompressedTexture)if(Ue.isCompressedArrayTexture){Si&&Wn&&a.texStorage3D(t.TEXTURE_2D_ARRAY,ai,_i,Ai[0].width,Ai[0].height,Un.depth);for(let on=0,wn=Ai.length;on<wn;on++)if(ui=Ai[on],Ue.format!==oh)if(si!==null)if(Si){if(Ot)if(Ue.layerUpdates.size>0){const Kn=H3(ui.width,ui.height,Ue.format,Ue.type);for(const ti of Ue.layerUpdates){const Vi=ui.data.subarray(ti*Kn/ui.data.BYTES_PER_ELEMENT,(ti+1)*Kn/ui.data.BYTES_PER_ELEMENT);a.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,on,0,0,ti,ui.width,ui.height,1,si,Vi)}Ue.clearLayerUpdates()}else a.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,on,0,0,0,ui.width,ui.height,Un.depth,si,ui.data)}else a.compressedTexImage3D(t.TEXTURE_2D_ARRAY,on,_i,ui.width,ui.height,Un.depth,0,ui.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Si?Ot&&a.texSubImage3D(t.TEXTURE_2D_ARRAY,on,0,0,0,ui.width,ui.height,Un.depth,si,ci,ui.data):a.texImage3D(t.TEXTURE_2D_ARRAY,on,_i,ui.width,ui.height,Un.depth,0,si,ci,ui.data)}else{Si&&Wn&&a.texStorage2D(t.TEXTURE_2D,ai,_i,Ai[0].width,Ai[0].height);for(let on=0,wn=Ai.length;on<wn;on++)ui=Ai[on],Ue.format!==oh?si!==null?Si?Ot&&a.compressedTexSubImage2D(t.TEXTURE_2D,on,0,0,ui.width,ui.height,si,ui.data):a.compressedTexImage2D(t.TEXTURE_2D,on,_i,ui.width,ui.height,0,ui.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Si?Ot&&a.texSubImage2D(t.TEXTURE_2D,on,0,0,ui.width,ui.height,si,ci,ui.data):a.texImage2D(t.TEXTURE_2D,on,_i,ui.width,ui.height,0,si,ci,ui.data)}else if(Ue.isDataArrayTexture)if(Si){if(Wn&&a.texStorage3D(t.TEXTURE_2D_ARRAY,ai,_i,Un.width,Un.height,Un.depth),Ot)if(Ue.layerUpdates.size>0){const on=H3(Un.width,Un.height,Ue.format,Ue.type);for(const wn of Ue.layerUpdates){const Kn=Un.data.subarray(wn*on/Un.data.BYTES_PER_ELEMENT,(wn+1)*on/Un.data.BYTES_PER_ELEMENT);a.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,wn,Un.width,Un.height,1,si,ci,Kn)}Ue.clearLayerUpdates()}else a.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,Un.width,Un.height,Un.depth,si,ci,Un.data)}else a.texImage3D(t.TEXTURE_2D_ARRAY,0,_i,Un.width,Un.height,Un.depth,0,si,ci,Un.data);else if(Ue.isData3DTexture)Si?(Wn&&a.texStorage3D(t.TEXTURE_3D,ai,_i,Un.width,Un.height,Un.depth),Ot&&a.texSubImage3D(t.TEXTURE_3D,0,0,0,0,Un.width,Un.height,Un.depth,si,ci,Un.data)):a.texImage3D(t.TEXTURE_3D,0,_i,Un.width,Un.height,Un.depth,0,si,ci,Un.data);else if(Ue.isFramebufferTexture){if(Wn)if(Si)a.texStorage2D(t.TEXTURE_2D,ai,_i,Un.width,Un.height);else{let on=Un.width,wn=Un.height;for(let Kn=0;Kn<ai;Kn++)a.texImage2D(t.TEXTURE_2D,Kn,_i,on,wn,0,si,ci,null),on>>=1,wn>>=1}}else if(Ai.length>0){if(Si&&Wn){const on=ei(Ai[0]);a.texStorage2D(t.TEXTURE_2D,ai,_i,on.width,on.height)}for(let on=0,wn=Ai.length;on<wn;on++)ui=Ai[on],Si?Ot&&a.texSubImage2D(t.TEXTURE_2D,on,0,0,si,ci,ui):a.texImage2D(t.TEXTURE_2D,on,_i,si,ci,ui);Ue.generateMipmaps=!1}else if(Si){if(Wn){const on=ei(Un);a.texStorage2D(t.TEXTURE_2D,ai,_i,on.width,on.height)}Ot&&a.texSubImage2D(t.TEXTURE_2D,0,0,0,si,ci,Un)}else a.texImage2D(t.TEXTURE_2D,0,_i,si,ci,Un);J(Ue)&&j(gt),Xn.__version=an.version,Ue.onUpdate&&Ue.onUpdate(Ue)}ot.__version=Ue.version}function ln(ot,Ue,Yt){if(Ue.image.length!==6)return;const gt=Xt(ot,Ue),Kt=Ue.source;a.bindTexture(t.TEXTURE_CUBE_MAP,ot.__webglTexture,t.TEXTURE0+Yt);const an=c.get(Kt);if(Kt.version!==an.__version||gt===!0){a.activeTexture(t.TEXTURE0+Yt);const Xn=ta.getPrimaries(ta.workingColorSpace),On=Ue.colorSpace===gm?null:ta.getPrimaries(Ue.colorSpace),Jn=Ue.colorSpace===gm||Xn===On?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,Ue.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ue.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,Ue.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,Jn);const Ni=Ue.isCompressedTexture||Ue.image[0].isCompressedTexture,Un=Ue.image[0]&&Ue.image[0].isDataTexture,si=[];for(let wn=0;wn<6;wn++)!Ni&&!Un?si[wn]=Q(Ue.image[wn],!0,p.maxCubemapSize):si[wn]=Un?Ue.image[wn].image:Ue.image[wn],si[wn]=wi(Ue,si[wn]);const ci=si[0],_i=y.convert(Ue.format,Ue.colorSpace),ui=y.convert(Ue.type),Ai=ce(Ue.internalFormat,_i,ui,Ue.colorSpace),Si=Ue.isVideoTexture!==!0,Wn=an.__version===void 0||gt===!0,Ot=Kt.dataReady;let ai=Ae(Ue,ci);_n(t.TEXTURE_CUBE_MAP,Ue);let on;if(Ni){Si&&Wn&&a.texStorage2D(t.TEXTURE_CUBE_MAP,ai,Ai,ci.width,ci.height);for(let wn=0;wn<6;wn++){on=si[wn].mipmaps;for(let Kn=0;Kn<on.length;Kn++){const ti=on[Kn];Ue.format!==oh?_i!==null?Si?Ot&&a.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+wn,Kn,0,0,ti.width,ti.height,_i,ti.data):a.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+wn,Kn,Ai,ti.width,ti.height,0,ti.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Si?Ot&&a.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+wn,Kn,0,0,ti.width,ti.height,_i,ui,ti.data):a.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+wn,Kn,Ai,ti.width,ti.height,0,_i,ui,ti.data)}}}else{if(on=Ue.mipmaps,Si&&Wn){on.length>0&&ai++;const wn=ei(si[0]);a.texStorage2D(t.TEXTURE_CUBE_MAP,ai,Ai,wn.width,wn.height)}for(let wn=0;wn<6;wn++)if(Un){Si?Ot&&a.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+wn,0,0,0,si[wn].width,si[wn].height,_i,ui,si[wn].data):a.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+wn,0,Ai,si[wn].width,si[wn].height,0,_i,ui,si[wn].data);for(let Kn=0;Kn<on.length;Kn++){const Vi=on[Kn].image[wn].image;Si?Ot&&a.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+wn,Kn+1,0,0,Vi.width,Vi.height,_i,ui,Vi.data):a.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+wn,Kn+1,Ai,Vi.width,Vi.height,0,_i,ui,Vi.data)}}else{Si?Ot&&a.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+wn,0,0,0,_i,ui,si[wn]):a.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+wn,0,Ai,_i,ui,si[wn]);for(let Kn=0;Kn<on.length;Kn++){const ti=on[Kn];Si?Ot&&a.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+wn,Kn+1,0,0,_i,ui,ti.image[wn]):a.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+wn,Kn+1,Ai,_i,ui,ti.image[wn])}}}J(Ue)&&j(t.TEXTURE_CUBE_MAP),an.__version=Kt.version,Ue.onUpdate&&Ue.onUpdate(Ue)}ot.__version=Ue.version}function fn(ot,Ue,Yt,gt,Kt,an){const Xn=y.convert(Yt.format,Yt.colorSpace),On=y.convert(Yt.type),Jn=ce(Yt.internalFormat,Xn,On,Yt.colorSpace),Ni=c.get(Ue),Un=c.get(Yt);if(Un.__renderTarget=Ue,!Ni.__hasExternalTextures){const si=Math.max(1,Ue.width>>an),ci=Math.max(1,Ue.height>>an);Kt===t.TEXTURE_3D||Kt===t.TEXTURE_2D_ARRAY?a.texImage3D(Kt,an,Jn,si,ci,Ue.depth,0,Xn,On,null):a.texImage2D(Kt,an,Jn,si,ci,0,Xn,On,null)}a.bindFramebuffer(t.FRAMEBUFFER,ot),bi(Ue)?r.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,gt,Kt,Un.__webglTexture,0,di(Ue)):(Kt===t.TEXTURE_2D||Kt>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&Kt<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,gt,Kt,Un.__webglTexture,an),a.bindFramebuffer(t.FRAMEBUFFER,null)}function $t(ot,Ue,Yt){if(t.bindRenderbuffer(t.RENDERBUFFER,ot),Ue.depthBuffer){const gt=Ue.depthTexture,Kt=gt&&gt.isDepthTexture?gt.type:null,an=pe(Ue.stencilBuffer,Kt),Xn=Ue.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,On=di(Ue);bi(Ue)?r.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,On,an,Ue.width,Ue.height):Yt?t.renderbufferStorageMultisample(t.RENDERBUFFER,On,an,Ue.width,Ue.height):t.renderbufferStorage(t.RENDERBUFFER,an,Ue.width,Ue.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,Xn,t.RENDERBUFFER,ot)}else{const gt=Ue.textures;for(let Kt=0;Kt<gt.length;Kt++){const an=gt[Kt],Xn=y.convert(an.format,an.colorSpace),On=y.convert(an.type),Jn=ce(an.internalFormat,Xn,On,an.colorSpace),Ni=di(Ue);Yt&&bi(Ue)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,Ni,Jn,Ue.width,Ue.height):bi(Ue)?r.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,Ni,Jn,Ue.width,Ue.height):t.renderbufferStorage(t.RENDERBUFFER,Jn,Ue.width,Ue.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function pn(ot,Ue){if(Ue&&Ue.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(a.bindFramebuffer(t.FRAMEBUFFER,ot),!(Ue.depthTexture&&Ue.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const gt=c.get(Ue.depthTexture);gt.__renderTarget=Ue,(!gt.__webglTexture||Ue.depthTexture.image.width!==Ue.width||Ue.depthTexture.image.height!==Ue.height)&&(Ue.depthTexture.image.width=Ue.width,Ue.depthTexture.image.height=Ue.height,Ue.depthTexture.needsUpdate=!0),_t(Ue.depthTexture,0);const Kt=gt.__webglTexture,an=di(Ue);if(Ue.depthTexture.format===_y)bi(Ue)?r.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,Kt,0,an):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,Kt,0);else if(Ue.depthTexture.format===Ty)bi(Ue)?r.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,Kt,0,an):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,Kt,0);else throw new Error("Unknown depthTexture format")}function jn(ot){const Ue=c.get(ot),Yt=ot.isWebGLCubeRenderTarget===!0;if(Ue.__boundDepthTexture!==ot.depthTexture){const gt=ot.depthTexture;if(Ue.__depthDisposeCallback&&Ue.__depthDisposeCallback(),gt){const Kt=()=>{delete Ue.__boundDepthTexture,delete Ue.__depthDisposeCallback,gt.removeEventListener("dispose",Kt)};gt.addEventListener("dispose",Kt),Ue.__depthDisposeCallback=Kt}Ue.__boundDepthTexture=gt}if(ot.depthTexture&&!Ue.__autoAllocateDepthBuffer){if(Yt)throw new Error("target.depthTexture not supported in Cube render targets");pn(Ue.__webglFramebuffer,ot)}else if(Yt){Ue.__webglDepthbuffer=[];for(let gt=0;gt<6;gt++)if(a.bindFramebuffer(t.FRAMEBUFFER,Ue.__webglFramebuffer[gt]),Ue.__webglDepthbuffer[gt]===void 0)Ue.__webglDepthbuffer[gt]=t.createRenderbuffer(),$t(Ue.__webglDepthbuffer[gt],ot,!1);else{const Kt=ot.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,an=Ue.__webglDepthbuffer[gt];t.bindRenderbuffer(t.RENDERBUFFER,an),t.framebufferRenderbuffer(t.FRAMEBUFFER,Kt,t.RENDERBUFFER,an)}}else if(a.bindFramebuffer(t.FRAMEBUFFER,Ue.__webglFramebuffer),Ue.__webglDepthbuffer===void 0)Ue.__webglDepthbuffer=t.createRenderbuffer(),$t(Ue.__webglDepthbuffer,ot,!1);else{const gt=ot.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Kt=Ue.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,Kt),t.framebufferRenderbuffer(t.FRAMEBUFFER,gt,t.RENDERBUFFER,Kt)}a.bindFramebuffer(t.FRAMEBUFFER,null)}function Pe(ot,Ue,Yt){const gt=c.get(ot);Ue!==void 0&&fn(gt.__webglFramebuffer,ot,ot.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),Yt!==void 0&&jn(ot)}function Gn(ot){const Ue=ot.texture,Yt=c.get(ot),gt=c.get(Ue);ot.addEventListener("dispose",be);const Kt=ot.textures,an=ot.isWebGLCubeRenderTarget===!0,Xn=Kt.length>1;if(Xn||(gt.__webglTexture===void 0&&(gt.__webglTexture=t.createTexture()),gt.__version=Ue.version,M.memory.textures++),an){Yt.__webglFramebuffer=[];for(let On=0;On<6;On++)if(Ue.mipmaps&&Ue.mipmaps.length>0){Yt.__webglFramebuffer[On]=[];for(let Jn=0;Jn<Ue.mipmaps.length;Jn++)Yt.__webglFramebuffer[On][Jn]=t.createFramebuffer()}else Yt.__webglFramebuffer[On]=t.createFramebuffer()}else{if(Ue.mipmaps&&Ue.mipmaps.length>0){Yt.__webglFramebuffer=[];for(let On=0;On<Ue.mipmaps.length;On++)Yt.__webglFramebuffer[On]=t.createFramebuffer()}else Yt.__webglFramebuffer=t.createFramebuffer();if(Xn)for(let On=0,Jn=Kt.length;On<Jn;On++){const Ni=c.get(Kt[On]);Ni.__webglTexture===void 0&&(Ni.__webglTexture=t.createTexture(),M.memory.textures++)}if(ot.samples>0&&bi(ot)===!1){Yt.__webglMultisampledFramebuffer=t.createFramebuffer(),Yt.__webglColorRenderbuffer=[],a.bindFramebuffer(t.FRAMEBUFFER,Yt.__webglMultisampledFramebuffer);for(let On=0;On<Kt.length;On++){const Jn=Kt[On];Yt.__webglColorRenderbuffer[On]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,Yt.__webglColorRenderbuffer[On]);const Ni=y.convert(Jn.format,Jn.colorSpace),Un=y.convert(Jn.type),si=ce(Jn.internalFormat,Ni,Un,Jn.colorSpace,ot.isXRRenderTarget===!0),ci=di(ot);t.renderbufferStorageMultisample(t.RENDERBUFFER,ci,si,ot.width,ot.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+On,t.RENDERBUFFER,Yt.__webglColorRenderbuffer[On])}t.bindRenderbuffer(t.RENDERBUFFER,null),ot.depthBuffer&&(Yt.__webglDepthRenderbuffer=t.createRenderbuffer(),$t(Yt.__webglDepthRenderbuffer,ot,!0)),a.bindFramebuffer(t.FRAMEBUFFER,null)}}if(an){a.bindTexture(t.TEXTURE_CUBE_MAP,gt.__webglTexture),_n(t.TEXTURE_CUBE_MAP,Ue);for(let On=0;On<6;On++)if(Ue.mipmaps&&Ue.mipmaps.length>0)for(let Jn=0;Jn<Ue.mipmaps.length;Jn++)fn(Yt.__webglFramebuffer[On][Jn],ot,Ue,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+On,Jn);else fn(Yt.__webglFramebuffer[On],ot,Ue,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+On,0);J(Ue)&&j(t.TEXTURE_CUBE_MAP),a.unbindTexture()}else if(Xn){for(let On=0,Jn=Kt.length;On<Jn;On++){const Ni=Kt[On],Un=c.get(Ni);a.bindTexture(t.TEXTURE_2D,Un.__webglTexture),_n(t.TEXTURE_2D,Ni),fn(Yt.__webglFramebuffer,ot,Ni,t.COLOR_ATTACHMENT0+On,t.TEXTURE_2D,0),J(Ni)&&j(t.TEXTURE_2D)}a.unbindTexture()}else{let On=t.TEXTURE_2D;if((ot.isWebGL3DRenderTarget||ot.isWebGLArrayRenderTarget)&&(On=ot.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),a.bindTexture(On,gt.__webglTexture),_n(On,Ue),Ue.mipmaps&&Ue.mipmaps.length>0)for(let Jn=0;Jn<Ue.mipmaps.length;Jn++)fn(Yt.__webglFramebuffer[Jn],ot,Ue,t.COLOR_ATTACHMENT0,On,Jn);else fn(Yt.__webglFramebuffer,ot,Ue,t.COLOR_ATTACHMENT0,On,0);J(Ue)&&j(On),a.unbindTexture()}ot.depthBuffer&&jn(ot)}function vn(ot){const Ue=ot.textures;for(let Yt=0,gt=Ue.length;Yt<gt;Yt++){const Kt=Ue[Yt];if(J(Kt)){const an=oe(ot),Xn=c.get(Kt).__webglTexture;a.bindTexture(an,Xn),j(an),a.unbindTexture()}}}const qn=[],ke=[];function Fi(ot){if(ot.samples>0){if(bi(ot)===!1){const Ue=ot.textures,Yt=ot.width,gt=ot.height;let Kt=t.COLOR_BUFFER_BIT;const an=ot.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Xn=c.get(ot),On=Ue.length>1;if(On)for(let Jn=0;Jn<Ue.length;Jn++)a.bindFramebuffer(t.FRAMEBUFFER,Xn.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Jn,t.RENDERBUFFER,null),a.bindFramebuffer(t.FRAMEBUFFER,Xn.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+Jn,t.TEXTURE_2D,null,0);a.bindFramebuffer(t.READ_FRAMEBUFFER,Xn.__webglMultisampledFramebuffer),a.bindFramebuffer(t.DRAW_FRAMEBUFFER,Xn.__webglFramebuffer);for(let Jn=0;Jn<Ue.length;Jn++){if(ot.resolveDepthBuffer&&(ot.depthBuffer&&(Kt|=t.DEPTH_BUFFER_BIT),ot.stencilBuffer&&ot.resolveStencilBuffer&&(Kt|=t.STENCIL_BUFFER_BIT)),On){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,Xn.__webglColorRenderbuffer[Jn]);const Ni=c.get(Ue[Jn]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,Ni,0)}t.blitFramebuffer(0,0,Yt,gt,0,0,Yt,gt,Kt,t.NEAREST),I===!0&&(qn.length=0,ke.length=0,qn.push(t.COLOR_ATTACHMENT0+Jn),ot.depthBuffer&&ot.resolveDepthBuffer===!1&&(qn.push(an),ke.push(an),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,ke)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,qn))}if(a.bindFramebuffer(t.READ_FRAMEBUFFER,null),a.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),On)for(let Jn=0;Jn<Ue.length;Jn++){a.bindFramebuffer(t.FRAMEBUFFER,Xn.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Jn,t.RENDERBUFFER,Xn.__webglColorRenderbuffer[Jn]);const Ni=c.get(Ue[Jn]).__webglTexture;a.bindFramebuffer(t.FRAMEBUFFER,Xn.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+Jn,t.TEXTURE_2D,Ni,0)}a.bindFramebuffer(t.DRAW_FRAMEBUFFER,Xn.__webglMultisampledFramebuffer)}else if(ot.depthBuffer&&ot.resolveDepthBuffer===!1&&I){const Ue=ot.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[Ue])}}}function di(ot){return Math.min(p.maxSamples,ot.samples)}function bi(ot){const Ue=c.get(ot);return ot.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&Ue.__useRenderToTexture!==!1}function Mn(ot){const Ue=M.render.frame;B.get(ot)!==Ue&&(B.set(ot,Ue),ot.update())}function wi(ot,Ue){const Yt=ot.colorSpace,gt=ot.format,Kt=ot.type;return ot.isCompressedTexture===!0||ot.isVideoTexture===!0||Yt!==Ay&&Yt!==gm&&(ta.getTransfer(Yt)===ba?(gt!==oh||Kt!==tp)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Yt)),Ue}function ei(ot){return typeof HTMLImageElement<"u"&&ot instanceof HTMLImageElement?(k.width=ot.naturalWidth||ot.width,k.height=ot.naturalHeight||ot.height):typeof VideoFrame<"u"&&ot instanceof VideoFrame?(k.width=ot.displayWidth,k.height=ot.displayHeight):(k.width=ot.width,k.height=ot.height),k}this.allocateTextureUnit=Et,this.resetTextureUnits=Ct,this.setTexture2D=_t,this.setTexture2DArray=et,this.setTexture3D=Lt,this.setTextureCube=lt,this.rebindTextures=Pe,this.setupRenderTarget=Gn,this.updateRenderTargetMipmap=vn,this.updateMultisampleRenderTarget=Fi,this.setupDepthRenderbuffer=jn,this.setupFrameBufferTexture=fn,this.useMultisampledRTT=bi}function GK(t,e){function a(c,p=gm){let y;const M=ta.getTransfer(p);if(c===tp)return t.UNSIGNED_BYTE;if(c===CR)return t.UNSIGNED_SHORT_4_4_4_4;if(c===RR)return t.UNSIGNED_SHORT_5_5_5_1;if(c===dF)return t.UNSIGNED_INT_5_9_9_9_REV;if(c===uF)return t.BYTE;if(c===hF)return t.SHORT;if(c===W0)return t.UNSIGNED_SHORT;if(c===AR)return t.INT;if(c===p_)return t.UNSIGNED_INT;if(c===Hf)return t.FLOAT;if(c===ob)return t.HALF_FLOAT;if(c===fF)return t.ALPHA;if(c===pF)return t.RGB;if(c===oh)return t.RGBA;if(c===mF)return t.LUMINANCE;if(c===gF)return t.LUMINANCE_ALPHA;if(c===_y)return t.DEPTH_COMPONENT;if(c===Ty)return t.DEPTH_STENCIL;if(c===_F)return t.RED;if(c===IR)return t.RED_INTEGER;if(c===vF)return t.RG;if(c===DR)return t.RG_INTEGER;if(c===PR)return t.RGBA_INTEGER;if(c===ow||c===sw||c===lw||c===cw)if(M===ba)if(y=e.get("WEBGL_compressed_texture_s3tc_srgb"),y!==null){if(c===ow)return y.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(c===sw)return y.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(c===lw)return y.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(c===cw)return y.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(y=e.get("WEBGL_compressed_texture_s3tc"),y!==null){if(c===ow)return y.COMPRESSED_RGB_S3TC_DXT1_EXT;if(c===sw)return y.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(c===lw)return y.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(c===cw)return y.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(c===fA||c===pA||c===mA||c===gA)if(y=e.get("WEBGL_compressed_texture_pvrtc"),y!==null){if(c===fA)return y.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(c===pA)return y.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(c===mA)return y.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(c===gA)return y.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(c===_A||c===vA||c===yA)if(y=e.get("WEBGL_compressed_texture_etc"),y!==null){if(c===_A||c===vA)return M===ba?y.COMPRESSED_SRGB8_ETC2:y.COMPRESSED_RGB8_ETC2;if(c===yA)return M===ba?y.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:y.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(c===xA||c===bA||c===wA||c===SA||c===EA||c===MA||c===TA||c===AA||c===CA||c===RA||c===IA||c===DA||c===PA||c===LA)if(y=e.get("WEBGL_compressed_texture_astc"),y!==null){if(c===xA)return M===ba?y.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:y.COMPRESSED_RGBA_ASTC_4x4_KHR;if(c===bA)return M===ba?y.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:y.COMPRESSED_RGBA_ASTC_5x4_KHR;if(c===wA)return M===ba?y.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:y.COMPRESSED_RGBA_ASTC_5x5_KHR;if(c===SA)return M===ba?y.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:y.COMPRESSED_RGBA_ASTC_6x5_KHR;if(c===EA)return M===ba?y.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:y.COMPRESSED_RGBA_ASTC_6x6_KHR;if(c===MA)return M===ba?y.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:y.COMPRESSED_RGBA_ASTC_8x5_KHR;if(c===TA)return M===ba?y.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:y.COMPRESSED_RGBA_ASTC_8x6_KHR;if(c===AA)return M===ba?y.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:y.COMPRESSED_RGBA_ASTC_8x8_KHR;if(c===CA)return M===ba?y.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:y.COMPRESSED_RGBA_ASTC_10x5_KHR;if(c===RA)return M===ba?y.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:y.COMPRESSED_RGBA_ASTC_10x6_KHR;if(c===IA)return M===ba?y.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:y.COMPRESSED_RGBA_ASTC_10x8_KHR;if(c===DA)return M===ba?y.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:y.COMPRESSED_RGBA_ASTC_10x10_KHR;if(c===PA)return M===ba?y.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:y.COMPRESSED_RGBA_ASTC_12x10_KHR;if(c===LA)return M===ba?y.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:y.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(c===uw||c===OA||c===zA)if(y=e.get("EXT_texture_compression_bptc"),y!==null){if(c===uw)return M===ba?y.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:y.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(c===OA)return y.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(c===zA)return y.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(c===yF||c===kA||c===FA||c===NA)if(y=e.get("EXT_texture_compression_rgtc"),y!==null){if(c===uw)return y.COMPRESSED_RED_RGTC1_EXT;if(c===kA)return y.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(c===FA)return y.COMPRESSED_RED_GREEN_RGTC2_EXT;if(c===NA)return y.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return c===My?t.UNSIGNED_INT_24_8:t[c]!==void 0?t[c]:null}return{convert:a}}const HK=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,qK=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class WK{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,a,c){if(this.texture===null){const p=new ul,y=e.properties.get(p);y.__webglTexture=a.texture,(a.depthNear!==c.depthNear||a.depthFar!==c.depthFar)&&(this.depthNear=a.depthNear,this.depthFar=a.depthFar),this.texture=p}}getMesh(e){if(this.texture!==null&&this.mesh===null){const a=e.cameras[0].viewport,c=new Cm({vertexShader:HK,fragmentShader:qK,uniforms:{depthColor:{value:this.texture},depthWidth:{value:a.z},depthHeight:{value:a.w}}});this.mesh=new dc(new OE(20,20),c)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class $K extends By{constructor(e,a){super();const c=this;let p=null,y=1,M=null,r="local-floor",I=1,k=null,B=null,U=null,H=null,Y=null,X=null;const Q=new WK,J=a.getContextAttributes();let j=null,oe=null;const ce=[],pe=[],Ae=new ma;let Ee=null;const be=new hu;be.viewport=new Mo;const Ve=new hu;Ve.viewport=new Mo;const Se=[be,Ve],xe=new p$;let Fe=null,Ct=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(It){let ln=ce[It];return ln===void 0&&(ln=new r2,ce[It]=ln),ln.getTargetRaySpace()},this.getControllerGrip=function(It){let ln=ce[It];return ln===void 0&&(ln=new r2,ce[It]=ln),ln.getGripSpace()},this.getHand=function(It){let ln=ce[It];return ln===void 0&&(ln=new r2,ce[It]=ln),ln.getHandSpace()};function Et(It){const ln=pe.indexOf(It.inputSource);if(ln===-1)return;const fn=ce[ln];fn!==void 0&&(fn.update(It.inputSource,It.frame,k||M),fn.dispatchEvent({type:It.type,data:It.inputSource}))}function Tt(){p.removeEventListener("select",Et),p.removeEventListener("selectstart",Et),p.removeEventListener("selectend",Et),p.removeEventListener("squeeze",Et),p.removeEventListener("squeezestart",Et),p.removeEventListener("squeezeend",Et),p.removeEventListener("end",Tt),p.removeEventListener("inputsourceschange",_t);for(let It=0;It<ce.length;It++){const ln=pe[It];ln!==null&&(pe[It]=null,ce[It].disconnect(ln))}Fe=null,Ct=null,Q.reset(),e.setRenderTarget(j),Y=null,H=null,U=null,p=null,oe=null,Xt.stop(),c.isPresenting=!1,e.setPixelRatio(Ee),e.setSize(Ae.width,Ae.height,!1),c.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(It){y=It,c.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(It){r=It,c.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return k||M},this.setReferenceSpace=function(It){k=It},this.getBaseLayer=function(){return H!==null?H:Y},this.getBinding=function(){return U},this.getFrame=function(){return X},this.getSession=function(){return p},this.setSession=async function(It){if(p=It,p!==null){if(j=e.getRenderTarget(),p.addEventListener("select",Et),p.addEventListener("selectstart",Et),p.addEventListener("selectend",Et),p.addEventListener("squeeze",Et),p.addEventListener("squeezestart",Et),p.addEventListener("squeezeend",Et),p.addEventListener("end",Tt),p.addEventListener("inputsourceschange",_t),J.xrCompatible!==!0&&await a.makeXRCompatible(),Ee=e.getPixelRatio(),e.getSize(Ae),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let fn=null,$t=null,pn=null;J.depth&&(pn=J.stencil?a.DEPTH24_STENCIL8:a.DEPTH_COMPONENT24,fn=J.stencil?Ty:_y,$t=J.stencil?My:p_);const jn={colorFormat:a.RGBA8,depthFormat:pn,scaleFactor:y};U=new XRWebGLBinding(p,a),H=U.createProjectionLayer(jn),p.updateRenderState({layers:[H]}),e.setPixelRatio(1),e.setSize(H.textureWidth,H.textureHeight,!1),oe=new m_(H.textureWidth,H.textureHeight,{format:oh,type:tp,depthTexture:new PF(H.textureWidth,H.textureHeight,$t,void 0,void 0,void 0,void 0,void 0,void 0,fn),stencilBuffer:J.stencil,colorSpace:e.outputColorSpace,samples:J.antialias?4:0,resolveDepthBuffer:H.ignoreDepthValues===!1,resolveStencilBuffer:H.ignoreDepthValues===!1})}else{const fn={antialias:J.antialias,alpha:!0,depth:J.depth,stencil:J.stencil,framebufferScaleFactor:y};Y=new XRWebGLLayer(p,a,fn),p.updateRenderState({baseLayer:Y}),e.setPixelRatio(1),e.setSize(Y.framebufferWidth,Y.framebufferHeight,!1),oe=new m_(Y.framebufferWidth,Y.framebufferHeight,{format:oh,type:tp,colorSpace:e.outputColorSpace,stencilBuffer:J.stencil,resolveDepthBuffer:Y.ignoreDepthValues===!1,resolveStencilBuffer:Y.ignoreDepthValues===!1})}oe.isXRRenderTarget=!0,this.setFoveation(I),k=null,M=await p.requestReferenceSpace(r),Xt.setContext(p),Xt.start(),c.isPresenting=!0,c.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(p!==null)return p.environmentBlendMode},this.getDepthTexture=function(){return Q.getDepthTexture()};function _t(It){for(let ln=0;ln<It.removed.length;ln++){const fn=It.removed[ln],$t=pe.indexOf(fn);$t>=0&&(pe[$t]=null,ce[$t].disconnect(fn))}for(let ln=0;ln<It.added.length;ln++){const fn=It.added[ln];let $t=pe.indexOf(fn);if($t===-1){for(let jn=0;jn<ce.length;jn++)if(jn>=pe.length){pe.push(fn),$t=jn;break}else if(pe[jn]===null){pe[jn]=fn,$t=jn;break}if($t===-1)break}const pn=ce[$t];pn&&pn.connect(fn)}}const et=new un,Lt=new un;function lt(It,ln,fn){et.setFromMatrixPosition(ln.matrixWorld),Lt.setFromMatrixPosition(fn.matrixWorld);const $t=et.distanceTo(Lt),pn=ln.projectionMatrix.elements,jn=fn.projectionMatrix.elements,Pe=pn[14]/(pn[10]-1),Gn=pn[14]/(pn[10]+1),vn=(pn[9]+1)/pn[5],qn=(pn[9]-1)/pn[5],ke=(pn[8]-1)/pn[0],Fi=(jn[8]+1)/jn[0],di=Pe*ke,bi=Pe*Fi,Mn=$t/(-ke+Fi),wi=Mn*-ke;if(ln.matrixWorld.decompose(It.position,It.quaternion,It.scale),It.translateX(wi),It.translateZ(Mn),It.matrixWorld.compose(It.position,It.quaternion,It.scale),It.matrixWorldInverse.copy(It.matrixWorld).invert(),pn[10]===-1)It.projectionMatrix.copy(ln.projectionMatrix),It.projectionMatrixInverse.copy(ln.projectionMatrixInverse);else{const ei=Pe+Mn,ot=Gn+Mn,Ue=di-wi,Yt=bi+($t-wi),gt=vn*Gn/ot*ei,Kt=qn*Gn/ot*ei;It.projectionMatrix.makePerspective(Ue,Yt,gt,Kt,ei,ot),It.projectionMatrixInverse.copy(It.projectionMatrix).invert()}}function ut(It,ln){ln===null?It.matrixWorld.copy(It.matrix):It.matrixWorld.multiplyMatrices(ln.matrixWorld,It.matrix),It.matrixWorldInverse.copy(It.matrixWorld).invert()}this.updateCamera=function(It){if(p===null)return;let ln=It.near,fn=It.far;Q.texture!==null&&(Q.depthNear>0&&(ln=Q.depthNear),Q.depthFar>0&&(fn=Q.depthFar)),xe.near=Ve.near=be.near=ln,xe.far=Ve.far=be.far=fn,(Fe!==xe.near||Ct!==xe.far)&&(p.updateRenderState({depthNear:xe.near,depthFar:xe.far}),Fe=xe.near,Ct=xe.far),be.layers.mask=It.layers.mask|2,Ve.layers.mask=It.layers.mask|4,xe.layers.mask=be.layers.mask|Ve.layers.mask;const $t=It.parent,pn=xe.cameras;ut(xe,$t);for(let jn=0;jn<pn.length;jn++)ut(pn[jn],$t);pn.length===2?lt(xe,be,Ve):xe.projectionMatrix.copy(be.projectionMatrix),Xe(It,xe,$t)};function Xe(It,ln,fn){fn===null?It.matrix.copy(ln.matrixWorld):(It.matrix.copy(fn.matrixWorld),It.matrix.invert(),It.matrix.multiply(ln.matrixWorld)),It.matrix.decompose(It.position,It.quaternion,It.scale),It.updateMatrixWorld(!0),It.projectionMatrix.copy(ln.projectionMatrix),It.projectionMatrixInverse.copy(ln.projectionMatrixInverse),It.isPerspectiveCamera&&(It.fov=BA*2*Math.atan(1/It.projectionMatrix.elements[5]),It.zoom=1)}this.getCamera=function(){return xe},this.getFoveation=function(){if(!(H===null&&Y===null))return I},this.setFoveation=function(It){I=It,H!==null&&(H.fixedFoveation=It),Y!==null&&Y.fixedFoveation!==void 0&&(Y.fixedFoveation=It)},this.hasDepthSensing=function(){return Q.texture!==null},this.getDepthSensingMesh=function(){return Q.getMesh(xe)};let kt=null;function _n(It,ln){if(B=ln.getViewerPose(k||M),X=ln,B!==null){const fn=B.views;Y!==null&&(e.setRenderTargetFramebuffer(oe,Y.framebuffer),e.setRenderTarget(oe));let $t=!1;fn.length!==xe.cameras.length&&(xe.cameras.length=0,$t=!0);for(let Pe=0;Pe<fn.length;Pe++){const Gn=fn[Pe];let vn=null;if(Y!==null)vn=Y.getViewport(Gn);else{const ke=U.getViewSubImage(H,Gn);vn=ke.viewport,Pe===0&&(e.setRenderTargetTextures(oe,ke.colorTexture,H.ignoreDepthValues?void 0:ke.depthStencilTexture),e.setRenderTarget(oe))}let qn=Se[Pe];qn===void 0&&(qn=new hu,qn.layers.enable(Pe),qn.viewport=new Mo,Se[Pe]=qn),qn.matrix.fromArray(Gn.transform.matrix),qn.matrix.decompose(qn.position,qn.quaternion,qn.scale),qn.projectionMatrix.fromArray(Gn.projectionMatrix),qn.projectionMatrixInverse.copy(qn.projectionMatrix).invert(),qn.viewport.set(vn.x,vn.y,vn.width,vn.height),Pe===0&&(xe.matrix.copy(qn.matrix),xe.matrix.decompose(xe.position,xe.quaternion,xe.scale)),$t===!0&&xe.cameras.push(qn)}const pn=p.enabledFeatures;if(pn&&pn.includes("depth-sensing")&&p.depthUsage=="gpu-optimized"&&U){const Pe=U.getDepthInformation(fn[0]);Pe&&Pe.isValid&&Pe.texture&&Q.init(e,Pe,p.renderState)}}for(let fn=0;fn<ce.length;fn++){const $t=pe[fn],pn=ce[fn];$t!==null&&pn!==void 0&&pn.update($t,ln,k||M)}kt&&kt(It,ln),ln.detectedPlanes&&c.dispatchEvent({type:"planesdetected",data:ln}),X=null}const Xt=new LF;Xt.setAnimationLoop(_n),this.setAnimationLoop=function(It){kt=It},this.dispose=function(){}}}const Xg=new Ad,XK=new Ba;function ZK(t,e){function a(J,j){J.matrixAutoUpdate===!0&&J.updateMatrix(),j.value.copy(J.matrix)}function c(J,j){j.color.getRGB(J.fogColor.value,CF(t)),j.isFog?(J.fogNear.value=j.near,J.fogFar.value=j.far):j.isFogExp2&&(J.fogDensity.value=j.density)}function p(J,j,oe,ce,pe){j.isMeshBasicMaterial||j.isMeshLambertMaterial?y(J,j):j.isMeshToonMaterial?(y(J,j),U(J,j)):j.isMeshPhongMaterial?(y(J,j),B(J,j)):j.isMeshStandardMaterial?(y(J,j),H(J,j),j.isMeshPhysicalMaterial&&Y(J,j,pe)):j.isMeshMatcapMaterial?(y(J,j),X(J,j)):j.isMeshDepthMaterial?y(J,j):j.isMeshDistanceMaterial?(y(J,j),Q(J,j)):j.isMeshNormalMaterial?y(J,j):j.isLineBasicMaterial?(M(J,j),j.isLineDashedMaterial&&r(J,j)):j.isPointsMaterial?I(J,j,oe,ce):j.isSpriteMaterial?k(J,j):j.isShadowMaterial?(J.color.value.copy(j.color),J.opacity.value=j.opacity):j.isShaderMaterial&&(j.uniformsNeedUpdate=!1)}function y(J,j){J.opacity.value=j.opacity,j.color&&J.diffuse.value.copy(j.color),j.emissive&&J.emissive.value.copy(j.emissive).multiplyScalar(j.emissiveIntensity),j.map&&(J.map.value=j.map,a(j.map,J.mapTransform)),j.alphaMap&&(J.alphaMap.value=j.alphaMap,a(j.alphaMap,J.alphaMapTransform)),j.bumpMap&&(J.bumpMap.value=j.bumpMap,a(j.bumpMap,J.bumpMapTransform),J.bumpScale.value=j.bumpScale,j.side===Ll&&(J.bumpScale.value*=-1)),j.normalMap&&(J.normalMap.value=j.normalMap,a(j.normalMap,J.normalMapTransform),J.normalScale.value.copy(j.normalScale),j.side===Ll&&J.normalScale.value.negate()),j.displacementMap&&(J.displacementMap.value=j.displacementMap,a(j.displacementMap,J.displacementMapTransform),J.displacementScale.value=j.displacementScale,J.displacementBias.value=j.displacementBias),j.emissiveMap&&(J.emissiveMap.value=j.emissiveMap,a(j.emissiveMap,J.emissiveMapTransform)),j.specularMap&&(J.specularMap.value=j.specularMap,a(j.specularMap,J.specularMapTransform)),j.alphaTest>0&&(J.alphaTest.value=j.alphaTest);const oe=e.get(j),ce=oe.envMap,pe=oe.envMapRotation;ce&&(J.envMap.value=ce,Xg.copy(pe),Xg.x*=-1,Xg.y*=-1,Xg.z*=-1,ce.isCubeTexture&&ce.isRenderTargetTexture===!1&&(Xg.y*=-1,Xg.z*=-1),J.envMapRotation.value.setFromMatrix4(XK.makeRotationFromEuler(Xg)),J.flipEnvMap.value=ce.isCubeTexture&&ce.isRenderTargetTexture===!1?-1:1,J.reflectivity.value=j.reflectivity,J.ior.value=j.ior,J.refractionRatio.value=j.refractionRatio),j.lightMap&&(J.lightMap.value=j.lightMap,J.lightMapIntensity.value=j.lightMapIntensity,a(j.lightMap,J.lightMapTransform)),j.aoMap&&(J.aoMap.value=j.aoMap,J.aoMapIntensity.value=j.aoMapIntensity,a(j.aoMap,J.aoMapTransform))}function M(J,j){J.diffuse.value.copy(j.color),J.opacity.value=j.opacity,j.map&&(J.map.value=j.map,a(j.map,J.mapTransform))}function r(J,j){J.dashSize.value=j.dashSize,J.totalSize.value=j.dashSize+j.gapSize,J.scale.value=j.scale}function I(J,j,oe,ce){J.diffuse.value.copy(j.color),J.opacity.value=j.opacity,J.size.value=j.size*oe,J.scale.value=ce*.5,j.map&&(J.map.value=j.map,a(j.map,J.uvTransform)),j.alphaMap&&(J.alphaMap.value=j.alphaMap,a(j.alphaMap,J.alphaMapTransform)),j.alphaTest>0&&(J.alphaTest.value=j.alphaTest)}function k(J,j){J.diffuse.value.copy(j.color),J.opacity.value=j.opacity,J.rotation.value=j.rotation,j.map&&(J.map.value=j.map,a(j.map,J.mapTransform)),j.alphaMap&&(J.alphaMap.value=j.alphaMap,a(j.alphaMap,J.alphaMapTransform)),j.alphaTest>0&&(J.alphaTest.value=j.alphaTest)}function B(J,j){J.specular.value.copy(j.specular),J.shininess.value=Math.max(j.shininess,1e-4)}function U(J,j){j.gradientMap&&(J.gradientMap.value=j.gradientMap)}function H(J,j){J.metalness.value=j.metalness,j.metalnessMap&&(J.metalnessMap.value=j.metalnessMap,a(j.metalnessMap,J.metalnessMapTransform)),J.roughness.value=j.roughness,j.roughnessMap&&(J.roughnessMap.value=j.roughnessMap,a(j.roughnessMap,J.roughnessMapTransform)),j.envMap&&(J.envMapIntensity.value=j.envMapIntensity)}function Y(J,j,oe){J.ior.value=j.ior,j.sheen>0&&(J.sheenColor.value.copy(j.sheenColor).multiplyScalar(j.sheen),J.sheenRoughness.value=j.sheenRoughness,j.sheenColorMap&&(J.sheenColorMap.value=j.sheenColorMap,a(j.sheenColorMap,J.sheenColorMapTransform)),j.sheenRoughnessMap&&(J.sheenRoughnessMap.value=j.sheenRoughnessMap,a(j.sheenRoughnessMap,J.sheenRoughnessMapTransform))),j.clearcoat>0&&(J.clearcoat.value=j.clearcoat,J.clearcoatRoughness.value=j.clearcoatRoughness,j.clearcoatMap&&(J.clearcoatMap.value=j.clearcoatMap,a(j.clearcoatMap,J.clearcoatMapTransform)),j.clearcoatRoughnessMap&&(J.clearcoatRoughnessMap.value=j.clearcoatRoughnessMap,a(j.clearcoatRoughnessMap,J.clearcoatRoughnessMapTransform)),j.clearcoatNormalMap&&(J.clearcoatNormalMap.value=j.clearcoatNormalMap,a(j.clearcoatNormalMap,J.clearcoatNormalMapTransform),J.clearcoatNormalScale.value.copy(j.clearcoatNormalScale),j.side===Ll&&J.clearcoatNormalScale.value.negate())),j.dispersion>0&&(J.dispersion.value=j.dispersion),j.iridescence>0&&(J.iridescence.value=j.iridescence,J.iridescenceIOR.value=j.iridescenceIOR,J.iridescenceThicknessMinimum.value=j.iridescenceThicknessRange[0],J.iridescenceThicknessMaximum.value=j.iridescenceThicknessRange[1],j.iridescenceMap&&(J.iridescenceMap.value=j.iridescenceMap,a(j.iridescenceMap,J.iridescenceMapTransform)),j.iridescenceThicknessMap&&(J.iridescenceThicknessMap.value=j.iridescenceThicknessMap,a(j.iridescenceThicknessMap,J.iridescenceThicknessMapTransform))),j.transmission>0&&(J.transmission.value=j.transmission,J.transmissionSamplerMap.value=oe.texture,J.transmissionSamplerSize.value.set(oe.width,oe.height),j.transmissionMap&&(J.transmissionMap.value=j.transmissionMap,a(j.transmissionMap,J.transmissionMapTransform)),J.thickness.value=j.thickness,j.thicknessMap&&(J.thicknessMap.value=j.thicknessMap,a(j.thicknessMap,J.thicknessMapTransform)),J.attenuationDistance.value=j.attenuationDistance,J.attenuationColor.value.copy(j.attenuationColor)),j.anisotropy>0&&(J.anisotropyVector.value.set(j.anisotropy*Math.cos(j.anisotropyRotation),j.anisotropy*Math.sin(j.anisotropyRotation)),j.anisotropyMap&&(J.anisotropyMap.value=j.anisotropyMap,a(j.anisotropyMap,J.anisotropyMapTransform))),J.specularIntensity.value=j.specularIntensity,J.specularColor.value.copy(j.specularColor),j.specularColorMap&&(J.specularColorMap.value=j.specularColorMap,a(j.specularColorMap,J.specularColorMapTransform)),j.specularIntensityMap&&(J.specularIntensityMap.value=j.specularIntensityMap,a(j.specularIntensityMap,J.specularIntensityMapTransform))}function X(J,j){j.matcap&&(J.matcap.value=j.matcap)}function Q(J,j){const oe=e.get(j).light;J.referencePosition.value.setFromMatrixPosition(oe.matrixWorld),J.nearDistance.value=oe.shadow.camera.near,J.farDistance.value=oe.shadow.camera.far}return{refreshFogUniforms:c,refreshMaterialUniforms:p}}function YK(t,e,a,c){let p={},y={},M=[];const r=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function I(oe,ce){const pe=ce.program;c.uniformBlockBinding(oe,pe)}function k(oe,ce){let pe=p[oe.id];pe===void 0&&(X(oe),pe=B(oe),p[oe.id]=pe,oe.addEventListener("dispose",J));const Ae=ce.program;c.updateUBOMapping(oe,Ae);const Ee=e.render.frame;y[oe.id]!==Ee&&(H(oe),y[oe.id]=Ee)}function B(oe){const ce=U();oe.__bindingPointIndex=ce;const pe=t.createBuffer(),Ae=oe.__size,Ee=oe.usage;return t.bindBuffer(t.UNIFORM_BUFFER,pe),t.bufferData(t.UNIFORM_BUFFER,Ae,Ee),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,ce,pe),pe}function U(){for(let oe=0;oe<r;oe++)if(M.indexOf(oe)===-1)return M.push(oe),oe;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function H(oe){const ce=p[oe.id],pe=oe.uniforms,Ae=oe.__cache;t.bindBuffer(t.UNIFORM_BUFFER,ce);for(let Ee=0,be=pe.length;Ee<be;Ee++){const Ve=Array.isArray(pe[Ee])?pe[Ee]:[pe[Ee]];for(let Se=0,xe=Ve.length;Se<xe;Se++){const Fe=Ve[Se];if(Y(Fe,Ee,Se,Ae)===!0){const Ct=Fe.__offset,Et=Array.isArray(Fe.value)?Fe.value:[Fe.value];let Tt=0;for(let _t=0;_t<Et.length;_t++){const et=Et[_t],Lt=Q(et);typeof et=="number"||typeof et=="boolean"?(Fe.__data[0]=et,t.bufferSubData(t.UNIFORM_BUFFER,Ct+Tt,Fe.__data)):et.isMatrix3?(Fe.__data[0]=et.elements[0],Fe.__data[1]=et.elements[1],Fe.__data[2]=et.elements[2],Fe.__data[3]=0,Fe.__data[4]=et.elements[3],Fe.__data[5]=et.elements[4],Fe.__data[6]=et.elements[5],Fe.__data[7]=0,Fe.__data[8]=et.elements[6],Fe.__data[9]=et.elements[7],Fe.__data[10]=et.elements[8],Fe.__data[11]=0):(et.toArray(Fe.__data,Tt),Tt+=Lt.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,Ct,Fe.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}function Y(oe,ce,pe,Ae){const Ee=oe.value,be=ce+"_"+pe;if(Ae[be]===void 0)return typeof Ee=="number"||typeof Ee=="boolean"?Ae[be]=Ee:Ae[be]=Ee.clone(),!0;{const Ve=Ae[be];if(typeof Ee=="number"||typeof Ee=="boolean"){if(Ve!==Ee)return Ae[be]=Ee,!0}else if(Ve.equals(Ee)===!1)return Ve.copy(Ee),!0}return!1}function X(oe){const ce=oe.uniforms;let pe=0;const Ae=16;for(let be=0,Ve=ce.length;be<Ve;be++){const Se=Array.isArray(ce[be])?ce[be]:[ce[be]];for(let xe=0,Fe=Se.length;xe<Fe;xe++){const Ct=Se[xe],Et=Array.isArray(Ct.value)?Ct.value:[Ct.value];for(let Tt=0,_t=Et.length;Tt<_t;Tt++){const et=Et[Tt],Lt=Q(et),lt=pe%Ae,ut=lt%Lt.boundary,Xe=lt+ut;pe+=ut,Xe!==0&&Ae-Xe<Lt.storage&&(pe+=Ae-Xe),Ct.__data=new Float32Array(Lt.storage/Float32Array.BYTES_PER_ELEMENT),Ct.__offset=pe,pe+=Lt.storage}}}const Ee=pe%Ae;return Ee>0&&(pe+=Ae-Ee),oe.__size=pe,oe.__cache={},this}function Q(oe){const ce={boundary:0,storage:0};return typeof oe=="number"||typeof oe=="boolean"?(ce.boundary=4,ce.storage=4):oe.isVector2?(ce.boundary=8,ce.storage=8):oe.isVector3||oe.isColor?(ce.boundary=16,ce.storage=12):oe.isVector4?(ce.boundary=16,ce.storage=16):oe.isMatrix3?(ce.boundary=48,ce.storage=48):oe.isMatrix4?(ce.boundary=64,ce.storage=64):oe.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",oe),ce}function J(oe){const ce=oe.target;ce.removeEventListener("dispose",J);const pe=M.indexOf(ce.__bindingPointIndex);M.splice(pe,1),t.deleteBuffer(p[ce.id]),delete p[ce.id],delete y[ce.id]}function j(){for(const oe in p)t.deleteBuffer(p[oe]);M=[],p={},y={}}return{bind:I,update:k,dispose:j}}class KK{constructor(e={}){const{canvas:a=T9(),context:c=null,depth:p=!0,stencil:y=!1,alpha:M=!1,antialias:r=!1,premultipliedAlpha:I=!0,preserveDrawingBuffer:k=!1,powerPreference:B="default",failIfMajorPerformanceCaveat:U=!1,reverseDepthBuffer:H=!1}=e;this.isWebGLRenderer=!0;let Y;if(c!==null){if(typeof WebGLRenderingContext<"u"&&c instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");Y=c.getContextAttributes().alpha}else Y=M;const X=new Uint32Array(4),Q=new Int32Array(4);let J=null,j=null;const oe=[],ce=[];this.domElement=a,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=uu,this.toneMapping=xm,this.toneMappingExposure=1;const pe=this;let Ae=!1,Ee=0,be=0,Ve=null,Se=-1,xe=null;const Fe=new Mo,Ct=new Mo;let Et=null;const Tt=new sa(0);let _t=0,et=a.width,Lt=a.height,lt=1,ut=null,Xe=null;const kt=new Mo(0,0,et,Lt),_n=new Mo(0,0,et,Lt);let Xt=!1;const It=new DF;let ln=!1,fn=!1;this.transmissionResolutionScale=1;const $t=new Ba,pn=new Ba,jn=new un,Pe=new Mo,Gn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let vn=!1;function qn(){return Ve===null?lt:1}let ke=c;function Fi(we,Ze){return a.getContext(we,Ze)}try{const we={alpha:!0,depth:p,stencil:y,antialias:r,premultipliedAlpha:I,preserveDrawingBuffer:k,powerPreference:B,failIfMajorPerformanceCaveat:U};if("setAttribute"in a&&a.setAttribute("data-engine",`three.js r${TR}`),a.addEventListener("webglcontextlost",wn,!1),a.addEventListener("webglcontextrestored",Kn,!1),a.addEventListener("webglcontextcreationerror",ti,!1),ke===null){const Ze="webgl2";if(ke=Fi(Ze,we),ke===null)throw Fi(Ze)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(we){throw console.error("THREE.WebGLRenderer: "+we.message),we}let di,bi,Mn,wi,ei,ot,Ue,Yt,gt,Kt,an,Xn,On,Jn,Ni,Un,si,ci,_i,ui,Ai,Si,Wn,Ot;function ai(){di=new sY(ke),di.init(),Si=new GK(ke,di),bi=new eY(ke,di,e,Si),Mn=new VK(ke,di),bi.reverseDepthBuffer&&H&&Mn.buffers.depth.setReversed(!0),wi=new uY(ke),ei=new CK,ot=new jK(ke,di,Mn,ei,bi,Si,wi),Ue=new nY(pe),Yt=new oY(pe),gt=new g$(ke),Wn=new JZ(ke,gt),Kt=new lY(ke,gt,wi,Wn),an=new dY(ke,Kt,gt,wi),_i=new hY(ke,bi,ot),Un=new tY(ei),Xn=new AK(pe,Ue,Yt,di,bi,Wn,Un),On=new ZK(pe,ei),Jn=new IK,Ni=new kK(di),ci=new KZ(pe,Ue,Yt,Mn,an,Y,I),si=new BK(pe,an,bi),Ot=new YK(ke,wi,bi,Mn),ui=new QZ(ke,di,wi),Ai=new cY(ke,di,wi),wi.programs=Xn.programs,pe.capabilities=bi,pe.extensions=di,pe.properties=ei,pe.renderLists=Jn,pe.shadowMap=si,pe.state=Mn,pe.info=wi}ai();const on=new $K(pe,ke);this.xr=on,this.getContext=function(){return ke},this.getContextAttributes=function(){return ke.getContextAttributes()},this.forceContextLoss=function(){const we=di.get("WEBGL_lose_context");we&&we.loseContext()},this.forceContextRestore=function(){const we=di.get("WEBGL_lose_context");we&&we.restoreContext()},this.getPixelRatio=function(){return lt},this.setPixelRatio=function(we){we!==void 0&&(lt=we,this.setSize(et,Lt,!1))},this.getSize=function(we){return we.set(et,Lt)},this.setSize=function(we,Ze,at=!0){if(on.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}et=we,Lt=Ze,a.width=Math.floor(we*lt),a.height=Math.floor(Ze*lt),at===!0&&(a.style.width=we+"px",a.style.height=Ze+"px"),this.setViewport(0,0,we,Ze)},this.getDrawingBufferSize=function(we){return we.set(et*lt,Lt*lt).floor()},this.setDrawingBufferSize=function(we,Ze,at){et=we,Lt=Ze,lt=at,a.width=Math.floor(we*at),a.height=Math.floor(Ze*at),this.setViewport(0,0,we,Ze)},this.getCurrentViewport=function(we){return we.copy(Fe)},this.getViewport=function(we){return we.copy(kt)},this.setViewport=function(we,Ze,at,vt){we.isVector4?kt.set(we.x,we.y,we.z,we.w):kt.set(we,Ze,at,vt),Mn.viewport(Fe.copy(kt).multiplyScalar(lt).round())},this.getScissor=function(we){return we.copy(_n)},this.setScissor=function(we,Ze,at,vt){we.isVector4?_n.set(we.x,we.y,we.z,we.w):_n.set(we,Ze,at,vt),Mn.scissor(Ct.copy(_n).multiplyScalar(lt).round())},this.getScissorTest=function(){return Xt},this.setScissorTest=function(we){Mn.setScissorTest(Xt=we)},this.setOpaqueSort=function(we){ut=we},this.setTransparentSort=function(we){Xe=we},this.getClearColor=function(we){return we.copy(ci.getClearColor())},this.setClearColor=function(){ci.setClearColor(...arguments)},this.getClearAlpha=function(){return ci.getClearAlpha()},this.setClearAlpha=function(){ci.setClearAlpha(...arguments)},this.clear=function(we=!0,Ze=!0,at=!0){let vt=0;if(we){let ht=!1;if(Ve!==null){const qt=Ve.texture.format;ht=qt===PR||qt===DR||qt===IR}if(ht){const qt=Ve.texture.type,Jt=qt===tp||qt===p_||qt===W0||qt===My||qt===CR||qt===RR,En=ci.getClearColor(),Tn=ci.getClearAlpha(),Bn=En.r,$n=En.g,Vn=En.b;Jt?(X[0]=Bn,X[1]=$n,X[2]=Vn,X[3]=Tn,ke.clearBufferuiv(ke.COLOR,0,X)):(Q[0]=Bn,Q[1]=$n,Q[2]=Vn,Q[3]=Tn,ke.clearBufferiv(ke.COLOR,0,Q))}else vt|=ke.COLOR_BUFFER_BIT}Ze&&(vt|=ke.DEPTH_BUFFER_BIT),at&&(vt|=ke.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ke.clear(vt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){a.removeEventListener("webglcontextlost",wn,!1),a.removeEventListener("webglcontextrestored",Kn,!1),a.removeEventListener("webglcontextcreationerror",ti,!1),ci.dispose(),Jn.dispose(),Ni.dispose(),ei.dispose(),Ue.dispose(),Yt.dispose(),an.dispose(),Wn.dispose(),Ot.dispose(),Xn.dispose(),on.dispose(),on.removeEventListener("sessionstart",yc),on.removeEventListener("sessionend",xc),$o.stop()};function wn(we){we.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Ae=!0}function Kn(){console.log("THREE.WebGLRenderer: Context Restored."),Ae=!1;const we=wi.autoReset,Ze=si.enabled,at=si.autoUpdate,vt=si.needsUpdate,ht=si.type;ai(),wi.autoReset=we,si.enabled=Ze,si.autoUpdate=at,si.needsUpdate=vt,si.type=ht}function ti(we){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",we.statusMessage)}function Vi(we){const Ze=we.target;Ze.removeEventListener("dispose",Vi),Zr(Ze)}function Zr(we){ga(we),ei.remove(we)}function ga(we){const Ze=ei.get(we).programs;Ze!==void 0&&(Ze.forEach(function(at){Xn.releaseProgram(at)}),we.isShaderMaterial&&Xn.releaseShaderCache(we))}this.renderBufferDirect=function(we,Ze,at,vt,ht,qt){Ze===null&&(Ze=Gn);const Jt=ht.isMesh&&ht.matrixWorld.determinant()<0,En=Qe(we,Ze,at,vt,ht);Mn.setMaterial(vt,Jt);let Tn=at.index,Bn=1;if(vt.wireframe===!0){if(Tn=Kt.getWireframeAttribute(at),Tn===void 0)return;Bn=2}const $n=at.drawRange,Vn=at.attributes.position;let Pi=$n.start*Bn,or=($n.start+$n.count)*Bn;qt!==null&&(Pi=Math.max(Pi,qt.start*Bn),or=Math.min(or,(qt.start+qt.count)*Bn)),Tn!==null?(Pi=Math.max(Pi,0),or=Math.min(or,Tn.count)):Vn!=null&&(Pi=Math.max(Pi,0),or=Math.min(or,Vn.count));const er=or-Pi;if(er<0||er===1/0)return;Wn.setup(ht,vt,En,at,Tn);let qi,Ci=ui;if(Tn!==null&&(qi=gt.get(Tn),Ci=Ai,Ci.setIndex(qi)),ht.isMesh)vt.wireframe===!0?(Mn.setLineWidth(vt.wireframeLinewidth*qn()),Ci.setMode(ke.LINES)):Ci.setMode(ke.TRIANGLES);else if(ht.isLine){let Li=vt.linewidth;Li===void 0&&(Li=1),Mn.setLineWidth(Li*qn()),ht.isLineSegments?Ci.setMode(ke.LINES):ht.isLineLoop?Ci.setMode(ke.LINE_LOOP):Ci.setMode(ke.LINE_STRIP)}else ht.isPoints?Ci.setMode(ke.POINTS):ht.isSprite&&Ci.setMode(ke.TRIANGLES);if(ht.isBatchedMesh)if(ht._multiDrawInstances!==null)Zg("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Ci.renderMultiDrawInstances(ht._multiDrawStarts,ht._multiDrawCounts,ht._multiDrawCount,ht._multiDrawInstances);else if(di.get("WEBGL_multi_draw"))Ci.renderMultiDraw(ht._multiDrawStarts,ht._multiDrawCounts,ht._multiDrawCount);else{const Li=ht._multiDrawStarts,ia=ht._multiDrawCounts,gr=ht._multiDrawCount,To=Tn?gt.get(Tn).bytesPerElement:1,ws=ei.get(vt).currentProgram.getUniforms();for(let vo=0;vo<gr;vo++)ws.setValue(ke,"_gl_DrawID",vo),Ci.render(Li[vo]/To,ia[vo])}else if(ht.isInstancedMesh)Ci.renderInstances(Pi,er,ht.count);else if(at.isInstancedBufferGeometry){const Li=at._maxInstanceCount!==void 0?at._maxInstanceCount:1/0,ia=Math.min(at.instanceCount,Li);Ci.renderInstances(Pi,er,ia)}else Ci.render(Pi,er)};function Cr(we,Ze,at){we.transparent===!0&&we.side===Gf&&we.forceSinglePass===!1?(we.side=Ll,we.needsUpdate=!0,Te(we,Ze,at),we.side=Am,we.needsUpdate=!0,Te(we,Ze,at),we.side=Gf):Te(we,Ze,at)}this.compile=function(we,Ze,at=null){at===null&&(at=we),j=Ni.get(at),j.init(Ze),ce.push(j),at.traverseVisible(function(ht){ht.isLight&&ht.layers.test(Ze.layers)&&(j.pushLight(ht),ht.castShadow&&j.pushShadow(ht))}),we!==at&&we.traverseVisible(function(ht){ht.isLight&&ht.layers.test(Ze.layers)&&(j.pushLight(ht),ht.castShadow&&j.pushShadow(ht))}),j.setupLights();const vt=new Set;return we.traverse(function(ht){if(!(ht.isMesh||ht.isPoints||ht.isLine||ht.isSprite))return;const qt=ht.material;if(qt)if(Array.isArray(qt))for(let Jt=0;Jt<qt.length;Jt++){const En=qt[Jt];Cr(En,at,ht),vt.add(En)}else Cr(qt,at,ht),vt.add(qt)}),j=ce.pop(),vt},this.compileAsync=function(we,Ze,at=null){const vt=this.compile(we,Ze,at);return new Promise(ht=>{function qt(){if(vt.forEach(function(Jt){ei.get(Jt).currentProgram.isReady()&&vt.delete(Jt)}),vt.size===0){ht(we);return}setTimeout(qt,10)}di.get("KHR_parallel_shader_compile")!==null?qt():setTimeout(qt,10)})};let oo=null;function Sr(we){oo&&oo(we)}function yc(){$o.stop()}function xc(){$o.start()}const $o=new LF;$o.setAnimationLoop(Sr),typeof self<"u"&&$o.setContext(self),this.setAnimationLoop=function(we){oo=we,on.setAnimationLoop(we),we===null?$o.stop():$o.start()},on.addEventListener("sessionstart",yc),on.addEventListener("sessionend",xc),this.render=function(we,Ze){if(Ze!==void 0&&Ze.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(Ae===!0)return;if(we.matrixWorldAutoUpdate===!0&&we.updateMatrixWorld(),Ze.parent===null&&Ze.matrixWorldAutoUpdate===!0&&Ze.updateMatrixWorld(),on.enabled===!0&&on.isPresenting===!0&&(on.cameraAutoUpdate===!0&&on.updateCamera(Ze),Ze=on.getCamera()),we.isScene===!0&&we.onBeforeRender(pe,we,Ze,Ve),j=Ni.get(we,ce.length),j.init(Ze),ce.push(j),pn.multiplyMatrices(Ze.projectionMatrix,Ze.matrixWorldInverse),It.setFromProjectionMatrix(pn),fn=this.localClippingEnabled,ln=Un.init(this.clippingPlanes,fn),J=Jn.get(we,oe.length),J.init(),oe.push(J),on.enabled===!0&&on.isPresenting===!0){const qt=pe.xr.getDepthSensingMesh();qt!==null&&Sa(qt,Ze,-1/0,pe.sortObjects)}Sa(we,Ze,0,pe.sortObjects),J.finish(),pe.sortObjects===!0&&J.sort(ut,Xe),vn=on.enabled===!1||on.isPresenting===!1||on.hasDepthSensing()===!1,vn&&ci.addToRenderList(J,we),this.info.render.frame++,ln===!0&&Un.beginShadows();const at=j.state.shadowsArray;si.render(at,we,Ze),ln===!0&&Un.endShadows(),this.info.autoReset===!0&&this.info.reset();const vt=J.opaque,ht=J.transmissive;if(j.setupLights(),Ze.isArrayCamera){const qt=Ze.cameras;if(ht.length>0)for(let Jt=0,En=qt.length;Jt<En;Jt++){const Tn=qt[Jt];At(vt,ht,we,Tn)}vn&&ci.render(we);for(let Jt=0,En=qt.length;Jt<En;Jt++){const Tn=qt[Jt];Xo(J,we,Tn,Tn.viewport)}}else ht.length>0&&At(vt,ht,we,Ze),vn&&ci.render(we),Xo(J,we,Ze);Ve!==null&&be===0&&(ot.updateMultisampleRenderTarget(Ve),ot.updateRenderTargetMipmap(Ve)),we.isScene===!0&&we.onAfterRender(pe,we,Ze),Wn.resetDefaultState(),Se=-1,xe=null,ce.pop(),ce.length>0?(j=ce[ce.length-1],ln===!0&&Un.setGlobalState(pe.clippingPlanes,j.state.camera)):j=null,oe.pop(),oe.length>0?J=oe[oe.length-1]:J=null};function Sa(we,Ze,at,vt){if(we.visible===!1)return;if(we.layers.test(Ze.layers)){if(we.isGroup)at=we.renderOrder;else if(we.isLOD)we.autoUpdate===!0&&we.update(Ze);else if(we.isLight)j.pushLight(we),we.castShadow&&j.pushShadow(we);else if(we.isSprite){if(!we.frustumCulled||It.intersectsSprite(we)){vt&&Pe.setFromMatrixPosition(we.matrixWorld).applyMatrix4(pn);const Jt=an.update(we),En=we.material;En.visible&&J.push(we,Jt,En,at,Pe.z,null)}}else if((we.isMesh||we.isLine||we.isPoints)&&(!we.frustumCulled||It.intersectsObject(we))){const Jt=an.update(we),En=we.material;if(vt&&(we.boundingSphere!==void 0?(we.boundingSphere===null&&we.computeBoundingSphere(),Pe.copy(we.boundingSphere.center)):(Jt.boundingSphere===null&&Jt.computeBoundingSphere(),Pe.copy(Jt.boundingSphere.center)),Pe.applyMatrix4(we.matrixWorld).applyMatrix4(pn)),Array.isArray(En)){const Tn=Jt.groups;for(let Bn=0,$n=Tn.length;Bn<$n;Bn++){const Vn=Tn[Bn],Pi=En[Vn.materialIndex];Pi&&Pi.visible&&J.push(we,Jt,Pi,at,Pe.z,Vn)}}else En.visible&&J.push(we,Jt,En,at,Pe.z,null)}}const qt=we.children;for(let Jt=0,En=qt.length;Jt<En;Jt++)Sa(qt[Jt],Ze,at,vt)}function Xo(we,Ze,at,vt){const ht=we.opaque,qt=we.transmissive,Jt=we.transparent;j.setupLightsView(at),ln===!0&&Un.setGlobalState(pe.clippingPlanes,at),vt&&Mn.viewport(Fe.copy(vt)),ht.length>0&&he(ht,Ze,at),qt.length>0&&he(qt,Ze,at),Jt.length>0&&he(Jt,Ze,at),Mn.buffers.depth.setTest(!0),Mn.buffers.depth.setMask(!0),Mn.buffers.color.setMask(!0),Mn.setPolygonOffset(!1)}function At(we,Ze,at,vt){if((at.isScene===!0?at.overrideMaterial:null)!==null)return;j.state.transmissionRenderTarget[vt.id]===void 0&&(j.state.transmissionRenderTarget[vt.id]=new m_(1,1,{generateMipmaps:!0,type:di.has("EXT_color_buffer_half_float")||di.has("EXT_color_buffer_float")?ob:tp,minFilter:l_,samples:4,stencilBuffer:y,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ta.workingColorSpace}));const qt=j.state.transmissionRenderTarget[vt.id],Jt=vt.viewport||Fe;qt.setSize(Jt.z*pe.transmissionResolutionScale,Jt.w*pe.transmissionResolutionScale);const En=pe.getRenderTarget();pe.setRenderTarget(qt),pe.getClearColor(Tt),_t=pe.getClearAlpha(),_t<1&&pe.setClearColor(16777215,.5),pe.clear(),vn&&ci.render(at);const Tn=pe.toneMapping;pe.toneMapping=xm;const Bn=vt.viewport;if(vt.viewport!==void 0&&(vt.viewport=void 0),j.setupLightsView(vt),ln===!0&&Un.setGlobalState(pe.clippingPlanes,vt),he(we,at,vt),ot.updateMultisampleRenderTarget(qt),ot.updateRenderTargetMipmap(qt),di.has("WEBGL_multisampled_render_to_texture")===!1){let $n=!1;for(let Vn=0,Pi=Ze.length;Vn<Pi;Vn++){const or=Ze[Vn],er=or.object,qi=or.geometry,Ci=or.material,Li=or.group;if(Ci.side===Gf&&er.layers.test(vt.layers)){const ia=Ci.side;Ci.side=Ll,Ci.needsUpdate=!0,_e(er,at,vt,qi,Ci,Li),Ci.side=ia,Ci.needsUpdate=!0,$n=!0}}$n===!0&&(ot.updateMultisampleRenderTarget(qt),ot.updateRenderTargetMipmap(qt))}pe.setRenderTarget(En),pe.setClearColor(Tt,_t),Bn!==void 0&&(vt.viewport=Bn),pe.toneMapping=Tn}function he(we,Ze,at){const vt=Ze.isScene===!0?Ze.overrideMaterial:null;for(let ht=0,qt=we.length;ht<qt;ht++){const Jt=we[ht],En=Jt.object,Tn=Jt.geometry,Bn=vt===null?Jt.material:vt,$n=Jt.group;En.layers.test(at.layers)&&_e(En,Ze,at,Tn,Bn,$n)}}function _e(we,Ze,at,vt,ht,qt){we.onBeforeRender(pe,Ze,at,vt,ht,qt),we.modelViewMatrix.multiplyMatrices(at.matrixWorldInverse,we.matrixWorld),we.normalMatrix.getNormalMatrix(we.modelViewMatrix),ht.onBeforeRender(pe,Ze,at,vt,we,qt),ht.transparent===!0&&ht.side===Gf&&ht.forceSinglePass===!1?(ht.side=Ll,ht.needsUpdate=!0,pe.renderBufferDirect(at,Ze,vt,ht,we,qt),ht.side=Am,ht.needsUpdate=!0,pe.renderBufferDirect(at,Ze,vt,ht,we,qt),ht.side=Gf):pe.renderBufferDirect(at,Ze,vt,ht,we,qt),we.onAfterRender(pe,Ze,at,vt,ht,qt)}function Te(we,Ze,at){Ze.isScene!==!0&&(Ze=Gn);const vt=ei.get(we),ht=j.state.lights,qt=j.state.shadowsArray,Jt=ht.state.version,En=Xn.getParameters(we,ht.state,qt,Ze,at),Tn=Xn.getProgramCacheKey(En);let Bn=vt.programs;vt.environment=we.isMeshStandardMaterial?Ze.environment:null,vt.fog=Ze.fog,vt.envMap=(we.isMeshStandardMaterial?Yt:Ue).get(we.envMap||vt.environment),vt.envMapRotation=vt.environment!==null&&we.envMap===null?Ze.environmentRotation:we.envMapRotation,Bn===void 0&&(we.addEventListener("dispose",Vi),Bn=new Map,vt.programs=Bn);let $n=Bn.get(Tn);if($n!==void 0){if(vt.currentProgram===$n&&vt.lightsStateVersion===Jt)return We(we,En),$n}else En.uniforms=Xn.getUniforms(we),we.onBeforeCompile(En,pe),$n=Xn.acquireProgram(En,Tn),Bn.set(Tn,$n),vt.uniforms=En.uniforms;const Vn=vt.uniforms;return(!we.isShaderMaterial&&!we.isRawShaderMaterial||we.clipping===!0)&&(Vn.clippingPlanes=Un.uniform),We(we,En),vt.needsLights=nt(we),vt.lightsStateVersion=Jt,vt.needsLights&&(Vn.ambientLightColor.value=ht.state.ambient,Vn.lightProbe.value=ht.state.probe,Vn.directionalLights.value=ht.state.directional,Vn.directionalLightShadows.value=ht.state.directionalShadow,Vn.spotLights.value=ht.state.spot,Vn.spotLightShadows.value=ht.state.spotShadow,Vn.rectAreaLights.value=ht.state.rectArea,Vn.ltc_1.value=ht.state.rectAreaLTC1,Vn.ltc_2.value=ht.state.rectAreaLTC2,Vn.pointLights.value=ht.state.point,Vn.pointLightShadows.value=ht.state.pointShadow,Vn.hemisphereLights.value=ht.state.hemi,Vn.directionalShadowMap.value=ht.state.directionalShadowMap,Vn.directionalShadowMatrix.value=ht.state.directionalShadowMatrix,Vn.spotShadowMap.value=ht.state.spotShadowMap,Vn.spotLightMatrix.value=ht.state.spotLightMatrix,Vn.spotLightMap.value=ht.state.spotLightMap,Vn.pointShadowMap.value=ht.state.pointShadowMap,Vn.pointShadowMatrix.value=ht.state.pointShadowMatrix),vt.currentProgram=$n,vt.uniformsList=null,$n}function je(we){if(we.uniformsList===null){const Ze=we.currentProgram.getUniforms();we.uniformsList=hw.seqWithValue(Ze.seq,we.uniforms)}return we.uniformsList}function We(we,Ze){const at=ei.get(we);at.outputColorSpace=Ze.outputColorSpace,at.batching=Ze.batching,at.batchingColor=Ze.batchingColor,at.instancing=Ze.instancing,at.instancingColor=Ze.instancingColor,at.instancingMorph=Ze.instancingMorph,at.skinning=Ze.skinning,at.morphTargets=Ze.morphTargets,at.morphNormals=Ze.morphNormals,at.morphColors=Ze.morphColors,at.morphTargetsCount=Ze.morphTargetsCount,at.numClippingPlanes=Ze.numClippingPlanes,at.numIntersection=Ze.numClipIntersection,at.vertexAlphas=Ze.vertexAlphas,at.vertexTangents=Ze.vertexTangents,at.toneMapping=Ze.toneMapping}function Qe(we,Ze,at,vt,ht){Ze.isScene!==!0&&(Ze=Gn),ot.resetTextureUnits();const qt=Ze.fog,Jt=vt.isMeshStandardMaterial?Ze.environment:null,En=Ve===null?pe.outputColorSpace:Ve.isXRRenderTarget===!0?Ve.texture.colorSpace:Ay,Tn=(vt.isMeshStandardMaterial?Yt:Ue).get(vt.envMap||Jt),Bn=vt.vertexColors===!0&&!!at.attributes.color&&at.attributes.color.itemSize===4,$n=!!at.attributes.tangent&&(!!vt.normalMap||vt.anisotropy>0),Vn=!!at.morphAttributes.position,Pi=!!at.morphAttributes.normal,or=!!at.morphAttributes.color;let er=xm;vt.toneMapped&&(Ve===null||Ve.isXRRenderTarget===!0)&&(er=pe.toneMapping);const qi=at.morphAttributes.position||at.morphAttributes.normal||at.morphAttributes.color,Ci=qi!==void 0?qi.length:0,Li=ei.get(vt),ia=j.state.lights;if(ln===!0&&(fn===!0||we!==xe)){const Vr=we===xe&&vt.id===Se;Un.setState(vt,we,Vr)}let gr=!1;vt.version===Li.__version?(Li.needsLights&&Li.lightsStateVersion!==ia.state.version||Li.outputColorSpace!==En||ht.isBatchedMesh&&Li.batching===!1||!ht.isBatchedMesh&&Li.batching===!0||ht.isBatchedMesh&&Li.batchingColor===!0&&ht.colorTexture===null||ht.isBatchedMesh&&Li.batchingColor===!1&&ht.colorTexture!==null||ht.isInstancedMesh&&Li.instancing===!1||!ht.isInstancedMesh&&Li.instancing===!0||ht.isSkinnedMesh&&Li.skinning===!1||!ht.isSkinnedMesh&&Li.skinning===!0||ht.isInstancedMesh&&Li.instancingColor===!0&&ht.instanceColor===null||ht.isInstancedMesh&&Li.instancingColor===!1&&ht.instanceColor!==null||ht.isInstancedMesh&&Li.instancingMorph===!0&&ht.morphTexture===null||ht.isInstancedMesh&&Li.instancingMorph===!1&&ht.morphTexture!==null||Li.envMap!==Tn||vt.fog===!0&&Li.fog!==qt||Li.numClippingPlanes!==void 0&&(Li.numClippingPlanes!==Un.numPlanes||Li.numIntersection!==Un.numIntersection)||Li.vertexAlphas!==Bn||Li.vertexTangents!==$n||Li.morphTargets!==Vn||Li.morphNormals!==Pi||Li.morphColors!==or||Li.toneMapping!==er||Li.morphTargetsCount!==Ci)&&(gr=!0):(gr=!0,Li.__version=vt.version);let To=Li.currentProgram;gr===!0&&(To=Te(vt,Ze,ht));let ws=!1,vo=!1,Ua=!1;const cr=To.getUniforms(),ua=Li.uniforms;if(Mn.useProgram(To.program)&&(ws=!0,vo=!0,Ua=!0),vt.id!==Se&&(Se=vt.id,vo=!0),ws||xe!==we){Mn.buffers.depth.getReversed()?($t.copy(we.projectionMatrix),C9($t),R9($t),cr.setValue(ke,"projectionMatrix",$t)):cr.setValue(ke,"projectionMatrix",we.projectionMatrix),cr.setValue(ke,"viewMatrix",we.matrixWorldInverse);const ra=cr.map.cameraPosition;ra!==void 0&&ra.setValue(ke,jn.setFromMatrixPosition(we.matrixWorld)),bi.logarithmicDepthBuffer&&cr.setValue(ke,"logDepthBufFC",2/(Math.log(we.far+1)/Math.LN2)),(vt.isMeshPhongMaterial||vt.isMeshToonMaterial||vt.isMeshLambertMaterial||vt.isMeshBasicMaterial||vt.isMeshStandardMaterial||vt.isShaderMaterial)&&cr.setValue(ke,"isOrthographic",we.isOrthographicCamera===!0),xe!==we&&(xe=we,vo=!0,Ua=!0)}if(ht.isSkinnedMesh){cr.setOptional(ke,ht,"bindMatrix"),cr.setOptional(ke,ht,"bindMatrixInverse");const Vr=ht.skeleton;Vr&&(Vr.boneTexture===null&&Vr.computeBoneTexture(),cr.setValue(ke,"boneTexture",Vr.boneTexture,ot))}ht.isBatchedMesh&&(cr.setOptional(ke,ht,"batchingTexture"),cr.setValue(ke,"batchingTexture",ht._matricesTexture,ot),cr.setOptional(ke,ht,"batchingIdTexture"),cr.setValue(ke,"batchingIdTexture",ht._indirectTexture,ot),cr.setOptional(ke,ht,"batchingColorTexture"),ht._colorsTexture!==null&&cr.setValue(ke,"batchingColorTexture",ht._colorsTexture,ot));const _a=at.morphAttributes;if((_a.position!==void 0||_a.normal!==void 0||_a.color!==void 0)&&_i.update(ht,at,To),(vo||Li.receiveShadow!==ht.receiveShadow)&&(Li.receiveShadow=ht.receiveShadow,cr.setValue(ke,"receiveShadow",ht.receiveShadow)),vt.isMeshGouraudMaterial&&vt.envMap!==null&&(ua.envMap.value=Tn,ua.flipEnvMap.value=Tn.isCubeTexture&&Tn.isRenderTargetTexture===!1?-1:1),vt.isMeshStandardMaterial&&vt.envMap===null&&Ze.environment!==null&&(ua.envMapIntensity.value=Ze.environmentIntensity),vo&&(cr.setValue(ke,"toneMappingExposure",pe.toneMappingExposure),Li.needsLights&&ft(ua,Ua),qt&&vt.fog===!0&&On.refreshFogUniforms(ua,qt),On.refreshMaterialUniforms(ua,vt,lt,Lt,j.state.transmissionRenderTarget[we.id]),hw.upload(ke,je(Li),ua,ot)),vt.isShaderMaterial&&vt.uniformsNeedUpdate===!0&&(hw.upload(ke,je(Li),ua,ot),vt.uniformsNeedUpdate=!1),vt.isSpriteMaterial&&cr.setValue(ke,"center",ht.center),cr.setValue(ke,"modelViewMatrix",ht.modelViewMatrix),cr.setValue(ke,"normalMatrix",ht.normalMatrix),cr.setValue(ke,"modelMatrix",ht.matrixWorld),vt.isShaderMaterial||vt.isRawShaderMaterial){const Vr=vt.uniformsGroups;for(let ra=0,Oo=Vr.length;ra<Oo;ra++){const yo=Vr[ra];Ot.update(yo,To),Ot.bind(yo,To)}}return To}function ft(we,Ze){we.ambientLightColor.needsUpdate=Ze,we.lightProbe.needsUpdate=Ze,we.directionalLights.needsUpdate=Ze,we.directionalLightShadows.needsUpdate=Ze,we.pointLights.needsUpdate=Ze,we.pointLightShadows.needsUpdate=Ze,we.spotLights.needsUpdate=Ze,we.spotLightShadows.needsUpdate=Ze,we.rectAreaLights.needsUpdate=Ze,we.hemisphereLights.needsUpdate=Ze}function nt(we){return we.isMeshLambertMaterial||we.isMeshToonMaterial||we.isMeshPhongMaterial||we.isMeshStandardMaterial||we.isShadowMaterial||we.isShaderMaterial&&we.lights===!0}this.getActiveCubeFace=function(){return Ee},this.getActiveMipmapLevel=function(){return be},this.getRenderTarget=function(){return Ve},this.setRenderTargetTextures=function(we,Ze,at){ei.get(we.texture).__webglTexture=Ze,ei.get(we.depthTexture).__webglTexture=at;const vt=ei.get(we);vt.__hasExternalTextures=!0,vt.__autoAllocateDepthBuffer=at===void 0,vt.__autoAllocateDepthBuffer||di.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),vt.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(we,Ze){const at=ei.get(we);at.__webglFramebuffer=Ze,at.__useDefaultFramebuffer=Ze===void 0};const St=ke.createFramebuffer();this.setRenderTarget=function(we,Ze=0,at=0){Ve=we,Ee=Ze,be=at;let vt=!0,ht=null,qt=!1,Jt=!1;if(we){const Tn=ei.get(we);if(Tn.__useDefaultFramebuffer!==void 0)Mn.bindFramebuffer(ke.FRAMEBUFFER,null),vt=!1;else if(Tn.__webglFramebuffer===void 0)ot.setupRenderTarget(we);else if(Tn.__hasExternalTextures)ot.rebindTextures(we,ei.get(we.texture).__webglTexture,ei.get(we.depthTexture).__webglTexture);else if(we.depthBuffer){const Vn=we.depthTexture;if(Tn.__boundDepthTexture!==Vn){if(Vn!==null&&ei.has(Vn)&&(we.width!==Vn.image.width||we.height!==Vn.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");ot.setupDepthRenderbuffer(we)}}const Bn=we.texture;(Bn.isData3DTexture||Bn.isDataArrayTexture||Bn.isCompressedArrayTexture)&&(Jt=!0);const $n=ei.get(we).__webglFramebuffer;we.isWebGLCubeRenderTarget?(Array.isArray($n[Ze])?ht=$n[Ze][at]:ht=$n[Ze],qt=!0):we.samples>0&&ot.useMultisampledRTT(we)===!1?ht=ei.get(we).__webglMultisampledFramebuffer:Array.isArray($n)?ht=$n[at]:ht=$n,Fe.copy(we.viewport),Ct.copy(we.scissor),Et=we.scissorTest}else Fe.copy(kt).multiplyScalar(lt).floor(),Ct.copy(_n).multiplyScalar(lt).floor(),Et=Xt;if(at!==0&&(ht=St),Mn.bindFramebuffer(ke.FRAMEBUFFER,ht)&&vt&&Mn.drawBuffers(we,ht),Mn.viewport(Fe),Mn.scissor(Ct),Mn.setScissorTest(Et),qt){const Tn=ei.get(we.texture);ke.framebufferTexture2D(ke.FRAMEBUFFER,ke.COLOR_ATTACHMENT0,ke.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,Tn.__webglTexture,at)}else if(Jt){const Tn=ei.get(we.texture),Bn=Ze;ke.framebufferTextureLayer(ke.FRAMEBUFFER,ke.COLOR_ATTACHMENT0,Tn.__webglTexture,at,Bn)}else if(we!==null&&at!==0){const Tn=ei.get(we.texture);ke.framebufferTexture2D(ke.FRAMEBUFFER,ke.COLOR_ATTACHMENT0,ke.TEXTURE_2D,Tn.__webglTexture,at)}Se=-1},this.readRenderTargetPixels=function(we,Ze,at,vt,ht,qt,Jt){if(!(we&&we.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let En=ei.get(we).__webglFramebuffer;if(we.isWebGLCubeRenderTarget&&Jt!==void 0&&(En=En[Jt]),En){Mn.bindFramebuffer(ke.FRAMEBUFFER,En);try{const Tn=we.texture,Bn=Tn.format,$n=Tn.type;if(!bi.textureFormatReadable(Bn)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!bi.textureTypeReadable($n)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ze>=0&&Ze<=we.width-vt&&at>=0&&at<=we.height-ht&&ke.readPixels(Ze,at,vt,ht,Si.convert(Bn),Si.convert($n),qt)}finally{const Tn=Ve!==null?ei.get(Ve).__webglFramebuffer:null;Mn.bindFramebuffer(ke.FRAMEBUFFER,Tn)}}},this.readRenderTargetPixelsAsync=async function(we,Ze,at,vt,ht,qt,Jt){if(!(we&&we.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let En=ei.get(we).__webglFramebuffer;if(we.isWebGLCubeRenderTarget&&Jt!==void 0&&(En=En[Jt]),En){const Tn=we.texture,Bn=Tn.format,$n=Tn.type;if(!bi.textureFormatReadable(Bn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!bi.textureTypeReadable($n))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(Ze>=0&&Ze<=we.width-vt&&at>=0&&at<=we.height-ht){Mn.bindFramebuffer(ke.FRAMEBUFFER,En);const Vn=ke.createBuffer();ke.bindBuffer(ke.PIXEL_PACK_BUFFER,Vn),ke.bufferData(ke.PIXEL_PACK_BUFFER,qt.byteLength,ke.STREAM_READ),ke.readPixels(Ze,at,vt,ht,Si.convert(Bn),Si.convert($n),0);const Pi=Ve!==null?ei.get(Ve).__webglFramebuffer:null;Mn.bindFramebuffer(ke.FRAMEBUFFER,Pi);const or=ke.fenceSync(ke.SYNC_GPU_COMMANDS_COMPLETE,0);return ke.flush(),await A9(ke,or,4),ke.bindBuffer(ke.PIXEL_PACK_BUFFER,Vn),ke.getBufferSubData(ke.PIXEL_PACK_BUFFER,0,qt),ke.deleteBuffer(Vn),ke.deleteSync(or),qt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(we,Ze=null,at=0){we.isTexture!==!0&&(Zg("WebGLRenderer: copyFramebufferToTexture function signature has changed."),Ze=arguments[0]||null,we=arguments[1]);const vt=Math.pow(2,-at),ht=Math.floor(we.image.width*vt),qt=Math.floor(we.image.height*vt),Jt=Ze!==null?Ze.x:0,En=Ze!==null?Ze.y:0;ot.setTexture2D(we,0),ke.copyTexSubImage2D(ke.TEXTURE_2D,at,0,0,Jt,En,ht,qt),Mn.unbindTexture()};const wt=ke.createFramebuffer(),Mt=ke.createFramebuffer();this.copyTextureToTexture=function(we,Ze,at=null,vt=null,ht=0,qt=null){we.isTexture!==!0&&(Zg("WebGLRenderer: copyTextureToTexture function signature has changed."),vt=arguments[0]||null,we=arguments[1],Ze=arguments[2],qt=arguments[3]||0,at=null),qt===null&&(ht!==0?(Zg("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),qt=ht,ht=0):qt=0);let Jt,En,Tn,Bn,$n,Vn,Pi,or,er;const qi=we.isCompressedTexture?we.mipmaps[qt]:we.image;if(at!==null)Jt=at.max.x-at.min.x,En=at.max.y-at.min.y,Tn=at.isBox3?at.max.z-at.min.z:1,Bn=at.min.x,$n=at.min.y,Vn=at.isBox3?at.min.z:0;else{const _a=Math.pow(2,-ht);Jt=Math.floor(qi.width*_a),En=Math.floor(qi.height*_a),we.isDataArrayTexture?Tn=qi.depth:we.isData3DTexture?Tn=Math.floor(qi.depth*_a):Tn=1,Bn=0,$n=0,Vn=0}vt!==null?(Pi=vt.x,or=vt.y,er=vt.z):(Pi=0,or=0,er=0);const Ci=Si.convert(Ze.format),Li=Si.convert(Ze.type);let ia;Ze.isData3DTexture?(ot.setTexture3D(Ze,0),ia=ke.TEXTURE_3D):Ze.isDataArrayTexture||Ze.isCompressedArrayTexture?(ot.setTexture2DArray(Ze,0),ia=ke.TEXTURE_2D_ARRAY):(ot.setTexture2D(Ze,0),ia=ke.TEXTURE_2D),ke.pixelStorei(ke.UNPACK_FLIP_Y_WEBGL,Ze.flipY),ke.pixelStorei(ke.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ze.premultiplyAlpha),ke.pixelStorei(ke.UNPACK_ALIGNMENT,Ze.unpackAlignment);const gr=ke.getParameter(ke.UNPACK_ROW_LENGTH),To=ke.getParameter(ke.UNPACK_IMAGE_HEIGHT),ws=ke.getParameter(ke.UNPACK_SKIP_PIXELS),vo=ke.getParameter(ke.UNPACK_SKIP_ROWS),Ua=ke.getParameter(ke.UNPACK_SKIP_IMAGES);ke.pixelStorei(ke.UNPACK_ROW_LENGTH,qi.width),ke.pixelStorei(ke.UNPACK_IMAGE_HEIGHT,qi.height),ke.pixelStorei(ke.UNPACK_SKIP_PIXELS,Bn),ke.pixelStorei(ke.UNPACK_SKIP_ROWS,$n),ke.pixelStorei(ke.UNPACK_SKIP_IMAGES,Vn);const cr=we.isDataArrayTexture||we.isData3DTexture,ua=Ze.isDataArrayTexture||Ze.isData3DTexture;if(we.isDepthTexture){const _a=ei.get(we),Vr=ei.get(Ze),ra=ei.get(_a.__renderTarget),Oo=ei.get(Vr.__renderTarget);Mn.bindFramebuffer(ke.READ_FRAMEBUFFER,ra.__webglFramebuffer),Mn.bindFramebuffer(ke.DRAW_FRAMEBUFFER,Oo.__webglFramebuffer);for(let yo=0;yo<Tn;yo++)cr&&(ke.framebufferTextureLayer(ke.READ_FRAMEBUFFER,ke.COLOR_ATTACHMENT0,ei.get(we).__webglTexture,ht,Vn+yo),ke.framebufferTextureLayer(ke.DRAW_FRAMEBUFFER,ke.COLOR_ATTACHMENT0,ei.get(Ze).__webglTexture,qt,er+yo)),ke.blitFramebuffer(Bn,$n,Jt,En,Pi,or,Jt,En,ke.DEPTH_BUFFER_BIT,ke.NEAREST);Mn.bindFramebuffer(ke.READ_FRAMEBUFFER,null),Mn.bindFramebuffer(ke.DRAW_FRAMEBUFFER,null)}else if(ht!==0||we.isRenderTargetTexture||ei.has(we)){const _a=ei.get(we),Vr=ei.get(Ze);Mn.bindFramebuffer(ke.READ_FRAMEBUFFER,wt),Mn.bindFramebuffer(ke.DRAW_FRAMEBUFFER,Mt);for(let ra=0;ra<Tn;ra++)cr?ke.framebufferTextureLayer(ke.READ_FRAMEBUFFER,ke.COLOR_ATTACHMENT0,_a.__webglTexture,ht,Vn+ra):ke.framebufferTexture2D(ke.READ_FRAMEBUFFER,ke.COLOR_ATTACHMENT0,ke.TEXTURE_2D,_a.__webglTexture,ht),ua?ke.framebufferTextureLayer(ke.DRAW_FRAMEBUFFER,ke.COLOR_ATTACHMENT0,Vr.__webglTexture,qt,er+ra):ke.framebufferTexture2D(ke.DRAW_FRAMEBUFFER,ke.COLOR_ATTACHMENT0,ke.TEXTURE_2D,Vr.__webglTexture,qt),ht!==0?ke.blitFramebuffer(Bn,$n,Jt,En,Pi,or,Jt,En,ke.COLOR_BUFFER_BIT,ke.NEAREST):ua?ke.copyTexSubImage3D(ia,qt,Pi,or,er+ra,Bn,$n,Jt,En):ke.copyTexSubImage2D(ia,qt,Pi,or,Bn,$n,Jt,En);Mn.bindFramebuffer(ke.READ_FRAMEBUFFER,null),Mn.bindFramebuffer(ke.DRAW_FRAMEBUFFER,null)}else ua?we.isDataTexture||we.isData3DTexture?ke.texSubImage3D(ia,qt,Pi,or,er,Jt,En,Tn,Ci,Li,qi.data):Ze.isCompressedArrayTexture?ke.compressedTexSubImage3D(ia,qt,Pi,or,er,Jt,En,Tn,Ci,qi.data):ke.texSubImage3D(ia,qt,Pi,or,er,Jt,En,Tn,Ci,Li,qi):we.isDataTexture?ke.texSubImage2D(ke.TEXTURE_2D,qt,Pi,or,Jt,En,Ci,Li,qi.data):we.isCompressedTexture?ke.compressedTexSubImage2D(ke.TEXTURE_2D,qt,Pi,or,qi.width,qi.height,Ci,qi.data):ke.texSubImage2D(ke.TEXTURE_2D,qt,Pi,or,Jt,En,Ci,Li,qi);ke.pixelStorei(ke.UNPACK_ROW_LENGTH,gr),ke.pixelStorei(ke.UNPACK_IMAGE_HEIGHT,To),ke.pixelStorei(ke.UNPACK_SKIP_PIXELS,ws),ke.pixelStorei(ke.UNPACK_SKIP_ROWS,vo),ke.pixelStorei(ke.UNPACK_SKIP_IMAGES,Ua),qt===0&&Ze.generateMipmaps&&ke.generateMipmap(ia),Mn.unbindTexture()},this.copyTextureToTexture3D=function(we,Ze,at=null,vt=null,ht=0){return we.isTexture!==!0&&(Zg("WebGLRenderer: copyTextureToTexture3D function signature has changed."),at=arguments[0]||null,vt=arguments[1]||null,we=arguments[2],Ze=arguments[3],ht=arguments[4]||0),Zg('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(we,Ze,at,vt,ht)},this.initRenderTarget=function(we){ei.get(we).__webglFramebuffer===void 0&&ot.setupRenderTarget(we)},this.initTexture=function(we){we.isCubeTexture?ot.setTextureCube(we,0):we.isData3DTexture?ot.setTexture3D(we,0):we.isDataArrayTexture||we.isCompressedArrayTexture?ot.setTexture2DArray(we,0):ot.setTexture2D(we,0),Mn.unbindTexture()},this.resetState=function(){Ee=0,be=0,Ve=null,Mn.reset(),Wn.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return qf}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const a=this.getContext();a.drawingBufferColorspace=ta._getDrawingBufferColorSpace(e),a.unpackColorSpace=ta._getUnpackColorSpace()}}var dw={exports:{}},JK=dw.exports,mL;function QK(){return mL||(mL=1,function(t,e){(function(a,c){t.exports=c()})(JK,function(){var a,c,p;function y(r,I){if(!a)a=I;else if(!c)c=I;else{var k="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+a+")(sharedChunk); ("+c+")(sharedChunk); self.onerror = null;",B={};a(B),p=I(B),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(p.workerUrl=window.URL.createObjectURL(new Blob([k],{type:"text/javascript"})))}}y(["exports"],function(r){function I(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var k,B={},U={};function H(){if(k)return U;k=1,Object.defineProperty(U,"__esModule",{value:!0}),U.setMatrixArrayType=function(g){U.ARRAY_TYPE=n=g},U.toRadian=function(g){return g*u},U.equals=function(g,d){return Math.abs(g-d)<=l*Math.max(1,Math.abs(g),Math.abs(d))},U.RANDOM=U.ARRAY_TYPE=U.EPSILON=void 0;var l=1e-6;U.EPSILON=l;var n=typeof Float32Array<"u"?Float32Array:Array;U.ARRAY_TYPE=n;var o=Math.random;U.RANDOM=o;var u=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var g=0,d=arguments.length;d--;)g+=arguments[d]*arguments[d];return Math.sqrt(g)}),U}var Y,X={};function Q(){if(Y)return X;function l(d){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},l(d)}Y=1,Object.defineProperty(X,"__esModule",{value:!0}),X.create=function(){var d=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d},X.clone=function(d){var v=new n.ARRAY_TYPE(4);return v[0]=d[0],v[1]=d[1],v[2]=d[2],v[3]=d[3],v},X.copy=function(d,v){return d[0]=v[0],d[1]=v[1],d[2]=v[2],d[3]=v[3],d},X.identity=function(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=1,d},X.fromValues=function(d,v,E,C){var z=new n.ARRAY_TYPE(4);return z[0]=d,z[1]=v,z[2]=E,z[3]=C,z},X.set=function(d,v,E,C,z){return d[0]=v,d[1]=E,d[2]=C,d[3]=z,d},X.transpose=function(d,v){if(d===v){var E=v[1];d[1]=v[2],d[2]=E}else d[0]=v[0],d[1]=v[2],d[2]=v[1],d[3]=v[3];return d},X.invert=function(d,v){var E=v[0],C=v[1],z=v[2],w=v[3],R=E*w-z*C;return R?(d[0]=w*(R=1/R),d[1]=-C*R,d[2]=-z*R,d[3]=E*R,d):null},X.adjoint=function(d,v){var E=v[0];return d[0]=v[3],d[1]=-v[1],d[2]=-v[2],d[3]=E,d},X.determinant=function(d){return d[0]*d[3]-d[2]*d[1]},X.multiply=u,X.rotate=function(d,v,E){var C=v[0],z=v[1],w=v[2],R=v[3],L=Math.sin(E),A=Math.cos(E);return d[0]=C*A+w*L,d[1]=z*A+R*L,d[2]=C*-L+w*A,d[3]=z*-L+R*A,d},X.scale=function(d,v,E){var C=v[1],z=v[2],w=v[3],R=E[0],L=E[1];return d[0]=v[0]*R,d[1]=C*R,d[2]=z*L,d[3]=w*L,d},X.fromRotation=function(d,v){var E=Math.sin(v),C=Math.cos(v);return d[0]=C,d[1]=E,d[2]=-E,d[3]=C,d},X.fromScaling=function(d,v){return d[0]=v[0],d[1]=0,d[2]=0,d[3]=v[1],d},X.str=function(d){return"mat2("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+")"},X.frob=function(d){return Math.hypot(d[0],d[1],d[2],d[3])},X.LDU=function(d,v,E,C){return d[2]=C[2]/C[0],E[0]=C[0],E[1]=C[1],E[3]=C[3]-d[2]*E[1],[d,v,E]},X.add=function(d,v,E){return d[0]=v[0]+E[0],d[1]=v[1]+E[1],d[2]=v[2]+E[2],d[3]=v[3]+E[3],d},X.subtract=g,X.exactEquals=function(d,v){return d[0]===v[0]&&d[1]===v[1]&&d[2]===v[2]&&d[3]===v[3]},X.equals=function(d,v){var E=d[0],C=d[1],z=d[2],w=d[3],R=v[0],L=v[1],A=v[2],D=v[3];return Math.abs(E-R)<=n.EPSILON*Math.max(1,Math.abs(E),Math.abs(R))&&Math.abs(C-L)<=n.EPSILON*Math.max(1,Math.abs(C),Math.abs(L))&&Math.abs(z-A)<=n.EPSILON*Math.max(1,Math.abs(z),Math.abs(A))&&Math.abs(w-D)<=n.EPSILON*Math.max(1,Math.abs(w),Math.abs(D))},X.multiplyScalar=function(d,v,E){return d[0]=v[0]*E,d[1]=v[1]*E,d[2]=v[2]*E,d[3]=v[3]*E,d},X.multiplyScalarAndAdd=function(d,v,E,C){return d[0]=v[0]+E[0]*C,d[1]=v[1]+E[1]*C,d[2]=v[2]+E[2]*C,d[3]=v[3]+E[3]*C,d},X.sub=X.mul=void 0;var n=function(d,v){if(d&&d.__esModule)return d;if(d===null||l(d)!=="object"&&typeof d!="function")return{default:d};var E=o(void 0);if(E&&E.has(d))return E.get(d);var C={},z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var w in d)if(w!=="default"&&Object.prototype.hasOwnProperty.call(d,w)){var R=z?Object.getOwnPropertyDescriptor(d,w):null;R&&(R.get||R.set)?Object.defineProperty(C,w,R):C[w]=d[w]}return C.default=d,E&&E.set(d,C),C}(H());function o(d){if(typeof WeakMap!="function")return null;var v=new WeakMap,E=new WeakMap;return(o=function(C){return C?E:v})(d)}function u(d,v,E){var C=v[0],z=v[1],w=v[2],R=v[3],L=E[0],A=E[1],D=E[2],F=E[3];return d[0]=C*L+w*A,d[1]=z*L+R*A,d[2]=C*D+w*F,d[3]=z*D+R*F,d}function g(d,v,E){return d[0]=v[0]-E[0],d[1]=v[1]-E[1],d[2]=v[2]-E[2],d[3]=v[3]-E[3],d}return X.mul=u,X.sub=g,X}var J,j={};function oe(){if(J)return j;function l(d){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},l(d)}J=1,Object.defineProperty(j,"__esModule",{value:!0}),j.create=function(){var d=new n.ARRAY_TYPE(6);return n.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0,d[4]=0,d[5]=0),d[0]=1,d[3]=1,d},j.clone=function(d){var v=new n.ARRAY_TYPE(6);return v[0]=d[0],v[1]=d[1],v[2]=d[2],v[3]=d[3],v[4]=d[4],v[5]=d[5],v},j.copy=function(d,v){return d[0]=v[0],d[1]=v[1],d[2]=v[2],d[3]=v[3],d[4]=v[4],d[5]=v[5],d},j.identity=function(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=1,d[4]=0,d[5]=0,d},j.fromValues=function(d,v,E,C,z,w){var R=new n.ARRAY_TYPE(6);return R[0]=d,R[1]=v,R[2]=E,R[3]=C,R[4]=z,R[5]=w,R},j.set=function(d,v,E,C,z,w,R){return d[0]=v,d[1]=E,d[2]=C,d[3]=z,d[4]=w,d[5]=R,d},j.invert=function(d,v){var E=v[0],C=v[1],z=v[2],w=v[3],R=v[4],L=v[5],A=E*w-C*z;return A?(d[0]=w*(A=1/A),d[1]=-C*A,d[2]=-z*A,d[3]=E*A,d[4]=(z*L-w*R)*A,d[5]=(C*R-E*L)*A,d):null},j.determinant=function(d){return d[0]*d[3]-d[1]*d[2]},j.multiply=u,j.rotate=function(d,v,E){var C=v[0],z=v[1],w=v[2],R=v[3],L=v[4],A=v[5],D=Math.sin(E),F=Math.cos(E);return d[0]=C*F+w*D,d[1]=z*F+R*D,d[2]=C*-D+w*F,d[3]=z*-D+R*F,d[4]=L,d[5]=A,d},j.scale=function(d,v,E){var C=v[1],z=v[2],w=v[3],R=v[4],L=v[5],A=E[0],D=E[1];return d[0]=v[0]*A,d[1]=C*A,d[2]=z*D,d[3]=w*D,d[4]=R,d[5]=L,d},j.translate=function(d,v,E){var C=v[0],z=v[1],w=v[2],R=v[3],L=v[4],A=v[5],D=E[0],F=E[1];return d[0]=C,d[1]=z,d[2]=w,d[3]=R,d[4]=C*D+w*F+L,d[5]=z*D+R*F+A,d},j.fromRotation=function(d,v){var E=Math.sin(v),C=Math.cos(v);return d[0]=C,d[1]=E,d[2]=-E,d[3]=C,d[4]=0,d[5]=0,d},j.fromScaling=function(d,v){return d[0]=v[0],d[1]=0,d[2]=0,d[3]=v[1],d[4]=0,d[5]=0,d},j.fromTranslation=function(d,v){return d[0]=1,d[1]=0,d[2]=0,d[3]=1,d[4]=v[0],d[5]=v[1],d},j.str=function(d){return"mat2d("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+", "+d[4]+", "+d[5]+")"},j.frob=function(d){return Math.hypot(d[0],d[1],d[2],d[3],d[4],d[5],1)},j.add=function(d,v,E){return d[0]=v[0]+E[0],d[1]=v[1]+E[1],d[2]=v[2]+E[2],d[3]=v[3]+E[3],d[4]=v[4]+E[4],d[5]=v[5]+E[5],d},j.subtract=g,j.multiplyScalar=function(d,v,E){return d[0]=v[0]*E,d[1]=v[1]*E,d[2]=v[2]*E,d[3]=v[3]*E,d[4]=v[4]*E,d[5]=v[5]*E,d},j.multiplyScalarAndAdd=function(d,v,E,C){return d[0]=v[0]+E[0]*C,d[1]=v[1]+E[1]*C,d[2]=v[2]+E[2]*C,d[3]=v[3]+E[3]*C,d[4]=v[4]+E[4]*C,d[5]=v[5]+E[5]*C,d},j.exactEquals=function(d,v){return d[0]===v[0]&&d[1]===v[1]&&d[2]===v[2]&&d[3]===v[3]&&d[4]===v[4]&&d[5]===v[5]},j.equals=function(d,v){var E=d[0],C=d[1],z=d[2],w=d[3],R=d[4],L=d[5],A=v[0],D=v[1],F=v[2],W=v[3],$=v[4],ie=v[5];return Math.abs(E-A)<=n.EPSILON*Math.max(1,Math.abs(E),Math.abs(A))&&Math.abs(C-D)<=n.EPSILON*Math.max(1,Math.abs(C),Math.abs(D))&&Math.abs(z-F)<=n.EPSILON*Math.max(1,Math.abs(z),Math.abs(F))&&Math.abs(w-W)<=n.EPSILON*Math.max(1,Math.abs(w),Math.abs(W))&&Math.abs(R-$)<=n.EPSILON*Math.max(1,Math.abs(R),Math.abs($))&&Math.abs(L-ie)<=n.EPSILON*Math.max(1,Math.abs(L),Math.abs(ie))},j.sub=j.mul=void 0;var n=function(d,v){if(d&&d.__esModule)return d;if(d===null||l(d)!=="object"&&typeof d!="function")return{default:d};var E=o(void 0);if(E&&E.has(d))return E.get(d);var C={},z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var w in d)if(w!=="default"&&Object.prototype.hasOwnProperty.call(d,w)){var R=z?Object.getOwnPropertyDescriptor(d,w):null;R&&(R.get||R.set)?Object.defineProperty(C,w,R):C[w]=d[w]}return C.default=d,E&&E.set(d,C),C}(H());function o(d){if(typeof WeakMap!="function")return null;var v=new WeakMap,E=new WeakMap;return(o=function(C){return C?E:v})(d)}function u(d,v,E){var C=v[0],z=v[1],w=v[2],R=v[3],L=v[4],A=v[5],D=E[0],F=E[1],W=E[2],$=E[3],ie=E[4],re=E[5];return d[0]=C*D+w*F,d[1]=z*D+R*F,d[2]=C*W+w*$,d[3]=z*W+R*$,d[4]=C*ie+w*re+L,d[5]=z*ie+R*re+A,d}function g(d,v,E){return d[0]=v[0]-E[0],d[1]=v[1]-E[1],d[2]=v[2]-E[2],d[3]=v[3]-E[3],d[4]=v[4]-E[4],d[5]=v[5]-E[5],d}return j.mul=u,j.sub=g,j}var ce,pe={};function Ae(){if(ce)return pe;function l(d){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},l(d)}ce=1,Object.defineProperty(pe,"__esModule",{value:!0}),pe.create=function(){var d=new n.ARRAY_TYPE(9);return n.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[5]=0,d[6]=0,d[7]=0),d[0]=1,d[4]=1,d[8]=1,d},pe.fromMat4=function(d,v){return d[0]=v[0],d[1]=v[1],d[2]=v[2],d[3]=v[4],d[4]=v[5],d[5]=v[6],d[6]=v[8],d[7]=v[9],d[8]=v[10],d},pe.clone=function(d){var v=new n.ARRAY_TYPE(9);return v[0]=d[0],v[1]=d[1],v[2]=d[2],v[3]=d[3],v[4]=d[4],v[5]=d[5],v[6]=d[6],v[7]=d[7],v[8]=d[8],v},pe.copy=function(d,v){return d[0]=v[0],d[1]=v[1],d[2]=v[2],d[3]=v[3],d[4]=v[4],d[5]=v[5],d[6]=v[6],d[7]=v[7],d[8]=v[8],d},pe.fromValues=function(d,v,E,C,z,w,R,L,A){var D=new n.ARRAY_TYPE(9);return D[0]=d,D[1]=v,D[2]=E,D[3]=C,D[4]=z,D[5]=w,D[6]=R,D[7]=L,D[8]=A,D},pe.set=function(d,v,E,C,z,w,R,L,A,D){return d[0]=v,d[1]=E,d[2]=C,d[3]=z,d[4]=w,d[5]=R,d[6]=L,d[7]=A,d[8]=D,d},pe.identity=function(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=1,d[5]=0,d[6]=0,d[7]=0,d[8]=1,d},pe.transpose=function(d,v){if(d===v){var E=v[1],C=v[2],z=v[5];d[1]=v[3],d[2]=v[6],d[3]=E,d[5]=v[7],d[6]=C,d[7]=z}else d[0]=v[0],d[1]=v[3],d[2]=v[6],d[3]=v[1],d[4]=v[4],d[5]=v[7],d[6]=v[2],d[7]=v[5],d[8]=v[8];return d},pe.invert=function(d,v){var E=v[0],C=v[1],z=v[2],w=v[3],R=v[4],L=v[5],A=v[6],D=v[7],F=v[8],W=F*R-L*D,$=-F*w+L*A,ie=D*w-R*A,re=E*W+C*$+z*ie;return re?(d[0]=W*(re=1/re),d[1]=(-F*C+z*D)*re,d[2]=(L*C-z*R)*re,d[3]=$*re,d[4]=(F*E-z*A)*re,d[5]=(-L*E+z*w)*re,d[6]=ie*re,d[7]=(-D*E+C*A)*re,d[8]=(R*E-C*w)*re,d):null},pe.adjoint=function(d,v){var E=v[0],C=v[1],z=v[2],w=v[3],R=v[4],L=v[5],A=v[6],D=v[7],F=v[8];return d[0]=R*F-L*D,d[1]=z*D-C*F,d[2]=C*L-z*R,d[3]=L*A-w*F,d[4]=E*F-z*A,d[5]=z*w-E*L,d[6]=w*D-R*A,d[7]=C*A-E*D,d[8]=E*R-C*w,d},pe.determinant=function(d){var v=d[3],E=d[4],C=d[5],z=d[6],w=d[7],R=d[8];return d[0]*(R*E-C*w)+d[1]*(-R*v+C*z)+d[2]*(w*v-E*z)},pe.multiply=u,pe.translate=function(d,v,E){var C=v[0],z=v[1],w=v[2],R=v[3],L=v[4],A=v[5],D=v[6],F=v[7],W=v[8],$=E[0],ie=E[1];return d[0]=C,d[1]=z,d[2]=w,d[3]=R,d[4]=L,d[5]=A,d[6]=$*C+ie*R+D,d[7]=$*z+ie*L+F,d[8]=$*w+ie*A+W,d},pe.rotate=function(d,v,E){var C=v[0],z=v[1],w=v[2],R=v[3],L=v[4],A=v[5],D=v[6],F=v[7],W=v[8],$=Math.sin(E),ie=Math.cos(E);return d[0]=ie*C+$*R,d[1]=ie*z+$*L,d[2]=ie*w+$*A,d[3]=ie*R-$*C,d[4]=ie*L-$*z,d[5]=ie*A-$*w,d[6]=D,d[7]=F,d[8]=W,d},pe.scale=function(d,v,E){var C=E[0],z=E[1];return d[0]=C*v[0],d[1]=C*v[1],d[2]=C*v[2],d[3]=z*v[3],d[4]=z*v[4],d[5]=z*v[5],d[6]=v[6],d[7]=v[7],d[8]=v[8],d},pe.fromTranslation=function(d,v){return d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=1,d[5]=0,d[6]=v[0],d[7]=v[1],d[8]=1,d},pe.fromRotation=function(d,v){var E=Math.sin(v),C=Math.cos(v);return d[0]=C,d[1]=E,d[2]=0,d[3]=-E,d[4]=C,d[5]=0,d[6]=0,d[7]=0,d[8]=1,d},pe.fromScaling=function(d,v){return d[0]=v[0],d[1]=0,d[2]=0,d[3]=0,d[4]=v[1],d[5]=0,d[6]=0,d[7]=0,d[8]=1,d},pe.fromMat2d=function(d,v){return d[0]=v[0],d[1]=v[1],d[2]=0,d[3]=v[2],d[4]=v[3],d[5]=0,d[6]=v[4],d[7]=v[5],d[8]=1,d},pe.fromQuat=function(d,v){var E=v[0],C=v[1],z=v[2],w=v[3],R=E+E,L=C+C,A=z+z,D=E*R,F=C*R,W=C*L,$=z*R,ie=z*L,re=z*A,ee=w*R,ae=w*L,de=w*A;return d[0]=1-W-re,d[3]=F-de,d[6]=$+ae,d[1]=F+de,d[4]=1-D-re,d[7]=ie-ee,d[2]=$-ae,d[5]=ie+ee,d[8]=1-D-W,d},pe.normalFromMat4=function(d,v){var E=v[0],C=v[1],z=v[2],w=v[3],R=v[4],L=v[5],A=v[6],D=v[7],F=v[8],W=v[9],$=v[10],ie=v[11],re=v[12],ee=v[13],ae=v[14],de=v[15],ye=E*L-C*R,De=E*A-z*R,Ie=E*D-w*R,Re=C*A-z*L,$e=C*D-w*L,Oe=z*D-w*A,Ye=F*ee-W*re,tt=F*ae-$*re,Je=F*de-ie*re,rt=W*ae-$*ee,ct=W*de-ie*ee,yt=$*de-ie*ae,st=ye*yt-De*ct+Ie*rt+Re*Je-$e*tt+Oe*Ye;return st?(d[0]=(L*yt-A*ct+D*rt)*(st=1/st),d[1]=(A*Je-R*yt-D*tt)*st,d[2]=(R*ct-L*Je+D*Ye)*st,d[3]=(z*ct-C*yt-w*rt)*st,d[4]=(E*yt-z*Je+w*tt)*st,d[5]=(C*Je-E*ct-w*Ye)*st,d[6]=(ee*Oe-ae*$e+de*Re)*st,d[7]=(ae*Ie-re*Oe-de*De)*st,d[8]=(re*$e-ee*Ie+de*ye)*st,d):null},pe.projection=function(d,v,E){return d[0]=2/v,d[1]=0,d[2]=0,d[3]=0,d[4]=-2/E,d[5]=0,d[6]=-1,d[7]=1,d[8]=1,d},pe.str=function(d){return"mat3("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+", "+d[4]+", "+d[5]+", "+d[6]+", "+d[7]+", "+d[8]+")"},pe.frob=function(d){return Math.hypot(d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8])},pe.add=function(d,v,E){return d[0]=v[0]+E[0],d[1]=v[1]+E[1],d[2]=v[2]+E[2],d[3]=v[3]+E[3],d[4]=v[4]+E[4],d[5]=v[5]+E[5],d[6]=v[6]+E[6],d[7]=v[7]+E[7],d[8]=v[8]+E[8],d},pe.subtract=g,pe.multiplyScalar=function(d,v,E){return d[0]=v[0]*E,d[1]=v[1]*E,d[2]=v[2]*E,d[3]=v[3]*E,d[4]=v[4]*E,d[5]=v[5]*E,d[6]=v[6]*E,d[7]=v[7]*E,d[8]=v[8]*E,d},pe.multiplyScalarAndAdd=function(d,v,E,C){return d[0]=v[0]+E[0]*C,d[1]=v[1]+E[1]*C,d[2]=v[2]+E[2]*C,d[3]=v[3]+E[3]*C,d[4]=v[4]+E[4]*C,d[5]=v[5]+E[5]*C,d[6]=v[6]+E[6]*C,d[7]=v[7]+E[7]*C,d[8]=v[8]+E[8]*C,d},pe.exactEquals=function(d,v){return d[0]===v[0]&&d[1]===v[1]&&d[2]===v[2]&&d[3]===v[3]&&d[4]===v[4]&&d[5]===v[5]&&d[6]===v[6]&&d[7]===v[7]&&d[8]===v[8]},pe.equals=function(d,v){var E=d[0],C=d[1],z=d[2],w=d[3],R=d[4],L=d[5],A=d[6],D=d[7],F=d[8],W=v[0],$=v[1],ie=v[2],re=v[3],ee=v[4],ae=v[5],de=v[6],ye=v[7],De=v[8];return Math.abs(E-W)<=n.EPSILON*Math.max(1,Math.abs(E),Math.abs(W))&&Math.abs(C-$)<=n.EPSILON*Math.max(1,Math.abs(C),Math.abs($))&&Math.abs(z-ie)<=n.EPSILON*Math.max(1,Math.abs(z),Math.abs(ie))&&Math.abs(w-re)<=n.EPSILON*Math.max(1,Math.abs(w),Math.abs(re))&&Math.abs(R-ee)<=n.EPSILON*Math.max(1,Math.abs(R),Math.abs(ee))&&Math.abs(L-ae)<=n.EPSILON*Math.max(1,Math.abs(L),Math.abs(ae))&&Math.abs(A-de)<=n.EPSILON*Math.max(1,Math.abs(A),Math.abs(de))&&Math.abs(D-ye)<=n.EPSILON*Math.max(1,Math.abs(D),Math.abs(ye))&&Math.abs(F-De)<=n.EPSILON*Math.max(1,Math.abs(F),Math.abs(De))},pe.sub=pe.mul=void 0;var n=function(d,v){if(d&&d.__esModule)return d;if(d===null||l(d)!=="object"&&typeof d!="function")return{default:d};var E=o(void 0);if(E&&E.has(d))return E.get(d);var C={},z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var w in d)if(w!=="default"&&Object.prototype.hasOwnProperty.call(d,w)){var R=z?Object.getOwnPropertyDescriptor(d,w):null;R&&(R.get||R.set)?Object.defineProperty(C,w,R):C[w]=d[w]}return C.default=d,E&&E.set(d,C),C}(H());function o(d){if(typeof WeakMap!="function")return null;var v=new WeakMap,E=new WeakMap;return(o=function(C){return C?E:v})(d)}function u(d,v,E){var C=v[0],z=v[1],w=v[2],R=v[3],L=v[4],A=v[5],D=v[6],F=v[7],W=v[8],$=E[0],ie=E[1],re=E[2],ee=E[3],ae=E[4],de=E[5],ye=E[6],De=E[7],Ie=E[8];return d[0]=$*C+ie*R+re*D,d[1]=$*z+ie*L+re*F,d[2]=$*w+ie*A+re*W,d[3]=ee*C+ae*R+de*D,d[4]=ee*z+ae*L+de*F,d[5]=ee*w+ae*A+de*W,d[6]=ye*C+De*R+Ie*D,d[7]=ye*z+De*L+Ie*F,d[8]=ye*w+De*A+Ie*W,d}function g(d,v,E){return d[0]=v[0]-E[0],d[1]=v[1]-E[1],d[2]=v[2]-E[2],d[3]=v[3]-E[3],d[4]=v[4]-E[4],d[5]=v[5]-E[5],d[6]=v[6]-E[6],d[7]=v[7]-E[7],d[8]=v[8]-E[8],d}return pe.mul=u,pe.sub=g,pe}var Ee,be={};function Ve(){if(Ee)return be;function l(w){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},l(w)}Ee=1,Object.defineProperty(be,"__esModule",{value:!0}),be.create=function(){var w=new n.ARRAY_TYPE(16);return n.ARRAY_TYPE!=Float32Array&&(w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=0,w[12]=0,w[13]=0,w[14]=0),w[0]=1,w[5]=1,w[10]=1,w[15]=1,w},be.clone=function(w){var R=new n.ARRAY_TYPE(16);return R[0]=w[0],R[1]=w[1],R[2]=w[2],R[3]=w[3],R[4]=w[4],R[5]=w[5],R[6]=w[6],R[7]=w[7],R[8]=w[8],R[9]=w[9],R[10]=w[10],R[11]=w[11],R[12]=w[12],R[13]=w[13],R[14]=w[14],R[15]=w[15],R},be.copy=function(w,R){return w[0]=R[0],w[1]=R[1],w[2]=R[2],w[3]=R[3],w[4]=R[4],w[5]=R[5],w[6]=R[6],w[7]=R[7],w[8]=R[8],w[9]=R[9],w[10]=R[10],w[11]=R[11],w[12]=R[12],w[13]=R[13],w[14]=R[14],w[15]=R[15],w},be.fromValues=function(w,R,L,A,D,F,W,$,ie,re,ee,ae,de,ye,De,Ie){var Re=new n.ARRAY_TYPE(16);return Re[0]=w,Re[1]=R,Re[2]=L,Re[3]=A,Re[4]=D,Re[5]=F,Re[6]=W,Re[7]=$,Re[8]=ie,Re[9]=re,Re[10]=ee,Re[11]=ae,Re[12]=de,Re[13]=ye,Re[14]=De,Re[15]=Ie,Re},be.set=function(w,R,L,A,D,F,W,$,ie,re,ee,ae,de,ye,De,Ie,Re){return w[0]=R,w[1]=L,w[2]=A,w[3]=D,w[4]=F,w[5]=W,w[6]=$,w[7]=ie,w[8]=re,w[9]=ee,w[10]=ae,w[11]=de,w[12]=ye,w[13]=De,w[14]=Ie,w[15]=Re,w},be.identity=u,be.transpose=function(w,R){if(w===R){var L=R[1],A=R[2],D=R[3],F=R[6],W=R[7],$=R[11];w[1]=R[4],w[2]=R[8],w[3]=R[12],w[4]=L,w[6]=R[9],w[7]=R[13],w[8]=A,w[9]=F,w[11]=R[14],w[12]=D,w[13]=W,w[14]=$}else w[0]=R[0],w[1]=R[4],w[2]=R[8],w[3]=R[12],w[4]=R[1],w[5]=R[5],w[6]=R[9],w[7]=R[13],w[8]=R[2],w[9]=R[6],w[10]=R[10],w[11]=R[14],w[12]=R[3],w[13]=R[7],w[14]=R[11],w[15]=R[15];return w},be.invert=function(w,R){var L=R[0],A=R[1],D=R[2],F=R[3],W=R[4],$=R[5],ie=R[6],re=R[7],ee=R[8],ae=R[9],de=R[10],ye=R[11],De=R[12],Ie=R[13],Re=R[14],$e=R[15],Oe=L*$-A*W,Ye=L*ie-D*W,tt=L*re-F*W,Je=A*ie-D*$,rt=A*re-F*$,ct=D*re-F*ie,yt=ee*Ie-ae*De,st=ee*Re-de*De,Bt=ee*$e-ye*De,Qt=ae*Re-de*Ie,Nt=ae*$e-ye*Ie,An=de*$e-ye*Re,xn=Oe*An-Ye*Nt+tt*Qt+Je*Bt-rt*st+ct*yt;return xn?(w[0]=($*An-ie*Nt+re*Qt)*(xn=1/xn),w[1]=(D*Nt-A*An-F*Qt)*xn,w[2]=(Ie*ct-Re*rt+$e*Je)*xn,w[3]=(de*rt-ae*ct-ye*Je)*xn,w[4]=(ie*Bt-W*An-re*st)*xn,w[5]=(L*An-D*Bt+F*st)*xn,w[6]=(Re*tt-De*ct-$e*Ye)*xn,w[7]=(ee*ct-de*tt+ye*Ye)*xn,w[8]=(W*Nt-$*Bt+re*yt)*xn,w[9]=(A*Bt-L*Nt-F*yt)*xn,w[10]=(De*rt-Ie*tt+$e*Oe)*xn,w[11]=(ae*tt-ee*rt-ye*Oe)*xn,w[12]=($*st-W*Qt-ie*yt)*xn,w[13]=(L*Qt-A*st+D*yt)*xn,w[14]=(Ie*Ye-De*Je-Re*Oe)*xn,w[15]=(ee*Je-ae*Ye+de*Oe)*xn,w):null},be.adjoint=function(w,R){var L=R[0],A=R[1],D=R[2],F=R[3],W=R[4],$=R[5],ie=R[6],re=R[7],ee=R[8],ae=R[9],de=R[10],ye=R[11],De=R[12],Ie=R[13],Re=R[14],$e=R[15];return w[0]=$*(de*$e-ye*Re)-ae*(ie*$e-re*Re)+Ie*(ie*ye-re*de),w[1]=-(A*(de*$e-ye*Re)-ae*(D*$e-F*Re)+Ie*(D*ye-F*de)),w[2]=A*(ie*$e-re*Re)-$*(D*$e-F*Re)+Ie*(D*re-F*ie),w[3]=-(A*(ie*ye-re*de)-$*(D*ye-F*de)+ae*(D*re-F*ie)),w[4]=-(W*(de*$e-ye*Re)-ee*(ie*$e-re*Re)+De*(ie*ye-re*de)),w[5]=L*(de*$e-ye*Re)-ee*(D*$e-F*Re)+De*(D*ye-F*de),w[6]=-(L*(ie*$e-re*Re)-W*(D*$e-F*Re)+De*(D*re-F*ie)),w[7]=L*(ie*ye-re*de)-W*(D*ye-F*de)+ee*(D*re-F*ie),w[8]=W*(ae*$e-ye*Ie)-ee*($*$e-re*Ie)+De*($*ye-re*ae),w[9]=-(L*(ae*$e-ye*Ie)-ee*(A*$e-F*Ie)+De*(A*ye-F*ae)),w[10]=L*($*$e-re*Ie)-W*(A*$e-F*Ie)+De*(A*re-F*$),w[11]=-(L*($*ye-re*ae)-W*(A*ye-F*ae)+ee*(A*re-F*$)),w[12]=-(W*(ae*Re-de*Ie)-ee*($*Re-ie*Ie)+De*($*de-ie*ae)),w[13]=L*(ae*Re-de*Ie)-ee*(A*Re-D*Ie)+De*(A*de-D*ae),w[14]=-(L*($*Re-ie*Ie)-W*(A*Re-D*Ie)+De*(A*ie-D*$)),w[15]=L*($*de-ie*ae)-W*(A*de-D*ae)+ee*(A*ie-D*$),w},be.determinant=function(w){var R=w[0],L=w[1],A=w[2],D=w[3],F=w[4],W=w[5],$=w[6],ie=w[7],re=w[8],ee=w[9],ae=w[10],de=w[11],ye=w[12],De=w[13],Ie=w[14],Re=w[15];return(R*W-L*F)*(ae*Re-de*Ie)-(R*$-A*F)*(ee*Re-de*De)+(R*ie-D*F)*(ee*Ie-ae*De)+(L*$-A*W)*(re*Re-de*ye)-(L*ie-D*W)*(re*Ie-ae*ye)+(A*ie-D*$)*(re*De-ee*ye)},be.multiply=g,be.translate=function(w,R,L){var A,D,F,W,$,ie,re,ee,ae,de,ye,De,Ie=L[0],Re=L[1],$e=L[2];return R===w?(w[12]=R[0]*Ie+R[4]*Re+R[8]*$e+R[12],w[13]=R[1]*Ie+R[5]*Re+R[9]*$e+R[13],w[14]=R[2]*Ie+R[6]*Re+R[10]*$e+R[14],w[15]=R[3]*Ie+R[7]*Re+R[11]*$e+R[15]):(D=R[1],F=R[2],W=R[3],$=R[4],ie=R[5],re=R[6],ee=R[7],ae=R[8],de=R[9],ye=R[10],De=R[11],w[0]=A=R[0],w[1]=D,w[2]=F,w[3]=W,w[4]=$,w[5]=ie,w[6]=re,w[7]=ee,w[8]=ae,w[9]=de,w[10]=ye,w[11]=De,w[12]=A*Ie+$*Re+ae*$e+R[12],w[13]=D*Ie+ie*Re+de*$e+R[13],w[14]=F*Ie+re*Re+ye*$e+R[14],w[15]=W*Ie+ee*Re+De*$e+R[15]),w},be.scale=function(w,R,L){var A=L[0],D=L[1],F=L[2];return w[0]=R[0]*A,w[1]=R[1]*A,w[2]=R[2]*A,w[3]=R[3]*A,w[4]=R[4]*D,w[5]=R[5]*D,w[6]=R[6]*D,w[7]=R[7]*D,w[8]=R[8]*F,w[9]=R[9]*F,w[10]=R[10]*F,w[11]=R[11]*F,w[12]=R[12],w[13]=R[13],w[14]=R[14],w[15]=R[15],w},be.rotate=function(w,R,L,A){var D,F,W,$,ie,re,ee,ae,de,ye,De,Ie,Re,$e,Oe,Ye,tt,Je,rt,ct,yt,st,Bt,Qt,Nt=A[0],An=A[1],xn=A[2],cn=Math.hypot(Nt,An,xn);return cn<n.EPSILON?null:(Nt*=cn=1/cn,An*=cn,xn*=cn,D=Math.sin(L),F=Math.cos(L),ie=R[1],re=R[2],ee=R[3],de=R[5],ye=R[6],De=R[7],Re=R[9],$e=R[10],Oe=R[11],Ye=Nt*Nt*(W=1-F)+F,rt=Nt*An*W-xn*D,ct=An*An*W+F,yt=xn*An*W+Nt*D,st=Nt*xn*W+An*D,Bt=An*xn*W-Nt*D,Qt=xn*xn*W+F,w[0]=($=R[0])*Ye+(ae=R[4])*(tt=An*Nt*W+xn*D)+(Ie=R[8])*(Je=xn*Nt*W-An*D),w[1]=ie*Ye+de*tt+Re*Je,w[2]=re*Ye+ye*tt+$e*Je,w[3]=ee*Ye+De*tt+Oe*Je,w[4]=$*rt+ae*ct+Ie*yt,w[5]=ie*rt+de*ct+Re*yt,w[6]=re*rt+ye*ct+$e*yt,w[7]=ee*rt+De*ct+Oe*yt,w[8]=$*st+ae*Bt+Ie*Qt,w[9]=ie*st+de*Bt+Re*Qt,w[10]=re*st+ye*Bt+$e*Qt,w[11]=ee*st+De*Bt+Oe*Qt,R!==w&&(w[12]=R[12],w[13]=R[13],w[14]=R[14],w[15]=R[15]),w)},be.rotateX=function(w,R,L){var A=Math.sin(L),D=Math.cos(L),F=R[4],W=R[5],$=R[6],ie=R[7],re=R[8],ee=R[9],ae=R[10],de=R[11];return R!==w&&(w[0]=R[0],w[1]=R[1],w[2]=R[2],w[3]=R[3],w[12]=R[12],w[13]=R[13],w[14]=R[14],w[15]=R[15]),w[4]=F*D+re*A,w[5]=W*D+ee*A,w[6]=$*D+ae*A,w[7]=ie*D+de*A,w[8]=re*D-F*A,w[9]=ee*D-W*A,w[10]=ae*D-$*A,w[11]=de*D-ie*A,w},be.rotateY=function(w,R,L){var A=Math.sin(L),D=Math.cos(L),F=R[0],W=R[1],$=R[2],ie=R[3],re=R[8],ee=R[9],ae=R[10],de=R[11];return R!==w&&(w[4]=R[4],w[5]=R[5],w[6]=R[6],w[7]=R[7],w[12]=R[12],w[13]=R[13],w[14]=R[14],w[15]=R[15]),w[0]=F*D-re*A,w[1]=W*D-ee*A,w[2]=$*D-ae*A,w[3]=ie*D-de*A,w[8]=F*A+re*D,w[9]=W*A+ee*D,w[10]=$*A+ae*D,w[11]=ie*A+de*D,w},be.rotateZ=function(w,R,L){var A=Math.sin(L),D=Math.cos(L),F=R[0],W=R[1],$=R[2],ie=R[3],re=R[4],ee=R[5],ae=R[6],de=R[7];return R!==w&&(w[8]=R[8],w[9]=R[9],w[10]=R[10],w[11]=R[11],w[12]=R[12],w[13]=R[13],w[14]=R[14],w[15]=R[15]),w[0]=F*D+re*A,w[1]=W*D+ee*A,w[2]=$*D+ae*A,w[3]=ie*D+de*A,w[4]=re*D-F*A,w[5]=ee*D-W*A,w[6]=ae*D-$*A,w[7]=de*D-ie*A,w},be.fromTranslation=function(w,R){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=R[0],w[13]=R[1],w[14]=R[2],w[15]=1,w},be.fromScaling=function(w,R){return w[0]=R[0],w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=R[1],w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=R[2],w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w},be.fromRotation=function(w,R,L){var A,D,F,W=L[0],$=L[1],ie=L[2],re=Math.hypot(W,$,ie);return re<n.EPSILON?null:(W*=re=1/re,$*=re,ie*=re,A=Math.sin(R),D=Math.cos(R),w[0]=W*W*(F=1-D)+D,w[1]=$*W*F+ie*A,w[2]=ie*W*F-$*A,w[3]=0,w[4]=W*$*F-ie*A,w[5]=$*$*F+D,w[6]=ie*$*F+W*A,w[7]=0,w[8]=W*ie*F+$*A,w[9]=$*ie*F-W*A,w[10]=ie*ie*F+D,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w)},be.fromXRotation=function(w,R){var L=Math.sin(R),A=Math.cos(R);return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=A,w[6]=L,w[7]=0,w[8]=0,w[9]=-L,w[10]=A,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w},be.fromYRotation=function(w,R){var L=Math.sin(R),A=Math.cos(R);return w[0]=A,w[1]=0,w[2]=-L,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=L,w[9]=0,w[10]=A,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w},be.fromZRotation=function(w,R){var L=Math.sin(R),A=Math.cos(R);return w[0]=A,w[1]=L,w[2]=0,w[3]=0,w[4]=-L,w[5]=A,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w},be.fromRotationTranslation=d,be.fromQuat2=function(w,R){var L=new n.ARRAY_TYPE(3),A=-R[0],D=-R[1],F=-R[2],W=R[3],$=R[4],ie=R[5],re=R[6],ee=R[7],ae=A*A+D*D+F*F+W*W;return ae>0?(L[0]=2*($*W+ee*A+ie*F-re*D)/ae,L[1]=2*(ie*W+ee*D+re*A-$*F)/ae,L[2]=2*(re*W+ee*F+$*D-ie*A)/ae):(L[0]=2*($*W+ee*A+ie*F-re*D),L[1]=2*(ie*W+ee*D+re*A-$*F),L[2]=2*(re*W+ee*F+$*D-ie*A)),d(w,R,L),w},be.getTranslation=function(w,R){return w[0]=R[12],w[1]=R[13],w[2]=R[14],w},be.getScaling=v,be.getRotation=function(w,R){var L=new n.ARRAY_TYPE(3);v(L,R);var A=1/L[0],D=1/L[1],F=1/L[2],W=R[0]*A,$=R[1]*D,ie=R[2]*F,re=R[4]*A,ee=R[5]*D,ae=R[6]*F,de=R[8]*A,ye=R[9]*D,De=R[10]*F,Ie=W+ee+De,Re=0;return Ie>0?(Re=2*Math.sqrt(Ie+1),w[3]=.25*Re,w[0]=(ae-ye)/Re,w[1]=(de-ie)/Re,w[2]=($-re)/Re):W>ee&&W>De?(Re=2*Math.sqrt(1+W-ee-De),w[3]=(ae-ye)/Re,w[0]=.25*Re,w[1]=($+re)/Re,w[2]=(de+ie)/Re):ee>De?(Re=2*Math.sqrt(1+ee-W-De),w[3]=(de-ie)/Re,w[0]=($+re)/Re,w[1]=.25*Re,w[2]=(ae+ye)/Re):(Re=2*Math.sqrt(1+De-W-ee),w[3]=($-re)/Re,w[0]=(de+ie)/Re,w[1]=(ae+ye)/Re,w[2]=.25*Re),w},be.fromRotationTranslationScale=function(w,R,L,A){var D=R[0],F=R[1],W=R[2],$=R[3],ie=D+D,re=F+F,ee=W+W,ae=D*ie,de=D*re,ye=D*ee,De=F*re,Ie=F*ee,Re=W*ee,$e=$*ie,Oe=$*re,Ye=$*ee,tt=A[0],Je=A[1],rt=A[2];return w[0]=(1-(De+Re))*tt,w[1]=(de+Ye)*tt,w[2]=(ye-Oe)*tt,w[3]=0,w[4]=(de-Ye)*Je,w[5]=(1-(ae+Re))*Je,w[6]=(Ie+$e)*Je,w[7]=0,w[8]=(ye+Oe)*rt,w[9]=(Ie-$e)*rt,w[10]=(1-(ae+De))*rt,w[11]=0,w[12]=L[0],w[13]=L[1],w[14]=L[2],w[15]=1,w},be.fromRotationTranslationScaleOrigin=function(w,R,L,A,D){var F=R[0],W=R[1],$=R[2],ie=R[3],re=F+F,ee=W+W,ae=$+$,de=F*re,ye=F*ee,De=F*ae,Ie=W*ee,Re=W*ae,$e=$*ae,Oe=ie*re,Ye=ie*ee,tt=ie*ae,Je=A[0],rt=A[1],ct=A[2],yt=D[0],st=D[1],Bt=D[2],Qt=(1-(Ie+$e))*Je,Nt=(ye+tt)*Je,An=(De-Ye)*Je,xn=(ye-tt)*rt,cn=(1-(de+$e))*rt,nn=(Re+Oe)*rt,Hn=(De+Ye)*ct,In=(Re-Oe)*ct,kn=(1-(de+Ie))*ct;return w[0]=Qt,w[1]=Nt,w[2]=An,w[3]=0,w[4]=xn,w[5]=cn,w[6]=nn,w[7]=0,w[8]=Hn,w[9]=In,w[10]=kn,w[11]=0,w[12]=L[0]+yt-(Qt*yt+xn*st+Hn*Bt),w[13]=L[1]+st-(Nt*yt+cn*st+In*Bt),w[14]=L[2]+Bt-(An*yt+nn*st+kn*Bt),w[15]=1,w},be.fromQuat=function(w,R){var L=R[0],A=R[1],D=R[2],F=R[3],W=L+L,$=A+A,ie=D+D,re=L*W,ee=A*W,ae=A*$,de=D*W,ye=D*$,De=D*ie,Ie=F*W,Re=F*$,$e=F*ie;return w[0]=1-ae-De,w[1]=ee+$e,w[2]=de-Re,w[3]=0,w[4]=ee-$e,w[5]=1-re-De,w[6]=ye+Ie,w[7]=0,w[8]=de+Re,w[9]=ye-Ie,w[10]=1-re-ae,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w},be.frustum=function(w,R,L,A,D,F,W){var $=1/(L-R),ie=1/(D-A),re=1/(F-W);return w[0]=2*F*$,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=2*F*ie,w[6]=0,w[7]=0,w[8]=(L+R)*$,w[9]=(D+A)*ie,w[10]=(W+F)*re,w[11]=-1,w[12]=0,w[13]=0,w[14]=W*F*2*re,w[15]=0,w},be.perspectiveNO=E,be.perspectiveZO=function(w,R,L,A,D){var F,W=1/Math.tan(R/2);return w[0]=W/L,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=W,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=-1,w[12]=0,w[13]=0,w[15]=0,D!=null&&D!==1/0?(w[10]=D*(F=1/(A-D)),w[14]=D*A*F):(w[10]=-1,w[14]=-A),w},be.perspectiveFromFieldOfView=function(w,R,L,A){var D=Math.tan(R.upDegrees*Math.PI/180),F=Math.tan(R.downDegrees*Math.PI/180),W=Math.tan(R.leftDegrees*Math.PI/180),$=Math.tan(R.rightDegrees*Math.PI/180),ie=2/(W+$),re=2/(D+F);return w[0]=ie,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=re,w[6]=0,w[7]=0,w[8]=-(W-$)*ie*.5,w[9]=(D-F)*re*.5,w[10]=A/(L-A),w[11]=-1,w[12]=0,w[13]=0,w[14]=A*L/(L-A),w[15]=0,w},be.orthoNO=C,be.orthoZO=function(w,R,L,A,D,F,W){var $=1/(R-L),ie=1/(A-D),re=1/(F-W);return w[0]=-2*$,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=-2*ie,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=re,w[11]=0,w[12]=(R+L)*$,w[13]=(D+A)*ie,w[14]=F*re,w[15]=1,w},be.lookAt=function(w,R,L,A){var D,F,W,$,ie,re,ee,ae,de,ye,De=R[0],Ie=R[1],Re=R[2],$e=A[0],Oe=A[1],Ye=A[2],tt=L[0],Je=L[1],rt=L[2];return Math.abs(De-tt)<n.EPSILON&&Math.abs(Ie-Je)<n.EPSILON&&Math.abs(Re-rt)<n.EPSILON?u(w):(ee=De-tt,ae=Ie-Je,de=Re-rt,D=Oe*(de*=ye=1/Math.hypot(ee,ae,de))-Ye*(ae*=ye),F=Ye*(ee*=ye)-$e*de,W=$e*ae-Oe*ee,(ye=Math.hypot(D,F,W))?(D*=ye=1/ye,F*=ye,W*=ye):(D=0,F=0,W=0),$=ae*W-de*F,ie=de*D-ee*W,re=ee*F-ae*D,(ye=Math.hypot($,ie,re))?($*=ye=1/ye,ie*=ye,re*=ye):($=0,ie=0,re=0),w[0]=D,w[1]=$,w[2]=ee,w[3]=0,w[4]=F,w[5]=ie,w[6]=ae,w[7]=0,w[8]=W,w[9]=re,w[10]=de,w[11]=0,w[12]=-(D*De+F*Ie+W*Re),w[13]=-($*De+ie*Ie+re*Re),w[14]=-(ee*De+ae*Ie+de*Re),w[15]=1,w)},be.targetTo=function(w,R,L,A){var D=R[0],F=R[1],W=R[2],$=A[0],ie=A[1],re=A[2],ee=D-L[0],ae=F-L[1],de=W-L[2],ye=ee*ee+ae*ae+de*de;ye>0&&(ee*=ye=1/Math.sqrt(ye),ae*=ye,de*=ye);var De=ie*de-re*ae,Ie=re*ee-$*de,Re=$*ae-ie*ee;return(ye=De*De+Ie*Ie+Re*Re)>0&&(De*=ye=1/Math.sqrt(ye),Ie*=ye,Re*=ye),w[0]=De,w[1]=Ie,w[2]=Re,w[3]=0,w[4]=ae*Re-de*Ie,w[5]=de*De-ee*Re,w[6]=ee*Ie-ae*De,w[7]=0,w[8]=ee,w[9]=ae,w[10]=de,w[11]=0,w[12]=D,w[13]=F,w[14]=W,w[15]=1,w},be.str=function(w){return"mat4("+w[0]+", "+w[1]+", "+w[2]+", "+w[3]+", "+w[4]+", "+w[5]+", "+w[6]+", "+w[7]+", "+w[8]+", "+w[9]+", "+w[10]+", "+w[11]+", "+w[12]+", "+w[13]+", "+w[14]+", "+w[15]+")"},be.frob=function(w){return Math.hypot(w[0],w[1],w[2],w[3],w[4],w[5],w[6],w[7],w[8],w[9],w[10],w[11],w[12],w[13],w[14],w[15])},be.add=function(w,R,L){return w[0]=R[0]+L[0],w[1]=R[1]+L[1],w[2]=R[2]+L[2],w[3]=R[3]+L[3],w[4]=R[4]+L[4],w[5]=R[5]+L[5],w[6]=R[6]+L[6],w[7]=R[7]+L[7],w[8]=R[8]+L[8],w[9]=R[9]+L[9],w[10]=R[10]+L[10],w[11]=R[11]+L[11],w[12]=R[12]+L[12],w[13]=R[13]+L[13],w[14]=R[14]+L[14],w[15]=R[15]+L[15],w},be.subtract=z,be.multiplyScalar=function(w,R,L){return w[0]=R[0]*L,w[1]=R[1]*L,w[2]=R[2]*L,w[3]=R[3]*L,w[4]=R[4]*L,w[5]=R[5]*L,w[6]=R[6]*L,w[7]=R[7]*L,w[8]=R[8]*L,w[9]=R[9]*L,w[10]=R[10]*L,w[11]=R[11]*L,w[12]=R[12]*L,w[13]=R[13]*L,w[14]=R[14]*L,w[15]=R[15]*L,w},be.multiplyScalarAndAdd=function(w,R,L,A){return w[0]=R[0]+L[0]*A,w[1]=R[1]+L[1]*A,w[2]=R[2]+L[2]*A,w[3]=R[3]+L[3]*A,w[4]=R[4]+L[4]*A,w[5]=R[5]+L[5]*A,w[6]=R[6]+L[6]*A,w[7]=R[7]+L[7]*A,w[8]=R[8]+L[8]*A,w[9]=R[9]+L[9]*A,w[10]=R[10]+L[10]*A,w[11]=R[11]+L[11]*A,w[12]=R[12]+L[12]*A,w[13]=R[13]+L[13]*A,w[14]=R[14]+L[14]*A,w[15]=R[15]+L[15]*A,w},be.exactEquals=function(w,R){return w[0]===R[0]&&w[1]===R[1]&&w[2]===R[2]&&w[3]===R[3]&&w[4]===R[4]&&w[5]===R[5]&&w[6]===R[6]&&w[7]===R[7]&&w[8]===R[8]&&w[9]===R[9]&&w[10]===R[10]&&w[11]===R[11]&&w[12]===R[12]&&w[13]===R[13]&&w[14]===R[14]&&w[15]===R[15]},be.equals=function(w,R){var L=w[0],A=w[1],D=w[2],F=w[3],W=w[4],$=w[5],ie=w[6],re=w[7],ee=w[8],ae=w[9],de=w[10],ye=w[11],De=w[12],Ie=w[13],Re=w[14],$e=w[15],Oe=R[0],Ye=R[1],tt=R[2],Je=R[3],rt=R[4],ct=R[5],yt=R[6],st=R[7],Bt=R[8],Qt=R[9],Nt=R[10],An=R[11],xn=R[12],cn=R[13],nn=R[14],Hn=R[15];return Math.abs(L-Oe)<=n.EPSILON*Math.max(1,Math.abs(L),Math.abs(Oe))&&Math.abs(A-Ye)<=n.EPSILON*Math.max(1,Math.abs(A),Math.abs(Ye))&&Math.abs(D-tt)<=n.EPSILON*Math.max(1,Math.abs(D),Math.abs(tt))&&Math.abs(F-Je)<=n.EPSILON*Math.max(1,Math.abs(F),Math.abs(Je))&&Math.abs(W-rt)<=n.EPSILON*Math.max(1,Math.abs(W),Math.abs(rt))&&Math.abs($-ct)<=n.EPSILON*Math.max(1,Math.abs($),Math.abs(ct))&&Math.abs(ie-yt)<=n.EPSILON*Math.max(1,Math.abs(ie),Math.abs(yt))&&Math.abs(re-st)<=n.EPSILON*Math.max(1,Math.abs(re),Math.abs(st))&&Math.abs(ee-Bt)<=n.EPSILON*Math.max(1,Math.abs(ee),Math.abs(Bt))&&Math.abs(ae-Qt)<=n.EPSILON*Math.max(1,Math.abs(ae),Math.abs(Qt))&&Math.abs(de-Nt)<=n.EPSILON*Math.max(1,Math.abs(de),Math.abs(Nt))&&Math.abs(ye-An)<=n.EPSILON*Math.max(1,Math.abs(ye),Math.abs(An))&&Math.abs(De-xn)<=n.EPSILON*Math.max(1,Math.abs(De),Math.abs(xn))&&Math.abs(Ie-cn)<=n.EPSILON*Math.max(1,Math.abs(Ie),Math.abs(cn))&&Math.abs(Re-nn)<=n.EPSILON*Math.max(1,Math.abs(Re),Math.abs(nn))&&Math.abs($e-Hn)<=n.EPSILON*Math.max(1,Math.abs($e),Math.abs(Hn))},be.sub=be.mul=be.ortho=be.perspective=void 0;var n=function(w,R){if(w&&w.__esModule)return w;if(w===null||l(w)!=="object"&&typeof w!="function")return{default:w};var L=o(void 0);if(L&&L.has(w))return L.get(w);var A={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var F in w)if(F!=="default"&&Object.prototype.hasOwnProperty.call(w,F)){var W=D?Object.getOwnPropertyDescriptor(w,F):null;W&&(W.get||W.set)?Object.defineProperty(A,F,W):A[F]=w[F]}return A.default=w,L&&L.set(w,A),A}(H());function o(w){if(typeof WeakMap!="function")return null;var R=new WeakMap,L=new WeakMap;return(o=function(A){return A?L:R})(w)}function u(w){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function g(w,R,L){var A=R[0],D=R[1],F=R[2],W=R[3],$=R[4],ie=R[5],re=R[6],ee=R[7],ae=R[8],de=R[9],ye=R[10],De=R[11],Ie=R[12],Re=R[13],$e=R[14],Oe=R[15],Ye=L[0],tt=L[1],Je=L[2],rt=L[3];return w[0]=Ye*A+tt*$+Je*ae+rt*Ie,w[1]=Ye*D+tt*ie+Je*de+rt*Re,w[2]=Ye*F+tt*re+Je*ye+rt*$e,w[3]=Ye*W+tt*ee+Je*De+rt*Oe,w[4]=(Ye=L[4])*A+(tt=L[5])*$+(Je=L[6])*ae+(rt=L[7])*Ie,w[5]=Ye*D+tt*ie+Je*de+rt*Re,w[6]=Ye*F+tt*re+Je*ye+rt*$e,w[7]=Ye*W+tt*ee+Je*De+rt*Oe,w[8]=(Ye=L[8])*A+(tt=L[9])*$+(Je=L[10])*ae+(rt=L[11])*Ie,w[9]=Ye*D+tt*ie+Je*de+rt*Re,w[10]=Ye*F+tt*re+Je*ye+rt*$e,w[11]=Ye*W+tt*ee+Je*De+rt*Oe,w[12]=(Ye=L[12])*A+(tt=L[13])*$+(Je=L[14])*ae+(rt=L[15])*Ie,w[13]=Ye*D+tt*ie+Je*de+rt*Re,w[14]=Ye*F+tt*re+Je*ye+rt*$e,w[15]=Ye*W+tt*ee+Je*De+rt*Oe,w}function d(w,R,L){var A=R[0],D=R[1],F=R[2],W=R[3],$=A+A,ie=D+D,re=F+F,ee=A*$,ae=A*ie,de=A*re,ye=D*ie,De=D*re,Ie=F*re,Re=W*$,$e=W*ie,Oe=W*re;return w[0]=1-(ye+Ie),w[1]=ae+Oe,w[2]=de-$e,w[3]=0,w[4]=ae-Oe,w[5]=1-(ee+Ie),w[6]=De+Re,w[7]=0,w[8]=de+$e,w[9]=De-Re,w[10]=1-(ee+ye),w[11]=0,w[12]=L[0],w[13]=L[1],w[14]=L[2],w[15]=1,w}function v(w,R){var L=R[4],A=R[5],D=R[6],F=R[8],W=R[9],$=R[10];return w[0]=Math.hypot(R[0],R[1],R[2]),w[1]=Math.hypot(L,A,D),w[2]=Math.hypot(F,W,$),w}function E(w,R,L,A,D){var F,W=1/Math.tan(R/2);return w[0]=W/L,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=W,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=-1,w[12]=0,w[13]=0,w[15]=0,D!=null&&D!==1/0?(w[10]=(D+A)*(F=1/(A-D)),w[14]=2*D*A*F):(w[10]=-1,w[14]=-2*A),w}function C(w,R,L,A,D,F,W){var $=1/(R-L),ie=1/(A-D),re=1/(F-W);return w[0]=-2*$,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=-2*ie,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=2*re,w[11]=0,w[12]=(R+L)*$,w[13]=(D+A)*ie,w[14]=(W+F)*re,w[15]=1,w}function z(w,R,L){return w[0]=R[0]-L[0],w[1]=R[1]-L[1],w[2]=R[2]-L[2],w[3]=R[3]-L[3],w[4]=R[4]-L[4],w[5]=R[5]-L[5],w[6]=R[6]-L[6],w[7]=R[7]-L[7],w[8]=R[8]-L[8],w[9]=R[9]-L[9],w[10]=R[10]-L[10],w[11]=R[11]-L[11],w[12]=R[12]-L[12],w[13]=R[13]-L[13],w[14]=R[14]-L[14],w[15]=R[15]-L[15],w}return be.perspective=E,be.ortho=C,be.mul=g,be.sub=z,be}var Se,xe={},Fe={};function Ct(){if(Se)return Fe;function l(D){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(F){return typeof F}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},l(D)}Se=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.create=u,Fe.clone=function(D){var F=new n.ARRAY_TYPE(3);return F[0]=D[0],F[1]=D[1],F[2]=D[2],F},Fe.length=g,Fe.fromValues=function(D,F,W){var $=new n.ARRAY_TYPE(3);return $[0]=D,$[1]=F,$[2]=W,$},Fe.copy=function(D,F){return D[0]=F[0],D[1]=F[1],D[2]=F[2],D},Fe.set=function(D,F,W,$){return D[0]=F,D[1]=W,D[2]=$,D},Fe.add=function(D,F,W){return D[0]=F[0]+W[0],D[1]=F[1]+W[1],D[2]=F[2]+W[2],D},Fe.subtract=d,Fe.multiply=v,Fe.divide=E,Fe.ceil=function(D,F){return D[0]=Math.ceil(F[0]),D[1]=Math.ceil(F[1]),D[2]=Math.ceil(F[2]),D},Fe.floor=function(D,F){return D[0]=Math.floor(F[0]),D[1]=Math.floor(F[1]),D[2]=Math.floor(F[2]),D},Fe.min=function(D,F,W){return D[0]=Math.min(F[0],W[0]),D[1]=Math.min(F[1],W[1]),D[2]=Math.min(F[2],W[2]),D},Fe.max=function(D,F,W){return D[0]=Math.max(F[0],W[0]),D[1]=Math.max(F[1],W[1]),D[2]=Math.max(F[2],W[2]),D},Fe.round=function(D,F){return D[0]=Math.round(F[0]),D[1]=Math.round(F[1]),D[2]=Math.round(F[2]),D},Fe.scale=function(D,F,W){return D[0]=F[0]*W,D[1]=F[1]*W,D[2]=F[2]*W,D},Fe.scaleAndAdd=function(D,F,W,$){return D[0]=F[0]+W[0]*$,D[1]=F[1]+W[1]*$,D[2]=F[2]+W[2]*$,D},Fe.distance=C,Fe.squaredDistance=z,Fe.squaredLength=w,Fe.negate=function(D,F){return D[0]=-F[0],D[1]=-F[1],D[2]=-F[2],D},Fe.inverse=function(D,F){return D[0]=1/F[0],D[1]=1/F[1],D[2]=1/F[2],D},Fe.normalize=function(D,F){var W=F[0],$=F[1],ie=F[2],re=W*W+$*$+ie*ie;return re>0&&(re=1/Math.sqrt(re)),D[0]=F[0]*re,D[1]=F[1]*re,D[2]=F[2]*re,D},Fe.dot=R,Fe.cross=function(D,F,W){var $=F[0],ie=F[1],re=F[2],ee=W[0],ae=W[1],de=W[2];return D[0]=ie*de-re*ae,D[1]=re*ee-$*de,D[2]=$*ae-ie*ee,D},Fe.lerp=function(D,F,W,$){var ie=F[0],re=F[1],ee=F[2];return D[0]=ie+$*(W[0]-ie),D[1]=re+$*(W[1]-re),D[2]=ee+$*(W[2]-ee),D},Fe.hermite=function(D,F,W,$,ie,re){var ee=re*re,ae=ee*(2*re-3)+1,de=ee*(re-2)+re,ye=ee*(re-1),De=ee*(3-2*re);return D[0]=F[0]*ae+W[0]*de+$[0]*ye+ie[0]*De,D[1]=F[1]*ae+W[1]*de+$[1]*ye+ie[1]*De,D[2]=F[2]*ae+W[2]*de+$[2]*ye+ie[2]*De,D},Fe.bezier=function(D,F,W,$,ie,re){var ee=1-re,ae=ee*ee,de=re*re,ye=ae*ee,De=3*re*ae,Ie=3*de*ee,Re=de*re;return D[0]=F[0]*ye+W[0]*De+$[0]*Ie+ie[0]*Re,D[1]=F[1]*ye+W[1]*De+$[1]*Ie+ie[1]*Re,D[2]=F[2]*ye+W[2]*De+$[2]*Ie+ie[2]*Re,D},Fe.random=function(D,F){F=F||1;var W=2*n.RANDOM()*Math.PI,$=2*n.RANDOM()-1,ie=Math.sqrt(1-$*$)*F;return D[0]=Math.cos(W)*ie,D[1]=Math.sin(W)*ie,D[2]=$*F,D},Fe.transformMat4=function(D,F,W){var $=F[0],ie=F[1],re=F[2],ee=W[3]*$+W[7]*ie+W[11]*re+W[15];return D[0]=(W[0]*$+W[4]*ie+W[8]*re+W[12])/(ee=ee||1),D[1]=(W[1]*$+W[5]*ie+W[9]*re+W[13])/ee,D[2]=(W[2]*$+W[6]*ie+W[10]*re+W[14])/ee,D},Fe.transformMat3=function(D,F,W){var $=F[0],ie=F[1],re=F[2];return D[0]=$*W[0]+ie*W[3]+re*W[6],D[1]=$*W[1]+ie*W[4]+re*W[7],D[2]=$*W[2]+ie*W[5]+re*W[8],D},Fe.transformQuat=function(D,F,W){var $=W[0],ie=W[1],re=W[2],ee=F[0],ae=F[1],de=F[2],ye=ie*de-re*ae,De=re*ee-$*de,Ie=$*ae-ie*ee,Re=ie*Ie-re*De,$e=re*ye-$*Ie,Oe=$*De-ie*ye,Ye=2*W[3];return De*=Ye,Ie*=Ye,$e*=2,Oe*=2,D[0]=ee+(ye*=Ye)+(Re*=2),D[1]=ae+De+$e,D[2]=de+Ie+Oe,D},Fe.rotateX=function(D,F,W,$){var ie=[],re=[];return ie[0]=F[0]-W[0],ie[1]=F[1]-W[1],ie[2]=F[2]-W[2],re[0]=ie[0],re[1]=ie[1]*Math.cos($)-ie[2]*Math.sin($),re[2]=ie[1]*Math.sin($)+ie[2]*Math.cos($),D[0]=re[0]+W[0],D[1]=re[1]+W[1],D[2]=re[2]+W[2],D},Fe.rotateY=function(D,F,W,$){var ie=[],re=[];return ie[0]=F[0]-W[0],ie[1]=F[1]-W[1],ie[2]=F[2]-W[2],re[0]=ie[2]*Math.sin($)+ie[0]*Math.cos($),re[1]=ie[1],re[2]=ie[2]*Math.cos($)-ie[0]*Math.sin($),D[0]=re[0]+W[0],D[1]=re[1]+W[1],D[2]=re[2]+W[2],D},Fe.rotateZ=function(D,F,W,$){var ie=[],re=[];return ie[0]=F[0]-W[0],ie[1]=F[1]-W[1],ie[2]=F[2]-W[2],re[0]=ie[0]*Math.cos($)-ie[1]*Math.sin($),re[1]=ie[0]*Math.sin($)+ie[1]*Math.cos($),re[2]=ie[2],D[0]=re[0]+W[0],D[1]=re[1]+W[1],D[2]=re[2]+W[2],D},Fe.angle=function(D,F){var W=D[0],$=D[1],ie=D[2],re=F[0],ee=F[1],ae=F[2],de=Math.sqrt(W*W+$*$+ie*ie)*Math.sqrt(re*re+ee*ee+ae*ae),ye=de&&R(D,F)/de;return Math.acos(Math.min(Math.max(ye,-1),1))},Fe.zero=function(D){return D[0]=0,D[1]=0,D[2]=0,D},Fe.str=function(D){return"vec3("+D[0]+", "+D[1]+", "+D[2]+")"},Fe.exactEquals=function(D,F){return D[0]===F[0]&&D[1]===F[1]&&D[2]===F[2]},Fe.equals=function(D,F){var W=D[0],$=D[1],ie=D[2],re=F[0],ee=F[1],ae=F[2];return Math.abs(W-re)<=n.EPSILON*Math.max(1,Math.abs(W),Math.abs(re))&&Math.abs($-ee)<=n.EPSILON*Math.max(1,Math.abs($),Math.abs(ee))&&Math.abs(ie-ae)<=n.EPSILON*Math.max(1,Math.abs(ie),Math.abs(ae))},Fe.forEach=Fe.sqrLen=Fe.len=Fe.sqrDist=Fe.dist=Fe.div=Fe.mul=Fe.sub=void 0;var n=function(D,F){if(D&&D.__esModule)return D;if(D===null||l(D)!=="object"&&typeof D!="function")return{default:D};var W=o(void 0);if(W&&W.has(D))return W.get(D);var $={},ie=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var re in D)if(re!=="default"&&Object.prototype.hasOwnProperty.call(D,re)){var ee=ie?Object.getOwnPropertyDescriptor(D,re):null;ee&&(ee.get||ee.set)?Object.defineProperty($,re,ee):$[re]=D[re]}return $.default=D,W&&W.set(D,$),$}(H());function o(D){if(typeof WeakMap!="function")return null;var F=new WeakMap,W=new WeakMap;return(o=function($){return $?W:F})(D)}function u(){var D=new n.ARRAY_TYPE(3);return n.ARRAY_TYPE!=Float32Array&&(D[0]=0,D[1]=0,D[2]=0),D}function g(D){return Math.hypot(D[0],D[1],D[2])}function d(D,F,W){return D[0]=F[0]-W[0],D[1]=F[1]-W[1],D[2]=F[2]-W[2],D}function v(D,F,W){return D[0]=F[0]*W[0],D[1]=F[1]*W[1],D[2]=F[2]*W[2],D}function E(D,F,W){return D[0]=F[0]/W[0],D[1]=F[1]/W[1],D[2]=F[2]/W[2],D}function C(D,F){return Math.hypot(F[0]-D[0],F[1]-D[1],F[2]-D[2])}function z(D,F){var W=F[0]-D[0],$=F[1]-D[1],ie=F[2]-D[2];return W*W+$*$+ie*ie}function w(D){var F=D[0],W=D[1],$=D[2];return F*F+W*W+$*$}function R(D,F){return D[0]*F[0]+D[1]*F[1]+D[2]*F[2]}Fe.sub=d,Fe.mul=v,Fe.div=E,Fe.dist=C,Fe.sqrDist=z,Fe.len=g,Fe.sqrLen=w;var L,A=(L=u(),function(D,F,W,$,ie,re){var ee,ae;for(F||(F=3),W||(W=0),ae=$?Math.min($*F+W,D.length):D.length,ee=W;ee<ae;ee+=F)L[0]=D[ee],L[1]=D[ee+1],L[2]=D[ee+2],ie(L,L,re),D[ee]=L[0],D[ee+1]=L[1],D[ee+2]=L[2];return D});return Fe.forEach=A,Fe}var Et,Tt,_t={};function et(){if(Et)return _t;function l(A){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},l(A)}Et=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.create=u,_t.clone=function(A){var D=new n.ARRAY_TYPE(4);return D[0]=A[0],D[1]=A[1],D[2]=A[2],D[3]=A[3],D},_t.fromValues=function(A,D,F,W){var $=new n.ARRAY_TYPE(4);return $[0]=A,$[1]=D,$[2]=F,$[3]=W,$},_t.copy=function(A,D){return A[0]=D[0],A[1]=D[1],A[2]=D[2],A[3]=D[3],A},_t.set=function(A,D,F,W,$){return A[0]=D,A[1]=F,A[2]=W,A[3]=$,A},_t.add=function(A,D,F){return A[0]=D[0]+F[0],A[1]=D[1]+F[1],A[2]=D[2]+F[2],A[3]=D[3]+F[3],A},_t.subtract=g,_t.multiply=d,_t.divide=v,_t.ceil=function(A,D){return A[0]=Math.ceil(D[0]),A[1]=Math.ceil(D[1]),A[2]=Math.ceil(D[2]),A[3]=Math.ceil(D[3]),A},_t.floor=function(A,D){return A[0]=Math.floor(D[0]),A[1]=Math.floor(D[1]),A[2]=Math.floor(D[2]),A[3]=Math.floor(D[3]),A},_t.min=function(A,D,F){return A[0]=Math.min(D[0],F[0]),A[1]=Math.min(D[1],F[1]),A[2]=Math.min(D[2],F[2]),A[3]=Math.min(D[3],F[3]),A},_t.max=function(A,D,F){return A[0]=Math.max(D[0],F[0]),A[1]=Math.max(D[1],F[1]),A[2]=Math.max(D[2],F[2]),A[3]=Math.max(D[3],F[3]),A},_t.round=function(A,D){return A[0]=Math.round(D[0]),A[1]=Math.round(D[1]),A[2]=Math.round(D[2]),A[3]=Math.round(D[3]),A},_t.scale=function(A,D,F){return A[0]=D[0]*F,A[1]=D[1]*F,A[2]=D[2]*F,A[3]=D[3]*F,A},_t.scaleAndAdd=function(A,D,F,W){return A[0]=D[0]+F[0]*W,A[1]=D[1]+F[1]*W,A[2]=D[2]+F[2]*W,A[3]=D[3]+F[3]*W,A},_t.distance=E,_t.squaredDistance=C,_t.length=z,_t.squaredLength=w,_t.negate=function(A,D){return A[0]=-D[0],A[1]=-D[1],A[2]=-D[2],A[3]=-D[3],A},_t.inverse=function(A,D){return A[0]=1/D[0],A[1]=1/D[1],A[2]=1/D[2],A[3]=1/D[3],A},_t.normalize=function(A,D){var F=D[0],W=D[1],$=D[2],ie=D[3],re=F*F+W*W+$*$+ie*ie;return re>0&&(re=1/Math.sqrt(re)),A[0]=F*re,A[1]=W*re,A[2]=$*re,A[3]=ie*re,A},_t.dot=function(A,D){return A[0]*D[0]+A[1]*D[1]+A[2]*D[2]+A[3]*D[3]},_t.cross=function(A,D,F,W){var $=F[0]*W[1]-F[1]*W[0],ie=F[0]*W[2]-F[2]*W[0],re=F[0]*W[3]-F[3]*W[0],ee=F[1]*W[2]-F[2]*W[1],ae=F[1]*W[3]-F[3]*W[1],de=F[2]*W[3]-F[3]*W[2],ye=D[0],De=D[1],Ie=D[2],Re=D[3];return A[0]=De*de-Ie*ae+Re*ee,A[1]=-ye*de+Ie*re-Re*ie,A[2]=ye*ae-De*re+Re*$,A[3]=-ye*ee+De*ie-Ie*$,A},_t.lerp=function(A,D,F,W){var $=D[0],ie=D[1],re=D[2],ee=D[3];return A[0]=$+W*(F[0]-$),A[1]=ie+W*(F[1]-ie),A[2]=re+W*(F[2]-re),A[3]=ee+W*(F[3]-ee),A},_t.random=function(A,D){var F,W,$,ie,re,ee;D=D||1;do re=(F=2*n.RANDOM()-1)*F+(W=2*n.RANDOM()-1)*W;while(re>=1);do ee=($=2*n.RANDOM()-1)*$+(ie=2*n.RANDOM()-1)*ie;while(ee>=1);var ae=Math.sqrt((1-re)/ee);return A[0]=D*F,A[1]=D*W,A[2]=D*$*ae,A[3]=D*ie*ae,A},_t.transformMat4=function(A,D,F){var W=D[0],$=D[1],ie=D[2],re=D[3];return A[0]=F[0]*W+F[4]*$+F[8]*ie+F[12]*re,A[1]=F[1]*W+F[5]*$+F[9]*ie+F[13]*re,A[2]=F[2]*W+F[6]*$+F[10]*ie+F[14]*re,A[3]=F[3]*W+F[7]*$+F[11]*ie+F[15]*re,A},_t.transformQuat=function(A,D,F){var W=D[0],$=D[1],ie=D[2],re=F[0],ee=F[1],ae=F[2],de=F[3],ye=de*W+ee*ie-ae*$,De=de*$+ae*W-re*ie,Ie=de*ie+re*$-ee*W,Re=-re*W-ee*$-ae*ie;return A[0]=ye*de+Re*-re+De*-ae-Ie*-ee,A[1]=De*de+Re*-ee+Ie*-re-ye*-ae,A[2]=Ie*de+Re*-ae+ye*-ee-De*-re,A[3]=D[3],A},_t.zero=function(A){return A[0]=0,A[1]=0,A[2]=0,A[3]=0,A},_t.str=function(A){return"vec4("+A[0]+", "+A[1]+", "+A[2]+", "+A[3]+")"},_t.exactEquals=function(A,D){return A[0]===D[0]&&A[1]===D[1]&&A[2]===D[2]&&A[3]===D[3]},_t.equals=function(A,D){var F=A[0],W=A[1],$=A[2],ie=A[3],re=D[0],ee=D[1],ae=D[2],de=D[3];return Math.abs(F-re)<=n.EPSILON*Math.max(1,Math.abs(F),Math.abs(re))&&Math.abs(W-ee)<=n.EPSILON*Math.max(1,Math.abs(W),Math.abs(ee))&&Math.abs($-ae)<=n.EPSILON*Math.max(1,Math.abs($),Math.abs(ae))&&Math.abs(ie-de)<=n.EPSILON*Math.max(1,Math.abs(ie),Math.abs(de))},_t.forEach=_t.sqrLen=_t.len=_t.sqrDist=_t.dist=_t.div=_t.mul=_t.sub=void 0;var n=function(A,D){if(A&&A.__esModule)return A;if(A===null||l(A)!=="object"&&typeof A!="function")return{default:A};var F=o(void 0);if(F&&F.has(A))return F.get(A);var W={},$=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ie in A)if(ie!=="default"&&Object.prototype.hasOwnProperty.call(A,ie)){var re=$?Object.getOwnPropertyDescriptor(A,ie):null;re&&(re.get||re.set)?Object.defineProperty(W,ie,re):W[ie]=A[ie]}return W.default=A,F&&F.set(A,W),W}(H());function o(A){if(typeof WeakMap!="function")return null;var D=new WeakMap,F=new WeakMap;return(o=function(W){return W?F:D})(A)}function u(){var A=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0,A[3]=0),A}function g(A,D,F){return A[0]=D[0]-F[0],A[1]=D[1]-F[1],A[2]=D[2]-F[2],A[3]=D[3]-F[3],A}function d(A,D,F){return A[0]=D[0]*F[0],A[1]=D[1]*F[1],A[2]=D[2]*F[2],A[3]=D[3]*F[3],A}function v(A,D,F){return A[0]=D[0]/F[0],A[1]=D[1]/F[1],A[2]=D[2]/F[2],A[3]=D[3]/F[3],A}function E(A,D){return Math.hypot(D[0]-A[0],D[1]-A[1],D[2]-A[2],D[3]-A[3])}function C(A,D){var F=D[0]-A[0],W=D[1]-A[1],$=D[2]-A[2],ie=D[3]-A[3];return F*F+W*W+$*$+ie*ie}function z(A){return Math.hypot(A[0],A[1],A[2],A[3])}function w(A){var D=A[0],F=A[1],W=A[2],$=A[3];return D*D+F*F+W*W+$*$}_t.sub=g,_t.mul=d,_t.div=v,_t.dist=E,_t.sqrDist=C,_t.len=z,_t.sqrLen=w;var R,L=(R=u(),function(A,D,F,W,$,ie){var re,ee;for(D||(D=4),F||(F=0),ee=W?Math.min(W*D+F,A.length):A.length,re=F;re<ee;re+=D)R[0]=A[re],R[1]=A[re+1],R[2]=A[re+2],R[3]=A[re+3],$(R,R,ie),A[re]=R[0],A[re+1]=R[1],A[re+2]=R[2],A[re+3]=R[3];return A});return _t.forEach=L,_t}function Lt(){if(Tt)return xe;function l(Oe){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Ye){return typeof Ye}:function(Ye){return Ye&&typeof Symbol=="function"&&Ye.constructor===Symbol&&Ye!==Symbol.prototype?"symbol":typeof Ye},l(Oe)}Tt=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.create=E,xe.identity=function(Oe){return Oe[0]=0,Oe[1]=0,Oe[2]=0,Oe[3]=1,Oe},xe.setAxisAngle=C,xe.getAxisAngle=function(Oe,Ye){var tt=2*Math.acos(Ye[3]),Je=Math.sin(tt/2);return Je>n.EPSILON?(Oe[0]=Ye[0]/Je,Oe[1]=Ye[1]/Je,Oe[2]=Ye[2]/Je):(Oe[0]=1,Oe[1]=0,Oe[2]=0),tt},xe.getAngle=function(Oe,Ye){var tt=F(Oe,Ye);return Math.acos(2*tt*tt-1)},xe.multiply=z,xe.rotateX=function(Oe,Ye,tt){tt*=.5;var Je=Ye[0],rt=Ye[1],ct=Ye[2],yt=Ye[3],st=Math.sin(tt),Bt=Math.cos(tt);return Oe[0]=Je*Bt+yt*st,Oe[1]=rt*Bt+ct*st,Oe[2]=ct*Bt-rt*st,Oe[3]=yt*Bt-Je*st,Oe},xe.rotateY=function(Oe,Ye,tt){tt*=.5;var Je=Ye[0],rt=Ye[1],ct=Ye[2],yt=Ye[3],st=Math.sin(tt),Bt=Math.cos(tt);return Oe[0]=Je*Bt-ct*st,Oe[1]=rt*Bt+yt*st,Oe[2]=ct*Bt+Je*st,Oe[3]=yt*Bt-rt*st,Oe},xe.rotateZ=function(Oe,Ye,tt){tt*=.5;var Je=Ye[0],rt=Ye[1],ct=Ye[2],yt=Ye[3],st=Math.sin(tt),Bt=Math.cos(tt);return Oe[0]=Je*Bt+rt*st,Oe[1]=rt*Bt-Je*st,Oe[2]=ct*Bt+yt*st,Oe[3]=yt*Bt-ct*st,Oe},xe.calculateW=function(Oe,Ye){var tt=Ye[0],Je=Ye[1],rt=Ye[2];return Oe[0]=tt,Oe[1]=Je,Oe[2]=rt,Oe[3]=Math.sqrt(Math.abs(1-tt*tt-Je*Je-rt*rt)),Oe},xe.exp=w,xe.ln=R,xe.pow=function(Oe,Ye,tt){return R(Oe,Ye),D(Oe,Oe,tt),w(Oe,Oe),Oe},xe.slerp=L,xe.random=function(Oe){var Ye=n.RANDOM(),tt=n.RANDOM(),Je=n.RANDOM(),rt=Math.sqrt(1-Ye),ct=Math.sqrt(Ye);return Oe[0]=rt*Math.sin(2*Math.PI*tt),Oe[1]=rt*Math.cos(2*Math.PI*tt),Oe[2]=ct*Math.sin(2*Math.PI*Je),Oe[3]=ct*Math.cos(2*Math.PI*Je),Oe},xe.invert=function(Oe,Ye){var tt=Ye[0],Je=Ye[1],rt=Ye[2],ct=Ye[3],yt=tt*tt+Je*Je+rt*rt+ct*ct,st=yt?1/yt:0;return Oe[0]=-tt*st,Oe[1]=-Je*st,Oe[2]=-rt*st,Oe[3]=ct*st,Oe},xe.conjugate=function(Oe,Ye){return Oe[0]=-Ye[0],Oe[1]=-Ye[1],Oe[2]=-Ye[2],Oe[3]=Ye[3],Oe},xe.fromMat3=A,xe.fromEuler=function(Oe,Ye,tt,Je){var rt=.5*Math.PI/180;Ye*=rt,tt*=rt,Je*=rt;var ct=Math.sin(Ye),yt=Math.cos(Ye),st=Math.sin(tt),Bt=Math.cos(tt),Qt=Math.sin(Je),Nt=Math.cos(Je);return Oe[0]=ct*Bt*Nt-yt*st*Qt,Oe[1]=yt*st*Nt+ct*Bt*Qt,Oe[2]=yt*Bt*Qt-ct*st*Nt,Oe[3]=yt*Bt*Nt+ct*st*Qt,Oe},xe.str=function(Oe){return"quat("+Oe[0]+", "+Oe[1]+", "+Oe[2]+", "+Oe[3]+")"},xe.setAxes=xe.sqlerp=xe.rotationTo=xe.equals=xe.exactEquals=xe.normalize=xe.sqrLen=xe.squaredLength=xe.len=xe.length=xe.lerp=xe.dot=xe.scale=xe.mul=xe.add=xe.set=xe.copy=xe.fromValues=xe.clone=void 0;var n=v(H()),o=v(Ae()),u=v(Ct()),g=v(et());function d(Oe){if(typeof WeakMap!="function")return null;var Ye=new WeakMap,tt=new WeakMap;return(d=function(Je){return Je?tt:Ye})(Oe)}function v(Oe,Ye){if(Oe&&Oe.__esModule)return Oe;if(Oe===null||l(Oe)!=="object"&&typeof Oe!="function")return{default:Oe};var tt=d(Ye);if(tt&&tt.has(Oe))return tt.get(Oe);var Je={},rt=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ct in Oe)if(ct!=="default"&&Object.prototype.hasOwnProperty.call(Oe,ct)){var yt=rt?Object.getOwnPropertyDescriptor(Oe,ct):null;yt&&(yt.get||yt.set)?Object.defineProperty(Je,ct,yt):Je[ct]=Oe[ct]}return Je.default=Oe,tt&&tt.set(Oe,Je),Je}function E(){var Oe=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(Oe[0]=0,Oe[1]=0,Oe[2]=0),Oe[3]=1,Oe}function C(Oe,Ye,tt){tt*=.5;var Je=Math.sin(tt);return Oe[0]=Je*Ye[0],Oe[1]=Je*Ye[1],Oe[2]=Je*Ye[2],Oe[3]=Math.cos(tt),Oe}function z(Oe,Ye,tt){var Je=Ye[0],rt=Ye[1],ct=Ye[2],yt=Ye[3],st=tt[0],Bt=tt[1],Qt=tt[2],Nt=tt[3];return Oe[0]=Je*Nt+yt*st+rt*Qt-ct*Bt,Oe[1]=rt*Nt+yt*Bt+ct*st-Je*Qt,Oe[2]=ct*Nt+yt*Qt+Je*Bt-rt*st,Oe[3]=yt*Nt-Je*st-rt*Bt-ct*Qt,Oe}function w(Oe,Ye){var tt=Ye[0],Je=Ye[1],rt=Ye[2],ct=Ye[3],yt=Math.sqrt(tt*tt+Je*Je+rt*rt),st=Math.exp(ct),Bt=yt>0?st*Math.sin(yt)/yt:0;return Oe[0]=tt*Bt,Oe[1]=Je*Bt,Oe[2]=rt*Bt,Oe[3]=st*Math.cos(yt),Oe}function R(Oe,Ye){var tt=Ye[0],Je=Ye[1],rt=Ye[2],ct=Ye[3],yt=Math.sqrt(tt*tt+Je*Je+rt*rt),st=yt>0?Math.atan2(yt,ct)/yt:0;return Oe[0]=tt*st,Oe[1]=Je*st,Oe[2]=rt*st,Oe[3]=.5*Math.log(tt*tt+Je*Je+rt*rt+ct*ct),Oe}function L(Oe,Ye,tt,Je){var rt,ct,yt,st,Bt,Qt=Ye[0],Nt=Ye[1],An=Ye[2],xn=Ye[3],cn=tt[0],nn=tt[1],Hn=tt[2],In=tt[3];return(ct=Qt*cn+Nt*nn+An*Hn+xn*In)<0&&(ct=-ct,cn=-cn,nn=-nn,Hn=-Hn,In=-In),1-ct>n.EPSILON?(rt=Math.acos(ct),yt=Math.sin(rt),st=Math.sin((1-Je)*rt)/yt,Bt=Math.sin(Je*rt)/yt):(st=1-Je,Bt=Je),Oe[0]=st*Qt+Bt*cn,Oe[1]=st*Nt+Bt*nn,Oe[2]=st*An+Bt*Hn,Oe[3]=st*xn+Bt*In,Oe}function A(Oe,Ye){var tt,Je=Ye[0]+Ye[4]+Ye[8];if(Je>0)tt=Math.sqrt(Je+1),Oe[3]=.5*tt,Oe[0]=(Ye[5]-Ye[7])*(tt=.5/tt),Oe[1]=(Ye[6]-Ye[2])*tt,Oe[2]=(Ye[1]-Ye[3])*tt;else{var rt=0;Ye[4]>Ye[0]&&(rt=1),Ye[8]>Ye[3*rt+rt]&&(rt=2);var ct=(rt+1)%3,yt=(rt+2)%3;tt=Math.sqrt(Ye[3*rt+rt]-Ye[3*ct+ct]-Ye[3*yt+yt]+1),Oe[rt]=.5*tt,Oe[3]=(Ye[3*ct+yt]-Ye[3*yt+ct])*(tt=.5/tt),Oe[ct]=(Ye[3*ct+rt]+Ye[3*rt+ct])*tt,Oe[yt]=(Ye[3*yt+rt]+Ye[3*rt+yt])*tt}return Oe}xe.clone=g.clone,xe.fromValues=g.fromValues,xe.copy=g.copy,xe.set=g.set,xe.add=g.add,xe.mul=z;var D=g.scale;xe.scale=D;var F=g.dot;xe.dot=F,xe.lerp=g.lerp;var W=g.length;xe.length=W,xe.len=W;var $=g.squaredLength;xe.squaredLength=$,xe.sqrLen=$;var ie=g.normalize;xe.normalize=ie,xe.exactEquals=g.exactEquals,xe.equals=g.equals;var re,ee,ae,de=(re=u.create(),ee=u.fromValues(1,0,0),ae=u.fromValues(0,1,0),function(Oe,Ye,tt){var Je=u.dot(Ye,tt);return Je<-.999999?(u.cross(re,ee,Ye),u.len(re)<1e-6&&u.cross(re,ae,Ye),u.normalize(re,re),C(Oe,re,Math.PI),Oe):Je>.999999?(Oe[0]=0,Oe[1]=0,Oe[2]=0,Oe[3]=1,Oe):(u.cross(re,Ye,tt),Oe[0]=re[0],Oe[1]=re[1],Oe[2]=re[2],Oe[3]=1+Je,ie(Oe,Oe))});xe.rotationTo=de;var ye,De,Ie=(ye=E(),De=E(),function(Oe,Ye,tt,Je,rt,ct){return L(ye,Ye,rt,ct),L(De,tt,Je,ct),L(Oe,ye,De,2*ct*(1-ct)),Oe});xe.sqlerp=Ie;var Re,$e=(Re=o.create(),function(Oe,Ye,tt,Je){return Re[0]=tt[0],Re[3]=tt[1],Re[6]=tt[2],Re[1]=Je[0],Re[4]=Je[1],Re[7]=Je[2],Re[2]=-Ye[0],Re[5]=-Ye[1],Re[8]=-Ye[2],ie(Oe,A(Oe,Re))});return xe.setAxes=$e,xe}var lt,ut={};function Xe(){if(lt)return ut;function l(L){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},l(L)}lt=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.create=function(){var L=new n.ARRAY_TYPE(8);return n.ARRAY_TYPE!=Float32Array&&(L[0]=0,L[1]=0,L[2]=0,L[4]=0,L[5]=0,L[6]=0,L[7]=0),L[3]=1,L},ut.clone=function(L){var A=new n.ARRAY_TYPE(8);return A[0]=L[0],A[1]=L[1],A[2]=L[2],A[3]=L[3],A[4]=L[4],A[5]=L[5],A[6]=L[6],A[7]=L[7],A},ut.fromValues=function(L,A,D,F,W,$,ie,re){var ee=new n.ARRAY_TYPE(8);return ee[0]=L,ee[1]=A,ee[2]=D,ee[3]=F,ee[4]=W,ee[5]=$,ee[6]=ie,ee[7]=re,ee},ut.fromRotationTranslationValues=function(L,A,D,F,W,$,ie){var re=new n.ARRAY_TYPE(8);re[0]=L,re[1]=A,re[2]=D,re[3]=F;var ee=.5*W,ae=.5*$,de=.5*ie;return re[4]=ee*F+ae*D-de*A,re[5]=ae*F+de*L-ee*D,re[6]=de*F+ee*A-ae*L,re[7]=-ee*L-ae*A-de*D,re},ut.fromRotationTranslation=v,ut.fromTranslation=function(L,A){return L[0]=0,L[1]=0,L[2]=0,L[3]=1,L[4]=.5*A[0],L[5]=.5*A[1],L[6]=.5*A[2],L[7]=0,L},ut.fromRotation=function(L,A){return L[0]=A[0],L[1]=A[1],L[2]=A[2],L[3]=A[3],L[4]=0,L[5]=0,L[6]=0,L[7]=0,L},ut.fromMat4=function(L,A){var D=o.create();u.getRotation(D,A);var F=new n.ARRAY_TYPE(3);return u.getTranslation(F,A),v(L,D,F),L},ut.copy=E,ut.identity=function(L){return L[0]=0,L[1]=0,L[2]=0,L[3]=1,L[4]=0,L[5]=0,L[6]=0,L[7]=0,L},ut.set=function(L,A,D,F,W,$,ie,re,ee){return L[0]=A,L[1]=D,L[2]=F,L[3]=W,L[4]=$,L[5]=ie,L[6]=re,L[7]=ee,L},ut.getDual=function(L,A){return L[0]=A[4],L[1]=A[5],L[2]=A[6],L[3]=A[7],L},ut.setDual=function(L,A){return L[4]=A[0],L[5]=A[1],L[6]=A[2],L[7]=A[3],L},ut.getTranslation=function(L,A){var D=A[4],F=A[5],W=A[6],$=A[7],ie=-A[0],re=-A[1],ee=-A[2],ae=A[3];return L[0]=2*(D*ae+$*ie+F*ee-W*re),L[1]=2*(F*ae+$*re+W*ie-D*ee),L[2]=2*(W*ae+$*ee+D*re-F*ie),L},ut.translate=function(L,A,D){var F=A[0],W=A[1],$=A[2],ie=A[3],re=.5*D[0],ee=.5*D[1],ae=.5*D[2],de=A[4],ye=A[5],De=A[6],Ie=A[7];return L[0]=F,L[1]=W,L[2]=$,L[3]=ie,L[4]=ie*re+W*ae-$*ee+de,L[5]=ie*ee+$*re-F*ae+ye,L[6]=ie*ae+F*ee-W*re+De,L[7]=-F*re-W*ee-$*ae+Ie,L},ut.rotateX=function(L,A,D){var F=-A[0],W=-A[1],$=-A[2],ie=A[3],re=A[4],ee=A[5],ae=A[6],de=A[7],ye=re*ie+de*F+ee*$-ae*W,De=ee*ie+de*W+ae*F-re*$,Ie=ae*ie+de*$+re*W-ee*F,Re=de*ie-re*F-ee*W-ae*$;return o.rotateX(L,A,D),L[4]=ye*(ie=L[3])+Re*(F=L[0])+De*($=L[2])-Ie*(W=L[1]),L[5]=De*ie+Re*W+Ie*F-ye*$,L[6]=Ie*ie+Re*$+ye*W-De*F,L[7]=Re*ie-ye*F-De*W-Ie*$,L},ut.rotateY=function(L,A,D){var F=-A[0],W=-A[1],$=-A[2],ie=A[3],re=A[4],ee=A[5],ae=A[6],de=A[7],ye=re*ie+de*F+ee*$-ae*W,De=ee*ie+de*W+ae*F-re*$,Ie=ae*ie+de*$+re*W-ee*F,Re=de*ie-re*F-ee*W-ae*$;return o.rotateY(L,A,D),L[4]=ye*(ie=L[3])+Re*(F=L[0])+De*($=L[2])-Ie*(W=L[1]),L[5]=De*ie+Re*W+Ie*F-ye*$,L[6]=Ie*ie+Re*$+ye*W-De*F,L[7]=Re*ie-ye*F-De*W-Ie*$,L},ut.rotateZ=function(L,A,D){var F=-A[0],W=-A[1],$=-A[2],ie=A[3],re=A[4],ee=A[5],ae=A[6],de=A[7],ye=re*ie+de*F+ee*$-ae*W,De=ee*ie+de*W+ae*F-re*$,Ie=ae*ie+de*$+re*W-ee*F,Re=de*ie-re*F-ee*W-ae*$;return o.rotateZ(L,A,D),L[4]=ye*(ie=L[3])+Re*(F=L[0])+De*($=L[2])-Ie*(W=L[1]),L[5]=De*ie+Re*W+Ie*F-ye*$,L[6]=Ie*ie+Re*$+ye*W-De*F,L[7]=Re*ie-ye*F-De*W-Ie*$,L},ut.rotateByQuatAppend=function(L,A,D){var F=D[0],W=D[1],$=D[2],ie=D[3],re=A[0],ee=A[1],ae=A[2],de=A[3];return L[0]=re*ie+de*F+ee*$-ae*W,L[1]=ee*ie+de*W+ae*F-re*$,L[2]=ae*ie+de*$+re*W-ee*F,L[3]=de*ie-re*F-ee*W-ae*$,L[4]=(re=A[4])*ie+(de=A[7])*F+(ee=A[5])*$-(ae=A[6])*W,L[5]=ee*ie+de*W+ae*F-re*$,L[6]=ae*ie+de*$+re*W-ee*F,L[7]=de*ie-re*F-ee*W-ae*$,L},ut.rotateByQuatPrepend=function(L,A,D){var F=A[0],W=A[1],$=A[2],ie=A[3],re=D[0],ee=D[1],ae=D[2],de=D[3];return L[0]=F*de+ie*re+W*ae-$*ee,L[1]=W*de+ie*ee+$*re-F*ae,L[2]=$*de+ie*ae+F*ee-W*re,L[3]=ie*de-F*re-W*ee-$*ae,L[4]=F*(de=D[7])+ie*(re=D[4])+W*(ae=D[6])-$*(ee=D[5]),L[5]=W*de+ie*ee+$*re-F*ae,L[6]=$*de+ie*ae+F*ee-W*re,L[7]=ie*de-F*re-W*ee-$*ae,L},ut.rotateAroundAxis=function(L,A,D,F){if(Math.abs(F)<n.EPSILON)return E(L,A);var W=Math.hypot(D[0],D[1],D[2]);F*=.5;var $=Math.sin(F),ie=$*D[0]/W,re=$*D[1]/W,ee=$*D[2]/W,ae=Math.cos(F),de=A[0],ye=A[1],De=A[2],Ie=A[3];L[0]=de*ae+Ie*ie+ye*ee-De*re,L[1]=ye*ae+Ie*re+De*ie-de*ee,L[2]=De*ae+Ie*ee+de*re-ye*ie,L[3]=Ie*ae-de*ie-ye*re-De*ee;var Re=A[4],$e=A[5],Oe=A[6],Ye=A[7];return L[4]=Re*ae+Ye*ie+$e*ee-Oe*re,L[5]=$e*ae+Ye*re+Oe*ie-Re*ee,L[6]=Oe*ae+Ye*ee+Re*re-$e*ie,L[7]=Ye*ae-Re*ie-$e*re-Oe*ee,L},ut.add=function(L,A,D){return L[0]=A[0]+D[0],L[1]=A[1]+D[1],L[2]=A[2]+D[2],L[3]=A[3]+D[3],L[4]=A[4]+D[4],L[5]=A[5]+D[5],L[6]=A[6]+D[6],L[7]=A[7]+D[7],L},ut.multiply=C,ut.scale=function(L,A,D){return L[0]=A[0]*D,L[1]=A[1]*D,L[2]=A[2]*D,L[3]=A[3]*D,L[4]=A[4]*D,L[5]=A[5]*D,L[6]=A[6]*D,L[7]=A[7]*D,L},ut.lerp=function(L,A,D,F){var W=1-F;return z(A,D)<0&&(F=-F),L[0]=A[0]*W+D[0]*F,L[1]=A[1]*W+D[1]*F,L[2]=A[2]*W+D[2]*F,L[3]=A[3]*W+D[3]*F,L[4]=A[4]*W+D[4]*F,L[5]=A[5]*W+D[5]*F,L[6]=A[6]*W+D[6]*F,L[7]=A[7]*W+D[7]*F,L},ut.invert=function(L,A){var D=R(A);return L[0]=-A[0]/D,L[1]=-A[1]/D,L[2]=-A[2]/D,L[3]=A[3]/D,L[4]=-A[4]/D,L[5]=-A[5]/D,L[6]=-A[6]/D,L[7]=A[7]/D,L},ut.conjugate=function(L,A){return L[0]=-A[0],L[1]=-A[1],L[2]=-A[2],L[3]=A[3],L[4]=-A[4],L[5]=-A[5],L[6]=-A[6],L[7]=A[7],L},ut.normalize=function(L,A){var D=R(A);if(D>0){D=Math.sqrt(D);var F=A[0]/D,W=A[1]/D,$=A[2]/D,ie=A[3]/D,re=A[4],ee=A[5],ae=A[6],de=A[7],ye=F*re+W*ee+$*ae+ie*de;L[0]=F,L[1]=W,L[2]=$,L[3]=ie,L[4]=(re-F*ye)/D,L[5]=(ee-W*ye)/D,L[6]=(ae-$*ye)/D,L[7]=(de-ie*ye)/D}return L},ut.str=function(L){return"quat2("+L[0]+", "+L[1]+", "+L[2]+", "+L[3]+", "+L[4]+", "+L[5]+", "+L[6]+", "+L[7]+")"},ut.exactEquals=function(L,A){return L[0]===A[0]&&L[1]===A[1]&&L[2]===A[2]&&L[3]===A[3]&&L[4]===A[4]&&L[5]===A[5]&&L[6]===A[6]&&L[7]===A[7]},ut.equals=function(L,A){var D=L[0],F=L[1],W=L[2],$=L[3],ie=L[4],re=L[5],ee=L[6],ae=L[7],de=A[0],ye=A[1],De=A[2],Ie=A[3],Re=A[4],$e=A[5],Oe=A[6],Ye=A[7];return Math.abs(D-de)<=n.EPSILON*Math.max(1,Math.abs(D),Math.abs(de))&&Math.abs(F-ye)<=n.EPSILON*Math.max(1,Math.abs(F),Math.abs(ye))&&Math.abs(W-De)<=n.EPSILON*Math.max(1,Math.abs(W),Math.abs(De))&&Math.abs($-Ie)<=n.EPSILON*Math.max(1,Math.abs($),Math.abs(Ie))&&Math.abs(ie-Re)<=n.EPSILON*Math.max(1,Math.abs(ie),Math.abs(Re))&&Math.abs(re-$e)<=n.EPSILON*Math.max(1,Math.abs(re),Math.abs($e))&&Math.abs(ee-Oe)<=n.EPSILON*Math.max(1,Math.abs(ee),Math.abs(Oe))&&Math.abs(ae-Ye)<=n.EPSILON*Math.max(1,Math.abs(ae),Math.abs(Ye))},ut.sqrLen=ut.squaredLength=ut.len=ut.length=ut.dot=ut.mul=ut.setReal=ut.getReal=void 0;var n=d(H()),o=d(Lt()),u=d(Ve());function g(L){if(typeof WeakMap!="function")return null;var A=new WeakMap,D=new WeakMap;return(g=function(F){return F?D:A})(L)}function d(L,A){if(L&&L.__esModule)return L;if(L===null||l(L)!=="object"&&typeof L!="function")return{default:L};var D=g(A);if(D&&D.has(L))return D.get(L);var F={},W=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var $ in L)if($!=="default"&&Object.prototype.hasOwnProperty.call(L,$)){var ie=W?Object.getOwnPropertyDescriptor(L,$):null;ie&&(ie.get||ie.set)?Object.defineProperty(F,$,ie):F[$]=L[$]}return F.default=L,D&&D.set(L,F),F}function v(L,A,D){var F=.5*D[0],W=.5*D[1],$=.5*D[2],ie=A[0],re=A[1],ee=A[2],ae=A[3];return L[0]=ie,L[1]=re,L[2]=ee,L[3]=ae,L[4]=F*ae+W*ee-$*re,L[5]=W*ae+$*ie-F*ee,L[6]=$*ae+F*re-W*ie,L[7]=-F*ie-W*re-$*ee,L}function E(L,A){return L[0]=A[0],L[1]=A[1],L[2]=A[2],L[3]=A[3],L[4]=A[4],L[5]=A[5],L[6]=A[6],L[7]=A[7],L}function C(L,A,D){var F=A[0],W=A[1],$=A[2],ie=A[3],re=D[4],ee=D[5],ae=D[6],de=D[7],ye=A[4],De=A[5],Ie=A[6],Re=A[7],$e=D[0],Oe=D[1],Ye=D[2],tt=D[3];return L[0]=F*tt+ie*$e+W*Ye-$*Oe,L[1]=W*tt+ie*Oe+$*$e-F*Ye,L[2]=$*tt+ie*Ye+F*Oe-W*$e,L[3]=ie*tt-F*$e-W*Oe-$*Ye,L[4]=F*de+ie*re+W*ae-$*ee+ye*tt+Re*$e+De*Ye-Ie*Oe,L[5]=W*de+ie*ee+$*re-F*ae+De*tt+Re*Oe+Ie*$e-ye*Ye,L[6]=$*de+ie*ae+F*ee-W*re+Ie*tt+Re*Ye+ye*Oe-De*$e,L[7]=ie*de-F*re-W*ee-$*ae+Re*tt-ye*$e-De*Oe-Ie*Ye,L}ut.getReal=o.copy,ut.setReal=o.copy,ut.mul=C;var z=o.dot;ut.dot=z;var w=o.length;ut.length=w,ut.len=w;var R=o.squaredLength;return ut.squaredLength=R,ut.sqrLen=R,ut}var kt,_n,Xt={};function It(){if(kt)return Xt;function l(A){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},l(A)}kt=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.create=u,Xt.clone=function(A){var D=new n.ARRAY_TYPE(2);return D[0]=A[0],D[1]=A[1],D},Xt.fromValues=function(A,D){var F=new n.ARRAY_TYPE(2);return F[0]=A,F[1]=D,F},Xt.copy=function(A,D){return A[0]=D[0],A[1]=D[1],A},Xt.set=function(A,D,F){return A[0]=D,A[1]=F,A},Xt.add=function(A,D,F){return A[0]=D[0]+F[0],A[1]=D[1]+F[1],A},Xt.subtract=g,Xt.multiply=d,Xt.divide=v,Xt.ceil=function(A,D){return A[0]=Math.ceil(D[0]),A[1]=Math.ceil(D[1]),A},Xt.floor=function(A,D){return A[0]=Math.floor(D[0]),A[1]=Math.floor(D[1]),A},Xt.min=function(A,D,F){return A[0]=Math.min(D[0],F[0]),A[1]=Math.min(D[1],F[1]),A},Xt.max=function(A,D,F){return A[0]=Math.max(D[0],F[0]),A[1]=Math.max(D[1],F[1]),A},Xt.round=function(A,D){return A[0]=Math.round(D[0]),A[1]=Math.round(D[1]),A},Xt.scale=function(A,D,F){return A[0]=D[0]*F,A[1]=D[1]*F,A},Xt.scaleAndAdd=function(A,D,F,W){return A[0]=D[0]+F[0]*W,A[1]=D[1]+F[1]*W,A},Xt.distance=E,Xt.squaredDistance=C,Xt.length=z,Xt.squaredLength=w,Xt.negate=function(A,D){return A[0]=-D[0],A[1]=-D[1],A},Xt.inverse=function(A,D){return A[0]=1/D[0],A[1]=1/D[1],A},Xt.normalize=function(A,D){var F=D[0],W=D[1],$=F*F+W*W;return $>0&&($=1/Math.sqrt($)),A[0]=D[0]*$,A[1]=D[1]*$,A},Xt.dot=function(A,D){return A[0]*D[0]+A[1]*D[1]},Xt.cross=function(A,D,F){var W=D[0]*F[1]-D[1]*F[0];return A[0]=A[1]=0,A[2]=W,A},Xt.lerp=function(A,D,F,W){var $=D[0],ie=D[1];return A[0]=$+W*(F[0]-$),A[1]=ie+W*(F[1]-ie),A},Xt.random=function(A,D){D=D||1;var F=2*n.RANDOM()*Math.PI;return A[0]=Math.cos(F)*D,A[1]=Math.sin(F)*D,A},Xt.transformMat2=function(A,D,F){var W=D[0],$=D[1];return A[0]=F[0]*W+F[2]*$,A[1]=F[1]*W+F[3]*$,A},Xt.transformMat2d=function(A,D,F){var W=D[0],$=D[1];return A[0]=F[0]*W+F[2]*$+F[4],A[1]=F[1]*W+F[3]*$+F[5],A},Xt.transformMat3=function(A,D,F){var W=D[0],$=D[1];return A[0]=F[0]*W+F[3]*$+F[6],A[1]=F[1]*W+F[4]*$+F[7],A},Xt.transformMat4=function(A,D,F){var W=D[0],$=D[1];return A[0]=F[0]*W+F[4]*$+F[12],A[1]=F[1]*W+F[5]*$+F[13],A},Xt.rotate=function(A,D,F,W){var $=D[0]-F[0],ie=D[1]-F[1],re=Math.sin(W),ee=Math.cos(W);return A[0]=$*ee-ie*re+F[0],A[1]=$*re+ie*ee+F[1],A},Xt.angle=function(A,D){var F=A[0],W=A[1],$=D[0],ie=D[1],re=Math.sqrt(F*F+W*W)*Math.sqrt($*$+ie*ie);return Math.acos(Math.min(Math.max(re&&(F*$+W*ie)/re,-1),1))},Xt.zero=function(A){return A[0]=0,A[1]=0,A},Xt.str=function(A){return"vec2("+A[0]+", "+A[1]+")"},Xt.exactEquals=function(A,D){return A[0]===D[0]&&A[1]===D[1]},Xt.equals=function(A,D){var F=A[0],W=A[1],$=D[0],ie=D[1];return Math.abs(F-$)<=n.EPSILON*Math.max(1,Math.abs(F),Math.abs($))&&Math.abs(W-ie)<=n.EPSILON*Math.max(1,Math.abs(W),Math.abs(ie))},Xt.forEach=Xt.sqrLen=Xt.sqrDist=Xt.dist=Xt.div=Xt.mul=Xt.sub=Xt.len=void 0;var n=function(A,D){if(A&&A.__esModule)return A;if(A===null||l(A)!=="object"&&typeof A!="function")return{default:A};var F=o(void 0);if(F&&F.has(A))return F.get(A);var W={},$=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ie in A)if(ie!=="default"&&Object.prototype.hasOwnProperty.call(A,ie)){var re=$?Object.getOwnPropertyDescriptor(A,ie):null;re&&(re.get||re.set)?Object.defineProperty(W,ie,re):W[ie]=A[ie]}return W.default=A,F&&F.set(A,W),W}(H());function o(A){if(typeof WeakMap!="function")return null;var D=new WeakMap,F=new WeakMap;return(o=function(W){return W?F:D})(A)}function u(){var A=new n.ARRAY_TYPE(2);return n.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0),A}function g(A,D,F){return A[0]=D[0]-F[0],A[1]=D[1]-F[1],A}function d(A,D,F){return A[0]=D[0]*F[0],A[1]=D[1]*F[1],A}function v(A,D,F){return A[0]=D[0]/F[0],A[1]=D[1]/F[1],A}function E(A,D){return Math.hypot(D[0]-A[0],D[1]-A[1])}function C(A,D){var F=D[0]-A[0],W=D[1]-A[1];return F*F+W*W}function z(A){return Math.hypot(A[0],A[1])}function w(A){var D=A[0],F=A[1];return D*D+F*F}Xt.len=z,Xt.sub=g,Xt.mul=d,Xt.div=v,Xt.dist=E,Xt.sqrDist=C,Xt.sqrLen=w;var R,L=(R=u(),function(A,D,F,W,$,ie){var re,ee;for(D||(D=2),F||(F=0),ee=W?Math.min(W*D+F,A.length):A.length,re=F;re<ee;re+=D)R[0]=A[re],R[1]=A[re+1],$(R,R,ie),A[re]=R[0],A[re+1]=R[1];return A});return Xt.forEach=L,Xt}function ln(){if(_n)return B;function l(A){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},l(A)}_n=1,Object.defineProperty(B,"__esModule",{value:!0}),B.vec4=B.vec3=B.vec2=B.quat2=B.quat=B.mat4=B.mat3=B.mat2d=B.mat2=B.glMatrix=void 0;var n=L(H());B.glMatrix=n;var o=L(Q());B.mat2=o;var u=L(oe());B.mat2d=u;var g=L(Ae());B.mat3=g;var d=L(Ve());B.mat4=d;var v=L(Lt());B.quat=v;var E=L(Xe());B.quat2=E;var C=L(It());B.vec2=C;var z=L(Ct());B.vec3=z;var w=L(et());function R(A){if(typeof WeakMap!="function")return null;var D=new WeakMap,F=new WeakMap;return(R=function(W){return W?F:D})(A)}function L(A,D){if(A&&A.__esModule)return A;if(A===null||l(A)!=="object"&&typeof A!="function")return{default:A};var F=R(D);if(F&&F.has(A))return F.get(A);var W={},$=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ie in A)if(ie!=="default"&&Object.prototype.hasOwnProperty.call(A,ie)){var re=$?Object.getOwnPropertyDescriptor(A,ie):null;re&&(re.get||re.set)?Object.defineProperty(W,ie,re):W[ie]=A[ie]}return W.default=A,F&&F.set(A,W),W}return B.vec4=w,B}var fn,$t,pn,jn,Pe=ln(),Gn=function(){if($t)return fn;function l(n,o,u,g){this.cx=3*n,this.bx=3*(u-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(g-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=o,this.p2x=u,this.p2y=g}return $t=1,fn=l,l.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,o){if(o===void 0&&(o=1e-6),n<0)return 0;if(n>1)return 1;for(var u=n,g=0;g<8;g++){var d=this.sampleCurveX(u)-n;if(Math.abs(d)<o)return u;var v=this.sampleCurveDerivativeX(u);if(Math.abs(v)<1e-6)break;u-=d/v}var E=0,C=1;for(u=n,g=0;g<20&&(d=this.sampleCurveX(u),!(Math.abs(d-n)<o));g++)n>d?E=u:C=u,u=.5*(C-E)+E;return u},solve:function(n,o){return this.sampleCurveY(this.solveCurveX(n,o))}},fn}(),vn=I(Gn);function qn(){if(jn)return pn;function l(n,o){this.x=n,this.y=o}return jn=1,pn=l,l.prototype={clone:function(){return new l(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,o){return this.clone()._rotateAround(n,o)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var o=n.x-this.x,u=n.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,o){return Math.atan2(this.x*o-this.y*n,this.x*n+this.y*o)},_matMult:function(n){var o=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=o,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var o=Math.cos(n),u=Math.sin(n),g=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=g,this},_rotateAround:function(n,o){var u=Math.cos(n),g=Math.sin(n),d=o.y+g*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-g*(this.y-o.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},l.convert=function(n){return n instanceof l?n:Array.isArray(n)?new l(n[0],n[1]):n},pn}var ke=I(qn());function Fi(l,n){if(Array.isArray(l)){if(!Array.isArray(n)||l.length!==n.length)return!1;for(let o=0;o<l.length;o++)if(!Fi(l[o],n[o]))return!1;return!0}if(typeof l=="object"&&l!==null&&n!==null){if(typeof n!="object"||Object.keys(l).length!==Object.keys(n).length)return!1;for(const o in l)if(!Fi(l[o],n[o]))return!1;return!0}return l===n}const di=Math.PI/180,bi=180/Math.PI;function Mn(l){return l*di}function wi(l){return l*bi}const ei=[[0,0],[1,0],[1,1],[0,1]];function ot(l){if(l<=0)return 0;if(l>=1)return 1;const n=l*l,o=n*l;return 4*(l<.5?o:3*(l-n)+o-.75)}function Ue(l,n,o,u){const g=new vn(l,n,o,u);return function(d){return g.solve(d)}}const Yt=Ue(.25,.1,.25,1);function gt(l,n,o){return Math.min(o,Math.max(n,l))}function Kt(l,n,o){return(o=gt((o-l)/(n-l),0,1))*o*(3-2*o)}function an(l,n,o){const u=o-n,g=((l-n)%u+u)%u+n;return g===n?o:g}function Xn(l,n,o){if(!l.length)return o(null,[]);let u=l.length;const g=new Array(l.length);let d=null;l.forEach((v,E)=>{n(v,(C,z)=>{C&&(d=C),g[E]=z,--u==0&&o(d,g)})})}function On(l,...n){for(const o of n)for(const u in o)l[u]=o[u];return l}let Jn=1;function Ni(){return Jn++}function Un(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function si(l,n){l.forEach(o=>{n[o]&&(n[o]=n[o].bind(n))})}function ci(l,n){return l.indexOf(n,l.length-n.length)!==-1}function _i(l,n,o){const u={};for(const g in l)u[g]=n.call(this,l[g],g,l);return u}function ui(l,n,o){const u={};for(const g in l)n.call(this,l[g],g,l)&&(u[g]=l[g]);return u}function Ai(l){return Array.isArray(l)?l.map(Ai):typeof l=="object"&&l?_i(l,Ai):l}const Si={};function Wn(l){Si[l]||(typeof console<"u"&&console.warn(l),Si[l]=!0)}function Ot(l,n,o){return(o.y-l.y)*(n.x-l.x)>(n.y-l.y)*(o.x-l.x)}function ai(l){let n=0;for(let o,u,g=0,d=l.length,v=d-1;g<d;v=g++)o=l[g],u=l[v],n+=(u.x-o.x)*(o.y+u.y);return n}function on([l,n,o]){const u=Mn(n+90),g=Mn(o);return{x:l*Math.cos(u)*Math.sin(g),y:l*Math.sin(u)*Math.sin(g),z:l*Math.cos(g),azimuthal:n,polar:o}}function wn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Kn(l){const n={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,u,g,d)=>{const v=g||d;return n[u]=!v||v.toLowerCase(),""}),n["max-age"]){const o=parseInt(n["max-age"],10);isNaN(o)?delete n["max-age"]:n["max-age"]=o}return n}let ti=null;function Vi(l,n){return[l[4*n],l[4*n+1],l[4*n+2],l[4*n+3]]}function Zr(l,n,o,u){for(;n<o;){const g=n+o>>1;l[g]<u?n=g+1:o=g}return n}function ga(l,n,o,u){for(;n<o;){const g=n+o>>1;l[g]<=u?n=g+1:o=g}return n}function Cr(l){return l>0?1/(1.001-l):1+l}function oo(l){return l>0?1-1/(1.001-l):-l}const Sr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Sr.API_URL)return null;try{const l=new URL(Sr.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function yc(l){return Sr.API_URL_REGEX.test(l)}function xc(l){return Sr.API_SPRITE_REGEX.test(l)}let $o,Sa,Xo,At,he,_e;function Te(){return $o==null&&($o=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),$o}const je={now:()=>At!==void 0?At:performance.now(),setNow(l){At=l},restoreNow(){At=void 0},frame(l){const n=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(l,n=0){const{width:o,height:u}=l;he||(he=document.createElement("canvas"));const g=he.getContext("2d",{willReadFrequently:!0});if(!g)throw new Error("failed to create canvas 2d context");return(o>he.width||u>he.height)&&(he.width=o,he.height=u),g.clearRect(-n,-n,o+2*n,u+2*n),g.drawImage(l,0,0,o,u),g.getImageData(-n,-n,o+2*n,u+2*n)},resolveURL:l=>(Sa||(Sa=document.createElement("a")),Sa.href=l,Sa.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Xo==null&&(Xo=window.matchMedia("(prefers-reduced-motion: reduce)")),Xo.matches)},hasCanvasFingerprintNoise(){if(_e!==void 0)return _e;if(!Te())return _e=!1,!1;const l=new OffscreenCanvas(85,1),n=l.getContext("2d",{willReadFrequently:!0});let o=0;for(let g=0;g<l.width;++g)n.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,n.fillRect(g,0,1,1);const u=n.getImageData(0,0,l.width,l.height);o=0;for(let g=0;g<u.data.length;++g)if(g%4!=3&&o++!==u.data[g])return _e=!0,!0;return _e=!1,!1}};function We(l,n){const o=l.indexOf("?");if(o<0)return`${l}?${new URLSearchParams(n).toString()}`;const u=new URLSearchParams(l.slice(o));for(const g in n)u.set(g,n[g]);return`${l.slice(0,o)}?${u.toString()}`}function Qe(l,n={persistentParams:[]}){const o=l.indexOf("?");if(o<0)return l;const u=new URLSearchParams,g=new URLSearchParams(l.slice(o));for(const v of n.persistentParams){const E=g.get(v);E&&u.set(v,E)}const d=u.toString();return`${l.slice(0,o)}${d.length>0?`?${d}`:""}`}const ft="mapbox-tiles";let nt=500,St=50;const wt=["language","worldview","jobid"];let Mt,we;function Ze(){try{return caches}catch{}}function at(){const l=Ze();l&&Mt==null&&(Mt=l.open(ft))}let vt=1/0;const ht={supported:!1,testSupport:function(l){!En&&Jt&&(Tn?$n(l):qt=l)}};let qt,Jt,En=!1,Tn=!1;const Bn=typeof self<"u"?self:{};function $n(l){const n=l.createTexture();l.bindTexture(l.TEXTURE_2D,n);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,Jt),l.isContextLost())return;ht.supported=!0}catch{}l.deleteTexture(n),En=!0}Bn.document&&(Jt=Bn.document.createElement("img"),Jt.onload=function(){qt&&$n(qt),qt=null,Tn=!0},Jt.onerror=function(){En=!0,qt=null},Jt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Vn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Vn);class Pi extends Error{constructor(n,o,u){o===401&&yc(u)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=o,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const or=wn()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,er=function(l,n){if(!(/^file:/.test(o=l.url)||/^file:/.test(or())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,g){const d=new AbortController,v=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:or(),referrerPolicy:u.referrerPolicy,signal:d.signal});let E=!1,C=!1;const z=(w=v.url).indexOf("sku=")>0&&yc(w);var w;u.type==="json"&&v.headers.set("Accept","application/json");const R=(A,D,F)=>{if(C)return;if(A&&A.message!=="SecurityError"&&Wn(A.toString()),D&&F)return L(D);const W=Date.now();fetch(v).then($=>{if($.ok){const ie=z?$.clone():null;return L($,ie,W)}return g(new Pi($.statusText,$.status,u.url))}).catch($=>{$.name!=="AbortError"&&g(new Error(`${$.message} ${u.url}`))})},L=(A,D,F)=>{(u.type==="arrayBuffer"?A.arrayBuffer():u.type==="json"?A.json():A.text()).then(W=>{C||(D&&F&&function($,ie,re){if(at(),Mt==null)return;const ee=Kn(ie.headers.get("Cache-Control")||"");if(ee["no-store"])return;const ae={status:ie.status,statusText:ie.statusText,headers:new Headers};ie.headers.forEach((De,Ie)=>ae.headers.set(Ie,De)),ee["max-age"]&&ae.headers.set("Expires",new Date(re+1e3*ee["max-age"]).toUTCString());const de=ae.headers.get("Expires");if(!de||new Date(de).getTime()-re<42e4)return;let ye=Qe($.url,{persistentParams:wt});if(ie.status===206){const De=$.headers.get("Range");if(!De)return;ae.status=200,ye=We(ye,{range:De})}(function(De,Ie){if(we===void 0)try{new Response(new ReadableStream),we=!0}catch{we=!1}we?Ie(De.body):De.blob().then(Ie)})(ie,De=>{const Ie=new Response((Re=ie.status)!==200&&Re!==404&&[101,103,204,205,304].includes(Re)?null:De,ae);var Re;at(),Mt!=null&&Mt.then($e=>$e.put(ye,Ie)).catch($e=>Wn($e.message))})}(v,D,F),E=!0,g(null,W,A.headers.get("Cache-Control"),A.headers.get("Expires")))}).catch(W=>{C||g(new Error(W.message))})};return z?function(A,D){if(at(),Mt==null)return D(null);Mt.then(F=>{let W=Qe(A.url,{persistentParams:wt});const $=A.headers.get("Range");$&&(W=We(W,{range:$})),F.match(W).then(ie=>{const re=function(ee){if(!ee)return!1;const ae=new Date(ee.headers.get("Expires")||0),de=Kn(ee.headers.get("Cache-Control")||"");return ae>Date.now()&&!de["no-cache"]}(ie);F.delete(W),re&&F.put(W,ie.clone()),D(null,ie,re)}).catch(D)}).catch(D)}(v,R):R(null,null),{cancel:()=>{C=!0,E||d.abort()}}}(l,n);if(wn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,n,void 0,!0)}var o;return function(u,g){const d=new XMLHttpRequest;d.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const v in u.headers)d.setRequestHeader(v,u.headers[v]);return u.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=u.credentials==="include",d.onerror=()=>{g(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let v=d.response;if(u.type==="json")try{v=JSON.parse(d.response)}catch(E){return g(E)}g(null,v,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else g(new Pi(d.statusText,d.status,u.url))},d.send(u.body),{cancel:()=>d.abort()}}(l,n)},qi=function(l,n){return er(On(l,{type:"arrayBuffer"}),n)};function Ci(l){const n=document.createElement("a");return n.href=l,n.protocol===location.protocol&&n.host===location.host}const Li="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ia,gr;ia=[],gr=0;const To=function(l,n){if(ht.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),gr>=Sr.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:l,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return ia.push(d),d}gr++;let o=!1;const u=()=>{if(!o)for(o=!0,gr--;ia.length&&gr<Sr.MAX_PARALLEL_IMAGE_REQUESTS;){const d=ia.shift(),{requestParameters:v,callback:E,cancelled:C}=d;C||(d.cancel=To(v,E).cancel)}},g=qi(l,(d,v,E,C)=>{u(),d?n(d):v&&(self.createImageBitmap?function(z,w){const R=new Blob([new Uint8Array(z)],{type:"image/png"});createImageBitmap(R).then(L=>{w(null,L)}).catch(L=>{w(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(z,w)=>n(z,w,E,C)):function(z,w){const R=new Image;R.onload=()=>{w(null,R),URL.revokeObjectURL(R.src),R.onload=null,requestAnimationFrame(()=>{R.src=Li})},R.onerror=()=>w(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new Blob([new Uint8Array(z)],{type:"image/png"});R.src=z.byteLength?URL.createObjectURL(L):Li}(v,(z,w)=>n(z,w,E,C)))});return{cancel:()=>{g.cancel(),u()}}};var ws,vo,Ua,cr={exports:{}},ua={exports:{}},_a={exports:{}},Vr=function(){if(Ua)return cr.exports;Ua=1;var l=(ws||(ws=1,ua.exports=function(o,u){var g,d,v,E,C,z,w,R;for(d=o.length-(g=3&o.length),v=u,C=3432918353,z=461845907,R=0;R<d;)w=255&o.charCodeAt(R)|(255&o.charCodeAt(++R))<<8|(255&o.charCodeAt(++R))<<16|(255&o.charCodeAt(++R))<<24,++R,v=27492+(65535&(E=5*(65535&(v=(v^=w=(65535&(w=(w=(65535&w)*C+(((w>>>16)*C&65535)<<16)&4294967295)<<15|w>>>17))*z+(((w>>>16)*z&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(w=0,g){case 3:w^=(255&o.charCodeAt(R+2))<<16;case 2:w^=(255&o.charCodeAt(R+1))<<8;case 1:v^=w=(65535&(w=(w=(65535&(w^=255&o.charCodeAt(R)))*C+(((w>>>16)*C&65535)<<16)&4294967295)<<15|w>>>17))*z+(((w>>>16)*z&65535)<<16)&4294967295}return v^=o.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0}),ua.exports),n=(vo||(vo=1,_a.exports=function(o,u){for(var g,d=o.length,v=u^d,E=0;d>=4;)g=1540483477*(65535&(g=255&o.charCodeAt(E)|(255&o.charCodeAt(++E))<<8|(255&o.charCodeAt(++E))<<16|(255&o.charCodeAt(++E))<<24))+((1540483477*(g>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),d-=4,++E;switch(d){case 3:v^=(255&o.charCodeAt(E+2))<<16;case 2:v^=(255&o.charCodeAt(E+1))<<8;case 1:v=1540483477*(65535&(v^=255&o.charCodeAt(E)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0}),_a.exports);return cr.exports=l,cr.exports.murmur3=l,cr.exports.murmur2=n,cr.exports}(),ra=I(Vr);class Oo{constructor(n,...o){On(this,o[0]||{}),this.type=n}}class yo extends Oo{constructor(n,o={}){super("error",On({error:n},o))}}function Fm(l,n,o){o[l]&&o[l].indexOf(n)!==-1||(o[l]=o[l]||[],o[l].push(n))}function kl(l,n,o){if(o&&o[l]){const u=o[l].indexOf(n);u!==-1&&o[l].splice(u,1)}}class Fl{on(n,o){return this._listeners=this._listeners||{},Fm(n,o,this._listeners),this}off(n,o){return kl(n,o,this._listeners),kl(n,o,this._oneTimeListeners),this}once(n,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Fm(n,o,this._oneTimeListeners),this):new Promise(u=>this.once(n,u))}fire(n,o){const u=typeof n=="string"?new Oo(n,o):n,g=u.type;if(this.listens(g)){u.target=this;const d=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(const C of d)C.call(this,u);const v=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(const C of v)kl(g,C,this._oneTimeListeners),C.call(this,u);const E=this._eventedParent;E&&(On(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),E.fire(u))}else u instanceof yo&&console.error(u.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,o){return this._eventedParent=n,this._eventedParentData=o,this}}var rp,Nm={},Ss=function(){if(rp)return Nm;rp=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(d){return(d=Math.round(d))<0?0:d>255?255:d}function o(d){return n(d[d.length-1]==="%"?parseFloat(d)/100*255:parseInt(d))}function u(d){return(v=d[d.length-1]==="%"?parseFloat(d)/100:parseFloat(d))<0?0:v>1?1:v;var v}function g(d,v,E){return E<0?E+=1:E>1&&(E-=1),6*E<1?d+(v-d)*E*6:2*E<1?v:3*E<2?d+(v-d)*(2/3-E)*6:d}try{Nm.parseCSSColor=function(d){var v,E=d.replace(/ /g,"").toLowerCase();if(E in l)return l[E].slice();if(E[0]==="#")return E.length===4?(v=parseInt(E.substr(1),16))>=0&&v<=4095?[(3840&v)>>4|(3840&v)>>8,240&v|(240&v)>>4,15&v|(15&v)<<4,1]:null:E.length===7&&(v=parseInt(E.substr(1),16))>=0&&v<=16777215?[(16711680&v)>>16,(65280&v)>>8,255&v,1]:null;var C=E.indexOf("("),z=E.indexOf(")");if(C!==-1&&z+1===E.length){var w=E.substr(0,C),R=E.substr(C+1,z-(C+1)).split(","),L=1;switch(w){case"rgba":if(R.length!==4)return null;L=u(R.pop());case"rgb":return R.length!==3?null:[o(R[0]),o(R[1]),o(R[2]),L];case"hsla":if(R.length!==4)return null;L=u(R.pop());case"hsl":if(R.length!==3)return null;var A=(parseFloat(R[0])%360+360)%360/360,D=u(R[1]),F=u(R[2]),W=F<=.5?F*(D+1):F+D-F*D,$=2*F-W;return[n(255*g($,W,A+1/3)),n(255*g($,W,A)),n(255*g($,W,A-1/3)),L];default:return null}}return null}}catch{}return Nm}();class tr{constructor(n,o,u,g=1){this.r=n,this.g=o,this.b=u,this.a=g}static parse(n){if(!n)return;if(n instanceof tr)return n;if(typeof n!="string")return;const o=Ss.parseCSSColor(n);return o?new tr(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toStringPremultipliedAlpha(){const[n,o,u,g]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(n)},${Math.round(o)},${Math.round(u)},${g})`}toString(){const[n,o,u,g]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*n)},${Math.round(255*o)},${Math.round(255*u)},${g})`}toRenderColor(n){const{r:o,g:u,b:g,a:d}=this;return new Dd(n,o,u,g,d)}clone(){return new tr(this.r,this.g,this.b,this.a)}}class Dd{constructor(n,o,u,g,d){if(n){const v=n.image.height,E=v*v;o=d===0?0:o/d*(v-1),u=d===0?0:u/d*(v-1),g=d===0?0:g/d*(v-1);const C=Math.floor(o),z=Math.floor(u),w=Math.floor(g),R=Math.ceil(o),L=Math.ceil(u),A=Math.ceil(g),D=o-C,F=u-z,W=g-w,$=n.image.data,ie=4*(C+z*E+w*v),re=4*(C+z*E+A*v),ee=4*(C+L*E+w*v),ae=4*(C+L*E+A*v),de=4*(R+z*E+w*v),ye=4*(R+z*E+A*v),De=4*(R+L*E+w*v),Ie=4*(R+L*E+A*v);if(ie<0||Ie>=$.length)throw new Error("out of range");this.r=oi(oi(oi($[ie],$[re],W),oi($[ee],$[ae],W),F),oi(oi($[de],$[ye],W),oi($[De],$[Ie],W),F),D)/255*d,this.g=oi(oi(oi($[ie+1],$[re+1],W),oi($[ee+1],$[ae+1],W),F),oi(oi($[de+1],$[ye+1],W),oi($[De+1],$[Ie+1],W),F),D)/255*d,this.b=oi(oi(oi($[ie+2],$[re+2],W),oi($[ee+2],$[ae+2],W),F),oi(oi($[de+2],$[ye+2],W),oi($[De+2],$[Ie+2],W),F),D)/255*d,this.a=d}else this.r=o,this.g=u,this.b=g,this.a=d}toArray(){const{r:n,g:o,b:u,a:g}=this;return g===0?[0,0,0,0]:[255*n/g,255*o/g,255*u/g,g]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:n,g:o,b:u,a:g}=this,d=Math.min(Math.max(n/g,0),1),v=Math.min(Math.max(o/g,0),1),E=Math.min(Math.max(u/g,0),1),C=Math.min(d,v,E),z=Math.max(d,v,E),w=(C+z)/2;if(C===z)return[0,0,100*w,g];const R=z-C,L=w>.5?R/(2-z-C):R/(z+C);let A=0;return z===d?A=(v-E)/R+(v<E?6:0):z===v?A=(E-d)/R+2:z===E&&(A=(d-v)/R+4),A*=60,[Math.min(Math.max(A,0),360),Math.min(Math.max(100*L,0),100),Math.min(Math.max(100*w,0),100),g]}toArray01(){const{r:n,g:o,b:u,a:g}=this;return g===0?[0,0,0,0]:[n/g,o/g,u/g,g]}toArray01Scaled(n){const{r:o,g:u,b:g,a:d}=this;return d===0?[0,0,0]:[o/d*n,u/d*n,g/d*n]}toArray01PremultipliedAlpha(){const{r:n,g:o,b:u,a:g}=this;return[n,o,u,g]}toArray01Linear(){const{r:n,g:o,b:u,a:g}=this;return g===0?[0,0,0,0]:[Math.pow(n/g,2.2),Math.pow(o/g,2.2),Math.pow(u/g,2.2),g]}}function oi(l,n,o){return l*(1-o)+n*o}function _u(l,n,o){return l.map((u,g)=>oi(u,n[g],o))}tr.black=new tr(0,0,0,1),tr.white=new tr(1,1,1,1),tr.transparent=new tr(0,0,0,0),tr.red=new tr(1,0,0,1),tr.blue=new tr(0,0,1,1);var Nl=Object.freeze({__proto__:null,array:_u,color:function(l,n,o){return new tr(oi(l.r,n.r,o),oi(l.g,n.g,o),oi(l.b,n.b,o),oi(l.a,n.a,o))},number:oi});function Pd(l,...n){for(const o of n)for(const u in o)l[u]=o[u];return l}class Bi extends Error{constructor(n,o){super(o),this.message=o,this.key=n}}class Ld{constructor(n,o=[]){this.parent=n,this.bindings={};for(const[u,g]of o)this.bindings[u]=g}concat(n){return new Ld(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const qs={kind:"null"},Nn={kind:"number"},ir={kind:"string"},Gi={kind:"boolean"},Wa={kind:"color"},Es={kind:"object"},nr={kind:"value"},bc={kind:"collator"},ls={kind:"formatted"},_h={kind:"resolvedImage"};function Fr(l,n){return{kind:"array",itemType:l,N:n}}function Nr(l){if(l.kind==="array"){const n=Nr(l.itemType);return typeof l.N=="number"?`array<${n}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${n}>`}return l.kind}const vh=[qs,Nn,ir,Gi,Wa,ls,Es,Fr(nr),_h];function $a(l,n){if(n.kind==="error")return null;if(l.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!$a(l.itemType,n.itemType))&&(typeof l.N!="number"||l.N===n.N))return null}else{if(l.kind===n.kind)return null;if(l.kind==="value"){for(const o of vh)if(!$a(o,n))return null}}return`Expected ${Nr(l)} but found ${Nr(n)} instead.`}function ap(l,n){return n.some(o=>o.kind===l.kind)}function vu(l,n){return n.some(o=>o==="null"?l===null:o==="array"?Array.isArray(l):o==="object"?l&&!Array.isArray(l)&&typeof l=="object":o===typeof l)}class yh{constructor(n,o,u){this.sensitivity=n?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,o){return this.collator.compare(n,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Bl{constructor(n,o,u,g,d){this.text=n.normalize?n.normalize():n,this.image=o,this.scale=u,this.fontStack=g,this.textColor=d}}class Va{constructor(n){this.sections=n}static fromString(n){return new Va([new Bl(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.namePrimary)}static factory(n){return n instanceof Va?n:Va.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const o of this.sections){if(o.image){n.push(["image",o.image.namePrimary]);continue}n.push(o.text);const u={};o.fontStack&&(u["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(u["font-scale"]=o.scale),o.textColor&&(u["text-color"]=["rgba"].concat(o.textColor.toRenderColor(null).toArray())),n.push(u)}return n}}class Ws{constructor(n,o){if(this.id=n,this.options=o||{params:{}},this.options.transform){const{a:u,b:g,c:d,d:v,e:E,f:C}=this.options.transform;this.options.transform=new DOMMatrix([u,g,d,v,E,C])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}static deserializeId(n){return JSON.parse(n).id}static deserializeFromString(n){const o=JSON.parse(n),{a:u,b:g,c:d,d:v,e:E,f:C}=o.options.transform;return new DOMMatrix([u,g,d,v,E,C]),new Ws(o.id,o.options)}scaleSelf(n){return this.options.transform=this.options.transform.scale(n),this}serialize(){const n={id:this.id};this.options&&(n.options=this.options);const{a:o,b:u,c:g,d,e:v,f:E}=this.options.transform;return n.options.transform={a:o,b:u,c:g,d,e:v,f:E},JSON.stringify(n)}}class so{constructor(n){this.namePrimary=n.namePrimary,n.nameSecondary&&(this.nameSecondary=n.nameSecondary),n.optionsPrimary&&(this.optionsPrimary=n.optionsPrimary),n.optionsSecondary&&(this.optionsSecondary=n.optionsSecondary),this.available=n.available}toString(){return this.namePrimary&&this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}getPrimary(){return new Ws(this.namePrimary,{params:this.optionsPrimary&&this.optionsPrimary.params||{}})}getSerializedPrimary(){return this.getPrimary().serialize()}getSecondary(){return this.nameSecondary?new Ws(this.nameSecondary,{params:this.optionsSecondary&&this.optionsSecondary.params||{}}):null}static from(n){return typeof n=="string"?so.build(n):n}static build(n,o,u,g){return n?new so({namePrimary:n,nameSecondary:o,optionsPrimary:u,optionsSecondary:g,available:!1}):null}}function Bm(l,n,o,u){return typeof l=="number"&&l>=0&&l<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof o=="number"&&o>=0&&o<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[l,n,o,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[l,n,o,u]:[l,n,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ul(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof tr||l instanceof yh||l instanceof Va||l instanceof so)return!0;if(Array.isArray(l)){for(const n of l)if(!Ul(n))return!1;return!0}if(typeof l=="object"){for(const n in l)if(!Ul(l[n]))return!1;return!0}return!1}function Yr(l){if(l===null)return qs;if(typeof l=="string")return ir;if(typeof l=="boolean")return Gi;if(typeof l=="number")return Nn;if(l instanceof tr)return Wa;if(l instanceof yh)return bc;if(l instanceof Va)return ls;if(l instanceof so)return _h;if(Array.isArray(l)){const n=l.length;let o;for(const u of l){const g=Yr(u);if(o){if(o===g)continue;o=nr;break}o=g}return Fr(o||nr,n)}return Es}function Ms(l){const n=typeof l;return l===null?"":n==="string"||n==="number"||n==="boolean"?String(l):l instanceof tr?l.toStringPremultipliedAlpha():l instanceof Va||l instanceof so?l.toString():JSON.stringify(l)}class Xa{constructor(n,o){this.type=n,this.value=o}static parse(n,o){if(n.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Ul(n[1]))return o.error("invalid value");const u=n[1];let g=Yr(u);const d=o.expectedType;return g.kind!=="array"||g.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(g=d),new Xa(g,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof tr?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Va?this.value.serialize():this.value}}class va{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const Od={string:ir,number:Nn,boolean:Gi,object:Es};class $s{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");let u,g=1;const d=n[0];if(d==="array"){let E,C;if(n.length>2){const z=n[1];if(typeof z!="string"||!(z in Od)||z==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);E=Od[z],g++}else E=nr;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return o.error('The length argument to "array" must be a positive integer literal',2);C=n[2],g++}u=Fr(E,C)}else u=Od[d];const v=[];for(;g<n.length;g++){const E=o.parse(n[g],g,nr);if(!E)return null;v.push(E)}return new $s(u,v)}evaluate(n){for(let o=0;o<this.args.length;o++){const u=this.args[o].evaluate(n);if(!$a(this.type,Yr(u)))return u;if(o===this.args.length-1)throw new va(`The expression ${JSON.stringify(this.args[o].serialize())} evaluated to ${Nr(Yr(u))} but was expected to be of type ${Nr(this.type)}.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,o=[n.kind];if(n.kind==="array"){const u=n.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);const g=n.N;(typeof g=="number"||this.args.length>1)&&o.push(g)}}return o.concat(this.args.map(u=>u.serialize()))}}class wc{constructor(n){this.type=ls,this.sections=n}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const u=n[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");const g=[];let d=!1;for(let v=1;v<=n.length-1;++v){const E=n[v];if(d&&typeof E=="object"&&!Array.isArray(E)){d=!1;let C=null;if(E["font-scale"]&&(C=o.parseObjectValue(E["font-scale"],v,"font-scale",Nn),!C))return null;let z=null;if(E["text-font"]&&(z=o.parseObjectValue(E["text-font"],v,"text-font",Fr(ir)),!z))return null;let w=null;if(E["text-color"]&&(w=o.parseObjectValue(E["text-color"],v,"text-color",Wa),!w))return null;const R=g[g.length-1];R.scale=C,R.font=z,R.textColor=w}else{const C=o.parse(n[v],v,nr);if(!C)return null;const z=C.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,g.push({content:C,scale:null,font:null,textColor:null})}}return new wc(g)}evaluate(n){return new Va(this.sections.map(o=>{const u=o.content.evaluate(n);return Yr(u)===_h?new Bl("",u,null,null,null):new Bl(Ms(u),null,o.scale?o.scale.evaluate(n):null,o.font?o.font.evaluate(n).join(","):null,o.textColor?o.textColor.evaluate(n):null)}))}eachChild(n){for(const o of this.sections)n(o.content),o.scale&&n(o.scale),o.font&&n(o.font),o.textColor&&n(o.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const o of this.sections){n.push(o.content.serialize());const u={};o.scale&&(u["font-scale"]=o.scale.serialize()),o.font&&(u["text-font"]=o.font.serialize()),o.textColor&&(u["text-color"]=o.textColor.serialize()),n.push(u)}return n}}class zd{constructor(n,o,u,g){this._imageWarnHistory={},this.type=_h,this.inputPrimary=n,this.inputSecondary=o,this.inputPrimaryParams=u,this.inputSecondaryParams=g}static parse(n,o){if(n.length<2)return o.error("Expected two or more arguments.");let u=1;const g=[];function d(){if(u<n.length){const E=o.parse(n[u],u++,ir);return E?(g.push({image:E,options:void 0}),!0):(o.error(g.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function v(){if(u<n.length){if((E=n[u])===null||typeof E!="object"||Array.isArray(E))return!0;const C=n[u].params,z=o.concat(u);if(!C)return u++,!0;if(typeof C!="object"||C.constructor!==Object)return z.error('Image options "params" should be an object'),!1;const w={},R=z.concat(void 0,"params");for(const L in C){if(!L)return R.error("Image parameter name should be non-empty"),!1;const A=R.concat(void 0,L).parse(C[L],void 0,Wa,void 0,{typeAnnotation:"coerce"});if(!A)return!1;w[L]=A}return g[g.length-1].options=w,u++,!0}var E;return!0}for(let E=0;E<2;E++)if(!d()||!v())return;return new zd(g[0].image,g[1]?g[1].image:void 0,g[0].options,g[1]?g[1].options:void 0)}evaluateParams(n,o){const u={};if(o){for(const g in o)if(o[g])try{const d=o[g].evaluate(n),v=`Ignoring image parameter "${g}" with semi-transparent color ${d.toString()}`;if(d.a!==1){this._imageWarnHistory[v]||(console.warn(v),this._imageWarnHistory[v]=!0);continue}u[g]=d}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(n){const o=so.build(this.inputPrimary.evaluate(n),this.inputSecondary?this.inputSecondary.evaluate(n):void 0,this.inputPrimaryParams?this.evaluateParams(n,this.inputPrimaryParams):void 0,this.inputSecondaryParams?this.evaluateParams(n,this.inputSecondaryParams):void 0);return o&&n.availableImages&&(o.available=n.availableImages.indexOf(o.namePrimary)>-1,o.nameSecondary&&o.available&&n.availableImages&&(o.available=n.availableImages.indexOf(o.nameSecondary)>-1)),o}eachChild(n){if(n(this.inputPrimary),this.inputPrimaryParams)for(const o in this.inputPrimaryParams)this.inputPrimaryParams[o]&&n(this.inputPrimaryParams[o]);if(this.inputSecondary&&(n(this.inputSecondary),this.inputSecondaryParams))for(const o in this.inputSecondaryParams)this.inputSecondaryParams[o]&&n(this.inputSecondaryParams[o])}outputDefined(){return!1}serializeParams(n){const o={};if(n){for(const u in n)n[u]&&(o[u]=n[u].serialize());return{params:o}}}serialize(){const n=["image",this.inputPrimary.serialize()];return this.inputPrimaryParams&&n.push(this.serializeParams(this.inputPrimaryParams)),this.inputSecondary&&(n.push(this.inputSecondary.serialize()),this.inputSecondaryParams&&n.push(this.serializeParams(this.inputSecondaryParams))),n}}function Xs(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}const Um={"to-boolean":Gi,"to-color":Wa,"to-number":Nn,"to-string":ir};class Vl{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const u=n[0],g=[];let d=qs;if(u==="to-array"){if(!Array.isArray(n[1]))return null;const v=n[1].length;if(o.expectedType){if(o.expectedType.kind!=="array")return o.error(`Expected ${o.expectedType.kind} but found array.`);d=Fr(o.expectedType.itemType,v)}else{if(!(v>0&&Ul(n[1][0])))return null;d=Fr(Yr(n[1][0]),v)}for(let E=0;E<v;E++){const C=n[1][E];let z;if(Xs(C)==="array")z=o.parse(C,void 0,d.itemType);else{const w=Xs(C);if(w!==d.itemType.kind)return o.error(`Expected ${d.itemType.kind} but found ${w}.`);z=o.registry.literal.parse(["literal",C===void 0?null:C],o)}if(!z)return null;g.push(z)}}else{if((u==="to-boolean"||u==="to-string")&&n.length!==2)return o.error("Expected one argument.");d=Um[u];for(let v=1;v<n.length;v++){const E=o.parse(n[v],v,nr);if(!E)return null;g.push(E)}}return new Vl(d,g)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let o,u;for(const g of this.args){if(o=g.evaluate(n),u=null,o instanceof tr)return o;if(typeof o=="string"){const d=n.parseColor(o);if(d)return d}else if(Array.isArray(o)&&(u=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Bm(o[0],o[1],o[2],o[3]),!u))return new tr(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new va(u||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const u of this.args){if(o=u.evaluate(n),o===null)return 0;const g=Number(o);if(!isNaN(g))return g}throw new va(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?Va.fromString(Ms(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?so.build(Ms(this.args[0].evaluate(n))):this.type.kind==="array"?this.args.map(o=>o.evaluate(n)):Ms(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new wc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new zd(this.args[0]).serialize();const n=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(o=>{n.push(o.serialize())}),n}}const Vm=["Unknown","Point","LineString","Polygon"];class jm{constructor(n,o){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=n,this.options=o}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Vm[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(n){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:u,y:g}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*o-n[0])+this.featureDistanceData.bearing[1]*(g*o-n[1])}return 0}parseColor(n){let o=this._parseColorCache[n];return o||(o=this._parseColorCache[n]=tr.parse(n)),o}getConfig(n){return this.options?this.options.get(n):null}}class zo{constructor(n,o,u,g,d){this.name=n,this.type=o,this._evaluate=u,this.args=g,this._overloadIndex=d}evaluate(n){if(!this._evaluate){const o=zo.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,o){const u=n[0],g=zo.definitions[u];if(!g)return o.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(g)?g[0]:g.type,v=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,E=[];let C=null,z=-1;for(const[w,R]of v){if(Array.isArray(w)&&w.length!==n.length-1)continue;E.push(w),z++,C=new Pc(o.registry,o.path,null,o.scope,void 0,o._scope,o.options);const L=[];let A=!1;for(let D=1;D<n.length;D++){const F=n[D],W=Array.isArray(w)?w[D-1]:w.type,$=C.parse(F,1+L.length,W);if(!$){A=!0;break}L.push($)}if(!A)if(Array.isArray(w)&&w.length!==L.length)C.error(`Expected ${w.length} arguments, but found ${L.length} instead.`);else{for(let D=0;D<L.length;D++){const F=Array.isArray(w)?w[D]:w.type,W=L[D];C.concat(D+1).checkSubtype(F,W.type)}if(C.errors.length===0)return new zo(u,d,R,L,z)}}if(E.length===1)o.errors.push(...C.errors);else{const w=(E.length?E:v.map(([L])=>L)).map(Gm).join(" | "),R=[];for(let L=1;L<n.length;L++){const A=o.parse(n[L],1+R.length);if(!A)return null;R.push(Nr(A.type))}o.error(`Expected arguments of type ${w}, but found (${R.join(", ")}) instead.`)}return null}static register(n,o){zo.definitions=o;for(const u in o)n[u]=zo}}function Gm(l){return Array.isArray(l)?`(${l.map(Nr).join(", ")})`:`(${Nr(l.type)}...)`}class kd{constructor(n,o,u){this.type=bc,this.locale=u,this.caseSensitive=n,this.diacriticSensitive=o}static parse(n,o){if(n.length!==2)return o.error("Expected one argument.");const u=n[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");const g=u["case-sensitive"]===void 0?o.parse(!1,1,Gi):o.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Gi);if(!g)return null;const d=u["diacritic-sensitive"]===void 0?o.parse(!1,1,Gi):o.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Gi);if(!d)return null;let v=null;return u.locale&&(v=o.parseObjectValue(u.locale,1,"locale",ir),!v)?null:new kd(g,d,v)}evaluate(n){return new yh(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}function Fd(l,n,o=0,u=l.length-1,g=jy){for(;u>o;){if(u-o>600){const C=u-o+1,z=n-o+1,w=Math.log(C),R=.5*Math.exp(2*w/3),L=.5*Math.sqrt(w*R*(C-R)/C)*(z-C/2<0?-1:1);Fd(l,n,Math.max(o,Math.floor(n-z*R/C+L)),Math.min(u,Math.floor(n+(C-z)*R/C+L)),g)}const d=l[n];let v=o,E=u;for(Nd(l,o,n),g(l[u],d)>0&&Nd(l,o,u);v<E;){for(Nd(l,v,E),v++,E--;g(l[v],d)<0;)v++;for(;g(l[E],d)>0;)E--}g(l[o],d)===0?Nd(l,o,E):(E++,Nd(l,E,u)),E<=n&&(o=E+1),n<=E&&(u=E-1)}}function Nd(l,n,o){const u=l[n];l[n]=l[o],l[o]=u}function jy(l,n){return l<n?-1:l>n?1:0}function Gy(l){let n=0;for(let o,u,g=0,d=l.length,v=d-1;g<d;v=g++)o=l[g],u=l[v],n+=(u.x-o.x)*(o.y+u.y);return n}function Bd(l,n){l[0]=Math.min(l[0],n[0]),l[1]=Math.min(l[1],n[1]),l[2]=Math.max(l[2],n[0]),l[3]=Math.max(l[3],n[1])}function Ud(l,n){return!(l[0]<=n[0]||l[2]>=n[2]||l[1]<=n[1]||l[3]>=n[3])}function Hy(l,n,o){const u=l[0]-n[0],g=l[1]-n[1],d=l[0]-o[0],v=l[1]-o[1];return u*v-d*g==0&&u*d<=0&&g*v<=0}function xh(l,n,o=!1){let u=!1;for(let E=0,C=n.length;E<C;E++){const z=n[E];for(let w=0,R=z.length,L=R-1;w<R;L=w++){const A=z[L],D=z[w];if(Hy(l,A,D))return o;(d=A)[1]>(g=l)[1]!=(v=D)[1]>g[1]&&g[0]<(v[0]-d[0])*(g[1]-d[1])/(v[1]-d[1])+d[0]&&(u=!u)}}var g,d,v;return u}function Hm(l,n,o,u){const g=u[0]-o[0],d=u[1]-o[1],v=(l[0]-o[0])*d-g*(l[1]-o[1]),E=(n[0]-o[0])*d-g*(n[1]-o[1]);return v>0&&E<0||v<0&&E>0}function Zs(l,n,o,u){return(g=[u[0]-o[0],u[1]-o[1]])[0]*(d=[n[0]-l[0],n[1]-l[1]])[1]-g[1]*d[0]!=0&&!(!Hm(l,n,o,u)||!Hm(o,u,l,n));var g,d}const Ts=8192;function qy(l,n){const o=(180+l[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,g=Math.pow(2,n.z);return[Math.round(o*g*Ts),Math.round(u*g*Ts)]}function op(l,n){for(let o=0;o<n.length;o++)if(xh(l,n[o]))return!0;return!1}function M_(l,n,o){for(const u of o)for(let g=0,d=u.length,v=d-1;g<d;v=g++)if(Zs(l,n,u[v],u[g]))return!0;return!1}function qm(l,n){for(let o=0;o<l.length;++o)if(!xh(l[o],n))return!1;for(let o=0;o<l.length-1;++o)if(M_(l[o],l[o+1],n))return!1;return!0}function T_(l,n){for(let o=0;o<n.length;o++)if(qm(l,n[o]))return!0;return!1}function sp(l,n,o){const u=[];for(let g=0;g<l.length;g++){const d=[];for(let v=0;v<l[g].length;v++){const E=qy(l[g][v],o);Bd(n,E),d.push(E)}u.push(d)}return u}function As(l,n,o){const u=[];for(let g=0;g<l.length;g++){const d=sp(l[g],n,o);u.push(d)}return u}function Ui(l,n,o,u){if(l[0]<o[0]||l[0]>o[2]){const g=.5*u;let d=l[0]-o[0]>g?-u:o[0]-l[0]>g?u:0;d===0&&(d=l[0]-o[2]>g?-u:o[2]-l[0]>g?u:0),l[0]+=d}Bd(n,l)}function Qn(l,n,o,u){const g=Math.pow(2,u.z)*Ts,d=[u.x*Ts,u.y*Ts],v=[];if(!l)return v;for(const E of l)for(const C of E){const z=[C.x+d[0],C.y+d[1]];Ui(z,n,o,g),v.push(z)}return v}function lp(l,n,o,u){const g=Math.pow(2,u.z)*Ts,d=[u.x*Ts,u.y*Ts],v=[];if(!l)return v;for(const C of l){const z=[];for(const w of C){const R=[w.x+d[0],w.y+d[1]];Bd(n,R),z.push(R)}v.push(z)}if(n[2]-n[0]<=g/2){(E=n)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const C of v)for(const z of C)Ui(z,n,o,g)}var E;return v}class pi{constructor(n,o){this.type=Gi,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Ul(n[1])){const u=n[1];if(u.type==="FeatureCollection")for(let g=0;g<u.features.length;++g){const d=u.features[g].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new pi(u,u.features[g].geometry)}else if(u.type==="Feature"){const g=u.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new pi(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new pi(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(o,u){const g=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],v=o.canonicalID();if(!v)return!1;if(u.type==="Polygon"){const E=sp(u.coordinates,d,v),C=Qn(o.geometry(),g,d,v);if(!Ud(g,d))return!1;for(const z of C)if(!xh(z,E))return!1}if(u.type==="MultiPolygon"){const E=As(u.coordinates,d,v),C=Qn(o.geometry(),g,d,v);if(!Ud(g,d))return!1;for(const z of C)if(!op(z,E))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(o,u){const g=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],v=o.canonicalID();if(!v)return!1;if(u.type==="Polygon"){const E=sp(u.coordinates,d,v),C=lp(o.geometry(),g,d,v);if(!Ud(g,d))return!1;for(const z of C)if(!qm(z,E))return!1}if(u.type==="MultiPolygon"){const E=As(u.coordinates,d,v),C=lp(o.geometry(),g,d,v);if(!Ud(g,d))return!1;for(const z of C)if(!T_(z,E))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const yu={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Sc=1/298.257223563,fi=Sc*(2-Sc),bh=Math.PI/180;class dl{static fromTile(n,o,u){const g=Math.PI*(1-2*(n+.5)/Math.pow(2,o)),d=Math.atan(.5*(Math.exp(g)-Math.exp(-g)))/bh;return new dl(d,u)}static get units(){return yu}constructor(n,o){if(n===void 0)throw new Error("No latitude given.");if(o&&!yu[o])throw new Error(`Unknown unit ${o}. Use one of: ${Object.keys(yu).join(", ")}`);const u=6378.137*bh*(o?yu[o]:1),g=Math.cos(n*bh),d=1/(1-fi*(1-g*g)),v=Math.sqrt(d);this.kx=u*v*g,this.ky=u*v*d*(1-fi)}distance(n,o){const u=xo(n[0]-o[0])*this.kx,g=(n[1]-o[1])*this.ky;return Math.sqrt(u*u+g*g)}bearing(n,o){const u=xo(o[0]-n[0])*this.kx;return Math.atan2(u,(o[1]-n[1])*this.ky)/bh}destination(n,o,u){const g=u*bh;return this.offset(n,Math.sin(g)*o,Math.cos(g)*o)}offset(n,o,u){return[n[0]+o/this.kx,n[1]+u/this.ky]}lineDistance(n){let o=0;for(let u=0;u<n.length-1;u++)o+=this.distance(n[u],n[u+1]);return o}area(n){let o=0;for(let u=0;u<n.length;u++){const g=n[u];for(let d=0,v=g.length,E=v-1;d<v;E=d++)o+=xo(g[d][0]-g[E][0])*(g[d][1]+g[E][1])*(u?-1:1)}return Math.abs(o)/2*this.kx*this.ky}along(n,o){let u=0;if(o<=0)return n[0];for(let g=0;g<n.length-1;g++){const d=n[g],v=n[g+1],E=this.distance(d,v);if(u+=E,u>o)return Vd(d,v,(o-(u-E))/E)}return n[n.length-1]}pointToSegmentDistance(n,o,u){let[g,d]=o,v=xo(u[0]-g)*this.kx,E=(u[1]-d)*this.ky;if(v!==0||E!==0){const C=(xo(n[0]-g)*this.kx*v+(n[1]-d)*this.ky*E)/(v*v+E*E);C>1?(g=u[0],d=u[1]):C>0&&(g+=v/this.kx*C,d+=E/this.ky*C)}return v=xo(n[0]-g)*this.kx,E=(n[1]-d)*this.ky,Math.sqrt(v*v+E*E)}pointOnLine(n,o){let u=1/0,g=n[0][0],d=n[0][1],v=0,E=0;for(let C=0;C<n.length-1;C++){let z=n[C][0],w=n[C][1],R=xo(n[C+1][0]-z)*this.kx,L=(n[C+1][1]-w)*this.ky,A=0;R===0&&L===0||(A=(xo(o[0]-z)*this.kx*R+(o[1]-w)*this.ky*L)/(R*R+L*L),A>1?(z=n[C+1][0],w=n[C+1][1]):A>0&&(z+=R/this.kx*A,w+=L/this.ky*A)),R=xo(o[0]-z)*this.kx,L=(o[1]-w)*this.ky;const D=R*R+L*L;D<u&&(u=D,g=z,d=w,v=C,E=A)}return{point:[g,d],index:v,t:Math.max(0,Math.min(1,E))}}lineSlice(n,o,u){let g=this.pointOnLine(u,n),d=this.pointOnLine(u,o);if(g.index>d.index||g.index===d.index&&g.t>d.t){const z=g;g=d,d=z}const v=[g.point],E=g.index+1,C=d.index;!cp(u[E],v[0])&&E<=C&&v.push(u[E]);for(let z=E+1;z<=C;z++)v.push(u[z]);return cp(u[C],d.point)||v.push(d.point),v}lineSliceAlong(n,o,u){let g=0;const d=[];for(let v=0;v<u.length-1;v++){const E=u[v],C=u[v+1],z=this.distance(E,C);if(g+=z,g>n&&d.length===0&&d.push(Vd(E,C,(n-(g-z))/z)),g>=o)return d.push(Vd(E,C,(o-(g-z))/z)),d;g>n&&d.push(C)}return d}bufferPoint(n,o){const u=o/this.ky,g=o/this.kx;return[n[0]-g,n[1]-u,n[0]+g,n[1]+u]}bufferBBox(n,o){const u=o/this.ky,g=o/this.kx;return[n[0]-g,n[1]-u,n[2]+g,n[3]+u]}insideBBox(n,o){return xo(n[0]-o[0])>=0&&xo(n[0]-o[2])<=0&&n[1]>=o[1]&&n[1]<=o[3]}}function cp(l,n){return l[0]===n[0]&&l[1]===n[1]}function Vd(l,n,o){const u=xo(n[0]-l[0]);return[l[0]+u*o,l[1]+(n[1]-l[1])*o]}function xo(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}class ja{constructor(n=[],o=(u,g)=>u<g?-1:u>g?1:0){if(this.data=n,this.length=this.data.length,this.compare=o,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:o,compare:u}=this,g=o[n];for(;n>0;){const d=n-1>>1,v=o[d];if(u(g,v)>=0)break;o[n]=v,n=d}o[n]=g}_down(n){const{data:o,compare:u}=this,g=this.length>>1,d=o[n];for(;n<g;){let v=1+(n<<1);const E=v+1;if(E<this.length&&u(o[E],o[v])<0&&(v=E),u(o[v],d)>=0)break;o[n]=o[v],n=v}o[n]=d}}var yn=8192;function up(l,n){return n.dist-l.dist}const jd=100,Gd=50;function Ec(l){const n=[1/0,1/0,-1/0,-1/0];if(n.length!==l.length)return!1;for(let o=0;o<n.length;o++)if(n[o]!==l[o])return!1;return!0}function Za(l){return l[1]-l[0]+1}function jl(l,n){const o=l[1]>=l[0]&&l[1]<n;return o||console.warn("Distance Expression: Index is out of range"),o}function Wm(l,n){if(l[0]>l[1])return[null,null];const o=Za(l);if(n){if(o===2)return[l,null];const u=Math.floor(o/2);return[[l[0],l[0]+u],[l[0]+u,l[1]]]}{if(o===1)return[l,null];const u=Math.floor(o/2)-1;return[[l[0],l[0]+u],[l[0]+u+1,l[1]]]}}function Ya(l,n){const o=[1/0,1/0,-1/0,-1/0];if(!jl(n,l.length))return o;for(let u=n[0];u<=n[1];++u)Bd(o,l[u]);return o}function Ys(l){const n=[1/0,1/0,-1/0,-1/0];for(let o=0;o<l.length;++o)for(let u=0;u<l[o].length;++u)Bd(n,l[o][u]);return n}function Mc(l,n,o){if(Ec(l)||Ec(n))return NaN;let u=0,g=0;return l[2]<n[0]&&(u=n[0]-l[2]),l[0]>n[2]&&(u=l[0]-n[2]),l[1]>n[3]&&(g=l[1]-n[3]),l[3]<n[1]&&(g=n[1]-l[3]),o.distance([0,0],[u,g])}function hp(l){return 360*l-180}function A_(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function dp(l,n){const o=Math.pow(2,n.z),u=(l.y/yn+n.y)/o;return[hp((l.x/yn+n.x)/o),A_(u)]}function $m(l,n){const o=[];for(let u=0;u<l.length;++u)o.push(dp(l[u],n));return o}function C_(l,n,o){const u=o.pointOnLine(n,l).point;return o.distance(l,u)}function Xm(l,n,o,u,g){const d=o.slice(u[0],u[1]+1);let v=1/0;for(let E=n[0];E<=n[1];++E)if((v=Math.min(v,C_(l[E],d,g)))===0)return 0;return v}function Tc(l,n,o,u,g){const d=Math.min(g.pointToSegmentDistance(l,o,u),g.pointToSegmentDistance(n,o,u)),v=Math.min(g.pointToSegmentDistance(o,l,n),g.pointToSegmentDistance(u,l,n));return Math.min(d,v)}function Zm(l,n,o,u,g){if(!jl(n,l.length)||!jl(u,o.length))return NaN;let d=1/0;for(let v=n[0];v<n[1];++v)for(let E=u[0];E<u[1];++E){if(Zs(l[v],l[v+1],o[E],o[E+1]))return 0;d=Math.min(d,Tc(l[v],l[v+1],o[E],o[E+1],g))}return d}function wh(l,n,o,u,g){if(!jl(n,l.length)||!jl(u,o.length))return NaN;let d=1/0;for(let v=n[0];v<=n[1];++v)for(let E=u[0];E<=u[1];++E)if((d=Math.min(d,g.distance(l[v],o[E])))===0)return d;return d}function Gl(l,n,o){if(xh(l,n,!0))return 0;let u=1/0;for(const g of n){const d=g.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(g[0]!==g[d-1]&&(u=Math.min(u,o.pointToSegmentDistance(l,g[d-1],g[0])))===0||(u=Math.min(u,C_(l,g,o)))===0)return u}return u}function R_(l,n,o,u){if(!jl(n,l.length))return NaN;for(let d=n[0];d<=n[1];++d)if(xh(l[d],o,!0))return 0;let g=1/0;for(let d=n[0];d<n[1];++d)for(const v of o)for(let E=0,C=v.length,z=C-1;E<C;z=E++){if(Zs(l[d],l[d+1],v[z],v[E]))return 0;g=Math.min(g,Tc(l[d],l[d+1],v[z],v[E],u))}return g}function Ac(l,n){for(const o of l)for(let u=0;u<=o.length-1;++u)if(xh(o[u],n,!0))return!0;return!1}function Cc(l,n,o,u=1/0){const g=Ys(l),d=Ys(n);if(u!==1/0&&Mc(g,d,o)>=u)return u;if(Ud(g,d)){if(Ac(l,n))return 0}else if(Ac(n,l))return 0;let v=u;for(const E of l)for(let C=0,z=E.length,w=z-1;C<z;w=C++)for(const R of n)for(let L=0,A=R.length,D=A-1;L<A;D=L++){if(Zs(E[w],E[C],R[D],R[L]))return 0;v=Math.min(v,Tc(E[w],E[C],R[D],R[L],o))}return v}function xu(l,n,o,u,g,d,v){if(d===null||v===null)return;const E=Mc(Ya(u,d),Ya(g,v),o);E<n&&l.push({dist:E,range1:d,range2:v})}function Ym(l,n,o,u,g=1/0){let d=Math.min(u.distance(l[0],o[0][0]),g);if(d===0)return d;const v=new ja([{dist:0,range1:[0,l.length-1],range2:[0,0]}],up),E=n?Gd:jd,C=Ys(o);for(;v.length;){const z=v.pop();if(z.dist>=d)continue;const w=z.range1;if(Za(w)<=E){if(!jl(w,l.length))return NaN;if(n){const R=R_(l,w,o,u);if((d=Math.min(d,R))===0)return d}else for(let R=w[0];R<=w[1];++R){const L=Gl(l[R],o,u);if((d=Math.min(d,L))===0)return d}}else{const R=Wm(w,n);if(R[0]!==null){const L=Mc(Ya(l,R[0]),C,u);L<d&&v.push({dist:L,range1:R[0],range2:[0,0]})}if(R[1]!==null){const L=Mc(Ya(l,R[1]),C,u);L<d&&v.push({dist:L,range1:R[1],range2:[0,0]})}}}return d}function lo(l,n,o,u,g,d=1/0){let v=Math.min(d,g.distance(l[0],o[0]));if(v===0)return v;const E=new ja([{dist:0,range1:[0,l.length-1],range2:[0,o.length-1]}],up),C=n?Gd:jd,z=u?Gd:jd;for(;E.length;){const w=E.pop();if(w.dist>=v)continue;const R=w.range1,L=w.range2;if(Za(R)<=C&&Za(L)<=z){if(!jl(R,l.length)||!jl(L,o.length))return NaN;if(n&&u?v=Math.min(v,Zm(l,R,o,L,g)):n||u?n&&!u?v=Math.min(v,Xm(o,L,l,R,g)):!n&&u&&(v=Math.min(v,Xm(l,R,o,L,g))):v=Math.min(v,wh(l,R,o,L,g)),v===0)return v}else{const A=Wm(R,n),D=Wm(L,u);xu(E,v,g,l,o,A[0],D[0]),xu(E,v,g,l,o,A[0],D[1]),xu(E,v,g,l,o,A[1],D[0]),xu(E,v,g,l,o,A[1],D[1])}}return v}function Hd(l,n,o,u,g=1/0){let d=g;const v=Ya(l,[0,l.length-1]);for(const E of o)if(!(d!==1/0&&Mc(v,Ya(E,[0,E.length-1]),u)>=d)&&(d=Math.min(d,lo(l,n,E,!0,u,d)),d===0))return d;return d}function Sh(l,n,o,u,g=1/0){let d=g;const v=Ya(l,[0,l.length-1]);for(const E of o){if(d!==1/0&&Mc(v,Ys(E),u)>=d)continue;const C=Ym(l,n,E,u,d);if(isNaN(C))return C;if((d=Math.min(d,C))===0)return d}return d}function qd(l){return l==="Point"||l==="MultiPoint"||l==="LineString"||l==="MultiLineString"||l==="Polygon"||l==="MultiPolygon"}class Rc{constructor(n,o){this.type=Nn,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'distance' expression requires either one argument, but found ' ${n.length-1} instead.`);if(Ul(n[1])){const u=n[1];if(u.type==="FeatureCollection"){for(let g=0;g<u.features.length;++g)if(qd(u.features[g].geometry.type))return new Rc(u,u.features[g].geometry)}else if(u.type==="Feature"){if(qd(u.geometry.type))return new Rc(u,u.geometry)}else if(qd(u.type))return new Rc(u,u)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(n){const o=n.geometry(),u=n.canonicalID();if(o!=null&&u!=null){if(n.geometryType()==="Point")return function(g,d,v){const E=[];for(const z of g)for(const w of z)E.push(dp(w,d));const C=new dl(E[0][1],"meters");return v.type==="Point"||v.type==="MultiPoint"||v.type==="LineString"?lo(E,!1,v.type==="Point"?[v.coordinates]:v.coordinates,v.type==="LineString",C):v.type==="MultiLineString"?Hd(E,!1,v.coordinates,C):v.type==="Polygon"||v.type==="MultiPolygon"?Sh(E,!1,v.type==="Polygon"?[v.coordinates]:v.coordinates,C):null}(o,u,this.geometries);if(n.geometryType()==="LineString")return function(g,d,v){const E=[];for(const z of g){const w=[];for(const R of z)w.push(dp(R,d));E.push(w)}const C=new dl(E[0][0][1],"meters");if(v.type==="Point"||v.type==="MultiPoint"||v.type==="LineString")return Hd(v.type==="Point"?[v.coordinates]:v.coordinates,v.type==="LineString",E,C);if(v.type==="MultiLineString"){let z=1/0;for(let w=0;w<v.coordinates.length;w++){const R=Hd(v.coordinates[w],!0,E,C,z);if(isNaN(R))return R;if((z=Math.min(z,R))===0)return z}return z}if(v.type==="Polygon"||v.type==="MultiPolygon"){let z=1/0;for(let w=0;w<E.length;w++){const R=Sh(E[w],!0,v.type==="Polygon"?[v.coordinates]:v.coordinates,C,z);if(isNaN(R))return R;if((z=Math.min(z,R))===0)return z}return z}return null}(o,u,this.geometries);if(n.geometryType()==="Polygon")return function(g,d,v){const E=[];for(const z of function(w,R){const L=w.length;if(L<=1)return[w];const A=[];let D,F;for(let W=0;W<L;W++){const $=Gy(w[W]);$!==0&&(w[W].area=Math.abs($),F===void 0&&(F=$<0),F===$<0?(D&&A.push(D),D=[w[W]]):D.push(w[W]))}return D&&A.push(D),A}(g)){const w=[];for(let R=0;R<z.length;++R)w.push($m(z[R],d));E.push(w)}const C=new dl(E[0][0][0][1],"meters");if(v.type==="Point"||v.type==="MultiPoint"||v.type==="LineString")return Sh(v.type==="Point"?[v.coordinates]:v.coordinates,v.type==="LineString",E,C);if(v.type==="MultiLineString"){let z=1/0;for(let w=0;w<v.coordinates.length;w++){const R=Sh(v.coordinates[w],!0,E,C,z);if(isNaN(R))return R;if((z=Math.min(z,R))===0)return z}return z}return v.type==="Polygon"||v.type==="MultiPolygon"?function(z,w,R){let L=1/0;for(const A of z)for(const D of w){const F=Cc(A,D,R,L);if(isNaN(F))return F;if((L=Math.min(L,F))===0)return L}return L}(v.type==="Polygon"?[v.coordinates]:v.coordinates,E,C):null}(o,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function fp(l,n){switch(l){case"string":return Ms(n);case"number":return+n;case"boolean":return!!n;case"color":return tr.parse(n);case"formatted":return Va.fromString(Ms(n));case"resolvedImage":return so.build(Ms(n))}return n}function Km(l,n,o,u){return u!==void 0&&(l=u*Math.round(l/u)),n!==void 0&&l<n&&(l=n),o!==void 0&&l>o&&(l=o),l}class Ic{constructor(n,o,u){this.type=n,this.key=o,this.scope=u}static parse(n,o){let u=o.expectedType;if(u==null&&(u=nr),n.length<2||n.length>3)return o.error("Invalid number of arguments for 'config' expression.");const g=o.parse(n[1],1);if(!(g instanceof Xa))return o.error("Key name of 'config' expression must be a string literal.");if(n.length>=3){const d=o.parse(n[2],2);return d instanceof Xa?new Ic(u,Ms(g.value),Ms(d.value)):o.error("Scope of 'config' expression must be a string literal.")}return new Ic(u,Ms(g.value))}evaluate(n){const o=[this.key,this.scope,n.scope].filter(Boolean).join(""),u=n.getConfig(o);if(!u)return null;const{type:g,value:d,values:v,minValue:E,maxValue:C,stepValue:z}=u,w=u.default.evaluate(n);let R=w;if(d){const L=n.scope;n.scope=(L||"").split("").slice(1).join(""),R=d.evaluate(n),n.scope=L}return g&&(R=fp(g,R)),R===void 0||E===void 0&&C===void 0&&z===void 0||(typeof R=="number"?R=Km(R,E,C,z):Array.isArray(R)&&(R=R.map(L=>typeof L=="number"?Km(L,E,C,z):L))),d!==void 0&&R!==void 0&&v&&!v.includes(R)&&(R=w,g&&(R=fp(g,R))),(g&&g!==this.type||R!==void 0&&Yr(R)!==this.type)&&(R=fp(this.type.kind,R)),R}eachChild(){}outputDefined(){return!1}serialize(){const n=["config",this.key];return this.scope&&n.concat(this.key),n}}function bu(l){if(l instanceof zo&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof pi||l instanceof Rc)return!1;let n=!0;return l.eachChild(o=>{n&&!bu(o)&&(n=!1)}),n}function Eh(l){if(l instanceof zo&&l.name==="feature-state")return!1;let n=!0;return l.eachChild(o=>{n&&!Eh(o)&&(n=!1)}),n}function ko(l){if(l instanceof Ic)return new Set([l.key]);let n=new Set;return l.eachChild(o=>{n=new Set([...n,...ko(o)])}),n}function co(l,n){if(l instanceof zo&&n.indexOf(l.name)>=0)return!1;let o=!0;return l.eachChild(u=>{o&&!co(u,n)&&(o=!1)}),o}class Cs{constructor(n,o){this.type=o.type,this.name=n,this.boundExpression=o}static parse(n,o){if(n.length!==2||typeof n[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const u=n[1];return o.scope.has(u)?new Cs(u,o.scope.get(u)):o.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Dc{constructor(n,o=[],u,g=new Ld,d=[],v,E){this.registry=n,this.path=o,this.key=o.map(C=>typeof C=="string"?`['${C}']`:`[${C}]`).join(""),this.scope=g,this.errors=d,this.expectedType=u,this._scope=v,this.options=E}parse(n,o,u,g,d={}){return o||u?this.concat(o,null,u,g)._parse(n,d):this._parse(n,d)}parseObjectValue(n,o,u,g,d,v={}){return this.concat(o,u,g,d)._parse(n,v)}_parse(n,o){function u(g,d,v){return v==="assert"?new $s(d,[g]):v==="coerce"?new Vl(d,[g]):g}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=typeof n[0]=="string"?this.registry[n[0]]:void 0;if(g){let d=g.parse(n,this);if(!d)return null;if(this.expectedType){const v=this.expectedType,E=d.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||E.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||E.kind!=="value"&&E.kind!=="string"){if(this.checkSubtype(v,E))return null}else d=u(d,v,o.typeAnnotation||"coerce");else d=u(d,v,o.typeAnnotation||"assert")}if(!(d instanceof Xa)&&d.type.kind!=="resolvedImage"&&wu(d)){const v=new jm(this._scope,this.options);try{d=new Xa(d.type,d.evaluate(v))}catch(E){return this.error(E.message),null}}return d}return Vl.parse(["to-array",n],this)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,o,u,g){let d=typeof n=="number"?this.path.concat(n):this.path;d=typeof o=="string"?d.concat(o):d;const v=g?this.scope.concat(g):this.scope;return new Dc(this.registry,d,u||null,v,this.errors,this._scope,this.options)}error(n,...o){const u=`${this.key}${o.map(g=>`[${g}]`).join("")}`;this.errors.push(new Bi(u,n))}checkSubtype(n,o){const u=$a(n,o);return u&&this.error(u),u}}var Pc=Dc;function wu(l){if(l instanceof Cs)return wu(l.boundExpression);if(l instanceof zo&&l.name==="error"||l instanceof kd||l instanceof pi||l instanceof Rc||l instanceof Ic)return!1;const n=l instanceof Vl||l instanceof $s;let o=!0;return l.eachChild(u=>{o=n?o&&wu(u):o&&u instanceof Xa}),!!o&&bu(l)&&co(l,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Su(l,n){const o=l.length-1;let u,g,d=0,v=o,E=0;for(;d<=v;)if(E=Math.floor((d+v)/2),u=l[E],g=l[E+1],u<=n){if(E===o||n<g)return E;d=E+1}else{if(!(u>n))throw new va("Input is not a number.");v=E-1}return 0}class cs{constructor(n,o,u){this.type=n,this.input=o,this.labels=[],this.outputs=[];for(const[g,d]of u)this.labels.push(g),this.outputs.push(d)}static parse(n,o){if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");const u=o.parse(n[1],1,Nn);if(!u)return null;const g=[];let d=null;o.expectedType&&o.expectedType.kind!=="value"&&(d=o.expectedType);for(let v=1;v<n.length;v+=2){const E=v===1?-1/0:n[v],C=n[v+1],z=v,w=v+1;if(typeof E!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(g.length&&g[g.length-1][0]>=E)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const R=o.parse(C,w,d);if(!R)return null;d=d||R.type,g.push([E,R])}return new cs(d,u,g)}evaluate(n){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(n);const g=this.input.evaluate(n);if(g<=o[0])return u[0].evaluate(n);const d=o.length;return g>=o[d-1]?u[d-1].evaluate(n):u[Su(o,g)].evaluate(n)}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&n.push(this.labels[o]),n.push(this.outputs[o].serialize());return n}}const Lc=.95047,Wi=1.08883,Eu=4/29,Mu=6/29,us=3*Mu*Mu,Tu=Mu*Mu*Mu,Mh=Math.PI/180,Rr=180/Math.PI;function Th(l){return l>Tu?Math.pow(l,1/3):l/us+Eu}function Zo(l){return l>Mu?l*l*l:us*(l-Eu)}function Yo(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function Hl(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function fl(l){const n=Hl(l.r),o=Hl(l.g),u=Hl(l.b),g=Th((.4124564*n+.3575761*o+.1804375*u)/Lc),d=Th((.2126729*n+.7151522*o+.072175*u)/1);return{l:116*d-16,a:500*(g-d),b:200*(d-Th((.0193339*n+.119192*o+.9503041*u)/Wi)),alpha:l.a}}function pl(l){let n=(l.l+16)/116,o=isNaN(l.a)?n:n+l.a/500,u=isNaN(l.b)?n:n-l.b/200;return n=1*Zo(n),o=Lc*Zo(o),u=Wi*Zo(u),new tr(Yo(3.2404542*o-1.5371385*n-.4985314*u),Yo(-.969266*o+1.8760108*n+.041556*u),Yo(.0556434*o-.2040259*n+1.0572252*u),l.alpha)}function Au(l,n,o){const u=n-l;return l+o*(u>180||u<-180?u-360*Math.round(u/360):u)}const Ah={forward:fl,reverse:pl,interpolate:function(l,n,o){return{l:oi(l.l,n.l,o),a:oi(l.a,n.a,o),b:oi(l.b,n.b,o),alpha:oi(l.alpha,n.alpha,o)}}},Cu={forward:function(l){const{l:n,a:o,b:u}=fl(l),g=Math.atan2(u,o)*Rr;return{h:g<0?g+360:g,c:Math.sqrt(o*o+u*u),l:n,alpha:l.a}},reverse:function(l){const n=l.h*Mh,o=l.c;return pl({l:l.l,a:Math.cos(n)*o,b:Math.sin(n)*o,alpha:l.alpha})},interpolate:function(l,n,o){return{h:Au(l.h,n.h,o),c:oi(l.c,n.c,o),l:oi(l.l,n.l,o),alpha:oi(l.alpha,n.alpha,o)}}};var pp=Object.freeze({__proto__:null,hcl:Cu,lab:Ah});class Kr{constructor(n,o,u,g,d,v){this.type=n,this.operator=o,this.interpolation=u,this.input=g,this.dynamicStops=d,this.labels=[],this.outputs=[];for(const[E,C]of v)this.labels.push(E),this.outputs.push(C)}static interpolationFactor(n,o,u,g){let d=0;if(n.name==="exponential")d=Ka(o,n.base,u,g);else if(n.name==="linear")d=Ka(o,1,u,g);else if(n.name==="cubic-bezier"){const v=n.controlPoints;d=new vn(v[0],v[1],v[2],v[3]).solve(Ka(o,1,u,g))}return d}static parse(n,o){let[u,g,d,...v]=n;if(!Array.isArray(g)||g.length===0)return o.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const z=g[1];if(typeof z!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:z}}else{if(g[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const z=g.slice(1);if(z.length!==4||z.some(w=>typeof w!="number"||w<0||w>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:z}}}if(n.length-1<3)return o.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length-1>3&&(n.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(d=o.parse(d,2,Nn),!d)return null;const E=[];let C=null;if(u==="interpolate-hcl"||u==="interpolate-lab"?C=Wa:o.expectedType&&o.expectedType.kind!=="value"&&(C=o.expectedType),n.length-1==3){const z=o.parse(v[0],3,nr);return z?new Kr(C,u,g,d,z,E):null}for(let z=0;z<v.length;z+=2){const w=v[z],R=v[z+1],L=z+3,A=z+4;if(typeof w!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(E.length&&E[E.length-1][0]>=w)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const D=o.parse(R,A,C);if(!D)return null;C=C||D.type,E.push([w,D])}return C.kind==="number"||C.kind==="color"||C.kind==="array"&&C.itemType.kind==="number"&&typeof C.N=="number"?new Kr(C,u,g,d,null,E):o.error(`Type ${Nr(C)} is not interpolatable.`)}evaluate(n){let o=this.labels,u=this.outputs;if(this.dynamicStops){const w=this.dynamicStops.evaluate(n);if(w.length%2!=0)throw new va("Expected an even number of arguments.");o=[],u=[];for(let R=0;R<w.length;R+=2){const L=w[R],A=new Xa(Nn,w[R+1]);if(typeof L!="number")throw new va('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.');if(o.length&&o[o.length-1]>=L)throw new va('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.');o.push(L),u.push(A)}if(o.length===0)throw new va("Expected at least one input/output pair.")}if(o.length===1)return u[0].evaluate(n);const g=this.input.evaluate(n);if(g<=o[0])return u[0].evaluate(n);const d=o.length;if(g>=o[d-1])return u[d-1].evaluate(n);const v=Su(o,g),E=Kr.interpolationFactor(this.interpolation,g,o[v],o[v+1]),C=u[v].evaluate(n),z=u[v+1].evaluate(n);return this.operator==="interpolate"?Nl[this.type.kind.toLowerCase()](C,z,E):this.operator==="interpolate-hcl"?Cu.reverse(Cu.interpolate(Cu.forward(C),Cu.forward(z),E)):Ah.reverse(Ah.interpolate(Ah.forward(C),Ah.forward(z),E))}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,n,this.input.serialize()];if(this.dynamicStops)o.push(this.dynamicStops.serialize());else for(let u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o}}function Ka(l,n,o,u){const g=u-o,d=l-o;return g===0?0:n===1?d/g:(Math.pow(n,d)-1)/(Math.pow(n,g)-1)}class Ir{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expectected at least one argument.");let u=null;const g=o.expectedType;g&&g.kind!=="value"&&(u=g);const d=[];for(const E of n.slice(1)){const C=o.parse(E,1+d.length,u,void 0,{typeAnnotation:"omit"});if(!C)return null;u=u||C.type,d.push(C)}const v=g&&d.some(E=>$a(g,E.type));return new Ir(v?nr:u,d)}evaluate(n){let o,u=null,g=0;for(const d of this.args){if(g++,u=d.evaluate(n),u&&u instanceof so&&!u.available&&(o||(o=u),u=null,g===this.args.length))return o;if(u!==null)break}return u}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(o=>{n.push(o.serialize())}),n}}class Ko{constructor(n,o){this.type=o.type,this.bindings=[].concat(n),this.result=o}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const o of this.bindings)n(o[1]);n(this.result)}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const u=[];for(let d=1;d<n.length-1;d+=2){const v=n[d];if(typeof v!="string")return o.error(`Expected string, but found ${typeof v} instead.`,d);if(/[^a-zA-Z0-9_]/.test(v))return o.error("Variable names must contain only alphanumeric characters or '_'.",d);const E=o.parse(n[d+1],d+1);if(!E)return null;u.push([v,E])}const g=o.parse(n[n.length-1],n.length-1,o.expectedType,u);return g?new Ko(u,g):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[o,u]of this.bindings)n.push(o,u.serialize());return n.push(this.result.serialize()),n}}class Rs{constructor(n,o,u){this.type=n,this.index=o,this.input=u}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,Nn),g=o.parse(n[2],2,Fr(o.expectedType||nr));return u&&g?new Rs(g.type.itemType,u,g):null}evaluate(n){const o=this.index.evaluate(n),u=this.input.evaluate(n);if(o<0)throw new va(`Array index out of bounds: ${o} < 0.`);if(o>u.length-1)throw new va(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o===Math.floor(o))return u[o];const g=Math.floor(o),d=Math.ceil(o),v=u[g],E=u[d];if(typeof v!="number"||typeof E!="number")throw new va(`Cannot interpolate between non-number values at index ${o}.`);const C=o-g;return v*(1-C)+E*C}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Wd{constructor(n,o){this.type=Gi,this.needle=n,this.haystack=o}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,nr),g=o.parse(n[2],2,nr);return u&&g?ap(u.type,[Gi,ir,Nn,qs,nr])?new Wd(u,g):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nr(u.type)} instead`):null}evaluate(n){const o=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(u==null)return!1;if(!vu(o,["boolean","string","number","null"]))throw new va(`Expected first argument to be of type boolean, string, number or null, but found ${Nr(Yr(o))} instead.`);if(!vu(u,["string","array"]))throw new va(`Expected second argument to be of type array or string, but found ${Nr(Yr(u))} instead.`);return u.indexOf(o)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ml{constructor(n,o,u){this.type=Nn,this.needle=n,this.haystack=o,this.fromIndex=u}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,nr),g=o.parse(n[2],2,nr);if(!u||!g)return null;if(!ap(u.type,[Gi,ir,Nn,qs,nr]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nr(u.type)} instead`);if(n.length===4){const d=o.parse(n[3],3,Nn);return d?new ml(u,g,d):null}return new ml(u,g)}evaluate(n){const o=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(!vu(o,["boolean","string","number","null"]))throw new va(`Expected first argument to be of type boolean, string, number or null, but found ${Nr(Yr(o))} instead.`);if(!vu(u,["string","array"]))throw new va(`Expected second argument to be of type array or string, but found ${Nr(Yr(u))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(n);return u.indexOf(o,g)}return u.indexOf(o)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class mp{constructor(n,o,u,g,d,v){this.inputType=n,this.type=o,this.input=u,this.cases=g,this.outputs=d,this.otherwise=v}static parse(n,o){if(n.length<5)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return o.error("Expected an even number of arguments.");let u,g;o.expectedType&&o.expectedType.kind!=="value"&&(g=o.expectedType);const d={},v=[];for(let z=2;z<n.length-1;z+=2){let w=n[z];const R=n[z+1];Array.isArray(w)||(w=[w]);const L=o.concat(z);if(w.length===0)return L.error("Expected at least one branch label.");for(const D of w){if(typeof D!="number"&&typeof D!="string")return L.error("Branch labels must be numbers or strings.");if(typeof D=="number"&&Math.abs(D)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof D=="number"&&Math.floor(D)!==D)return L.error("Numeric branch labels must be integer values.");if(u){if(L.checkSubtype(u,Yr(D)))return null}else u=Yr(D);if(d[String(D)]!==void 0)return L.error("Branch labels must be unique.");d[String(D)]=v.length}const A=o.parse(R,z,g);if(!A)return null;g=g||A.type,v.push(A)}const E=o.parse(n[1],1,nr);if(!E)return null;const C=o.parse(n[n.length-1],n.length-1,g);return C?E.type.kind!=="value"&&o.concat(1).checkSubtype(u,E.type)?null:new mp(u,g,E,d,v,C):null}evaluate(n){const o=this.input.evaluate(n);return(Yr(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),u=[],g={};for(const v of o){const E=g[this.cases[v]];E===void 0?(g[this.cases[v]]=u.length,u.push([this.cases[v],[v]])):u[E][1].push(v)}const d=v=>this.inputType.kind==="number"?Number(v):v;for(const[v,E]of u)n.push(E.length===1?d(E[0]):E.map(d)),n.push(this.outputs[v].serialize());return n.push(this.otherwise.serialize()),n}}class gp{constructor(n,o,u){this.type=n,this.branches=o,this.otherwise=u}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return o.error("Expected an odd number of arguments.");let u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);const g=[];for(let v=1;v<n.length-1;v+=2){const E=o.parse(n[v],v,Gi);if(!E)return null;const C=o.parse(n[v+1],v+1,u);if(!C)return null;g.push([E,C]),u=u||C.type}const d=o.parse(n[n.length-1],n.length-1,u);return d?new gp(u,g,d):null}evaluate(n){for(const[o,u]of this.branches)if(o.evaluate(n))return u.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[o,u]of this.branches)n(o),n(u);n(this.otherwise)}outputDefined(){return this.branches.every(([n,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(o=>{n.push(o.serialize())}),n}}class Oc{constructor(n,o,u,g){this.type=n,this.input=o,this.beginIndex=u,this.endIndex=g}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,nr),g=o.parse(n[2],2,Nn);if(!u||!g)return null;if(!ap(u.type,[Fr(nr),ir,nr]))return o.error(`Expected first argument to be of type array or string, but found ${Nr(u.type)} instead`);if(n.length===4){const d=o.parse(n[3],3,Nn);return d?new Oc(u.type,u,g,d):null}return new Oc(u.type,u,g)}evaluate(n){const o=this.input.evaluate(n),u=this.beginIndex.evaluate(n);if(!vu(o,["string","array"]))throw new va(`Expected first argument to be of type array or string, but found ${Nr(Yr(o))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(n);return o.slice(u,g)}return o.slice(u)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Ch(l,n){return l==="=="||l==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function Rh(l,n,o,u){return u.compare(n,o)===0}function gl(l,n,o){const u=l!=="=="&&l!=="!=";return class NF{constructor(d,v,E){this.type=Gi,this.lhs=d,this.rhs=v,this.collator=E,this.hasUntypedArgument=d.type.kind==="value"||v.type.kind==="value"}static parse(d,v){if(d.length!==3&&d.length!==4)return v.error("Expected two or three arguments.");const E=d[0];let C=v.parse(d[1],1,nr);if(!C)return null;if(!Ch(E,C.type))return v.concat(1).error(`"${E}" comparisons are not supported for type '${Nr(C.type)}'.`);let z=v.parse(d[2],2,nr);if(!z)return null;if(!Ch(E,z.type))return v.concat(2).error(`"${E}" comparisons are not supported for type '${Nr(z.type)}'.`);if(C.type.kind!==z.type.kind&&C.type.kind!=="value"&&z.type.kind!=="value")return v.error(`Cannot compare types '${Nr(C.type)}' and '${Nr(z.type)}'.`);u&&(C.type.kind==="value"&&z.type.kind!=="value"?C=new $s(z.type,[C]):C.type.kind!=="value"&&z.type.kind==="value"&&(z=new $s(C.type,[z])));let w=null;if(d.length===4){if(C.type.kind!=="string"&&z.type.kind!=="string"&&C.type.kind!=="value"&&z.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(w=v.parse(d[3],3,bc),!w)return null}return new NF(C,z,w)}evaluate(d){const v=this.lhs.evaluate(d),E=this.rhs.evaluate(d);if(u&&this.hasUntypedArgument){const C=Yr(v),z=Yr(E);if(C.kind!==z.kind||C.kind!=="string"&&C.kind!=="number")throw new va(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${C.kind}, ${z.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const C=Yr(v),z=Yr(E);if(C.kind!=="string"||z.kind!=="string")return n(d,v,E)}return this.collator?o(d,v,E,this.collator.evaluate(d)):n(d,v,E)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[l];return this.eachChild(v=>{d.push(v.serialize())}),d}}}const I_=gl("==",function(l,n,o){return n===o},Rh),Jm=gl("!=",function(l,n,o){return n!==o},function(l,n,o,u){return!Rh(0,n,o,u)}),D_=gl("<",function(l,n,o){return n<o},function(l,n,o,u){return u.compare(n,o)<0}),_p=gl(">",function(l,n,o){return n>o},function(l,n,o,u){return u.compare(n,o)>0}),P_=gl("<=",function(l,n,o){return n<=o},function(l,n,o,u){return u.compare(n,o)<=0}),$d=gl(">=",function(l,n,o){return n>=o},function(l,n,o,u){return u.compare(n,o)>=0});class vp{constructor(n,o,u,g,d,v){this.type=ir,this.number=n,this.locale=o,this.currency=u,this.unit=g,this.minFractionDigits=d,this.maxFractionDigits=v}static parse(n,o){if(n.length!==3)return o.error("Expected two arguments.");const u=o.parse(n[1],1,Nn);if(!u)return null;const g=n[2];if(typeof g!="object"||Array.isArray(g))return o.error("NumberFormat options argument must be an object.");let d=null;if(g.locale&&(d=o.parseObjectValue(g.locale,2,"locale",ir),!d))return null;let v=null;if(g.currency&&(v=o.parseObjectValue(g.currency,2,"currency",ir),!v))return null;let E=null;if(g.unit&&(E=o.parseObjectValue(g.unit,2,"unit",ir),!E))return null;let C=null;if(g["min-fraction-digits"]&&(C=o.parseObjectValue(g["min-fraction-digits"],2,"min-fraction-digits",Nn),!C))return null;let z=null;return g["max-fraction-digits"]&&(z=o.parseObjectValue(g["max-fraction-digits"],2,"max-fraction-digits",Nn),!z)?null:new vp(u,d,v,E,C,z)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class zc{constructor(n){this.type=Nn,this.input=n}static parse(n,o){if(n.length!==2)return o.error(`Expected 1 argument, but found ${n.length-1} instead.`);const u=o.parse(n[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${Nr(u.type)} instead.`):new zc(u):null}evaluate(n){const o=this.input.evaluate(n);if(typeof o=="string"||Array.isArray(o))return o.length;throw new va(`Expected value to be of type string or array, but found ${Nr(Yr(o))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(o=>{n.push(o.serialize())}),n}}function kc(l){return function(){l=1831565813+(l|=0)|0;let n=Math.imul(l^l>>>15,1|l);return n=n+Math.imul(n^n>>>7,61|n)^n,((n^n>>>14)>>>0)/4294967296}}const ql={"==":I_,"!=":Jm,">":_p,"<":D_,">=":$d,"<=":P_,array:$s,at:Rs,boolean:$s,case:gp,coalesce:Ir,collator:kd,format:wc,image:zd,in:Wd,"index-of":ml,interpolate:Kr,"interpolate-hcl":Kr,"interpolate-lab":Kr,length:zc,let:Ko,literal:Xa,match:mp,number:$s,"number-format":vp,object:$s,slice:Oc,step:cs,string:$s,"to-boolean":Vl,"to-color":Vl,"to-number":Vl,"to-string":Vl,var:Cs,within:pi,distance:Rc,config:Ic};function Ru(l,[n,o,u,g]){n=n.evaluate(l),o=o.evaluate(l),u=u.evaluate(l);const d=g?g.evaluate(l):1,v=Bm(n,o,u,d);if(v)throw new va(v);return new tr(n/255*d,o/255*d,u/255*d,d)}function Xd(l,[n,o,u,g]){n=n.evaluate(l),o=o.evaluate(l),u=u.evaluate(l);const d=g?g.evaluate(l):1,v=function(z,w,R,L){return typeof z=="number"&&z>=0&&z<=360?typeof w=="number"&&w>=0&&w<=100&&typeof R=="number"&&R>=0&&R<=100?L===void 0||typeof L=="number"&&L>=0&&L<=1?null:`Invalid hsla value [${[z,w,R,L].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof L=="number"?[z,w,R,L]:[z,w,R]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof L=="number"?[z,w,R,L]:[z,w,R]).join(", ")}]: 'h' must be between 0 and 360.`}(n,o,u,d);if(v)throw new va(v);const E=`hsla(${n}, ${o}%, ${u}%, ${d})`,C=tr.parse(E);if(!C)throw new va(`Failed to parse HSLA color: ${E}`);return C}function Qm(l,n){return l in n}function yp(l,n){const o=n[l];return o===void 0?null:o}function Jo(l){return{type:l}}function xp(l){return{result:"success",value:l}}function uo(l){return{result:"error",value:l}}function Iu(l,n){return!!l&&!!l.parameters&&l.parameters.indexOf(n)>-1}function Ih(l){return l["property-type"]==="data-driven"}function bp(l){return Iu(l.expression,"measure-light")}function Dh(l){return Iu(l.expression,"zoom")}function Ao(l){return!!l.expression&&l.expression.interpolated}function Is(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function Fc(l){return l}function wp(l,n){const o=n.type==="color",u=l.stops&&typeof l.stops[0][0]=="object",g=u||!(u||l.property!==void 0),d=l.type||(Ao(n)?"exponential":"interval");if(o&&((l=Pd({},l)).stops&&(l.stops=l.stops.map(z=>[z[0],tr.parse(z[1])])),l.default=tr.parse(l.default?l.default:n.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!pp[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let v,E,C;if(d==="exponential")v=Zd;else if(d==="interval")v=Ja;else if(d==="categorical"){v=Wl,E=Object.create(null);for(const z of l.stops)E[z[0]]=z[1];C=typeof l.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);v=L_}if(u){const z={},w=[];for(let A=0;A<l.stops.length;A++){const D=l.stops[A],F=D[0].zoom;z[F]===void 0&&(z[F]={zoom:F,type:l.type,property:l.property,default:l.default,stops:[]},w.push(F)),z[F].stops.push([D[0].value,D[1]])}const R=[];for(const A of w)R.push([z[A].zoom,wp(z[A],n)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:Kr.interpolationFactor.bind(void 0,L),zoomStops:R.map(A=>A[0]),evaluate:({zoom:A},D)=>Zd({stops:R,base:l.base},n,A).evaluate(A,D)}}if(g){const z=d==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:Kr.interpolationFactor.bind(void 0,z),zoomStops:l.stops.map(w=>w[0]),evaluate:({zoom:w})=>v(l,n,w,E,C)}}return{kind:"source",evaluate(z,w){const R=w&&w.properties?w.properties[l.property]:void 0;return R===void 0?hs(l.default,n.default):v(l,n,R,E,C)}}}function hs(l,n,o){return l!==void 0?l:n!==void 0?n:o!==void 0?o:void 0}function Wl(l,n,o,u,g){return hs(typeof o===g?u[o]:void 0,l.default,n.default)}function Ja(l,n,o){if(Xs(o)!=="number")return hs(l.default,n.default);const u=l.stops.length;if(u===1||o<=l.stops[0][0])return l.stops[0][1];if(o>=l.stops[u-1][0])return l.stops[u-1][1];const g=Su(l.stops.map(d=>d[0]),o);return l.stops[g][1]}function Zd(l,n,o){const u=l.base!==void 0?l.base:1;if(Xs(o)!=="number")return hs(l.default,n.default);const g=l.stops.length;if(g===1||o<=l.stops[0][0])return l.stops[0][1];if(o>=l.stops[g-1][0])return l.stops[g-1][1];const d=Su(l.stops.map(w=>w[0]),o),v=function(w,R,L,A){const D=A-L,F=w-L;return D===0?0:R===1?F/D:(Math.pow(R,F)-1)/(Math.pow(R,D)-1)}(o,u,l.stops[d][0],l.stops[d+1][0]),E=l.stops[d][1],C=l.stops[d+1][1];let z=Nl[n.type]||Fc;if(l.colorSpace&&l.colorSpace!=="rgb"){const w=pp[l.colorSpace];z=(R,L)=>w.reverse(w.interpolate(w.forward(R),w.forward(L),v))}return typeof E.evaluate=="function"?{evaluate(...w){const R=E.evaluate.apply(void 0,w),L=C.evaluate.apply(void 0,w);if(R!==void 0&&L!==void 0)return z(R,L,v)}}:z(E,C,v)}function L_(l,n,o){return n.type==="color"?o=tr.parse(o):n.type==="formatted"?o=Va.fromString(o.toString()):n.type==="resolvedImage"?o=so.build(o.toString()):Xs(o)===n.type||n.type==="enum"&&n.values[o]||(o=void 0),hs(o,l.default,n.default)}zo.register(ql,{error:[{kind:"error"},[ir],(l,[n])=>{throw new va(n.evaluate(l))}],typeof:[ir,[nr],(l,[n])=>Nr(Yr(n.evaluate(l)))],"to-rgba":[Fr(Nn,4),[Wa],(l,[n])=>n.evaluate(l).toRenderColor(null).toArray()],"to-hsla":[Fr(Nn,4),[Wa],(l,[n])=>n.evaluate(l).toRenderColor(null).toHslaArray()],rgb:[Wa,[Nn,Nn,Nn],Ru],rgba:[Wa,[Nn,Nn,Nn,Nn],Ru],hsl:[Wa,[Nn,Nn,Nn],Xd],hsla:[Wa,[Nn,Nn,Nn,Nn],Xd],has:{type:Gi,overloads:[[[ir],(l,[n])=>Qm(n.evaluate(l),l.properties())],[[ir,Es],(l,[n,o])=>Qm(n.evaluate(l),o.evaluate(l))]]},get:{type:nr,overloads:[[[ir],(l,[n])=>yp(n.evaluate(l),l.properties())],[[ir,Es],(l,[n,o])=>yp(n.evaluate(l),o.evaluate(l))]]},"feature-state":[nr,[ir],(l,[n])=>yp(n.evaluate(l),l.featureState||{})],properties:[Es,[],l=>l.properties()],"geometry-type":[ir,[],l=>l.geometryType()],id:[nr,[],l=>l.id()],zoom:[Nn,[],l=>l.globals.zoom],pitch:[Nn,[],l=>l.globals.pitch||0],"distance-from-center":[Nn,[],l=>l.distanceFromCenter()],"measure-light":[Nn,[ir],(l,[n])=>l.measureLight(n.evaluate(l))],"heatmap-density":[Nn,[],l=>l.globals.heatmapDensity||0],"line-progress":[Nn,[],l=>l.globals.lineProgress||0],"raster-value":[Nn,[],l=>l.globals.rasterValue||0],"raster-particle-speed":[Nn,[],l=>l.globals.rasterParticleSpeed||0],"sky-radial-progress":[Nn,[],l=>l.globals.skyRadialProgress||0],accumulated:[nr,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[Nn,Jo(Nn),(l,n)=>{let o=0;for(const u of n)o+=u.evaluate(l);return o}],"*":[Nn,Jo(Nn),(l,n)=>{let o=1;for(const u of n)o*=u.evaluate(l);return o}],"-":{type:Nn,overloads:[[[Nn,Nn],(l,[n,o])=>n.evaluate(l)-o.evaluate(l)],[[Nn],(l,[n])=>-n.evaluate(l)]]},"/":[Nn,[Nn,Nn],(l,[n,o])=>n.evaluate(l)/o.evaluate(l)],"%":[Nn,[Nn,Nn],(l,[n,o])=>n.evaluate(l)%o.evaluate(l)],ln2:[Nn,[],()=>Math.LN2],pi:[Nn,[],()=>Math.PI],e:[Nn,[],()=>Math.E],"^":[Nn,[Nn,Nn],(l,[n,o])=>Math.pow(n.evaluate(l),o.evaluate(l))],sqrt:[Nn,[Nn],(l,[n])=>Math.sqrt(n.evaluate(l))],log10:[Nn,[Nn],(l,[n])=>Math.log(n.evaluate(l))/Math.LN10],ln:[Nn,[Nn],(l,[n])=>Math.log(n.evaluate(l))],log2:[Nn,[Nn],(l,[n])=>Math.log(n.evaluate(l))/Math.LN2],sin:[Nn,[Nn],(l,[n])=>Math.sin(n.evaluate(l))],cos:[Nn,[Nn],(l,[n])=>Math.cos(n.evaluate(l))],tan:[Nn,[Nn],(l,[n])=>Math.tan(n.evaluate(l))],asin:[Nn,[Nn],(l,[n])=>Math.asin(n.evaluate(l))],acos:[Nn,[Nn],(l,[n])=>Math.acos(n.evaluate(l))],atan:[Nn,[Nn],(l,[n])=>Math.atan(n.evaluate(l))],min:[Nn,Jo(Nn),(l,n)=>Math.min(...n.map(o=>o.evaluate(l)))],max:[Nn,Jo(Nn),(l,n)=>Math.max(...n.map(o=>o.evaluate(l)))],abs:[Nn,[Nn],(l,[n])=>Math.abs(n.evaluate(l))],round:[Nn,[Nn],(l,[n])=>{const o=n.evaluate(l);return o<0?-Math.round(-o):Math.round(o)}],floor:[Nn,[Nn],(l,[n])=>Math.floor(n.evaluate(l))],ceil:[Nn,[Nn],(l,[n])=>Math.ceil(n.evaluate(l))],"filter-==":[Gi,[ir,nr],(l,[n,o])=>l.properties()[n.value]===o.value],"filter-id-==":[Gi,[nr],(l,[n])=>l.id()===n.value],"filter-type-==":[Gi,[ir],(l,[n])=>l.geometryType()===n.value],"filter-<":[Gi,[ir,nr],(l,[n,o])=>{const u=l.properties()[n.value],g=o.value;return typeof u==typeof g&&u<g}],"filter-id-<":[Gi,[nr],(l,[n])=>{const o=l.id(),u=n.value;return typeof o==typeof u&&o<u}],"filter->":[Gi,[ir,nr],(l,[n,o])=>{const u=l.properties()[n.value],g=o.value;return typeof u==typeof g&&u>g}],"filter-id->":[Gi,[nr],(l,[n])=>{const o=l.id(),u=n.value;return typeof o==typeof u&&o>u}],"filter-<=":[Gi,[ir,nr],(l,[n,o])=>{const u=l.properties()[n.value],g=o.value;return typeof u==typeof g&&u<=g}],"filter-id-<=":[Gi,[nr],(l,[n])=>{const o=l.id(),u=n.value;return typeof o==typeof u&&o<=u}],"filter->=":[Gi,[ir,nr],(l,[n,o])=>{const u=l.properties()[n.value],g=o.value;return typeof u==typeof g&&u>=g}],"filter-id->=":[Gi,[nr],(l,[n])=>{const o=l.id(),u=n.value;return typeof o==typeof u&&o>=u}],"filter-has":[Gi,[nr],(l,[n])=>n.value in l.properties()],"filter-has-id":[Gi,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[Gi,[Fr(ir)],(l,[n])=>n.value.indexOf(l.geometryType())>=0],"filter-id-in":[Gi,[Fr(nr)],(l,[n])=>n.value.indexOf(l.id())>=0],"filter-in-small":[Gi,[ir,Fr(nr)],(l,[n,o])=>o.value.indexOf(l.properties()[n.value])>=0],"filter-in-large":[Gi,[ir,Fr(nr)],(l,[n,o])=>function(u,g,d,v){for(;d<=v;){const E=d+v>>1;if(g[E]===u)return!0;g[E]>u?v=E-1:d=E+1}return!1}(l.properties()[n.value],o.value,0,o.value.length-1)],all:{type:Gi,overloads:[[[Gi,Gi],(l,[n,o])=>n.evaluate(l)&&o.evaluate(l)],[Jo(Gi),(l,n)=>{for(const o of n)if(!o.evaluate(l))return!1;return!0}]]},any:{type:Gi,overloads:[[[Gi,Gi],(l,[n,o])=>n.evaluate(l)||o.evaluate(l)],[Jo(Gi),(l,n)=>{for(const o of n)if(o.evaluate(l))return!0;return!1}]]},"!":[Gi,[Gi],(l,[n])=>!n.evaluate(l)],"is-supported-script":[Gi,[ir],(l,[n])=>{const o=l.globals&&l.globals.isSupportedScript;return!o||o(n.evaluate(l))}],upcase:[ir,[ir],(l,[n])=>n.evaluate(l).toUpperCase()],downcase:[ir,[ir],(l,[n])=>n.evaluate(l).toLowerCase()],concat:[ir,Jo(nr),(l,n)=>n.map(o=>Ms(o.evaluate(l))).join("")],"resolved-locale":[ir,[bc],(l,[n])=>n.evaluate(l).resolvedLocale()],random:[Nn,[Nn,Nn,nr],(l,n)=>{const[o,u,g]=n.map(v=>v.evaluate(l));if(o>u||o===u)return o;let d;if(typeof g=="string")d=function(v){let E=0;if(v.length===0)return E;for(let C=0;C<v.length;C++)E=(E<<5)-E+v.charCodeAt(C),E|=0;return E}(g);else{if(typeof g!="number")throw new va(`Invalid seed input: ${g}`);d=g}return o+kc(d)()*(u-o)}]});class Sp{constructor(n,o,u,g){this.expression=n,this._warningHistory={},this._evaluator=new jm(u,g),this._defaultValue=o?function(d){return d.type==="color"&&(Is(d.default)||Array.isArray(d.default))?new tr(0,0,0,0):d.type==="color"?tr.parse(d.default)||null:d.default===void 0?null:d.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null,this.configDependencies=ko(n)}evaluateWithoutErrorHandling(n,o,u,g,d,v,E,C){return this._evaluator.globals=n,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=g||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=E||null,this._evaluator.featureDistanceData=C||null,this.expression.evaluate(this._evaluator)}evaluate(n,o,u,g,d,v,E,C){this._evaluator.globals=n,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=g||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=E||null,this._evaluator.featureDistanceData=C||null;try{const z=this.expression.evaluate(this._evaluator);if(z==null||typeof z=="number"&&z!=z)return this._defaultValue;if(this._enumValues&&!(z in this._enumValues))throw new va(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(z)} instead.`);return z}catch(z){return this._warningHistory[z.message]||(this._warningHistory[z.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${z.message}`)),this._defaultValue}}}function Ph(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in ql}function ya(l,n,o,u){const g=new Pc(ql,[],n?function(v){const E={color:Wa,string:ir,number:Nn,enum:ir,boolean:Gi,formatted:ls,resolvedImage:_h};return v.type==="array"?Fr(E[v.value]||nr,v.length):E[v.type]}(n):void 0,void 0,void 0,o,u),d=g.parse(l,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?xp(new Sp(d,n,o,u)):uo(g.errors)}class Lh{constructor(n,o,u,g){this.kind=n,this._styleExpression=o,this.isLightConstant=u,this.isLineProgressConstant=g,this.isStateDependent=n!=="constant"&&!Eh(o.expression),this.configDependencies=ko(o.expression)}evaluateWithoutErrorHandling(n,o,u,g,d,v){return this._styleExpression.evaluateWithoutErrorHandling(n,o,u,g,d,v)}evaluate(n,o,u,g,d,v){return this._styleExpression.evaluate(n,o,u,g,d,v)}}class $l{constructor(n,o,u,g,d,v){this.kind=n,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=n!=="camera"&&!Eh(o.expression),this.isLightConstant=d,this.isLineProgressConstant=v,this.configDependencies=ko(o.expression),this.interpolationType=g}evaluateWithoutErrorHandling(n,o,u,g,d,v){return this._styleExpression.evaluateWithoutErrorHandling(n,o,u,g,d,v)}evaluate(n,o,u,g,d,v){return this._styleExpression.evaluate(n,o,u,g,d,v)}interpolationFactor(n,o,u){return this.interpolationType?Kr.interpolationFactor(this.interpolationType,n,o,u):0}}function Oh(l,n,o,u){if((l=ya(l,n,o,u)).result==="error")return l;const g=l.value.expression,d=bu(g);if(!d&&!Ih(n))return uo([new Bi("","data expressions not supported")]);const v=co(g,["zoom","pitch","distance-from-center"]);if(!v&&!Dh(n))return uo([new Bi("","zoom expressions not supported")]);const E=co(g,["measure-light"]);if(!E&&!bp(n))return uo([new Bi("","measure-light expression not supported")]);const C=co(g,["line-progress"]);if(!C&&!function(R){return Iu(R.expression,"line-progress")}(n))return uo([new Bi("","line-progress expression not supported")]);const z=n.expression&&n.expression.relaxZoomRestriction,w=_l(g);return w||v||z?w instanceof Bi?uo([w]):w instanceof Kr&&!Ao(n)?uo([new Bi("",'"interpolate" expressions cannot be used with this property')]):xp(w?new $l(d&&C?"camera":"composite",l.value,w.labels,w instanceof Kr?w.interpolation:void 0,E,C):new Lh(d&&C?"constant":"source",l.value,E,C)):uo([new Bi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Du{constructor(n,o){this._parameters=n,this._specification=o,Pd(this,wp(this._parameters,this._specification))}static deserialize(n){return new Du(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function _l(l){let n=null;if(l instanceof Ko)n=_l(l.result);else if(l instanceof Ir){for(const o of l.args)if(n=_l(o),n)break}else(l instanceof cs||l instanceof Kr)&&l.input instanceof zo&&l.input.name==="zoom"&&(n=l);return n instanceof Bi||l.eachChild(o=>{const u=_l(o);u instanceof Bi?n=u:n&&u&&n!==u&&(n=new Bi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}var Nc,O_,z_=function(){if(O_)return Nc;O_=1,Nc=n;var l=3;function n(o,u,g){var d=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var v=new Int32Array(this.arrayBuffer);o=v[0],this.d=(u=v[1])+2*(g=v[2]);for(var E=0;E<this.d*this.d;E++){var C=v[l+E],z=v[l+E+1];d.push(C===z?null:v.subarray(C,z))}var w=v[l+d.length+1];this.keys=v.subarray(v[l+d.length],w),this.bboxes=v.subarray(w),this.insert=this._insertReadonly}else{this.d=u+2*g;for(var R=0;R<this.d*this.d;R++)d.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=o,this.padding=g,this.scale=u/o,this.uid=0;var L=g/u*o;this.min=-L,this.max=o+L}return n.prototype.insert=function(o,u,g,d,v){this._forEachCell(u,g,d,v,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(d),this.bboxes.push(v)},n.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},n.prototype._insertCell=function(o,u,g,d,v,E){this.cells[v].push(E)},n.prototype.query=function(o,u,g,d,v){var E=this.min,C=this.max;if(o<=E&&u<=E&&C<=g&&C<=d&&!v)return Array.prototype.slice.call(this.keys);var z=[];return this._forEachCell(o,u,g,d,this._queryCell,z,{},v),z},n.prototype._queryCell=function(o,u,g,d,v,E,C,z){var w=this.cells[v];if(w!==null)for(var R=this.keys,L=this.bboxes,A=0;A<w.length;A++){var D=w[A];if(C[D]===void 0){var F=4*D;(z?z(L[F+0],L[F+1],L[F+2],L[F+3]):o<=L[F+2]&&u<=L[F+3]&&g>=L[F+0]&&d>=L[F+1])?(C[D]=!0,E.push(R[D])):C[D]=!1}}},n.prototype._forEachCell=function(o,u,g,d,v,E,C,z){for(var w=this._convertToCellCoord(o),R=this._convertToCellCoord(u),L=this._convertToCellCoord(g),A=this._convertToCellCoord(d),D=w;D<=L;D++)for(var F=R;F<=A;F++){var W=this.d*F+D;if((!z||z(this._convertFromCellCoord(D),this._convertFromCellCoord(F),this._convertFromCellCoord(D+1),this._convertFromCellCoord(F+1)))&&v.call(this,o,u,g,d,W,E,C,z))return}},n.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},n.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},n.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,u=l+this.cells.length+1+1,g=0,d=0;d<this.cells.length;d++)g+=this.cells[d].length;var v=new Int32Array(u+g+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var E=u,C=0;C<o.length;C++){var z=o[C];v[l+C]=E,v.set(z,E),E+=z.length}return v[l+o.length]=E,v.set(this.keys,E),v[l+o.length+1]=E+=this.keys.length,v.set(this.bboxes,E),E+=this.bboxes.length,v.buffer},Nc}(),Pu=I(z_);const Yd={};function Ln(l,n,o={}){Object.defineProperty(l,"_classRegistryKey",{value:n,writable:!1}),Yd[n]={klass:l,omit:o.omit||[]}}Ln(Object,"Object"),Pu.serialize=function(l,n){const o=l.toArrayBuffer();return n&&n.add(o),{buffer:o}},Pu.deserialize=function(l){return new Pu(l.buffer)},Object.defineProperty(Pu,"name",{value:"Grid"}),Ln(Pu,"Grid"),typeof DOMMatrix<"u"&&Ln(DOMMatrix,"DOMMatrix"),Ln(tr,"Color"),Ln(Error,"Error"),Ln(Va,"Formatted"),Ln(Bl,"FormattedSection"),Ln(Pi,"AJAXError"),Ln(so,"ResolvedImage"),Ln(Du,"StylePropertyFunction"),Ln(Sp,"StyleExpression",{omit:["_evaluator"]}),Ln(Ws,"ImageIdWithOptions"),Ln($l,"ZoomDependentExpression"),Ln(Lh,"ZoomConstantExpression"),Ln(zo,"CompoundExpression",{omit:["_evaluate"]});for(const l in ql)Yd[ql[l]._classRegistryKey]||Ln(ql[l],`Expression${l}`);function Kd(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function zh(l){return self.ImageBitmap&&l instanceof ImageBitmap}function Xl(l,n){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(Kd(l)||zh(l))return n&&n.add(l),l;if(ArrayBuffer.isView(l))return n&&n.add(l.buffer),l;if(l instanceof ImageData)return n&&n.add(l.data.buffer),l;if(Array.isArray(l)){const o=[];for(const u of l)o.push(Xl(u,n));return o}if(l instanceof Map){const o={$name:"Map"};for(const[u,g]of l.entries())o[u]=Xl(g);return o}if(l instanceof Set){const o={$name:"Set"};let u=0;for(const g of l.values())o[++u]=Xl(g);return o}if(typeof l=="object"){const o=l.constructor,u=o._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${u}".`);const g=o.serialize?o.serialize(l,n):{};if(!o.serialize){for(const d in l)l.hasOwnProperty(d)&&(Yd[u].omit.indexOf(d)>=0||(g[d]=Xl(l[d],n)));l instanceof Error&&(g.message=l.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(g.$name=u),g}throw new Error("can't serialize object of type "+typeof l)}function Qo(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||Kd(l)||zh(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(Qo);if(typeof l=="object"){const n=l.$name||"Object";if(n==="Map"){const g=new Map;for(const d of Object.keys(l))d!=="$name"&&g.set(d,Qo(l[d]));return g}if(n==="Set"){const g=new Set;for(const d of Object.keys(l))d!=="$name"&&g.add(Qo(l[d]));return g}const{klass:o}=Yd[n];if(!o)throw new Error(`Can't deserialize unregistered class "${n}".`);if(o.deserialize)return o.deserialize(l);const u=Object.create(o.prototype);for(const g of Object.keys(l))g!=="$name"&&(u[g]=Qo(l[g]));return u}throw new Error("can't deserialize object of type "+typeof l)}const gn={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519,Osage:l=>l>=66736&&l<=66815,"CJK Unified Ideographs Extension B":l=>l>=131072&&l<=173791};function Wr(l){for(const n of l)if(Zl(n.charCodeAt(0)))return!0;return!1}function Ga(l){for(const n of l)if(!Ep(n.charCodeAt(0)))return!1;return!0}function Ep(l){return!(gn.Arabic(l)||gn["Arabic Supplement"](l)||gn["Arabic Extended-A"](l)||gn["Arabic Presentation Forms-A"](l)||gn["Arabic Presentation Forms-B"](l))}function Zl(l){return!(l!==746&&l!==747&&(l<4352||!(gn["Bopomofo Extended"](l)||gn.Bopomofo(l)||gn["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||gn["CJK Compatibility Ideographs"](l)||gn["CJK Compatibility"](l)||gn["CJK Radicals Supplement"](l)||gn["CJK Strokes"](l)||!(!gn["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||gn["CJK Unified Ideographs Extension A"](l)||gn["CJK Unified Ideographs"](l)||gn["Enclosed CJK Letters and Months"](l)||gn["Hangul Compatibility Jamo"](l)||gn["Hangul Jamo Extended-A"](l)||gn["Hangul Jamo Extended-B"](l)||gn["Hangul Jamo"](l)||gn["Hangul Syllables"](l)||gn.Hiragana(l)||gn["Ideographic Description Characters"](l)||gn.Kanbun(l)||gn["Kangxi Radicals"](l)||gn["Katakana Phonetic Extensions"](l)||gn.Katakana(l)&&l!==12540||!(!gn["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!gn["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||gn["Unified Canadian Aboriginal Syllabics"](l)||gn["Unified Canadian Aboriginal Syllabics Extended"](l)||gn["Vertical Forms"](l)||gn["Yijing Hexagram Symbols"](l)||gn["Yi Syllables"](l)||gn["Yi Radicals"](l))))}function Yl(l){return!(Zl(l)||function(n){return!!(gn["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||gn["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||gn["Letterlike Symbols"](n)||gn["Number Forms"](n)||gn["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||gn["Control Pictures"](n)&&n!==9251||gn["Optical Character Recognition"](n)||gn["Enclosed Alphanumerics"](n)||gn["Geometric Shapes"](n)||gn["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||gn["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||gn["CJK Symbols and Punctuation"](n)||gn.Katakana(n)||gn["Private Use Area"](n)||gn["CJK Compatibility Forms"](n)||gn["Small Form Variants"](n)||gn["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(l))}function kh(l){return l>=1424&&l<=2303||gn["Arabic Presentation Forms-A"](l)||gn["Arabic Presentation Forms-B"](l)}function Fh(l,n){return!(!n&&kh(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||gn.Khmer(l))}function Bc(l){for(const n of l)if(kh(n.charCodeAt(0)))return!0;return!1}const Jd="deferred",xa="loading",Qd="loaded";let Ds=null,Fo="unavailable",Kl=null;const eg=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(Fo="error"),Ds&&Ds(l)};function ef(){Uc.fire(new Oo("pluginStateChange",{pluginStatus:Fo,pluginURL:Kl}))}const Uc=new Fl,Nh=function(){return Fo},ho=function(){if(Fo!==Jd||!Kl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Fo=xa,ef(),Kl&&qi({url:Kl},l=>{l?eg(l):(Fo=Qd,ef())})},Br={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Fo===Qd||Br.applyArabicShaping!=null,isLoading:()=>Fo===xa,setState(l){Fo=l.pluginStatus,Kl=l.pluginURL},isParsed:()=>Br.applyArabicShaping!=null&&Br.processBidirectionalText!=null&&Br.processStyledBidirectionalText!=null,getPluginURL:()=>Kl};class Er{constructor(n,o){this.zoom=n,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(n){return function(o,u){for(const g of o)if(!Fh(g.charCodeAt(0),u))return!1;return!0}(n,Br.isLoaded())}}class Vc{constructor(n,o,u,g){this.property=n,this.value=o,this.expression=function(d,v,E,C){if(Is(d))return new Du(d,v);if(Ph(d)||Array.isArray(d)&&d.length>0){const z=Oh(d,v,E,C);if(z.result==="error")throw new Error(z.value.map(w=>`${w.key}: ${w.message}`).join(", "));return z.value}{let z=d;return typeof d=="string"&&v.type==="color"&&(z=tr.parse(d)),{kind:"constant",configDependencies:new Set,evaluate:()=>z}}}(o===void 0?n.specification.default:o,n.specification,u,g)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,o,u){return this.property.possiblyEvaluate(this,n,o,u)}}class jc{constructor(n,o,u){this.property=n,this.value=new Vc(n,void 0,o,u)}transitioned(n,o){return new Ks(this.property,this.value,o,On({},n.transition,this.transition),n.now)}untransitioned(){return new Ks(this.property,this.value,null,{},0)}}class Bh{constructor(n,o,u){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(n){return Ai(this._values[n].value.value)}setValue(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new jc(this._values[n].property,this._scope,this._options)),this._values[n].value=new Vc(this._values[n].property,o===null?void 0:Ai(o),this._scope,this._options),this._values[n].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].value.expression.configDependencies]))}setTransitionOrValue(n,o){o&&(this._options=o);const u=this._properties.properties;if(n)for(const g in n){const d=n[g];if(ci(g,"-transition")){const v=g.slice(0,-11);u[v]&&this.setTransition(v,d)}else u.hasOwnProperty(g)&&this.setValue(g,d)}}getTransition(n){return Ai(this._values[n].transition)}setTransition(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new jc(this._values[n].property)),this._values[n].transition=Ai(o)||void 0}serialize(){const n={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(n[o]=u);const g=this.getTransition(o);g!==void 0&&(n[`${o}-transition`]=g)}return n}transitioned(n,o){const u=new Gc(this._properties);for(const g of Object.keys(this._values))u._values[g]=this._values[g].transitioned(n,o._values[g]);return u}untransitioned(){const n=new Gc(this._properties);for(const o of Object.keys(this._values))n._values[o]=this._values[o].untransitioned();return n}}class Ks{constructor(n,o,u,g,d){const v=g.delay||0,E=g.duration||0;d=d||0,this.property=n,this.value=o,this.begin=d+v,this.end=this.begin+E,n.specification.transition&&(g.delay||g.duration)&&(this.prior=u)}possiblyEvaluate(n,o,u){const g=n.now||0,d=this.value.possiblyEvaluate(n,o,u),v=this.prior;if(v){if(g>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(g<this.begin)return v.possiblyEvaluate(n,o,u);{const E=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(n,o,u),d,ot(E))}}return d}}class Gc{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,o,u){const g=new Lu(this._properties);for(const d of Object.keys(this._values))g._values[d]=this._values[d].possiblyEvaluate(n,o,u);return g}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class Hc{constructor(n,o,u){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(n){return Ai(this._values[n].value)}setValue(n,o){this._values[n]=new Vc(this._values[n].property,o===null?void 0:Ai(o),this._scope,this._options),this._values[n].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].expression.configDependencies]))}serialize(){const n={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(n[o]=u)}return n}possiblyEvaluate(n,o,u){const g=new Lu(this._properties);for(const d of Object.keys(this._values))g._values[d]=this._values[d].possiblyEvaluate(n,o,u);return g}}class qc{constructor(n,o,u){this.property=n,this.value=o,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,o,u,g){return this.property.evaluate(this.value,this.parameters,n,o,u,g)}}class Lu{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class hn{constructor(n){this.specification=n}possiblyEvaluate(n,o){return n.expression.evaluate(o)}interpolate(n,o,u){const g=Nl[this.specification.type];return g?g(n,o,u):n}}class Dn{constructor(n,o){this.specification=n,this.overrides=o}possiblyEvaluate(n,o,u,g){return new qc(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(o,null,{},u,g)}:n.expression,o)}interpolate(n,o,u){if(n.value.kind!=="constant"||o.value.kind!=="constant")return n;if(n.value.value===void 0||o.value.value===void 0)return new qc(this,{kind:"constant",value:void 0},n.parameters);const g=Nl[this.specification.type];return g?new qc(this,{kind:"constant",value:g(n.value.value,o.value.value,u)},n.parameters):n}evaluate(n,o,u,g,d,v){return n.kind==="constant"?n.value:n.evaluate(o,u,g,d,v)}}class Ou{constructor(n){this.specification=n}possiblyEvaluate(n,o,u,g){return!!n.expression.evaluate(o,null,{},u,g)}interpolate(){return!1}}class $r{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new Er(0,{});for(const u in n){const g=n[u];g.specification.overridable&&this.overridableProperties.push(u);const d=this.defaultPropertyValues[u]=new Vc(g,void 0),v=this.defaultTransitionablePropertyValues[u]=new jc(g);this.defaultTransitioningPropertyValues[u]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=d.possiblyEvaluate(o)}}}Ln(Dn,"DataDrivenProperty"),Ln(hn,"DataConstantProperty"),Ln(Ou,"ColorRampProperty");var bt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function Mp(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function tf(l){if(Array.isArray(l))return l.map(tf);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const n={};for(const o in l)n[o]=tf(l[o]);return n}return Mp(l)}function tg(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const n of l.slice(1))if(!tg(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function ng(l,n="",o=null,u="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};tg(l)||(l=nf(l));const g=l;let d=!0;try{d=function(w){if(!Wc(w))return w;let R=tf(w);return rg(R),R=ig(R),R}(g)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(g,null,2)}
        `)}let v=null,E=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){E=bt[`filter_${u}`];const w=ya(d,E,n,o);if(w.result==="error")throw new Error(w.value.map(R=>`${R.key}: ${R.message}`).join(", "));v=(R,L,A)=>w.value.evaluate(R,L,{},A)}let C=null,z=null;if(d!==g){const w=ya(g,E,n,o);if(w.result==="error")throw new Error(w.value.map(R=>`${R.key}: ${R.message}`).join(", "));C=(R,L,A,D,F)=>w.value.evaluate(R,L,{},A,void 0,void 0,D,F),z=!bu(w.value.expression)}return{filter:v,dynamicFilter:C||void 0,needGeometry:ag(d),needFeature:!!z}}function ig(l){if(!Array.isArray(l))return l;const n=function(o){if(k_.has(o[0])){for(let u=1;u<o.length;u++)if(Wc(o[u]))return!0}return o}(l);return n===!0?n:n.map(o=>ig(o))}function rg(l){let n=!1;const o=[];if(l[0]==="case"){for(let u=1;u<l.length-1;u+=2)n=n||Wc(l[u]),o.push(l[u+1]);o.push(l[l.length-1])}else if(l[0]==="match"){n=n||Wc(l[1]);for(let u=2;u<l.length-1;u+=2)o.push(l[u+1]);o.push(l[l.length-1])}else if(l[0]==="step"){n=n||Wc(l[1]);for(let u=1;u<l.length-1;u+=2)o.push(l[u+1])}n&&(l.length=0,l.push("any",...o));for(let u=1;u<l.length;u++)rg(l[u])}function Wc(l){if(!Array.isArray(l))return!1;if((n=l[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let o=1;o<l.length;o++)if(Wc(l[o]))return!0;return!1}const k_=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function F_(l,n){return l<n?-1:l>n?1:0}function ag(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let n=1;n<l.length;n++)if(ag(l[n]))return!0;return!1}function nf(l){if(!l)return!0;const n=l[0];return l.length<=1?n!=="any":n==="=="?Jl(l[1],l[2],"=="):n==="!="?Ps(Jl(l[1],l[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Jl(l[1],l[2],n):n==="any"?(o=l.slice(1),["any"].concat(o.map(nf))):n==="all"?["all"].concat(l.slice(1).map(nf)):n==="none"?["all"].concat(l.slice(1).map(nf).map(Ps)):n==="in"?og(l[1],l.slice(2)):n==="!in"?Ps(og(l[1],l.slice(2))):n==="has"?Tp(l[1]):n!=="!has"||Ps(Tp(l[1]));var o}function Jl(l,n,o){switch(l){case"$type":return[`filter-type-${o}`,n];case"$id":return[`filter-id-${o}`,n];default:return[`filter-${o}`,l,n]}}function og(l,n){if(n.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(o=>typeof o!=typeof n[0])?["filter-in-large",l,["literal",n.sort(F_)]]:["filter-in-small",l,["literal",n]]}}function Tp(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Ps(l){return["!",l]}const rf="";function ds(l,n){return n?`${l}${rf}${n}`:l}const Ls="-transition",sg=new Set(["fill","line","background","hillshade","raster"]);class Ca extends Fl{constructor(n,o,u,g,d){if(super(),this.id=n.id,this.fqid=ds(this.id,u),this.type=n.type,this.scope=u,this.lut=g,this.options=d,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,n.type!=="custom"){if(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type&&n.type!=="background"&&n.type!=="sky"&&n.type!=="slot"){this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter;const v=ya(this.filter,bt[`filter_${n.type}`]);v.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...v.value.configDependencies]))}if(n.slot&&(this.slot=n.slot),o.layout&&(this._unevaluatedLayout=new Hc(o.layout,this.scope,d),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),o.paint){this._transitionablePaint=new Bh(o.paint,this.scope,d);for(const v in n.paint)this.setPaintProperty(v,n.paint[v]);for(const v in n.layout)this.setLayoutProperty(v,n.layout[v]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Lu(o.paint)}}}onAdd(n){}onRemove(n){}isDraped(n){return!this.is3D()&&sg.has(this.type)}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,o){if(this.type==="custom"&&n==="visibility")return void(this.visibility=o);const u=this._unevaluatedLayout;u._properties.properties[n]&&(u.setValue(n,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),n==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(n){return ci(n,Ls)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,o){const u=this._transitionablePaint,g=u._properties.properties;if(ci(n,Ls)){const R=n.slice(0,-11);return g[R]&&u.setTransition(R,o||void 0),!1}if(!g[n])return!1;const d=u._values[n],v=d.value.isDataDriven(),E=d.value;u.setValue(n,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(n);const C=u._values[n].value,z=C.isDataDriven(),w=ci(n,"pattern")||n==="line-dasharray";return z||v||w||this._handleOverridablePaintPropertyUpdate(n,E,C)}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getDefaultProgramParams(n,o,u){return null}_handleOverridablePaintPropertyUpdate(n,o,u){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,o)}serialize(){return ui({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const n in this.paint._values){const o=this.paint.get(n);if(o instanceof qc&&Ih(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(n){this._filterCompiled||(this._featureFilter=ng(this.filter,this.scope,n),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(n){this._stats&&(n.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(n){}queryIntersectsFeature(n,o,u,g,d,v,E,C,z){}}const N_={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Uh{constructor(n,o){this._structArray=n,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Dr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,o){return n._trim(),o&&(n.isTransferred=!0,o.add(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const o=Object.create(this.prototype);return o.arrayBuffer=n.arrayBuffer,o.length=n.length,o.capacity=n.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...n){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...n){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function sr(l,n=1){let o=0,u=0;return{members:l.map(g=>{const d=N_[g.type].BYTES_PER_ELEMENT,v=o=Ap(o,Math.max(n,d)),E=g.components||1;return u=Math.max(u,d),o+=d*E,{name:g.name,type:g.type,components:E,offset:v}}),size:Ap(o,Math.max(u,n)),alignment:n}}function Ap(l,n){return Math.ceil(l/n)*n}class vl extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o){const u=this.length;return this.resize(u+1),this.emplace(u,n,o)}emplace(n,o,u){const g=2*n;return this.int16[g+0]=o,this.int16[g+1]=u,n}}vl.prototype.bytesPerElement=4,Ln(vl,"StructArrayLayout2i4");class zu extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u){const g=this.length;return this.resize(g+1),this.emplace(g,n,o,u)}emplace(n,o,u,g){const d=3*n;return this.int16[d+0]=o,this.int16[d+1]=u,this.int16[d+2]=g,n}}zu.prototype.bytesPerElement=6,Ln(zu,"StructArrayLayout3i6");class Js extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,g){const d=this.length;return this.resize(d+1),this.emplace(d,n,o,u,g)}emplace(n,o,u,g,d){const v=4*n;return this.int16[v+0]=o,this.int16[v+1]=u,this.int16[v+2]=g,this.int16[v+3]=d,n}}Js.prototype.bytesPerElement=8,Ln(Js,"StructArrayLayout4i8");class af extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,g,d){const v=this.length;return this.resize(v+1),this.emplace(v,n,o,u,g,d)}emplace(n,o,u,g,d,v){const E=5*n;return this.int16[E+0]=o,this.int16[E+1]=u,this.int16[E+2]=g,this.int16[E+3]=d,this.int16[E+4]=v,n}}af.prototype.bytesPerElement=10,Ln(af,"StructArrayLayout5i10");class Vh extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,g,d,v,E){const C=this.length;return this.resize(C+1),this.emplace(C,n,o,u,g,d,v,E)}emplace(n,o,u,g,d,v,E,C){const z=6*n,w=12*n,R=3*n;return this.int16[z+0]=o,this.int16[z+1]=u,this.uint8[w+4]=g,this.uint8[w+5]=d,this.uint8[w+6]=v,this.uint8[w+7]=E,this.float32[R+2]=C,n}}Vh.prototype.bytesPerElement=12,Ln(Vh,"StructArrayLayout2i4ub1f12");class yl extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u){const g=this.length;return this.resize(g+1),this.emplace(g,n,o,u)}emplace(n,o,u,g){const d=3*n;return this.float32[d+0]=o,this.float32[d+1]=u,this.float32[d+2]=g,n}}yl.prototype.bytesPerElement=12,Ln(yl,"StructArrayLayout3f12");class Qa extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,g,d){const v=this.length;return this.resize(v+1),this.emplace(v,n,o,u,g,d)}emplace(n,o,u,g,d,v){const E=6*n,C=3*n;return this.uint16[E+0]=o,this.uint16[E+1]=u,this.uint16[E+2]=g,this.uint16[E+3]=d,this.float32[C+2]=v,n}}Qa.prototype.bytesPerElement=12,Ln(Qa,"StructArrayLayout4ui1f12");class of extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,g){const d=this.length;return this.resize(d+1),this.emplace(d,n,o,u,g)}emplace(n,o,u,g,d){const v=4*n;return this.uint16[v+0]=o,this.uint16[v+1]=u,this.uint16[v+2]=g,this.uint16[v+3]=d,n}}of.prototype.bytesPerElement=8,Ln(of,"StructArrayLayout4ui8");class jh extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,g,d,v){const E=this.length;return this.resize(E+1),this.emplace(E,n,o,u,g,d,v)}emplace(n,o,u,g,d,v,E){const C=6*n;return this.int16[C+0]=o,this.int16[C+1]=u,this.int16[C+2]=g,this.int16[C+3]=d,this.int16[C+4]=v,this.int16[C+5]=E,n}}jh.prototype.bytesPerElement=12,Ln(jh,"StructArrayLayout6i12");class sf extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,g,d,v,E,C,z,w,R,L){const A=this.length;return this.resize(A+1),this.emplace(A,n,o,u,g,d,v,E,C,z,w,R,L)}emplace(n,o,u,g,d,v,E,C,z,w,R,L,A){const D=12*n;return this.int16[D+0]=o,this.int16[D+1]=u,this.int16[D+2]=g,this.int16[D+3]=d,this.uint16[D+4]=v,this.uint16[D+5]=E,this.uint16[D+6]=C,this.uint16[D+7]=z,this.int16[D+8]=w,this.int16[D+9]=R,this.int16[D+10]=L,this.int16[D+11]=A,n}}sf.prototype.bytesPerElement=24,Ln(sf,"StructArrayLayout4i4ui4i24");class Cp extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,g,d,v){const E=this.length;return this.resize(E+1),this.emplace(E,n,o,u,g,d,v)}emplace(n,o,u,g,d,v,E){const C=10*n,z=5*n;return this.int16[C+0]=o,this.int16[C+1]=u,this.int16[C+2]=g,this.float32[z+2]=d,this.float32[z+3]=v,this.float32[z+4]=E,n}}Cp.prototype.bytesPerElement=20,Ln(Cp,"StructArrayLayout3i3f20");class $c extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,g){const d=this.length;return this.resize(d+1),this.emplace(d,n,o,u,g)}emplace(n,o,u,g,d){const v=4*n;return this.float32[v+0]=o,this.float32[v+1]=u,this.float32[v+2]=g,this.float32[v+3]=d,n}}$c.prototype.bytesPerElement=16,Ln($c,"StructArrayLayout4f16");class lg extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint32[1*n+0]=o,n}}lg.prototype.bytesPerElement=4,Ln(lg,"StructArrayLayout1ul4");class Xc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o){const u=this.length;return this.resize(u+1),this.emplace(u,n,o)}emplace(n,o,u){const g=2*n;return this.uint16[g+0]=o,this.uint16[g+1]=u,n}}Xc.prototype.bytesPerElement=4,Ln(Xc,"StructArrayLayout2ui4");class Rp extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,g,d,v,E,C,z,w,R,L,A){const D=this.length;return this.resize(D+1),this.emplace(D,n,o,u,g,d,v,E,C,z,w,R,L,A)}emplace(n,o,u,g,d,v,E,C,z,w,R,L,A,D){const F=20*n,W=10*n;return this.int16[F+0]=o,this.int16[F+1]=u,this.int16[F+2]=g,this.int16[F+3]=d,this.int16[F+4]=v,this.float32[W+3]=E,this.float32[W+4]=C,this.float32[W+5]=z,this.float32[W+6]=w,this.int16[F+14]=R,this.uint32[W+8]=L,this.uint16[F+18]=A,this.uint16[F+19]=D,n}}Rp.prototype.bytesPerElement=40,Ln(Rp,"StructArrayLayout5i4f1i1ul2ui40");class Zc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,g,d,v,E){const C=this.length;return this.resize(C+1),this.emplace(C,n,o,u,g,d,v,E)}emplace(n,o,u,g,d,v,E,C){const z=8*n;return this.int16[z+0]=o,this.int16[z+1]=u,this.int16[z+2]=g,this.int16[z+4]=d,this.int16[z+5]=v,this.int16[z+6]=E,this.int16[z+7]=C,n}}Zc.prototype.bytesPerElement=16,Ln(Zc,"StructArrayLayout3i2i2i16");class lf extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,g,d){const v=this.length;return this.resize(v+1),this.emplace(v,n,o,u,g,d)}emplace(n,o,u,g,d,v){const E=4*n,C=8*n;return this.float32[E+0]=o,this.float32[E+1]=u,this.float32[E+2]=g,this.int16[C+6]=d,this.int16[C+7]=v,n}}lf.prototype.bytesPerElement=16,Ln(lf,"StructArrayLayout2f1f2i16");class Gh extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,g,d,v){const E=this.length;return this.resize(E+1),this.emplace(E,n,o,u,g,d,v)}emplace(n,o,u,g,d,v,E){const C=20*n,z=5*n;return this.uint8[C+0]=o,this.uint8[C+1]=u,this.float32[z+1]=g,this.float32[z+2]=d,this.float32[z+3]=v,this.float32[z+4]=E,n}}Gh.prototype.bytesPerElement=20,Ln(Gh,"StructArrayLayout2ub4f20");class Ha extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u){const g=this.length;return this.resize(g+1),this.emplace(g,n,o,u)}emplace(n,o,u,g){const d=3*n;return this.uint16[d+0]=o,this.uint16[d+1]=u,this.uint16[d+2]=g,n}}Ha.prototype.bytesPerElement=6,Ln(Ha,"StructArrayLayout3ui6");class Ip extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,u,g,d,v,E,C,z,w,R,L,A,D,F,W,$,ie,re,ee,ae){const de=this.length;return this.resize(de+1),this.emplace(de,n,o,u,g,d,v,E,C,z,w,R,L,A,D,F,W,$,ie,re,ee,ae)}emplace(n,o,u,g,d,v,E,C,z,w,R,L,A,D,F,W,$,ie,re,ee,ae,de){const ye=30*n,De=15*n,Ie=60*n;return this.int16[ye+0]=o,this.int16[ye+1]=u,this.int16[ye+2]=g,this.float32[De+2]=d,this.float32[De+3]=v,this.uint16[ye+8]=E,this.uint16[ye+9]=C,this.uint32[De+5]=z,this.uint32[De+6]=w,this.uint32[De+7]=R,this.uint16[ye+16]=L,this.uint16[ye+17]=A,this.uint16[ye+18]=D,this.float32[De+10]=F,this.float32[De+11]=W,this.uint8[Ie+48]=$,this.uint8[Ie+49]=ie,this.uint8[Ie+50]=re,this.uint32[De+13]=ee,this.int16[ye+28]=ae,this.uint8[Ie+58]=de,n}}Ip.prototype.bytesPerElement=60,Ln(Ip,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Os extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,u,g,d,v,E,C,z,w,R,L,A,D,F,W,$,ie,re,ee,ae,de,ye,De,Ie,Re,$e,Oe,Ye,tt,Je,rt){const ct=this.length;return this.resize(ct+1),this.emplace(ct,n,o,u,g,d,v,E,C,z,w,R,L,A,D,F,W,$,ie,re,ee,ae,de,ye,De,Ie,Re,$e,Oe,Ye,tt,Je,rt)}emplace(n,o,u,g,d,v,E,C,z,w,R,L,A,D,F,W,$,ie,re,ee,ae,de,ye,De,Ie,Re,$e,Oe,Ye,tt,Je,rt,ct){const yt=20*n,st=40*n,Bt=80*n;return this.float32[yt+0]=o,this.float32[yt+1]=u,this.int16[st+4]=g,this.int16[st+5]=d,this.int16[st+6]=v,this.int16[st+7]=E,this.int16[st+8]=C,this.int16[st+9]=z,this.int16[st+10]=w,this.int16[st+11]=R,this.int16[st+12]=L,this.uint16[st+13]=A,this.uint16[st+14]=D,this.uint16[st+15]=F,this.uint16[st+16]=W,this.uint16[st+17]=$,this.uint16[st+18]=ie,this.uint16[st+19]=re,this.uint16[st+20]=ee,this.uint16[st+21]=ae,this.uint16[st+22]=de,this.uint16[st+23]=ye,this.uint16[st+24]=De,this.uint16[st+25]=Ie,this.uint16[st+26]=Re,this.uint16[st+27]=$e,this.uint32[yt+14]=Oe,this.float32[yt+15]=Ye,this.float32[yt+16]=tt,this.float32[yt+17]=Je,this.float32[yt+18]=rt,this.uint8[Bt+76]=ct,n}}Os.prototype.bytesPerElement=80,Ln(Os,"StructArrayLayout2f9i15ui1ul4f1ub80");class Qs extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.float32[1*n+0]=o,n}}Qs.prototype.bytesPerElement=4,Ln(Qs,"StructArrayLayout1f4");class No extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,g,d){const v=this.length;return this.resize(v+1),this.emplace(v,n,o,u,g,d)}emplace(n,o,u,g,d,v){const E=5*n;return this.float32[E+0]=o,this.float32[E+1]=u,this.float32[E+2]=g,this.float32[E+3]=d,this.float32[E+4]=v,n}}No.prototype.bytesPerElement=20,Ln(No,"StructArrayLayout5f20");class xl extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,g,d,v,E){const C=this.length;return this.resize(C+1),this.emplace(C,n,o,u,g,d,v,E)}emplace(n,o,u,g,d,v,E,C){const z=7*n;return this.float32[z+0]=o,this.float32[z+1]=u,this.float32[z+2]=g,this.float32[z+3]=d,this.float32[z+4]=v,this.float32[z+5]=E,this.float32[z+6]=C,n}}xl.prototype.bytesPerElement=28,Ln(xl,"StructArrayLayout7f28");class zs extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,g,d,v,E,C,z,w,R){const L=this.length;return this.resize(L+1),this.emplace(L,n,o,u,g,d,v,E,C,z,w,R)}emplace(n,o,u,g,d,v,E,C,z,w,R,L){const A=11*n;return this.float32[A+0]=o,this.float32[A+1]=u,this.float32[A+2]=g,this.float32[A+3]=d,this.float32[A+4]=v,this.float32[A+5]=E,this.float32[A+6]=C,this.float32[A+7]=z,this.float32[A+8]=w,this.float32[A+9]=R,this.float32[A+10]=L,n}}zs.prototype.bytesPerElement=44,Ln(zs,"StructArrayLayout11f44");class Hh extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,g,d,v,E,C,z){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,u,g,d,v,E,C,z)}emplace(n,o,u,g,d,v,E,C,z,w){const R=9*n;return this.float32[R+0]=o,this.float32[R+1]=u,this.float32[R+2]=g,this.float32[R+3]=d,this.float32[R+4]=v,this.float32[R+5]=E,this.float32[R+6]=C,this.float32[R+7]=z,this.float32[R+8]=w,n}}Hh.prototype.bytesPerElement=36,Ln(Hh,"StructArrayLayout9f36");class ku extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o){const u=this.length;return this.resize(u+1),this.emplace(u,n,o)}emplace(n,o,u){const g=2*n;return this.float32[g+0]=o,this.float32[g+1]=u,n}}ku.prototype.bytesPerElement=8,Ln(ku,"StructArrayLayout2f8");class Dp extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,g){const d=this.length;return this.resize(d+1),this.emplace(d,n,o,u,g)}emplace(n,o,u,g,d){const v=6*n;return this.uint32[3*n+0]=o,this.uint16[v+2]=u,this.uint16[v+3]=g,this.uint16[v+4]=d,n}}Dp.prototype.bytesPerElement=12,Ln(Dp,"StructArrayLayout1ul3ui12");class Ql extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint16[1*n+0]=o,n}}Ql.prototype.bytesPerElement=2,Ln(Ql,"StructArrayLayout1ui2");class Yc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,g,d,v,E,C,z,w,R,L,A,D,F,W){const $=this.length;return this.resize($+1),this.emplace($,n,o,u,g,d,v,E,C,z,w,R,L,A,D,F,W)}emplace(n,o,u,g,d,v,E,C,z,w,R,L,A,D,F,W,$){const ie=16*n;return this.float32[ie+0]=o,this.float32[ie+1]=u,this.float32[ie+2]=g,this.float32[ie+3]=d,this.float32[ie+4]=v,this.float32[ie+5]=E,this.float32[ie+6]=C,this.float32[ie+7]=z,this.float32[ie+8]=w,this.float32[ie+9]=R,this.float32[ie+10]=L,this.float32[ie+11]=A,this.float32[ie+12]=D,this.float32[ie+13]=F,this.float32[ie+14]=W,this.float32[ie+15]=$,n}}Yc.prototype.bytesPerElement=64,Ln(Yc,"StructArrayLayout16f64");class qh extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,g,d,v,E){const C=this.length;return this.resize(C+1),this.emplace(C,n,o,u,g,d,v,E)}emplace(n,o,u,g,d,v,E,C){const z=10*n,w=5*n;return this.uint16[z+0]=o,this.uint16[z+1]=u,this.uint16[z+2]=g,this.uint16[z+3]=d,this.float32[w+2]=v,this.float32[w+3]=E,this.float32[w+4]=C,n}}qh.prototype.bytesPerElement=20,Ln(qh,"StructArrayLayout4ui3f20");class Pp extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.int16[1*n+0]=o,n}}Pp.prototype.bytesPerElement=2,Ln(Pp,"StructArrayLayout1i2");class cf extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint8[1*n+0]=o,n}}cf.prototype.bytesPerElement=1,Ln(cf,"StructArrayLayout1ub1");class uf extends Uh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}uf.prototype.size=40;class Lp extends Rp{get(n){return new uf(this,n)}}Ln(Lp,"CollisionBoxArray");class Fu extends Uh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}Fu.prototype.size=60;class cg extends Ip{get(n){return new Fu(this,n)}}Ln(cg,"PlacedSymbolArray");class ug extends Uh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(n){this._structArray.uint32[this._pos4+14]=n}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(n){this._structArray.float32[this._pos4+18]=n}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}ug.prototype.size=80;class B_ extends Os{get(n){return new ug(this,n)}}Ln(B_,"SymbolInstanceArray");class hg extends Qs{getoffsetX(n){return this.float32[1*n+0]}}Ln(hg,"GlyphOffsetArray");class eo extends vl{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}Ln(eo,"SymbolLineVertexArray");class za extends Uh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}za.prototype.size=12;class Wh extends Dp{get(n){return new za(this,n)}}Ln(Wh,"FeatureIndexArray");class Bo extends Xc{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}Ln(Bo,"FillExtrusionCentroidArray");class $h extends Uh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}$h.prototype.size=6;class dg extends zu{get(n){return new $h(this,n)}}Ln(dg,"FillExtrusionWallArray");const U_=sr([{name:"a_pos",components:2,type:"Int16"}],4),hf=sr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Jr{constructor(n=[]){this.segments=n}_prepareSegment(n,o,u,g){let d=this.segments[this.segments.length-1];return n>Jr.MAX_VERTEX_ARRAY_LENGTH&&Wn(`Max vertices per segment is ${Jr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!d||d.vertexLength+n>Jr.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==g)&&(d={vertexOffset:o,primitiveOffset:u,vertexLength:0,primitiveLength:0},g!==void 0&&(d.sortKey=g),this.segments.push(d)),d}prepareSegment(n,o,u,g){return this._prepareSegment(n,o.length,u.length,g)}get(){return this.segments}destroy(){for(const n of this.segments)for(const o in n.vaos)n.vaos[o].destroy()}static simpleSegment(n,o,u,g){return new Jr([{vertexOffset:n,primitiveOffset:o,vertexLength:u,primitiveLength:g,vaos:{},sortKey:0}])}}function df(l,n){return 256*(l=gt(Math.floor(l),0,255))+gt(Math.floor(n),0,255)}Jr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ln(Jr,"SegmentVector");const V_=sr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Op=sr([{name:"a_dash",components:4,type:"Uint16"}]);class Nu{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(n,o,u,g){this.ids.push(zp(n)),this.positions.push(o,u,g)}eachPosition(n,o){const u=zp(n);let g=0,d=this.ids.length-1;for(;g<d;){const v=g+d>>1;this.ids[v]>=u?d=v:g=v+1}for(;this.ids[g]===u;)o(this.positions[3*g],this.positions[3*g+1],this.positions[3*g+2]),g++}static serialize(n,o){const u=new Float64Array(n.ids),g=new Uint32Array(n.positions);return Bu(u,g,0,u.length-1),o&&(o.add(u.buffer),o.add(g.buffer)),{ids:u,positions:g}}static deserialize(n){const o=new Nu;let u;o.ids=n.ids,o.positions=n.positions;for(const g of o.ids)g!==u&&o.uniqueIds.push(g),u=g;return o.indexed=!0,o}}function zp(l){const n=+l;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:ra(String(l))}function Bu(l,n,o,u){for(;o<u;){const g=l[o+u>>1];let d=o-1,v=u+1;for(;;){do d++;while(l[d]<g);do v--;while(l[v]>g);if(d>=v)break;ff(l,d,v),ff(n,3*d,3*v),ff(n,3*d+1,3*v+1),ff(n,3*d+2,3*v+2)}v-o<u-v?(Bu(l,n,o,v),o=v+1):(Bu(l,n,v+1,u),u=v)}}function ff(l,n,o){const u=l[n];l[n]=l[o],l[o]=u}Ln(Nu,"FeaturePositionMap");class ks{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,o),this.initialized=!0),!!this.location}set(n,o,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Uu extends ks{constructor(n){super(n),this.current=0}set(n,o,u){this.fetchUniformLocation(n,o)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class aa extends ks{constructor(n){super(n),this.current=0}set(n,o,u){this.fetchUniformLocation(n,o)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class fs extends ks{constructor(n){super(n),this.current=[0,0]}set(n,o,u){this.fetchUniformLocation(n,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Kc extends ks{constructor(n){super(n),this.current=[0,0,0]}set(n,o,u){this.fetchUniformLocation(n,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class Xh extends ks{constructor(n){super(n),this.current=[0,0,0,0]}set(n,o,u){this.fetchUniformLocation(n,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class bl extends ks{constructor(n){super(n),this.current=tr.transparent.toRenderColor(null)}set(n,o,u){this.fetchUniformLocation(n,o)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const kp=new Float32Array(16);class pf extends ks{constructor(n){super(n),this.current=kp}set(n,o,u){if(this.fetchUniformLocation(n,o)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let g=1;g<16;g++)if(u[g]!==this.current[g]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const Fp=new Float32Array(9),fg=new Float32Array(4);class ec extends ks{constructor(n){super(n),this.current=fg}set(n,o,u){if(this.fetchUniformLocation(n,o)){for(let g=0;g<4;g++)if(u[g]!==this.current[g]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function el(l){return[df(255*l.r,255*l.g),df(255*l.b,255*l.a)]}class es{constructor(n,o,u,g){this.value=n,this.uniformNames=o.map(d=>`u_${d}`),this.type=u,this.context=g}setUniform(n,o,u,g,d){const v=g.constantOr(this.value);o.set(n,d,v instanceof tr?v.toRenderColor(this.ignoreLut?null:this.context.lut):v)}getBinding(n,o){return this.type==="color"?new bl(n):new aa(n)}}class Uo{constructor(n,o){this.uniformNames=o.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(n){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br)}setUniform(n,o,u,g,d){const v=d==="u_pattern"||d==="u_dash"?this.pattern:d==="u_pixel_ratio"?this.pixelRatio:null;v&&o.set(n,d,v)}getBinding(n,o){return o==="u_pattern"||o==="u_dash"?new Xh(n):new aa(n)}}class tl{constructor(n,o,u,g){this.expression=n,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(d=>({name:`a_${d}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(n,o,u,g,d,v,E){const C=this.paintVertexArray.length,z=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Er(0,{brightness:v}),o,{},d,g,E):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new Er(0,{brightness:v}),o,{},d,g,E)==="none"),this.paintVertexArray.resize(n),this._setPaintValue(C,n,z,this.context)}updatePaintArray(n,o,u,g,d,v,E){const C=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:E},u,g,void 0,d):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:0,brightness:E},u,g,void 0,d)==="none"),this._setPaintValue(n,o,C,this.context)}_setPaintValue(n,o,u,g){if(this.type==="color"){const d=el(u.toRenderColor(this.ignoreLut?null:g.lut));for(let v=n;v<o;v++)this.paintVertexArray.emplace(v,d[0],d[1])}else{for(let d=n;d<o;d++)this.paintVertexArray.emplace(d,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ps{constructor(n,o,u,g,d,v){this.expression=n,this.uniformNames=o.map(E=>`u_${E}_t`),this.type=u,this.useIntegerZoom=g,this.context=d,this.maxValue=0,this.paintVertexAttributes=o.map(E=>({name:`a_${E}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(n,o,u,g,d,v,E){const C=this.expression.evaluate(new Er(this.context.zoom,{brightness:v}),o,{},d,g,E),z=this.expression.evaluate(new Er(this.context.zoom+1,{brightness:v}),o,{},d,g,E);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new Er(this.context.zoom,{brightness:v}),o,{},d,g,E)==="none");const w=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(w,n,C,z,this.context)}updatePaintArray(n,o,u,g,d,v,E){const C=this.expression.evaluate({zoom:this.context.zoom,brightness:E},u,g,void 0,d),z=this.expression.evaluate({zoom:this.context.zoom+1,brightness:E},u,g,void 0,d);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:this.context.zoom,brightness:E},u,g,void 0,d)==="none"),this._setPaintValue(n,o,C,z,this.context)}_setPaintValue(n,o,u,g,d){if(this.type==="color"){const v=el(u.toRenderColor(this.ignoreLut?null:d.lut)),E=el(u.toRenderColor(this.ignoreLut?null:d.lut));for(let C=n;C<o;C++)this.paintVertexArray.emplace(C,v[0],v[1],E[0],E[1])}else{for(let v=n;v<o;v++)this.paintVertexArray.emplace(v,u,g);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(g))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,o,u,g,d){const v=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,E=gt(this.expression.interpolationFactor(v,this.context.zoom,this.context.zoom+1),0,1);o.set(n,d,E)}getBinding(n,o){return new aa(n)}}class Fs{constructor(n,o,u,g,d){this.expression=n,this.layerId=d,this.paintVertexAttributes=(u==="array"?Op:V_).members;for(let v=0;v<o.length;++v);this.paintVertexArray=new g}populatePaintArray(n,o,u,g){const d=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(d,n,o.patterns&&o.patterns[this.layerId],u)}updatePaintArray(n,o,u,g,d,v,E){this._setPaintValues(n,o,u.patterns&&u.patterns[this.layerId],v)}_setPaintValues(n,o,u,g){if(!g||!u)return;const d=g[u];if(!d)return;const{tl:v,br:E,pixelRatio:C}=d;for(let z=n;z<o;z++)this.paintVertexArray.emplace(z,v[0],v[1],E[0],E[1],C)}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class wl{constructor(n,o,u=()=>!0){this.binders={},this._buffers=[],this.context=o;const g=[];for(const d in n.paint._values){const v=n.paint.get(d),E=n.paint.get(`${d}-use-theme`);if(d.endsWith("-use-theme")||!u(d)||!(v instanceof qc&&Ih(v.property.specification)))continue;const C=Np(d,n.type),z=v.value,w=v.property.specification.type,R=!!v.property.useIntegerZoom,L=d==="line-dasharray"||d.endsWith("pattern"),A=d==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant"||E&&E.value.kind!=="constant";if(z.kind!=="constant"||A)if(z.kind==="source"||A||L){const D=Bp(d,w,"source");this.binders[d]=L?new Fs(z,C,w,D,n.id):new tl(z,C,w,D),g.push(`/a_${d}`)}else{const D=Bp(d,w,"composite");this.binders[d]=new ps(z,C,w,R,o,D),g.push(`/z_${d}`)}else this.binders[d]=L?new Uo(z.value,C):new es(z.value,C,w,o),g.push(`/u_${d}`);E&&(this.binders[d].ignoreLut=E.constantOr("default")==="none",this.binders[d].lutExpression=E.value,this.binders[d].checkUseTheme=!0)}this.cacheKey=g.sort().join("")}getMaxValue(n){const o=this.binders[n];return o instanceof tl||o instanceof ps?o.maxValue:0}populatePaintArrays(n,o,u,g,d,v,E){for(const C in this.binders){const z=this.binders[C];z.context=this.context,z instanceof tl||z instanceof ps||z instanceof Fs?z.populatePaintArray(n,o,u,g,d,v,E):z.lutExpression&&z instanceof es&&z.lutExpression&&(z.lutExpression.kind==="composite"||z.lutExpression.kind==="source")&&(z.ignoreLut=z.lutExpression.evaluate(new Er(0,{brightness:v}),o,{},d,g,E)==="none")}}setConstantPatternPositions(n){for(const o in this.binders){const u=this.binders[o];u instanceof Uo&&u.setConstantPatternPositions(n)}}updatePaintArrays(n,o,u,g,d,v,E,C,z){let w=!1;const R=Object.keys(n),L=R.length!==0&&!C,A=L?R:o.uniqueIds;this.context.lut=d.lut;for(const D in this.binders){const F=this.binders[D];if(F.context=this.context,(F instanceof tl||F instanceof ps||F instanceof Fs)&&F.expression&&F.expression.kind&&F.expression.kind!=="constant"&&(F.expression.isStateDependent===!0||F.expression.isLightConstant===!1)){const W=d.paint.get(D);F.expression=W.value;for(const $ of A){const ie=n[$.toString()];o.eachPosition($,(re,ee,ae)=>{const de=g.feature(re);F.updatePaintArray(ee,ae,de,ie,v,E,z)})}if(!L)for(const $ of u.uniqueIds){const ie=n[$.toString()];u.eachPosition($,(re,ee,ae)=>{const de=g.feature(re);F.updatePaintArray(ee,ae,de,ie,v,E,z)})}w=!0}}return w}defines(){const n=[];for(const o in this.binders){const u=this.binders[o];(u instanceof es||u instanceof Uo)&&n.push(...u.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return n}getBinderAttributes(){const n=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof tl||u instanceof ps||u instanceof Fs)for(let g=0;g<u.paintVertexAttributes.length;g++)n.push(u.paintVertexAttributes[g].name)}return n}getBinderUniforms(){const n=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof es||u instanceof Uo||u instanceof ps)for(const g of u.uniformNames)n.push(g)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){const o=[];for(const u in this.binders){const g=this.binders[u];if(g instanceof es||g instanceof Uo||g instanceof ps)for(const d of g.uniformNames)o.push({name:d,property:u,binding:g.getBinding(n,d)})}return o}setUniforms(n,o,u,g,d){for(const{name:v,property:E,binding:C}of u){if(this.binders[E].checkUseTheme&&this.binders[E]instanceof es){const z=g.get(`${E}-use-theme`);z.isConstant()&&(this.binders[E].ignoreLut=z.constantOr("default")==="none")}this.binders[E].setUniform(n,C,d,g.get(E),v)}}updatePaintBuffers(){this._buffers=[];for(const n in this.binders){const o=this.binders[n];(o instanceof tl||o instanceof ps||o instanceof Fs)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(n){for(const o in this.binders){const u=this.binders[o];(u instanceof tl||u instanceof ps||u instanceof Fs)&&u.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const o=this.binders[n];(o instanceof tl||o instanceof ps||o instanceof Fs)&&o.destroy()}}}class ts{constructor(n,o,u=()=>!0){this.programConfigurations={};for(const g of n)this.programConfigurations[g.id]=new wl(g,o,u);this.needsUpload=!1,this._featureMap=new Nu,this._featureMapWithoutIds=new Nu,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(n,o,u,g,d,v,E,C){for(const z in this.programConfigurations)this.programConfigurations[z].populatePaintArrays(n,o,g,d,v,E,C);o.id!==void 0?this._featureMap.add(o.id,u,this._bufferOffset,n):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,n),this._idlessCounter+=1),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,o,u,g,d,v,E){for(const C of u)this.needsUpload=this.programConfigurations[C.id].updatePaintArrays(n,this._featureMap,this._featureMapWithoutIds,o,C,g,d,v,E||0)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const Co={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Np(l,n){return Co[l]||[l.replace(`${n}-`,"").replace(/-/g,"_")]}const j_={"line-pattern":{source:Qa,composite:Qa},"fill-pattern":{source:Qa,composite:Qa},"fill-extrusion-pattern":{source:Qa,composite:Qa},"line-dasharray":{source:of,composite:of}},nl={color:{source:ku,composite:$c},number:{source:Qs,composite:ku}};function Bp(l,n,o){const u=j_[l];return u&&u[o]||nl[n][o]}Ln(es,"ConstantBinder"),Ln(Uo,"PatternConstantBinder"),Ln(tl,"SourceExpressionBinder"),Ln(Fs,"PatternCompositeBinder"),Ln(ps,"CompositeExpressionBinder"),Ln(wl,"ProgramConfiguration",{omit:["_buffers"]}),Ln(ts,"ProgramConfigurationSet");const fo=yn/Math.PI/2,ms=5,tc=6,Zh=16383,Jc=64,Yh=[Jc,32,16],bo=-fo,wo=fo;function Vu(l,n,o,u=fo){return o=Mn(o),[l*Math.sin(o)*u,-n*u,l*Math.cos(o)*u]}function Qc(l,n,o){return Vu(Math.cos(Mn(l)),Math.sin(Mn(l)),n,o)}const il=63710088e-1,Sl=2*Math.PI*il;class Ji{constructor(n,o){if(isNaN(n)||isNaN(o))throw new Error(`Invalid LngLat object: (${n}, ${o})`);if(this.lng=+n,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ji(an(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const o=Math.PI/180,u=this.lat*o,g=n.lat*o,d=Math.sin(u)*Math.sin(g)+Math.cos(u)*Math.cos(g)*Math.cos((n.lng-this.lng)*o);return il*Math.acos(Math.min(d,1))}toBounds(n=0){const o=360*n/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new nc({lng:this.lng-u,lat:this.lat-o},{lng:this.lng+u,lat:this.lat+o})}toEcef(n){return Qc(this.lat,this.lng,fo+n*fo/il)}static convert(n){if(n instanceof Ji)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new Ji(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new Ji(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class nc{constructor(n,o){if(n)if(o)this.setSouthWest(n).setNorthEast(o);else if(n.length===4){const u=n;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=n;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(n){return this._ne=n instanceof Ji?new Ji(n.lng,n.lat):Ji.convert(n),this}setSouthWest(n){return this._sw=n instanceof Ji?new Ji(n.lng,n.lat):Ji.convert(n),this}extend(n){const o=this._sw,u=this._ne;let g,d;if(n instanceof Ji)g=n,d=n;else{if(!(n instanceof nc))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(nc.convert(n)):this.extend(Ji.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&(n.hasOwnProperty("lon")||n.hasOwnProperty("lng"))?this.extend(Ji.convert(n)):this;if(g=n._sw,d=n._ne,!g||!d)return this}return o||u?(o.lng=Math.min(g.lng,o.lng),o.lat=Math.min(g.lat,o.lat),u.lng=Math.max(d.lng,u.lng),u.lat=Math.max(d.lat,u.lat)):(this._sw=new Ji(g.lng,g.lat),this._ne=new Ji(d.lng,d.lat)),this}getCenter(){return new Ji((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ji(this.getWest(),this.getNorth())}getSouthEast(){return new Ji(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:o,lat:u}=Ji.convert(n);let g=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&g}static convert(n){if(n)return n instanceof nc?n:new nc(n)}}const ju=0,gs=25.5;function mf(l){return Sl*Math.cos(l*Math.PI/180)}function rl(l){return(180+l)/360}function Ns(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function po(l,n){return l/mf(n)}function Ro(l){return 360*l-180}function Ra(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function El(l,n){return l*mf(Ra(n))}const Mr=85.051129;function gf(l){return Math.cos(Mn(gt(l,-85.051129,Mr)))}function Gu(l,n){const o=gt(n,ju,gs),u=Math.pow(2,o);return gf(l)*Sl/(512*u)}function f(l){return 1/Math.cos(l*Math.PI/180)}function i(l,n=0){const o=Math.exp(Math.PI*(1-(l.y+n/yn)/(1<<l.z)*2));return 80150034*o/(o*o+1)/yn/(1<<l.z)}class s{constructor(n,o,u=0){this.x=+n,this.y=+o,this.z=+u}static fromLngLat(n,o=0){const u=Ji.convert(n);return new s(rl(u.lng),Ns(u.lat),po(o,u.lat))}toLngLat(){return new Ji(Ro(this.x),Ra(this.y))}toAltitude(){return El(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Sl*f(Ra(this.y))}}function m(l,n,o,u,g,d,v,E,C){const z=(n+u)/2,w=(o+g)/2,R=new ke(z,w);E(R),function(L,A,D,F,W,$){const ie=D-W,re=F-$;return Math.abs((F-A)*ie-(D-L)*re)/Math.hypot(ie,re)}(R.x,R.y,d.x,d.y,v.x,v.y)>=C?(m(l,n,o,z,w,d,R,E,C),m(l,z,w,u,g,R,v,E,C)):l.push(v)}function x(l,n,o){let u=l[0],g=u.x,d=u.y;n(u);const v=[u];for(let E=1;E<l.length;E++){const C=l[E],{x:z,y:w}=C;n(C),m(v,g,d,z,w,u,C,n,o),g=z,d=w,u=C}return v}function b(l,n,o,u){if(u(n,o)){const g=n.add(o)._mult(.5);b(l,n,g,u),b(l,g,o,u)}else l.push(o)}function T(l,n){let o=l[0];const u=[o];for(let g=1;g<l.length;g++){const d=l[g];b(u,o,d,n),o=d}return u}const P=Math.pow(2,14)-1,N=-P-1;function V(l,n){const o=Math.round(l.x*n),u=Math.round(l.y*n);return l.x=gt(o,N,P),l.y=gt(u,N,P),(o<l.x||o>l.x+1||u<l.y||u>l.y+1)&&Wn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function q(l,n,o){const u=l.loadGeometry(),g=l.extent,d=yn/g;if(n&&o&&o.projection.isReprojectedInTileSpace){const v=1<<n.z,{scale:E,x:C,y:z,projection:w}=o,R=L=>{const A=Ro((n.x+L.x/g)/v),D=Ra((n.y+L.y/g)/v),F=w.project(A,D);L.x=(F.x*E-C)*g,L.y=(F.y*E-z)*g};for(let L=0;L<u.length;L++)if(l.type!==1)u[L]=x(u[L],R,1);else{const A=[];for(const D of u[L])D.x<0||D.x>=g||D.y<0||D.y>=g||(R(D),A.push(D));u[L]=A}}for(const v of u)for(const E of v)V(E,d);return u}function Z(l,n){return{type:l.type,id:l.id,properties:l.properties,geometry:n?q(l):[]}}function K(l,n,o,u,g){l.emplaceBack(2*n+(u+1)/2,2*o+(g+1)/2)}function ne(l,n,o){l.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class fe{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new vl,this.indexArray=new Ha,this.segments=new Jr,this.programConfigurations=new ts(n.layers,{zoom:n.zoom,lut:n.lut}),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}updateFootprints(n,o){}populate(n,o,u,g){const d=this.layers[0],v=[];let E=null;d.type==="circle"&&(E=d.layout.get("circle-sort-key"));for(const{feature:z,id:w,index:R,sourceLayerIndex:L}of n){const A=this.layers[0]._featureFilter.needGeometry,D=Z(z,A);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),D,u))continue;const F=E?E.evaluate(D,{},u):void 0,W={id:w,properties:z.properties,type:z.type,sourceLayerIndex:L,index:R,geometry:A?D.geometry:q(z,u,g),patterns:{},sortKey:F};v.push(W)}E&&v.sort((z,w)=>z.sortKey-w.sortKey);let C=null;g.projection.name==="globe"&&(this.globeExtVertexArray=new jh,C=g.projection);for(const z of v){const{geometry:w,index:R,sourceLayerIndex:L}=z,A=n[R].feature;this.addFeature(z,w,R,o.availableImages,u,C,o.brightness),o.featureIndex.insert(A,w,R,L,this.index)}}update(n,o,u,g,d,v,E){this.programConfigurations.updatePaintArrays(n,o,d,u,g,v,E)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,U_.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,hf.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(n,o,u,g,d,v,E){for(const C of o)for(const z of C){const w=z.x,R=z.y;if(w<0||w>=yn||R<0||R>=yn)continue;if(v){const D=v.projectTilePoint(w,R,d),F=v.upVector(d,w,R),W=this.globeExtVertexArray;ne(W,D,F),ne(W,D,F),ne(W,D,F),ne(W,D,F)}const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),A=L.vertexLength;K(this.layoutVertexArray,w,R,-1,-1),K(this.layoutVertexArray,w,R,1,-1),K(this.layoutVertexArray,w,R,1,1),K(this.layoutVertexArray,w,R,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+2,A+3),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,{},g,d,E)}}function ue(l,n){for(let o=0;o<l.length;o++)if(Be(n,l[o]))return!0;for(let o=0;o<n.length;o++)if(Be(l,n[o]))return!0;return!!ze(l,n)}function ve(l,n,o){return!!Be(l,n)||!!qe(n,l,o)}function ge(l,n){if(l.length===1)return Ge(n,l[0]);for(let o=0;o<n.length;o++){const u=n[o];for(let g=0;g<u.length;g++)if(Be(l,u[g]))return!0}for(let o=0;o<l.length;o++)if(Ge(n,l[o]))return!0;for(let o=0;o<n.length;o++)if(ze(l,n[o]))return!0;return!1}function Ce(l,n,o){if(l.length>1){if(ze(l,n))return!0;for(let u=0;u<n.length;u++)if(qe(n[u],l,o))return!0}for(let u=0;u<l.length;u++)if(qe(l[u],n,o))return!0;return!1}function ze(l,n){if(l.length===0||n.length===0)return!1;for(let o=0;o<l.length-1;o++){const u=l[o],g=l[o+1];for(let d=0;d<n.length-1;d++)if(Le(u,g,n[d],n[d+1]))return!0}return!1}function Le(l,n,o,u){return Ot(l,o,u)!==Ot(n,o,u)&&Ot(l,n,o)!==Ot(l,n,u)}function qe(l,n,o){const u=o*o;if(n.length===1)return l.distSqr(n[0])<u;for(let g=1;g<n.length;g++)if(Ne(l,n[g-1],n[g])<u)return!0;return!1}function Ne(l,n,o){const u=n.distSqr(o);if(u===0)return l.distSqr(n);const g=((l.x-n.x)*(o.x-n.x)+(l.y-n.y)*(o.y-n.y))/u;return l.distSqr(g<0?n:g>1?o:o.sub(n)._mult(g)._add(n))}function Ge(l,n){let o,u,g,d=!1;for(let v=0;v<l.length;v++){o=l[v];for(let E=0,C=o.length-1;E<o.length;C=E++)u=o[E],g=o[C],u.y>n.y!=g.y>n.y&&n.x<(g.x-u.x)*(n.y-u.y)/(g.y-u.y)+u.x&&(d=!d)}return d}function Be(l,n){let o=!1;for(let u=0,g=l.length-1;u<l.length;g=u++){const d=l[u],v=l[g];d.y>n.y!=v.y>n.y&&n.x<(v.x-d.x)*(n.y-d.y)/(v.y-d.y)+d.x&&(o=!o)}return o}function Ke(l,n,o,u,g){for(const v of l)if(n<=v.x&&o<=v.y&&u>=v.x&&g>=v.y)return!0;const d=[new ke(n,o),new ke(n,g),new ke(u,g),new ke(u,o)];if(l.length>2){for(const v of d)if(Be(l,v))return!0}for(let v=0;v<l.length-1;v++)if(it(l[v],l[v+1],d))return!0;return!1}function it(l,n,o){const u=o[0],g=o[2];if(l.x<u.x&&n.x<u.x||l.x>g.x&&n.x>g.x||l.y<u.y&&n.y<u.y||l.y>g.y&&n.y>g.y)return!1;const d=Ot(l,n,o[0]);return d!==Ot(l,n,o[1])||d!==Ot(l,n,o[2])||d!==Ot(l,n,o[3])}function Rt(l,n,o,u,g,d){let v=n.y-l.y,E=l.x-n.x;if(d=d||0){const C=v*v+E*E;if(C===0)return!0;const z=Math.sqrt(C);v/=z,E/=z}return!((o.x-l.x)*v+(o.y-l.y)*E-d<0||(u.x-l.x)*v+(u.y-l.y)*E-d<0||(g.x-l.x)*v+(g.y-l.y)*E-d<0)}function xt(l,n,o,u,g,d,v){return!(Rt(l,n,u,g,d,v)||Rt(n,o,u,g,d,v)||Rt(o,l,u,g,d,v)||Rt(u,g,l,n,o,v)||Rt(g,d,l,n,o,v)||Rt(d,u,l,n,o,v))}function jt(l,n,o){const u=n.paint.get(l).value;return u.kind==="constant"?u.value:o.programConfigurations.get(n.id).getMaxValue(l)}function zt(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function pt(l,n,o,u,g){if(!n[0]&&!n[1])return l;const d=ke.convert(n)._mult(g);o==="viewport"&&d._rotate(-u);const v=[];for(let E=0;E<l.length;E++)v.push(l[E].sub(d));return v}function Dt(l,n,o,u){const g=ke.convert(l)._mult(u);return n==="viewport"&&g._rotate(-o),g}let tn,dt;Ln(fe,"CircleBucket",{omit:["layers"]});var Ut,Pt={exports:{}},dn=(Ut||(Ut=1,function(l,n){(function(o){function u(d,v,E){var C=g(256*d,256*(v=Math.pow(2,E)-v-1),E),z=g(256*(d+1),256*(v+1),E);return C[0]+","+C[1]+","+z[0]+","+z[1]}function g(d,v,E){var C=2*Math.PI*6378137/256/Math.pow(2,E);return[d*C-2*Math.PI*6378137/2,v*C-2*Math.PI*6378137/2]}o.getURL=function(d,v,E,C,z,w){return w=w||{},d+"?"+["bbox="+u(E,C,z),"format="+(w.format||"image/png"),"service="+(w.service||"WMS"),"version="+(w.version||"1.1.1"),"request="+(w.request||"GetMap"),"srs="+(w.srs||"EPSG:3857"),"width="+(w.width||256),"height="+(w.height||256),"layers="+v].join("&")},o.getTileBBox=u,o.getMercCoords=g,Object.defineProperty(o,"__esModule",{value:!0})})(n)}(0,Pt.exports)),Pt.exports);class Zt{constructor(n,o,u){this.z=n,this.x=o,this.y=u,this.key=mn(0,n,n,o,u)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,o){const u=dn.getTileBBox(this.x,this.y,this.z),g=function(d,v,E){let C,z="";for(let w=d;w>0;w--)C=1<<w-1,z+=(v&C?1:0)+(E&C?2:0);return z}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",g).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Gt{constructor(n,o){this.wrap=n,this.canonical=o,this.key=mn(n,o.z,o.z,o.x,o.y)}}class rn{constructor(n,o,u,g,d){this.overscaledZ=n,this.wrap=o,this.canonical=new Zt(u,+g,+d),this.key=o===0&&n===u?this.canonical.key:mn(o,n,u,g,d)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const o=this.canonical.z-n;return n>this.canonical.z?new rn(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new rn(n,this.wrap,n,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(n,o=!0){if(this.overscaledZ===n&&o)return this.key;if(n>this.canonical.z)return mn(this.wrap*+o,n,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-n;return mn(this.wrap*+o,n,n,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const o=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.z<this.canonical.z&&n.canonical.x===this.canonical.x>>o&&n.canonical.y===this.canonical.y>>o}children(n){if(this.overscaledZ>=n)return[new rn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,u=2*this.canonical.x,g=2*this.canonical.y;return[new rn(o,this.wrap,o,u,g),new rn(o,this.wrap,o,u+1,g),new rn(o,this.wrap,o,u,g+1),new rn(o,this.wrap,o,u+1,g+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new rn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new rn(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Gt(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function mn(l,n,o,u,g){const d=1<<Math.min(o,22);let v=d*(g%d)+u%d;return l&&o<22&&(v+=d*d*((l<0?-2*l-1:2*l)%(1<<2*(22-o)))),16*(32*v+o)+(n-o)}const Cn=[l=>{let n=l.canonical.x-1,o=l.wrap;return n<0&&(n=(1<<l.canonical.z)-1,o--),new rn(l.overscaledZ,o,l.canonical.z,n,l.canonical.y)},l=>{let n=l.canonical.x+1,o=l.wrap;return n===1<<l.canonical.z&&(n=0,o++),new rn(l.overscaledZ,o,l.canonical.z,n,l.canonical.y)},l=>new rn(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,(l.canonical.y===0?1<<l.canonical.z:l.canonical.y)-1),l=>new rn(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y===(1<<l.canonical.z)-1?0:l.canonical.y+1)];Ln(Zt,"CanonicalTileID"),Ln(rn,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const zn=sr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ni}=zn,Yn=sr([{name:"a_pos_3",components:3,type:"Int16"}]);var Zn=sr([{name:"a_pos",type:"Int16",components:2}]);class mi{constructor(n,o){this.pos=n,this.dir=o}intersectsPlane(n,o,u){const g=Pe.vec3.dot(o,this.dir);if(Math.abs(g)<1e-6)return!1;const d=((n[0]-this.pos[0])*o[0]+(n[1]-this.pos[1])*o[1]+(n[2]-this.pos[2])*o[2])/g;return u[0]=this.pos[0]+this.dir[0]*d,u[1]=this.pos[1]+this.dir[1]*d,u[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(n,o,u){if(Pe.vec3.equals(this.pos,n)||o===0)return u[0]=u[1]=u[2]=0,!1;const[g,d,v]=this.dir,E=this.pos[0]-n[0],C=this.pos[1]-n[1],z=this.pos[2]-n[2],w=g*g+d*d+v*v,R=2*(E*g+C*d+z*v),L=R*R-4*w*(E*E+C*C+z*z-o*o);if(L<0){const A=Math.max(-R/2,0),D=E+g*A,F=C+d*A,W=z+v*A,$=Math.hypot(D,F,W);return u[0]=D*o/$,u[1]=F*o/$,u[2]=W*o/$,!1}{const A=(-R-Math.sqrt(L))/(2*w);if(A<0){const D=Math.hypot(E,C,z);return u[0]=E*o/D,u[1]=C*o/D,u[2]=z*o/D,!1}return u[0]=E+g*A,u[1]=C+d*A,u[2]=z+v*A,!0}}}class gi{constructor(n,o,u,g,d){this.TL=n,this.TR=o,this.BR=u,this.BL=g,this.horizon=d}static fromInvProjectionMatrix(n,o,u){const g=[-1,1,1],d=[1,1,1],v=[1,-1,1],E=[-1,-1,1],C=Pe.vec3.transformMat4(g,g,n),z=Pe.vec3.transformMat4(d,d,n),w=Pe.vec3.transformMat4(v,v,n),R=Pe.vec3.transformMat4(E,E,n);return new gi(C,z,w,R,o/u)}}function pr(l,n,o){let u=1/0,g=-1/0;const d=[];for(const v of l){Pe.vec3.sub(d,v,n);const E=Pe.vec3.dot(d,o);u=Math.min(u,E),g=Math.max(g,E)}return[u,g]}function Qr(l,n){let o=!0;for(let u=0;u<l.planes.length;u++){const g=l.planes[u];let d=0;for(let v=0;v<n.length;v++)d+=Pe.vec3.dot(g,n[v])+g[3]>=0;if(d===0)return 0;d!==n.length&&(o=!1)}return o?2:1}function Pr(l,n){for(const o of l.projections){const u=pr(n,l.points[0],o.axis);if(o.projection[1]<u[0]||o.projection[0]>u[1])return 0}return 1}function Ei(l,n){let o=0;const u=[0,0,0,0];for(let g=0;g<l.length;g++)u[0]=l[g][0],u[1]=l[g][1],u[2]=l[g][2],u[3]=1,Pe.vec4.dot(u,n)>=0&&o++;return o}class Qi{constructor(n,o){this.points=n||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=Rn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Pe.vec3.sub([],this.points[2],this.points[3]),Pe.vec3.sub([],this.points[0],this.points[3]),Pe.vec3.sub([],this.points[4],this.points[0]),Pe.vec3.sub([],this.points[5],this.points[1]),Pe.vec3.sub([],this.points[6],this.points[2]),Pe.vec3.sub([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const g=[0,-u[2],u[1]],d=[u[2],0,-u[0]];this.projections.push({axis:g,projection:pr(this.points,this.points[0],g)}),this.projections.push({axis:d,projection:pr(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(n,o,u,g){const d=Math.pow(2,u),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(z=>{const w=Pe.vec4.transformMat4([],z,n),R=1/w[3]/o*d;return Pe.vec4.mul(w,w,[R,R,g?1/w[3]:R,R])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(z=>{const w=Pe.vec3.sub([],v[z[0]],v[z[1]]),R=Pe.vec3.sub([],v[z[2]],v[z[1]]),L=Pe.vec3.normalize([],Pe.vec3.cross([],w,R)),A=-Pe.vec3.dot(L,v[z[1]]);return L.concat(A)}),C=[];for(let z=0;z<v.length;z++)C.push([v[z][0],v[z][1],v[z][2]]);return new Qi(C,E)}intersectsPrecise(n,o,u){for(let g=0;g<o.length;g++)if(!Ei(n,o[g]))return 0;for(let g=0;g<this.planes.length;g++)if(!Ei(n,this.planes[g]))return 0;for(const g of u)for(const d of this.frustumEdges){const v=Pe.vec3.cross([],g,d),E=Pe.vec3.length(v);if(E===0)continue;Pe.vec3.scale(v,v,1/E);const C=pr(this.points,this.points[0],v),z=pr(n,this.points[0],v);if(C[0]>z[1]||z[0]>C[1])return 0}return 1}containsPoint(n){for(const o of this.planes){const u=o[3];if(Pe.vec3.dot([o[0],o[1],o[2]],n)+u<0)return!1}return!0}}class Rn{static fromPoints(n){const o=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const g of n)Pe.vec3.min(o,o,g),Pe.vec3.max(u,u,g);return new Rn(o,u)}static fromTileIdAndHeight(n,o,u){const g=1<<n.canonical.z,d=n.canonical.x,v=n.canonical.y;return new Rn([d/g,v/g,o],[(d+1)/g,(v+1)/g,u])}static applyTransform(n,o){const u=n.getCorners();for(let g=0;g<u.length;++g)Pe.vec3.transformMat4(u[g],u[g],o);return Rn.fromPoints(u)}static applyTransformFast(n,o){const u=[o[12],o[13],o[14]],g=[...u];for(let d=0;d<3;d++)for(let v=0;v<3;v++){const E=o[4*v+d],C=E*n.min[v],z=E*n.max[v];u[d]+=Math.min(C,z),g[d]+=Math.max(C,z)}return new Rn(u,g)}static projectAabbCorners(n,o){const u=n.getCorners();for(let g=0;g<u.length;++g)Pe.vec3.transformMat4(u[g],u[g],o);return u}constructor(n,o){this.min=n,this.max=o,this.center=Pe.vec3.scale([],Pe.vec3.add([],this.min,this.max),.5)}quadrant(n){const o=[n%2==0,n<2],u=Pe.vec3.clone(this.min),g=Pe.vec3.clone(this.max);for(let d=0;d<o.length;d++)u[d]=o[d]?this.min[d]:this.center[d],g[d]=o[d]?this.center[d]:this.max[d];return g[2]=this.max[2],new Rn(u,g)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,o=this.max;return[[n[0],n[1],n[2]],[o[0],n[1],n[2]],[o[0],o[1],n[2]],[n[0],o[1],n[2]],[n[0],n[1],o[2]],[o[0],n[1],o[2]],[o[0],o[1],o[2]],[n[0],o[1],o[2]]]}intersects(n){return this.intersectsAabb(n.bounds)?Qr(n,this.getCorners()):0}intersectsFlat(n){return this.intersectsAabb(n.bounds)?Qr(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(n,o){return o||this.intersects(n)?Pr(n,this.getCorners()):0}intersectsPreciseFlat(n,o){return o||this.intersectsFlat(n)?Pr(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(n){for(let o=0;o<3;++o)if(this.min[o]>n.max[o]||n.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(n){return!(this.min[0]>n.max[0]||n.min[0]>this.max[0]||this.min[1]>n.max[1]||n.min[1]>this.max[1])}encapsulate(n){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],n.min[o]),this.max[o]=Math.max(this.max[o],n.max[o])}encapsulatePoint(n){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],n[o]),this.max[o]=Math.max(this.max[o],n[o])}closestPoint(n){return[Math.max(Math.min(this.max[0],n[0]),this.min[0]),Math.max(Math.min(this.max[1],n[1]),this.min[1]),Math.max(Math.min(this.max[2],n[2]),this.min[2])]}}function li(l){return l*fo/il}Ln(Rn,"Aabb");const ri=[new Rn([bo,bo,bo],[wo,wo,wo]),new Rn([bo,bo,bo],[0,0,wo]),new Rn([0,bo,bo],[wo,0,wo]),new Rn([bo,0,bo],[0,wo,wo]),new Rn([0,0,bo],[wo,wo,wo])];function hi(l,n,o,u=!0){const g=Pe.vec3.scale([],l._camera.position,l.worldSize),d=[n,o,1,1];Pe.vec4.transformMat4(d,d,l.pixelMatrixInverse),Pe.vec4.scale(d,d,1/d[3]);const v=Pe.vec3.sub([],d,g),E=Pe.vec3.normalize([],v),C=l.globeMatrix,z=[C[12],C[13],C[14]],w=Pe.vec3.sub([],z,g),R=Pe.vec3.length(w),L=Pe.vec3.normalize([],w),A=l.worldSize/(2*Math.PI),D=Pe.vec3.dot(L,E),F=Math.asin(A/R);if(F<Math.acos(D)){if(!u)return null;const $e=[],Oe=[];Pe.vec3.scale($e,E,R/D),Pe.vec3.normalize(Oe,Pe.vec3.sub(Oe,$e,w)),Pe.vec3.normalize(E,Pe.vec3.add(E,w,Pe.vec3.scale(E,Oe,Math.tan(F)*R)))}const W=[];new mi(g,E).closestPointOnSphere(z,A,W);const $=Pe.vec3.normalize([],Vi(C,0)),ie=Pe.vec3.normalize([],Vi(C,1)),re=Pe.vec3.normalize([],Vi(C,2)),ee=Pe.vec3.dot($,W),ae=Pe.vec3.dot(ie,W),de=Pe.vec3.dot(re,W),ye=wi(Math.asin(-ae/A));let De=wi(Math.atan2(ee,de));De=l.center.lng+function($e,Oe){const Ye=(Oe-$e+180)%360-180;return Ye<-180?Ye+360:Ye}(l.center.lng,De);const Ie=rl(De),Re=gt(Ns(ye),0,1);return new s(Ie,Re)}class Hi{constructor(n,o,u){this.a=Pe.vec3.sub([],n,u),this.b=Pe.vec3.sub([],o,u),this.center=u;const g=Pe.vec3.normalize([],this.a),d=Pe.vec3.normalize([],this.b);this.angle=Math.acos(Pe.vec3.dot(g,d))}}function Lr(l,n){if(l.angle===0)return null;let o;return o=l.a[n]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[n]/l.a[n]/Math.sin(l.angle)-1/Math.tan(l.angle)),o<0||o>1?null:function(u,g,d,v){const E=Math.sin(d);return u*(Math.sin((1-v)*d)/E)+g*(Math.sin(v*d)/E)}(l.a[n],l.b[n],l.angle,gt(o,0,1))+l.center[n]}function jr(l){if(l.z<=1)return ri[l.z+2*l.y+l.x];const n=hr(Yi(l));return Rn.fromPoints(n)}function ea(l,n,o){return Pe.vec3.scale(l,l,1-o),Pe.vec3.scaleAndAdd(l,l,n,o)}function Vo(l,n,o){for(const u of l)Pe.vec3.transformMat4(u,u,n),Pe.vec3.scale(u,u,o)}function ha(l,n,o,u){const g=n/l.worldSize,d=l.globeMatrix;if(o.z<=1){const Ie=jr(o).getCorners();return Vo(Ie,d,g),Rn.fromPoints(Ie)}const v=Yi(o,u),E=hr(v,fo+li(l._tileCoverLift));Vo(E,d,g);const C=Number.MAX_VALUE,z=[-C,-C,-C],w=[C,C,C];if(v.contains(l.center)){for(const $e of E)Pe.vec3.min(w,w,$e),Pe.vec3.max(z,z,$e);z[2]=0;const Ie=l.point,Re=[Ie.x*g,Ie.y*g,0];return Pe.vec3.min(w,w,Re),Pe.vec3.max(z,z,Re),new Rn(w,z)}if(l._tileCoverLift>0){for(const Ie of E)Pe.vec3.min(w,w,Ie),Pe.vec3.max(z,z,Ie);return new Rn(w,z)}const R=[d[12]*g,d[13]*g,d[14]*g],L=v.getCenter(),A=gt(l.center.lat,-85.051129,Mr),D=gt(L.lat,-85.051129,Mr),F=rl(l.center.lng),W=Ns(A);let $=F-rl(L.lng);const ie=W-Ns(D);$>.5?$-=1:$<-.5&&($+=1);let re=0;if(Math.abs($)>Math.abs(ie))re=$>=0?1:3;else{re=ie>=0?0:2;const Ie=[d[4]*g,d[5]*g,d[6]*g],Re=-Math.sin(Mn(ie>=0?v.getSouth():v.getNorth()))*fo;Pe.vec3.scaleAndAdd(R,R,Ie,Re)}const ee=E[re],ae=E[(re+1)%4],de=new Hi(ee,ae,R),ye=[Lr(de,0)||ee[0],Lr(de,1)||ee[1],Lr(de,2)||ee[2]],De=mo(l.zoom);if(De>0){const Ie=function({x:$e,y:Oe,z:Ye},tt,Je,rt,ct){const yt=1/(1<<Ye);let st=$e*yt,Bt=st+yt,Qt=Oe*yt,Nt=Qt+yt,An=0;const xn=(st+Bt)/2-rt;return xn>.5?An=-1:xn<-.5&&(An=1),st=((st+An)*tt-(rt*=tt))*Je+rt,Bt=((Bt+An)*tt-rt)*Je+rt,Qt=(Qt*tt-(ct*=tt))*Je+ct,Nt=(Nt*tt-ct)*Je+ct,[[st,Nt,0],[Bt,Nt,0],[Bt,Qt,0],[st,Qt,0]]}(o,n,l._pixelsPerMercatorPixel,F,W);for(let $e=0;$e<E.length;$e++)ea(E[$e],Ie[$e],De);const Re=Pe.vec3.add([],Ie[re],Ie[(re+1)%4]);Pe.vec3.scale(Re,Re,.5),ea(ye,Re,De)}for(const Ie of E)Pe.vec3.min(w,w,Ie),Pe.vec3.max(z,z,Ie);return w[2]=Math.min(ee[2],ae[2]),Pe.vec3.min(w,w,ye),Pe.vec3.max(z,z,ye),new Rn(w,z)}function Yi({x:l,y:n,z:o},u=!1){const g=1/(1<<o),d=new Ji(Ro(l*g),n===(1<<o)-1&&u?-90:Ra((n+1)*g)),v=new Ji(Ro((l+1)*g),n===0&&u?90:Ra(n*g));return new nc(d,v)}function hr(l,n=fo){const o=Mn(l.getNorth()),u=Mn(l.getSouth()),g=Math.cos(o),d=Math.cos(u),v=Math.sin(o),E=Math.sin(u),C=l.getWest(),z=l.getEast();return[Vu(d,E,C,n),Vu(d,E,z,n),Vu(g,v,z,n),Vu(g,v,C,n)]}function ur(l,n,o,u){const g=1<<o.z,d=(l/yn+o.x)/g;return Qc(Ra((n/yn+o.y)/g),Ro(d),u)}function Xi({min:l,max:n}){return Zh/Math.max(n[0]-l[0],n[1]-l[1],n[2]-l[2])}const Tr=new Float64Array(16);function la(l){const n=Xi(l),o=Pe.mat4.fromScaling(Tr,[n,n,n]);return Pe.mat4.translate(o,o,Pe.vec3.negate([],l.min))}function mr(l){const n=Pe.mat4.fromTranslation(Tr,l.min),o=1/Xi(l);return Pe.mat4.scale(n,n,[o,o,o])}function ca(l){const n=yn/(2*Math.PI);return l/(2*Math.PI)/n}function ns(l,n){return yn/(512*Math.pow(2,l))*Xi(jr(n))}function Io(l,n,o,u,g){const d=ca(o),v=[l,n,-o/(2*Math.PI)],E=Pe.mat4.identity(new Float64Array(16));return Pe.mat4.translate(E,E,v),Pe.mat4.scale(E,E,[d,d,d]),Pe.mat4.rotateX(E,E,Mn(-g)),Pe.mat4.rotateY(E,E,Mn(-u)),E}function mo(l){return Kt(ms,tc,l)}function _s(l,n){const o=Qc(n.lat,n.lng),u=function(d){const v=Qc(d._center.lat,d._center.lng),E=Pe.vec3.fromValues(0,1,0);let C=Pe.vec3.cross([],E,v);const z=Pe.mat4.fromRotation([],-d.angle,v);C=Pe.vec3.transformMat4(C,C,z),Pe.mat4.fromRotation(z,-d._pitch,C);const w=Pe.vec3.normalize([],v);return Pe.vec3.scale(w,w,li(d.cameraToCenterDistance/d.pixelsPerMeter)),Pe.vec3.transformMat4(w,w,z),Pe.vec3.add([],v,w)}(l),g=Pe.vec3.subtract([],u,o);return Pe.vec3.angle(g,o)}function to(l,n){return _s(l,n)>Math.PI/2*1.01}const Do=Mn(85),vs=Math.cos(Do),is=Math.sin(Do),ic=Pe.mat4.create(),eu=l=>{const n=[];return l.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n};function tu(l,n,o,u,g,d,v,E,C){if(d&&l.queryGeometry.isAboveHorizon)return!1;d&&(C*=l.pixelToTileUnitsFactor);const z=l.tileID.canonical,w=o.projection.upVectorScale(z,o.center.lat,o.worldSize).metersToTile;for(const R of n)for(const L of R){const A=L.add(E),D=g&&o.elevation?o.elevation.exaggeration()*g.getElevationAt(A.x,A.y,!0):0,F=o.projection.projectTilePoint(A.x,A.y,z);if(D>0){const re=o.projection.upVector(z,A.x,A.y);F.x+=re[0]*w*D,F.y+=re[1]*w*D,F.z+=re[2]*w*D}const W=d?A:_f(F.x,F.y,F.z,u),$=d?l.tilespaceRays.map(re=>ys(re,D)):l.queryGeometry.screenGeometry,ie=Pe.vec4.transformMat4([],[F.x,F.y,F.z,1],u);if(!v&&d?C*=ie[3]/o.cameraToCenterDistance:v&&!d&&(C*=o.cameraToCenterDistance/ie[3]),d){const re=Ra((L.y/yn+z.y)/(1<<z.z));C/=o.projection.pixelsPerMeter(re,1)/po(1,re)}if(ve($,W,C))return!0}return!1}function _f(l,n,o,u){const g=Pe.vec4.transformMat4([],[l,n,o,1],u);return new ke(g[0]/g[3],g[1]/g[3])}const Bs=Pe.vec3.fromValues(0,0,0),mb=Pe.vec3.fromValues(0,0,1);function ys(l,n){const o=Pe.vec3.create();return Bs[2]=n,l.intersectsPlane(Bs,mb,o),new ke(o[0],o[1])}class Wy extends fe{}let G_,$y,gb,nu;function pg(l,{width:n,height:o},u,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==n*o*u)throw new RangeError("mismatched image size")}else g=new Uint8Array(n*o*u);return l.width=n,l.height=o,l.data=g,l}function H_(l,n,o){const{width:u,height:g}=n;u===l.width&&g===l.height||(Kh(l,n,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,u),height:Math.min(l.height,g)},o,null),l.width=u,l.height=g,l.data=n.data)}function Kh(l,n,o,u,g,d,v,E){if(g.width===0||g.height===0)return n;if(g.width>l.width||g.height>l.height||o.x>l.width-g.width||o.y>l.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>n.width||g.height>n.height||u.x>n.width-g.width||u.y>n.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const C=l.data,z=n.data,w=d===4&&E;for(let R=0;R<g.height;R++){const L=((o.y+R)*l.width+o.x)*d,A=((u.y+R)*n.width+u.x)*d;if(w)for(let D=0;D<g.width;D++){const F=L+D*d+3,W=A+D*d;z[W+0]=255,z[W+1]=255,z[W+2]=255,z[W+3]=C[F]}else if(v)for(let D=0;D<g.width;D++){const F=L+D*d,W=A+D*d,$=C[F+3],ie=new tr(C[F+0]/255*$,C[F+1]/255*$,C[F+2]/255*$,$).toRenderColor(v).toArray();z[W+0]=ie[0],z[W+1]=ie[1],z[W+2]=ie[2],z[W+3]=ie[3]}else for(let D=0;D<g.width*d;D++)z[A+D]=C[L+D]}return n}Ln(Wy,"HeatmapBucket",{omit:["layers"]});class Hu{constructor(n,o){pg(this,n,1,o)}resize(n){H_(this,new Hu(n),1)}clone(){return new Hu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,u,g,d){Kh(n,o,u,g,d,1,null)}}class no{constructor(n,o){pg(this,n,4,o)}resize(n){H_(this,new no(n),4)}replace(n,o){o?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new no({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,u,g,d,v,E){Kh(n,o,u,g,d,4,v,E)}}class Xy{constructor(n,o){this.width=n.width,this.height=n.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}function vf(l){const n={},o=l.resolution||256,u=l.clips?l.clips.length:1,g=l.image||new no({width:o,height:u}),d=(v,E,C)=>{n[l.evaluationKey]=C;const z=l.expression.evaluate(n);z&&(g.data[v+E+0]=Math.floor(255*z.r/z.a),g.data[v+E+1]=Math.floor(255*z.g/z.a),g.data[v+E+2]=Math.floor(255*z.b/z.a),g.data[v+E+3]=Math.floor(255*z.a))};if(l.clips)for(let v=0,E=0;v<u;++v,E+=4*o)for(let C=0,z=0;C<o;C++,z+=4){const w=C/(o-1),{start:R,end:L}=l.clips[v];d(E,z,R*(1-w)+L*w)}else for(let v=0,E=0;v<o;v++,E+=4)d(0,E,v/(o-1));return g}Ln(Hu,"AlphaImage"),Ln(no,"RGBAImage");const Zy=sr([{name:"a_pos",components:2,type:"Int16"}],4),{members:qE}=Zy;function mg(l,n,o=2){const u=n&&n.length,g=u?n[0]*o:l.length;let d=_b(l,0,g,o,!0);const v=[];if(!d||d.next===d.prev)return v;let E,C,z;if(u&&(d=function(w,R,L,A){const D=[];for(let F=0,W=R.length;F<W;F++){const $=_b(w,R[F]*A,F<W-1?R[F+1]*A:w.length,A,!1);$===$.next&&($.steiner=!0),D.push(da($))}D.sort(WE);for(let F=0;F<D.length;F++)L=xb(D[F],L);return L}(l,n,d,o)),l.length>80*o){E=1/0,C=1/0;let w=-1/0,R=-1/0;for(let L=o;L<g;L+=o){const A=l[L],D=l[L+1];A<E&&(E=A),D<C&&(C=D),A>w&&(w=A),D>R&&(R=D)}z=Math.max(w-E,R-C),z=z!==0?32767/z:0}return Up(d,v,o,E,C,z,0),v}function _b(l,n,o,u,g){let d;if(g===function(v,E,C,z){let w=0;for(let R=E,L=C-z;R<C;R+=z)w+=(v[L]-v[R])*(v[R+1]+v[L+1]),L=R;return w}(l,n,o,u)>0)for(let v=n;v<o;v+=u)d=gg(v/u|0,l[v],l[v+1],d);else for(let v=o-u;v>=n;v-=u)d=gg(v/u|0,l[v],l[v+1],d);return d&&$_(d,d.next)&&(xf(d),d=d.next),d}function Jh(l,n){if(!l)return l;n||(n=l);let o,u=l;do if(o=!1,u.steiner||!$_(u,u.next)&&Ia(u.prev,u,u.next)!==0)u=u.next;else{if(xf(u),u=n=u.prev,u===u.next)break;o=!0}while(o||u!==n);return n}function Up(l,n,o,u,g,d,v){if(!l)return;!v&&d&&function(C,z,w,R){let L=C;do L.z===0&&(L.z=W_(L.x,L.y,z,w,R)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==C);L.prevZ.nextZ=null,L.prevZ=null,function(A){let D,F=1;do{let W,$=A;A=null;let ie=null;for(D=0;$;){D++;let re=$,ee=0;for(let de=0;de<F&&(ee++,re=re.nextZ,re);de++);let ae=F;for(;ee>0||ae>0&&re;)ee!==0&&(ae===0||!re||$.z<=re.z)?(W=$,$=$.nextZ,ee--):(W=re,re=re.nextZ,ae--),ie?ie.nextZ=W:A=W,W.prevZ=ie,ie=W;$=re}ie.nextZ=null,F*=2}while(D>1)}(L)}(l,u,g,d);let E=l;for(;l.prev!==l.next;){const C=l.prev,z=l.next;if(d?q_(l,u,g,d):Vp(l))n.push(C.i,l.i,z.i),xf(l),l=z.next,E=z.next;else if((l=z)===E){v?v===1?Up(l=vb(Jh(l),n),n,o,u,g,d,2):v===2&&yb(l,n,o,u,g,d):Up(Jh(l),n,o,u,g,d,1);break}}}function Vp(l){const n=l.prev,o=l,u=l.next;if(Ia(n,o,u)>=0)return!1;const g=n.x,d=o.x,v=u.x,E=n.y,C=o.y,z=u.y,w=g<d?g<v?g:v:d<v?d:v,R=E<C?E<z?E:z:C<z?C:z,L=g>d?g>v?g:v:d>v?d:v,A=E>C?E>z?E:z:C>z?C:z;let D=u.next;for(;D!==n;){if(D.x>=w&&D.x<=L&&D.y>=R&&D.y<=A&&Qh(g,E,d,C,v,z,D.x,D.y)&&Ia(D.prev,D,D.next)>=0)return!1;D=D.next}return!0}function q_(l,n,o,u){const g=l.prev,d=l,v=l.next;if(Ia(g,d,v)>=0)return!1;const E=g.x,C=d.x,z=v.x,w=g.y,R=d.y,L=v.y,A=E<C?E<z?E:z:C<z?C:z,D=w<R?w<L?w:L:R<L?R:L,F=E>C?E>z?E:z:C>z?C:z,W=w>R?w>L?w:L:R>L?R:L,$=W_(A,D,n,o,u),ie=W_(F,W,n,o,u);let re=l.prevZ,ee=l.nextZ;for(;re&&re.z>=$&&ee&&ee.z<=ie;){if(re.x>=A&&re.x<=F&&re.y>=D&&re.y<=W&&re!==g&&re!==v&&Qh(E,w,C,R,z,L,re.x,re.y)&&Ia(re.prev,re,re.next)>=0||(re=re.prevZ,ee.x>=A&&ee.x<=F&&ee.y>=D&&ee.y<=W&&ee!==g&&ee!==v&&Qh(E,w,C,R,z,L,ee.x,ee.y)&&Ia(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;re&&re.z>=$;){if(re.x>=A&&re.x<=F&&re.y>=D&&re.y<=W&&re!==g&&re!==v&&Qh(E,w,C,R,z,L,re.x,re.y)&&Ia(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;ee&&ee.z<=ie;){if(ee.x>=A&&ee.x<=F&&ee.y>=D&&ee.y<=W&&ee!==g&&ee!==v&&Qh(E,w,C,R,z,L,ee.x,ee.y)&&Ia(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function vb(l,n){let o=l;do{const u=o.prev,g=o.next.next;!$_(u,g)&&bb(u,o,o.next,g)&&iu(u,g)&&iu(g,u)&&(n.push(u.i,o.i,g.i),xf(o),xf(o.next),o=l=g),o=o.next}while(o!==l);return Jh(o)}function yb(l,n,o,u,g,d){let v=l;do{let E=v.next.next;for(;E!==v.prev;){if(v.i!==E.i&&$E(v,E)){let C=Z_(v,E);return v=Jh(v,v.next),C=Jh(C,C.next),Up(v,n,o,u,g,d,0),void Up(C,n,o,u,g,d,0)}E=E.next}v=v.next}while(v!==l)}function WE(l,n){return l.x-n.x}function xb(l,n){const o=function(g,d){let v=d;const E=g.x,C=g.y;let z,w=-1/0;do{if(C<=v.y&&C>=v.next.y&&v.next.y!==v.y){const F=v.x+(C-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(F<=E&&F>w&&(w=F,z=v.x<v.next.x?v:v.next,F===E))return z}v=v.next}while(v!==d);if(!z)return null;const R=z,L=z.x,A=z.y;let D=1/0;v=z;do{if(E>=v.x&&v.x>=L&&E!==v.x&&Qh(C<A?E:w,C,L,A,C<A?w:E,C,v.x,v.y)){const F=Math.abs(C-v.y)/(E-v.x);iu(v,g)&&(F<D||F===D&&(v.x>z.x||v.x===z.x&&jp(z,v)))&&(z=v,D=F)}v=v.next}while(v!==R);return z}(l,n);if(!o)return n;const u=Z_(o,l);return Jh(u,u.next),Jh(o,o.next)}function jp(l,n){return Ia(l.prev,l,n.prev)<0&&Ia(n.next,l,l.next)<0}function W_(l,n,o,u,g){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-o)*g|0)|l<<8))|l<<4))|l<<2))|l<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-u)*g|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function da(l){let n=l,o=l;do(n.x<o.x||n.x===o.x&&n.y<o.y)&&(o=n),n=n.next;while(n!==l);return o}function Qh(l,n,o,u,g,d,v,E){return(g-v)*(n-E)>=(l-v)*(d-E)&&(l-v)*(u-E)>=(o-v)*(n-E)&&(o-v)*(d-E)>=(g-v)*(u-E)}function $E(l,n){return l.next.i!==n.i&&l.prev.i!==n.i&&!function(o,u){let g=o;do{if(g.i!==o.i&&g.next.i!==o.i&&g.i!==u.i&&g.next.i!==u.i&&bb(g,g.next,o,u))return!0;g=g.next}while(g!==o);return!1}(l,n)&&(iu(l,n)&&iu(n,l)&&function(o,u){let g=o,d=!1;const v=(o.x+u.x)/2,E=(o.y+u.y)/2;do g.y>E!=g.next.y>E&&g.next.y!==g.y&&v<(g.next.x-g.x)*(E-g.y)/(g.next.y-g.y)+g.x&&(d=!d),g=g.next;while(g!==o);return d}(l,n)&&(Ia(l.prev,l,n.prev)||Ia(l,n.prev,n))||$_(l,n)&&Ia(l.prev,l,l.next)>0&&Ia(n.prev,n,n.next)>0)}function Ia(l,n,o){return(n.y-l.y)*(o.x-n.x)-(n.x-l.x)*(o.y-n.y)}function $_(l,n){return l.x===n.x&&l.y===n.y}function bb(l,n,o,u){const g=yf(Ia(l,n,o)),d=yf(Ia(l,n,u)),v=yf(Ia(o,u,l)),E=yf(Ia(o,u,n));return g!==d&&v!==E||!(g!==0||!X_(l,o,n))||!(d!==0||!X_(l,u,n))||!(v!==0||!X_(o,l,u))||!(E!==0||!X_(o,n,u))}function X_(l,n,o){return n.x<=Math.max(l.x,o.x)&&n.x>=Math.min(l.x,o.x)&&n.y<=Math.max(l.y,o.y)&&n.y>=Math.min(l.y,o.y)}function yf(l){return l>0?1:l<0?-1:0}function iu(l,n){return Ia(l.prev,l,l.next)<0?Ia(l,n,l.next)>=0&&Ia(l,l.prev,n)>=0:Ia(l,n,l.prev)<0||Ia(l,l.next,n)<0}function Z_(l,n){const o=qu(l.i,l.x,l.y),u=qu(n.i,n.x,n.y),g=l.next,d=n.prev;return l.next=n,n.prev=l,o.next=g,g.prev=o,u.next=o,o.prev=u,d.next=u,u.prev=d,u}function gg(l,n,o,u){const g=qu(l,n,o);return u?(g.next=u.next,g.prev=u,u.next.prev=g,u.next=g):(g.prev=g,g.next=g),g}function xf(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function qu(l,n,o){return{i:l,x:n,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function al(l,n){const o=l.length;if(o<=1)return[l];const u=[];let g,d;for(let v=0;v<o;v++){const E=ai(l[v]);E!==0&&(l[v].area=Math.abs(E),d===void 0&&(d=E<0),d===E<0?(g&&u.push(g),g=[l[v]]):g.push(l[v]))}if(g&&u.push(g),n>1)for(let v=0;v<u.length;v++)u[v].length<=n||(Fd(u[v],n,1,u[v].length-1,_g),u[v]=u[v].slice(0,n));return u}function _g(l,n){return n.area-l.area}function wb(l,n,o=1){if(!l)return null;const u=typeof l=="string"?l:l.getPrimary().id;n[u]||(n[u]=[]);const g=so.from(u).getPrimary().scaleSelf(o);return n[u].push(g),g.serialize()}function Y_(l,n,o,u){const g=u.patternDependencies;let d=!1;for(const v of n){const E=v.paint.get(`${l}-pattern`);E.isConstant()||(d=!0),wb(E.constantOr(null),g,o)&&(d=!0)}return d}function K_(l,n,o,u,g,d){const v=d.patternDependencies;for(const E of n){const C=E.paint.get(`${l}-pattern`).value;if(C.kind!=="constant"){let z=C.evaluate({zoom:u},o,{},d.availableImages);z=z&&z.name?z.name:z;const w=wb(z,v,g);w&&(o.patterns[E.id]=w)}}return o}class J_{constructor(n){this.zoom=n.zoom,this.pixelRatio=n.pixelRatio,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new vl,this.indexArray=new Ha,this.indexArray2=new Xc,this.programConfigurations=new ts(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new Jr,this.segments2=new Jr,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=n.projection}updateFootprints(n,o){}populate(n,o,u,g){this.hasPattern=Y_("fill",this.layers,this.pixelRatio,o);const d=this.layers[0].layout.get("fill-sort-key"),v=[];for(const{feature:E,id:C,index:z,sourceLayerIndex:w}of n){const R=this.layers[0]._featureFilter.needGeometry,L=Z(E,R);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),L,u))continue;const A=d?d.evaluate(L,{},u,o.availableImages):void 0,D={id:C,properties:E.properties,type:E.type,sourceLayerIndex:w,index:z,geometry:R?L.geometry:q(E,u,g),patterns:{},sortKey:A};v.push(D)}d&&v.sort((E,C)=>E.sortKey-C.sortKey);for(const E of v){const{geometry:C,index:z,sourceLayerIndex:w}=E;if(this.hasPattern){const R=K_("fill",this.layers,E,this.zoom,this.pixelRatio,o);this.patternFeatures.push(R)}else this.addFeature(E,C,z,u,{},o.availableImages,o.brightness,o.elevationFeatures);o.featureIndex.insert(n[z].feature,C,z,w,this.index)}}update(n,o,u,g,d,v,E){this.programConfigurations.updatePaintArrays(n,o,d,u,g,v,E)}addFeatures(n,o,u,g,d,v){for(const E of this.patternFeatures)this.addFeature(E,E.geometry,E.index,o,u,g,v,n.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,qE),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,o,u,g,d,v=[],E,C){for(const z of al(o,500)){let w=0;for(const W of z)w+=W.length;const R=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),L=R.vertexLength,A=[],D=[];for(const W of z){if(W.length===0)continue;W!==z[0]&&D.push(A.length/2);const $=this.segments2.prepareSegment(W.length,this.layoutVertexArray,this.indexArray2),ie=$.vertexLength;this.layoutVertexArray.emplaceBack(W[0].x,W[0].y),this.indexArray2.emplaceBack(ie+W.length-1,ie),A.push(W[0].x),A.push(W[0].y);for(let re=1;re<W.length;re++)this.layoutVertexArray.emplaceBack(W[re].x,W[re].y),this.indexArray2.emplaceBack(ie+re-1,ie+re),A.push(W[re].x),A.push(W[re].y);$.vertexLength+=W.length,$.primitiveLength+=W.length}const F=mg(A,D);for(let W=0;W<F.length;W+=3)this.indexArray.emplaceBack(L+F[W],L+F[W+1],L+F[W+2]);R.vertexLength+=w,R.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,d,v,g,E)}}let Sb,Q_,Yy,Ky;Ln(J_,"FillBucket",{omit:["layers","patternFeatures"]});class Jy{constructor(n,o,u,g){if(this.triangleCount=o.length/3,this.min=new ke(0,0),this.max=new ke(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||n.length===0)return;const[d,v]=[n[0].clone(),n[0].clone()];for(let R=1;R<n.length;++R){const L=n[R];d.x=Math.min(d.x,L.x),d.y=Math.min(d.y,L.y),v.x=Math.max(v.x,L.x),v.y=Math.max(v.y,L.y)}if(g){const R=Math.ceil(Math.max(v.x-d.x,v.y-d.y)/g);u=Math.max(u,R)}if(u===0)return;this.min=d,this.max=v;const E=this.max.sub(this.min);E.x=Math.max(E.x,1),E.y=Math.max(E.y,1);const C=Math.max(E.x,E.y)/u;this.cellsX=Math.max(1,Math.ceil(E.x/C)),this.cellsY=Math.max(1,Math.ceil(E.y/C)),this.xScale=1/C,this.yScale=1/C;const z=[];for(let R=0;R<this.triangleCount;R++){const L=n[o[3*R+0]].sub(this.min),A=n[o[3*R+1]].sub(this.min),D=n[o[3*R+2]].sub(this.min),F=Ml(Math.floor(Math.min(L.x,A.x,D.x)),this.xScale,this.cellsX),W=Ml(Math.floor(Math.max(L.x,A.x,D.x)),this.xScale,this.cellsX),$=Ml(Math.floor(Math.min(L.y,A.y,D.y)),this.yScale,this.cellsY),ie=Ml(Math.floor(Math.max(L.y,A.y,D.y)),this.yScale,this.cellsY),re=new ke(0,0),ee=new ke(0,0),ae=new ke(0,0),de=new ke(0,0);for(let ye=$;ye<=ie;++ye){re.y=ee.y=ye*C,ae.y=de.y=(ye+1)*C;for(let De=F;De<=W;++De)re.x=ae.x=De*C,ee.x=de.x=(De+1)*C,(xt(L,A,D,re,ee,de)||xt(L,A,D,re,de,ae))&&z.push({cellIdx:ye*this.cellsX+De,triIdx:R})}}if(z.length===0)return;z.sort((R,L)=>R.cellIdx-L.cellIdx||R.triIdx-L.triIdx);let w=0;for(;w<z.length;){const R=z[w].cellIdx,L={start:this.payload.length,len:0};for(;w<z.length&&z[w].cellIdx===R;)++L.len,this.payload.push(z[w++].triIdx);this.cells[R]=L}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(n,o){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>n.x||n.y>this.max.y||this.min.y>n.y)return;const u=Ml(n.x-this.min.x,this.xScale,this.cellsX),g=Ml(n.y-this.min.y,this.yScale,this.cellsY),d=this.cells[g*this.cellsX+u];if(d){this._lazyInitLookup();for(let v=0;v<d.len;v++){const E=this.payload[d.start+v],C=Math.floor(E/8),z=1<<E%8;if(!(this.lookup[C]&z)&&(this.lookup[C]|=z,o.push(E),o.length===this.triangleCount))return}}}query(n,o,u){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>o.x||n.y>this.max.y||this.min.y>o.y)return;this._lazyInitLookup();const g=Ml(n.x-this.min.x,this.xScale,this.cellsX),d=Ml(o.x-this.min.x,this.xScale,this.cellsX),v=Ml(n.y-this.min.y,this.yScale,this.cellsY),E=Ml(o.y-this.min.y,this.yScale,this.cellsY);for(let C=v;C<=E;C++)for(let z=g;z<=d;z++){const w=this.cells[C*this.cellsX+z];if(w)for(let R=0;R<w.len;R++){const L=this.payload[w.start+R],A=Math.floor(L/8),D=1<<L%8;if(!(this.lookup[A]&D)&&(this.lookup[A]|=D,u.push(L),u.length===this.triangleCount))return}}}}function Ml(l,n,o){return Math.max(0,Math.min(o-1,Math.floor(l*n)))}Ln(Jy,"TriangleGridIndex");class ev{constructor(n){this.zoom=n.zoom,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.footprints=[]}updateFootprints(n,o){for(const u of this.footprints)o.push({footprint:u,id:n})}populate(n,o,u,g){const d=[];for(const{feature:v,id:E,index:C,sourceLayerIndex:z}of n){const w=this.layers[0]._featureFilter.needGeometry,R=Z(v,w);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),R,u))continue;const L={id:E,properties:v.properties,type:v.type,sourceLayerIndex:z,index:C,geometry:w?R.geometry:q(v,u,g),patterns:{}};d.push(L)}for(const v of d){const{geometry:E,index:C,sourceLayerIndex:z}=v;this.addFeature(v,E,C,u,{},o.availableImages,o.brightness),o.featureIndex.insert(n[C].feature,E,C,z,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(n){}update(n,o,u,g,d,v,E){}destroy(){}addFeature(n,o,u,g,d,v=[],E){for(const C of al(o,2)){const z=[],w=[],R=[],L=new ke(1/0,1/0),A=new ke(-1/0,-1/0);for(const W of C)if(W.length!==0){W!==C[0]&&R.push(w.length/2);for(let $=0;$<W.length;$++)w.push(W[$].x),w.push(W[$].y),z.push(W[$]),L.x=Math.min(L.x,W[$].x),L.y=Math.min(L.y,W[$].y),A.x=Math.max(A.x,W[$].x),A.y=Math.max(A.y,W[$].y)}const D=mg(w,R),F=new Jy(z,D,8,256);this.footprints.push({vertices:z,indices:D,grid:F,min:L,max:A})}}}Ln(ev,"ClipBucket",{omit:["layers"]});const XE=sr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),ZE=sr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),vg=sr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),YE=sr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Eb=sr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Or=sr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Qy}=XE;var Gp,tv,nv,iv,bf,yg,wf,xg={};function Mb(){if(tv)return Gp;tv=1;var l=qn();function n(g,d,v,E,C){this.properties={},this.extent=v,this.type=0,this._pbf=g,this._geometry=-1,this._keys=E,this._values=C,g.readFields(o,this,d)}function o(g,d,v){g==1?d.id=v.readVarint():g==2?function(E,C){for(var z=E.readVarint()+E.pos;E.pos<z;){var w=C._keys[E.readVarint()],R=C._values[E.readVarint()];C.properties[w]=R}}(v,d):g==3?d.type=v.readVarint():g==4&&(d._geometry=v.pos)}function u(g){for(var d,v,E=0,C=0,z=g.length,w=z-1;C<z;w=C++)E+=((v=g[w]).x-(d=g[C]).x)*(d.y+v.y);return E}return Gp=n,n.types=["Unknown","Point","LineString","Polygon"],n.prototype.loadGeometry=function(){var g=this._pbf;g.pos=this._geometry;for(var d,v=g.readVarint()+g.pos,E=1,C=0,z=0,w=0,R=[];g.pos<v;){if(C<=0){var L=g.readVarint();E=7&L,C=L>>3}if(C--,E===1||E===2)z+=g.readSVarint(),w+=g.readSVarint(),E===1&&(d&&R.push(d),d=[]),d.push(new l(z,w));else{if(E!==7)throw new Error("unknown command "+E);d&&d.push(d[0].clone())}}return d&&R.push(d),R},n.prototype.bbox=function(){var g=this._pbf;g.pos=this._geometry;for(var d=g.readVarint()+g.pos,v=1,E=0,C=0,z=0,w=1/0,R=-1/0,L=1/0,A=-1/0;g.pos<d;){if(E<=0){var D=g.readVarint();v=7&D,E=D>>3}if(E--,v===1||v===2)(C+=g.readSVarint())<w&&(w=C),C>R&&(R=C),(z+=g.readSVarint())<L&&(L=z),z>A&&(A=z);else if(v!==7)throw new Error("unknown command "+v)}return[w,L,R,A]},n.prototype.toGeoJSON=function(g,d,v){var E,C,z=this.extent*Math.pow(2,v),w=this.extent*g,R=this.extent*d,L=this.loadGeometry(),A=n.types[this.type];function D($){for(var ie=0;ie<$.length;ie++){var re=$[ie];$[ie]=[360*(re.x+w)/z-180,360/Math.PI*Math.atan(Math.exp((180-360*(re.y+R)/z)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(E=0;E<L.length;E++)F[E]=L[E][0];D(L=F);break;case 2:for(E=0;E<L.length;E++)D(L[E]);break;case 3:for(L=function($){var ie=$.length;if(ie<=1)return[$];for(var re,ee,ae=[],de=0;de<ie;de++){var ye=u($[de]);ye!==0&&(ee===void 0&&(ee=ye<0),ee===ye<0?(re&&ae.push(re),re=[$[de]]):re.push($[de]))}return re&&ae.push(re),ae}(L),E=0;E<L.length;E++)for(C=0;C<L[E].length;C++)D(L[E][C])}L.length===1?L=L[0]:A="Multi"+A;var W={type:"Feature",geometry:{type:A,coordinates:L},properties:this.properties};return"id"in this&&(W.id=this.id),W},Gp}function Tb(){if(iv)return nv;iv=1;var l=Mb();function n(u,g){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(o,this,g),this.length=this._features.length}function o(u,g,d){u===15?g.version=d.readVarint():u===1?g.name=d.readString():u===5?g.extent=d.readVarint():u===2?g._features.push(d.pos):u===3?g._keys.push(d.readString()):u===4&&g._values.push(function(v){for(var E=null,C=v.readVarint()+v.pos;v.pos<C;){var z=v.readVarint()>>3;E=z===1?v.readString():z===2?v.readFloat():z===3?v.readDouble():z===4?v.readVarint64():z===5?v.readVarint():z===6?v.readSVarint():z===7?v.readBoolean():null}return E}(d))}return nv=n,n.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var g=this._pbf.readVarint()+this._pbf.pos;return new l(this._pbf,g,this.extent,this._keys,this._values)},nv}function ex(){return wf||(wf=1,xg.VectorTile=function(){if(yg)return bf;yg=1;var l=Tb();function n(o,u,g){if(o===3){var d=new l(g,g.readVarint()+g.pos);d.length&&(u[d.name]=d)}}return bf=function(o,u){this.layers=o.readFields(n,{},u)},bf}(),xg.VectorTileFeature=Mb(),xg.VectorTileLayer=Tb()),xg}var Sf=ex();class ru extends ke{constructor(n,o,u){super(n,o),this.z=u}}class oa extends ru{constructor(n,o,u,g){super(n,o,u),this.w=g}}function Hp(l,n,o,u){const g=[],d=u===0?(v,E,C,z,w,R)=>{v.push(new ke(R,C+(R-E)/(z-E)*(w-C)))}:(v,E,C,z,w,R)=>{v.push(new ke(E+(R-C)/(w-C)*(z-E),R))};for(const v of l){const E=[];for(const C of v){if(C.length<=2)continue;const z=[];for(let L=0;L<C.length-1;L++){const A=C[L].x,D=C[L].y,F=C[L+1].x,W=C[L+1].y,$=u===0?A:D,ie=u===0?F:W;$<n?ie>n&&d(z,A,D,F,W,n):$>o?ie<o&&d(z,A,D,F,W,o):z.push(C[L]),ie<n&&$>=n&&d(z,A,D,F,W,n),ie>o&&$<=o&&d(z,A,D,F,W,o)}let w=C[C.length-1];const R=u===0?w.x:w.y;R>=n&&R<=o&&z.push(w),z.length&&(w=z[z.length-1],z[0].x===w.x&&z[0].y===w.y||z.push(z[0]),E.push(z))}E.length&&g.push(E)}return g}function Po(l,n,o,u){const g=o==="x"?"y":"x",d=(u-l[o])/(n[o]-l[o]);l[g]=l[g]+(n[g]-l[g])*d,l[o]=u,l.hasOwnProperty("z")&&(l.z=oi(l.z,n.z,d)),l.hasOwnProperty("w")&&(l.w=oi(l.w,n.w,d))}function Ab(l,n,o,u){const g=o,d=u;for(const v of["x","y"]){let E=l,C=n;E[v]>=C[v]&&(E=n,C=l),E[v]<g&&C[v]>g&&Po(E,C,v,g),E[v]<d&&C[v]>d&&Po(C,E,v,d)}}const qp=Number.MAX_SAFE_INTEGER;function rv(l,n,o,u){return l.order<n||l.order===qp||!(l.clipMask&o)||function(g,d){return d.length!==0&&d.find(v=>v===g)===void 0}(u,l.clipScope)}function Ef(l,n){return l.x-n.x||l.y-n.y}function tx(l,n){return Ef(l.min,n.min)===0&&Ef(l.max,n.max)===0}function av(l,n){return!(l.min.x>n.max.x||l.max.x<n.min.x||l.min.y>n.max.y||l.max.y<n.min.y)}function bg(l,n){if(l.length!==n.length)return!1;for(let o=0;o<l.length;o++)if(l[o].sourceId!==n[o].sourceId||!tx(l[o],n[o])||l[o].order!==n[o].order||l[o].clipMask!==n[o].clipMask||!Fi(l[o].clipScope,n[o].clipScope))return!1;return!0}function ov(l,n,o){const u=1/yn,g=1/(1<<o.canonical.z),d=(n.x*u+o.canonical.x)*g+o.wrap,v=(n.y*u+o.canonical.y)*g;return{min:new ke((l.x*u+o.canonical.x)*g+o.wrap,(l.y*u+o.canonical.y)*g),max:new ke(d,v)}}function KE(l,n,o){const u=1<<o.canonical.z,g=((n.x-o.wrap)*u-o.canonical.x)*yn,d=(n.y*u-o.canonical.y)*yn;return{min:new ke(((l.x-o.wrap)*u-o.canonical.x)*yn,(l.y*u-o.canonical.y)*yn),max:new ke(g,d)}}function nx(l,n,o,u,g,d,v){const E=l.indices,C=l.vertices,z=[];for(let w=u;w<u+g;w+=3){const R=n[o[w+0]+d],L=n[o[w+1]+d],A=n[o[w+2]+d],D=Math.min(R.x,L.x,A.x),F=Math.max(R.x,L.x,A.x),W=Math.min(R.y,L.y,A.y),$=Math.max(R.y,L.y,A.y);z.length=0,l.grid.query(new ke(D,W),new ke(F,$),z);for(let ie=0;ie<z.length;ie++){const re=z[ie];if(xt(C[E[3*re+0]],C[E[3*re+1]],C[E[3*re+2]],R,L,A,v))return!0}}return!1}function Cb(l,n,o,u){if(!l||!o)return!1;let g=l.vertices;if(!n.canonical.equals(u.canonical)||n.wrap!==u.wrap){if(o.vertices.length<l.vertices.length)return Cb(o,u,l,n);const d=n.canonical,v=u.canonical,E=Math.pow(2,v.z-d.z);g=l.vertices.map(C=>new ke((C.x+d.x*yn)*E-v.x*yn,(C.y+d.y*yn)*E-v.y*yn))}return nx(o,g,l.indices,0,l.indices.length,0,0)}function ix(l,n,o,u){const g=Math.pow(2,u.z-o.z);return new ke((l+o.x*yn)*g-u.x*yn,(n+o.y*yn)*g-u.y*yn)}function Rb(l,n){const o=[];n.grid.queryPoint(l,o);const u=n.indices,g=n.vertices;for(let d=0;d<o.length;d++){const v=o[d];if(Be([g[u[3*v+0]],g[u[3*v+1]],g[u[3*v+2]]],l))return!0}return!1}const rx=[new ke(0,0),new ke(yn,0),new ke(yn,yn),new ke(0,yn)];function sv(l,n){const o=[];let u=[];if(!n||l.length<2)return[l];if(l.length===2)return it(l[0],l[1],rx)?[l]:[];for(let g=0;g<l.length+2;g++){const d=l[g%l.length],v=l[(g+1)%l.length],E=it(g===0?l[l.length-1]:l[(g-1)%l.length],d,rx),C=it(d,v,rx),z=E||C;z&&u.push(d),z&&C||u.length>0&&(u.length>1&&o.push(u),u=[])}return u.length>1&&o.push(u),o}const wg=Sf.VectorTileFeature.types,JE=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],QE=["fill-extrusion-flood-light-ground-radius"],rc=Math.pow(2,13),Ib=Math.pow(2,15)-1,ax=new ke(0,1),So=2147483648;function Wp(l,n,o,u,g,d,v,E){l.emplaceBack((n<<1)+v,(o<<1)+d,(Math.floor(u*rc)<<1)+g,Math.round(E))}function ed(l,n,o){l.emplaceBack(n.x*yn,n.y*yn,o?1:0)}function Tl(l,n,o,u,g,d){l.emplaceBack(n.x,n.y,(o.x<<1)+u,(o.y<<1)+g,d)}function Sg(l,n,o){l.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class Db{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Mf{constructor(){this.centroidXY=new ke(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ke(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ke(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new ke(this.max.x-this.min.x,this.max.y-this.min.y)}}class ox{constructor(){this.acc=new ke(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(n,o){n.min.x===Number.MAX_VALUE&&(n.min.x=n.max.x=o.x,n.min.y=n.max.y=o.y)}appendEdge(n,o,u){this.accCount++,this.acc._add(o);let g=!!this.borders;o.x<n.min.x?(n.min.x=o.x,g=!0):o.x>n.max.x&&(n.max.x=o.x,g=!0),o.y<n.min.y?(n.min.y=o.y,g=!0):o.y>n.max.y&&(n.max.y=o.y,g=!0),((o.x===0||o.x===yn)&&o.x===u.x)!=((o.y===0||o.y===yn)&&o.y===u.y)&&this.processBorderOverlap(o,u),g&&this.checkBorderIntersection(o,u)}checkBorderIntersection(n,o){o.x<0!=n.x<0&&this.addBorderIntersection(0,oi(o.y,n.y,(0-o.x)/(n.x-o.x))),o.x>yn!=n.x>yn&&this.addBorderIntersection(1,oi(o.y,n.y,(yn-o.x)/(n.x-o.x))),o.y<0!=n.y<0&&this.addBorderIntersection(2,oi(o.x,n.x,(0-o.y)/(n.y-o.y))),o.y>yn!=n.y>yn&&this.addBorderIntersection(3,oi(o.x,n.x,(yn-o.y)/(n.y-o.y)))}addBorderIntersection(n,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[n];o<u[0]&&(u[0]=o),o>u[1]&&(u[1]=o)}processBorderOverlap(n,o){if(n.x===o.x){if(n.y===o.y)return;const u=n.x===0?0:1;this.addBorderIntersection(u,o.y),this.addBorderIntersection(u,n.y)}else{const u=n.y===0?2:3;this.addBorderIntersection(u,o.x),this.addBorderIntersection(u,n.x)}}centroid(){return this.accCount===0?new ke(0,0):new ke(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((n,o)=>n+ +(o[0]!==Number.MAX_VALUE),0):0}}function Pb(l,n){const o=l.add(n)._unit(),u=gt(l.x*o.x+l.y*o.y,-1,1);var g,d,v;return v=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(v)))/4*Ib*((g=l).x*(d=n).y-g.y*d.x<0?-1:1)}const eM=[l=>l.x<0,l=>l.x>yn,l=>l.y<0,l=>l.y>yn];function tM(l,n,o,u){const g=[4];if(u===0)return g;o._mult(u);const d=l.sub(o),v=n.sub(o),E=[l,n,d,v];for(let C=0;C<4;C++)for(const z of E)if(eM[C](z)){g.push(C);break}return g}class Lb{constructor(n){this.vertexArray=new af,this.indexArray=new Ha,this.programConfigurations=new ts(n.layers,{zoom:n.zoom,lut:n.lut},o=>QE.includes(o)),this._segments=new Jr,this.hiddenByLandmarkVertexArray=new cf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Jr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(n,o,u,g=!1){const d=n.length;if(d>2){let v=Math.max(0,this._segments.get().length-1);const E=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[v].length);let C;v!==this._segments.get().length-1&&(v++,this._segmentToGroundQuads[v]=[],this._segmentToRegionTriCounts[v]=[0,0,0,0,0]);{const z=n[0],w=n[1];C=Pb(z.sub(n[d-1])._perp()._unit(),w.sub(z)._perp()._unit())}for(let z=0;z<d;z++){const w=z===d-1?0:z+1,R=n[z],L=n[w],A=n[w===d-1?0:w+1],D=L.sub(R)._perp()._unit(),F=Pb(D,A.sub(L)._perp()._unit()),W=C,$=F;if(td(R,L,o)||g&&$p(R,o)&&$p(L,o)){C=F;continue}const ie=E.vertexLength;Tl(this.vertexArray,R,L,1,1,W),Tl(this.vertexArray,R,L,1,0,W),Tl(this.vertexArray,R,L,0,1,$),Tl(this.vertexArray,R,L,0,0,$),E.vertexLength+=4;const re=tM(R,L,D,u);for(const ee of re)this._segmentToGroundQuads[v].push({id:ie,region:ee}),this._segmentToRegionTriCounts[v][ee]+=2,E.primitiveLength+=2;C=F}}}prepareBorderSegments(){if(!this.hasData())return;const n=this._segments.get(),o=n.length;for(let u=0;u<o;u++)this._segmentToGroundQuads[u].sort((g,d)=>g.region-d.region);for(let u=0;u<o;u++){const g=this._segmentToGroundQuads[u],d=n[u],v=this._segmentToRegionTriCounts[u];v.reduce((C,z)=>C+z,0);let E=0;for(let C=0;C<=4;C++){const z=v[C];if(z!==0){let w=this.regionSegments[C];w||(w=this.regionSegments[C]=new Jr);const R={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+E,vertexLength:d.vertexLength,primitiveLength:z};w.get().push(R)}E+=z}for(let C=0;C<g.length;C++){const z=g[C].id;this.indexArray.emplaceBack(z,z+1,z+3),this.indexArray.emplaceBack(z,z+3,z+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(n,o,u,g,d,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,n,o,u,g,d,v)}upload(n){this.hasData()&&(this.vertexBuffer=n.createVertexBuffer(this.vertexArray,ZE.members),this.indexBuffer=n.createIndexBuffer(this.indexArray))}uploadPaintProperties(n){this.hasData()&&this.programConfigurations.upload(n)}update(n,o,u,g,d,v,E){this.hasData()&&this.programConfigurations.updatePaintArrays(n,o,u,g,d,v,E)}updateHiddenByLandmark(n){if(!this.hasData())return;const o=n.groundVertexCount+n.groundVertexArrayOffset;if(n.groundVertexCount===0)return;const u=n.flags&So?1:0;for(let g=n.groundVertexArrayOffset;g<o;++g)this.hiddenByLandmarkVertexArray.emplace(g,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(n){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=n.createVertexBuffer(this.hiddenByLandmarkVertexArray,Eb.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let n=0;n<=4;n++){const o=this.regionSegments[n];o&&o.destroy()}}}}class lv{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.pixelRatio=n.pixelRatio,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ha,this.footprintVertices=new vl,this.footprintSegments=[],this.layoutVertexArray=new Js,this.centroidVertexArray=new Bo,this.wallVertexArray=new dg,this.indexArray=new Ha,this.programConfigurations=new ts(n.layers,{zoom:n.zoom,lut:n.lut},o=>JE.includes(o)),this.segments=new Jr,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.groundEffect=new Lb(n),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(n,o){}populate(n,o,u,g){this.features=[],this.hasPattern=Y_("fill-extrusion",this.layers,this.pixelRatio,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=i(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:d,id:v,index:E,sourceLayerIndex:C}of n){const z=this.layers[0]._featureFilter.needGeometry,w=Z(d,z);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),w,u))continue;const R={id:v,sourceLayerIndex:C,index:E,geometry:z?w.geometry:q(d,u,g),properties:d.properties,type:d.type,patterns:{}},L=this.layoutVertexArray.length,A=wg[R.type]==="Polygon";if(this.hasPattern)this.features.push(K_("fill-extrusion",this.layers,R,this.zoom,this.pixelRatio,o));else if(this.wallMode)for(const D of R.geometry)for(const F of sv(D,A))this.addFeature(R,[F],E,u,{},o.availableImages,g,o.brightness);else this.addFeature(R,R.geometry,E,u,{},o.availableImages,g,o.brightness);o.featureIndex.insert(d,R.geometry,E,C,this.index,L)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(n,o,u,g,d,v){for(const E of this.features){const C=wg[E.type]==="Polygon",{geometry:z}=E;if(this.wallMode)for(const w of z)for(const R of sv(w,C))this.addFeature(E,[R],E.index,o,u,g,d,v);else this.addFeature(E,z,E.index,o,u,g,d,v)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(n,o,u,g,d,v,E){this.programConfigurations.updatePaintArrays(n,o,d,u,g,v,E),this.groundEffect.update(n,o,d,u,g,v,E)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Qy),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.wallVertexBuffer=n.createVertexBuffer(this.wallVertexArray,YE.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,Or.members,!0)),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.groundEffect.uploadHiddenByLandmark(n),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,vg.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,o,u,g,d,v,E,C){const z=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,w=[new ke(0,0),new ke(yn,yn)],R=E.projection,L=R.name==="globe",A=this.wallMode||wg[n.type]==="Polygon",D=new ox;D.centroidDataIndex=this.centroidData.length;const F=new Mf,W=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},g)<=0,$=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},g);let ie;if(F.height=$,F.vertexArrayOffset=this.layoutVertexArray.length,F.groundVertexArrayOffset=this.groundEffect.vertexArray.length,L&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new jh),this.wallMode){if(L)return void Wn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(o.length!==1)return;ie=function(Re){const $e=Re[0].x===Re[Re.length-1].x&&Re[0].y===Re[Re.length-1].y;(function(cn){let nn=0;const Hn=cn.length;for(let In=0;In<Hn;In++)nn+=(cn[(In+1)%Hn].x-cn[In].x)*(cn[(In+1)%Hn].y+cn[In].y);return nn>=0})(Re)||(Re=Re.reverse());const Ye={geometry:[],joinNormals:[],indices:[]},tt=[],Je=[],rt=[];let ct=Re.length;for(;ct>=2&&Re[ct-1].equals(Re[ct-2]);)ct--;if(ct<($e?3:2))return Ye;let yt,st,Bt,Qt,Nt,An=0;for(;An<ct-1&&Re[An].equals(Re[An+1]);)An++;$e&&(yt=Re[ct-2],Nt=Re[An].sub(yt)._unit()._perp());for(let cn=An;cn<ct;cn++){if(Bt=cn===ct-1?$e?Re[An+1]:void 0:Re[cn+1],Bt&&Re[cn].equals(Bt))continue;Nt&&(Qt=Nt),yt&&(st=yt),yt=Re[cn],Nt=Bt?Bt.sub(yt)._unit()._perp():Qt,Qt=Qt||Nt;let nn=Qt.add(Nt);nn.x===0&&nn.y===0||nn._unit();const Hn=nn.x*Nt.x+nn.y*Nt.y,In=Hn!==0?1/Hn:1/0,kn=Qt.x*Nt.y-Qt.y*Nt.x>0;let yi="miter";const Ri=2;yi==="miter"&&In>Ri&&(yi="bevel"),yi==="bevel"&&(In>100&&(yi="flipbevel"),In<Ri&&(yi="miter"));const zi=(ki,$i,Zi,zr)=>{const xr=new ke(ki.x,ki.y),Mi=new ke(ki.x,ki.y);xr.x+=$i.x*zr,xr.y+=$i.y*zr,Mi.x-=$i.x*Math.max(Zi,1),Mi.y-=$i.y*Math.max(Zi,1),rt.push($i),tt.push(xr),Je.push(Mi)};if(yi==="miter")nn._mult(In),zi(yt,nn,0,0);else if(yi==="flipbevel")nn=Nt.mult(-1),zi(yt,nn,0,0),zi(yt,nn.mult(-1),0,0);else{const ki=-Math.sqrt(In*In-1),$i=kn?ki:0,Zi=kn?0:ki;st&&zi(yt,Qt,$i,Zi),Bt&&zi(yt,Nt,$i,Zi)}}Ye.geometry=[...tt,...Je.reverse(),tt[0]],Ye.joinNormals=[...rt,...rt.reverse(),rt[rt.length-1]];const xn=Ye.geometry.length-1;for(let cn=0;cn<xn/2;cn++)if(cn+1<xn/2){let nn=cn,Hn=cn+1,In=xn-1-cn,kn=xn-2-cn;nn=nn===0?xn-1:nn-1,Hn=Hn===0?xn-1:Hn-1,In=In===0?xn-1:In-1,kn=kn===0?xn-1:kn-1,Ye.indices.push(In),Ye.indices.push(Hn),Ye.indices.push(nn),Ye.indices.push(In),Ye.indices.push(kn),Ye.indices.push(Hn)}return Ye}(o[0]),o=[ie.geometry]}const re=(Re,$e)=>Re<($e.length-1)/2||Re===$e.length-1,ee=this.wallMode?[o]:al(o,500);for(let Re=ee.length-1;Re>=0;Re--){const $e=ee[Re];($e.length===0||(ae=$e[0]).every(Oe=>Oe.x<=0)||ae.every(Oe=>Oe.x>=yn)||ae.every(Oe=>Oe.y<=0)||ae.every(Oe=>Oe.y>=yn))&&ee.splice(Re,1)}var ae;let de;if(L)de=Xp(ee,w,g);else{de=[];for(const Re of ee)de.push({polygon:Re,bounds:w})}const ye=A?this.edgeRadius:0,De=ye>0&&this.zoom<17,Ie=(Re,$e)=>{if(Re.length===0)return!1;const Oe=Re[Re.length-1];return $e.x===Oe.x&&$e.y===Oe.y};for(const{polygon:Re,bounds:$e}of de){let Oe=0,Ye=0;for(const ct of Re)A&&!ct[0].equals(ct[ct.length-1])&&ct.push(ct[0]),Ye+=A?ct.length-1:ct.length;const tt=this.segments.prepareSegment((A?5:4)*Ye,this.layoutVertexArray,this.indexArray);F.footprintSegIdx<0&&(F.footprintSegIdx=this.footprintSegments.length),F.polygonSegIdx<0&&(F.polygonSegIdx=this.polygonSegments.length);const Je={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},rt=new Db;if(rt.vertexOffset=this.footprintVertices.length,rt.indexOffset=3*this.footprintIndices.length,rt.ringIndices=[],A){const ct=[],yt=[];Oe=tt.vertexLength;for(let Bt=0;Bt<Re.length;Bt++){const Qt=Re[Bt];Qt.length&&Bt!==0&&yt.push(ct.length/2);const Nt=[];let An,xn;An=Qt[1].sub(Qt[0])._perp()._unit(),rt.ringIndices.push(Qt.length-1);for(let cn=1;cn<Qt.length;cn++){const nn=Qt[cn],Hn=Qt[cn===Qt.length-1?1:cn+1],In=nn.clone();if(ye){xn=Hn.sub(nn)._perp()._unit();const kn=An.add(xn)._unit(),yi=ye*Math.min(4,1/(An.x*kn.x+An.y*kn.y));In.x+=yi*kn.x,In.y+=yi*kn.y,In.x=Math.round(In.x),In.y=Math.round(In.y),An=xn}if(!W||ye!==0&&!De||Ie(Nt,In)||Nt.push(In),Wp(this.layoutVertexArray,In.x,In.y,0,0,1,1,0),this.wallMode){const kn=re(cn,Qt);ed(this.wallVertexArray,ie.joinNormals[cn],!kn)}tt.vertexLength++,this.footprintVertices.emplaceBack(nn.x,nn.y),ct.push(nn.x,nn.y),L&&Sg(this.layoutVertexExtArray,R.projectTilePoint(In.x,In.y,g),R.upVector(g,In.x,In.y))}W&&(ye===0||De)&&(Nt.length!==0&&Ie(Nt,Nt[0])&&Nt.pop(),this.groundEffect.addData(Nt,$e,z))}const st=this.wallMode?ie.indices:mg(ct,yt);for(let Bt=0;Bt<st.length;Bt+=3)this.footprintIndices.emplaceBack(rt.vertexOffset+st[Bt+0],rt.vertexOffset+st[Bt+1],rt.vertexOffset+st[Bt+2]),this.indexArray.emplaceBack(Oe+st[Bt],Oe+st[Bt+2],Oe+st[Bt+1]),tt.primitiveLength++;rt.indexCount+=st.length,rt.vertexCount+=this.footprintVertices.length-rt.vertexOffset}for(let ct=0;ct<Re.length;ct++){const yt=Re[ct];D.startRing(F,yt[0]);let st=yt.length>4&&lx(yt[yt.length-2],yt[0],yt[1]),Bt=ye?nM(yt[yt.length-2],yt[0],yt[1],ye):0;const Qt=[];let Nt,An,xn;An=yt[1].sub(yt[0])._perp()._unit();let cn=!0;for(let nn=1,Hn=0;nn<yt.length;nn++){let In=yt[nn-1],kn=yt[nn];const yi=yt[nn===yt.length-1?1:nn+1];if(D.appendEdge(F,kn,In),td(kn,In,$e)){ye&&(An=yi.sub(kn)._perp()._unit(),cn=!cn);continue}const Ri=kn.sub(In)._perp(),zi=Ri.x/(Math.abs(Ri.x)+Math.abs(Ri.y)),ki=Ri.y>0?1:0,$i=In.dist(kn);if(Hn+$i>32768&&(Hn=0),ye){xn=yi.sub(kn)._perp()._unit();let Mi=sx(In,kn,yi,Ob(An,xn),ye);isNaN(Mi)&&(Mi=0);const _r=kn.sub(In)._unit();In=In.add(_r.mult(Bt))._round(),kn=kn.add(_r.mult(-Mi))._round(),Bt=Mi,An=xn,W&&this.zoom>=17&&(Ie(Qt,In)||Qt.push(In),Ie(Qt,kn)||Qt.push(kn))}const Zi=tt.vertexLength,zr=yt.length>4&&lx(In,kn,yi);let xr=zb(Hn,st,cn);if(Wp(this.layoutVertexArray,In.x,In.y,zi,ki,0,0,xr),Wp(this.layoutVertexArray,In.x,In.y,zi,ki,0,1,xr),this.wallMode){const Mi=re(nn-1,yt),_r=ie.joinNormals[nn-1];ed(this.wallVertexArray,_r,Mi),ed(this.wallVertexArray,_r,Mi)}if(Hn+=$i,xr=zb(Hn,zr,!cn),st=zr,Wp(this.layoutVertexArray,kn.x,kn.y,zi,ki,0,0,xr),Wp(this.layoutVertexArray,kn.x,kn.y,zi,ki,0,1,xr),this.wallMode){const Mi=re(nn,yt),_r=ie.joinNormals[nn];ed(this.wallVertexArray,_r,Mi),ed(this.wallVertexArray,_r,Mi)}if(tt.vertexLength+=4,this.indexArray.emplaceBack(Zi+0,Zi+1,Zi+2),this.indexArray.emplaceBack(Zi+1,Zi+3,Zi+2),tt.primitiveLength+=2,ye){const Mi=Oe+(nn===1?yt.length-2:nn-2),_r=nn===1?Oe:Mi+1;if(this.indexArray.emplaceBack(Zi+1,Mi,Zi+3),this.indexArray.emplaceBack(Mi,_r,Zi+3),tt.primitiveLength+=2,Nt===void 0&&(Nt=Zi),!td(yi,yt[nn],$e)){const vr=nn===yt.length-1?Nt:tt.vertexLength;this.indexArray.emplaceBack(Zi+2,Zi+3,vr),this.indexArray.emplaceBack(Zi+3,vr+1,vr),this.indexArray.emplaceBack(Zi+3,_r,vr+1),tt.primitiveLength+=3}cn=!cn}if(L){const Mi=this.layoutVertexExtArray,_r=R.projectTilePoint(In.x,In.y,g),vr=R.projectTilePoint(kn.x,kn.y,g),Xr=R.upVector(g,In.x,In.y),Ea=R.upVector(g,kn.x,kn.y);Sg(Mi,_r,Xr),Sg(Mi,_r,Xr),Sg(Mi,vr,Ea),Sg(Mi,vr,Ea)}}A&&(Oe+=yt.length-1),W&&ye&&this.zoom>=17&&(Qt.length!==0&&Ie(Qt,Qt[0])&&Qt.pop(),this.groundEffect.addData(Qt,$e,z,ye>0))}this.footprintSegments.push(rt),Je.triangleCount=this.indexArray.length-Je.triangleArrayOffset,this.polygonSegments.push(Je),++F.footprintSegLen,++F.polygonSegLen}if(F.vertexCount=this.layoutVertexArray.length-F.vertexArrayOffset,F.groundVertexCount=this.groundEffect.vertexArray.length-F.groundVertexArrayOffset,F.vertexCount!==0){if(F.centroidXY=D.borders?ax:this.encodeCentroid(D,F),this.centroidData.push(F),D.borders){this.featuresOnBorder.push(D);const Re=this.featuresOnBorder.length-1;for(let $e=0;$e<D.borders.length;$e++)D.borders[$e][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[$e].push(Re)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,d,v,g,C),this.groundEffect.addPaintPropertiesData(n,u,d,v,g,C),this.maxHeight=Math.max(this.maxHeight,$)}}sortBorders(){for(let n=0;n<this.borderFeatureIndices.length;n++)this.borderFeatureIndices[n].sort((o,u)=>this.featuresOnBorder[o].borders[n][0]-this.featuresOnBorder[u].borders[n][0])}splitToSubtiles(){const n=[];for(let E=0;E<this.centroidData.length;E++){const C=this.centroidData[E],z=+(C.min.y+C.max.y>yn),w=2*z+(+(C.min.x+C.max.x>yn)^z);for(let R=0;R<C.polygonSegLen;R++){const L=C.polygonSegIdx+R;n.push({centroidIdx:E,subtile:w,polygonSegmentIdx:L,triangleSegmentIdx:this.polygonSegments[L].triangleSegIdx})}}const o=new Ha;n.sort((E,C)=>E.triangleSegmentIdx===C.triangleSegmentIdx?E.subtile-C.subtile:E.triangleSegmentIdx-C.triangleSegmentIdx);let u=0,g=0,d=0;for(const E of n){if(E.triangleSegmentIdx!==u)break;d++}const v=n.length;for(;g!==n.length;){u=n[g].triangleSegmentIdx;let E=0,C=g,z=g;for(let w=C;w<d&&n[w].subtile===E;w++)z++;for(;C!==d;){const w=n[C];E=w.subtile;const R=this.centroidData[w.centroidIdx].min.clone(),L=this.centroidData[w.centroidIdx].max.clone(),A={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let D=C;D<z;D++){const F=n[D],W=this.polygonSegments[F.polygonSegmentIdx],$=this.centroidData[F.centroidIdx].min,ie=this.centroidData[F.centroidIdx].max,re=this.indexArray.uint16;for(let ee=W.triangleArrayOffset;ee<W.triangleArrayOffset+W.triangleCount;ee++)o.emplaceBack(re[3*ee],re[3*ee+1],re[3*ee+2]);A.primitiveLength+=W.triangleCount,R.x=Math.min(R.x,$.x),R.y=Math.min(R.y,$.y),L.x=Math.max(L.x,ie.x),L.y=Math.max(L.y,ie.y)}A.primitiveLength>0&&this.triangleSubSegments.push({segment:A,min:R,max:L}),C=z;for(let D=C;D<d&&n[D].subtile===n[C].subtile;D++)z++}g=d;for(let w=g;w<v&&n[w].triangleSegmentIdx===n[g].triangleSegmentIdx;w++)d++}o._trim(),this.indexArray=o}getVisibleSegments(n,o,u){const g=new Jr;if(this.wallMode){for(const F of this.triangleSubSegments)g.segments.push(F.segment);return g}let d=0,v=0;const E=1<<n.canonical.z;if(o){const F=o.getMinMaxForTile(n);F&&(d=F.min,v=F.max)}v+=this.maxHeight;const C=n.toUnwrapped();let z;const w=[C.canonical.x/E+C.wrap,C.canonical.y/E],R=[(C.canonical.x+1)/E+C.wrap,(C.canonical.y+1)/E],L=(F,W,$)=>[F[0]*(1-$[0])+W[0]*$[0],F[1]*(1-$[1])+W[1]*$[1]],A=[],D=[];for(const F of this.triangleSubSegments){A[0]=F.min.x/yn,A[1]=F.min.y/yn,D[0]=F.max.x/yn,D[1]=F.max.y/yn;const W=L(w,R,A),$=L(w,R,D);if(new Rn([W[0],W[1],d],[$[0],$[1],v]).intersectsPrecise(u)===0){z&&(g.segments.push(z),z=void 0);continue}const ie=F.segment;z&&z.vertexOffset!==ie.vertexOffset&&(g.segments.push(z),z=void 0),z?(z.vertexLength+=ie.vertexLength,z.primitiveLength+=ie.primitiveLength):z={vertexOffset:ie.vertexOffset,primitiveLength:ie.primitiveLength,vertexLength:ie.vertexLength,primitiveOffset:ie.primitiveOffset,sortKey:void 0,vaos:{}}}return z&&g.segments.push(z),g}encodeCentroid(n,o){const u=n.centroid(),g=o.span(),d=Math.min(7,Math.round(g.x*this.tileToMeter/10)),v=Math.min(7,Math.round(g.y*this.tileToMeter/10));return new ke(gt(u.x,1,yn-1)<<3|d,gt(u.y,1,yn-1)<<3|v)}encodeBorderCentroid(n){if(!n.borders)return new ke(0,0);const o=n.borders,u=Number.MAX_VALUE;if(o[0][0]!==u||o[1][0]!==u){const g=o[0][0]!==u?0:1;return new ke(6|(o[0][0]!==u?0:65528),(o[g][0]+o[g][1])/2<<3|6)}{const g=o[2][0]!==u?2:3;return new ke((o[g][0]+o[g][1])/2<<3|6,6|(o[2][0]!==u?0:65528))}}showCentroid(n){const o=this.centroidData[n.centroidDataIndex];o.flags&=So,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(n){this.groundEffect.updateHiddenByLandmark(n);const o=n.vertexArrayOffset,u=n.vertexCount+n.vertexArrayOffset,g=n.flags&So?ax:n.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==g.y||d!==g.x){for(let v=o;v<u;++v)this.centroidVertexArray.emplace(v,g.x,g.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const n of this.centroidData)this.writeCentroidToBuffer(n)}updateReplacement(n,o,u){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const g=o.getReplacementRegionsForTile(n.toUnwrapped());if(bg(this.activeReplacements,g))return;if(this.activeReplacements=g,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const v of this.centroidData)v.flags&=2147483647;const d=[];for(const v of this.activeReplacements){if(v.order<u)continue;const E=Math.max(1,Math.pow(2,v.footprintTileId.canonical.z-n.canonical.z));for(const C of this.centroidData)if(!(C.flags&So||v.min.x>C.max.x||C.min.x>v.max.x||v.min.y>C.max.y||C.min.y>v.max.y))for(let z=0;z<C.footprintSegLen;z++){const w=this.footprintSegments[C.footprintSegIdx+z];if(d.length=0,kb(this.footprintVertices,w.vertexOffset,w.vertexCount,v.footprintTileId.canonical,n.canonical,d),nx(v.footprint,d,this.footprintIndices.uint16,w.indexOffset,w.indexCount,-w.vertexOffset,-E)){C.flags|=So;break}}}for(const v of this.centroidData)this.writeCentroidToBuffer(v);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(n,o,u){let g=!1;for(let d=0;d<u.footprintSegLen;d++){const v=this.footprintSegments[u.footprintSegIdx+d];let E=0;for(const C of v.ringIndices){for(let z=E,w=C+E-1;z<C+E;w=z++){const R=this.footprintVertices.int16[2*(z+v.vertexOffset)+0],L=this.footprintVertices.int16[2*(z+v.vertexOffset)+1],A=this.footprintVertices.int16[2*(w+v.vertexOffset)+1];L>o!=A>o&&n<(this.footprintVertices.int16[2*(w+v.vertexOffset)+0]-R)*(o-L)/(A-L)+R&&(g=!g)}E=C}}return g}getHeightAtTileCoord(n,o){let u=Number.NEGATIVE_INFINITY,g=!0;const d=4*(n+yn)*yn+(o+yn);if(this.partLookup.hasOwnProperty(d)){const v=this.partLookup[d];return v?{height:v.height,hidden:!!(v.flags&So)}:void 0}for(const v of this.centroidData)n>v.max.x||v.min.x>n||o>v.max.y||v.min.y>o||this.footprintContainsPoint(n,o,v)&&v&&v.height>u&&(u=v.height,this.partLookup[d]=v,g=!!(v.flags&So));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:g};this.partLookup[d]=void 0}}function Ob(l,n){const o=l.add(n)._unit();return l.x*o.x+l.y*o.y}function nM(l,n,o,u){const g=n.sub(l)._perp()._unit(),d=o.sub(n)._perp()._unit();return sx(l,n,o,Ob(g,d),u)}function sx(l,n,o,u,g){const d=Math.sqrt(1-u*u);return Math.min(l.dist(n)/3,n.dist(o)/3,g*d/u)}function td(l,n,o){return l.x<o[0].x&&n.x<o[0].x||l.x>o[1].x&&n.x>o[1].x||l.y<o[0].y&&n.y<o[0].y||l.y>o[1].y&&n.y>o[1].y}function $p(l,n){return l.x<n[0].x||l.x>n[1].x||l.y<n[0].y||l.y>n[1].y}function lx(l,n,o){if(l.x<0||l.x>=yn||n.x<0||n.x>=yn||o.x<0||o.x>=yn)return!1;const u=o.sub(n),g=u.perp(),d=l.sub(n);return(u.x*d.x+u.y*d.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(d.x*d.x+d.y*d.y))>-.866&&g.x*d.x+g.y*d.y<0}function zb(l,n,o){const u=n?2|l:-3&l;return o?1|u:-2&u}function Tf(){const l=Math.PI/32,n=Math.tan(l),o=il;return o*Math.sqrt(1+2*n*n)-o}function Xp(l,n,o){const u=1<<o.z,g=Ro(o.x/u),d=Ro((o.x+1)/u),v=Ra(o.y/u),E=Ra((o.y+1)/u);return function(C,z,w,R,L=0,A){const D=[];if(!C.length||!w||!R)return D;const F=(de,ye)=>{for(const De of de)D.push({polygon:De,bounds:ye})},W=Math.ceil(Math.log2(w)),$=Math.ceil(Math.log2(R)),ie=W-$,re=[];for(let de=0;de<Math.abs(ie);de++)re.push(ie>0?0:1);for(let de=0;de<Math.min(W,$);de++)re.push(0),re.push(1);let ee=C;if(ee=Hp(ee,z[0].y-L,z[1].y+L,1),ee=Hp(ee,z[0].x-L,z[1].x+L,0),!ee.length)return D;const ae=[];for(re.length?ae.push({polygons:ee,bounds:z,depth:0}):F(ee,z);ae.length;){const de=ae.pop(),ye=de.depth,De=re[ye],Ie=de.bounds[0],Re=de.bounds[1],$e=De===0?Ie.x:Ie.y,Oe=De===0?Re.x:Re.y,Ye=A?A(De,$e,Oe):.5*($e+Oe),tt=Hp(de.polygons,$e-L,Ye+L,De),Je=Hp(de.polygons,Ye-L,Oe+L,De);if(tt.length){const rt=[Ie,new ke(De===0?Ye:Re.x,De===1?Ye:Re.y)];re.length>ye+1?ae.push({polygons:tt,bounds:rt,depth:ye+1}):F(tt,rt)}if(Je.length){const rt=[new ke(De===0?Ye:Ie.x,De===1?Ye:Ie.y),Re];re.length>ye+1?ae.push({polygons:Je,bounds:rt,depth:ye+1}):F(Je,rt)}}return D}(l,n,Math.ceil((d-g)/11.25),Math.ceil((v-E)/11.25),1,(C,z,w)=>{if(C===0)return .5*(z+w);{const R=Ra((o.y+z/yn)/u);return(Ns(.5*(Ra((o.y+w/yn)/u)+R))*u-o.y)*yn}})}function kb(l,n,o,u,g,d){const v=Math.pow(2,u.z-g.z);for(let E=0;E<o;E++){let C=l.int16[2*(E+n)+0],z=l.int16[2*(E+n)+1];C=(C+g.x*yn)*v-u.x*yn,z=(z+g.y*yn)*v-u.y*yn,d.push(new ke(C,z))}}let Eg,cv;function Af(l,n){return l.x*n.x+l.y*n.y}function Mg(l,n){if(l.length===1){let o=0;const u=n[o++];let g;for(;!g||u.equals(g);)if(g=n[o++],!g)return 1/0;for(;o<n.length;o++){const d=n[o],v=l[0],E=g.sub(u),C=d.sub(u),z=v.sub(u),w=Af(E,E),R=Af(E,C),L=Af(C,C),A=Af(z,E),D=Af(z,C),F=w*L-R*R,W=(L*A-R*D)/F,$=(w*D-R*A)/F,ie=u.z*(1-W-$)+g.z*W+d.z*$;if(isFinite(ie))return ie}return 1/0}{let o=1/0;for(const u of n)o=Math.min(o,u.z);return o}}function cx(l,n,o,u,g,d,v,E){const C=v*g.getElevationAt(l,n,!0,!0),z=d[0]!==0,w=z?d[1]===0?v*(d[0]/7-450):v*function(R,L,A){const D=Math.floor(L[0]/8),F=Math.floor(L[1]/8),W=10*(L[0]-8*D),$=10*(L[1]-8*F),ie=R.getElevationAt(D,F,!0,!0),re=R.getMeterToDEM(A),ee=Math.floor(.5*(W*re-1)),ae=Math.floor(.5*($*re-1)),de=R.tileCoordToPixel(D,F),ye=2*ee+1,De=2*ae+1,Ie=function(Je,rt,ct,yt,st){return[Je.getElevationAtPixel(rt,ct,!0),Je.getElevationAtPixel(rt+st,ct,!0),Je.getElevationAtPixel(rt,ct+st,!0),Je.getElevationAtPixel(rt+yt,ct+st,!0)]}(R,de.x-ee,de.y-ae,ye,De),Re=Math.abs(Ie[0]-Ie[1]),$e=Math.abs(Ie[2]-Ie[3]),Oe=Math.abs(Ie[0]-Ie[2])+Math.abs(Ie[1]-Ie[3]),Ye=Math.min(.25,.5*re*(Re+$e)/ye),tt=Math.min(.25,.5*re*Oe/De);return ie+Math.max(Ye*W,tt*$)}(g,d,E):C;return{base:C+(o===0?-1:o),top:z?Math.max(w+u,C+o+2):C+u}}Ln(lv,"FillExtrusionBucket",{omit:["layers","features"]}),Ln(Mf,"PartData"),Ln(Db,"FootprintSegment"),Ln(ox,"BorderCentroidData"),Ln(Lb,"GroundEffect");const Fb=sr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),iM=sr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Nb}=Fb,Tg=sr([{name:"a_packed",components:3,type:"Float32"}]),{members:rM}=Tg,aM=sr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:oM}=aM;class Ag{constructor(n,o){this.width=n,this.height=o,this.nextRow=0,this.image=new Hu({width:n,height:o}),this.positions={},this.uploaded=!1}getDash(n,o){const u=this.getKey(n,o);return this.positions[u]}trim(){const n=this.width,o=this.height=Un(this.nextRow);this.image.resize({width:n,height:o})}getKey(n,o){return n.join(",")+o}getDashRanges(n,o,u){const g=[];let d=n.length%2==1?-n[n.length-1]*u:0,v=n[0]*u,E=!0;g.push({left:d,right:v,isDash:E,zeroLength:n[0]===0});let C=n[0];for(let z=1;z<n.length;z++){E=!E;const w=n[z];d=C*u,C+=w,v=C*u,g.push({left:d,right:v,isDash:E,zeroLength:w===0})}return g}addRoundDash(n,o,u){const g=o/2;for(let d=-u;d<=u;d++){const v=this.width*(this.nextRow+u+d);let E=0,C=n[E];for(let z=0;z<this.width;z++){z/C.right>1&&(C=n[++E]);const w=Math.abs(z-C.left),R=Math.abs(z-C.right),L=Math.min(w,R);let A;const D=d/u*(g+1);if(C.isDash){const F=g-Math.abs(D);A=Math.sqrt(L*L+F*F)}else A=g-Math.sqrt(L*L+D*D);this.image.data[v+z]=Math.max(0,Math.min(255,A+128))}}}addRegularDash(n,o){for(let C=n.length-1;C>=0;--C){const z=n[C],w=n[C+1];z.zeroLength?n.splice(C,1):w&&w.isDash===z.isDash&&(w.left=z.left,n.splice(C,1))}const u=n[0],g=n[n.length-1];u.isDash===g.isDash&&(u.left=g.left-this.width,g.right=u.right+this.width);const d=this.width*this.nextRow;let v=0,E=n[v];for(let C=0;C<this.width;C++){C/E.right>1&&(E=n[++v]);const z=Math.abs(C-E.left),w=Math.abs(C-E.right),R=Math.min(z,w);this.image.data[d+C]=Math.max(0,Math.min(255,(E.isDash?R:-R)+o+128))}}addDash(n,o){const u=this.getKey(n,o);if(this.positions[u])return this.positions[u];const g=o==="round",d=g?7:0,v=2*d+1;if(this.nextRow+v>this.height)return Wn("LineAtlas out of space"),null;n.length===0&&n.push(1);let E=0;for(let w=0;w<n.length;w++)n[w]<0&&(Wn("Negative value is found in line dasharray, replacing values with 0"),n[w]=0),E+=n[w];if(E!==0){const w=this.width/E,R=this.getDashRanges(n,this.width,w);g?this.addRoundDash(R,w,d):this.addRegularDash(R,o==="square"?.5*w:0)}const C=this.nextRow+d;this.nextRow+=v;const z={tl:[C,d],br:[E,0]};return this.positions[u]=z,z}}Ln(Ag,"LineAtlas");const uv=Sf.VectorTileFeature.types,ux=Math.cos(Math.PI/180*37.5),sM=Math.cos(Math.PI/180*5);class Cf{constructor(n){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=n.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=n.overscaling,this.pixelRatio=n.pixelRatio,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new Vh,this.layoutVertexArray2=new yl,this.patternVertexArray=new yl,this.indexArray=new Ha,this.programConfigurations=new ts(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new Jr,this.maxLineLength=0,this.zOffsetVertexArray=new yl,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.tessellationStep=n.tessellationStep?n.tessellationStep:yn/64}updateFootprints(n,o){}populate(n,o,u,g){this.hasPattern=Y_("line",this.layers,this.pixelRatio,o);const d=this.layers[0].layout.get("line-sort-key");this.tileToMeter=i(u);const v=this.layers[0].layout.get("line-z-offset"),E=v.isConstant()&&!v.constantOr(0),C=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=C==="sea"||C==="ground"||!E&&C==="none",this.hasZOffset&&C==="none"&&Wn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const z=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&z!==void 0;const w=[];for(const{feature:D,id:F,index:W,sourceLayerIndex:$}of n){const ie=this.layers[0]._featureFilter.needGeometry,re=Z(D,ie);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),re,u))continue;const ee=d?d.evaluate(re,{},u):void 0,ae={id:F,properties:D.properties,type:D.type,sourceLayerIndex:$,index:W,geometry:ie?re.geometry:q(D,u,g),patterns:{},sortKey:ee};w.push(ae)}d&&w.sort((D,F)=>D.sortKey-F.sortKey);const{lineAtlas:R,featureIndex:L}=o,A=this.addConstantDashes(R);for(const D of w){const{geometry:F,index:W,sourceLayerIndex:$}=D;if(A&&this.addFeatureDashes(D,R),this.hasPattern){const ie=K_("line",this.layers,D,this.zoom,this.pixelRatio,o);this.patternFeatures.push(ie)}else this.addFeature(D,F,W,u,R.positions,o.availableImages,o.brightness);L.insert(n[W].feature,F,W,$,this.index)}}addConstantDashes(n){let o=!1;for(const u of this.layers){const g=u.paint.get("line-dasharray").value,d=u.layout.get("line-cap").value;if(g.kind!=="constant"||d.kind!=="constant")o=!0;else{const v=d.value,E=g.value;if(!E)continue;n.addDash(E,v)}}return o}addFeatureDashes(n,o){const u=this.zoom;for(const g of this.layers){const d=g.paint.get("line-dasharray").value,v=g.layout.get("line-cap").value;if(d.kind==="constant"&&v.kind==="constant")continue;let E,C;if(d.kind==="constant"){if(E=d.value,!E)continue}else E=d.evaluate({zoom:u},n);C=v.kind==="constant"?v.value:v.evaluate({zoom:u},n),o.addDash(E,C),n.patterns[g.id]=o.getKey(E,C)}}update(n,o,u,g,d,v,E){this.programConfigurations.updatePaintArrays(n,o,d,u,g,v,E)}addFeatures(n,o,u,g,d,v){for(const E of this.patternFeatures)this.addFeature(E,E.geometry,E.index,o,u,g,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,rM)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=n.createVertexBuffer(this.patternVertexArray,oM)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,iM.members,!0)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Nb),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,o,u,g,d,v,E){const C=this.layers[0].layout,z=C.get("line-join").evaluate(n,{}),w=C.get("line-cap").evaluate(n,{}),R=C.get("line-miter-limit"),L=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(n),this.lineFeature=n,this.zOffsetValue=C.get("line-z-offset").value;const A=this.layers[0].paint.get("line-width").value;A.kind!=="constant"&&A.isLineProgressConstant===!1&&(this.variableWidthValue=A);for(const D of o)this.addLine(D,n,g,z,w,R,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,d,v,g,E)}addLine(n,o,u,g,d,v,E){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const C=g==="none";if(this.patternJoinNone=this.hasPattern&&C,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<n.length-1;re++)this.totalDistance+=n[re].dist(n[re+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const z=uv[o.type]==="Polygon";let w=n.length;for(;w>=2&&n[w-1].equals(n[w-2]);)w--;let R=0;for(;R<w-1&&n[R].equals(n[R+1]);)R++;if(w<(z?3:2))return;g==="bevel"&&(v=1.05);const L=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let A,D,F,W,$,ie;this.e1=this.e2=-1,z&&(A=n[w-2],$=n[R].sub(A)._unit()._perp());for(let re=R;re<w;re++){if(F=re===w-1?z?n[R+1]:void 0:n[re+1],F&&n[re].equals(F))continue;$&&(W=$),A&&(D=A),A=n[re],ie=this.evaluateLineProgressFeatures(D?D.dist(A):0),$=F?F.sub(A)._unit()._perp():W,W=W||$;const ee=D&&F;let ae=ee?g:z||C?"butt":d;const de=W.x*$.x+W.y*$.y;if(C){const tt=function(Je){if(Je.patternJoinNone){const rt=Je.segmentPoints.length/2,ct=Je.lineSoFar-Je.segmentStart;for(let yt=0;yt<rt;++yt){const st=Je.segmentPoints[2*yt+1],Bt=Math.round(Je.segmentPoints[2*yt])+.5+.25*st;Je.patternVertexArray.emplaceBack(Bt,ct,Je.segmentStart),Je.patternVertexArray.emplaceBack(Bt,ct,Je.segmentStart)}Je.segmentPoints.length=0}Je.e1=Je.e2=-1};if(ee&&de<sM){this.updateDistance(D,A),this.addCurrentVertex(A,W,1,1,L,ie),tt(this),this.addCurrentVertex(A,$,-1,-1,L,ie);continue}if(D){if(!F){this.updateDistance(D,A),this.addCurrentVertex(A,W,1,1,L,ie),tt(this);continue}ae="miter"}}let ye=W.add($);ye.x===0&&ye.y===0||ye._unit();const De=ye.x*$.x+ye.y*$.y,Ie=De!==0?1/De:1/0,Re=2*Math.sqrt(2-2*De),$e=De<ux&&D&&F,Oe=W.x*$.y-W.y*$.x>0,Ye=this.overscaling<=16?15*yn/(512*this.overscaling):0;if(ee&&ae==="round"){if(Ie<E)ae="miter";else if(Ie<=2){const tt=hx(A,-10,yn+10);ae=this.hasZOffset&&(tt||this.hasCrossSlope)?"miter":"fakeround"}}if(ae==="miter"&&Ie>v&&(ae="bevel"),ae==="bevel"&&(Ie>2&&(ae="flipbevel"),Ie<v&&(ae="miter")),D&&!(ae==="miter"&&$e)&&this.updateDistance(D,A),ae==="miter")if($e){const tt=A.dist(D);if(tt>2*Ye){const rt=A.sub(A.sub(D)._mult(Ye/tt)._round());this.updateDistance(D,rt),this.addCurrentVertex(rt,W,0,0,L,ie),D=rt}this.updateDistance(D,A),ye._mult(Ie),this.addCurrentVertex(A,ye,0,0,L,ie);const Je=A.dist(F);if(Je>2*Ye){const rt=A.add(F.sub(A)._mult(Ye/Je)._round());this.updateDistance(A,rt),this.addCurrentVertex(rt,$,0,0,L,ie),A=rt}}else ye._mult(Ie),this.addCurrentVertex(A,ye,0,0,L,ie);else if(ae==="flipbevel"){if(Ie>100)ye=$.mult(-1);else{const tt=Ie*W.add($).mag()/W.sub($).mag();ye._perp()._mult(tt*(Oe?-1:1))}this.addCurrentVertex(A,ye,0,0,L,ie),this.addCurrentVertex(A,ye.mult(-1),0,0,L,ie)}else if(ae==="bevel"||ae==="fakeround"){ie!=null&&D&&this.addCurrentVertex(A,W,-1,-1,L,ie);const tt=A.dist(D)<=2*Ye&&ae!=="bevel",Je=ye.mult(Oe?1:-1);Je._mult(Ie);const rt=$.mult(Oe?-1:1),ct=W.mult(Oe?-1:1),yt=this.evaluateLineProgressFeatures(this.distance);if(ie==null&&(this.addHalfVertex(A,Je.x,Je.y,!1,!Oe,0,L,yt),tt||this.addHalfVertex(A,Je.x+2*ct.x,Je.y+2*ct.y,!1,Oe,0,L,yt)),ae==="fakeround"){const st=Math.round(180*Re/Math.PI/20);this.addHalfVertex(A,ct.x,ct.y,!1,Oe,0,L,yt);for(let Bt=0;Bt<st;Bt++){let Qt=Bt/st;if(Qt!==.5){const An=Qt-.5;Qt+=Qt*An*(Qt-1)*((1.0904+de*(de*(3.55645-1.43519*de)-3.2452))*An*An+(.848013+de*(.215638*de-1.06021)))}const Nt=rt.sub(ct)._mult(Qt)._add(ct)._unit();this.addHalfVertex(A,Nt.x,Nt.y,!1,Oe,0,L,yt)}this.addHalfVertex(A,rt.x,rt.y,!1,Oe,0,L,yt)}tt||ie!=null||this.addHalfVertex(A,Je.x+2*rt.x,Je.y+2*rt.y,!1,Oe,0,L,yt),ie!=null&&F&&this.addCurrentVertex(A,$,1,1,L,ie)}else ae==="butt"?this.addCurrentVertex(A,ye,0,0,L,ie):ae==="square"?(D||this.addCurrentVertex(A,ye,-1,-1,L,ie),this.addCurrentVertex(A,ye,0,0,L,ie),D&&this.addCurrentVertex(A,ye,1,1,L,ie)):ae==="round"&&(D&&(this.addCurrentVertex(A,W,0,0,L,ie),this.addCurrentVertex(A,W,1,1,L,ie,!0)),F&&(this.addCurrentVertex(A,$,-1,-1,L,ie,!0),this.addCurrentVertex(A,$,0,0,L,ie)))}}addVerticesTo(n,o,u,g,d,v,E,C,z,w){const R=(o.w-n.w)/this.tessellationStep|0;let L=0;const A=this.scaledDistance;if(R>1){this.lineSoFar=n.w;const F=(o.x-n.x)/R,W=(o.y-n.y)/R,$=(o.z-n.z)/R,ie=(o.w-n.w)/R;for(let re=1;re<R;++re){n.x+=F,n.y+=W,n.z+=$,this.lineSoFar+=ie,L+=ie;const ee=this.evaluateLineProgressFeatures(this.prevDistance+L);this.scaledDistance=(this.prevDistance+L)/this.totalDistance,this.addHalfVertex(n,u,g,w,!1,E,z,ee),this.addHalfVertex(n,d,v,w,!0,-C,z,ee)}}this.lineSoFar=o.w,this.scaledDistance=A;const D=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(o,u,g,w,!1,E,z,D),this.addHalfVertex(o,d,v,w,!0,-C,z,D)}evaluateLineProgressFeatures(n){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+n)/this.totalFeatureLength):Wn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let o=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(o=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:o}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:o}:{zOffset:0,variableWidth:o}}addCurrentVertex(n,o,u,g,d,v,E=!1){const C=o.x+o.y*u,z=o.y-o.x*u,w=o.y*g-o.x,R=-o.y-o.x*g;if(v!=null){const L=this.hasZOffset,A=-10,D=yn+10,F=v.zOffset,W=new oa(n.x,n.y,F,this.lineSoFar),$=!!L&&hx(n,A,D),ie=this.lineSoFar,re=this.distance;if(this.currentVertex)if($){const ee=this.currentVertexIsOutside,ae=this.currentVertex,de=new oa(n.x,n.y,F,this.lineSoFar);if(Ab(ae,de,A,D),!hx(de,A,D)){if(ee){this.e1=this.e2=-1,this.distance-=ae.dist(W),this.lineSoFar=ae.w;const ye=this.evaluateLineProgressFeatures(ae.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ae,C,z,E,!1,u,d,ye),this.addHalfVertex(ae,w,R,E,!0,-g,d,ye),this.prevDistance=this.distance}this.distance=this.prevDistance+ae.dist(de),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ae,de,C,z,w,R,u,g,d,E),this.distance=re,this.scaledDistance=this.distance/this.totalDistance}}else{const ee=this.currentVertex;if(this.currentVertexIsOutside){Ab(ee,W,A,D),this.e1=this.e2=-1,this.distance-=ee.dist(W),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=ee.w;const ae=this.evaluateLineProgressFeatures(ee.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ee,C,z,E,!1,u,d,ae),this.addHalfVertex(ee,w,R,E,!0,-g,d,ae),this.prevDistance=this.distance,this.distance=re,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(ee,W,C,z,w,R,u,g,d,E)}else $||(this.addHalfVertex(n,C,z,E,!1,u,d,v),this.addHalfVertex(n,w,R,E,!0,-g,d,v));this.currentVertex=W,this.currentVertexIsOutside=$,this.lineSoFar=ie}else this.addHalfVertex(n,C,z,E,!1,u,d,v),this.addHalfVertex(n,w,R,E,!0,-g,d,v)}addHalfVertex({x:n,y:o},u,g,d,v,E,C,z){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),v||this.segmentPoints.push(this.lineSoFar-this.segmentStart,E)),this.layoutVertexArray.emplaceBack((n<<1)+(d?1:0),(o<<1)+(v?1:0),Math.round(63*u)+128,Math.round(63*g)+128,1+(E===0?0:E<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const R=oi(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,R)}const w=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),C.primitiveLength++),v?this.e2=w:this.e1=w,z!=null&&this.zOffsetVertexArray.emplaceBack(z.zOffset,z.variableWidth,z.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(n,o){this.prevDistance=this.distance,this.distance+=n.dist(o),this.updateScaledDistance()}}function hx(l,n,o){return l.x<n||l.x>o||l.y<n||l.y>o}let dx,fx;function px(l,n,o){return n*(yn/(l.tileSize*Math.pow(2,o-l.tileID.overscaledZ)))}Ln(Cf,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const mx=(l,n,o)=>(1-o)*l+o*n;function hv(l,n){return 1/px(l,1,n.tileZoom)}function gx(l,n,o,u){return l.translatePosMatrix(u||n.tileID.projMatrix,n,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const Cg=l=>{const n=[];Bb(l)&&n.push("RENDER_LINE_DASH"),l.paint.get("line-gradient")&&n.push("RENDER_LINE_GRADIENT");const o=l.paint.get("line-trim-offset");o[0]===0&&o[1]===0||n.push("RENDER_LINE_TRIM_OFFSET"),l.paint.get("line-border-width").constantOr(1)!==0&&n.push("RENDER_LINE_BORDER");const u=l.layout.get("line-join").constantOr("miter")==="none",g=!!l.paint.get("line-pattern").constantOr(1);return u&&g&&n.push("LINE_JOIN_NONE"),n};function Bb(l){const n=l.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}let _x;const dv=()=>_x||(_x={layout:dx||(dx=new $r({"line-cap":new Dn(bt.layout_line["line-cap"]),"line-join":new Dn(bt.layout_line["line-join"]),"line-miter-limit":new hn(bt.layout_line["line-miter-limit"]),"line-round-limit":new hn(bt.layout_line["line-round-limit"]),"line-sort-key":new Dn(bt.layout_line["line-sort-key"]),"line-z-offset":new Dn(bt.layout_line["line-z-offset"]),"line-elevation-reference":new hn(bt.layout_line["line-elevation-reference"]),"line-cross-slope":new hn(bt.layout_line["line-cross-slope"]),visibility:new hn(bt.layout_line.visibility),"line-width-unit":new hn(bt.layout_line["line-width-unit"])})),paint:fx||(fx=new $r({"line-opacity":new Dn(bt.paint_line["line-opacity"]),"line-color":new Dn(bt.paint_line["line-color"]),"line-translate":new hn(bt.paint_line["line-translate"]),"line-translate-anchor":new hn(bt.paint_line["line-translate-anchor"]),"line-width":new Dn(bt.paint_line["line-width"]),"line-gap-width":new Dn(bt.paint_line["line-gap-width"]),"line-offset":new Dn(bt.paint_line["line-offset"]),"line-blur":new Dn(bt.paint_line["line-blur"]),"line-dasharray":new Dn(bt.paint_line["line-dasharray"]),"line-pattern":new Dn(bt.paint_line["line-pattern"]),"line-gradient":new Ou(bt.paint_line["line-gradient"]),"line-trim-offset":new hn(bt.paint_line["line-trim-offset"]),"line-trim-fade-range":new hn(bt.paint_line["line-trim-fade-range"]),"line-trim-color":new hn(bt.paint_line["line-trim-color"]),"line-emissive-strength":new hn(bt.paint_line["line-emissive-strength"]),"line-border-width":new Dn(bt.paint_line["line-border-width"]),"line-border-color":new Dn(bt.paint_line["line-border-color"]),"line-occlusion-opacity":new hn(bt.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},_x);class vx extends Dn{possiblyEvaluate(n,o){return o=new Er(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(n,o)}evaluate(n,o,u,g){return o=On({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(n,o,u,g)}}let nd;function fv(l,n){return n>0?n+2*l:l}const Ub=sr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),yx=sr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),id=sr([{name:"a_projected_pos",components:4,type:"Float32"}],4);sr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const rd=sr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),ad=sr([{name:"a_texb",components:2,type:"Uint16"}]),Rg=sr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Ig=sr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);sr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Wu=sr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),lM=sr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);sr([{name:"triangle",components:3,type:"Uint16"}]),sr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),sr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),sr([{type:"Float32",name:"offsetX"}]),sr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var go=24;const xs=128;function xx(l,n,o,u,g){if(l.kind==="camera")return l.maxSize;if(l.kind==="composite"){const d=n.possiblyEvaluate(new Er(l.maxZoom),o).evaluate(g,{},o),v=n.possiblyEvaluate(new Er(l.minZoom),o).evaluate(g,{},o);return Math.max(d,v)}return n.possiblyEvaluate(new Er(u)).evaluate(g,{},o)}function pv(l,n){const{expression:o}=n;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new Er(l+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:g}=o;let d=0;for(;d<u.length&&u[d]<=l;)d++;d=Math.max(0,d-1);let v=d;for(;v<u.length&&u[v]<l+1;)v++;v=Math.min(u.length-1,v);const E=u[d],C=u[v];return o.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:C,interpolationType:g}:{kind:"camera",minZoom:E,maxZoom:C,minSize:o.evaluate(new Er(E)),maxSize:o.evaluate(new Er(C)),interpolationType:g}}}function Rf(l,{uSize:n,uSizeT:o},{lowerSize:u,upperSize:g}){return l.kind==="source"?u/xs:l.kind==="composite"?oi(u/xs,g/xs,o):n}function If(l,n,o=1){let u=0,g=0;if(l.kind==="constant")g=l.layoutSize*o;else if(l.kind!=="source"){const{interpolationType:d,minZoom:v,maxZoom:E}=l,C=d?gt(Kr.interpolationFactor(d,n,v,E),0,1):0;l.kind==="camera"?g=oi(l.minSize,l.maxSize,C)*o:u=C*o}return{uSizeT:u,uSize:g}}var cM=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:xs,evaluateSizeForFeature:Rf,evaluateSizeForZoom:If,getRasterizedIconSize:xx,getSizeData:pv});function mv(l,n,o){return l.sections.forEach(u=>{u.text=function(g,d,v){const E=d.layout.get("text-transform").evaluate(v,{});return E==="uppercase"?g=g.toLocaleUpperCase():E==="lowercase"&&(g=g.toLocaleLowerCase()),Br.applyArabicShaping&&(g=Br.applyArabicShaping(g)),g}(u.text,n,o)}),l}const od={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function Vb(l){return l==="︶"||l==="﹈"||l==="︸"||l==="﹄"||l==="﹂"||l==="︾"||l==="︼"||l==="︺"||l==="︘"||l==="﹀"||l==="︐"||l==="︓"||l==="︔"||l==="｀"||l==="￣"||l==="︑"||l==="︒"}function Dg(l){return l==="︵"||l==="﹇"||l==="︷"||l==="﹃"||l==="﹁"||l==="︽"||l==="︻"||l==="︹"||l==="︗"||l==="︿"}var gv,Zp,bx,wx={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function _v(){return gv||(gv=1,wx.read=function(l,n,o,u,g){var d,v,E=8*g-u-1,C=(1<<E)-1,z=C>>1,w=-7,R=o?g-1:0,L=o?-1:1,A=l[n+R];for(R+=L,d=A&(1<<-w)-1,A>>=-w,w+=E;w>0;d=256*d+l[n+R],R+=L,w-=8);for(v=d&(1<<-w)-1,d>>=-w,w+=u;w>0;v=256*v+l[n+R],R+=L,w-=8);if(d===0)d=1-z;else{if(d===C)return v?NaN:1/0*(A?-1:1);v+=Math.pow(2,u),d-=z}return(A?-1:1)*v*Math.pow(2,d-u)},wx.write=function(l,n,o,u,g,d){var v,E,C,z=8*d-g-1,w=(1<<z)-1,R=w>>1,L=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,A=u?0:d-1,D=u?1:-1,F=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(E=isNaN(n)?1:0,v=w):(v=Math.floor(Math.log(n)/Math.LN2),n*(C=Math.pow(2,-v))<1&&(v--,C*=2),(n+=v+R>=1?L/C:L*Math.pow(2,1-R))*C>=2&&(v++,C/=2),v+R>=w?(E=0,v=w):v+R>=1?(E=(n*C-1)*Math.pow(2,g),v+=R):(E=n*Math.pow(2,R-1)*Math.pow(2,g),v=0));g>=8;l[o+A]=255&E,A+=D,E/=256,g-=8);for(v=v<<g|E,z+=g;z>0;l[o+A]=255&v,A+=D,v/=256,z-=8);l[o+A-D]|=128*F}),wx}function h(){if(bx)return Zp;bx=1,Zp=n;var l=_v();function n(ee){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ee)?ee:new Uint8Array(ee||0),this.pos=0,this.type=0,this.length=this.buf.length}n.Varint=0,n.Fixed64=1,n.Bytes=2,n.Fixed32=5;var o=4294967296,u=1/o,g=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function d(ee){return ee.type===n.Bytes?ee.readVarint()+ee.pos:ee.pos+1}function v(ee,ae,de){return de?4294967296*ae+(ee>>>0):4294967296*(ae>>>0)+(ee>>>0)}function E(ee,ae,de){var ye=ae<=16383?1:ae<=2097151?2:ae<=268435455?3:Math.floor(Math.log(ae)/(7*Math.LN2));de.realloc(ye);for(var De=de.pos-1;De>=ee;De--)de.buf[De+ye]=de.buf[De]}function C(ee,ae){for(var de=0;de<ee.length;de++)ae.writeVarint(ee[de])}function z(ee,ae){for(var de=0;de<ee.length;de++)ae.writeSVarint(ee[de])}function w(ee,ae){for(var de=0;de<ee.length;de++)ae.writeFloat(ee[de])}function R(ee,ae){for(var de=0;de<ee.length;de++)ae.writeDouble(ee[de])}function L(ee,ae){for(var de=0;de<ee.length;de++)ae.writeBoolean(ee[de])}function A(ee,ae){for(var de=0;de<ee.length;de++)ae.writeFixed32(ee[de])}function D(ee,ae){for(var de=0;de<ee.length;de++)ae.writeSFixed32(ee[de])}function F(ee,ae){for(var de=0;de<ee.length;de++)ae.writeFixed64(ee[de])}function W(ee,ae){for(var de=0;de<ee.length;de++)ae.writeSFixed64(ee[de])}function $(ee,ae){return(ee[ae]|ee[ae+1]<<8|ee[ae+2]<<16)+16777216*ee[ae+3]}function ie(ee,ae,de){ee[de]=ae,ee[de+1]=ae>>>8,ee[de+2]=ae>>>16,ee[de+3]=ae>>>24}function re(ee,ae){return(ee[ae]|ee[ae+1]<<8|ee[ae+2]<<16)+(ee[ae+3]<<24)}return n.prototype={destroy:function(){this.buf=null},readFields:function(ee,ae,de){for(de=de||this.length;this.pos<de;){var ye=this.readVarint(),De=ye>>3,Ie=this.pos;this.type=7&ye,ee(De,ae,this),this.pos===Ie&&this.skip(ye)}return ae},readMessage:function(ee,ae){return this.readFields(ee,ae,this.readVarint()+this.pos)},readFixed32:function(){var ee=$(this.buf,this.pos);return this.pos+=4,ee},readSFixed32:function(){var ee=re(this.buf,this.pos);return this.pos+=4,ee},readFixed64:function(){var ee=$(this.buf,this.pos)+$(this.buf,this.pos+4)*o;return this.pos+=8,ee},readSFixed64:function(){var ee=$(this.buf,this.pos)+re(this.buf,this.pos+4)*o;return this.pos+=8,ee},readFloat:function(){var ee=l.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ee},readDouble:function(){var ee=l.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ee},readVarint:function(ee){var ae,de,ye=this.buf;return ae=127&(de=ye[this.pos++]),de<128?ae:(ae|=(127&(de=ye[this.pos++]))<<7,de<128?ae:(ae|=(127&(de=ye[this.pos++]))<<14,de<128?ae:(ae|=(127&(de=ye[this.pos++]))<<21,de<128?ae:function(De,Ie,Re){var $e,Oe,Ye=Re.buf;if($e=(112&(Oe=Ye[Re.pos++]))>>4,Oe<128||($e|=(127&(Oe=Ye[Re.pos++]))<<3,Oe<128)||($e|=(127&(Oe=Ye[Re.pos++]))<<10,Oe<128)||($e|=(127&(Oe=Ye[Re.pos++]))<<17,Oe<128)||($e|=(127&(Oe=Ye[Re.pos++]))<<24,Oe<128)||($e|=(1&(Oe=Ye[Re.pos++]))<<31,Oe<128))return v(De,$e,Ie);throw new Error("Expected varint not more than 10 bytes")}(ae|=(15&(de=ye[this.pos]))<<28,ee,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ee=this.readVarint();return ee%2==1?(ee+1)/-2:ee/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var ee=this.readVarint()+this.pos,ae=this.pos;return this.pos=ee,ee-ae>=12&&g?function(de,ye,De){return g.decode(de.subarray(ye,De))}(this.buf,ae,ee):function(de,ye,De){for(var Ie="",Re=ye;Re<De;){var $e,Oe,Ye,tt=de[Re],Je=null,rt=tt>239?4:tt>223?3:tt>191?2:1;if(Re+rt>De)break;rt===1?tt<128&&(Je=tt):rt===2?(192&($e=de[Re+1]))==128&&(Je=(31&tt)<<6|63&$e)<=127&&(Je=null):rt===3?(Oe=de[Re+2],(192&($e=de[Re+1]))==128&&(192&Oe)==128&&((Je=(15&tt)<<12|(63&$e)<<6|63&Oe)<=2047||Je>=55296&&Je<=57343)&&(Je=null)):rt===4&&(Oe=de[Re+2],Ye=de[Re+3],(192&($e=de[Re+1]))==128&&(192&Oe)==128&&(192&Ye)==128&&((Je=(15&tt)<<18|(63&$e)<<12|(63&Oe)<<6|63&Ye)<=65535||Je>=1114112)&&(Je=null)),Je===null?(Je=65533,rt=1):Je>65535&&(Je-=65536,Ie+=String.fromCharCode(Je>>>10&1023|55296),Je=56320|1023&Je),Ie+=String.fromCharCode(Je),Re+=rt}return Ie}(this.buf,ae,ee)},readBytes:function(){var ee=this.readVarint()+this.pos,ae=this.buf.subarray(this.pos,ee);return this.pos=ee,ae},readPackedVarint:function(ee,ae){if(this.type!==n.Bytes)return ee.push(this.readVarint(ae));var de=d(this);for(ee=ee||[];this.pos<de;)ee.push(this.readVarint(ae));return ee},readPackedSVarint:function(ee){if(this.type!==n.Bytes)return ee.push(this.readSVarint());var ae=d(this);for(ee=ee||[];this.pos<ae;)ee.push(this.readSVarint());return ee},readPackedBoolean:function(ee){if(this.type!==n.Bytes)return ee.push(this.readBoolean());var ae=d(this);for(ee=ee||[];this.pos<ae;)ee.push(this.readBoolean());return ee},readPackedFloat:function(ee){if(this.type!==n.Bytes)return ee.push(this.readFloat());var ae=d(this);for(ee=ee||[];this.pos<ae;)ee.push(this.readFloat());return ee},readPackedDouble:function(ee){if(this.type!==n.Bytes)return ee.push(this.readDouble());var ae=d(this);for(ee=ee||[];this.pos<ae;)ee.push(this.readDouble());return ee},readPackedFixed32:function(ee){if(this.type!==n.Bytes)return ee.push(this.readFixed32());var ae=d(this);for(ee=ee||[];this.pos<ae;)ee.push(this.readFixed32());return ee},readPackedSFixed32:function(ee){if(this.type!==n.Bytes)return ee.push(this.readSFixed32());var ae=d(this);for(ee=ee||[];this.pos<ae;)ee.push(this.readSFixed32());return ee},readPackedFixed64:function(ee){if(this.type!==n.Bytes)return ee.push(this.readFixed64());var ae=d(this);for(ee=ee||[];this.pos<ae;)ee.push(this.readFixed64());return ee},readPackedSFixed64:function(ee){if(this.type!==n.Bytes)return ee.push(this.readSFixed64());var ae=d(this);for(ee=ee||[];this.pos<ae;)ee.push(this.readSFixed64());return ee},skip:function(ee){var ae=7&ee;if(ae===n.Varint)for(;this.buf[this.pos++]>127;);else if(ae===n.Bytes)this.pos=this.readVarint()+this.pos;else if(ae===n.Fixed32)this.pos+=4;else{if(ae!==n.Fixed64)throw new Error("Unimplemented type: "+ae);this.pos+=8}},writeTag:function(ee,ae){this.writeVarint(ee<<3|ae)},realloc:function(ee){for(var ae=this.length||16;ae<this.pos+ee;)ae*=2;if(ae!==this.length){var de=new Uint8Array(ae);de.set(this.buf),this.buf=de,this.length=ae}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ee){this.realloc(4),ie(this.buf,ee,this.pos),this.pos+=4},writeSFixed32:function(ee){this.realloc(4),ie(this.buf,ee,this.pos),this.pos+=4},writeFixed64:function(ee){this.realloc(8),ie(this.buf,-1&ee,this.pos),ie(this.buf,Math.floor(ee*u),this.pos+4),this.pos+=8},writeSFixed64:function(ee){this.realloc(8),ie(this.buf,-1&ee,this.pos),ie(this.buf,Math.floor(ee*u),this.pos+4),this.pos+=8},writeVarint:function(ee){(ee=+ee||0)>268435455||ee<0?function(ae,de){var ye,De;if(ae>=0?(ye=ae%4294967296|0,De=ae/4294967296|0):(De=~(-ae/4294967296),4294967295^(ye=~(-ae%4294967296))?ye=ye+1|0:(ye=0,De=De+1|0)),ae>=18446744073709552e3||ae<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");de.realloc(10),function(Ie,Re,$e){$e.buf[$e.pos++]=127&Ie|128,Ie>>>=7,$e.buf[$e.pos++]=127&Ie|128,Ie>>>=7,$e.buf[$e.pos++]=127&Ie|128,Ie>>>=7,$e.buf[$e.pos++]=127&Ie|128,$e.buf[$e.pos]=127&(Ie>>>=7)}(ye,0,de),function(Ie,Re){var $e=(7&Ie)<<4;Re.buf[Re.pos++]|=$e|((Ie>>>=3)?128:0),Ie&&(Re.buf[Re.pos++]=127&Ie|((Ie>>>=7)?128:0),Ie&&(Re.buf[Re.pos++]=127&Ie|((Ie>>>=7)?128:0),Ie&&(Re.buf[Re.pos++]=127&Ie|((Ie>>>=7)?128:0),Ie&&(Re.buf[Re.pos++]=127&Ie|((Ie>>>=7)?128:0),Ie&&(Re.buf[Re.pos++]=127&Ie)))))}(De,de)}(ee,this):(this.realloc(4),this.buf[this.pos++]=127&ee|(ee>127?128:0),ee<=127||(this.buf[this.pos++]=127&(ee>>>=7)|(ee>127?128:0),ee<=127||(this.buf[this.pos++]=127&(ee>>>=7)|(ee>127?128:0),ee<=127||(this.buf[this.pos++]=ee>>>7&127))))},writeSVarint:function(ee){this.writeVarint(ee<0?2*-ee-1:2*ee)},writeBoolean:function(ee){this.writeVarint(!!ee)},writeString:function(ee){ee=String(ee),this.realloc(4*ee.length),this.pos++;var ae=this.pos;this.pos=function(ye,De,Ie){for(var Re,$e,Oe=0;Oe<De.length;Oe++){if((Re=De.charCodeAt(Oe))>55295&&Re<57344){if(!$e){Re>56319||Oe+1===De.length?(ye[Ie++]=239,ye[Ie++]=191,ye[Ie++]=189):$e=Re;continue}if(Re<56320){ye[Ie++]=239,ye[Ie++]=191,ye[Ie++]=189,$e=Re;continue}Re=$e-55296<<10|Re-56320|65536,$e=null}else $e&&(ye[Ie++]=239,ye[Ie++]=191,ye[Ie++]=189,$e=null);Re<128?ye[Ie++]=Re:(Re<2048?ye[Ie++]=Re>>6|192:(Re<65536?ye[Ie++]=Re>>12|224:(ye[Ie++]=Re>>18|240,ye[Ie++]=Re>>12&63|128),ye[Ie++]=Re>>6&63|128),ye[Ie++]=63&Re|128)}return Ie}(this.buf,ee,this.pos);var de=this.pos-ae;de>=128&&E(ae,de,this),this.pos=ae-1,this.writeVarint(de),this.pos+=de},writeFloat:function(ee){this.realloc(4),l.write(this.buf,ee,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ee){this.realloc(8),l.write(this.buf,ee,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ee){var ae=ee.length;this.writeVarint(ae),this.realloc(ae);for(var de=0;de<ae;de++)this.buf[this.pos++]=ee[de]},writeRawMessage:function(ee,ae){this.pos++;var de=this.pos;ee(ae,this);var ye=this.pos-de;ye>=128&&E(de,ye,this),this.pos=de-1,this.writeVarint(ye),this.pos+=ye},writeMessage:function(ee,ae,de){this.writeTag(ee,n.Bytes),this.writeRawMessage(ae,de)},writePackedVarint:function(ee,ae){ae.length&&this.writeMessage(ee,C,ae)},writePackedSVarint:function(ee,ae){ae.length&&this.writeMessage(ee,z,ae)},writePackedBoolean:function(ee,ae){ae.length&&this.writeMessage(ee,L,ae)},writePackedFloat:function(ee,ae){ae.length&&this.writeMessage(ee,w,ae)},writePackedDouble:function(ee,ae){ae.length&&this.writeMessage(ee,R,ae)},writePackedFixed32:function(ee,ae){ae.length&&this.writeMessage(ee,A,ae)},writePackedSFixed32:function(ee,ae){ae.length&&this.writeMessage(ee,D,ae)},writePackedFixed64:function(ee,ae){ae.length&&this.writeMessage(ee,F,ae)},writePackedSFixed64:function(ee,ae){ae.length&&this.writeMessage(ee,W,ae)},writeBytesField:function(ee,ae){this.writeTag(ee,n.Bytes),this.writeBytes(ae)},writeFixed32Field:function(ee,ae){this.writeTag(ee,n.Fixed32),this.writeFixed32(ae)},writeSFixed32Field:function(ee,ae){this.writeTag(ee,n.Fixed32),this.writeSFixed32(ae)},writeFixed64Field:function(ee,ae){this.writeTag(ee,n.Fixed64),this.writeFixed64(ae)},writeSFixed64Field:function(ee,ae){this.writeTag(ee,n.Fixed64),this.writeSFixed64(ae)},writeVarintField:function(ee,ae){this.writeTag(ee,n.Varint),this.writeVarint(ae)},writeSVarintField:function(ee,ae){this.writeTag(ee,n.Varint),this.writeSVarint(ae)},writeStringField:function(ee,ae){this.writeTag(ee,n.Bytes),this.writeString(ae)},writeFloatField:function(ee,ae){this.writeTag(ee,n.Fixed32),this.writeFloat(ae)},writeDoubleField:function(ee,ae){this.writeTag(ee,n.Fixed64),this.writeDouble(ae)},writeBooleanField:function(ee,ae){this.writeVarintField(ee,!!ae)}},Zp}var _=I(h());const S=3;function O(l,n,o){n.glyphs=[],l===1&&o.readMessage(G,n)}function G(l,n,o){if(l===3){const{id:u,bitmap:g,width:d,height:v,left:E,top:C,advance:z}=o.readMessage(te,{});n.glyphs.push({id:u,bitmap:new Hu({width:d+2*S,height:v+2*S},g),metrics:{width:d,height:v,left:E,top:C,advance:z}})}else l===4?n.ascender=o.readSVarint():l===5&&(n.descender=o.readSVarint())}function te(l,n,o){l===1?n.id=o.readVarint():l===2?n.bitmap=o.readBytes():l===3?n.width=o.readVarint():l===4?n.height=o.readVarint():l===5?n.left=o.readSVarint():l===6?n.top=o.readSVarint():l===7&&(n.advance=o.readVarint())}const Me=S,He={horizontal:1,vertical:2,horizontalOnly:3};class mt{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(n,o){const u=new mt;return u.scale=n||1,u.fontStack=o,u}static forImage(n){const o=new mt;return o.image=n,o}}class Vt{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,o){const u=new Vt;for(let g=0;g<n.sections.length;g++){const d=n.sections[g];d.image?u.addImageSection(d):u.addTextSection(d,o)}return u}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCodePoint(n){return this.text.codePointAt(n)}verticalizePunctuation(n){this.text=function(o,u){let g="";for(let d=0;d<o.length;d++){const v=o.charCodeAt(d+1)||null,E=o.charCodeAt(d-1)||null;g+=!u&&(v&&Yl(v)&&!od[o[d+1]]||E&&Yl(E)&&!od[o[d-1]])||!od[o[d]]?o[d]:od[o[d]]}return g}(this.text,n)}trim(){let n=0;for(let u=0;u<this.text.length&&Fn[this.text.charCodeAt(u)];u++)n++;let o=this.text.length;for(let u=this.text.length-1;u>=0&&u>=n&&Fn[this.text.charCodeAt(u)];u--)o--;this.text=this.text.substring(n,o),this.sectionIndex=this.sectionIndex.slice(n,o)}substring(n,o){const u=new Vt;return u.text=this.text.substring(n,o),u.sectionIndex=this.sectionIndex.slice(n,o),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,o)=>Math.max(n,this.sections[o].scale),0)}addTextSection(n,o){this.text+=n.text,this.sections.push(mt.forText(n.scale,n.fontStack||o));const u=this.sections.length-1;for(let g=0;g<n.text.length;++g)this.sectionIndex.push(u)}addImageSection(n){const o=n.image&&n.image.namePrimary?n.image.getPrimary():null;if(!o)return void Wn("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(mt.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Wn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Sn(l,n,o,u,g,d,v,E,C,z,w,R,L,A,D){const F=Vt.fromFeature(l,g);R===He.vertical&&F.verticalizePunctuation(L);let W=[];const $=function(de,ye,De,Ie,Re,$e){if(!de)return[];const Oe=[],Ye=function(ct,yt,st,Bt,Qt,Nt){let An=0;for(let xn=0;xn<ct.length();xn++){const cn=ct.getSection(xn);An+=bn(ct.getCodePoint(xn),cn,Bt,Qt,yt,Nt)}return An/Math.max(1,Math.ceil(An/st))}(de,ye,De,Ie,Re,$e),tt=de.text.indexOf("​")>=0;let Je=0;for(let ct=0;ct<de.length();ct++){const yt=de.getSection(ct),st=de.getCodePoint(ct);if(Fn[st]||(Je+=bn(st,yt,Ie,Re,ye,$e)),ct<de.length()-1){const Bt=!((rt=st)<11904||!(gn["Bopomofo Extended"](rt)||gn.Bopomofo(rt)||gn["CJK Compatibility Forms"](rt)||gn["CJK Compatibility Ideographs"](rt)||gn["CJK Compatibility"](rt)||gn["CJK Radicals Supplement"](rt)||gn["CJK Strokes"](rt)||gn["CJK Symbols and Punctuation"](rt)||gn["CJK Unified Ideographs Extension A"](rt)||gn["CJK Unified Ideographs"](rt)||gn["Enclosed CJK Letters and Months"](rt)||gn["Halfwidth and Fullwidth Forms"](rt)||gn.Hiragana(rt)||gn["Ideographic Description Characters"](rt)||gn["Kangxi Radicals"](rt)||gn["Katakana Phonetic Extensions"](rt)||gn.Katakana(rt)||gn["Vertical Forms"](rt)||gn["Yi Radicals"](rt)||gn["Yi Syllables"](rt)));(sn[st]||Bt||yt.image)&&Oe.push(ka(ct+1,Je,Ye,Oe,dr(st,de.getCodePoint(ct+1),Bt&&tt),!1))}}var rt;return Ht(ka(de.length(),Je,Ye,Oe,0,!0))}(F,z,d,n,u,A),{processBidirectionalText:ie,processStyledBidirectionalText:re}=Br;if(ie&&F.sections.length===1){const de=ie(F.toString(),$);for(const ye of de){const De=new Vt;De.text=ye,De.sections=F.sections;for(let Ie=0;Ie<ye.length;Ie++)De.sectionIndex.push(0);W.push(De)}}else if(re){const de=re(F.text,F.sectionIndex,$);for(const ye of de){const De=new Vt;De.text=ye[0],De.sectionIndex=ye[1],De.sections=F.sections,W.push(De)}}else W=function(de,ye){const De=[],Ie=de.text;let Re=0;for(const $e of ye)De.push(de.substring(Re,$e)),Re=$e;return Re<Ie.length&&De.push(de.substring(Re,Ie.length)),De}(F,$);const ee=[],ae={positionedLines:ee,text:F.toString(),top:w[1],bottom:w[1],left:w[0],right:w[0],writingMode:R,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(de,ye,De,Ie,Re,$e,Oe,Ye,tt,Je,rt,ct){let yt=0,st=0,Bt=0;const Qt=Ye==="right"?1:Ye==="left"?0:.5;let Nt=!1;for(const In of Re){const kn=In.getSections();for(const yi of kn){if(yi.image)continue;const Ri=ye[yi.fontStack];if(Ri&&(Nt=Ri.ascender!==void 0&&Ri.descender!==void 0,!Nt))break}if(!Nt)break}let An=0;for(const In of Re){In.trim();const kn=In.getMaxScale(),yi=(kn-1)*go,Ri={positionedGlyphs:[],lineOffset:0};de.positionedLines[An]=Ri;const zi=Ri.positionedGlyphs;let ki=0;if(!In.length()){st+=$e,++An;continue}let $i=0,Zi=0;for(let xr=0;xr<In.length();xr++){const Mi=In.getSection(xr),_r=In.getSectionIndex(xr),vr=In.getCodePoint(xr);let Xr=Mi.scale,Ea=null,Na=null,Ma=null,fa=go,Da=0;const qa=!(tt===He.horizontal||!rt&&!Zl(vr)||rt&&(Fn[vr]||(xn=vr,gn.Arabic(xn)||gn["Arabic Supplement"](xn)||gn["Arabic Extended-A"](xn)||gn["Arabic Presentation Forms-A"](xn)||gn["Arabic Presentation Forms-B"](xn))));if(Mi.image){const jo=Ie[Mi.image.serialize()];if(!jo)continue;Ma=Mi.image.id,de.iconsInText=de.iconsInText||!0,Na=jo.paddedRect;const Hr=jo.displaySize;Xr=Xr*go/ct,Ea={width:Hr[0],height:Hr[1],left:0,top:-3,advance:qa?Hr[1]:Hr[0],localGlyph:!1},Da=Nt?-Ea.height*Xr:kn*go-17-Hr[1]*Xr,fa=Ea.advance;const ol=(qa?Hr[0]:Hr[1])*Xr-go*kn;ol>0&&ol>ki&&(ki=ol)}else{const jo=De[Mi.fontStack];if(!jo)continue;jo[vr]&&(Na=jo[vr]);const Hr=ye[Mi.fontStack];if(!Hr)continue;const ol=Hr.glyphs[vr];if(!ol)continue;if(Ea=ol.metrics,fa=vr!==8203?go:0,Nt){const Ku=Hr.ascender!==void 0?Math.abs(Hr.ascender):0,ou=Hr.descender!==void 0?Math.abs(Hr.descender):0,su=(Ku+ou)*Xr;$i<su&&($i=su,Zi=(Ku-ou)/2*Xr),Da=-Ku*Xr}else Da=(kn-Xr)*go-17}qa?(de.verticalizable=!0,zi.push({glyph:vr,imageName:Ma,x:yt,y:st+Da,vertical:qa,scale:Xr,localGlyph:Ea.localGlyph,fontStack:Mi.fontStack,sectionIndex:_r,metrics:Ea,rect:Na}),yt+=fa*Xr+Je):(zi.push({glyph:vr,imageName:Ma,x:yt,y:st+Da,vertical:qa,scale:Xr,localGlyph:Ea.localGlyph,fontStack:Mi.fontStack,sectionIndex:_r,metrics:Ea,rect:Na}),yt+=Ea.advance*Xr+Je)}zi.length!==0&&(Bt=Math.max(yt-Je,Bt),Nt?en(zi,Qt,ki,Zi,$e*kn/2):en(zi,Qt,ki,0,$e/2)),yt=0;const zr=$e*kn+ki;Ri.lineOffset=Math.max(ki,yi),st+=zr,++An}var xn;const cn=st,{horizontalAlign:nn,verticalAlign:Hn}=Ft(Oe);(function(In,kn,yi,Ri,zi,ki){const $i=(kn-yi)*zi,Zi=-ki*Ri;for(const zr of In)for(const xr of zr.positionedGlyphs)xr.x+=$i,xr.y+=Zi})(de.positionedLines,Qt,nn,Hn,Bt,cn),de.top+=-Hn*cn,de.bottom=de.top+cn,de.left+=-nn*Bt,de.right=de.left+Bt,de.hasBaseline=Nt}(ae,n,o,u,W,v,E,C,R,z,L,D),!function(de){for(const ye of de)if(ye.positionedGlyphs.length!==0)return!1;return!0}(ee)&&ae}const Fn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},sn={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function bn(l,n,o,u,g,d){if(n.image){const v=u[n.image.serialize()];return v?v.displaySize[0]*n.scale*go/d+g:0}{const v=o[n.fontStack],E=v&&v.glyphs[l];return E?E.metrics.advance*n.scale+g:0}}function Oi(l,n,o,u){const g=Math.pow(l-n,2);return u?l<n?g/2:2*g:g+Math.abs(o)*o}function dr(l,n,o){let u=0;return l===10&&(u-=1e4),o&&(u+=150),l!==40&&l!==65288||(u+=50),n!==41&&n!==65289||(u+=50),u}function ka(l,n,o,u,g,d){let v=null,E=Oi(n,o,g,d);for(const C of u){const z=Oi(n-C.x,o,g,d)+C.badness;z<=E&&(v=C,E=z)}return{index:l,x:n,priorBreak:v,badness:E}}function Ht(l){return l?Ht(l.priorBreak).concat(l.index):[]}function Ft(l){let n=.5,o=.5;switch(l){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:n,verticalAlign:o}}function en(l,n,o,u,g){if(!(n||o||u||g))return;const d=l.length-1,v=l[d],E=(v.x+v.metrics.advance*v.scale)*n;for(let C=0;C<=d;C++)l[C].x-=E,l[C].y+=o+u+g}function Pn(l,n,o,u){const{horizontalAlign:g,verticalAlign:d}=Ft(u),v=o[0]-l.displaySize[0]*g,E=o[1]-l.displaySize[1]*d;return{imagePrimary:l,imageSecondary:n,top:E,bottom:E+l.displaySize[1],left:v,right:v+l.displaySize[0]}}function Ti(l,n,o,u,g,d){const v=l.imagePrimary;let E;if(v.content){const W=v.content,$=v.pixelRatio||1;E=[W[0]/$,W[1]/$,v.displaySize[0]-W[2]/$,v.displaySize[1]-W[3]/$]}const C=n.left*d,z=n.right*d;let w,R,L,A;o==="width"||o==="both"?(A=g[0]+C-u[3],R=g[0]+z+u[1]):(A=g[0]+(C+z-v.displaySize[0])/2,R=A+v.displaySize[0]);const D=n.top*d,F=n.bottom*d;return o==="height"||o==="both"?(w=g[1]+D-u[0],L=g[1]+F+u[2]):(w=g[1]+(D+F-v.displaySize[1])/2,L=w+v.displaySize[1]),{imagePrimary:v,imageSecondary:void 0,top:w,right:R,bottom:L,left:A,collisionPadding:E}}class lr extends ke{constructor(n,o,u,g,d){super(n,o),this.angle=g,this.z=u,d!==void 0&&(this.segment=d)}clone(){return new lr(this.x,this.y,this.z,this.angle,this.segment)}}function ji(l,n,o,u,g){if(n.segment===void 0)return!0;let d=n,v=n.segment+1,E=0;for(;E>-o/2;){if(v--,v<0)return!1;E-=l[v].dist(d),d=l[v]}E+=l[v].dist(l[v+1]),v++;const C=[];let z=0;for(;E<o/2;){const w=l[v],R=l[v+1];if(!R)return!1;let L=l[v-1].angleTo(w)-w.angleTo(R);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:E,angleDelta:L}),z+=L;E-C[0].distance>u;)z-=C.shift().angleDelta;if(z>g)return!1;v++,E+=w.dist(R)}return!0}function Ki(l){let n=0;for(let o=0;o<l.length-1;o++)n+=l[o].dist(l[o+1]);return n}function Eo(l,n,o){return l?.6*n*o:0}function Gr(l,n){return Math.max(l?l.right-l.left:0,n?n.right-n.left:0)}function sd(l,n,o,u,g,d){const v=Eo(o,g,d),E=Gr(o,u)*d;let C=0;const z=Ki(l)/2;for(let w=0;w<l.length-1;w++){const R=l[w],L=l[w+1],A=R.dist(L);if(C+A>z){const D=(z-C)/A,F=oi(R.x,L.x,D),W=oi(R.y,L.y,D),$=new lr(F,W,0,L.angleTo(R),w);return!v||ji(l,$,E,v,n)?$:void 0}C+=A}}function uM(l,n,o,u,g,d,v,E,C){const z=Eo(u,d,v),w=Gr(u,g),R=w*v,L=l[0].x===0||l[0].x===C||l[0].y===0||l[0].y===C;return n-R<n/4&&(n=R+n/4),aI(l,L?n/2*E%n:(w/2+2*d)*v*E%n,n,z,o,R,L,!1,C)}function aI(l,n,o,u,g,d,v,E,C){const z=d/2,w=Ki(l);let R=0,L=n-o,A=[];for(let D=0;D<l.length-1;D++){const F=l[D],W=l[D+1],$=F.dist(W),ie=W.angleTo(F);for(;L+o<R+$;){L+=o;const re=(L-R)/$,ee=oi(F.x,W.x,re),ae=oi(F.y,W.y,re);if(ee>=0&&ee<C&&ae>=0&&ae<C&&L-z>=0&&L+z<=w){const de=new lr(ee,ae,0,ie,D);u&&!ji(l,de,d,u,g)||A.push(de)}}R+=$}return E||A.length||v||(A=aI(l,R/2,o,u,g,d,v,!0,C)),A}function oI(l,n,o,u,g){const d=[];for(let v=0;v<l.length;v++){const E=l[v];let C;for(let z=0;z<E.length-1;z++){let w=E[z],R=E[z+1];w.x<n&&R.x<n||(w.x<n?w=new ke(n,w.y+(n-w.x)/(R.x-w.x)*(R.y-w.y))._round():R.x<n&&(R=new ke(n,w.y+(n-w.x)/(R.x-w.x)*(R.y-w.y))._round()),w.y<o&&R.y<o||(w.y<o?w=new ke(w.x+(o-w.y)/(R.y-w.y)*(R.x-w.x),o)._round():R.y<o&&(R=new ke(w.x+(o-w.y)/(R.y-w.y)*(R.x-w.x),o)._round()),w.x>=u&&R.x>=u||(w.x>=u?w=new ke(u,w.y+(u-w.x)/(R.x-w.x)*(R.y-w.y))._round():R.x>=u&&(R=new ke(u,w.y+(u-w.x)/(R.x-w.x)*(R.y-w.y))._round()),w.y>=g&&R.y>=g||(w.y>=g?w=new ke(w.x+(g-w.y)/(R.y-w.y)*(R.x-w.x),g)._round():R.y>=g&&(R=new ke(w.x+(g-w.y)/(R.y-w.y)*(R.x-w.x),g)._round()),C&&w.equals(C[C.length-1])||(C=[w],d.push(C)),C.push(R)))))}}return d}function sI(l){let n=0,o=0;for(const v of l)n+=v.w*v.h,o=Math.max(o,v.w);l.sort((v,E)=>E.h-v.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),o),h:1/0}];let g=0,d=0;for(const v of l)for(let E=u.length-1;E>=0;E--){const C=u[E];if(!(v.w>C.w||v.h>C.h)){if(v.x=C.x,v.y=C.y,d=Math.max(d,v.y+v.h),g=Math.max(g,v.x+v.w),v.w===C.w&&v.h===C.h){const z=u.pop();E<u.length&&(u[E]=z)}else v.h===C.h?(C.x+=v.w,C.w-=v.w):v.w===C.w?(C.y+=v.h,C.h-=v.h):(u.push({x:C.x+v.w,y:C.y,w:C.w-v.w,h:v.h}),C.y+=v.h,C.h-=v.h);break}}return{w:g,h:d,fill:n/(g*d)||0}}Ln(lr,"Anchor");const Sx=1;class Ex{static getImagePositionScale(n,o,u){return o&&n&&n.options&&n.options.transform?{x:n.options.transform.a,y:n.options.transform.d}:{x:u,y:u}}constructor(n,{pixelRatio:o,version:u,stretchX:g,stretchY:d,content:v,sdf:E,usvg:C},z,w){this.paddedRect=n,this.pixelRatio=o,this.stretchX=g,this.stretchY=d,this.content=v,this.version=u,this.padding=z,this.sdf=E,this.scale=Ex.getImagePositionScale(w,C,o)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}class lI{constructor(n,o,u){const g={},d={};this.haveRenderCallbacks=[];const v=[];this.addImages(n,g,Sx,v),this.addImages(o,d,2,v);const{w:E,h:C}=sI(v),z=new no({width:E||1,height:C||1});for(const w in n){const R=n[w],L=g[w].paddedRect;no.copy(R.data,z,{x:0,y:0},{x:L.x+Sx,y:L.y+Sx},R.data,u,R.sdf)}for(const w in o){const R=o[w],L=d[w].paddedRect;let A=d[w].padding;const D=L.x+A,F=L.y+A,W=R.data.width,$=R.data.height;A=A>1?A-1:A,no.copy(R.data,z,{x:0,y:0},{x:D,y:F},R.data,u),no.copy(R.data,z,{x:0,y:$-A},{x:D,y:F-A},{width:W,height:A},u),no.copy(R.data,z,{x:0,y:0},{x:D,y:F+$},{width:W,height:A},u),no.copy(R.data,z,{x:W-A,y:0},{x:D-A,y:F},{width:A,height:$},u),no.copy(R.data,z,{x:0,y:0},{x:D+W,y:F},{width:A,height:$},u),no.copy(R.data,z,{x:W-A,y:$-A},{x:D-A,y:F-A},{width:A,height:A},u),no.copy(R.data,z,{x:0,y:$-A},{x:D+W,y:F-A},{width:A,height:A},u),no.copy(R.data,z,{x:0,y:0},{x:D+W,y:F+$},{width:A,height:A},u),no.copy(R.data,z,{x:W-A,y:0},{x:D-A,y:F+$},{width:A,height:A},u)}this.lut=u,this.image=z,this.iconPositions=g,this.patternPositions=d}addImages(n,o,u,g){for(const d in n){const v=n[d],E={x:0,y:0,w:v.data.width+2*u,h:v.data.height+2*u};g.push(E);const C=Ws.deserializeFromString(d);o[d]=new Ex(E,v,u,C),v.hasRenderCallback&&this.haveRenderCallbacks.push(C.id)}}patchUpdatedImages(n,o,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(g=>n.hasImage(g,u)),n.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const g in n.getUpdatedImages(u)){for(const d of Object.keys(this.iconPositions))Ws.deserializeId(d)===g&&this.patchUpdatedImage(this.iconPositions[d],n.getImage(g,u),o);for(const d of Object.keys(this.patternPositions))Ws.deserializeId(d)===g&&this.patchUpdatedImage(this.patternPositions[d],n.getImage(g,u),o)}}patchUpdatedImage(n,o,u){if(!n||!o||n.version===o.version)return;n.version=o.version;const[g,d]=n.tl,v=n.sdf;if(this.lut||v){const E={width:o.data.width,height:o.data.height},C=new no(E);no.copy(o.data,C,{x:0,y:0},{x:0,y:0},E,this.lut,v),u.update(C,{position:{x:g,y:d}})}else u.update(o.data,{position:{x:g,y:d}})}}Ln(Ex,"ImagePosition"),Ln(lI,"ImageAtlas");const jb=1e20;function cI(l,n,o,u,g,d,v,E,C){for(let z=n;z<n+u;z++)uI(l,o*d+z,d,g,v,E,C);for(let z=o;z<o+g;z++)uI(l,z*d+n,1,u,v,E,C)}function uI(l,n,o,u,g,d,v){d[0]=0,v[0]=-1e20,v[1]=jb,g[0]=l[n];for(let E=1,C=0,z=0;E<u;E++){g[E]=l[n+E*o];const w=E*E;do{const R=d[C];z=(g[E]-g[R]+w-R*R)/(E-R)/2}while(z<=v[C]&&--C>-1);C++,d[C]=E,v[C]=z,v[C+1]=jb}for(let E=0,C=0;E<u;E++){for(;v[C+1]<E;)C++;const z=d[C],w=E-z;l[n+E*o]=g[z]+w*w}}const $u=2,hM={none:0,ideographs:1,all:2};class vv{constructor(n,o,u){this.requestManager=n,this.localGlyphMode=o,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n,o){this.urls[o]=n}getGlyphs(n,o,u){const g=[],d=this.urls[o]||Sr.GLYPHS_URL;for(const v in n)for(const E of n[v])g.push({stack:v,id:E});Xn(g,({stack:v,id:E},C)=>{let z=this.entries[v];z||(z=this.entries[v]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=z.glyphs[E];if(w!==void 0)return void C(null,{stack:v,id:E,glyph:w});if(w=this._tinySDF(z,v,E),w)return z.glyphs[E]=w,void C(null,{stack:v,id:E,glyph:w});const R=Math.floor(E/256);if(256*R>65535)return Wn("glyphs > 65535 not supported"),void C(null,{stack:v,id:E,glyph:w});if(z.ranges[R])return void C(null,{stack:v,id:E,glyph:w});let L=z.requests[R];L||(L=z.requests[R]=[],vv.loadGlyphRange(v,R,d,this.requestManager,(A,D)=>{if(D){z.ascender=D.ascender,z.descender=D.descender;for(const F in D.glyphs)this._doesCharSupportLocalGlyph(+F)||(z.glyphs[+F]=D.glyphs[+F]);z.ranges[R]=!0}for(const F of L)F(A,D);delete z.requests[R]})),L.push((A,D)=>{A?C(A):D&&C(null,{stack:v,id:E,glyph:D.glyphs[E]||null})})},(v,E)=>{if(v)u(v);else if(E){const C={};for(const{stack:z,id:w,glyph:R}of E)C[z]===void 0&&(C[z]={}),C[z].glyphs===void 0&&(C[z].glyphs={}),C[z].glyphs[w]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics},C[z].ascender=this.entries[z].ascender,C[z].descender=this.entries[z].descender;u(null,C)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==hM.none&&(this.localGlyphMode===hM.all?!!this.localFontFamily:!!this.localFontFamily&&(gn["CJK Unified Ideographs"](n)||gn["Hangul Syllables"](n)||gn.Hiragana(n)||gn.Katakana(n)||gn["CJK Symbols and Punctuation"](n)||gn["CJK Unified Ideographs Extension A"](n)||gn["CJK Unified Ideographs Extension B"](n)||gn.Osage(n)))}_tinySDF(n,o,u){const g=this.localFontFamily;if(!g||!this._doesCharSupportLocalGlyph(u))return;let d=n.tinySDF;if(!d){let F="400";/bold/i.test(o)?F="900":/medium/i.test(o)?F="500":/light/i.test(o)&&(F="200"),d=n.tinySDF=new vv.TinySDF({fontFamily:g,fontWeight:F,fontSize:24*$u,buffer:3*$u,radius:8*$u}),d.fontWeight=F}if(this.localGlyphs[d.fontWeight][u])return this.localGlyphs[d.fontWeight][u];const v=String.fromCodePoint(u),{data:E,width:C,height:z,glyphWidth:w,glyphHeight:R,glyphLeft:L,glyphTop:A,glyphAdvance:D}=d.draw(v);return this.localGlyphs[d.fontWeight][u]={id:u,bitmap:new Hu({width:C,height:z},E),metrics:{width:w/$u,height:R/$u,left:L/$u,top:A/$u-27,advance:D/$u,localGlyph:!0}}}}vv.loadGlyphRange=function(l,n,o,u,g){const d=256*n,v=d+255,E=u.transformRequest(u.normalizeGlyphsURL(o).replace("{fontstack}",l).replace("{range}",`${d}-${v}`),Vn.Glyphs);qi(E,(C,z)=>{if(C)g(C);else if(z){const w={},R=function(L){return new _(L).readFields(O,{})}(z);for(const L of R.glyphs)w[L.id]=L;g(null,{glyphs:w,ascender:R.ascender,descender:R.descender})}})},vv.TinySDF=class{constructor({fontSize:l=24,buffer:n=3,radius:o=8,cutoff:u=.25,fontFamily:g="sans-serif",fontWeight:d="normal",fontStyle:v="normal"}={}){this.buffer=n,this.cutoff=u,this.radius=o;const E=this.size=l+4*n,C=this._createCanvas(E),z=this.ctx=C.getContext("2d",{willReadFrequently:!0});z.font=`${v} ${d} ${l}px ${g}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(l){const n=document.createElement("canvas");return n.width=n.height=l,n}draw(l){const{width:n,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:g,actualBoundingBoxRight:d}=this.ctx.measureText(l),v=Math.ceil(o),E=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-g))),C=Math.min(this.size-this.buffer,v+Math.ceil(u)),z=E+2*this.buffer,w=C+2*this.buffer,R=Math.max(z*w,0),L=new Uint8ClampedArray(R),A={data:L,width:z,height:w,glyphWidth:E,glyphHeight:C,glyphTop:v,glyphLeft:0,glyphAdvance:n};if(E===0||C===0)return A;const{ctx:D,buffer:F,gridInner:W,gridOuter:$}=this;D.clearRect(F,F,E,C),D.fillText(l,F,F+v);const ie=D.getImageData(F,F,E,C);$.fill(jb,0,R),W.fill(0,0,R);for(let re=0;re<C;re++)for(let ee=0;ee<E;ee++){const ae=ie.data[4*(re*E+ee)+3]/255;if(ae===0)continue;const de=(re+F)*z+ee+F;if(ae===1)$[de]=0,W[de]=jb;else{const ye=.5-ae;$[de]=ye>0?ye*ye:0,W[de]=ye<0?ye*ye:0}}cI($,0,0,z,w,z,this.f,this.v,this.z),cI(W,F,F,E,C,z,this.f,this.v,this.z);for(let re=0;re<R;re++){const ee=Math.sqrt($[re])-Math.sqrt(W[re]);L[re]=Math.round(255-255*(ee/this.radius+this.cutoff))}return A}};const Pg=Sx;function hI(l,n){return l+n[1]-n[0]}function dI(l,n,o,u,g=1){const d=[],v=l.imagePrimary,E=v.pixelRatio,C=v.paddedRect.w-2*Pg,z=v.paddedRect.h-2*Pg,w=(l.right-l.left)*g,R=(l.bottom-l.top)*g,L=v.stretchX||[[0,C]],A=v.stretchY||[[0,z]],D=L.reduce(hI,0),F=A.reduce(hI,0),W=C-D,$=z-F;let ie=0,re=D,ee=0,ae=F,de=0,ye=W,De=0,Ie=$;if(v.content&&u){const $e=v.content;ie=Gb(L,0,$e[0]),ee=Gb(A,0,$e[1]),re=Gb(L,$e[0],$e[2]),ae=Gb(A,$e[1],$e[3]),de=$e[0]-ie,De=$e[1]-ee,ye=$e[2]-$e[0]-re,Ie=$e[3]-$e[1]-ae}const Re=($e,Oe,Ye,tt)=>{const Je=Hb($e.stretch-ie,re,w,l.left*g),rt=qb($e.fixed-de,ye,$e.stretch,D),ct=Hb(Oe.stretch-ee,ae,R,l.top*g),yt=qb(Oe.fixed-De,Ie,Oe.stretch,F),st=Hb(Ye.stretch-ie,re,w,l.left*g),Bt=qb(Ye.fixed-de,ye,Ye.stretch,D),Qt=Hb(tt.stretch-ee,ae,R,l.top*g),Nt=qb(tt.fixed-De,Ie,tt.stretch,F),An=new ke(Je,ct),xn=new ke(st,ct),cn=new ke(st,Qt),nn=new ke(Je,Qt),Hn=new ke(rt/E,yt/E),In=new ke(Bt/E,Nt/E),kn=n*Math.PI/180;if(kn){const Zi=Math.sin(kn),zr=Math.cos(kn),xr=[zr,-Zi,Zi,zr];An._matMult(xr),xn._matMult(xr),nn._matMult(xr),cn._matMult(xr)}const yi=$e.stretch+$e.fixed,Ri=Ye.stretch+Ye.fixed,zi=Oe.stretch+Oe.fixed,ki=tt.stretch+tt.fixed,$i=l.imageSecondary;return{tl:An,tr:xn,bl:nn,br:cn,texPrimary:{x:v.paddedRect.x+Pg+yi,y:v.paddedRect.y+Pg+zi,w:Ri-yi,h:ki-zi},texSecondary:$i?{x:$i.paddedRect.x+Pg+yi,y:$i.paddedRect.y+Pg+zi,w:Ri-yi,h:ki-zi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Hn,pixelOffsetBR:In,minFontScaleX:ye/E/w,minFontScaleY:Ie/E/R,isSDF:o}};if(u&&(v.stretchX||v.stretchY)){const $e=fI(L,W,D),Oe=fI(A,$,F);for(let Ye=0;Ye<$e.length-1;Ye++){const tt=$e[Ye],Je=$e[Ye+1];for(let rt=0;rt<Oe.length-1;rt++)d.push(Re(tt,Oe[rt],Je,Oe[rt+1]))}}else d.push(Re({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:z+1}));return d}function Gb(l,n,o){let u=0;for(const g of l)u+=Math.max(n,Math.min(o,g[1]))-Math.max(n,Math.min(o,g[0]));return u}function fI(l,n,o){const u=[{fixed:-1,stretch:0}];for(const[g,d]of l){const v=u[u.length-1];u.push({fixed:g-v.stretch,stretch:v.stretch}),u.push({fixed:g-v.stretch,stretch:v.stretch+(d-g)})}return u.push({fixed:n+Pg,stretch:o}),u}function Hb(l,n,o,u){return l/n*o+u}function qb(l,n,o,u){return l-n*o/u}function cB(l,n,o,u){const g=n+l.positionedLines[u].lineOffset;return u===0?o+g/2:o+(g+(n+l.positionedLines[u-1].lineOffset))/2}function uB(l,n=1,o=!1){let u=1/0,g=1/0,d=-1/0,v=-1/0;const E=l[0];for(let A=0;A<E.length;A++){const D=E[A];(!A||D.x<u)&&(u=D.x),(!A||D.y<g)&&(g=D.y),(!A||D.x>d)&&(d=D.x),(!A||D.y>v)&&(v=D.y)}const C=Math.min(d-u,v-g);let z=C/2;const w=new ja([],hB);if(C===0)return new ke(u,g);for(let A=u;A<d;A+=C)for(let D=g;D<v;D+=C)w.push(new yv(A+z,D+z,z,l));let R=function(A){let D=0,F=0,W=0;const $=A[0];for(let ie=0,re=$.length,ee=re-1;ie<re;ee=ie++){const ae=$[ie],de=$[ee],ye=ae.x*de.y-de.x*ae.y;F+=(ae.x+de.x)*ye,W+=(ae.y+de.y)*ye,D+=3*ye}return new yv(F/D,W/D,0,A)}(l),L=w.length;for(;w.length;){const A=w.pop();(A.d>R.d||!R.d)&&(R=A,o&&console.log("found best %d after %d probes",Math.round(1e4*A.d)/1e4,L)),A.max-R.d<=n||(z=A.h/2,w.push(new yv(A.p.x-z,A.p.y-z,z,l)),w.push(new yv(A.p.x+z,A.p.y-z,z,l)),w.push(new yv(A.p.x-z,A.p.y+z,z,l)),w.push(new yv(A.p.x+z,A.p.y+z,z,l)),L+=4)}return o&&(console.log(`num probes: ${L}`),console.log(`best distance: ${R.d}`)),R.p}function hB(l,n){return n.max-l.max}class yv{constructor(n,o,u,g){this.p=new ke(n,o),this.h=u,this.d=function(d,v){let E=!1,C=1/0;for(let z=0;z<v.length;z++){const w=v[z];for(let R=0,L=w.length,A=L-1;R<L;A=R++){const D=w[R],F=w[A];D.y>d.y!=F.y>d.y&&d.x<(F.x-D.x)*(d.y-D.y)/(F.y-D.y)+D.x&&(E=!E),C=Math.min(C,Ne(d,D,F))}}return(E?1:-1)*Math.sqrt(C)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}}const dM=Number.POSITIVE_INFINITY,dB=Math.sqrt(2);function pI(l,[n,o]){let u=0,g=0;if(o===dM){n<0&&(n=0);const d=n/dB;switch(l){case"top-right":case"top-left":g=d-7;break;case"bottom-right":case"bottom-left":g=7-d;break;case"bottom":g=7-n;break;case"top":g=n-7}switch(l){case"top-right":case"bottom-right":u=-d;break;case"top-left":case"bottom-left":u=d;break;case"left":u=n;break;case"right":u=-n}}else{switch(n=Math.abs(n),o=Math.abs(o),l){case"top-right":case"top-left":case"top":g=o-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-o}switch(l){case"top-right":case"bottom-right":case"right":u=-n;break;case"top-left":case"bottom-left":case"left":u=n}}return[u,g]}function fM(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function fB(l,n,o,u,g,d,v,E,C,z,w,R,L,A,D){let F=d.textMaxSize.evaluate(n,{},R);F===void 0?F=v*d.textScaleFactor:F*=d.textScaleFactor;const W=l.layers[0].layout,$=W.get("icon-offset").evaluate(n,{},R),ie=gI(o.horizontal)||o.vertical,re=L.name==="globe",ee=go,ae=v*d.textScaleFactor/ee,de=l.tilePixelRatio*F/ee,ye=(Je=l.overscaling,l.zoom>18&&Je>2&&(Je>>=1),Math.max(yn/(512*Je),1)*W.get("symbol-spacing")),De=W.get("text-padding")*l.tilePixelRatio,Ie=W.get("icon-padding")*l.tilePixelRatio,Re=Mn(W.get("text-max-angle")),$e=W.get("text-rotation-alignment")==="map"&&W.get("symbol-placement")!=="point",Oe=W.get("icon-rotation-alignment")==="map"&&W.get("symbol-placement")!=="point",Ye=W.get("symbol-placement"),tt=ye/2;var Je;const rt=W.get("icon-text-fit").evaluate(n,{},R),ct=W.get("icon-text-fit-padding").evaluate(n,{},R),yt=rt!=="none";let st;l.hasAnyIconTextFit===!1&&yt&&(l.hasAnyIconTextFit=!0),u&&yt&&(l.allowVerticalPlacement&&o.vertical&&(st=Ti(u,o.vertical,rt,ct,$,ae)),ie&&(u=Ti(u,ie,rt,ct,$,ae)));const Bt=(Qt,Nt,An)=>{if(Nt.x<0||Nt.x>=yn||Nt.y<0||Nt.y>=yn)return;let xn=null;if(re){const{x:cn,y:nn,z:Hn}=L.projectTilePoint(Nt.x,Nt.y,An);xn={anchor:new lr(cn,nn,Hn,0,void 0),up:L.upVector(An,Nt.x,Nt.y)}}(function(cn,nn,Hn,In,kn,yi,Ri,zi,ki,$i,Zi,zr,xr,Mi,_r,vr,Xr,Ea,Na,Ma,fa,Da,qa,jo,Hr,ol,Ku){const ou=cn.addToLineVertexArray(nn,In);let su,Fg,em,Ng,Gx,YD,KD,JD=0,QD=0,eP=0,tP=0,XM=-1,ZM=-1;const ld={};let nP=ra("");const Bg=Hn?Hn.anchor:nn,YM=ki.layout.get("icon-text-fit").evaluate(fa,{},Hr)!=="none";let KM=0,JM=0;if(ki._unevaluatedLayout.getValue("text-radial-offset")===void 0?[KM,JM]=ki.layout.get("text-offset").evaluate(fa,{},Hr).map(oc=>oc*go):(KM=ki.layout.get("text-radial-offset").evaluate(fa,{},Hr)*go,JM=dM),cn.allowVerticalPlacement&&kn.vertical){const oc=kn.vertical;if(_r)YD=pM(oc),zi&&(KD=pM(zi));else{const sl=ki.layout.get("text-rotate").evaluate(fa,{},Hr)+90;em=Wb($i,Bg,nn,Zi,zr,xr,oc,Mi,sl,vr),zi&&(Ng=Wb($i,Bg,nn,Zi,zr,xr,zi,Ea,sl))}}if(yi){const oc=cn.iconSizeData,sl=ki.layout.get("icon-rotate").evaluate(fa,{},Hr),Hx=dI(yi,sl,qa,YM,Da.iconScaleFactor),eT=zi?dI(zi,sl,qa,YM,Da.iconScaleFactor):void 0;Fg=Wb($i,Bg,nn,Zi,zr,xr,yi,Ea,sl,null),JD=4*Hx.length;let Ug=null;oc.kind==="source"?(Ug=[xs*ki.layout.get("icon-size").evaluate(fa,{},Hr)*Da.iconScaleFactor],Ug[0]>Yp&&Wn(`${cn.layerIds[0]}: Value for "icon-size" is >= ${Mx}. Reduce your "icon-size".`)):oc.kind==="composite"&&(Ug=[xs*Da.compositeIconSizes[0].evaluate(fa,{},Hr)*Da.iconScaleFactor,xs*Da.compositeIconSizes[1].evaluate(fa,{},Hr)*Da.iconScaleFactor],(Ug[0]>Yp||Ug[1]>Yp)&&Wn(`${cn.layerIds[0]}: Value for "icon-size" is >= ${Mx}. Reduce your "icon-size".`)),cn.addSymbols(cn.icon,Hx,Ug,Ma,Na,fa,!1,Hn,nn,ou.lineStartIndex,ou.lineLength,-1,jo,Hr,ol,Ku),XM=cn.icon.placedSymbolArray.length-1,eT&&(QD=4*eT.length,cn.addSymbols(cn.icon,eT,Ug,Ma,Na,fa,He.vertical,Hn,nn,ou.lineStartIndex,ou.lineLength,-1,jo,Hr,ol,Ku),ZM=cn.icon.placedSymbolArray.length-1)}for(const oc in kn.horizontal){const sl=kn.horizontal[oc];su||(nP=ra(sl.text),_r?Gx=pM(sl):su=Wb($i,Bg,nn,Zi,zr,xr,sl,Mi,ki.layout.get("text-rotate").evaluate(fa,{},Hr),vr));const Hx=sl.positionedLines.length===1;if(eP+=mI(cn,Hn,nn,sl,Ri,ki,_r,fa,vr,ou,kn.vertical?He.horizontal:He.horizontalOnly,Hx?Object.keys(kn.horizontal):[oc],ld,XM,Da,jo,Hr,ol),Hx)break}kn.vertical&&(tP+=mI(cn,Hn,nn,kn.vertical,Ri,ki,_r,fa,vr,ou,He.vertical,["vertical"],ld,ZM,Da,jo,Hr,ol));let tm=-1;const QM=(oc,sl)=>oc?Math.max(oc,sl):sl;tm=QM(Gx,tm),tm=QM(YD,tm),tm=QM(KD,tm);const W4=tm>-1?1:0;cn.glyphOffsetArray.length>=65535&&Wn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),fa.sortKey!==void 0&&cn.addToSortKeyRanges(cn.symbolInstances.length,fa.sortKey),cn.symbolInstances.emplaceBack(nn.x,nn.y,Bg.x,Bg.y,Bg.z,ld.right>=0?ld.right:-1,ld.center>=0?ld.center:-1,ld.left>=0?ld.left:-1,ld.vertical>=0?ld.vertical:-1,XM,ZM,nP,su!==void 0?su:cn.collisionBoxArray.length,su!==void 0?su+1:cn.collisionBoxArray.length,em!==void 0?em:cn.collisionBoxArray.length,em!==void 0?em+1:cn.collisionBoxArray.length,Fg!==void 0?Fg:cn.collisionBoxArray.length,Fg!==void 0?Fg+1:cn.collisionBoxArray.length,Ng||cn.collisionBoxArray.length,Ng?Ng+1:cn.collisionBoxArray.length,Zi,eP,tP,JD,QD,W4,0,KM,JM,tm,0,YM?1:0)})(l,Nt,xn,Qt,o,u,g,st,l.layers[0],l.collisionBoxArray,n.index,n.sourceLayerIndex,l.index,De,$e,C,0,Ie,Oe,$,n,d,z,w,R,A,D)};if(Ye==="line")for(const Qt of oI(n.geometry,0,0,yn,yn)){const Nt=uM(Qt,ye,Re,o.vertical||ie,u,ee,de,l.overscaling,yn);for(const An of Nt)ie&&pB(l,ie.text,tt,An)||Bt(Qt,An,R)}else if(Ye==="line-center"){for(const Qt of n.geometry)if(Qt.length>1){const Nt=sd(Qt,Re,o.vertical||ie,u,ee,de);Nt&&Bt(Qt,Nt,R)}}else if(n.type==="Polygon")for(const Qt of al(n.geometry,0)){const Nt=uB(Qt,16);Bt(Qt[0],new lr(Nt.x,Nt.y,0,0,void 0),R)}else if(n.type==="LineString")for(const Qt of n.geometry)Bt(Qt,new lr(Qt[0].x,Qt[0].y,0,0,void 0),R);else if(n.type==="Point")for(const Qt of n.geometry)for(const Nt of Qt)Bt([Nt],new lr(Nt.x,Nt.y,0,0,void 0),R)}const Mx=255,Yp=Mx*xs;function mI(l,n,o,u,g,d,v,E,C,z,w,R,L,A,D,F,W,$){const ie=function(ae,de,ye,De,Ie,Re,$e,Oe){const Ye=[];if(de.positionedLines.length===0)return Ye;const tt=De.layout.get("text-rotate").evaluate(Re,{})*Math.PI/180,Je=function(Bt){const Qt=Bt[0],Nt=Bt[1],An=Qt*Nt;return An>0?[Qt,-Nt]:An<0?[-Qt,Nt]:Qt===0?[Nt,Qt]:[Nt,-Qt]}(ye);let rt=Math.abs(de.top-de.bottom);for(const Bt of de.positionedLines)rt-=Bt.lineOffset;const ct=de.positionedLines.length,yt=rt/ct;let st=de.top-ye[1];for(let Bt=0;Bt<ct;++Bt){const Qt=de.positionedLines[Bt];st=cB(de,yt,st,Bt);for(const Nt of Qt.positionedGlyphs){if(!Nt.rect)continue;const An=Nt.rect||{};let xn=Me+1,cn=!0,nn=1,Hn=0;if(Nt.imageName){const Ma=$e[so.build(Nt.imageName).getSerializedPrimary()];if(!Ma)continue;if(Ma.sdf){Wn("SDF images are not supported in formatted text and will be ignored.");continue}cn=!1,nn=Ma.pixelRatio,xn=Sx/nn}const In=(Ie||Oe)&&Nt.vertical,kn=Nt.metrics.advance*Nt.scale/2,yi=Nt.metrics,Ri=Nt.rect;if(Ri===null)continue;Oe&&de.verticalizable&&(Hn=Nt.imageName?kn-Nt.metrics.width*Nt.scale/2:0);const zi=Ie?[Nt.x+kn,Nt.y]:[0,0];let ki=[0,0],$i=[0,0],Zi=!1;Ie||(In?($i=[Nt.x+kn+Je[0],Nt.y+Je[1]-Hn],Zi=!0):ki=[Nt.x+kn+ye[0],Nt.y+ye[1]-Hn]);const zr=Ri.w*Nt.scale/(nn*(Nt.localGlyph?$u:1)),xr=Ri.h*Nt.scale/(nn*(Nt.localGlyph?$u:1));let Mi,_r,vr,Xr;if(In){const Ma=Nt.y-st,fa=new ke(-kn,kn-Ma),Da=-Math.PI/2,qa=new ke(...$i);Mi=new ke(-kn+ki[0],ki[1]),Mi._rotateAround(Da,fa)._add(qa),Mi.x+=-Ma+kn,Mi.y-=(yi.left-xn)*Nt.scale;const jo=Nt.imageName?yi.advance*Nt.scale:go*Nt.scale,Hr=String.fromCodePoint(Nt.glyph);Vb(Hr)?Mi.x+=(1-xn)*Nt.scale:Dg(Hr)?Mi.x+=jo-yi.height*Nt.scale+(-xn-1)*Nt.scale:Mi.x+=Nt.imageName||yi.width+2*xn===Ri.w&&yi.height+2*xn===Ri.h?(jo-xr)/2:(jo-(yi.height+2*xn)*Nt.scale)/2,_r=new ke(Mi.x,Mi.y-zr),vr=new ke(Mi.x+xr,Mi.y),Xr=new ke(Mi.x+xr,Mi.y-zr)}else{const Ma=(yi.left-xn)*Nt.scale-kn+ki[0],fa=(-yi.top-xn)*Nt.scale+ki[1],Da=Ma+zr,qa=fa+xr;Mi=new ke(Ma,fa),_r=new ke(Da,fa),vr=new ke(Ma,qa),Xr=new ke(Da,qa)}if(tt){let Ma;Ma=Ie?new ke(0,0):Zi?new ke(Je[0],Je[1]):new ke(ye[0],ye[1]),Mi._rotateAround(tt,Ma),_r._rotateAround(tt,Ma),vr._rotateAround(tt,Ma),Xr._rotateAround(tt,Ma)}const Ea=new ke(0,0),Na=new ke(0,0);Ye.push({tl:Mi,tr:_r,bl:vr,br:Xr,texPrimary:An,texSecondary:void 0,writingMode:de.writingMode,glyphOffset:zi,sectionIndex:Nt.sectionIndex,isSDF:cn,pixelOffsetTL:Ea,pixelOffsetBR:Na,minFontScaleX:0,minFontScaleY:0})}}return Ye}(0,u,C,d,v,E,g,l.allowVerticalPlacement),re=l.textSizeData;let ee=null;re.kind==="source"?(ee=[xs*d.layout.get("text-size").evaluate(E,{},W)*D.textScaleFactor],ee[0]>Yp&&Wn(`${l.layerIds[0]}: Value for "text-size" is >= ${Mx}. Reduce your "text-size".`)):re.kind==="composite"&&(ee=[xs*D.compositeTextSizes[0].evaluate(E,{},W)*D.textScaleFactor,xs*D.compositeTextSizes[1].evaluate(E,{},W)*D.textScaleFactor],(ee[0]>Yp||ee[1]>Yp)&&Wn(`${l.layerIds[0]}: Value for "text-size" is >= ${Mx}. Reduce your "text-size".`)),l.addSymbols(l.text,ie,ee,C,v,E,w,n,o,z.lineStartIndex,z.lineLength,A,F,W,$,!1);for(const ae of R)L[ae]=l.text.placedSymbolArray.length-1;return 4*ie.length}function gI(l){for(const n in l)return l[n];return null}function Wb(l,n,o,u,g,d,v,E,C,z){let w=v.top,R=v.bottom,L=v.left,A=v.right;const D=v.collisionPadding;if(D&&(L-=D[0],w-=D[1],A+=D[2],R+=D[3]),C){const F=new ke(L,w),W=new ke(A,w),$=new ke(L,R),ie=new ke(A,R),re=Mn(C);let ee=new ke(0,0);z&&(ee=new ke(z[0],z[1])),F._rotateAround(re,ee),W._rotateAround(re,ee),$._rotateAround(re,ee),ie._rotateAround(re,ee),L=Math.min(F.x,W.x,$.x,ie.x),A=Math.max(F.x,W.x,$.x,ie.x),w=Math.min(F.y,W.y,$.y,ie.y),R=Math.max(F.y,W.y,$.y,ie.y)}return l.emplaceBack(n.x,n.y,n.z,o.x,o.y,L,w,A,R,E,u,g,d),l.length-1}function pM(l){l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);const n=l.bottom-l.top;return n>0?Math.max(10,n):null}function pB(l,n,o,u){const g=l.compareText;if(n in g){const d=g[n];for(let v=d.length-1;v>=0;v--)if(u.dist(d[v])<o)return!0}else g[n]=[];return g[n].push(u),!1}function _I(l,n){const o=l.fovAboveCenter,u=l.elevation?l.elevation.getMinElevationBelowMSL()*n:0,g=(l._camera.position[2]*l.worldSize-u)/Math.cos(l._pitch),d=Math.sin(o)*g/Math.sin(Math.max(Math.PI/2-l._pitch-o,.01));let v=Math.sin(l._pitch)*d+g;const E=g*(1/l._horizonShift);if(!l.elevation||l.elevation.exaggeration()===0){let C=Math.max(l.zoom-17,0);l.isOrthographic&&(C/=10),v*=1+C}return Math.min(1.01*v,E)}function Tx(l,n){if(!n.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:n};const o=Math.pow(2,-l.z),u=l.x*o,g=(l.x+1)*o,d=l.y*o,v=(l.y+1)*o,E=Ro(u),C=Ro(g),z=Ra(d),w=Ra(v),R=n.project(E,z),L=n.project(C,z),A=n.project(C,w),D=n.project(E,w);let F=Math.min(R.x,L.x,A.x,D.x),W=Math.min(R.y,L.y,A.y,D.y),$=Math.max(R.x,L.x,A.x,D.x),ie=Math.max(R.y,L.y,A.y,D.y);const re=o/16;function ee(de,ye,De,Ie,Re,$e){const Oe=(De+Re)/2,Ye=(Ie+$e)/2,tt=n.project(Ro(Oe),Ra(Ye)),Je=Math.max(0,F-tt.x,W-tt.y,tt.x-$,tt.y-ie);F=Math.min(F,tt.x),$=Math.max($,tt.x),W=Math.min(W,tt.y),ie=Math.max(ie,tt.y),Je>re&&(ee(de,tt,De,Ie,Oe,Ye),ee(tt,ye,Oe,Ye,Re,$e))}ee(R,L,u,d,g,d),ee(L,A,g,d,g,v),ee(A,D,g,v,u,v),ee(D,R,u,v,u,d),F-=re,W-=re,$+=re,ie+=re;const ae=1/Math.max($-F,ie-W);return{scale:ae,x:F*ae,y:W*ae,x2:$*ae,y2:ie*ae,projection:n}}function vI(l,{x:n,y:o},u=0){return new ke(((n-u)*l.scale-l.x)*yn,(o*l.scale-l.y)*yn)}const mB=Pe.mat4.identity(new Float32Array(16));class Kp{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,o){return{x:0,y:0,z:0}}unproject(n,o){return new Ji(0,0)}projectTilePoint(n,o,u){return{x:n,y:o,z:0}}locationPoint(n,o,u=!0){return n._coordinatePoint(n.locationCoordinate(o),u)}pixelsPerMeter(n,o){return po(1,n)*o}pixelSpaceConversion(n,o,u){return 1}farthestPixelDistance(n){return _I(n,n.pixelsPerMeter)}pointCoordinate(n,o,u,g){const d=n.horizonLineFromTop(!1),v=new ke(o,Math.max(d,u));return n.rayIntersectionCoordinate(n.pointRayIntersection(v,g))}pointCoordinate3D(n,o,u){const g=new ke(o,u);if(n.elevation)return n.elevation.pointCoordinate(g);{const d=this.pointCoordinate(n,g.x,g.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(n,o){if(n.elevation&&n.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(n,o.x,o.y);const u=n.horizonLineFromTop();return o.y<u}createInversionMatrix(n,o){return mB}createTileMatrix(n,o,u){let g,d,v;const E=u.canonical,C=Pe.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const z=Tx(E,this);g=1,d=z.x+u.wrap*z.scale,v=z.y,Pe.mat4.scale(C,C,[g/z.scale,g/z.scale,n.pixelsPerMeter/o])}else g=o/n.zoomScale(E.z),d=(E.x+Math.pow(2,E.z)*u.wrap)*g,v=E.y*g;return Pe.mat4.translate(C,C,[d,v,0]),Pe.mat4.scale(C,C,[g/yn,g/yn,1]),C}upVector(n,o,u){return[0,0,1]}upVectorScale(n,o,u){return{metersToTile:1}}}class gB extends Kp{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[o,u]=this.parallels=n.parallels||[29.5,45.5],g=Math.sin(Mn(o));this.n=(g+Math.sin(Mn(u)))/2,this.c=1+g*(2*this.n-g),this.r0=Math.sqrt(this.c)/this.n}project(n,o){const{n:u,c:g,r0:d}=this,v=Mn(n-this.center[0]),E=Mn(o),C=Math.sqrt(g-2*u*Math.sin(E))/u;return{x:C*Math.sin(v*u),y:C*Math.cos(v*u)-d,z:0}}unproject(n,o){const{n:u,c:g,r0:d}=this,v=d+o;let E=Math.atan2(n,Math.abs(v))*Math.sign(v);v*u<0&&(E-=Math.PI*Math.sign(n)*Math.sign(v));const C=Mn(this.center[0])*u;E=an(E,-Math.PI-C,Math.PI-C);const z=gt(wi(E/u)+this.center[0],-180,180),w=Math.asin(gt((g-(n*n+v*v)*u*u)/(2*u),-1,1)),R=gt(wi(w),-85.051129,Mr);return new Ji(z,R)}}const Ax=1.340264,Cx=-.081106,Rx=893e-6,Ix=.003796,$b=Math.sqrt(3)/2;class _B extends Kp{project(n,o){o=o/180*Math.PI,n=n/180*Math.PI;const u=Math.asin($b*Math.sin(o)),g=u*u,d=g*g*g;return{x:.5*(n*Math.cos(u)/($b*(Ax+3*Cx*g+d*(7*Rx+9*Ix*g)))/Math.PI+.5),y:1-.5*(u*(Ax+Cx*g+d*(Rx+Ix*g))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,g=u*u,d=g*g*g;for(let w,R,L,A=0;A<12&&(R=u*(Ax+Cx*g+d*(Rx+Ix*g))-o,L=Ax+3*Cx*g+d*(7*Rx+9*Ix*g),w=R/L,u=gt(u-w,-Math.PI/3,Math.PI/3),g=u*u,d=g*g*g,!(Math.abs(w)<1e-12));++A);const v=$b*n*(Ax+3*Cx*g+d*(7*Rx+9*Ix*g))/Math.cos(u),E=Math.asin(Math.sin(u)/$b),C=gt(180*v/Math.PI,-180,180),z=gt(180*E/Math.PI,-85.051129,Mr);return new Ji(C,z)}}class vB extends Kp{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){return{x:.5+n/360,y:.5-o/360,z:0}}unproject(n,o){const u=360*(n-.5),g=gt(360*(.5-o),-85.051129,Mr);return new Ji(u,g)}}const xv=Math.PI/2;function Xb(l){return Math.tan((xv+l)/2)}class yB extends Kp{constructor(n){super(n),this.center=n.center||[0,30];const[o,u]=this.parallels=n.parallels||[30,30];let g=Mn(o),d=Mn(u);this.southernCenter=g+d<0,this.southernCenter&&(g=-g,d=-d);const v=Math.cos(g),E=Xb(g);this.n=g===d?Math.sin(g):Math.log(v/Math.cos(d))/Math.log(Xb(d)/E),this.f=v*Math.pow(Xb(g),this.n)/this.n}project(n,o){o=Mn(o),this.southernCenter&&(o=-o),n=Mn(n-this.center[0]);const u=1e-6,{n:g,f:d}=this;d>0?o<-xv+u&&(o=-xv+u):o>xv-u&&(o=xv-u);const v=d/Math.pow(Xb(o),g);let E=v*Math.sin(g*n),C=d-v*Math.cos(g*n);return E=.5*(E/Math.PI+.5),C=.5*(C/Math.PI+.5),{x:E,y:this.southernCenter?C:1-C,z:0}}unproject(n,o){n=(2*n-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:u,f:g}=this,d=g-o,v=Math.sign(d),E=Math.sign(u)*Math.sqrt(n*n+d*d);let C=Math.atan2(n,Math.abs(d))*v;d*u<0&&(C-=Math.PI*Math.sign(n)*v);const z=gt(wi(C/u)+this.center[0],-180,180),w=gt(wi(2*Math.atan(Math.pow(g/E,1/u))-xv),-85.051129,Mr);return new Ji(z,this.southernCenter?-w:w)}}class yI extends Kp{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,o){return{x:rl(n),y:Ns(o),z:0}}unproject(n,o){const u=Ro(n),g=Ra(o);return new Ji(u,g)}}const xI=Mn(Mr);class xB extends Kp{project(n,o){const u=(o=Mn(o))*o,g=u*u;return{x:.5*((n=Mn(n))*(.8707-.131979*u+g*(g*(.003971*u-.001529*g)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+u*(.015085+g*(.028874*u-.044475-.005916*g)))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,g=25,d=0,v=u*u;do{v=u*u;const z=v*v;d=(u*(1.007226+v*(.015085+z*(.028874*v-.044475-.005916*z)))-o)/(1.007226+v*(.045255+z*(.259866*v-.311325-.005916*11*z))),u=gt(u-d,-xI,xI)}while(Math.abs(d)>1e-6&&--g>0);v=u*u;const E=gt(wi(n/(.8707+v*(v*(v*v*v*(.003971-.001529*v)-.013791)-.131979))),-180,180),C=wi(u);return new Ji(E,C)}}const bI=Mn(Mr);class bB extends Kp{project(n,o){o=Mn(o),n=Mn(n);const u=Math.cos(o),g=2/Math.PI,d=Math.acos(u*Math.cos(n/2)),v=Math.sin(d)/d,E=.5*(n*g+2*u*Math.sin(n/2)/v)||0,C=.5*(o+Math.sin(o)/v)||0;return{x:.5*(E/Math.PI+.5),y:1-.5*(C/Math.PI+1),z:0}}unproject(n,o){let u=n=(2*n-.5)*Math.PI,g=o=(2*(1-o)-1)*Math.PI,d=25;const v=1e-6;let E=0,C=0;do{const z=Math.cos(g),w=Math.sin(g),R=2*w*z,L=w*w,A=z*z,D=Math.cos(u/2),F=Math.sin(u/2),W=2*D*F,$=F*F,ie=1-A*D*D,re=ie?1/ie:0,ee=ie?Math.acos(z*D)*Math.sqrt(1/ie):0,ae=.5*(2*ee*z*F+2*u/Math.PI)-n,de=.5*(ee*w+g)-o,ye=.5*re*(A*$+ee*z*D*L)+1/Math.PI,De=re*(W*R/4-ee*w*F),Ie=.125*re*(R*F-ee*w*A*W),Re=.5*re*(L*D+ee*$*z)+.5,$e=De*Ie-Re*ye;E=(de*De-ae*Re)/$e,C=(ae*Ie-de*ye)/$e,u=gt(u-E,-Math.PI,Math.PI),g=gt(g-C,-bI,bI)}while((Math.abs(E)>v||Math.abs(C)>v)&&--d>0);return new Ji(wi(u),wi(g))}}class wI extends Kp{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Mn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){const{scale:u,cosPhi:g}=this;return{x:Mn(n)*g*u+.5,y:-Math.sin(Mn(o))/g*u+.5,z:0}}unproject(n,o){const{scale:u,cosPhi:g}=this,d=-(o-.5)/u,v=gt(wi((n-.5)/u)/g,-180,180),E=Math.asin(gt(d*g,-1,1)),C=gt(wi(E),-85.051129,Mr);return new Ji(v,C)}}class wB extends yI{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,o,u){const g=ur(n,o,u),d=la(jr(u));return Pe.vec3.transformMat4(g,g,d),{x:g[0],y:g[1],z:g[2]}}locationPoint(n,o){const u=Qc(o.lat,o.lng),g=Pe.vec3.normalize([],u),d=n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(o),n._centerAltitude):n._centerAltitude,v=po(1,0)*yn*d;Pe.vec3.scaleAndAdd(u,u,g,v);const E=Pe.mat4.identity(new Float64Array(16));return Pe.mat4.multiply(E,n.pixelMatrix,n.globeMatrix),Pe.vec3.transformMat4(u,u,E),new ke(u[0],u[1])}pixelsPerMeter(n,o){return po(1,0)*o}pixelSpaceConversion(n,o,u){const g=po(1,n)*o,d=oi(po(1,45)*o,g,u);return this.pixelsPerMeter(n,o)/d}createTileMatrix(n,o,u){const g=mr(jr(u.canonical));return Pe.mat4.multiply(new Float64Array(16),n.globeMatrix,g)}createInversionMatrix(n,o){const{center:u}=n,g=la(jr(o));return Pe.mat4.rotateY(g,g,Mn(u.lng)),Pe.mat4.rotateX(g,g,Mn(u.lat)),Pe.mat4.scale(g,g,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(g)}pointCoordinate(n,o,u,g){return hi(n,o,u,!0)||new s(0,0)}pointCoordinate3D(n,o,u){const g=this.pointCoordinate(n,o,u,0);return[g.x,g.y,g.z]}isPointAboveHorizon(n,o){return!hi(n,o.x,o.y,!1)}farthestPixelDistance(n){const o=function(g,d){const v=g.cameraToCenterDistance,E=g._centerAltitude*d,C=g._camera,z=g._camera.forward(),w=Pe.vec3.add([],Pe.vec3.scale([],z,-v),[0,0,E]),R=g.worldSize/(2*Math.PI),L=[0,0,-R],A=g.width/g.height,D=Math.tan(g.fovAboveCenter),F=Pe.vec3.scale([],C.up(),D),W=Pe.vec3.scale([],C.right(),D*A),$=Pe.vec3.normalize([],Pe.vec3.add([],Pe.vec3.add([],z,F),W)),ie=[];let re;if(new mi(w,$).closestPointOnSphere(L,R,ie)){const ee=Pe.vec3.add([],ie,L),ae=Pe.vec3.sub([],ee,w);re=Math.cos(g.fovAboveCenter)*Pe.vec3.length(ae)}else{const ee=Pe.vec3.sub([],w,L),ae=Pe.vec3.sub([],L,w);Pe.vec3.normalize(ae,ae);const de=Pe.vec3.length(ee)-R;re=Math.sqrt(de*(de+2*R));const ye=Math.acos(re/(R+de))-Math.acos(Pe.vec3.dot(z,ae));re*=Math.cos(ye)}return 1.01*re}(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),u=mo(n.zoom);if(u>0){const g=_I(n,po(1,n.center.lat)*n.worldSize),d=n.worldSize/(2*Math.PI),v=Math.max(n.width,n.height)/n.worldSize*Math.PI;return oi(o,g+d*(1-Math.cos(v)),Math.pow(u,10))}return o}upVector(n,o,u){return ur(o,u,n,1)}upVectorScale(n){return{metersToTile:li(Xi(jr(n)))}}}function SI(l){const n=l.parallels,o=!!n&&Math.abs(n[0]+n[1])<.01;switch(l.name){case"mercator":return new yI(l);case"equirectangular":return new vB(l);case"naturalEarth":return new xB(l);case"equalEarth":return new _B(l);case"winkelTripel":return new bB(l);case"albers":return o?new wI(l):new gB(l);case"lambertConformalConic":return o?new wI(l):new yB(l);case"globe":return new wB(l)}throw new Error(`Invalid projection name: ${l.name}`)}const SB=Sf.VectorTileFeature.types,EB=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Zb(l,n,o,u,g,d,v,E,C,z,w,R,L){const A=E?Math.min(Yp,Math.round(E[0])):0,D=E?Math.min(Yp,Math.round(E[1])):0;l.emplaceBack(n,o,Math.round(32*u),Math.round(32*g),d,v,(A<<1)+(C?1:0),D,16*z,16*w,256*R,256*L)}function Yb(l,n,o){l.emplaceBack(n,o)}function Kb(l,n,o,u,g,d,v){l.emplaceBack(n,o,u,g,d,v)}function Jb(l,n,o,u,g){l.emplaceBack(n,o,u,g),l.emplaceBack(n,o,u,g),l.emplaceBack(n,o,u,g),l.emplaceBack(n,o,u,g)}function MB(l){for(const n of l.sections)if(Bc(n.text))return!0;return!1}class mM{constructor(n){this.layoutVertexArray=new sf,this.indexArray=new Ha,this.programConfigurations=n,this.segments=new Jr,this.dynamicLayoutVertexArray=new $c,this.opacityVertexArray=new lg,this.placedSymbolArray=new cg,this.iconTransitioningVertexArray=new Xc,this.globeExtVertexArray=new Cp,this.zOffsetVertexArray=new Qs}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(n,o,u,g,d){this.isEmpty()||(u&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Ub.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,id.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,EB,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=n.createVertexBuffer(this.iconTransitioningVertexArray,ad.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,yx.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,rd.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||g)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ln(mM,"SymbolBuffers");class gM{constructor(n,o,u){this.layoutVertexArray=new n,this.layoutAttributes=o,this.indexArray=new u,this.segments=new Jr,this.collisionVertexArray=new Gh,this.collisionVertexArrayExt=new $c}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,Rg.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,Ig.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ln(gM,"CollisionBuffers");class Qb{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.lut=n.lut,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(v=>v.fqid),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Pe.mat4.identity([]),this.placementViewportMatrix=Pe.mat4.identity([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=pv(this.zoom,o["text-size"]),this.iconSizeData=pv(this.zoom,o["icon-size"]);const u=this.layers[0].layout,g=u.get("symbol-sort-key"),d=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&g.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(v=>He[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=n.sourceID,this.projection=n.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=u.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new mM(new ts(this.layers,{zoom:this.zoom,lut:this.lut},n=>n.startsWith("text")||n.startsWith("symbol"))),this.icon=new mM(new ts(this.layers,{zoom:this.zoom,lut:this.lut},n=>n.startsWith("icon")||n.startsWith("symbol"))),this.glyphOffsetArray=new hg,this.lineVertexArray=new eo,this.symbolInstances=new B_}calculateGlyphDependencies(n,o,u,g,d){for(const v of n){const E=v.codePointAt(0);if(E===void 0)break;if(o[E]=!0,g&&d&&E<=65535){const C=od[v];C&&(o[C.charCodeAt(0)]=!0)}}}updateFootprints(n,o){}updateReplacement(n,o){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(n.toUnwrapped(),!0);return!bg(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(n,o,u,g){const d=this.layers[0],v=d.layout,E=this.projection.name==="globe",C=v.get("text-font"),z=v.get("text-field"),w=v.get("icon-image"),[R,L]=v.get("icon-size-scale-range"),A=gt(o.scaleFactor||1,R,L),D=(z.value.kind!=="constant"||z.value.value instanceof Va&&!z.value.value.isEmpty()||z.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),F=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,W=v.get("symbol-sort-key");if(this.features=[],!D&&!F)return;const $=o.iconDependencies,ie=o.glyphDependencies,re=o.availableImages,ee=new Er(this.zoom);for(const{feature:ae,id:de,index:ye,sourceLayerIndex:De}of n){const Ie=d._featureFilter.needGeometry,Re=Z(ae,Ie);if(!d._featureFilter.filter(ee,Re,u))continue;if(Ie||(Re.geometry=q(ae,u,g)),E&&ae.type!==1&&u.z<=5){const Je=Re.geometry,rt=.98078528056,ct=(yt,st)=>{const Bt=ur(yt.x,yt.y,u,1),Qt=ur(st.x,st.y,u,1);return Pe.vec3.dot(Bt,Qt)<rt};for(let yt=0;yt<Je.length;yt++)Je[yt]=T(Je[yt],ct)}let $e,Oe;if(D){const Je=d.getValueAndResolveTokens("text-field",Re,u,re),rt=Va.factory(Je);MB(rt)&&(this.hasRTLText=!0),(!this.hasRTLText||Nh()==="unavailable"||this.hasRTLText&&Br.isParsed())&&($e=mv(rt,d,Re))}if(F){const Je=d.getValueAndResolveTokens("icon-image",Re,u,re);Oe=Je instanceof so?Je:so.build(Je)}if(!$e&&!Oe)continue;const Ye=this.sortFeaturesByKey?W.evaluate(Re,{},u):void 0,tt={id:de,text:$e,icon:Oe,index:ye,sourceLayerIndex:De,geometry:Re.geometry,properties:ae.properties,type:SB[ae.type],sortKey:Ye};if(this.features.push(tt),Oe){const Je=xx(this.iconSizeData,this.layers[0]._unevaluatedLayout._values["icon-size"],u,this.zoom,tt)*A*this.pixelRatio,rt=Oe.getPrimary().scaleSelf(Je);if($[rt.id]=$[rt.id]||[],$[rt.id].push(rt),Oe.nameSecondary){const ct=Oe.getSecondary().scaleSelf(Je);$[ct.id]=$[ct.id]||[],$[ct.id].push(ct)}}if($e){const Je=C.evaluate(Re,{},u).join(","),rt=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(He.vertical)>=0;for(const ct of $e.sections)if(ct.image){const yt=ct.image.getPrimary().scaleSelf(this.pixelRatio);$[yt.id]=$[yt.id]||[],$[yt.id].push(yt)}else{const yt=Wr($e.toString()),st=ct.fontStack||Je,Bt=ie[st]=ie[st]||{};this.calculateGlyphDependencies(ct.text,Bt,rt,this.allowVerticalPlacement,yt)}}}v.get("symbol-placement")==="line"&&(this.features=function(ae){const de={},ye={},De=[];let Ie=0;function Re(tt){De.push(ae[tt]),Ie++}function $e(tt,Je,rt){const ct=ye[tt];return delete ye[tt],ye[Je]=ct,De[ct].geometry[0].pop(),De[ct].geometry[0]=De[ct].geometry[0].concat(rt[0]),ct}function Oe(tt,Je,rt){const ct=de[Je];return delete de[Je],de[tt]=ct,De[ct].geometry[0].shift(),De[ct].geometry[0]=rt[0].concat(De[ct].geometry[0]),ct}function Ye(tt,Je,rt){const ct=rt?Je[0][Je[0].length-1]:Je[0][0];return`${tt}:${ct.x}:${ct.y}`}for(let tt=0;tt<ae.length;tt++){const Je=ae[tt],rt=Je.geometry,ct=Je.text?Je.text.toString():null;if(!ct){Re(tt);continue}const yt=Ye(ct,rt),st=Ye(ct,rt,!0);if(yt in ye&&st in de&&ye[yt]!==de[st]){const Bt=Oe(yt,st,rt),Qt=$e(yt,st,De[Bt].geometry);delete de[yt],delete ye[st],ye[Ye(ct,De[Qt].geometry,!0)]=Qt,De[Bt].geometry=null}else yt in ye?$e(yt,st,rt):st in de?Oe(yt,st,rt):(Re(tt),de[yt]=Ie-1,ye[st]=Ie-1)}return De.filter(tt=>tt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ae,de)=>ae.sortKey-de.sortKey)}update(n,o,u,g,d,v,E){this.text.programConfigurations.updatePaintArrays(n,o,d,u,g,v,E),this.icon.programConfigurations.updatePaintArrays(n,o,d,u,g,v,E)}updateZOffset(){const n=(d,v,E)=>{u+=v,u>d.length&&d.resize(u);for(let C=-v;C<0;C++)d.emplace(C+u,E)},o=(d,v,E)=>{g+=v,g>d.length&&d.resize(g);for(let C=-v;C<0;C++)d.emplace(C+g,E)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,g=0;for(let d=0;d<this.symbolInstances.length;d++){const v=this.symbolInstances.get(d),{numHorizontalGlyphVertices:E,numVerticalGlyphVertices:C,numIconVertices:z}=v,w=v.zOffset,R=z>0;if((E>0||C>0)&&(n(this.text.zOffsetVertexArray,E,w),n(this.text.zOffsetVertexArray,C,w)),R){const{placedIconSymbolIndex:L,verticalPlacedIconSymbolIndex:A}=v;L>=0&&o(this.icon.zOffsetVertexArray,z,w),A>=0&&o(this.icon.zOffsetVertexArray,v.numVerticalIconVertices,w)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=SI(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,o){const u=this.lineVertexArray.length;if(n.segment!==void 0)for(const{x:g,y:d}of o)this.lineVertexArray.emplaceBack(g,d);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(n,o,u,g,d,v,E,C,z,w,R,L,A,D,F,W){const $=n.indexArray,ie=n.layoutVertexArray,re=n.globeExtVertexArray,ee=n.segments.prepareSegment(4*o.length,ie,$,this.canOverlap?v.sortKey:void 0),ae=this.glyphOffsetArray.length,de=ee.vertexLength,ye=this.allowVerticalPlacement&&E===He.vertical?Math.PI/2:0,De=v.text&&v.text.sections;for(let Re=0;Re<o.length;Re++){const{tl:$e,tr:Oe,bl:Ye,br:tt,texPrimary:Je,texSecondary:rt,pixelOffsetTL:ct,pixelOffsetBR:yt,minFontScaleX:st,minFontScaleY:Bt,glyphOffset:Qt,isSDF:Nt,sectionIndex:An}=o[Re],xn=ee.vertexLength,cn=Qt[1];if(Zb(ie,z.x,z.y,$e.x,cn+$e.y,Je.x,Je.y,u,Nt,ct.x,ct.y,st,Bt),Zb(ie,z.x,z.y,Oe.x,cn+Oe.y,Je.x+Je.w,Je.y,u,Nt,yt.x,ct.y,st,Bt),Zb(ie,z.x,z.y,Ye.x,cn+Ye.y,Je.x,Je.y+Je.h,u,Nt,ct.x,yt.y,st,Bt),Zb(ie,z.x,z.y,tt.x,cn+tt.y,Je.x+Je.w,Je.y+Je.h,u,Nt,yt.x,yt.y,st,Bt),C){const{x:nn,y:Hn,z:In}=C.anchor,[kn,yi,Ri]=C.up;Kb(re,nn,Hn,In,kn,yi,Ri),Kb(re,nn,Hn,In,kn,yi,Ri),Kb(re,nn,Hn,In,kn,yi,Ri),Kb(re,nn,Hn,In,kn,yi,Ri),Jb(n.dynamicLayoutVertexArray,nn,Hn,In,ye)}else Jb(n.dynamicLayoutVertexArray,z.x,z.y,z.z,ye);if(W){const nn=rt||Je;Yb(n.iconTransitioningVertexArray,nn.x,nn.y),Yb(n.iconTransitioningVertexArray,nn.x+nn.w,nn.y),Yb(n.iconTransitioningVertexArray,nn.x,nn.y+nn.h),Yb(n.iconTransitioningVertexArray,nn.x+nn.w,nn.y+nn.h)}$.emplaceBack(xn,xn+1,xn+2),$.emplaceBack(xn+1,xn+2,xn+3),ee.vertexLength+=4,ee.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Qt[0]),Re!==o.length-1&&An===o[Re+1].sectionIndex||n.programConfigurations.populatePaintArrays(ie.length,v,v.index,{},A,D,F,De&&De[An])}const Ie=C?C.anchor:z;n.placedSymbolArray.emplaceBack(Ie.x,Ie.y,Ie.z,z.x,z.y,ae,this.glyphOffsetArray.length-ae,de,w,R,z.segment,u?u[0]:0,u?u[1]:0,g[0],g[1],E,0,!1,0,L,0)}_commitLayoutVertex(n,o,u,g,d,v,E){n.emplaceBack(o,u,g,d,v,Math.round(E.x),Math.round(E.y))}_addCollisionDebugVertices(n,o,u,g,d,v,E){const C=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),z=C.vertexLength,w=E.tileAnchorX,R=E.tileAnchorY;for(let A=0;A<4;A++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,o,n.padding,E.zOffset),this._commitLayoutVertex(u.layoutVertexArray,g,d,v,w,R,new ke(n.x1,n.y1)),this._commitLayoutVertex(u.layoutVertexArray,g,d,v,w,R,new ke(n.x2,n.y1)),this._commitLayoutVertex(u.layoutVertexArray,g,d,v,w,R,new ke(n.x2,n.y2)),this._commitLayoutVertex(u.layoutVertexArray,g,d,v,w,R,new ke(n.x1,n.y2)),C.vertexLength+=4;const L=u.indexArray;L.emplaceBack(z,z+1),L.emplaceBack(z+1,z+2),L.emplaceBack(z+2,z+3),L.emplaceBack(z+3,z),C.primitiveLength+=4}_addTextDebugCollisionBoxes(n,o,u,g,d,v){for(let E=g;E<d;E++){const C=u.get(E),z=this.getSymbolInstanceTextSize(n,v,o,E);this._addCollisionDebugVertices(C,z,this.textCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(n,o,u,g,d,v){for(let E=g;E<d;E++){const C=u.get(E),z=this.getSymbolInstanceIconSize(n,o,v.placedIconSymbolIndex);this._addCollisionDebugVertices(C,z,this.iconCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,v)}}generateCollisionDebugBuffers(n,o,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gM(Zc,Wu.members,Xc),this.iconCollisionBox=new gM(Zc,Wu.members,Xc);const g=If(this.iconSizeData,n),d=If(this.textSizeData,n,u);for(let v=0;v<this.symbolInstances.length;v++){const E=this.symbolInstances.get(v);this._addTextDebugCollisionBoxes(d,n,o,E.textBoxStartIndex,E.textBoxEndIndex,E),this._addTextDebugCollisionBoxes(d,n,o,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E),this._addIconDebugCollisionBoxes(g,n,o,E.iconBoxStartIndex,E.iconBoxEndIndex,E),this._addIconDebugCollisionBoxes(g,n,o,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E)}}getSymbolInstanceTextSize(n,o,u,g){const d=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:g),v=Rf(this.textSizeData,n,d)/go;return this.tilePixelRatio*v}getSymbolInstanceIconSize(n,o,u){const g=this.icon.placedSymbolArray.get(u),d=Rf(this.iconSizeData,n,g);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(n,o,u,g){n.emplaceBack(o,-u,-u,g),n.emplaceBack(o,u,-u,g),n.emplaceBack(o,u,u,g),n.emplaceBack(o,-u,u,g)}_updateTextDebugCollisionBoxes(n,o,u,g,d,v,E){for(let C=g;C<d;C++){const z=u.get(C),w=this.getSymbolInstanceTextSize(n,v,o,C);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,z.padding,v.zOffset)}}_updateIconDebugCollisionBoxes(n,o,u,g,d,v,E){for(let C=g;C<d;C++){const z=u.get(C),w=this.getSymbolInstanceIconSize(n,o,v.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,z.padding,v.zOffset)}}updateCollisionDebugBuffers(n,o,u,g){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=If(this.iconSizeData,n,g),v=If(this.textSizeData,n,u);for(let E=0;E<this.symbolInstances.length;E++){const C=this.symbolInstances.get(E);this._updateTextDebugCollisionBoxes(v,n,o,C.textBoxStartIndex,C.textBoxEndIndex,C,u),this._updateTextDebugCollisionBoxes(v,n,o,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C,u),this._updateIconDebugCollisionBoxes(d,n,o,C.iconBoxStartIndex,C.iconBoxEndIndex,C,g),this._updateIconDebugCollisionBoxes(d,n,o,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex,C,g)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,o,u,g,d,v,E,C,z){const w={};if(o<u){const{x1:R,y1:L,x2:A,y2:D,padding:F,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:ee,featureIndex:ae}=n.get(o);w.textBox={x1:R,y1:L,x2:A,y2:D,padding:F,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:ee},w.textFeatureIndex=ae}if(g<d){const{x1:R,y1:L,x2:A,y2:D,padding:F,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:ee,featureIndex:ae}=n.get(g);w.verticalTextBox={x1:R,y1:L,x2:A,y2:D,padding:F,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:ee},w.verticalTextFeatureIndex=ae}if(v<E){const{x1:R,y1:L,x2:A,y2:D,padding:F,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:ee,featureIndex:ae}=n.get(v);w.iconBox={x1:R,y1:L,x2:A,y2:D,padding:F,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:ee},w.iconFeatureIndex=ae}if(C<z){const{x1:R,y1:L,x2:A,y2:D,padding:F,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:ee,featureIndex:ae}=n.get(C);w.verticalIconBox={x1:R,y1:L,x2:A,y2:D,padding:F,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:ee},w.verticalIconFeatureIndex=ae}return w}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(n,o){const u=n.placedSymbolArray.get(o),g=u.vertexStartIndex+4*u.numGlyphs;for(let d=u.vertexStartIndex;d<g;d+=4)n.indexArray.emplaceBack(d,d+1,d+2),n.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(n),u=Math.cos(n),g=[],d=[],v=[];for(let E=0;E<this.symbolInstances.length;++E){v.push(E);const C=this.symbolInstances.get(E);g.push(0|Math.round(o*C.tileAnchorX+u*C.tileAnchorY)),d.push(C.featureIndex)}return v.sort((E,C)=>g[E]-g[C]||d[C]-d[E]),v}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let n=0;n<this.symbolInstances.length;++n)this.symbolInstanceIndexesSortedZOffset.push(n)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((n,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(n).zOffset)}addToSortKeyRanges(n,o){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const u=this.symbolInstances.get(o);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:E,placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:z}=u;g>=0&&this.addIndicesForPlacedSymbol(this.text,g),d>=0&&d!==g&&this.addIndicesForPlacedSymbol(this.text,d),v>=0&&v!==d&&v!==g&&this.addIndicesForPlacedSymbol(this.text,v),E>=0&&this.addIndicesForPlacedSymbol(this.text,E),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C),z>=0&&this.addIndicesForPlacedSymbol(this.icon,z)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let EI,MI,_M;Ln(Qb,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Qb.addDynamicAttributes=Jb;class TI{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:qs,this.defaultValue=n}evaluate(n){if(n.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(n.formattedSection))return o.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ln(TI,"FormatSectionOverride",{omit:["defaultValue"]});const vM=()=>_M||(_M={layout:EI||(EI=new $r({"symbol-placement":new hn(bt.layout_symbol["symbol-placement"]),"symbol-spacing":new hn(bt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new hn(bt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Dn(bt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new hn(bt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new hn(bt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new hn(bt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new hn(bt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new hn(bt.layout_symbol["icon-ignore-placement"]),"icon-optional":new hn(bt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new hn(bt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Dn(bt.layout_symbol["icon-size"]),"icon-size-scale-range":new hn(bt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Dn(bt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Dn(bt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Dn(bt.layout_symbol["icon-image"]),"icon-rotate":new Dn(bt.layout_symbol["icon-rotate"]),"icon-padding":new hn(bt.layout_symbol["icon-padding"]),"icon-keep-upright":new hn(bt.layout_symbol["icon-keep-upright"]),"icon-offset":new Dn(bt.layout_symbol["icon-offset"]),"icon-anchor":new Dn(bt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new hn(bt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new hn(bt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new hn(bt.layout_symbol["text-rotation-alignment"]),"text-field":new Dn(bt.layout_symbol["text-field"]),"text-font":new Dn(bt.layout_symbol["text-font"]),"text-size":new Dn(bt.layout_symbol["text-size"]),"text-size-scale-range":new hn(bt.layout_symbol["text-size-scale-range"]),"text-max-width":new Dn(bt.layout_symbol["text-max-width"]),"text-line-height":new Dn(bt.layout_symbol["text-line-height"]),"text-letter-spacing":new Dn(bt.layout_symbol["text-letter-spacing"]),"text-justify":new Dn(bt.layout_symbol["text-justify"]),"text-radial-offset":new Dn(bt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new hn(bt.layout_symbol["text-variable-anchor"]),"text-anchor":new Dn(bt.layout_symbol["text-anchor"]),"text-max-angle":new hn(bt.layout_symbol["text-max-angle"]),"text-writing-mode":new hn(bt.layout_symbol["text-writing-mode"]),"text-rotate":new Dn(bt.layout_symbol["text-rotate"]),"text-padding":new hn(bt.layout_symbol["text-padding"]),"text-keep-upright":new hn(bt.layout_symbol["text-keep-upright"]),"text-transform":new Dn(bt.layout_symbol["text-transform"]),"text-offset":new Dn(bt.layout_symbol["text-offset"]),"text-allow-overlap":new hn(bt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new hn(bt.layout_symbol["text-ignore-placement"]),"text-optional":new hn(bt.layout_symbol["text-optional"]),visibility:new hn(bt.layout_symbol.visibility)})),paint:MI||(MI=new $r({"icon-opacity":new Dn(bt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Dn(bt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Dn(bt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Dn(bt.paint_symbol["text-emissive-strength"]),"icon-color":new Dn(bt.paint_symbol["icon-color"]),"icon-halo-color":new Dn(bt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Dn(bt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Dn(bt.paint_symbol["icon-halo-blur"]),"icon-translate":new hn(bt.paint_symbol["icon-translate"]),"icon-translate-anchor":new hn(bt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Dn(bt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Dn(bt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Dn(bt.paint_symbol["text-occlusion-opacity"]),"text-color":new Dn(bt.paint_symbol["text-color"],{runtimeType:Wa,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new Dn(bt.paint_symbol["text-halo-color"]),"text-halo-width":new Dn(bt.paint_symbol["text-halo-width"]),"text-halo-blur":new Dn(bt.paint_symbol["text-halo-blur"]),"text-translate":new hn(bt.paint_symbol["text-translate"]),"text-translate-anchor":new hn(bt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new hn(bt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new hn(bt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new hn(bt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new hn(bt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Dn(bt.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},_M);class e1 extends Ca{constructor(n,o,u,g){super(n,vM(),o,u,g),this._colorAdjustmentMatrix=Pe.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=n.paint!==void 0&&("icon-occlusion-opacity"in n.paint||"text-occlusion-opacity"in n.paint)}recalculate(n,o){super.recalculate(n,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const g=[];for(const d of u)g.indexOf(d)<0&&g.push(d);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(n,o,u,g){return this._saturation===n&&this._contrast===o&&this._brightnessMin===u&&this._brightnessMax===g||(this._colorAdjustmentMatrix=function(d,v,E,C){d=oo(d),v=Cr(v);const z=Pe.mat4.create(),w=d/3,R=1-2*w,L=[R,w,w,0,w,R,w,0,w,w,R,0,0,0,0,1],A=.5-.5*v,D=C-E;return Pe.mat4.multiply(z,[D,0,0,0,0,D,0,0,0,0,D,0,E,E,E,1],[v,0,0,0,0,v,0,0,0,0,v,0,A,A,A,1]),Pe.mat4.multiply(z,z,L),z}(n,o,u,g),this._saturation=n,this._contrast=o,this._brightnessMin=u,this._brightnessMax=g),this._colorAdjustmentMatrix}getValueAndResolveTokens(n,o,u,g){const d=this.layout.get(n).evaluate(o,{},u,g),v=this._unevaluatedLayout._values[n];return v.isDataDriven()||Ph(v.value)||!d?d:function(E,C){return C.replace(/{([^{}]+)}/g,(z,w)=>w in E?String(E[w]):"")}(o.properties,d)}createBucket(n){return new Qb(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of vM().paint.overridableProperties){if(!e1.hasPaintOverride(this.layout,n))continue;const o=this.paint.get(n),u=new TI(o),g=new Sp(u,o.property.specification,this.scope,this.options);let d=null;d=o.value.kind==="constant"||o.value.kind==="source"?new Lh("source",g):new $l("composite",g,o.value.zoomStops,o.value._interpolationType),this.paint._values[n]=new qc(o.property,d,o.parameters)}}_handleOverridablePaintPropertyUpdate(n,o,u){return!(!this.layout||o.isDataDriven()||u.isDataDriven())&&e1.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,o){const u=n.get("text-field"),g=vM().paint.properties[o];let d=!1;const v=E=>{for(const C of E)if(g.overrides&&g.overrides.hasOverride(C))return void(d=!0)};if(u.value.kind==="constant"&&u.value.value instanceof Va)v(u.value.value.sections);else if(u.value.kind==="source"){const E=z=>{d||(z instanceof Xa&&Yr(z.value)===ls?v(z.value.sections):z instanceof wc?v(z.sections):z.eachChild(E))},C=u.value;C._styleExpression&&E(C._styleExpression.expression)}return d}getProgramIds(){return["symbol"]}getDefaultProgramParams(n,o,u){return{config:new wl(this,{zoom:o,lut:u}),overrideFog:!1}}}let AI,CI,RI,II;var yM=sr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function xM(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function bM(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class wM{constructor(n,o,u,g){this.context=n,this.format=u,this.useMipmap=g&&g.useMipmap,this.texture=n.gl.createTexture(),this.update(o,{premultiply:g&&g.premultiply})}update(n,o){const u=n&&n instanceof HTMLVideoElement&&n.width===0?n.videoWidth:n.width,g=n&&n instanceof HTMLVideoElement&&n.height===0?n.videoHeight:n.height,{context:d}=this,{gl:v}=d,{x:E,y:C}=o&&o.position?o.position:{x:0,y:0},z=E+u,w=C+g;!this.size||this.size[0]===z&&this.size[1]===w||(v.bindTexture(v.TEXTURE_2D,null),v.deleteTexture(this.texture),this.texture=v.createTexture(),this.size=null),v.bindTexture(v.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA8&&(!o||o.premultiply!==!1));const R=n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap;if(!this.size&&z>0&&w>0){const L=this.useMipmap?Math.floor(Math.log2(Math.max(z,w)))+1:1;v.texStorage2D(v.TEXTURE_2D,L,this.format,z,w),this.size=[z,w]}if(this.size)if(R)v.texSubImage2D(v.TEXTURE_2D,0,E,C,xM(this.format),bM(this.format),n);else{const L=n.data;L&&v.texSubImage2D(v.TEXTURE_2D,0,E,C,u,g,xM(this.format),bM(this.format),L)}this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(n,o,u=!1){const{context:g}=this,{gl:d}=g;d.bindTexture(d.TEXTURE_2D,this.texture),n!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!u?n===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),o!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,o),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(n,o,u,g){const{context:d}=this,{gl:v}=d;v.bindTexture(v.TEXTURE_2D,this.texture),o!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,o),this.magFilter=o),n!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?n===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),u!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,u),this.wrapS=u),g!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,g),this.wrapT=g)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class t1{constructor(n,o){this.context=n,this.texture=o}bind(n,o){const{context:u}=this,{gl:g}=u;g.bindTexture(g.TEXTURE_2D,this.texture),n!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,n),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,n),this.minFilter=n),o!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,o),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,o),this.wrapS=o)}}function n1(l,n,o,u,g,d,v,E){const C=[l,n,1,o,u,1,g,d,1],z=[v,E,1],w=Pe.mat3.adjoint([],C),[R,L,A]=Pe.vec3.transformMat3(z,z,w);return Pe.mat3.multiply(C,C,[R,0,0,0,L,0,0,0,A])}function DI(l,n,o,u,g,d,v,E){const C=function(z,w,R,L,A,D,F,W){const $=n1(0,0,1,0,1,1,0,1),ie=n1(z,w,R,L,A,D,F,W),re=Pe.mat3.adjoint([],$);return Pe.mat3.multiply(ie,ie,re)}(l,n,o,u,g,d,v,E);return[C[2]/C[8]/yn,C[5]/C[8]/yn]}function i1(l){return[l[0],Math.min(Math.max(l[1],-85.051129),Mr)]}class PI extends Fl{constructor(n,o,u,g){super(),this.id=n,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(g),this.options=o,this._dirty=!1}load(n,o){if(this._loaded=o||!1,this.fire(new Oo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return n&&(this.coordinates=n),this._loaded=!0,void this._finishLoading();this._imageRequest=To(this.map._requestManager.transformRequest(this.url,Vn.Image),(u,g)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new yo(u)):g&&(this.image=g instanceof HTMLImageElement?je.getImageData(g):g,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}setTexture(n){if(!(n.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new t1(this.map.painter.context,n.handle),this.width=n.dimensions[0],this.height=n.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Oo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(n){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof t1||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(n){if(this.coordinates=n,this._boundsArray=void 0,this._unsupportedCoords=!1,!n.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=n[0][1],u=n[0][1];for(const d of n)d[1]>u&&(u=d[1]),d[1]<o&&(o=d[1]);const g=(u+o)/2;if(g>Mr?this.onNorthPole=!0:g<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const d=n.map(s.fromLngLat);this.tileID=function(v){let E=1/0,C=1/0,z=-1/0,w=-1/0;for(const F of v)E=Math.min(E,F.x),C=Math.min(C,F.y),z=Math.max(z,F.x),w=Math.max(w,F.y);const R=Math.max(z-E,w-C),L=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),A=Math.pow(2,L);let D=Math.floor((E+z)/2*A);return D>1&&(D-=1),new Zt(L,D,Math.floor((C+w)/2*A))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Oo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(n){for(const $ in this.tiles){const ie=this.tiles[$];ie.state!=="loaded"&&(ie.state="loaded",ie.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const o=Tx(new Zt(0,0,0),this.map.transform.projection),u=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function($){const ie=$[1].x-$[0].x,re=$[1].y-$[0].y,ee=$[2].x-$[1].x,ae=$[2].y-$[1].y,de=$[3].x-$[2].x,ye=$[3].y-$[2].y,De=$[0].x-$[3].x,Ie=$[0].y-$[3].y,Re=ie*ae-ee*re,$e=ee*ye-de*ae,Oe=de*Ie-De*ye,Ye=De*re-ie*Ie;return Re>0&&$e>0&&Oe>0&&Ye>0||Re<0&&$e<0&&Oe<0&&Ye<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const g=Tx(this.tileID,this.map.transform.projection),[d,v,E,C]=this.coordinates.map($=>{const ie=g.projection.project($[0],$[1]);return vI(g,ie)._round()});this.perspectiveTransform=DI(d.x,d.y,v.x,v.y,E.x,E.y,C.x,C.y);const z=this._boundsArray=new Js;z.emplaceBack(d.x,d.y,0,0),z.emplaceBack(v.x,v.y,yn,0),z.emplaceBack(C.x,C.y,0,yn),z.emplaceBack(E.x,E.y,yn,yn),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=n.createVertexBuffer(z,yM.members),this.boundsSegments=Jr.simpleSegment(0,0,4,2);const w=[],R=[i1((L=this.coordinates)[0]),i1(L[1]),i1(L[2]),i1(L[3])];var L;const[A,D,F,W]=function($){let ie=$[0][0],re=ie,ee=$[0][1],ae=ee;for(let de=1;de<$.length;de++)$[de][0]<ie?ie=$[de][0]:$[de][0]>re&&(re=$[de][0]),$[de][1]<ee?ee=$[de][1]:$[de][1]>ae&&(ae=$[de][1]);return[ie,ee,re-ie,ae-ee]}(R);{const $=new Js,[ie,re,ee,ae]=function(ct){let yt=ct[0].x,st=yt,Bt=ct[0].y,Qt=Bt;for(let Nt=1;Nt<ct.length;Nt++)ct[Nt].x<yt?yt=ct[Nt].x:ct[Nt].x>st&&(st=ct[Nt].x),ct[Nt].y<Bt?Bt=ct[Nt].y:ct[Nt].y>Qt&&(Qt=ct[Nt].y);return[yt,Bt,st-yt,Qt-Bt]}(u),de=ct=>[(ct.x-ie)/ee,(ct.y-re)/ae],[ye,De,Ie,Re]=u.map(de),$e=function(ct,yt,st,Bt,Qt,Nt,An,xn){const cn=n1(0,0,1,0,1,1,0,1),nn=n1(ct,yt,st,Bt,Qt,Nt,An,xn),Hn=Pe.mat3.adjoint([],nn);return Pe.mat3.multiply(cn,cn,Hn)}(ye[0],ye[1],De[0],De[1],Ie[0],Ie[1],Re[0],Re[1]);this.elevatedGlobePerspectiveTransform=DI(ye[0],ye[1],De[0],De[1],Ie[0],Ie[1],Re[0],Re[1]);const Oe=(ct,yt)=>{w.push(ct.lng);const st=Math.round((ct.lng-A)/F*yn),Bt=Math.round((ct.lat-D)/W*yn),Qt=de(yt),Nt=Pe.vec3.transformMat3([],[Qt[0],Qt[1],1],$e),An=Math.round(Nt[0]/Nt[2]*yn),xn=Math.round(Nt[1]/Nt[2]*yn);$.emplaceBack(st,Bt,An,xn)},Ye=u[3].x-u[0].x,tt=u[3].y-u[0].y,Je=u[2].x-u[1].x,rt=u[2].y-u[1].y;for(let ct=0;ct<65;ct++){const yt=ct/64,st=[u[0].x+yt*Ye,u[0].y+yt*tt],Bt=[u[1].x+yt*Je,u[1].y+yt*rt],Qt=Bt[0]-st[0],Nt=Bt[1]-st[1];for(let An=0;An<65;An++){const xn=An/64,cn={x:st[0]+Qt*xn,y:st[1]+Nt*xn};Oe(o.projection.unproject(cn.x,cn.y),cn)}}this.elevatedGlobeVertexBuffer=n.createVertexBuffer($,yM.members)}{this.maxLongitudeTriangleSize=0;let $=[],ie=new Ha;const re=(ee,ae,de)=>{ie.emplaceBack(ee,ae,de);const ye=w[ee],De=w[ae],Ie=w[de],Re=Math.min(Math.min(ye,De),Ie),$e=Math.max(Math.max(ye,De),Ie)-Re;$e>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=$e),$.push(Re+$e/2)};for(let ee=0;ee<64;ee++)for(let ae=0;ae<64;ae++){const de=65*ee+ae,ye=de+1,De=de+65,Ie=De+1;re(de,De,ye),re(ye,De,Ie)}[$,ie]=function(ee,ae){const de=Array.from({length:ee.length},(Ie,Re)=>Re);de.sort((Ie,Re)=>ee[Ie]-ee[Re]);const ye=[],De=new Ha;for(let Ie=0;Ie<de.length;Ie++){const Re=de[Ie];ye.push(ee[Re]);const $e=3*Re,Oe=$e+1;De.emplaceBack(ae.uint16[$e],ae.uint16[Oe],ae.uint16[Oe+1])}return[ye,De]}($,ie),this.elevatedGlobeTrianglesCenterLongitudes=$,this.elevatedGlobeIndexBuffer=n.createIndexBuffer(ie)}this.elevatedGlobeSegments=Jr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,F/yn,0,W/yn,0,0,D,A,0])}prepare(){const n=Object.keys(this.tiles).length!==0;if(this.tileID&&!n)return;const o=this.map.painter.context,u=o.gl;!this._dirty||this.texture instanceof t1||(this.texture?this.texture.update(this.image):(this.texture=new wM(o,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),n&&this._prepareData(o)}loadTile(n,o){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},o(null)):(n.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(n){const o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let g=(d=n+180)+360*Math.round((u[0]-d)/360);var d;const v=new Jr,E=(R,L)=>{v.segments.push({vertexOffset:0,primitiveOffset:R,vertexLength:o.segments[0].vertexLength,primitiveLength:L,sortKey:void 0,vaos:{}})},C=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-g)<=C){const R=ga(u,0,u.length,g+C);return R===u.length||E(R,Zr(u,R+1,u.length,g+360-C)-R),v}g<u[0]&&(g+=360);const z=Zr(u,0,u.length,g-C);if(z===u.length)return E(0,u.length),v;E(0,z-0);const w=ga(u,z+1,u.length,g+C);return w!==u.length&&E(w,u.length-w),v}}const TB=(Math.pow(256,2)-1)/16907520;class LI extends Ca{constructor(n,o,u,g){super(n,{layout:RI||(RI=new $r({visibility:new hn(bt.layout_raster.visibility)})),paint:II||(II=new $r({"raster-opacity":new hn(bt.paint_raster["raster-opacity"]),"raster-color":new Ou(bt.paint_raster["raster-color"]),"raster-color-mix":new hn(bt.paint_raster["raster-color-mix"]),"raster-color-range":new hn(bt.paint_raster["raster-color-range"]),"raster-hue-rotate":new hn(bt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new hn(bt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new hn(bt.paint_raster["raster-brightness-max"]),"raster-saturation":new hn(bt.paint_raster["raster-saturation"]),"raster-contrast":new hn(bt.paint_raster["raster-contrast"]),"raster-resampling":new hn(bt.paint_raster["raster-resampling"]),"raster-fade-duration":new hn(bt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new hn(bt.paint_raster["raster-emissive-strength"]),"raster-array-band":new hn(bt.paint_raster["raster-array-band"]),"raster-elevation":new hn(bt.paint_raster["raster-elevation"]),"raster-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},o,u,g),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(n){return!(n&&n._source instanceof PI&&(n._source.onNorthPole||n._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(n){n!=="raster-color"&&n!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(n){if(!this.hasColorMap()||!this._curRampRange)return;const o=this._transitionablePaint._values["raster-color"].value.expression,[u,g]=n||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(g)||u===this._curRampRange[0]&&g===this._curRampRange[1]||(this.colorRamp=vf({expression:o,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:g}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,g])}}let OI,zI,kI,FI,NI;class BI extends Ca{constructor(n,o,u,g){super(n,{layout:OI||(OI=new $r({visibility:new hn(bt["layout_raster-particle"].visibility)})),paint:zI||(zI=new $r({"raster-particle-array-band":new hn(bt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new hn(bt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ou(bt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new hn(bt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new hn(bt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new hn(bt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new hn(bt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new hn(bt["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},o,u,g),this._updateColorRamp(),this.lastInvalidatedAt=je.now()}onRemove(n){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(n){return!1}_handleSpecialPaintPropertyUpdate(n){n!=="raster-particle-color"&&n!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),n==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const n=this._transitionablePaint._values["raster-particle-color"].value.expression,o=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=vf({expression:n,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:o}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=je.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class AB extends Ca{constructor(n,o){super(n,{},o,null),this.implementation=n,n.slot&&(this.slot=n.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(n){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}function SM(l,n,o){const u=[0,0,1],g=Pe.quat.identity([]);return Pe.quat.rotateY(g,g,o?-Mn(l)+Math.PI:Mn(l)),Pe.quat.rotateX(g,g,-Mn(n)),Pe.vec3.transformQuat(u,u,g),Pe.vec3.normalize(u,u)}function UI(l,n){const o=r1(l.projection,l.zoom,l.width,l.height),u=function(d,v,E,C,z){const w=new Ji(E.lng-180*Jp,E.lat),R=new Ji(E.lng+180*Jp,E.lat),L=d.project(w.lng,w.lat),A=d.project(R.lng,R.lat),D=-Math.atan2(A.y-L.y,A.x-L.x),F=s.fromLngLat(E);F.y=gt(F.y,-1+Jp,1-Jp);const W=F.toLngLat(),$=d.project(W.lng,W.lat),ie=s.fromLngLat(W);ie.x+=Jp;const re=ie.toLngLat(),ee=d.project(re.lng,re.lat),ae=jI(ee.x-$.x,ee.y-$.y,D),de=s.fromLngLat(W);de.y+=Jp;const ye=de.toLngLat(),De=d.project(ye.lng,ye.lat),Ie=jI(De.x-$.x,De.y-$.y,D),Re=Math.abs(ae.x)/Math.abs(Ie.y),$e=Pe.mat4.identity([]);Pe.mat4.rotateZ($e,$e,-D*(1-(z?0:C)));const Oe=Pe.mat4.identity([]);return Pe.mat4.scale(Oe,Oe,[1,1-(1-Re)*C,1]),Oe[4]=-Ie.x/Ie.y*C,Pe.mat4.rotateZ(Oe,Oe,D),Pe.mat4.multiply(Oe,$e,Oe),Oe}(l.projection,0,l.center,o,n),g=VI(l);return Pe.mat4.scale(u,u,[g,g,1]),u}function VI(l){const n=l.projection,o=r1(l.projection,l.zoom,l.width,l.height),u=EM(n,l.center),g=EM(n,Ji.convert(n.center));return Math.pow(2,u*o+(1-o)*g)}function r1(l,n,o,u,g=1/0){const d=l.range;if(!d)return 0;const v=Math.min(g,Math.max(o,u)),E=Math.log(v/1024)/Math.LN2;return Kt(d[0]+E,d[1]+E,n)}const Jp=1/4e4;function EM(l,n){const o=gt(n.lat,-85.051129,Mr),u=new Ji(n.lng-180*Jp,o),g=new Ji(n.lng+180*Jp,o),d=l.project(u.lng,o),v=l.project(g.lng,o),E=s.fromLngLat(u),C=s.fromLngLat(g),z=v.x-d.x,w=v.y-d.y,R=C.x-E.x,L=C.y-E.y,A=Math.sqrt((R*R+L*L)/(z*z+w*w));return Math.log(A)/Math.LN2}function jI(l,n,o){const u=Math.cos(o),g=Math.sin(o);return{x:l*u-n*g,y:l*g+n*u}}function GI(l,n,o){Pe.mat4.identity(l),Pe.mat4.rotateZ(l,l,Mn(n[2])),Pe.mat4.rotateX(l,l,Mn(n[0])),Pe.mat4.rotateY(l,l,Mn(n[1])),Pe.mat4.scale(l,l,o),Pe.mat4.multiply(l,l,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function a1(l,n,o,u,g,d,v,E){const C=[o[0]-n[0],o[1]-n[1],0],z=[u[0]-n[0],u[1]-n[1],0];if(Pe.vec3.length(C)<1e-12||Pe.vec3.length(z)<1e-12)return Pe.quat.identity(l);const w=Pe.vec3.cross([],C,z);Pe.vec3.normalize(w,w),Pe.vec3.subtract(z,u,n),C[2]=(d-g)*E,z[2]=(v-g)*E;const R=C;return Pe.vec3.cross(R,C,z),Pe.vec3.normalize(R,R),Pe.quat.rotationTo(l,w,R)}function MM(l,n,o=!1){const u=mo(n.zoom),g=function(d,v,E){const C=v.worldSize,z=[d[12],d[13],d[14]],w=Ra(z[1]/C),R=Ro(z[0]/C),L=Pe.mat4.identity([]),A=po(1,w)*C,D=po(1,0)*C*Gu(w,v.zoom),F=1/ca(C);let W=D*F;if(E){const ee=r1(v.projection,v.zoom,v.width,v.height,1024);W=F*v.projection.pixelSpaceConversion(v.center.lat,C,ee)}const $=Qc(w,R);Pe.vec3.add($,$,Pe.vec3.scale([],Pe.vec3.normalize([],$),A*W*z[2]));const ie=function(ee){const ae=[ee[0],ee[1],ee[2]];let de=[0,1,0];const ye=Pe.vec3.cross([],de,ae);return Pe.vec3.cross(de,ae,ye),Pe.vec3.squaredLength(de)===0&&(de=[0,1,0],Pe.vec3.cross(ye,ae,de)),Pe.vec3.normalize(ye,ye),Pe.vec3.normalize(de,de),Pe.vec3.normalize(ae,ae),[ye[0],ye[1],ye[2],0,de[0],de[1],de[2],0,ae[0],ae[1],ae[2],0,ee[0],ee[1],ee[2],1]}($);Pe.mat4.scale(L,L,[W,W,W*A]),Pe.mat4.translate(L,L,[-z[0],-z[1],-z[2]]);const re=Pe.mat4.multiply([],v.globeMatrix,ie);return Pe.mat4.multiply(re,re,L),Pe.mat4.multiply(re,re,d),re}(l,n,o);if(u>0){const d=function(v,E){const C=E.worldSize,z=po(1,0)*C*Gu(E.center.lat,E.zoom)/ca(C),w=po(1,E.center.lat)*C,R=Pe.mat4.identity([]);return Pe.mat4.rotateY(R,R,Mn(E.center.lng)),Pe.mat4.rotateX(R,R,Mn(E.center.lat)),Pe.mat4.translate(R,R,[0,0,fo]),Pe.mat4.scale(R,R,[z,z,z*w]),Pe.mat4.translate(R,R,[E.point.x-.5*C,E.point.y-.5*C,0]),Pe.mat4.multiply(R,R,v),Pe.mat4.multiply(R,E.globeMatrix,R)}(l,n);return function(v,E,C){const z=(D,F,W)=>{const $=Pe.vec3.length(D),ie=Pe.vec3.length(F),re=ea(D,F,W);return Pe.vec3.scale(re,re,1/Pe.vec3.length(re)*oi($,ie,W))},w=z([v[0],v[1],v[2]],[E[0],E[1],E[2]],C),R=z([v[4],v[5],v[6]],[E[4],E[5],E[6]],C),L=z([v[8],v[9],v[10]],[E[8],E[9],E[10]],C),A=ea([v[12],v[13],v[14]],[E[12],E[13],E[14]],C);return[w[0],w[1],w[2],0,R[0],R[1],R[2],0,L[0],L[1],L[2],0,A[0],A[1],A[2],1]}(g,d,u)}return g}function HI(l,n,o,u){const g=Rn.projectAabbCorners(u,o);let d=Number.MAX_VALUE,v=-1;for(let z=0;z<g.length;++z){const w=g[z];w[0]=(.5*w[0]+.5)*n.width,w[1]=(.5-.5*w[1])*n.height,w[2]<d&&(v=z,d=w[2])}const E=z=>new ke(g[z][0],g[z][1]);let C;switch(v){case 0:case 6:C=[E(1),E(5),E(4),E(7),E(3),E(2),E(1)];break;case 1:case 7:C=[E(0),E(4),E(5),E(6),E(2),E(3),E(0)];break;case 3:case 5:C=[E(1),E(0),E(4),E(7),E(6),E(2),E(1)];break;default:C=[E(1),E(5),E(6),E(7),E(3),E(0),E(1)]}if(ue(l,C))return d}const CB=sr([{name:"a_pos_3f",components:3,type:"Float32"}]),RB=sr([{name:"a_color_3f",components:3,type:"Float32"}]),IB=sr([{name:"a_color_4f",components:4,type:"Float32"}]),DB=sr([{name:"a_uv_2f",components:2,type:"Float32"}]),PB=sr([{name:"a_normal_3f",components:3,type:"Float32"}]),LB=sr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),OB=sr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),qI={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class o1{constructor(n,o,u,g){this.message=(n?`${n}: `:"")+u,g&&(this.identifier=g),o!=null&&o.__line__&&(this.line=o.__line__)}}function WI(l,n){const o=l.indexOf("://")===-1;try{return new URL(l,o&&n?"http://example.com":void 0),!0}catch{return!1}}class $I{constructor(n,o){this.feature=n,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class XI{constructor(){this.instancedDataArray=new Yc,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class TM{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.projection=n.projection,this.index=n.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(n,o){}populate(n,o,u,g){this.tileToMeter=i(u);const d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:v,id:E,index:C,sourceLayerIndex:z}of n){const w=E??(v.properties&&v.properties.hasOwnProperty("id")?v.properties.id:void 0),R=Z(v,d);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),R,u))continue;const L={id:w,sourceLayerIndex:z,index:C,geometry:d?R.geometry:q(v,u,g),properties:v.properties,type:v.type,patterns:{}},A=this.addFeature(L,L.geometry,R);A&&o.featureIndex.insert(v,L.geometry,C,z,this.index,this.instancesPerModel[A].instancedDataArray.length,yn/32)}this.lookup=null}update(n,o,u,g){for(const d in this.instancesPerModel){const v=this.instancesPerModel[d];for(const E in n)v.idToFeaturesIndex.hasOwnProperty(E)&&(this.evaluate(v.features[v.idToFeaturesIndex[E]],n[E],v,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let n=!1;for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];for(const g of u.features){const d=this.layers[0],v=g.feature,E=this.canonical,C=d.paint.get("model-rotation").evaluate(v,{},E),z=d.paint.get("model-scale").evaluate(v,{},E),w=d.paint.get("model-translation").evaluate(v,{},E);Pe.vec3.exactEquals(g.rotation,C)&&Pe.vec3.exactEquals(g.scale,z)&&Pe.vec3.exactEquals(g.translation,w)||(this.evaluate(g,g.featureStates,u,!0),n=!0)}}return n}updateReplacement(n,o,u,g){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const d=o.getReplacementRegionsForTile(n.toUnwrapped(),!0);if(bg(this.activeReplacements,d))return!1;this.activeReplacements=d;let v=!1;for(const E in this.instancesPerModel){const C=this.instancesPerModel[E],z=C.instancedDataArray;for(const w of C.features){const R=w.instancedDataOffset,L=w.instancedDataCount;for(let A=0;A<L;A++){const D=16*(A+R);let F=z.float32[D+0];const W=F>yn;F=W?F-yn:F;const $=Math.floor(F),ie=z.float32[D+1];let re=!1;for(const ee of this.activeReplacements)if(!rv(ee,u,qI.Model,g)&&!(ee.min.x>$||$>ee.max.x||ee.min.y>ie||ie>ee.max.y)&&(re=Rb(ix($,ie,n.canonical,ee.footprintTileId.canonical),ee.footprint),re))break;z.float32[D]=re?F+yn:F,v=v||re!==W}}}return v}isEmpty(){for(const n in this.instancesPerModel)if(this.instancesPerModel[n].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(n){if(!this.uploaded)for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=n.createVertexBuffer(u.instancedDataArray,LB.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const n=this.layers[0].modelManager;if(n&&this.modelUris)for(const o of this.modelUris)n.removeModel(o,"")}addFeature(n,o,u){const g=this.layers[0],d=g.layout.get("model-id").evaluate(u,{},this.canonical);if(!d)return Wn(`modelId is not evaluated for layer ${g.id} and it is not going to get rendered.`),d;WI(d,!1)&&(this.modelUris.includes(d)||this.modelUris.push(d)),this.instancesPerModel[d]||(this.instancesPerModel[d]=new XI);const v=this.instancesPerModel[d],E=v.instancedDataArray,C=new $I(u,E.length);for(const z of o)for(const w of z){if(w.x<0||w.x>=yn||w.y<0||w.y>=yn)continue;const R=(this.lookupDim-1)/yn,L=this.lookupDim*(w.y*R|0)+w.x*R|0;if(this.lookup){if(this.lookup[L]!==0)continue;this.lookup[L]=1}this.instanceCount++;const A=E.length;E.resize(A+1),v.instancesEvaluatedElevation.push(0),E.float32[16*A]=w.x,E.float32[16*A+1]=w.y}return C.instancedDataCount=v.instancedDataArray.length-C.instancedDataOffset,C.instancedDataCount>0&&(n.id&&(v.idToFeaturesIndex[n.id]=v.features.length),v.features.push(C),this.evaluate(C,{},v,!1)),d}getModelUris(){return this.modelUris}evaluate(n,o,u,g){const d=this.layers[0],v=n.feature,E=this.canonical,C=n.rotation=d.paint.get("model-rotation").evaluate(v,o,E),z=n.scale=d.paint.get("model-scale").evaluate(v,o,E),w=n.translation=d.paint.get("model-translation").evaluate(v,o,E),R=d.paint.get("model-color").evaluate(v,o,E);R.a=d.paint.get("model-color-mix-intensity").evaluate(v,o,E);const L=[];this.maxVerticalOffset<w[2]&&(this.maxVerticalOffset=w[2]),this.maxScale=Math.max(Math.max(this.maxScale,z[0]),Math.max(z[1],z[2])),GI(L,C,z);const A=Math.round(100*R.a)+R.b/1.05;for(let D=0;D<n.instancedDataCount;++D){const F=n.instancedDataOffset+D,W=16*F,$=u.instancedDataArray.float32;let ie=0;g&&(ie=$[W+6]-u.instancesEvaluatedElevation[F]);const re=0|$[W+1];$[W]=(0|$[W])+R.r/1.05,$[W+1]=re+R.g/1.05,$[W+2]=A,$[W+3]=1/(E.z>10?this.tileToMeter:i(E,re)),$[W+4]=w[0],$[W+5]=w[1],$[W+6]=w[2]+ie,$[W+7]=L[0],$[W+8]=L[1],$[W+9]=L[2],$[W+10]=L[4],$[W+11]=L[5],$[W+12]=L[6],$[W+13]=L[8],$[W+14]=L[9],$[W+15]=L[10],u.instancesEvaluatedElevation[F]=w[2]}}}let ZI,YI;Ln(TM,"ModelBucket",{omit:["layers"]}),Ln(XI,"PerModelAttributes"),Ln($I,"ModelFeature");const Lg=64,bv={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function KI(l,n,o,u,g,d,v,E,C,z=!1){const w=o.zoom,R=o.project(u),L=Gu(u.lat,w),A=1/L;Pe.mat4.identity(l),Pe.mat4.translate(l,l,[R.x+v[0]*A,R.y+v[1]*A,v[2]]);let D=1,F=1;const W=o.worldSize;if(z){if(o.projection.name==="mercator"){let ee=0;o.elevation&&(ee=o.elevation.getAtPointOrZero(new s(R.x/W,R.y/W),0));const ae=Pe.vec4.transformMat4([],[R.x,R.y,ee,1],o.projMatrix)[3]/o.cameraToCenterDistance;D=ae,F=ae*Gu(o.center.lat,w)}else if(o.projection.name==="globe"){const ee=MM(l,o),ae=Pe.mat4.multiply([],o.projMatrix,ee),de=[0,0,0,1];Pe.vec4.transformMat4(de,de,ae);const ye=de[3]/o.cameraToCenterDistance,De=mo(w),Ie=o.projection.pixelsPerMeter(u.lat,W)*Gu(u.lat,w),Re=o.projection.pixelsPerMeter(o.center.lat,W)*Gu(o.center.lat,w);D=ye/oi(Ie,gf(o.center.lat),De),F=ye*L/Ie,D*=Re,F*=Re}}else D=A;Pe.mat4.scale(l,l,[D,D,F]);const $=[...l],ie=n.orientation,re=[];if(GI(re,[ie[0]+g[0],ie[1]+g[1],ie[2]+g[2]],d),Pe.mat4.multiply(l,$,re),E&&o.elevation){let ee=0;const ae=[];if(C&&o.elevation){ee=function(De,Ie,Re,$e,Oe){const Ye=Ie.elevation;if(!Ye)return 0;const tt=Rn.projectAabbCorners(Re,$e),Je=po(1,Oe.lat)*Ie.worldSize,rt=function(Hn,In){const kn=[0,0,1],yi=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ri of yi){const zi=Hn[Ri.corners[0]],ki=Hn[Ri.corners[1]],$i=Hn[Ri.corners[2]],Zi=[ki[0]-zi[0],ki[1]-zi[1],In*(ki[2]-zi[2])],zr=Pe.vec3.cross(Zi,Zi,[$i[0]-zi[0],$i[1]-zi[1],In*($i[2]-zi[2])]);Pe.vec3.normalize(zr,zr),Ri.dotProductWithUp=Pe.vec3.dot(zr,kn)}return yi.sort((Ri,zi)=>Ri.dotProductWithUp-zi.dotProductWithUp),yi[0].corners}(tt,Je),ct=tt[rt[0]],yt=tt[rt[1]],st=tt[rt[2]],Bt=tt[rt[3]],Qt=Ye.getAtPointOrZero(new s(ct[0]/Ie.worldSize,ct[1]/Ie.worldSize),0),Nt=Ye.getAtPointOrZero(new s(yt[0]/Ie.worldSize,yt[1]/Ie.worldSize),0),An=Ye.getAtPointOrZero(new s(st[0]/Ie.worldSize,st[1]/Ie.worldSize),0),xn=Ye.getAtPointOrZero(new s(Bt[0]/Ie.worldSize,Bt[1]/Ie.worldSize),0),cn=(Qt+xn)/2,nn=(Nt+An)/2;return cn>nn?Nt<An?a1(De,yt,Bt,ct,Nt,xn,Qt,Je):a1(De,st,ct,Bt,An,Qt,xn,Je):Qt<xn?a1(De,ct,yt,st,Qt,Nt,An,Je):a1(De,Bt,st,yt,xn,An,Nt,Je),Math.max(cn,nn)}(ae,o,n.aabb,l,u);const de=Pe.mat4.fromQuat([],ae),ye=Pe.mat4.multiply([],de,re);Pe.mat4.multiply(l,$,ye)}else ee=o.elevation.getAtPointOrZero(new s(R.x/W,R.y/W),0);ee!==0&&(l[14]+=ee)}}function Dx(l,n,o=!1){l.uploaded||(l.gfxTexture=new wM(n,l.image,o?n.gl.R8:n.gl.RGBA8,{useMipmap:l.sampler.minFilter>=n.gl.NEAREST_MIPMAP_NEAREST}),l.uploaded=!0,l.image=null)}function zB(l,n,o){l.indexBuffer=n.createIndexBuffer(l.indexArray,!1,!0),l.vertexBuffer=n.createVertexBuffer(l.vertexArray,CB.members,!1,!0),l.normalArray&&(l.normalBuffer=n.createVertexBuffer(l.normalArray,PB.members,!1,!0)),l.texcoordArray&&(l.texcoordBuffer=n.createVertexBuffer(l.texcoordArray,DB.members,!1,!0)),l.colorArray&&(l.colorBuffer=n.createVertexBuffer(l.colorArray,(l.colorArray.bytesPerElement===12?RB:IB).members,!1,!0)),l.featureArray&&(l.pbrBuffer=n.createVertexBuffer(l.featureArray,OB.members,!0)),l.segments=Jr.simpleSegment(0,0,l.vertexArray.length,l.indexArray.length);const u=l.material;u.pbrMetallicRoughness.baseColorTexture&&Dx(u.pbrMetallicRoughness.baseColorTexture,n),u.pbrMetallicRoughness.metallicRoughnessTexture&&Dx(u.pbrMetallicRoughness.metallicRoughnessTexture,n),u.normalTexture&&Dx(u.normalTexture,n),u.occlusionTexture&&Dx(u.occlusionTexture,n,o),u.emissionTexture&&Dx(u.emissionTexture,n)}function AM(l,n,o){if(l.meshes)for(const u of l.meshes)zB(u,n,o);if(l.children)for(const u of l.children)AM(u,n,o)}function s1(l){if(l.meshes)for(const n of l.meshes)n.indexArray.destroy(),n.vertexArray.destroy(),n.colorArray&&n.colorArray.destroy(),n.normalArray&&n.normalArray.destroy(),n.texcoordArray&&n.texcoordArray.destroy(),n.featureArray&&n.featureArray.destroy();if(l.children)for(const n of l.children)s1(n)}function CM(l){if(l.meshes)for(const o of l.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((n=o.material).pbrMetallicRoughness.baseColorTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),n.pbrMetallicRoughness.metallicRoughnessTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),n.normalTexture&&n.normalTexture.gfxTexture&&n.normalTexture.gfxTexture.destroy(),n.emissionTexture&&n.emissionTexture.gfxTexture&&n.emissionTexture.gfxTexture.destroy(),n.occlusionTexture&&n.occlusionTexture.gfxTexture&&n.occlusionTexture.gfxTexture.destroy()));var n;if(l.children)for(const o of l.children)CM(o)}class wv{constructor(n,o,u){this._demTile=n,this._dem=this._demTile.dem,this._scale=o,this._offset=u}static create(n,o,u){const g=u||n.findDEMTileFor(o);if(!g||!g.dem)return;const d=g.dem,v=g.tileID,E=1<<o.canonical.z-v.canonical.z;return new wv(g,d.dim/yn/E,[(o.canonical.x/E-v.canonical.x)*d.dim,(o.canonical.y/E-v.canonical.y)*d.dim])}tileCoordToPixel(n,o){const u=o*this._scale+this._offset[1],g=Math.floor(n*this._scale+this._offset[0]),d=Math.floor(u);return new ke(g,d)}getElevationAt(n,o,u,g){const d=n*this._scale+this._offset[0],v=o*this._scale+this._offset[1],E=Math.floor(d),C=Math.floor(v),z=this._dem;return g=!!g,u?oi(oi(z.get(E,C,g),z.get(E,C+1,g),v-C),oi(z.get(E+1,C,g),z.get(E+1,C+1,g),v-C),d-E):z.get(E,C,g)}getElevationAtPixel(n,o,u){return this._dem.get(n,o,!!u)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*po(1,n)*this._dem.stride}}const RM=new Float32Array(262144),Og=new Uint8Array(262144);function JI(l){let n=0;if(l.meshes)for(const o of l.meshes)n=Math.max(n,o.aabb.max[2]);if(l.children)for(const o of l.children)n=Math.max(n,JI(o));return n}function QI(l,n,o){if(l.meshes)for(const u of l.meshes){if(u.aabb.min[0]===1/0)continue;const g=Rn.applyTransform(u.aabb,l.matrix);o.insert(n,g.min[0],g.min[1],g.max[0],g.max[1])}if(l.children)for(const u of l.children)QI(u,n,o)}const eD=["","wall","door","roof","window","lamp","logo"];class tD{constructor(n){this.node=n,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:n.id,geometry:[],properties:{height:JI(n)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Rn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let n=0;const o=new Rn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==n&&(u.transformedAabb=Rn.applyTransformFast(u.aabb,this.node.matrix),o.encapsulate(u.transformedAabb)),n++;this.aabb=o}return this.aabb}}class l1{constructor(n,o,u,g,d,v,E){this.id=u,this.layers=n,this.layerIds=this.layers.map(C=>C.fqid),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.modelTraits|=bv.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,g&&(this.modelTraits|=bv.HasMapboxMeshFeatures),d&&(this.modelTraits|=bv.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=v,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const C of o)this.nodesInfo.push(new tD(C)),QI(C,E.featureIndexArray.length,E.grid),E.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,E.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(n,o){for(const u of this.getNodesInfo()){const g=u.node;g.footprint&&o.push({footprint:g.footprint,id:n})}}update(n){const o=Object.keys(n).length!==0;if(o&&!this.stateDependentLayers.length)return;const u=o?this.stateDependentLayers:this.layers;if(!Fi(n,this.states))for(const g of u)this.evaluate(g,n);this.states=structuredClone(n)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(n){if(!this.needsUpload)return;const o=this.getNodesInfo();for(const u of o){const g=u.node;this.uploaded?this.updatePbrBuffer(g):AM(g,n,!0)}for(const u of o)s1(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(n){let o=!1;if(!n.meshes)return o;for(const u of n.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),o=!0);return o}needsReEvaluation(n,o,u){const g=n.transform.projectionOptions,d=n.style.getBrightness(),v=this.brightness!==d;if(!this.uploaded||this.dirty||g.name!==this.projection.name||Px(u.paint.get("model-color").value,v)||Px(u.paint.get("model-color-mix-intensity").value,v)||Px(u.paint.get("model-roughness").value,v)||Px(u.paint.get("model-emissive-strength").value,v)||Px(u.paint.get("model-height-based-emissive-strength-multiplier").value,v)){this.projection=g,this.brightness=d;const E=this.getNodesInfo();for(const C of E)C.state=null;return!0}return!1}evaluateScale(n,o){if(n.transform.zoom===this.zoom)return;this.zoom=n.transform.zoom;const u=this.getNodesInfo(),g=this.id.canonical;for(const d of u){const v=d.feature;d.evaluatedScale=o.paint.get("model-scale").evaluate(v,{},g)}}evaluate(n,o){const u=this.getNodesInfo();for(const g of u){if(!g.node.meshes)continue;const d=g.feature,v=o&&o[d.id];if(Fi(v,g.state))continue;g.state=structuredClone(v);const E=g.node.meshes&&g.node.meshes[0].featureData,C=g.evaluatedColor[2],z=g.evaluatedRMEA[2],w=this.id.canonical;if(g.hasTranslucentParts=!1,E){for(let R=0;R<eD.length;R++){const L=eD[R];L.length&&(d.properties.part=L);const A=n.paint.get("model-color").evaluate(d,v,w).toRenderColor(null),D=n.paint.get("model-color-mix-intensity").evaluate(d,v,w);g.evaluatedColor[R]=[A.r,A.g,A.b,D],g.evaluatedRMEA[R][0]=n.paint.get("model-roughness").evaluate(d,v,w),g.evaluatedRMEA[R][2]=n.paint.get("model-emissive-strength").evaluate(d,v,w),g.evaluatedRMEA[R][3]=A.a,g.emissionHeightBasedParams[R]=n.paint.get("model-height-based-emissive-strength-multiplier").evaluate(d,v,w),!g.hasTranslucentParts&&A.a<1&&(g.hasTranslucentParts=!0)}delete d.properties.part,FB(g,C!==g.evaluatedColor[2]||z!==g.evaluatedRMEA[2],this.modelTraits)}else g.evaluatedRMEA[0][2]=n.paint.get("model-emissive-strength").evaluate(d,v,w);g.evaluatedScale=n.paint.get("model-scale").evaluate(d,v,w),this.updatePbrBuffer(g.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(n,o,u,g){const d=n.findDEMTileFor(u);if(d&&(d.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;const v=wv.create(n,u,d);if(!v)return;this.modelTraits&bv.HasMapboxMeshFeatures&&this.updateDEM(n,v,u,g);for(const E of this.getNodesInfo()){const C=E.node;if(!C.footprint||!C.footprint.vertices||!C.footprint.vertices.length)continue;const z=C.footprint.vertices;let w=v.getElevationAt(z[0].x,z[0].y,!0,!0);for(let R=1;R<z.length;R++)w=Math.min(w,v.getElevationAt(z[R].x,z[R].y,!0,!0));C.elevation=w}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=o}}updateDEM(n,o,u,g){let d=o._dem._modifiedForSources[g];if(d===void 0&&(o._dem._modifiedForSources[g]=[],d=o._dem._modifiedForSources[g]),d.includes(u.canonical))return;const v=o._dem.dim;d.push(u.canonical);let E=!1;for(const C of this.getNodesInfo()){const z=C.node;if(!z.footprint||!z.footprint.grid)continue;const w=z.footprint.grid,R=o.tileCoordToPixel(w.min.x,w.min.y),L=o.tileCoordToPixel(w.max.x,w.max.y),A=Math.min(Math.min(v-L.y,R.x),Math.min(R.y,v-L.x));if(A<0)continue;const D=gt(A,2,5);let F=Math.max(0,R.x-D),W=Math.max(0,R.y-D),$=Math.min(L.x+D,v-1),ie=Math.min(L.y+D,v-1);for(let de=W;de<=ie;++de)for(let ye=F;ye<=$;++ye)Og[de*v+ye]=255;let re=0,ee=0;for(let de=0;de<w.cellsY;++de)for(let ye=0;ye<w.cellsX;++ye){if(!w.cells[de*w.cellsX+ye])continue;const De=o.tileCoordToPixel(w.min.x+ye/w.xScale,w.min.y+de/w.yScale),Ie=o.tileCoordToPixel(w.min.x+(ye+1)/w.xScale,w.min.y+(de+1)/w.yScale);for(let Re=De.y;Re<=Math.min(Ie.y+1,v-1);++Re)for(let $e=De.x;$e<=Math.min(Ie.x+1,v-1);++$e)Og[Re*v+$e]===255&&(Og[Re*v+$e]=0,re+=o.getElevationAtPixel($e,Re),ee++)}const ae=re/ee;F=Math.max(1,R.x-D),W=Math.max(1,R.y-D),$=Math.min(L.x+D,v-2),ie=Math.min(L.y+D,v-2),E=!0;for(let de=W;de<=ie;++de)for(let ye=F;ye<=$;++ye)Og[de*v+ye]===0&&(RM[de*v+ye]=o._dem.set(ye,de,ae));for(let de=1;de<D;++de){F=Math.max(1,R.x-de),W=Math.max(1,R.y-de),$=Math.min(L.x+de,v-2),ie=Math.min(L.y+de,v-2);for(let ye=W;ye<=ie;++ye)for(let De=F;De<=$;++De){const Ie=ye*v+De;if(Og[Ie]===255){let Re=0,$e=0,Oe=-1,Ye=-1;for(let tt=-1;tt<=1;++tt)for(let Je=-1;Je<=1;++Je){const rt=(ye+tt)*v+De+Je;if(Og[rt]>=de)continue;const ct=RM[rt],yt=Math.abs(ct);yt>$e&&(Re=ct,$e=yt,Oe=Je,Ye=tt)}if($e>.1){const tt=1-(de+.5*Math.abs(Oe*Ye))/D;let Je=o._dem.get(De,ye)+Re*tt;const rt=o._dem.get(De+Oe,ye+Ye),ct=o._dem.get(De-Oe,ye-Ye,!0);(Je-rt)*(Je-ct)>0&&(Je=(rt+ct)/2),RM[Ie]=o._dem.set(De,ye,Je),Og[Ie]=de}}}}}E&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=je.now())}getNodesInfo(){return this.nodesInfo}destroy(){const n=this.getNodesInfo();for(const o of n)s1(o.node),CM(o.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(n,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(n.toUnwrapped()),g=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){const v=g[d].node;g[d].hiddenByReplacement=!!v.footprint&&!u.find(E=>E.footprint===v.footprint)}}getHeightAtTileCoord(n,o){const u=this.getNodesInfo(),g=[],d=[0,0,0],v=Pe.mat4.identity([]);for(let E=0;E<this.nodesInfo.length;E++){const C=u[E],z=C.node.meshes[0],w=z.transformedAabb;if(n<w.min[0]||o<w.min[1]||n>w.max[0]||o>w.max[1])continue;if(C.node.hidden===!0)return{height:1/0,maxHeight:C.feature.properties.height,hidden:!1,verticalScale:C.evaluatedScale[2]};Pe.mat4.invert(v,C.node.matrix),d[0]=n,d[1]=o,Pe.vec3.transformMat4(d,d,v);const R=(d[0]-z.aabb.min[0])/(z.aabb.max[0]-z.aabb.min[0])*Lg|0,L=Math.min(63,(d[1]-z.aabb.min[1])/(z.aabb.max[1]-z.aabb.min[1])*Lg|0)*Lg+Math.min(63,R),A=z.heightmap[L];if(!(A<0&&C.node.footprint))return C.hiddenByReplacement?void 0:{height:A,maxHeight:C.feature.properties.height,hidden:!1,verticalScale:C.evaluatedScale[2]};if(C.node.footprint.grid.query(new ke(n,o),new ke(n,o),g),g.length>0)return{height:void 0,maxHeight:C.feature.properties.height,hidden:C.hiddenByReplacement,verticalScale:C.evaluatedScale[2]}}}}function Px(l,n){return!l.isLightConstant&&n}function kB(l,n,o,u,g,d,v,E){let C=(61440&n|(61440&n)>>4)>>8,z=(3840&n|(3840&n)>>4)>>4,w=240&n|(240&n)>>4;o[3]>0&&(C=oi(C,255*o[0],o[3]),z=oi(z,255*o[1],o[3]),w=oi(w,255*o[2],o[3]));const R=C<<8|z,L=w<<8|Math.floor(255*u[3]),A=function(de){const ye=gt(de,0,2);return Math.min(Math.round(.5*ye*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],D=gt(g[0],0,1),F=gt(g[1],0,1),W=gt(g[2],0,1),$=gt(g[3],0,1);let ie,re,ee,ae;if(D!==F&&v!==d&&F!==D){const de=v-d;re=1/(de*(F-D)),ee=-(d+de*D)/(de*(F-D));const ye=gt(g[4],-1,1);ae=Math.pow(10,ye),ie=255*W<<8|255*$}else ie=65535,re=0,ee=1,ae=1;if(l.emplaceBack(R,L,A,ie,re,ee,ae),E){const de=E.length;E.clear();for(let ye=0;ye<de;ye++)E.emplaceBack(R,L,A,ie,re,ee,ae)}}function FB(l,n,o){const u=l.node;let g=0;const d=o&bv.HasMeshoptCompression;for(const v of u.meshes){if(u.lights&&u.lightMeshIndex===g||!v.featureData)continue;v.featureArray=new qh,v.featureArray.reserve(v.featureData.length);let E=n;for(const C of v.featureData){const z=d?65535&C:C>>16&65535,w=d?C>>16&65535:65535&C,R=(15&w)<8?15&w:0,L=l.evaluatedRMEA[R],A=l.evaluatedColor[R],D=l.emissionHeightBasedParams[R];let F;if(E&&R===2&&u.lights&&(F=new qh,F.resize(10*u.lights.length)),kB(v.featureArray,z,A,L,D,v.aabb.min[2],v.aabb.max[2],F),F&&E){E=!1;const W=u.meshes[u.lightMeshIndex];W.featureArray=F,W.featureArray._trim()}}v.featureArray._trim(),g++}}function nD(l,n,o,u){const g=1<<l.z;n.lat=Ra((u/yn+l.y)/g),n.lng=Ro((o/yn+l.x)/g)}Ln(l1,"Tiled3dModelBucket",{omit:["layers"]}),Ln(tD,"Tiled3dModelFeature");const NB={circle:class extends Ca{constructor(l,n,o,u){super(l,{layout:tn||(tn=new $r({"circle-sort-key":new Dn(bt.layout_circle["circle-sort-key"]),"circle-elevation-reference":new hn(bt.layout_circle["circle-elevation-reference"]),visibility:new hn(bt.layout_circle.visibility)})),paint:dt||(dt=new $r({"circle-radius":new Dn(bt.paint_circle["circle-radius"]),"circle-color":new Dn(bt.paint_circle["circle-color"]),"circle-blur":new Dn(bt.paint_circle["circle-blur"]),"circle-opacity":new Dn(bt.paint_circle["circle-opacity"]),"circle-translate":new hn(bt.paint_circle["circle-translate"]),"circle-translate-anchor":new hn(bt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new hn(bt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new hn(bt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Dn(bt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Dn(bt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Dn(bt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new hn(bt.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},n,o,u)}createBucket(l){return new fe(l)}queryRadius(l){const n=l;return jt("circle-radius",this,n)+jt("circle-stroke-width",this,n)+zt(this.paint.get("circle-translate"))}queryIntersectsFeature(l,n,o,u,g,d,v,E){const C=Dt(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,l.pixelToTileUnitsFactor),z=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o);return tu(l,u,d,v,E,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",C,z)}getProgramIds(){return["circle"]}getDefaultProgramParams(l,n,o){const u=eu(this);return{config:new wl(this,{zoom:n,lut:o}),defines:u,overrideFog:!1}}},heatmap:class extends Ca{createBucket(l){return new Wy(l)}constructor(l,n,o,u){super(l,{layout:G_||(G_=new $r({visibility:new hn(bt.layout_heatmap.visibility)})),paint:$y||($y=new $r({"heatmap-radius":new Dn(bt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Dn(bt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new hn(bt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ou(bt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new hn(bt.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},n,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(l){return jt("heatmap-radius",this,l)}queryIntersectsFeature(l,n,o,u,g,d,v,E){const C=this.paint.get("heatmap-radius").evaluate(n,o);return tu(l,u,d,v,E,!0,!0,new ke(0,0),C)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(l,n,o){return l==="heatmap"?{config:new wl(this,{zoom:n,lut:o}),overrideFog:!1}:{}}},hillshade:class extends Ca{constructor(l,n,o,u){super(l,{layout:gb||(gb=new $r({visibility:new hn(bt.layout_hillshade.visibility)})),paint:nu||(nu=new $r({"hillshade-illumination-direction":new hn(bt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new hn(bt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new hn(bt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new hn(bt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new hn(bt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new hn(bt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new hn(bt.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},n,o,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(l,n,o){return{overrideFog:!1}}},fill:class extends Ca{constructor(l,n,o,u){super(l,{layout:Sb||(Sb=new $r({"fill-sort-key":new Dn(bt.layout_fill["fill-sort-key"]),visibility:new hn(bt.layout_fill.visibility),"fill-elevation-reference":new hn(bt.layout_fill["fill-elevation-reference"])})),paint:Q_||(Q_=new $r({"fill-antialias":new hn(bt.paint_fill["fill-antialias"]),"fill-opacity":new Dn(bt.paint_fill["fill-opacity"]),"fill-color":new Dn(bt.paint_fill["fill-color"]),"fill-outline-color":new Dn(bt.paint_fill["fill-outline-color"]),"fill-translate":new hn(bt.paint_fill["fill-translate"]),"fill-translate-anchor":new hn(bt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Dn(bt.paint_fill["fill-pattern"]),"fill-emissive-strength":new hn(bt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Dn(bt.paint_fill["fill-z-offset"]),"fill-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},n,o,u)}getProgramIds(){const l=this.paint.get("fill-pattern"),n=l&&l.constantOr(1),o=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(l,n,o){return{config:new wl(this,{zoom:n,lut:o}),overrideFog:!1}}recalculate(l,n){super.recalculate(l,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new J_(l)}queryRadius(){return zt(this.paint.get("fill-translate"))}queryIntersectsFeature(l,n,o,u,g,d){return!l.queryGeometry.isAboveHorizon&&ge(pt(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,l.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends Ca{constructor(l,n,o,u){super(l,{layout:Eg||(Eg=new $r({visibility:new hn(bt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new hn(bt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:cv||(cv=new $r({"fill-extrusion-opacity":new hn(bt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Dn(bt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new hn(bt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new hn(bt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Dn(bt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Dn(bt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Dn(bt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new hn(bt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new hn(bt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new hn(bt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new hn(bt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new hn(bt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new hn(bt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new hn(bt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new hn(bt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new hn(bt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new hn(bt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Dn(bt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Dn(bt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new hn(bt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new hn(bt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new hn(bt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new hn(bt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Dn(bt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Dn(bt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new hn(bt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},n,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new lv(l)}queryRadius(){return zt(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(l,n,o,u,g,d,v,E,C){const z=Dt(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,l.pixelToTileUnitsFactor),w=this.paint.get("fill-extrusion-height").evaluate(n,o),R=this.paint.get("fill-extrusion-base").evaluate(n,o),L=[0,0],A=E&&d.elevation,D=d.elevation?d.elevation.exaggeration():1,F=l.tile.getBucket(this);if(A&&F instanceof lv){const ee=F.centroidVertexArray,ae=C+1;ae<ee.length&&(L[0]=ee.geta_centroid_pos0(ae),L[1]=ee.geta_centroid_pos1(ae))}if(L[0]===0&&L[1]===1)return!1;d.projection.name==="globe"&&(u=Xp([u],[new ke(0,0),new ke(yn,yn)],l.tileID.canonical).map(ee=>ee.polygon).flat());const W=A?E:null,[$,ie]=function(ee,ae,de,ye,De,Ie,Re,$e,Oe,Ye,tt){return ee.projection.name==="globe"?function(Je,rt,ct,yt,st,Bt,Qt,Nt,An,xn,cn){const nn=[],Hn=[],In=Je.projection.upVectorScale(cn,Je.center.lat,Je.worldSize).metersToTile,kn=[0,0,0,1],yi=[0,0,0,1],Ri=(ki,$i,Zi,zr)=>{ki[0]=$i,ki[1]=Zi,ki[2]=zr,ki[3]=1},zi=Tf();ct>0&&(ct+=zi),yt+=zi;for(const ki of rt){const $i=[],Zi=[];for(const zr of ki){const xr=zr.x+st.x,Mi=zr.y+st.y,_r=Je.projection.projectTilePoint(xr,Mi,cn),vr=Je.projection.upVector(cn,zr.x,zr.y);let Xr=ct,Ea=yt;if(Qt){const Na=cx(xr,Mi,ct,yt,Qt,Nt,An,xn);Xr+=Na.base,Ea+=Na.top}ct!==0?Ri(kn,_r.x+vr[0]*In*Xr,_r.y+vr[1]*In*Xr,_r.z+vr[2]*In*Xr):Ri(kn,_r.x,_r.y,_r.z),Ri(yi,_r.x+vr[0]*In*Ea,_r.y+vr[1]*In*Ea,_r.z+vr[2]*In*Ea),Pe.vec3.transformMat4(kn,kn,Bt),Pe.vec3.transformMat4(yi,yi,Bt),$i.push(new ru(kn[0],kn[1],kn[2])),Zi.push(new ru(yi[0],yi[1],yi[2]))}nn.push($i),Hn.push(Zi)}return[nn,Hn]}(ee,ae,de,ye,De,Ie,Re,$e,Oe,Ye,tt):Re?function(Je,rt,ct,yt,st,Bt,Qt,Nt,An){const xn=[],cn=[],nn=[0,0,0,1];for(const Hn of Je){const In=[],kn=[];for(const yi of Hn){const Ri=yi.x+yt.x,zi=yi.y+yt.y,ki=cx(Ri,zi,rt,ct,Bt,Qt,Nt,An);nn[0]=Ri,nn[1]=zi,nn[2]=ki.base,nn[3]=1,Pe.vec4.transformMat4(nn,nn,st),nn[3]=Math.max(nn[3],1e-5);const $i=new ru(nn[0]/nn[3],nn[1]/nn[3],nn[2]/nn[3]);nn[0]=Ri,nn[1]=zi,nn[2]=ki.top,nn[3]=1,Pe.vec4.transformMat4(nn,nn,st),nn[3]=Math.max(nn[3],1e-5);const Zi=new ru(nn[0]/nn[3],nn[1]/nn[3],nn[2]/nn[3]);In.push($i),kn.push(Zi)}xn.push(In),cn.push(kn)}return[xn,cn]}(ae,de,ye,De,Ie,Re,$e,Oe,Ye):function(Je,rt,ct,yt,st){const Bt=[],Qt=[],Nt=st[8]*rt,An=st[9]*rt,xn=st[10]*rt,cn=st[11]*rt,nn=st[8]*ct,Hn=st[9]*ct,In=st[10]*ct,kn=st[11]*ct;for(const yi of Je){const Ri=[],zi=[];for(const ki of yi){const $i=ki.x+yt.x,Zi=ki.y+yt.y,zr=st[0]*$i+st[4]*Zi+st[12],xr=st[1]*$i+st[5]*Zi+st[13],Mi=st[2]*$i+st[6]*Zi+st[14],_r=st[3]*$i+st[7]*Zi+st[15],vr=zr+Nt,Xr=xr+An,Ea=Mi+xn,Na=Math.max(_r+cn,1e-5),Ma=zr+nn,fa=xr+Hn,Da=Mi+In,qa=Math.max(_r+kn,1e-5);Ri.push(new ru(vr/Na,Xr/Na,Ea/Na)),zi.push(new ru(Ma/qa,fa/qa,Da/qa))}Bt.push(Ri),Qt.push(zi)}return[Bt,Qt]}(ae,de,ye,De,Ie)}(d,u,R,w,z,v,W,L,D,d.center.lat,l.tileID.canonical),re=l.queryGeometry;return function(ee,ae,de){let ye=1/0;ge(de,ae)&&(ye=Mg(de,ae[0]));for(let De=0;De<ae.length;De++){const Ie=ae[De],Re=ee[De];for(let $e=0;$e<Ie.length-1;$e++){const Oe=Ie[$e],Ye=[Oe,Ie[$e+1],Re[$e+1],Re[$e],Oe];ue(de,Ye)&&(ye=Math.min(ye,Mg(de,Ye)))}}return ye!==1/0&&ye}($,ie,re.isPointQuery()?re.screenBounds:re.screenGeometry)}},line:class extends Ca{constructor(l,n,o,u){const g=dv();super(l,g,n,o,u),g.layout&&(this.layout=new Lu(g.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof cs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(l,n){super.recalculate(l,n),this.paint._values["line-floorwidth"]=(()=>{if(nd)return nd;const o=dv();return nd=new vx(o.paint.properties["line-width"].specification),nd.useIntegerZoom=!0,nd})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new Cf(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(l,n,o){const u=Cg(this);return{config:new wl(this,{zoom:n,lut:o}),defines:u,overrideFog:!1}}queryRadius(l){const n=l,o=fv(jt("line-width",this,n),jt("line-gap-width",this,n)),u=jt("line-offset",this,n);return o/2+Math.abs(u)+zt(this.paint.get("line-translate"))}queryIntersectsFeature(l,n,o,u,g,d){if(l.queryGeometry.isAboveHorizon)return!1;const v=pt(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,l.pixelToTileUnitsFactor),E=l.pixelToTileUnitsFactor/2*fv(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),C=this.paint.get("line-offset").evaluate(n,o);return C&&(u=function(z,w){const R=[],L=new ke(0,0);for(let A=0;A<z.length;A++){const D=z[A],F=[];for(let W=0;W<D.length;W++){const $=D[W],ie=D[W+1],re=W===0?L:$.sub(D[W-1])._unit()._perp(),ee=W===D.length-1?L:ie.sub($)._unit()._perp(),ae=re._add(ee)._unit();ae._mult(1/(ae.x*ee.x+ae.y*ee.y)),F.push(ae._mult(w)._add($))}R.push(F)}return R}(u,C*l.pixelToTileUnitsFactor)),function(z,w,R){for(let L=0;L<w.length;L++){const A=w[L];if(z.length>=3){for(let D=0;D<A.length;D++)if(Be(z,A[D]))return!0}if(Ce(z,A,R))return!0}return!1}(v,u,E)}isTileClipped(){return!0}isDraped(l){return!this.hasElevatedBuckets}},symbol:e1,background:class extends Ca{constructor(l,n,o,u){super(l,{layout:AI||(AI=new $r({visibility:new hn(bt.layout_background.visibility)})),paint:CI||(CI=new $r({"background-pitch-alignment":new hn(bt.paint_background["background-pitch-alignment"]),"background-color":new hn(bt.paint_background["background-color"]),"background-pattern":new hn(bt.paint_background["background-pattern"]),"background-opacity":new hn(bt.paint_background["background-opacity"]),"background-emissive-strength":new hn(bt.paint_background["background-emissive-strength"]),"background-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},n,o,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(l,n,o){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:LI,"raster-particle":BI,sky:class extends Ca{constructor(l,n,o,u){super(l,{layout:kI||(kI=new $r({visibility:new hn(bt.layout_sky.visibility)})),paint:FI||(FI=new $r({"sky-type":new hn(bt.paint_sky["sky-type"]),"sky-atmosphere-sun":new hn(bt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new hn(bt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new hn(bt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new hn(bt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ou(bt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new hn(bt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new hn(bt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new hn(bt.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},n,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=vf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(l,n){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),g=!u,d=l.style.light,v=d.properties.get("position");return g&&d.properties.get("anchor")==="viewport"&&Wn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),g?SM(v.azimuthal,90-v.polar,n):SM(u[0],90-u[1],n)}const o=this.paint.get("sky-gradient-center");return SM(o[0],90-o[1],n)}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}},slot:class extends Ca{constructor(l,n,o,u){super(l,{paint:NI||(NI=new $r({}))},n,null)}},model:class extends Ca{constructor(l,n,o,u){super(l,{layout:ZI||(ZI=new $r({visibility:new hn(bt.layout_model.visibility),"model-id":new Dn(bt.layout_model["model-id"])})),paint:YI||(YI=new $r({"model-opacity":new Dn(bt.paint_model["model-opacity"]),"model-rotation":new Dn(bt.paint_model["model-rotation"]),"model-scale":new Dn(bt.paint_model["model-scale"]),"model-translation":new Dn(bt.paint_model["model-translation"]),"model-color":new Dn(bt.paint_model["model-color"]),"model-color-mix-intensity":new Dn(bt.paint_model["model-color-mix-intensity"]),"model-type":new hn(bt.paint_model["model-type"]),"model-cast-shadows":new hn(bt.paint_model["model-cast-shadows"]),"model-receive-shadows":new hn(bt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new hn(bt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Dn(bt.paint_model["model-emissive-strength"]),"model-roughness":new Dn(bt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Dn(bt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new hn(bt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new hn(bt.paint_model["model-front-cutoff"]),"model-color-use-theme":new Dn({type:"string",default:"default","property-type":"data-driven"})}))},n,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new TM(l)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(l){return l instanceof l1?yn-1:0}queryIntersectsFeature(l,n,o,u,g,d){if(!this.modelManager)return!1;const v=this.modelManager,E=l.tile.getBucket(this);if(!(E&&E instanceof TM))return!1;for(const C in E.instancesPerModel){const z=E.instancesPerModel[C],w=n.id!==void 0?n.id:n.properties&&n.properties.hasOwnProperty("id")?n.properties.id:void 0;if(z.idToFeaturesIndex.hasOwnProperty(w)){const R=z.features[z.idToFeaturesIndex[w]],L=v.getModel(C,this.scope);if(!L)return!1;let A=Pe.mat4.create();const D=new Ji(0,0),F=E.canonical;let W=Number.MAX_VALUE;for(let $=0;$<R.instancedDataCount;++$){const ie=16*(R.instancedDataOffset+$),re=z.instancedDataArray.float32,ee=[re[ie+4],re[ie+5],re[ie+6]];nD(F,D,re[ie],0|re[ie+1]),KI(A,L,d,D,R.rotation,R.scale,ee,!1,!1,!1),d.projection.name==="globe"&&(A=MM(A,d));const ae=Pe.mat4.multiply([],d.projMatrix,A),de=l.queryGeometry,ye=HI(de.isPointQuery()?de.screenBounds:de.screenGeometry,d,ae,L.aabb);ye!=null&&(W=Math.min(ye,W))}return W!==Number.MAX_VALUE&&W}}return!1}_handleOverridablePaintPropertyUpdate(l,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven()||l!=="model-color"&&l!=="model-color-mix-intensity"&&l!=="model-rotation"&&l!=="model-scale"&&l!=="model-translation"&&l!=="model-emissive-strength")}_isPropertyZoomDependent(l){const n=this._transitionablePaint._values[l];return n!=null&&n.value!=null&&n.value.expression!=null&&n.value.expression instanceof $l}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ca{constructor(l,n,o,u){super(l,{layout:Yy||(Yy=new $r({"clip-layer-types":new hn(bt.layout_clip["clip-layer-types"]),"clip-layer-scope":new hn(bt.layout_clip["clip-layer-scope"])})),paint:Ky||(Ky=new $r({}))},n,o,u)}recalculate(l,n){super.recalculate(l,n)}createBucket(l){return new ev(l)}isTileClipped(){return!0}is3D(){return!0}}};class BB{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class UB{constructor(){this.tasks={},this.taskQueue=[],si(["process"],this),this.invoker=new BB(this.process),this.nextId=0}add(n,o){const u=this.nextId++,g=function({type:d,isSymbolTile:v,zoom:E}){return E=E||0,d==="message"?0:d!=="maybePrepare"||v?d!=="parseTile"||v?d==="parseTile"&&v?300-E:d==="maybePrepare"&&v?400-E:500:200-E:100-E}(o);if(g===0){try{n()}finally{}return null}return this.tasks[u]={fn:n,metadata:o,priority:g,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const o=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let n=null,o=1/0;for(let g=0;g<this.taskQueue.length;g++){const d=this.tasks[this.taskQueue[g]];d.priority<o&&(o=d.priority,n=g)}if(n===null)return null;const u=this.taskQueue[n];return this.taskQueue.splice(n,1),u}remove(){this.invoker.remove()}}class iD{constructor(n,o,u){this.target=n,this.parent=o,this.mapId=u,this.callbacks={},this.cancelCallbacks={},si(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new UB}send(n,o,u,g,d=!1,v){const E=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=v,this.callbacks[E]=u);const C=new Set;return this.target.postMessage({id:E,type:n,hasCallback:!!u,targetMapId:g,mustQueue:d,sourceMapId:this.mapId,data:Xl(o,C)},C),{cancel:()=>{u&&delete this.callbacks[E],this.target.postMessage({id:E,type:"<cancel>",targetMapId:g,sourceMapId:this.mapId})}}}receive(n){const o=n.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){const g=this.cancelCallbacks[u];delete this.cancelCallbacks[u],g&&g.cancel()}else if(o.mustQueue||wn()){const g=this.callbacks[u],d=this.scheduler.add(()=>this.processTask(u,o),g&&g.metadata||{type:"message"});d&&(this.cancelCallbacks[u]=d)}else this.processTask(u,o)}processTask(n,o){if(delete this.cancelCallbacks[n],o.type==="<response>"){const u=this.callbacks[n];delete this.callbacks[n],u&&(o.error?u(Qo(o.error)):u(null,Qo(o.data)))}else{const u=new Set,g=o.hasCallback?(v,E)=>{this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:v?Xl(v):null,data:Xl(E,u)},u)}:()=>{},d=Qo(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,d,g);else if(this.parent.getWorkerSource){const v=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,v[0],d.source,d.scope)[v[1]](d,g)}else g(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Lx={workerUrl:"",workerClass:null,workerParams:void 0};const IM="mapboxgl_preloaded_worker_pool";class zg{constructor(){this.active={}}acquire(n,o=zg.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<o;)this.workers.push(Lx.workerClass!=null?new Lx.workerClass:new self.Worker(Lx.workerUrl,Lx.workerParams));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.workers&&this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[IM]}numActive(){return Object.keys(this.active).length}}zg.workerCount=2;class Sv{constructor(n,o,u="Worker",g=zg.workerCount){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=Ni();const d=this.workerPool.acquire(this.id,g);for(let v=0;v<d.length;v++){const E=new Sv.Actor(d[v],o,this.id);E.name=`${u} ${v}`,this.actors.push(E)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,o,u){Xn(this.actors,(g,d)=>{g.send(n,o,d)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Ox,DM;function c1(){return Ox||(Ox=new zg),Ox}Sv.Actor=iD;const PM=new tr(0,0,0);var LM=(l=>(l[l.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",l[l.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",l[l.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",l))(LM||{}),u1=(l=>(l[l.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",l[l.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",l[l.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",l[l.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",l))(u1||{}),zx=(l=>(l[l.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",l[l.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",l[l.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",l[l.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",l[l.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",l))(zx||{}),rD=(l=>(l[l.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",l[l.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",l[l.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",l))(rD||{}),Ev=(l=>(l[l.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",l[l.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",l[l.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",l[l.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",l[l.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",l[l.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",l))(Ev||{}),aD=(l=>(l[l.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",l[l.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",l[l.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",l))(aD||{});function VB(l,n,o){l===1&&n.icons.push(function(u,g){return function(d){if(d.usvg_tree.height||(d.usvg_tree.height=d.usvg_tree.width),!d.metadata)return d;const{metadata:v}=d;if(v.content_area){const{content_area:E}=v;E.top==null&&(E.top=E.left),E.width==null&&(E.width=d.usvg_tree.width),E.height==null&&(E.height=E.width)}return v.stretch_x&&v.stretch_x.length&&oD(v,"x"),v.stretch_y&&v.stretch_y.length&&oD(v,"y"),d}(u.readFields(jB,{name:void 0},g))}(o,o.readVarint()+o.pos))}function oD(l,n){const o=[],u=l[`stretch_${n}`];let g=null;for(let d=0;d<u.length;d++)g===null?g=o.length===0?u[0]:o[o.length-1][1]+u[d]:(o.push([g,g+u[d]]),g=null);l[`stretch_${n}_areas`]=o}function jB(l,n,o){l===1?n.name=o.readString():l===2?n.metadata=function(u,g){return u.readFields(GB,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},g)}(o,o.readVarint()+o.pos):l===3&&(n.usvg_tree=function(u,g){return u.readFields(WB,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},g)}(o,o.readVarint()+o.pos),n.data="usvg_tree")}function GB(l,n,o){l===1?n.stretch_x=o.readPackedVarint():l===2?n.stretch_y=o.readPackedVarint():l===3?n.content_area=function(u,g){return u.readFields(HB,{left:0},g)}(o,o.readVarint()+o.pos):l===4&&n.variables.push(function(u,g){return u.readFields(qB,{name:void 0},g)}(o,o.readVarint()+o.pos))}function HB(l,n,o){l===1?n.left=o.readVarint():l===2?n.width=o.readVarint():l===3?n.top=o.readVarint():l===4&&(n.height=o.readVarint())}function qB(l,n,o){l===1?n.name=o.readString():l===2&&(n.rgb_color=f1(o.readVarint()),n.value="rgb_color")}function WB(l,n,o){l===1?n.width=n.height=o.readVarint():l===2?n.height=o.readVarint():l===3?n.children.push(h1(o,o.readVarint()+o.pos)):l===4?n.linear_gradients.push(function(u,g){return u.readFields(QB,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},g)}(o,o.readVarint()+o.pos)):l===5?n.radial_gradients.push(function(u,g){return u.readFields(t4,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},g)}(o,o.readVarint()+o.pos)):l===7?n.clip_paths.push(function(u,g){return u.readFields(n4,{children:[]},g)}(o,o.readVarint()+o.pos)):l===8&&n.masks.push(function(u,g){const d=u.readFields(i4,{left:0,width:20,mask_type:1,children:[]},g);return d.height==null&&(d.height=d.width),d.top==null&&(d.top=d.left),d}(o,o.readVarint()+o.pos))}function h1(l,n){return l.readFields($B,{},n)}function $B(l,n,o){l===1?(n.group=function(u,g){return u.readFields(XB,{opacity:255,children:[]},g)}(o,o.readVarint()+o.pos),n.node="group"):l===2&&(n.path=function(u,g){return u.readFields(YB,{paint_order:1,commands:[],step:1,diffs:[],rule:1},g)}(o,o.readVarint()+o.pos),n.node="path")}function XB(l,n,o){l===1?n.transform=d1(o,o.readVarint()+o.pos):l===2?n.opacity=o.readVarint():l===5?n.clip_path_idx=o.readVarint():l===6?n.mask_idx=o.readVarint():l===7&&n.children.push(h1(o,o.readVarint()+o.pos))}function d1(l,n){return l.readFields(ZB,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},n)}function ZB(l,n,o){l===1?n.sx=o.readFloat():l===2?n.ky=o.readFloat():l===3?n.kx=o.readFloat():l===4?n.sy=o.readFloat():l===5?n.tx=o.readFloat():l===6&&(n.ty=o.readFloat())}function YB(l,n,o){l===1?n.fill=function(u,g){return u.readFields(KB,{rgb_color:PM,paint:"rgb_color",opacity:255},g)}(o,o.readVarint()+o.pos):l===2?n.stroke=function(u,g){return u.readFields(JB,{rgb_color:PM,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},g)}(o,o.readVarint()+o.pos):l===3?n.paint_order=o.readVarint():l===5?o.readPackedVarint(n.commands):l===6?n.step=o.readFloat():l===7?o.readPackedSVarint(n.diffs):l===8&&(n.rule=o.readVarint())}function KB(l,n,o){l===1?(n.rgb_color=f1(o.readVarint()),n.paint="rgb_color"):l===2?(n.linear_gradient_idx=o.readVarint(),n.paint="linear_gradient_idx"):l===3?(n.radial_gradient_idx=o.readVarint(),n.paint="radial_gradient_idx"):l===5&&(n.opacity=o.readVarint())}function f1(l){return new tr((l>>16&255)/255,(l>>8&255)/255,(255&l)/255,1)}function JB(l,n,o){l===1?(n.rgb_color=f1(o.readVarint()),n.paint="rgb_color"):l===2?(n.linear_gradient_idx=o.readVarint(),n.paint="linear_gradient_idx"):l===3?(n.radial_gradient_idx=o.readVarint(),n.paint="radial_gradient_idx"):l===5?o.readPackedFloat(n.dasharray):l===6?n.dashoffset=o.readFloat():l===7?n.miterlimit=o.readFloat():l===8?n.opacity=o.readVarint():l===9?n.width=o.readFloat():l===10?n.linecap=o.readVarint():l===11&&(n.linejoin=o.readVarint())}function QB(l,n,o){l===1?n.transform=d1(o,o.readVarint()+o.pos):l===2?n.spread_method=o.readVarint():l===3?n.stops.push(sD(o,o.readVarint()+o.pos)):l===4?n.x1=o.readFloat():l===5?n.y1=o.readFloat():l===6?n.x2=o.readFloat():l===7&&(n.y2=o.readFloat())}function sD(l,n){return l.readFields(e4,{offset:0,opacity:255,rgb_color:PM},n)}function e4(l,n,o){l===1?n.offset=o.readFloat():l===2?n.opacity=o.readVarint():l===3&&(n.rgb_color=f1(o.readVarint()))}function t4(l,n,o){l===1?n.transform=d1(o,o.readVarint()+o.pos):l===2?n.spread_method=o.readVarint():l===3?n.stops.push(sD(o,o.readVarint()+o.pos)):l===4?n.cx=o.readFloat():l===5?n.cy=o.readFloat():l===6?n.r=o.readFloat():l===7?n.fx=o.readFloat():l===8?n.fy=o.readFloat():l===9&&(n.fr=o.readFloat())}function n4(l,n,o){l===1?n.transform=d1(o,o.readVarint()+o.pos):l===2?n.clip_path_idx=o.readVarint():l===3&&n.children.push(h1(o,o.readVarint()+o.pos))}function i4(l,n,o){l===1?n.left=n.top=o.readFloat():l===2?n.width=n.height=o.readFloat():l===3?n.top=o.readFloat():l===4?n.height=o.readFloat():l===5?n.mask_type=o.readVarint():l===6?n.mask_idx=o.readVarint():l===7&&n.children.push(h1(o,o.readVarint()+o.pos))}class r4{static calculate(n,o){const u=new Map,g=new Map;if(Object.keys(n).length===0)return u;o.forEach(d=>{g.set(d.name,d.rgb_color||new tr(0,0,0))});for(const[d,v]of Object.entries(n))g.has(d)?u.set(g.get(d).toStringPremultipliedAlpha(),v):console.warn(`Ignoring unknown image variable "${d}"`);return u}}function Mv(l,n=255,o){const u=n/255,g=l.toStringPremultipliedAlpha(),d=o.has(g)?o.get(g).clone():l.clone();return d.a=u,d.toString()}function kx(l,n){if(!Te()){const o=document.createElement("canvas");return o.width=l,o.height=n,o}return new OffscreenCanvas(l,n)}function a4(l,n){const o=r4.calculate(n.params,l.metadata?l.metadata.variables:[]),u=l.usvg_tree,g=u.width,d=u.height,v=n.transform?n.transform:new DOMMatrix,E=Math.max(1,Math.round(g*v.a)),C=Math.max(1,Math.round(d*v.d)),z=new DOMMatrix([E/g,0,0,C/d,0,0]),w=kx(E,C).getContext("2d");return OM(w,z,u,u,o),w.getImageData(0,0,E,C)}function OM(l,n,o,u,g){for(const d of u.children)lD(l,n,o,d,g)}function lD(l,n,o,u,g){u.group?(l.save(),function(d,v,E,C,z){const w=C.mask_idx!=null?E.masks[C.mask_idx]:null,R=C.clip_path_idx!=null?E.clip_paths[C.clip_path_idx]:null;if(C.transform&&(v=p1(C.transform).preMultiplySelf(v)),!function(D,F,W){return D.opacity!==255||F||W}(C,R!=null,w!=null))return void OM(d,v,E,C,z);const L=kx(d.canvas.width,d.canvas.height),A=L.getContext("2d");OM(A,v,E,C,z),R&&mD(A,v,E,R),w&&gD(A,v,E,w,z),d.globalAlpha=C.opacity/255,d.drawImage(L,0,0)}(l,n,o,u.group,g),l.restore()):u.path&&(l.save(),function(d,v,E,C,z){const w=_D(C);d.setTransform(v),C.paint_order===rD.PAINT_ORDER_FILL_AND_STROKE?(cD(d,E,C,w,z),hD(d,E,C,w,z)):(hD(d,E,C,w,z),cD(d,E,C,w,z))}(l,n,o,u.path,g),l.restore())}function cD(l,n,o,u,g){const d=o.fill;if(!d)return;const v=d.opacity/255;switch(d.paint){case"rgb_color":l.fillStyle=Mv(d.rgb_color,d.opacity,g);break;case"linear_gradient_idx":l.fillStyle=dD(l,n.linear_gradients[d.linear_gradient_idx],v,g);break;case"radial_gradient_idx":l.fillStyle=fD(l,n.radial_gradients[d.radial_gradient_idx],v,g)}l.fill(u,uD(o))}function uD(l){return l.rule===LM.PATH_RULE_NON_ZERO?"nonzero":l.rule===LM.PATH_RULE_EVEN_ODD?"evenodd":void 0}function hD(l,n,o,u,g){const d=o.stroke;if(!d)return;l.lineWidth=d.width,l.miterLimit=d.miterlimit,l.setLineDash(d.dasharray),l.lineDashOffset=d.dashoffset;const v=d.opacity/255;switch(d.paint){case"rgb_color":l.strokeStyle=Mv(d.rgb_color,d.opacity,g);break;case"linear_gradient_idx":l.strokeStyle=dD(l,n.linear_gradients[d.linear_gradient_idx],v,g);break;case"radial_gradient_idx":l.strokeStyle=fD(l,n.radial_gradients[d.radial_gradient_idx],v,g)}switch(d.linejoin){case zx.LINE_JOIN_MITER_CLIP:case zx.LINE_JOIN_MITER:l.lineJoin="miter";break;case zx.LINE_JOIN_ROUND:l.lineJoin="round";break;case zx.LINE_JOIN_BEVEL:l.lineJoin="bevel"}switch(d.linecap){case u1.LINE_CAP_BUTT:l.lineCap="butt";break;case u1.LINE_CAP_ROUND:l.lineCap="round";break;case u1.LINE_CAP_SQUARE:l.lineCap="square"}l.stroke(u)}function dD(l,n,o,u){if(n.stops.length===1){const L=n.stops[0];return Mv(L.rgb_color,L.opacity*o,u)}const g=p1(n.transform),{x1:d,y1:v,x2:E,y2:C}=n,z=g.transformPoint(new DOMPoint(d,v)),w=g.transformPoint(new DOMPoint(E,C)),R=l.createLinearGradient(z.x,z.y,w.x,w.y);for(const L of n.stops)R.addColorStop(L.offset,Mv(L.rgb_color,L.opacity*o,u));return R}function fD(l,n,o,u){if(n.stops.length===1){const L=n.stops[0];return Mv(L.rgb_color,L.opacity*o,u)}const g=p1(n.transform),{fx:d,fy:v,cx:E,cy:C}=n,z=g.transformPoint(new DOMPoint(d,v)),w=g.transformPoint(new DOMPoint(E,C)),R=l.createRadialGradient(z.x,z.y,0,w.x,w.y,n.r*((g.a+g.d)/2));for(const L of n.stops)R.addColorStop(L.offset,Mv(L.rgb_color,L.opacity*o,u));return R}function pD(l,n,o,u){const g=u.transform?p1(u.transform).preMultiplySelf(n):n,d=kx(l.canvas.width,l.canvas.height),v=d.getContext("2d");for(const C of u.children)if(C.group)pD(v,g,o,C.group);else if(C.path){const z=C.path,w=new Path2D;w.addPath(_D(z),g),v.fill(w,uD(z))}const E=u.clip_path_idx!=null?o.clip_paths[u.clip_path_idx]:null;E&&mD(v,g,o,E),l.globalCompositeOperation="source-over",l.drawImage(d,0,0)}function mD(l,n,o,u){const g=kx(l.canvas.width,l.canvas.height);pD(g.getContext("2d"),n,o,u),l.globalCompositeOperation="destination-in",l.drawImage(g,0,0)}function gD(l,n,o,u,g){if(u.children.length===0)return;const d=u.mask_idx!=null?o.masks[u.mask_idx]:null;d&&gD(l,n,o,d,g);const v=l.canvas.width,E=l.canvas.height,C=kx(v,E),z=C.getContext("2d"),w=u.width,R=u.height,L=u.left,A=u.top,D=new Path2D,F=new Path2D;F.rect(L,A,w,R),D.addPath(F,n),z.clip(D);for(const ie of u.children)lD(z,n,o,ie,g);const W=z.getImageData(0,0,v,E),$=W.data;if(u.mask_type===aD.MASK_TYPE_LUMINANCE)for(let ie=0;ie<$.length;ie+=4)$[ie+3]=$[ie+3]/255*(.2126*$[ie]+.7152*$[ie+1]+.0722*$[ie+2]);z.putImageData(W,0,0),l.globalCompositeOperation="destination-in",l.drawImage(C,0,0)}function p1(l){return l?new DOMMatrix([l.sx,l.ky,l.kx,l.sy,l.tx,l.ty]):new DOMMatrix}function _D(l){const n=new Path2D,o=l.step;let u=l.diffs[0]*o,g=l.diffs[1]*o;n.moveTo(u,g);for(let d=0,v=2;d<l.commands.length;d++)switch(l.commands[d]){case Ev.PATH_COMMAND_MOVE:u+=l.diffs[v++]*o,g+=l.diffs[v++]*o,n.moveTo(u,g);break;case Ev.PATH_COMMAND_LINE:u+=l.diffs[v++]*o,g+=l.diffs[v++]*o,n.lineTo(u,g);break;case Ev.PATH_COMMAND_QUAD:{const E=u+l.diffs[v++]*o,C=g+l.diffs[v++]*o;u=E+l.diffs[v++]*o,g=C+l.diffs[v++]*o,n.quadraticCurveTo(E,C,u,g);break}case Ev.PATH_COMMAND_CUBIC:{const E=u+l.diffs[v++]*o,C=g+l.diffs[v++]*o,z=E+l.diffs[v++]*o,w=C+l.diffs[v++]*o;u=z+l.diffs[v++]*o,g=w+l.diffs[v++]*o,n.bezierCurveTo(E,C,z,w,u,g);break}case Ev.PATH_COMMAND_CLOSE:n.closePath()}return n}class zM{constructor(n){this.capacity=n,this.cache=new Map}get(n){if(!this.cache.has(n))return;const o=this.cache.get(n);return this.cache.delete(n),this.cache.set(n,o),o}put(n,o){this.cache.has(n)?this.cache.delete(n):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(n,o)}delete(n){this.cache.delete(n)}}class kM{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(n){return new no(n,n.data)}getFromCache(n,o,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new zM(150)),this.cacheMap.get(u).get(ds(n.serialize(),o))}setInCache(n,o,u,g){this.cacheDependenciesMap.has(g)||this.cacheDependenciesMap.set(g,new Map),this.cacheMap.has(g)||this.cacheMap.set(g,new zM(150));const d=this.cacheDependenciesMap.get(g);d.get(ds(n.id,u))||d.set(ds(n.id,u),new Set);const v=this.cacheMap.get(g),E=n.serialize();d.get(ds(n.id,u)).add(E),v.put(ds(n.serialize(),u),o)}removeImagesFromCacheByIds(n,o,u=""){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const g=this.cacheMap.get(u),d=this.cacheDependenciesMap.get(u);for(const v of n)if(d.has(ds(v,o))){for(const E of d.get(ds(v,o)))g.delete(E);d.delete(ds(v,o))}}rasterize(n,o,u,g,d=a4){const v=this.getFromCache(n,u,g);if(v)return v.clone();const E=d(o.icon,n.options),C=kM._getImage(E);return this.setInCache(n,C,u,g),C.clone()}}class vD{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,o){const u=this.toIdx(n,o);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(n,o){return this.leaves[this.toIdx(n,o)]}toIdx(n,o){return o*this.size+n}}function yD(l,n,o,u){let g=0,d=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(u[v])<1e-15){if(o[v]<l[v]||o[v]>n[v])return null}else{const E=1/u[v];let C=(l[v]-o[v])*E,z=(n[v]-o[v])*E;if(C>z){const w=C;C=z,z=w}if(C>g&&(g=C),z<d&&(d=z),g>d)return null}return g}function xD(l,n,o,u,g,d,v,E,C,z,w){const R=u-l,L=g-n,A=d-o,D=v-l,F=E-n,W=C-o,$=w[1]*W-w[2]*F,ie=w[2]*D-w[0]*W,re=w[0]*F-w[1]*D,ee=R*$+L*ie+A*re;if(Math.abs(ee)<1e-15)return null;const ae=1/ee,de=z[0]-l,ye=z[1]-n,De=z[2]-o,Ie=(de*$+ye*ie+De*re)*ae;if(Ie<0||Ie>1)return null;const Re=ye*A-De*L,$e=De*R-de*A,Oe=de*L-ye*R,Ye=(w[0]*Re+w[1]*$e+w[2]*Oe)*ae;return Ye<0||Ie+Ye>1?null:(D*Re+F*$e+W*Oe)*ae}function bD(l,n,o){return(l-n)/(o-n)}function wD(l,n,o,u,g,d,v,E,C){const z=1<<o,w=d-u,R=v-g,L=(l+1)/z*w+u,A=(n+0)/z*R+g,D=(n+1)/z*R+g;E[0]=(l+0)/z*w+u,E[1]=A,C[0]=L,C[1]=D}class SD{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(d){const v=Math.ceil(Math.log2(d.dim/8)),E=[];let C=Math.ceil(Math.pow(2,v));const z=1/C,w=(A,D,F,W,$)=>{const ie=W?1:0,re=(A+1)*F-ie,ee=D*F,ae=(D+1)*F-ie;$[0]=A*F,$[1]=ee,$[2]=re,$[3]=ae};let R=new vD(C);const L=[];for(let A=0;A<C*C;A++){w(A%C,Math.floor(A/C),z,!1,L);const D=Qp(L[0],L[1],d),F=Qp(L[2],L[1],d),W=Qp(L[2],L[3],d),$=Qp(L[0],L[3],d);R.minimums.push(Math.min(D,F,W,$)),R.maximums.push(Math.max(D,F,W,$)),R.leaves.push(1)}for(E.push(R),C/=2;C>=1;C/=2){const A=E[E.length-1];R=new vD(C);for(let D=0;D<C*C;D++){w(D%C,Math.floor(D/C),2,!0,L);const F=A.getElevation(L[0],L[1]),W=A.getElevation(L[2],L[1]),$=A.getElevation(L[2],L[3]),ie=A.getElevation(L[0],L[3]),re=A.isLeaf(L[0],L[1]),ee=A.isLeaf(L[2],L[1]),ae=A.isLeaf(L[2],L[3]),de=A.isLeaf(L[0],L[3]),ye=Math.min(F.min,W.min,$.min,ie.min),De=Math.max(F.max,W.max,$.max,ie.max),Ie=re&&ee&&ae&&de;R.maximums.push(De),R.minimums.push(ye),R.leaves.push(De-ye<=5&&Ie?1:0)}E.push(R)}return E}(this.dem),u=o.length-1,g=o[u];this._addNode(g.minimums[0],g.maximums[0],g.leaves[0]),this._construct(o,0,0,u,0)}raycastRoot(n,o,u,g,d,v,E=1){return yD([n,o,-100],[u,g,this.maximums[0]*E],d,v)}raycast(n,o,u,g,d,v,E=1){if(!this.nodeCount)return null;const C=this.raycastRoot(n,o,u,g,d,v,E);if(C==null)return null;const z=[],w=[],R=[],L=[],A=[{idx:0,t:C,nodex:0,nodey:0,depth:0}];for(;A.length>0;){const{idx:D,t:F,nodex:W,nodey:$,depth:ie}=A.pop();if(this.leaves[D]){wD(W,$,ie,n,o,u,g,R,L);const ee=1<<ie,ae=(W+0)/ee,de=(W+1)/ee,ye=($+0)/ee,De=($+1)/ee,Ie=Qp(ae,ye,this.dem)*E,Re=Qp(de,ye,this.dem)*E,$e=Qp(de,De,this.dem)*E,Oe=Qp(ae,De,this.dem)*E,Ye=xD(R[0],R[1],Ie,L[0],R[1],Re,L[0],L[1],$e,d,v),tt=xD(L[0],L[1],$e,R[0],L[1],Oe,R[0],R[1],Ie,d,v),Je=Math.min(Ye!==null?Ye:Number.MAX_VALUE,tt!==null?tt:Number.MAX_VALUE);if(Je!==Number.MAX_VALUE)return Je;{const rt=Pe.vec3.scaleAndAdd([],d,v,F);if(ED(Ie,Re,Oe,$e,bD(rt[0],R[0],L[0]),bD(rt[1],R[1],L[1]))>=rt[2])return F}continue}let re=0;for(let ee=0;ee<this._siblingOffset.length;ee++){wD((W<<1)+this._siblingOffset[ee][0],($<<1)+this._siblingOffset[ee][1],ie+1,n,o,u,g,R,L),R[2]=-100,L[2]=this.maximums[this.childOffsets[D]+ee]*E;const ae=yD(R,L,d,v);if(ae!=null){const de=ae;z[ee]=de;let ye=!1;for(let De=0;De<re&&!ye;De++)de>=z[w[De]]&&(w.splice(De,0,ee),ye=!0);ye||(w[re]=ee),re++}}for(let ee=0;ee<re;ee++){const ae=w[ee];A.push({idx:this.childOffsets[D]+ae,t:z[ae],nodex:(W<<1)+this._siblingOffset[ae][0],nodey:($<<1)+this._siblingOffset[ae][1],depth:ie+1})}}return null}_addNode(n,o,u){return this.minimums.push(n),this.maximums.push(o),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(n,o,u,g,d){if(n[g].isLeaf(o,u)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const v=g-1,E=n[v];let C=0,z=0;for(let w=0;w<this._siblingOffset.length;w++){const R=2*o+this._siblingOffset[w][0],L=2*u+this._siblingOffset[w][1],A=E.getElevation(R,L),D=E.isLeaf(R,L),F=this._addNode(A.min,A.max,D);D&&(C|=1<<w),z||(z=F)}for(let w=0;w<this._siblingOffset.length;w++)C&1<<w||this._construct(n,2*o+this._siblingOffset[w][0],2*u+this._siblingOffset[w][1],v,z+w)}}function ED(l,n,o,u,g,d){return oi(oi(l,o,d),oi(n,u,d),g)}function Qp(l,n,o){const u=o.dim,g=gt(l*u-.5,0,u-1),d=gt(n*u-.5,0,u-1),v=Math.floor(g),E=Math.floor(d),C=Math.min(v+1,u-1),z=Math.min(E+1,u-1);return ED(o.get(v,E),o.get(C,E),o.get(v,z),o.get(C,z),g-v,d-E)}const o4={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function s4(l,n,o){return(256*l*256+256*n+o)/10-1e4}function l4(l,n,o){return 256*l+n+o/256-32768}class m1{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,o,u,g=!1){if(this.uid=n,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void Wn(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const d=this.dim=o.height-2,v=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=g,this._modifiedForSources={},!g){for(let C=0;C<d;C++)v[this._idx(-1,C)]=v[this._idx(0,C)],v[this._idx(d,C)]=v[this._idx(d-1,C)],v[this._idx(C,-1)]=v[this._idx(C,0)],v[this._idx(C,d)]=v[this._idx(C,d-1)];v[this._idx(-1,-1)]=v[this._idx(0,0)],v[this._idx(d,-1)]=v[this._idx(d-1,0)],v[this._idx(-1,d)]=v[this._idx(0,d-1)],v[this._idx(d,d)]=v[this._idx(d-1,d-1)]}const E=u==="terrarium"?l4:s4;for(let C=0;C<v.length;++C){const z=4*C;this.floatView[C]=E(this.pixels[z],this.pixels[z+1],this.pixels[z+2])}this._timestamp=je.now()}_buildQuadTree(){this._tree=new SD(this)}get(n,o,u=!1){u&&(n=gt(n,-1,this.dim),o=gt(o,-1,this.dim));const g=this._idx(n,o);return this.floatView[g]}set(n,o,u){const g=this._idx(n,o),d=this.floatView[g];return this.floatView[g]=u,u-d}static getUnpackVector(n){return o4[n]}_idx(n,o){if(n<-1||n>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(n+1)}static pack(n,o){const u=[0,0,0,0],g=m1.getUnpackVector(o);let d=Math.floor((n+g[3])/g[2]);return u[2]=d%256,d=Math.floor(d/256),u[1]=d%256,d=Math.floor(d/256),u[0]=d,u}getPixels(){return new Xy({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,o,u){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let g=o*this.dim,d=o*this.dim+this.dim,v=u*this.dim,E=u*this.dim+this.dim;switch(o){case-1:g=d-1;break;case 1:d=g+1}switch(u){case-1:v=E-1;break;case 1:E=v+1}const C=-o*this.dim,z=-u*this.dim;for(let w=v;w<E;w++)for(let R=g;R<d;R++){const L=4*this._idx(R,w),A=4*this._idx(R+C,w+z);this.pixels[L+0]=n.pixels[A+0],this.pixels[L+1]=n.pixels[A+1],this.pixels[L+2]=n.pixels[A+2],this.pixels[L+3]=n.pixels[A+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function c4(l,n,o){l===1?n.headerLength=o.readFixed32():l===2?n.x=o.readVarint():l===3?n.y=o.readVarint():l===4?n.z=o.readVarint():l===5&&n.layers.push(function(u,g){return u.readFields(p4,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},g)}(o,o.readVarint()+o.pos))}function u4(l,n,o){l===1?(n.delta_filter=function(u,g){return u.readFields(h4,{blockSize:0},g)}(o,o.readVarint()+o.pos),n.filter="delta_filter"):l===2?(o.readVarint(),n.filter="zigzag_filter"):l===3?(o.readVarint(),n.filter="bitshuffle_filter"):l===4&&(o.readVarint(),n.filter="byteshuffle_filter")}function h4(l,n,o){l===1&&(n.blockSize=o.readVarint())}function d4(l,n,o){l===1?(o.readVarint(),n.codec="gzip_data"):l===2?(o.readVarint(),n.codec="jpeg_image"):l===3?(o.readVarint(),n.codec="webp_image"):l===4&&(o.readVarint(),n.codec="png_image")}function f4(l,n,o){let u=0,g=0;l===1?n.firstByte=o.readFixed64():l===2?n.lastByte=o.readFixed64():l===3?n.filters.push(function(d,v){return d.readFields(u4,{},v)}(o,o.readVarint()+o.pos)):l===4?n.codec=function(d,v){return d.readFields(d4,{},v)}(o,o.readVarint()+o.pos):l===5?g=o.readFloat():l===6?u=o.readFloat():l===7?n.bands.push(o.readString()):l===8?n.offset=o.readDouble():l===9&&(n.scale=o.readDouble()),n.offset===0&&(n.offset=g),n.scale===0&&(n.scale=u)}function p4(l,n,o){l===1?n.version=o.readVarint():l===2?n.name=o.readString():l===3?n.units=o.readString():l===4?n.tileSize=o.readVarint():l===5?n.buffer=o.readVarint():l===6?n.pixelFormat=o.readVarint():l===7&&n.dataIndex.push(function(u,g){return u.readFields(f4,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},g)}(o,o.readVarint()+o.pos))}function m4(l,n,o){if(l===2)(function(u,g,d){u.readFields(g4,d,g)})(o,o.readVarint()+o.pos,n);else if(l===3)throw new Error("Not implemented")}function g4(l,n,o){if(l===1){let u=0;const g=o.readVarint()+o.pos;for(;o.pos<g;)n[u++]=o.readVarint()}}function _4(l,n){if(n.length!==4)throw new Error(`Expected data of dimension 4 but got ${n.length}.`);let o=n[3];for(let u=2;u>=1;u--){const g=u===1?1:0,d=u===2?1:0;for(let v=0;v<n[0];v++){const E=n[1]*v;for(let C=g;C<n[1];C++){const z=n[2]*(C+E);for(let w=d;w<n[2];w++){const R=n[3]*(w+z);for(let L=0;L<n[3];L++){const A=R+L;l[A]+=l[A-o]}}}}o*=n[u]}return l}function v4(l){for(let n=0,o=l.length;n<o;n++)l[n]=l[n]>>>1^-(1&l[n]);return l}function y4(l,n){switch(n){case"uint32":return l;case"uint16":for(let o=0;o<l.length;o+=2){const u=l[o],g=l[o+1];l[o]=(240&u)>>4|(61440&u)>>8|(240&g)<<4|61440&g,l[o+1]=15&u|(3840&u)>>4|(15&g)<<8|(3840&g)<<4}return l;case"uint8":for(let o=0;o<l.length;o+=4){const u=l[o],g=l[o+1],d=l[o+2],v=l[o+3];l[o+0]=(192&u)>>6|(192&g)>>4|(192&d)>>2|192&v,l[o+1]=(48&u)>>4|(48&g)>>2|48&d|(48&v)<<2,l[o+2]=(12&u)>>2|12&g|(12&d)<<2|(12&v)<<4,l[o+3]=3&u|(3&g)<<2|(3&d)<<4|(3&v)<<6}return l;default:throw new Error(`Invalid pixel format, "${n}"`)}}Ln(m1,"DEMData"),Ln(SD,"DemMinMaxQuadTree",{omit:["dem"]});var ac=Uint8Array,Fx=Uint16Array,x4=Int32Array,MD=new ac([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),TD=new ac([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),b4=new ac([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),AD=function(l,n){for(var o=new Fx(31),u=0;u<31;++u)o[u]=n+=1<<l[u-1];var g=new x4(o[30]);for(u=1;u<30;++u)for(var d=o[u];d<o[u+1];++d)g[d]=d-o[u]<<5|u;return{b:o,r:g}},CD=AD(MD,2),RD=CD.b,w4=CD.r;RD[28]=258,w4[258]=28;for(var S4=AD(TD,0).b,ID=new Fx(32768),Fa=0;Fa<32768;++Fa){var Tv=(43690&Fa)>>1|(21845&Fa)<<1;ID[Fa]=((65280&(Tv=(61680&(Tv=(52428&Tv)>>2|(13107&Tv)<<2))>>4|(3855&Tv)<<4))>>8|(255&Tv)<<8)>>1}var Nx=function(l,n,o){for(var u=l.length,g=0,d=new Fx(n);g<u;++g)l[g]&&++d[l[g]-1];var v,E=new Fx(n);for(g=1;g<n;++g)E[g]=E[g-1]+d[g-1]<<1;v=new Fx(1<<n);var C=15-n;for(g=0;g<u;++g)if(l[g])for(var z=g<<4|l[g],w=n-l[g],R=E[l[g]-1]++<<w,L=R|(1<<w)-1;R<=L;++R)v[ID[R]>>C]=z;return v},Bx=new ac(288);for(Fa=0;Fa<144;++Fa)Bx[Fa]=8;for(Fa=144;Fa<256;++Fa)Bx[Fa]=9;for(Fa=256;Fa<280;++Fa)Bx[Fa]=7;for(Fa=280;Fa<288;++Fa)Bx[Fa]=8;var DD=new ac(32);for(Fa=0;Fa<32;++Fa)DD[Fa]=5;var E4=Nx(Bx,9),M4=Nx(DD,5),FM=function(l){for(var n=l[0],o=1;o<l.length;++o)l[o]>n&&(n=l[o]);return n},Xu=function(l,n,o){var u=n/8|0;return(l[u]|l[u+1]<<8)>>(7&n)&o},NM=function(l,n){var o=n/8|0;return(l[o]|l[o+1]<<8|l[o+2]<<16)>>(7&n)},T4=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Zu=function(l,n,o){var u=new Error(n||T4[l]);if(u.code=l,Error.captureStackTrace&&Error.captureStackTrace(u,Zu),!o)throw u;return u},A4=new ac(0),C4=typeof TextDecoder<"u"&&new TextDecoder;try{C4.decode(A4,{stream:!0})}catch{}const R4={gzip_data:"gzip"};class au extends Error{constructor(n){super(n),this.name="MRTError"}}const I4={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},PD={uint32:1,uint16:2,uint8:4},D4={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let BM;class UM{constructor(n=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=n}getLayer(n){const o=this.layers[n];if(!o)throw new au(`Layer '${n}' not found`);return o}getHeaderLength(n){const o=new Uint8Array(n),u=new DataView(n);if(o[0]!==13)throw new au("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(n){const o=new Uint8Array(n),u=this.getHeaderLength(n);if(o.length<u)throw new au(`Expected header with length >= ${u} but got buffer of length ${o.length}`);const g=function(d,v){return d.readFields(c4,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new BM(o.subarray(0,u)));if(!isNaN(this.x)&&(this.x!==g.x||this.y!==g.y||this.z!==g.z))throw new au(`Invalid attempt to parse header ${g.z}/${g.x}/${g.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=g.x,this.y=g.y,this.z=g.z;for(const d of g.layers)this.layers[d.name]=new P4(d,{cacheSize:this._cacheSize});return this}createDecodingTask(n){const o=[],u=this.getLayer(n.layerName);for(let g of n.blockIndices){const d=u.dataIndex[g],v=d.firstByte-n.firstByte,E=d.lastByte-n.firstByte;if(u._blocksInProgress.has(g))continue;const C={layerName:u.name,firstByte:v,lastByte:E,pixelFormat:u.pixelFormat,blockIndex:g,blockShape:[d.bands.length].concat(u.bandShape),buffer:u.buffer,codec:d.codec.codec,filters:d.filters.map(z=>z.filter)};u._blocksInProgress.add(g),o.push(C)}return new LD(o,()=>{o.forEach(g=>u._blocksInProgress.delete(g.blockIndex))},(g,d)=>{if(o.forEach(v=>u._blocksInProgress.delete(v.blockIndex)),g)throw g;d.forEach(v=>{this.getLayer(v.layerName).processDecodedData(v)})})}}class P4{constructor({version:n,name:o,units:u,tileSize:g,pixelFormat:d,buffer:v,dataIndex:E},C){if(this.version=n,this.version!==1)throw new au(`Cannot parse raster layer encoded with MRT version ${n}`);this.name=o,this.units=u,this.tileSize=g,this.buffer=v,this.pixelFormat=I4[d],this.dataIndex=E,this.bandShape=[g+2*v,g+2*v,PD[this.pixelFormat]],this._decodedBlocks=new zM(C?C.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return PD[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:n})=>n).flat()}processDecodedData(n){const o=n.blockIndex.toString();this._decodedBlocks.get(o)||this._decodedBlocks.put(o,n.data)}getBlockForBand(n){let o=0;switch(typeof n){case"string":for(const[u,g]of this.dataIndex.entries()){for(const[d,v]of g.bands.entries())if(v===n)return{bandIndex:o+d,blockIndex:u,blockBandIndex:d};o+=g.bands.length}break;case"number":for(const[u,g]of this.dataIndex.entries()){if(n>=o&&n<o+g.bands.length)return{bandIndex:n,blockIndex:u,blockBandIndex:n-o};o+=g.bands.length}break;default:throw new au(`Invalid band \`${JSON.stringify(n)}\`. Expected string or integer.`)}throw new au(`Band not found: ${JSON.stringify(n)}`)}getDataRange(n){let o=1/0,u=-1/0;const g=[],d=new Set;for(const v of n){const{blockIndex:E}=this.getBlockForBand(v);if(E<0)throw new au(`Invalid band: ${JSON.stringify(v)}`);const C=this.dataIndex[E];g.includes(E)||g.push(E),d.add(E),o=Math.min(o,C.firstByte),u=Math.max(u,C.lastByte)}if(d.size>this.cacheSize)throw new au(`Number of blocks to decode (${d.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:o,lastByte:u,blockIndices:g}}hasBand(n){const{blockIndex:o}=this.getBlockForBand(n);return o>=0}hasDataForBand(n){const{blockIndex:o}=this.getBlockForBand(n);return o>=0&&!!this._decodedBlocks.get(o.toString())}getBandView(n){const{blockIndex:o,blockBandIndex:u}=this.getBlockForBand(n),g=this._decodedBlocks.get(o.toString());if(!g)throw new au(`Data for band ${JSON.stringify(n)} of layer "${this.name}" not decoded.`);const d=this.dataIndex[o],v=this.bandShape.reduce((z,w)=>z*w,1),E=u*v,C=g.subarray(E,E+v);return{data:C,bytes:new Uint8Array(C.buffer).subarray(C.byteOffset,C.byteOffset+C.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:d.offset,scale:d.scale}}}UM.setPbf=function(l){BM=l};class LD{constructor(n,o,u){this.tasks=n,this._onCancel=o,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(n,o){this._finalized||(this._onComplete(n,o),this._finalized=!0)}}UM.performDecoding=function(l,n){const o=new Uint8Array(l);return Promise.all(n.tasks.map(u=>{const{layerName:g,firstByte:d,lastByte:v,pixelFormat:E,blockShape:C,blockIndex:z,filters:w,codec:R}=u,L=o.subarray(d,v+1),A=new Uint32Array(C[0]*C[1]*C[2]);let D;if(R!=="gzip_data")throw new au(`Unhandled codec: ${R}`);return D=function(F,W){if(!globalThis.DecompressionStream&&W==="gzip_data")return Promise.resolve(((ee=function(ye){ye[0]==31&&ye[1]==139&&ye[2]==8||Zu(6,"invalid gzip data");var De=ye[3],Ie=10;4&De&&(Ie+=2+(ye[10]|ye[11]<<8));for(var Re=(De>>3&1)+(De>>4&1);Re>0;Re-=!ye[Ie++]);return Ie+(2&De)}(re=F))+8>re.length&&Zu(6,"invalid gzip data"),function(ye,De,Ie,Re){var $e=ye.length;if(!$e||De.f&&!De.l)return Ie||new ac(0);var Oe=!Ie,Ye=Oe||De.i!=2,tt=De.i;Oe&&(Ie=new ac(3*$e));var Je,rt,ct=function(em){var Ng=Ie.length;if(em>Ng){var Gx=new ac(Math.max(2*Ng,em));Gx.set(Ie),Ie=Gx}},yt=De.f||0,st=De.p||0,Bt=De.b||0,Qt=De.l,Nt=De.d,An=De.m,xn=De.n,cn=8*$e;do{if(!Qt){yt=Xu(ye,st,1);var nn=Xu(ye,st+1,3);if(st+=3,!nn){var Hn=ye[(Mi=4+((st+7)/8|0))-4]|ye[Mi-3]<<8,In=Mi+Hn;if(In>$e){tt&&Zu(0);break}Ye&&ct(Bt+Hn),Ie.set(ye.subarray(Mi,In),Bt),De.b=Bt+=Hn,De.p=st=8*In,De.f=yt;continue}if(nn==1)Qt=E4,Nt=M4,An=9,xn=5;else if(nn==2){var kn=Xu(ye,st,31)+257,yi=Xu(ye,st+10,15)+4,Ri=kn+Xu(ye,st+5,31)+1;st+=14;for(var zi=new ac(Ri),ki=new ac(19),$i=0;$i<yi;++$i)ki[b4[$i]]=Xu(ye,st+3*$i,7);st+=3*yi;var Zi=FM(ki),zr=(1<<Zi)-1,xr=Nx(ki,Zi);for($i=0;$i<Ri;){var Mi,_r=xr[Xu(ye,st,zr)];if(st+=15&_r,(Mi=_r>>4)<16)zi[$i++]=Mi;else{var vr=0,Xr=0;for(Mi==16?(Xr=3+Xu(ye,st,3),st+=2,vr=zi[$i-1]):Mi==17?(Xr=3+Xu(ye,st,7),st+=3):Mi==18&&(Xr=11+Xu(ye,st,127),st+=7);Xr--;)zi[$i++]=vr}}var Ea=zi.subarray(0,kn),Na=zi.subarray(kn);An=FM(Ea),xn=FM(Na),Qt=Nx(Ea,An),Nt=Nx(Na,xn)}else Zu(1);if(st>cn){tt&&Zu(0);break}}Ye&&ct(Bt+131072);for(var Ma=(1<<An)-1,fa=(1<<xn)-1,Da=st;;Da=st){var qa=(vr=Qt[NM(ye,st)&Ma])>>4;if((st+=15&vr)>cn){tt&&Zu(0);break}if(vr||Zu(2),qa<256)Ie[Bt++]=qa;else{if(qa==256){Da=st,Qt=null;break}var jo=qa-254;qa>264&&(jo=Xu(ye,st,(1<<(Ku=MD[$i=qa-257]))-1)+RD[$i],st+=Ku);var Hr=Nt[NM(ye,st)&fa],ol=Hr>>4;if(Hr||Zu(3),st+=15&Hr,Na=S4[ol],ol>3){var Ku=TD[ol];Na+=NM(ye,st)&(1<<Ku)-1,st+=Ku}if(st>cn){tt&&Zu(0);break}Ye&&ct(Bt+131072);var ou=Bt+jo;if(Bt<Na){var su=0-Na,Fg=Math.min(Na,ou);for(su+Bt<0&&Zu(3);Bt<Fg;++Bt)Ie[Bt]=(void 0)[su+Bt]}for(;Bt<ou;++Bt)Ie[Bt]=Ie[Bt-Na]}}De.l=Qt,De.p=Da,De.b=Bt,De.f=yt,Qt&&(yt=1,De.m=An,De.d=Nt,De.n=xn)}while(!yt);return Bt!=Ie.length&&Oe?(Je=Ie,((rt=Bt)==null||rt>Je.length)&&(rt=Je.length),new ac(Je.subarray(0,rt))):Ie.subarray(0,Bt)}(re.subarray(ee,-8),{i:2},new ac((($=re)[(ie=$.length)-4]|$[ie-3]<<8|$[ie-2]<<16|$[ie-1]<<24)>>>0))));var $,ie,re,ee;const ae=R4[W];if(!ae)throw new Error(`Unhandled codec: ${W}`);const de=new globalThis.DecompressionStream(ae);return new Response(new Blob([F]).stream().pipeThrough(de)).arrayBuffer().then(ye=>new Uint8Array(ye))}(L,R).then(F=>(function(W,$){W.readFields(m4,$)}(new BM(F),A),new D4[E](A.buffer))),D.then(F=>{for(let W=w.length-1;W>=0;W--)switch(w[W]){case"delta_filter":_4(F,C);break;case"zigzag_filter":v4(F);break;case"bitshuffle_filter":y4(F,E);break;default:throw new au(`Unhandled filter "${w[W]}"`)}return{layerName:g,blockIndex:z,data:F}}).catch(F=>{throw F})}))},Ln(LD,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let Ux,VM,Yu,Av,jM,Cv=null;function OD(){return wn()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:VM||Sr.DRACO_URL}function zD(){if(wn()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Av)return Av;const l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Av=WebAssembly.validate(l)?Sr.MESHOPT_SIMD_URL:Sr.MESHOPT_URL,Av}const g1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},L4={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Vx={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function kD(l,n,o){const u=o.json.bufferViews.length,g=o.buffers.length;n.bufferView=u,o.json.bufferViews[u]={buffer:g,byteLength:l.byteLength},o.buffers[g]=l}const GM="KHR_draco_mesh_compression";function O4(l,n){const o=l.extensions&&l.extensions[GM];if(!o)return;const u=new Yu.Decoder,g=UD(n,o.bufferView),d=new Yu.Mesh;if(!u.DecodeArrayToMesh(g,g.byteLength,d))throw new Error("Failed to decode Draco mesh");const v=n.json.accessors[l.indices],E=g1[v.componentType],C=v.count*E.BYTES_PER_ELEMENT,z=Yu._malloc(C);E===Uint16Array?u.GetTrianglesUInt16Array(d,C,z):u.GetTrianglesUInt32Array(d,C,z),kD(Yu.memory.buffer.slice(z,z+C),v,n),Yu._free(z);for(const w of Object.keys(o.attributes)){const R=u.GetAttributeByUniqueId(d,o.attributes[w]),L=n.json.accessors[l.attributes[w]],A=L4[L.componentType],D=L.count*Vx[L.type]*g1[L.componentType].BYTES_PER_ELEMENT,F=Yu._malloc(D);u.GetAttributeDataArrayForAllPoints(d,R,Yu[A],D,F),kD(Yu.memory.buffer.slice(F,F+D),L,n),Yu._free(F)}u.destroy(),d.destroy(),delete l.extensions[GM]}const _1="EXT_meshopt_compression";function z4(l,n){if(!l.extensions||!l.extensions[_1])return;const o=l.extensions[_1],u=new Uint8Array(n.buffers[o.buffer],o.byteOffset||0,o.byteLength||0),g=new Uint8Array(o.count*o.byteStride);jM.decodeGltfBuffer(g,o.count,o.byteStride,u,o.mode,o.filter),l.buffer=n.buffers.length,l.byteOffset=0,n.buffers[l.buffer]=g.buffer,delete l.extensions[_1]}const FD=1179937895,ND=new TextDecoder("utf8");function BD(l,n){return new URL(l,n).href}function k4(l,n,o,u){return fetch(BD(l.uri,u)).then(g=>g.arrayBuffer()).then(g=>{n.buffers[o]=g})}function UD(l,n){const o=l.json.bufferViews[n];return new Uint8Array(l.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function F4(l,n,o,u){if(l.uri){const g=BD(l.uri,u);return fetch(g).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{n.images[o]=d})}if(l.bufferView!==void 0){const g=UD(n,l.bufferView),d=new Blob([g],{type:l.mimeType});return createImageBitmap(d).then(v=>{n.images[o]=v})}}function VD(l,n=0,o){const u={json:null,images:[],buffers:[]};if(new Uint32Array(l,n,1)[0]===FD){const w=new Uint32Array(l,n);let R=2;const L=(w[R++]>>2)-3,A=w[R++]>>2;if(R++,u.json=JSON.parse(ND.decode(w.subarray(R,R+A))),R+=A,R<L){const D=w[R++];R++;const F=n+(R<<2);u.buffers[0]=l.slice(F,F+D)}}else u.json=JSON.parse(ND.decode(new Uint8Array(l,n)));const{buffers:g,images:d,meshes:v,extensionsUsed:E,bufferViews:C}=u.json;let z=Promise.resolve();if(g){const w=[];for(let R=0;R<g.length;R++){const L=g[R];L.uri?w.push(k4(L,u,R,o)):u.buffers[R]||(u.buffers[R]=null)}z=Promise.all(w)}return z.then(()=>{const w=[],R=E&&E.includes(GM),L=E&&E.includes(_1);if(R&&w.push(function(){if(!Yu)return Ux??(Ux=function(A){let D,F=null;function W(){D=new Uint8Array(F.buffer)}function $(){throw new Error("Unexpected Draco error.")}const ie={a:{a:$,d:function(re,ee,ae){return D.copyWithin(re,ee,ee+ae)},c:function(re){const ee=D.length,ae=Math.max(re>>>0,Math.ceil(1.2*ee)),de=Math.ceil((ae-ee)/65536);try{return F.grow(de),W(),!0}catch{return!1}},b:$}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(A,ie):A.then(re=>re.arrayBuffer()).then(re=>WebAssembly.instantiate(re,ie))).then(re=>{const{Rb:ee,Qb:ae,P:de,T:ye,X:De,Ja:Ie,La:Re,Qa:$e,Va:Oe,Wa:Ye,eb:tt,jb:Je,f:rt,e:ct,yb:yt,zb:st,Ab:Bt,Bb:Qt,Db:Nt,Gb:An}=re.instance.exports;F=ct;const xn=(()=>{let cn=0,nn=0,Hn=0,In=0;return kn=>{Hn&&(ee(In),ee(cn),nn+=Hn,Hn=cn=0),cn||(nn+=128,cn=ae(nn));const yi=kn.length+7&-8;let Ri=cn;yi>=nn&&(Hn=yi,Ri=In=ae(yi));for(let zi=0;zi<kn.length;zi++)D[Ri+zi]=kn[zi];return Ri}})();return W(),rt(),{memory:ct,_free:ee,_malloc:ae,Mesh:class{constructor(){this.ptr=de()}destroy(){ye(this.ptr)}},Decoder:class{constructor(){this.ptr=Ie()}destroy(){Je(this.ptr)}DecodeArrayToMesh(cn,nn,Hn){const In=xn(cn),kn=Re(this.ptr,In,nn,Hn.ptr);return!!De(kn)}GetAttributeByUniqueId(cn,nn){return{ptr:$e(this.ptr,cn.ptr,nn)}}GetTrianglesUInt16Array(cn,nn,Hn){Oe(this.ptr,cn.ptr,nn,Hn)}GetTrianglesUInt32Array(cn,nn,Hn){Ye(this.ptr,cn.ptr,nn,Hn)}GetAttributeDataArrayForAllPoints(cn,nn,Hn,In,kn){tt(this.ptr,cn.ptr,nn.ptr,Hn,In,kn)}},DT_INT8:yt(),DT_UINT8:st(),DT_INT16:Bt(),DT_UINT16:Qt(),DT_UINT32:Nt(),DT_FLOAT32:An()}})}(fetch(OD())),Ux.then(A=>{Yu=A,Ux=void 0}))}()),L&&w.push(function(){if(jM)return;const A=function(D){let F;const W=WebAssembly.instantiateStreaming(D,{}).then(re=>{F=re.instance,F.exports.__wasm_call_ctors()}),$={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ie={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:W,supported:!0,decodeGltfBuffer(re,ee,ae,de,ye,De){(function(Ie,Re,$e,Oe,Ye,tt,Je){const rt=Ie.exports.sbrk,ct=Oe+3&-4,yt=rt(ct*Ye),st=rt(tt.length),Bt=new Uint8Array(Ie.exports.memory.buffer);Bt.set(tt,st);const Qt=Re(yt,Oe,Ye,st,tt.length);if(Qt===0&&Je&&Je(yt,ct,Ye),$e.set(Bt.subarray(yt,yt+Oe*Ye)),rt(yt-rt(0)),Qt!==0)throw new Error(`Malformed buffer data: ${Qt}`)})(F,F.exports[ie[ye]],re,ee,ae,de,F.exports[$[De]])}}}(fetch(zD()));return A.ready.then(()=>{jM=A})}()),d)for(let A=0;A<d.length;A++)w.push(F4(d[A],u,A,o));return(w.length?Promise.all(w):Promise.resolve()).then(()=>{if(R&&v)for(const{primitives:A}of v)for(const D of A)O4(D,u);if(L&&v&&C)for(const A of C)z4(A,u);return u})})}function kg(l,n){const o=l.json.bufferViews[n.bufferView],u=g1[n.componentType];return new u(l.buffers[o.buffer],(n.byteOffset||0)+(o.byteOffset||0),n.count*(o.byteStride&&o.byteStride!==Vx[n.type]*u.BYTES_PER_ELEMENT?o.byteStride/u.BYTES_PER_ELEMENT:Vx[n.type]))}function HM(l,n,o,u){const g=g1[n.componentType],d=function(w){switch(w){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(g),v=l.json.bufferViews[n.bufferView],E=v.byteStride?v.byteStride/g.BYTES_PER_ELEMENT:Vx[n.type],C=o.float32,z=C.length/o.capacity;for(let w=0,R=0;w<n.count*E;w+=E,R+=z)for(let L=0;L<z;L++)C[R+L]=u[w+L]*d;o._trim()}function N4(l,n,o){const u=l.indices,g=l.attributes,d={};d.indexArray=new Ha;const v=n.json.accessors[u],E=v.count/3;d.indexArray.reserve(E);const C=kg(n,v);for(let L=0;L<E;L++)d.indexArray.emplaceBack(C[3*L],C[3*L+1],C[3*L+2]);d.indexArray._trim(),d.vertexArray=new yl;const z=n.json.accessors[g.POSITION];d.vertexArray.reserve(z.count);const w=kg(n,z);for(let L=0;L<z.count;L++)d.vertexArray.emplaceBack(w[3*L],w[3*L+1],w[3*L+2]);if(d.vertexArray._trim(),d.aabb=new Rn(z.min,z.max),d.centroid=function(L,A){const D=[0,0,0],F=L.length;if(F>0){for(let W=0;W<F;W++){const $=3*L[W];D[0]+=A[$],D[1]+=A[$+1],D[2]+=A[$+2]}D[0]/=F,D[1]/=F,D[2]/=F}return D}(C,w),g.COLOR_0!==void 0){const L=n.json.accessors[g.COLOR_0],A=Vx[L.type],D=kg(n,L);d.colorArray=A===3?new yl:new $c,d.colorArray.resize(L.count),HM(n,L,d.colorArray,D)}if(g.NORMAL!==void 0){d.normalArray=new yl;const L=n.json.accessors[g.NORMAL];d.normalArray.resize(L.count);const A=kg(n,L);HM(n,L,d.normalArray,A)}if(g.TEXCOORD_0!==void 0&&o.length>0){d.texcoordArray=new ku;const L=n.json.accessors[g.TEXCOORD_0];d.texcoordArray.resize(L.count);const A=kg(n,L);HM(n,L,d.texcoordArray,A)}if(g._FEATURE_ID_RGBA4444!==void 0){const L=n.json.accessors[g._FEATURE_ID_RGBA4444];n.json.extensionsUsed&&n.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=kg(n,L))}g._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(kg(n,n.json.accessors[g._FEATURE_RGBA4444]).buffer));const R=l.material;return d.material=function(L,A){const{emissiveFactor:D=[0,0,0],alphaMode:F="OPAQUE",alphaCutoff:W=.5,normalTexture:$,occlusionTexture:ie,emissiveTexture:re,doubleSided:ee}=L,{baseColorFactor:ae=[1,1,1,1],metallicFactor:de=1,roughnessFactor:ye=1,baseColorTexture:De,metallicRoughnessTexture:Ie}=L.pbrMetallicRoughness||{},Re=ie?A[ie.index]:void 0;if(ie&&ie.extensions&&ie.extensions.KHR_texture_transform&&Re){const $e=ie.extensions.KHR_texture_transform;Re.offsetScale=[$e.offset[0],$e.offset[1],$e.scale[0],$e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new tr(...ae),metallicFactor:de,roughnessFactor:ye,baseColorTexture:De?A[De.index]:void 0,metallicRoughnessTexture:Ie?A[Ie.index]:void 0},doubleSided:ee,emissiveFactor:D,alphaMode:F,alphaCutoff:W,normalTexture:$?A[$.index]:void 0,occlusionTexture:Re,emissionTexture:re?A[re.index]:void 0,defined:L.defined===void 0}}(R!==void 0?n.json.materials[R]:{defined:!1},o),d}function jD(l,n,o){const{matrix:u,rotation:g,translation:d,scale:v,mesh:E,extras:C,children:z}=l,w={};if(w.matrix=u||Pe.mat4.fromRotationTranslationScale([],g||[0,0,0,1],d||[0,0,0],v||[1,1,1]),E!==void 0){w.meshes=o[E];const R=w.anchor=[0,0];for(const L of w.meshes){const{min:A,max:D}=L.aabb;R[0]+=A[0]+D[0],R[1]+=A[1]+D[1]}R[0]=Math.floor(R[0]/w.meshes.length/2),R[1]=Math.floor(R[1]/w.meshes.length/2)}if(C&&(C.id&&(w.id=C.id),C.lights&&(w.lights=function(R){if(!R.length)return[];const L=function($){const ie=atob($),re=new Uint8Array(ie.length);for(let ee=0;ee<ie.length;ee++)re[ee]=ie.codePointAt(ee);return re}(R),A=[],D=L.length/24,F=new Uint16Array(L.buffer),W=new Float32Array(L.buffer);for(let $=0;$<D;$++){const ie=F[2*$*6]/30,re=F[2*$*6+1]/30,ee=F[2*$*6+10]/100,ae=W[6*$+1],de=W[6*$+2],ye=W[6*$+3],De=W[6*$+4],Ie=ye-ae,Re=De-de,$e=Math.hypot(Ie,Re);A.push({pos:[ae+.5*Ie,de+.5*Re,re],normal:[Re/$e,-Ie/$e,0],width:$e,height:ie,depth:ee,points:[ae,de,ye,De]})}return A}(C.lights))),z){const R=[];for(const L of z)R.push(jD(n.json.nodes[L],n,o));w.children=R}return w}function B4(l){if(l.vertices.length===0||l.indices.length===0)return null;const n=new Jy(l.vertices,l.indices,8,256),[o,u]=[n.min.clone(),n.max.clone()];return{vertices:l.vertices,indices:l.indices,grid:n,min:o,max:u}}function U4(l){if(!l.extras||!l.extras.ground)return null;const n=l.extras.ground;if(!n||!Array.isArray(n)||n.length===0)return null;const o=n[0];if(!o||!Array.isArray(o)||o.length===0)return null;const u=[];for(const v of o){if(!Array.isArray(v)||v.length!==2)continue;const E=v[0],C=v[1];typeof E=="number"&&typeof C=="number"&&u.push(new ke(E,C))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let g=0;for(let v=0;v<u.length;v++){const E=u[v],C=u[(v+1)%u.length],z=u[(v+2)%u.length];g+=(E.x-C.x)*(z.y-C.y)-(z.x-C.x)*(E.y-C.y)}g>0&&u.reverse();const d=mg(u.flatMap(v=>[v.x,v.y]),[]);return d.length===0?null:{vertices:u,indices:d}}function V4(l,n){const o=[],u=[];let g=0;const d=[];for(const v of l){g=o.length;const E=v.vertexArray.float32,C=v.indexArray.uint16;for(let z=0;z<v.vertexArray.length;z++)d[0]=E[3*z+0],d[1]=E[3*z+1],d[2]=E[3*z+2],Pe.vec3.transformMat4(d,d,n),o.push(new ke(d[0],d[1]));for(let z=0;z<3*v.indexArray.length;z++)u.push(C[z]+g)}if(u.length%3!=0)return null;for(let v=0;v<u.length;v+=3){const E=o[u[v+0]],C=o[u[v+1]],z=o[u[v+2]];(E.x-C.x)*(z.y-C.y)-(z.x-C.x)*(E.y-C.y)>0&&([u[v+1],u[v+2]]=[u[v+2],u[v+1]])}return{vertices:o,indices:u}}function GD(l){const n=function(C,z){const w=[],R=WebGL2RenderingContext;if(C.json.textures)for(const L of C.json.textures){const A={magFilter:R.LINEAR,minFilter:R.NEAREST,wrapS:R.REPEAT,wrapT:R.REPEAT};L.sampler!==void 0&&Object.assign(A,C.json.samplers[L.sampler]),w.push({image:z[L.source],sampler:A,uploaded:!1})}return w}(l,l.images),o=function(C,z){const w=[];for(const R of C.json.meshes){const L=[];for(const A of R.primitives)L.push(N4(A,C,z));w.push(L)}return w}(l,n),{scenes:u,scene:g,nodes:d}=l.json,v=u?u[g||0].nodes:d,E=[];for(const C of v)E.push(jD(d[C],l,o));return function(C,z,w){const R={},L=new Set;for(let A=0;A<C.length;A++){const D=w[z[A]];if(!D.extras)continue;const F=D.extras["mapbox:footprint:version"],W=D.extras["mapbox:footprint:id"];(F||W)&&L.add(A),F==="1.0.0"&&W&&(R[W]=A)}for(let A=0;A<C.length;A++){if(L.has(A))continue;const D=C[A],F=w[z[A]];if(!F.extras)continue;let W=null;D.id in R&&(W=V4(C[R[D.id]].meshes,D.matrix)),W||(W=U4(F)),W&&(D.footprint=B4(W))}if(L.size>0){const A=Array.from(L.values()).sort((D,F)=>D-F);for(let D=A.length-1;D>=0;D--)C.splice(A[D],1)}}(E,v,l.json.nodes),E}function j4(l){l.heightmap=new Float32Array(4096),l.heightmap.fill(-1);const n=l.vertexArray.float32,o=l.aabb.min[0]-1,u=l.aabb.min[1]-1,g=Lg/(l.aabb.max[0]-o+2),d=Lg/(l.aabb.max[1]-u+2);for(let v=0;v<n.length;v+=3){const E=n[v+2],C=(n[v+0]-o)*g|0,z=(n[v+1]-u)*d|0;E>l.heightmap[z*Lg+C]&&(l.heightmap[z*Lg+C]=E)}}function G4(l,n){const o={};o.indexArray=new Ha,o.indexArray.reserve(4*l.length),o.vertexArray=new yl,o.vertexArray.reserve(10*l.length),o.colorArray=new $c,o.vertexArray.reserve(10*l.length);let u=0;for(const v of l){const E=Math.min(10,Math.max(4,1.3*v.height))*n,C=[-v.normal[1],v.normal[0],0],z=Math.min(.29,.1*v.width/v.depth),w=v.width-2*v.depth*n*(z+.01),R=Pe.vec3.scaleAndAdd([],v.pos,C,w/2),L=Pe.vec3.scaleAndAdd([],v.pos,C,-w/2),A=[R[0],R[1],R[2]+v.height],D=[L[0],L[1],L[2]+v.height],F=Pe.vec3.scaleAndAdd([],v.normal,C,z);Pe.vec3.scale(F,F,E);const W=Pe.vec3.scaleAndAdd([],v.normal,C,-z);Pe.vec3.scale(W,W,E),Pe.vec3.add(F,R,F),Pe.vec3.add(W,L,W),R[2]+=.1,L[2]+=.1,o.vertexArray.emplaceBack(F[0],F[1],F[2]),o.vertexArray.emplaceBack(W[0],W[1],W[2]),o.vertexArray.emplaceBack(R[0],R[1],R[2]),o.vertexArray.emplaceBack(L[0],L[1],L[2]),o.vertexArray.emplaceBack(A[0],A[1],A[2]),o.vertexArray.emplaceBack(D[0],D[1],D[2]),o.vertexArray.emplaceBack(R[0],R[1],R[2]),o.vertexArray.emplaceBack(L[0],L[1],L[2]),o.vertexArray.emplaceBack(F[0],F[1],F[2]),o.vertexArray.emplaceBack(W[0],W[1],W[2]);const $=w/E/2;o.colorArray.emplaceBack(-$-z,-1,$,.8),o.colorArray.emplaceBack($+z,-1,$,.8),o.colorArray.emplaceBack(-$,0,$,1.3),o.colorArray.emplaceBack($,0,$,1.3),o.colorArray.emplaceBack($+z,-.8,$,.7),o.colorArray.emplaceBack($+z,-.8,$,.7),o.colorArray.emplaceBack(0,0,$,1.3),o.colorArray.emplaceBack(0,0,$,1.3),o.colorArray.emplaceBack($+z,-1.2,$,.8),o.colorArray.emplaceBack($+z,-1.2,$,.8),o.indexArray.emplaceBack(6+u,4+u,8+u),o.indexArray.emplaceBack(7+u,9+u,5+u),o.indexArray.emplaceBack(0+u,1+u,2+u),o.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}const g={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=tr.white,g.pbrMetallicRoughness=d,o.material=g,o.aabb=new Rn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}class HD{constructor(n){this._stringToNumber={},this._numberToString=[];for(let o=0;o<n.length;o++){const u=n[o];this._stringToNumber[u]=o,this._numberToString[o]=u}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}const H4=["id","tile","layer","source","sourceLayer","state"];class Rv{constructor(n,o,u,g,d){this.type="Feature",this._vectorTileFeature=n,this._z=o,this._x=u,this._y=g,this.properties=n.properties,this.id=d}clone(){const n=new Rv(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(n.state=Object.assign({},this.state)),this.layer&&(n.layer=Object.assign({},this.layer)),this.source&&(n.source=this.source),this.sourceLayer&&(n.sourceLayer=this.sourceLayer),n}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const o of H4)this[o]!==void 0&&(n[o]=this[o]);return n}}class qD{constructor(n,o){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Pu(yn,16,0),this.featureIndexArray=new Wh,this.promoteId=o,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(n,o,u,g,d,v=0,E=0){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,g,d,v);const z=this.grid;for(let w=0;w<o.length;w++){const R=o[w],L=[1/0,1/0,-1/0,-1/0];for(let A=0;A<R.length;A++){const D=R[A];L[0]=Math.min(L[0],D.x),L[1]=Math.min(L[1],D.y),L[2]=Math.max(L[2],D.x),L[3]=Math.max(L[3],D.y)}E!==0&&(L[0]-=E,L[1]-=E,L[2]+=E,L[3]+=E),L[0]<yn&&L[1]<yn&&L[2]>=0&&L[3]>=0&&z.insert(C,L[0],L[1],L[2],L[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Sf.VectorTile(new _(this.rawTileData)).layers,this.sourceLayerCoder=new HD(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,o){const{tilespaceGeometry:u,transform:g,tileTransform:d,pixelPosMatrix:v,availableImages:E}=o;this.loadVTLayers(),this.serializedLayersCache.clear();const C=u.bufferedTilespaceBounds,z=this.grid.query(C.min.x,C.min.y,C.max.x,C.max.y,(A,D,F,W)=>Ke(u.bufferedTilespaceGeometry,A,D,F,W));z.sort(q4);let w=null;g.elevation&&z.length>0&&(w=wv.create(g.elevation,this.tileID));const R={};let L;for(let A=0;A<z.length;A++){const D=z[A];if(D===L)continue;L=D;const F=this.featureIndexArray.get(D);let W=null;this.is3DTile?this.loadMatchingModelFeature(R,F,n,u,g):this.loadMatchingFeature(R,F,n,E,($,ie,re,ee=0)=>(W||(W=q($,this.tileID.canonical,d)),ie.queryIntersectsFeature(u,$,re,W,this.z,g,v,w,ee)))}return R}loadMatchingFeature(n,o,u,g,d){const{featureIndex:v,bucketIndex:E,sourceLayerIndex:C,layoutVertexArrayOffset:z}=o,w=this.bucketLayerIDs[E],R=u.layers,L=Object.keys(R);if(L.length&&!function($,ie){for(let re=0;re<$.length;re++)if(ie.indexOf($[re])>=0)return!0;return!1}(L,w))return;const A=u.sourceCache,D=this.sourceLayerCoder.decode(C),F=this.vtLayers[D].feature(v),W=this.getId(F,D);for(let $=0;$<w.length;$++){const ie=w[$];if(!R[ie])continue;const{styleLayer:re,targets:ee}=R[ie];let ae={};W!==void 0&&(ae=A.getFeatureState(re.sourceLayer,W));const de=!d||d(F,re,ae,z);if(!de)continue;const ye=new Rv(F,this.z,this.x,this.y,W);ye.tile=this.tileID.canonical,ye.state=ae;let De=this.serializedLayersCache.get(ie);De||(De=re.serialize(),De.id=ie,this.serializedLayersCache.set(ie,De)),ye.source=De.source,ye.sourceLayer=De["source-layer"],ye.layer=On({},De),ye.layer.paint=WD(De.paint,re.paint,F,ae,g),ye.layer.layout=WD(De.layout,re.layout,F,ae,g);let Ie=!1;for(const Re of ee){this.updateFeatureProperties(ye,Re);const{filter:$e}=Re;if($e){if(F.properties=ye.properties,$e.needGeometry){const Oe=Z(F,!0);if(!$e.filter(new Er(this.tileID.overscaledZ),Oe,this.tileID.canonical))continue}else if(!$e.filter(new Er(this.tileID.overscaledZ),F))continue}Ie=!0,Re.targetId&&this.addFeatureVariant(ye,Re)}Ie&&this.appendToResult(n,ie,v,ye,de)}}loadMatchingModelFeature(n,o,u,g,d){const v=this.bucketLayerIDs[0][0],E=u.layers;if(!E[v])return;const{styleLayer:C,targets:z}=E[v];if(C.type!=="model")return;const w=g.tile,R=o.featureIndex,L=w.getBucket(C);if(!(L&&L instanceof l1))return;const A=function(De,Ie,Re,$e){const Oe=De.getNodesInfo()[Ie];if(Oe.hiddenByReplacement||!Oe.node.meshes)return;let Ye=Number.MAX_VALUE;const tt=Oe.node,Je=Re.tile,rt=$e.calculatePosMatrix(Je.tileID.toUnwrapped(),$e.worldSize),ct=Oe.evaluatedScale;let yt=0;$e.elevation&&tt.elevation&&(yt=tt.elevation*$e.elevation.exaggeration()),Pe.mat4.translate(rt,rt,[(tt.anchor?tt.anchor[0]:0)*(ct[0]-1),(tt.anchor?tt.anchor[1]:0)*(ct[1]-1),yt]),Pe.mat4.scale(rt,rt,ct);const st=Re.queryGeometry,Bt=st.isPointQuery()?st.screenBounds:st.screenGeometry,Qt=function(An){const xn=Pe.mat4.multiply([],rt,An.matrix);Pe.mat4.multiply(xn,$e.expandedFarZProjMatrix,xn);for(let cn=0;cn<An.meshes.length;++cn){const nn=An.meshes[cn];if(cn===An.lightMeshIndex)continue;const Hn=HI(Bt,$e,xn,nn.aabb);Hn!=null&&(Ye=Math.min(Hn,Ye))}if(An.children)for(const cn of An.children)Qt(cn)};if(Qt(tt),Ye===Number.MAX_VALUE)return;const Nt=new Ji(0,0);return nD(Je.tileID.canonical,Nt,Oe.node.anchor[0],Oe.node.anchor[1]),{intersectionZ:Ye,position:Nt,feature:Oe.feature}}(L,R,g,d);if(!A)return;const{z:D,x:F,y:W}=w.tileID.canonical,{feature:$,intersectionZ:ie,position:re}=A;let ee={};$.id!==void 0&&(ee=u.sourceCache.getFeatureState(C.sourceLayer,$.id));const ae=new Rv({},D,F,W,$.id);ae.tile=this.tileID.canonical,ae.state=ee,ae.properties=$.properties,ae.geometry={type:"Point",coordinates:[re.lng,re.lat]};let de=this.serializedLayersCache.get(v);de||(de=C.serialize(),de.id=v,this.serializedLayersCache.set(v,de)),ae.source=de.source,ae.sourceLayer=de["source-layer"],ae.layer=On({},de);let ye=!1;for(const De of z){this.updateFeatureProperties(ae,De);const{filter:Ie}=De;if(Ie){if($.properties=ae.properties,Ie.needGeometry){if(!Ie.filter(new Er(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!Ie.filter(new Er(this.tileID.overscaledZ),$))continue}ye=!0,De.targetId&&this.addFeatureVariant(ae,De)}ye&&this.appendToResult(n,v,R,ae,ie)}updateFeatureProperties(n,o,u){if(o.properties){const g={};for(const d in o.properties){const v=o.properties[d].evaluate({zoom:this.z},n._vectorTileFeature,n.state,n.tile,u);v!=null&&(g[d]=v)}n.properties=g}}addFeatureVariant(n,o,u){const g={target:o.target,namespace:o.namespace,uniqueFeatureID:o.uniqueFeatureID};o.properties&&(g.properties=n.properties),n.variants=n.variants||{},n.variants[o.targetId]=n.variants[o.targetId]||[],n.variants[o.targetId].push(g)}appendToResult(n,o,u,g,d){let v=n[o];v===void 0&&(v=n[o]=[]),v.push({featureIndex:u,feature:g,intersectionZ:d})}lookupSymbolFeatures(n,o,u,g,d){const v={};this.loadVTLayers();for(const E of n)this.loadMatchingFeature(v,{bucketIndex:o,sourceLayerIndex:u,featureIndex:E,layoutVertexArrayOffset:0},g,d);return v}loadFeature(n){const{featureIndex:o,sourceLayerIndex:u}=n;this.loadVTLayers();const g=this.sourceLayerCoder.decode(u),d=this.vtFeatures[g];if(d[o])return d[o];const v=this.vtLayers[g].feature(o);return d[o]=v,v}hasLayer(n){for(const o of this.bucketLayerIDs)for(const u of o)if(n===u)return!0;return!1}getId(n,o){let u=n.id;if(this.promoteId){const g=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[o];if(g!=null)if(Array.isArray(g)){if(!this.promoteIdExpression){const d=ya(g);if(d.result!=="success"){const v=d.value.map(E=>`${E.key}: ${E.message}`).join(", ");return void Wn(`Failed to create expression for promoteId: ${v}`)}this.promoteIdExpression=d.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new jm),u=this.promoteIdExpression.evaluate({zoom:0},n)}else u=n.properties[g];typeof u=="boolean"&&(u=Number(u))}return u}}function WD(l,n,o,u,g){return _i(l,(d,v)=>{const E=n instanceof Lu?n.get(v):null;return E&&E.evaluate?E.evaluate(o,u,g):E})}function q4(l,n){return n-l}Ln(qD,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const $D=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class qM{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,u]=new Uint8Array(n,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=u>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const d=$D[15&u];if(!d)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(n,2,1),[E]=new Uint32Array(n,4,1);return new qM(E,v,d,n)}constructor(n,o=64,u=Float64Array,g){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=u,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const d=$D.indexOf(this.ArrayType),v=2*n*this.ArrayType.BYTES_PER_ELEMENT,E=n*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-E%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${u}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+E+C,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+v+E+C),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+E+C,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=n)}add(n,o){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=n,this.coords[this._pos++]=o,u}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return WM(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,o,u,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:v,nodeSize:E}=this,C=[0,d.length-1,0],z=[];for(;C.length;){const w=C.pop()||0,R=C.pop()||0,L=C.pop()||0;if(R-L<=E){for(let W=L;W<=R;W++){const $=v[2*W],ie=v[2*W+1];$>=n&&$<=u&&ie>=o&&ie<=g&&z.push(d[W])}continue}const A=L+R>>1,D=v[2*A],F=v[2*A+1];D>=n&&D<=u&&F>=o&&F<=g&&z.push(d[A]),(w===0?n<=D:o<=F)&&(C.push(L),C.push(A-1),C.push(1-w)),(w===0?u>=D:g>=F)&&(C.push(A+1),C.push(R),C.push(1-w))}return z}within(n,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:d,nodeSize:v}=this,E=[0,g.length-1,0],C=[],z=u*u;for(;E.length;){const w=E.pop()||0,R=E.pop()||0,L=E.pop()||0;if(R-L<=v){for(let W=L;W<=R;W++)ZD(d[2*W],d[2*W+1],n,o)<=z&&C.push(g[W]);continue}const A=L+R>>1,D=d[2*A],F=d[2*A+1];ZD(D,F,n,o)<=z&&C.push(g[A]),(w===0?n-u<=D:o-u<=F)&&(E.push(L),E.push(A-1),E.push(1-w)),(w===0?n+u>=D:o+u>=F)&&(E.push(A+1),E.push(R),E.push(1-w))}return C}}function WM(l,n,o,u,g,d){if(g-u<=o)return;const v=u+g>>1;XD(l,n,v,u,g,d),WM(l,n,o,u,v-1,1-d),WM(l,n,o,v+1,g,1-d)}function XD(l,n,o,u,g,d){for(;g>u;){if(g-u>600){const z=g-u+1,w=o-u+1,R=Math.log(z),L=.5*Math.exp(2*R/3),A=.5*Math.sqrt(R*L*(z-L)/z)*(w-z/2<0?-1:1);XD(l,n,o,Math.max(u,Math.floor(o-w*L/z+A)),Math.min(g,Math.floor(o+(z-w)*L/z+A)),d)}const v=n[2*o+d];let E=u,C=g;for(jx(l,n,u,o),n[2*g+d]>v&&jx(l,n,u,g);E<C;){for(jx(l,n,E,C),E++,C--;n[2*E+d]<v;)E++;for(;n[2*C+d]>v;)C--}n[2*u+d]===v?jx(l,n,u,C):(C++,jx(l,n,C,g)),C<=o&&(u=C+1),o<=C&&(g=C-1)}}function jx(l,n,o,u){$M(l,o,u),$M(n,2*o,2*u),$M(n,2*o+1,2*u+1)}function $M(l,n,o){const u=l[n];l[n]=l[o],l[o]=u}function ZD(l,n,o,u){const g=l-o,d=n-u;return g*g+d*d}r.$=tg,r.A=so,r.B=2,r.C=Ex,r.D=Sv,r.E=Fl,r.F=sI,r.G=class extends o1{},r.H=Xs,r.I=kM,r.J=Pd,r.K=Mp,r.L=Ao,r.M=Ih,r.N=Dh,r.O=Ph,r.P=ke,r.Q=tf,r.R=Vn,r.S=Oh,r.T=wM,r.U=ya,r.V=o1,r.W=Eh,r.X=co,r.Y=bu,r.Z=zo,r._=Ss,r.a=function(l){return Sr.API_CDN_URL_REGEX.test(l)},r.a$=Rv,r.a0=Is,r.a1=bp,r.a2=function(l){const n=l.value;let o=[];if(!n)return o;const u=Xs(n);return u!=="string"?(o=o.concat([new o1(l.key,n,`string expected, "${u}" found`)]),o):(WI(n,!0)||(o=o.concat([new o1(l.key,n,`invalid url "${n}"`)])),o)},r.a3=bt,r.a4=Bh,r.a5=$r,r.a6=hn,r.a7=class{constructor(l){this.specification=l}possiblyEvaluate(l,n){return on(l.expression.evaluate(n))}interpolate(l,n,o){return{x:oi(l.x,n.x,o),y:oi(l.y,n.y,o),z:oi(l.z,n.z,o),azimuthal:oi(l.azimuthal,n.azimuthal,o),polar:oi(l.polar,n.polar,o)}}},r.a8=Er,r.a9=$l,r.aA=Ns,r.aB=class{constructor(l){this.entries={},this.scheduler=l}request(l,n,o,u){const g=this.entries[l]=this.entries[l]||{callbacks:[]};if(g.result){const[d,v]=g.result;return this.scheduler?this.scheduler.add(()=>{u(d,v)},n):u(d,v),()=>{}}return g.callbacks.push(u),g.cancel||(g.cancel=o((d,v)=>{g.result=[d,v];for(const E of g.callbacks)this.scheduler?this.scheduler.add(()=>{E(d,v)},n):E(d,v);setTimeout(()=>delete this.entries[l],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(d=>d!==u),g.callbacks.length||(g.cancel(),delete this.entries[l]))}}},r.aC=ds,r.aD=function(l,n,o){const u=JSON.stringify(l.request);return l.data&&(this.deduped.entries[u]={result:[null,l.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},g=>{const d=qi(l.request,(v,E,C,z)=>{v?g(v):E&&g(null,{vectorTile:o?void 0:new Sf.VectorTile(new _(E)),rawData:E,cacheControl:C,expires:z})});return()=>{d.cancel(),g()}},n)},r.aE=function(l){vt++,vt>St&&(l.getActor().send("enforceCacheSizeLimit",nt),vt=0)},r.aF=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log(l)/Math.LN2))},r.aG=rn,r.aH=LI,r.aI=BI,r.aJ=PI,r.aK=function(l,n){const o=document.createElement("video");o.muted=!0,o.onloadstart=function(){n(null,o)};for(let u=0;u<l.length;u++){const g=document.createElement("source");Ci(l[u])||(o.crossOrigin="Anonymous"),g.src=l[u],o.appendChild(g)}return{cancel:()=>{}}},r.aL=t1,r.aM=function(l){return fetch(l).then(n=>n.arrayBuffer()).then(n=>VD(n,0,l))},r.aN=GD,r.aO=class{constructor(l,n,o,u){this.id=l,this.position=n!=null?new Ji(n[0],n[1]):new Ji(0,0),this.orientation=o??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new Rn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(l,n){if(Pe.mat4.multiply(l.matrix,n,l.matrix),l.meshes)for(const o of l.meshes){const u=Rn.applyTransformFast(o.aabb,l.matrix);this.aabb.encapsulate(u)}if(l.children)for(const o of l.children)this._applyTransformations(o,l.matrix)}computeBoundsAndApplyParent(){const l=Pe.mat4.identity([]);for(const n of this.nodes)this._applyTransformations(n,l)}computeModelMatrix(l,n,o,u,g,d,v=!1){KI(this.matrix,this,l.transform,this.position,n,o,u,g,d,v)}upload(l){if(!this.uploaded){for(const n of this.nodes)AM(n,l);for(const n of this.nodes)s1(n);this.uploaded=!0}}destroy(){for(const l of this.nodes)CM(l)}},r.aP=si,r.aQ=Tx,r.aR=Ro,r.aS=Ra,r.aT=Js,r.aU=Ha,r.aV=Ni,r.aW=Lp,r.aX=Qb,r.aY=function(){Br.isLoading()||Br.isLoaded()||Nh()!=="deferred"||ho()},r.aZ=ng,r.a_=Z,r.aa=s,r.ab=Pe,r.ac=Kt,r.ad=Lu,r.ae=mo,r.af=oi,r.ag=yn,r.ah=_u,r.ai=Mn,r.aj=tr,r.ak=class{constructor(l){this.specification=l}possiblyEvaluate(l,n){return function([o,u]){const g=on([1,o,u]);return{x:g.x,y:g.y,z:g.z}}(l.expression.evaluate(n))}interpolate(l,n,o){return{x:oi(l.x,n.x,o),y:oi(l.y,n.y,o),z:oi(l.z,n.z,o)}}},r.al=function(l,n,o=0,u=!0){const g=new ke(o,o),d=l.sub(g),v=n.add(g),E=[d,new ke(v.x,d.y),v,new ke(d.x,v.y)];return u&&E.push(d.clone()),E},r.am=function(l,n){const o=[];for(let u=0;u<l.length;u++){const g=an(u-1,-1,l.length-1),d=an(u+1,-1,l.length-1),v=l[u],E=l[d],C=l[g].sub(v).unit(),z=E.sub(v).unit(),w=z.angleWithSep(C.x,C.y),R=C.add(z).unit().mult(-1*n/Math.sin(w/2));o.push(v.add(R))}return o},r.an=vI,r.ao=Ke,r.ap=function(l,n,o=0){return Pe.vec3.fromValues(((n.x-o)*l.scale-l.x)*yn,(n.y*l.scale-l.y)*yn,El(n.z,n.y))},r.aq=mi,r.ar=px,r.as=function(l){let n=1/0,o=1/0,u=-1/0,g=-1/0;for(const d of l)n=Math.min(n,d.x),o=Math.min(o,d.y),u=Math.max(u,d.x),g=Math.max(g,d.y);return{min:new ke(n,o),max:new ke(u,g)}},r.at=rl,r.au=Be,r.av=x,r.aw=gt,r.ax=fo,r.ay=function(l,n){const o={};for(let u=0;u<n.length;u++){const g=n[u];g in l&&(o[g]=l[g])}return o},r.az=nc,r.b=function(l){return Sr.API_FONTS_REGEX.test(l)},r.b$=r1,r.b0=Kn,r.b1=Cf,r.b2=J_,r.b3=q,r.b4=vl,r.b5=Ql,r.b6=Zn,r.b7=Jr,r.b8=mg,r.b9=yM,r.bA=Rb,r.bB=fM,r.bC=pI,r.bD=Ft,r.bE=qM,r.bF=an,r.bG=Vi,r.bH=po,r.bI=function(l,n,o){l[4*n+0]=o[0],l[4*n+1]=o[1],l[4*n+2]=o[2],l[4*n+3]=o[3]},r.bJ=pf,r.bK=fs,r.bL=Kc,r.bM=aa,r.bN=Uu,r.bO=Ji,r.bP=SI,r.bQ=Gt,r.bR=Qi,r.bS=VI,r.bT=Zt,r.bU=ha,r.bV=function(l,n,o,u,g,d,v,E,C){if(C.name==="globe")return ha(l,n,new Zt(o,u,g),!1);const z=Tx({z:o,x:u,y:g},C);return new Rn([(d+z.x/z.scale)*n,n*(z.y/z.scale),v],[(d+z.x2/z.scale)*n,n*(z.y2/z.scale),E])},r.bW=function(l,n,o){let u=0;for(let g=0;g<2;++g)l[g]>0&&(u+=(l[g]-0)*(l[g]-0)),n[g]<0&&(u+=(0-n[g])*(0-n[g]));return u},r.bX=Mr,r.bY=tc,r.bZ=function(l){const n=Pe.mat4.identity(new Float64Array(16));Pe.mat4.multiply(n,l.pixelMatrix,l.globeMatrix);const o=[0,bo,0],u=[0,wo,0];return Pe.vec3.transformMat4(o,o,n),Pe.vec3.transformMat4(u,u,n),[o[0]>0&&o[0]<=l.width&&o[1]>0&&o[1]<=l.height&&!to(l,new Ji(l.center.lat,90)),u[0]>0&&u[0]<=l.width&&u[1]>0&&u[1]<=l.height&&!to(l,new Ji(l.center.lat,-90))]},r.b_=function(l,n){const{scale:o}=l.tileTransform,u=o*yn/(l.tileSize*Math.pow(2,n.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return Pe.mat2.scale(new Float32Array(4),n.inverseAdjustmentMatrix,[u,u])},r.ba=function(l,n){const o=mo(n.zoom);if(o===0)return jr(l);const u=Yi(l),g=hr(u),d=rl(u.getWest())*n.worldSize,v=rl(u.getEast())*n.worldSize,E=Ns(u.getNorth())*n.worldSize,C=Ns(u.getSouth())*n.worldSize,z=[d,E,0],w=[v,E,0],R=[d,C,0],L=[v,C,0],A=Pe.mat4.invert([],n.globeMatrix);return Pe.vec3.transformMat4(z,z,A),Pe.vec3.transformMat4(w,w,A),Pe.vec3.transformMat4(R,R,A),Pe.vec3.transformMat4(L,L,A),g[0]=ea(g[0],R,o),g[1]=ea(g[1],L,o),g[2]=ea(g[2],w,o),g[3]=ea(g[3],z,o),Rn.fromPoints(g)},r.bb=la,r.bc=ur,r.bd=ea,r.be=zu,r.bf=Yn,r.bg=UM,r.bh=_,r.bi=qi,r.bj=function(l){const n=[];for(const o in l)n.push(l[o]);return n},r.bk=function(l,n){const o=[];for(const u in l)u in n||o.push(u);return o},r.bl=Xn,r.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.bn=Fi,r.bo=function(l,n){const{x:o,y:u}=l.point,g=Io(o,u,l.worldSize/l._pixelsPerMercatorPixel,0,0);return Pe.mat4.multiply(g,g,mr(jr(n)))},r.bp=If,r.bq=He,r.br=Rf,r.bs=function(l,n,o,u,g){const d=5*n+2;l.float32[d+0]=o,l.float32[d+1]=u,l.float32[d+2]=g},r.bt=Jb,r.bu=oI,r.bv=ue,r.bw=go,r.bx=rv,r.by=qI,r.bz=ix,r.c=xc,r.c$=(l,n,o,u,g,d,v,E)=>{const C=l.transform,z=C.pitch<15?mx(.07,.7,gt((14-C.zoom)/5,0,1)):.07,w=o.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:gx(l,n,o,u),u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:C.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:g,u_width_scale:d,u_floor_width_scale:v,u_image:0,u_tile_units_to_pixels:hv(n,C),u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:E,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toRenderColor(w?null:o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength"),u_zbias_factor:z,u_tile_to_meter:i(n.tileID.canonical,0)}},r.c0=UI,r.c1=function(l){const n=UI(l,!0);return Pe.mat2.invert([],[n[0],n[1],n[4],n[5]])},r.c2=gi,r.c3=function(l){const{x:n,y:o}=l.point,{lng:u,lat:g}=l._center;return Io(n,o,l.worldSize,u,g)},r.c4=wi,r.c5=mn,r.c6=ms,r.c7=function(l){const n=Math.round((l+45+360)%360/90)%4;return ei[n]},r.c8=45,r.c9=mf,r.cA=class extends ks{constructor(l){super(l),this.current=Fp}set(l,n,o){if(this.fetchUniformLocation(l,n)){for(let u=0;u<9;u++)if(o[u]!==this.current[u]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},r.cB=ot,r.cC=function(l,n,o){const u=mo(o.zoom),g=l.style.map._antialias,d=l.terrain&&l.terrain.exaggeration()>0;return u===0&&!g&&!d},r.cD=function(l){const n=l.pixelsPerMeter,o=n/po(1,l.center.lat),u=Pe.mat4.identity(new Float64Array(16));return Pe.mat4.translate(u,u,[l.point.x,l.point.y,0]),Pe.mat4.scale(u,u,[o,o,n]),Float32Array.from(u)},r.cE=Yi,r.cF=function(l){const n=Mr-5;l=gt(l,-80.051129,n)/n*90;const o=Math.pow(Math.abs(Math.sin(Mn(l))),3);return Math.round(o*(Yh.length-1))},r.cG=function(l,n,o,u){const g=n.getNorth(),d=n.getSouth(),v=n.getWest(),E=n.getEast(),C=1<<l.z,z=E-v,w=g-d,R=z/Jc,L=-w/Yh[o],A=[0,R,0,L,0,0,g,v,0];if(l.z>0){const D=180/u;Pe.mat3.multiply(A,A,[D/z+1,0,0,0,D/w+1,0,-.5*D/R,.5*D/L,1])}return A[2]=C,A[5]=l.x,A[8]=l.y,A},r.cH=jr,r.cI=function(l,n,o){const u=Pe.mat4.identity(new Float64Array(16)),g=(n/(1<<l)-.5)*Math.PI*2;return Pe.mat4.rotateY(u,o.globeMatrix,g),Float32Array.from(u)},r.cJ=class{isDataAvailableAtPoint(l){const n=this._source();if(this.isUsingMockSource()||!n||l.y<0||l.y>1)return!1;const o=n.getSource().maxzoom,u=1<<o,g=Math.floor(l.x),d=Math.floor((l.x-g)*u),v=Math.floor(l.y*u),E=this.findDEMTileFor(new rn(o,g,o,d,v));return!(!E||!E.dem)}getAtPointOrZero(l,n=0){return this.getAtPoint(l,n)||0}getAtPoint(l,n,o=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const u=this._source();if(!u||l.y<0||l.y>1)return n;const g=u.getSource().maxzoom,d=1<<g,v=Math.floor(l.x),E=l.x-v,C=new rn(g,v,g,Math.floor(E*d),Math.floor(l.y*d)),z=this.findDEMTileFor(C);if(!z||!z.dem)return n;const w=z.dem,R=1<<z.tileID.canonical.z,L=(E*R-z.tileID.canonical.x)*w.dim,A=(l.y*R-z.tileID.canonical.y)*w.dim,D=Math.floor(L),F=Math.floor(A);return(o?this.exaggeration():1)*oi(oi(w.get(D,F),w.get(D,F+1),A-F),oi(w.get(D+1,F),w.get(D+1,F+1),A-F),L-D)}getAtTileOffset(l,n,o){const u=1<<l.canonical.z;return this.getAtPointOrZero(new s(l.wrap+(l.canonical.x+n/yn)/u,(l.canonical.y+o/yn)/u))}getAtTileOffsetFunc(l,n,o,u){return g=>{const d=this.getAtTileOffset(l,g.x,g.y),v=u.upVector(l.canonical,g.x,g.y),E=u.upVectorScale(l.canonical,n,o).metersToTile;return Pe.vec3.scale(v,v,d*E),v}}getForTilePoints(l,n,o,u){if(this.isUsingMockSource())return!1;const g=wv.create(this,l,u);return!!g&&(n.forEach(d=>{d[2]=this.exaggeration()*g.getElevationAt(d[0],d[1],o)}),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(l);if(!n||!n.dem)return null;const o=n.dem.tree,u=n.tileID,g=1<<l.canonical.z-u.canonical.z;let d=l.canonical.x/g-u.canonical.x,v=l.canonical.y/g-u.canonical.y,E=0;for(let C=0;C<l.canonical.z-u.canonical.z&&!o.leaves[E];C++){d*=2,v*=2;const z=2*Math.floor(v)+Math.floor(d);E=o.childOffsets[E]+z,d%=1,v%=1}return{min:this.exaggeration()*o.minimums[E],max:this.exaggeration()*o.maximums[E]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,n,o){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const l=this.visibleDemTiles;if(l.length===0)return null;let n=!1,o=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const g of l){const d=this.getMinMaxForTile(g.tileID);d&&(o=Math.min(o,d.min),u=Math.max(u,d.max),n=!0)}return n?{min:o,max:u}:null}},r.cK=Xy,r.cL=li,r.cM=function(l,n){return[Math.pow(l[0],2.2)*n,Math.pow(l[1],2.2)*n,Math.pow(l[2],2.2)*n]},r.cN=ns,r.cO=oo,r.cP=Cr,r.cQ=256,r.cR=function(l,n){const o=[0,0,0],u=la(jr(n.canonical));return Pe.vec3.transformMat4(o,o,u),Pe.vec3.transformMat4(o,o,l),o},r.cS=l=>({u_camera_to_center_distance:new aa(l),u_extrude_scale:new ec(l),u_device_pixel_ratio:new aa(l),u_matrix:new pf(l),u_inv_rot_matrix:new pf(l),u_merc_center:new fs(l),u_tile_id:new Kc(l),u_zoom_transition:new aa(l),u_up_dir:new Kc(l),u_emissive_strength:new aa(l)}),r.cT=l=>({u_matrix:new pf(l),u_pixels_to_tile_units:new ec(l),u_device_pixel_ratio:new aa(l),u_width_scale:new aa(l),u_floor_width_scale:new aa(l),u_units_to_pixels:new fs(l),u_dash_image:new Uu(l),u_gradient_image:new Uu(l),u_image_height:new aa(l),u_texsize:new fs(l),u_tile_units_to_pixels:new aa(l),u_alpha_discard_threshold:new aa(l),u_trim_offset:new fs(l),u_trim_fade_range:new fs(l),u_trim_color:new Xh(l),u_emissive_strength:new aa(l),u_zbias_factor:new aa(l),u_tile_to_meter:new aa(l)}),r.cU=l=>({u_matrix:new pf(l),u_texsize:new fs(l),u_pixels_to_tile_units:new ec(l),u_device_pixel_ratio:new aa(l),u_width_scale:new aa(l),u_floor_width_scale:new aa(l),u_image:new Uu(l),u_units_to_pixels:new fs(l),u_tile_units_to_pixels:new aa(l),u_alpha_discard_threshold:new aa(l),u_trim_offset:new fs(l),u_trim_fade_range:new fs(l),u_trim_color:new Xh(l),u_emissive_strength:new aa(l),u_zbias_factor:new aa(l),u_tile_to_meter:new aa(l)}),r.cV=lf,r.cW=lM,r.cX=cM,r.cY=eu,r.cZ=(l,n,o,u,g,d)=>{const v=l.transform,E=v.projection.name==="globe";let C;if(d.paint.get("circle-pitch-alignment")==="map")if(E){const w=ns(v.zoom,n.canonical)*v._pixelsPerMercatorPixel;C=Float32Array.from([w,0,0,w])}else C=v.calculatePixelsToTileUnitsMatrix(o);else C=new Float32Array([v.pixelsToGLUnits[0],0,0,v.pixelsToGLUnits[1]]);const z={u_camera_to_center_distance:l.transform.getCameraToCenterDistance(v.projection),u_matrix:l.translatePosMatrix(n.projMatrix,o,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:je.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:ic,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(E){z.u_inv_rot_matrix=u,z.u_merc_center=g,z.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],z.u_zoom_transition=mo(v.zoom);const w=g[0]*yn,R=g[1]*yn;z.u_up_dir=v.projection.upVector(new Zt(0,0,0),w,R)}return z},r.c_=Cg,r.ca=Xh,r.cb=function(l,n,o){const u=Math.sqrt(l*l+n*n+o*o),g=u>0?Math.acos(o/u)*bi:0;let d=l!==0||n!==0?Math.atan2(-n,-l)*bi+90:0;return d<0&&(d+=360),[u,d,g]},r.cc=i,r.cd=Rn,r.ce=on,r.cf=function(l){return[Math.pow(l[0],1/2.2),Math.pow(l[1],1/2.2),Math.pow(l[2],1/2.2)]},r.cg=function(l,n){return l.readFields(VB,{icons:[]},n)},r.ch=function(l){return l({pluginStatus:Fo,pluginURL:Kl}),Uc.on("pluginStateChange",l),l},r.ci=c1,r.cj=vv,r.ck=hM,r.cl=or,r.cm=eg,r.cn=Qe,r.co=ra,r.cp=Ai,r.cq=function(l){const n=l.indexOf(rf);return n>=0?l.slice(0,n):l},r.cr=function(l){return l.indexOf(rf)>=0},r.cs=function(l){const n=l.indexOf(rf);return n>=0?l.slice(n+1):""},r.ct=function(l){const n=[],o=l.id;return o===void 0&&n.push({message:`layers.${o}: missing required property "id"`}),l.render===void 0&&n.push({message:`layers.${o}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&n.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),n},r.cu=function(l,n,o,u){return l.type==="custom"?new AB(l,n):new NB[l.type](l,n,o,u)},r.cv=ui,r.cw=class extends Rv{constructor(l,n){super(l._vectorTileFeature,l._z,l._x,l._y,l.id),l.state&&(this.state=Object.assign({},l.state)),this.target=n.target,this.namespace=n.namespace,n.properties&&(this.properties=n.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=l.source,this.sourceLayer=l.sourceLayer,this.layer=l.layer)}toJSON(){const l=super.toJSON();return l.target=this.target,l.namespace=this.namespace,l}},r.cx=Uc,r.cy=er,r.cz=bl,r.d=function(l){return Sr.API_TILEJSON_REGEX.test(l)},r.d$=qD,r.d0=(l,n,o,u,g,d,v,E,C)=>{const z=l.transform,w=z.calculatePixelsToTileUnitsMatrix(n),R=o.paint.get("line-trim-color-use-theme").constantOr("default")==="none",L=z.pitch<15?mx(.07,.7,gt((14-z.zoom)/5,0,1)):.07;return{u_matrix:gx(l,n,o,u),u_pixels_to_tile_units:w,u_device_pixel_ratio:d,u_width_scale:v,u_floor_width_scale:E,u_units_to_pixels:[1/z.pixelsToGLUnits[0],1/z.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:Bb(o)&&n.lineAtlasTexture?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:hv(n,l.transform),u_alpha_discard_threshold:0,u_trim_offset:C,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toRenderColor(R?null:o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength"),u_zbias_factor:L,u_tile_to_meter:i(n.tileID.canonical,0)}},r.d1=Un,r.d2=vf,r.d3=Tf,r.d4=Cn,r.d5=lv,r.d6=So,r.d7=450,r.d8=7,r.d9=TB,r.dA=Yt,r.dB=f,r.dC=Qc,r.dD=function([l,n,o]){const u=Math.hypot(l,n,o),g=Math.atan2(l,o),d=.5*Math.PI-Math.acos(-n/u);return new Ji(wi(g),wi(d))},r.dE=EM,r.dF=function(l){const n=l.navigator?l.navigator.userAgent:null;return!!function(o){if(ti==null){const u=o.navigator?o.navigator.userAgent:null;ti=!!o.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return ti}(l)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.dG=function(l,n){nt=l,St=n},r.dH=to,r.dI=_s,r.dJ=function(l){const n=[0,0,0],o=Pe.mat4.identity(new Float64Array(16));return Pe.mat4.multiply(o,l.pixelMatrix,l.globeMatrix),Pe.vec3.transformMat4(n,n,o),new ke(n[0],n[1])},r.dK=function(l,n,o=!1){if(Fo===Jd||Fo===xa||Fo===Qd)throw new Error("setRTLTextPlugin cannot be called multiple times.");Kl=je.resolveURL(l),Fo=Jd,Ds=n,ef(),o||ho()},r.dL=Nh,r.dM=function(){c1().acquire(IM)},r.dN=function(){const l=Ox;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(IM),Ox=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dO=zg,r.dP=function(l){const n=Ze();if(!n)return;const o=n.delete(ft);l&&o.catch(l).then(()=>l())},r.dQ=Lx,r.dR=OD,r.dS=function(l){VM=je.resolveURL(l),Cv||(Cv=new Sv(c1(),new Fl)),Cv.broadcast("setDracoUrl",VM)},r.dT=zD,r.dU=function(l){Av=je.resolveURL(l),Cv||(Cv=new Sv(c1(),new Fl)),Cv.broadcast("setMeshoptUrl",Av)},r.dV=Ln,r.dW=Hu,r.dX=$u,r.dY=Sf,r.dZ=class{constructor(l,n){this.pos=l,this.dir=n}intersectsPlane(l,n,o){const u=Pe.vec2.dot(n,this.dir);if(Math.abs(u)<1e-6)return!1;const g=((l[0]-this.pos[0])*n[0]+(l[1]-this.pos[1])*n[1])/u;return o[0]=this.pos[0]+this.dir[0]*g,o[1]=this.pos[1]+this.dir[1]*g,!0}},r.d_=HD,r.da=sr,r.db=Pp,r.dc=256,r.dd=mr,r.de=yl,r.df=No,r.dg=xl,r.dh=function(l,n,o,u,g){return gt((l-n)/(o-n)*(g-u)+u,u,g)},r.di=kc,r.dj=Gu,r.dk=class{constructor(l,n,o,u){this.context=l,this.format=u,this.size=o,this.texture=l.gl.createTexture();const[g,d,v]=this.size,{gl:E}=l;E.bindTexture(E.TEXTURE_3D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),E.texImage3D(E.TEXTURE_3D,0,this.format,g,d,v,0,xM(this.format),bM(this.format),n.data)}bind(l,n){const{context:o}=this,{gl:u}=o;u.bindTexture(u.TEXTURE_3D,this.texture),l!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,l),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,l),this.minFilter=l),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}},r.dl=MM,r.dm=[1,1,1],r.dn=wv,r.dp=bv,r.dq=Xc,r.dr=ku,r.ds=il,r.dt=Hh,r.du=zs,r.dv=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new ke(1/0,1/0),max:new ke(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(l,n=!1){const o=ov(new ke(0,0),new ke(yn,yn),l),u=[];if(n&&!av(o,this._globalClipBounds))return u;for(const g of this._activeRegions){if(g.hiddenByOverlap||!av(o,g))continue;const d=KE(g.min,g.max,l);u.push({min:d.min,max:d.max,sourceId:this._sourceIds[g.priority],footprint:g.footprint,footprintTileId:g.tileId,order:g.order,clipMask:g.clipMask,clipScope:g.clipScope})}return u}setSources(l){this._setSources(l.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const o=[];for(const u of n.cache.getVisibleCoordinates()){const g=n.cache.getTile(u).buckets[n.layer];g&&g.updateFootprints(u.toUnwrapped(),o)}return o},getOrder:()=>n.order,getClipMask:()=>n.clipMask,getClipScope:()=>n.clipScope})))}_addSource(l){const n=l.getFootprints();if(n.length===0)return;const o=l.getOrder(),u=l.getClipMask(),g=l.getClipScope();for(const d of n){if(!d.footprint)continue;const v=ov(d.footprint.min,d.footprint.max,d.id);this._activeRegions.push({min:v.min,max:v.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:d.id,footprint:d.footprint,order:o,clipMask:u,clipScope:g})}this._sourceIds.push(l.getSourceId())}_computeReplacement(){this._activeRegions.sort((n,o)=>n.priority-o.priority||Ef(n.min,o.min)||Ef(n.max,o.max)||n.order-o.order||n.clipMask-o.clipMask||function(u,g){const d=(v,E)=>v+E;return u.length-g.length||u.reduce(d,"").localeCompare(g.reduce(d,""))}(n.clipScope,o.clipScope));let l=this._activeRegions.length!==this._prevRegions.length;if(!l){let n=0;for(;!l&&n!==this._activeRegions.length;){const o=this._activeRegions[n],u=this._prevRegions[n];l=o.priority!==u.priority||!tx(o,u)||o.order!==u.order||o.clipMask!==u.clipMask||!Fi(o.clipScope,u.clipScope),++n}}if(l){++this._updateTime;for(const o of this._activeRegions)o.order!==qp&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,o.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,o.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,o.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,o.max.y));const n=o=>{const u=this._activeRegions;if(o>=u.length)return o;const g=u[o].priority;for(;o<u.length&&u[o].priority===g;)++o;return o};if(this._sourceIds.length>1){let o=0,u=n(o);for(;o!==u;){let g=o;const d=o;for(;g!==u;){const v=this._activeRegions[g];v.hiddenByOverlap=!1;for(let E=0;E<d;E++){const C=this._activeRegions[E];if(!C.hiddenByOverlap&&v.order===qp&&av(v,C)&&(v.hiddenByOverlap=Cb(v.footprint,v.tileId,C.footprint,C.tileId),v.hiddenByOverlap))break}++g}o=u,u=n(o)}}}}_setSources(l){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=l.length-1;n>=0;n--)this._addSource(l[n]);this._computeReplacement()}},r.dw=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const l of this._poleSegments)l.destroy();for(const l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy()}_fillGridMeshWithLods(l,n){const o=new vl,u=new Ha,g=[],d=l+1+2,v=n[0]+1,E=n[0]+1+(1+n.length),C=(z,w,R)=>{let L=z===d-1?z-2:z===0?z:z-1;return L+=R?24575:0,[L,w]};for(let z=0;z<d;++z)o.emplaceBack(...C(z,0,!0));for(let z=0;z<v;++z)for(let w=0;w<d;++w)o.emplaceBack(...C(w,z,(w===0||w===d-1)&&!0));for(let z=0;z<n.length;++z){const w=n[z];for(let R=0;R<d;++R)o.emplaceBack(...C(R,w,!0))}for(let z=0;z<n.length;++z){const w=u.length,R=n[z]+1+2,L=new Ha;for(let F=0;F<R-1;F++){const W=F===R-2,$=W?d*(E-n.length+z-F):d;for(let ie=0;ie<d-1;ie++){const re=F*d+ie;F===0||W||ie===0||ie===d-2?(L.emplaceBack(re+1,re,re+$),L.emplaceBack(re+$,re+$+1,re+1)):(u.emplaceBack(re+1,re,re+$),u.emplaceBack(re+$,re+$+1,re+1))}}const A=Jr.simpleSegment(0,w,o.length,u.length-w);for(let F=0;F<L.uint16.length;F+=3)u.emplaceBack(L.uint16[F],L.uint16[F+1],L.uint16[F+2]);const D=Jr.simpleSegment(0,w,o.length,u.length-w);g.push({withoutSkirts:A,withSkirts:D})}return{vertices:o,indices:u,segments:g}}_createGrid(l){const n=this._fillGridMeshWithLods(Jc,Yh);this._gridSegments=n.segments,this._gridBuffer=l.createVertexBuffer(n.vertices,Zn.members),this._gridIndexBuffer=l.createIndexBuffer(n.indices,!0)}_createPoles(l){const n=new Ha;for(let v=0;v<=Jc;v++)n.emplaceBack(0,v+1,v+2);this._poleIndexBuffer=l.createIndexBuffer(n,!0);const o=new No,u=new No,g=new No,d=new No;this._poleSegments=[];for(let v=0,E=0;v<ms;v++){const C=360/(1<<v);o.emplaceBack(0,-fo,0,.5,0),u.emplaceBack(0,-fo,0,.5,1),g.emplaceBack(0,-fo,0,.5,.5),d.emplaceBack(0,-fo,0,.5,.5);for(let z=0;z<=Jc;z++){let w=z/Jc,R=0;const L=oi(0,C,w),[A,D,F]=Vu(vs,is,L,fo);o.emplaceBack(A,D,F,w,R),u.emplaceBack(A,D,F,w,1-R);const W=Mn(L);w=.5+.5*Math.sin(W),R=.5+.5*Math.cos(W),g.emplaceBack(A,D,F,w,R),d.emplaceBack(A,D,F,w,1-R)}this._poleSegments.push(Jr.simpleSegment(E,0,66,64)),E+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(o,ni,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(u,ni,!1),this._texturedPoleNorthVertexBuffer=l.createVertexBuffer(g,ni,!1),this._texturedPoleSouthVertexBuffer=l.createVertexBuffer(d,ni,!1)}getGridBuffers(l,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}},r.dx=qp,r.dy=Ue,r.dz=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.e=Sr,r.e0=Ag,r.e1=_i,r.e2=Ws,r.e3=lI,r.e4=function(l,n,o,u,g,d,v,E,C,z,w=1,R,L){l.createArrays(),l.tilePixelRatio=yn/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;const A=l.layers[0].layout,D=l.layers[0]._unevaluatedLayout._values,F={};F.scaleFactor=w,F.textSizeScaleRange=A.get("text-size-scale-range"),F.iconSizeScaleRange=A.get("icon-size-scale-range");const[W,$]=F.textSizeScaleRange,[ie,re]=F.iconSizeScaleRange;if(F.textScaleFactor=gt(F.scaleFactor,W,$),F.iconScaleFactor=gt(F.scaleFactor,ie,re),l.textSizeData.kind==="composite"){const{minZoom:ye,maxZoom:De}=l.textSizeData;F.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Er(ye),E),D["text-size"].possiblyEvaluate(new Er(De),E)]}if(l.iconSizeData.kind==="composite"){const{minZoom:ye,maxZoom:De}=l.iconSizeData;F.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Er(ye),E),D["icon-size"].possiblyEvaluate(new Er(De),E)]}F.layoutTextSize=D["text-size"].possiblyEvaluate(new Er(C+1),E),F.layoutIconSize=D["icon-size"].possiblyEvaluate(new Er(C+1),E),F.textMaxSize=D["text-size"].possiblyEvaluate(new Er(18),E);const ee=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",ae=A.get("text-size");let de=!1;for(const ye of l.features)if(ye.icon&&ye.icon.nameSecondary){de=!0;break}for(const ye of l.features){const De=A.get("text-font").evaluate(ye,{},E).join(","),Ie=ae.evaluate(ye,{},E)*F.textScaleFactor,Re=F.layoutTextSize.evaluate(ye,{},E)*F.textScaleFactor,$e=(F.layoutIconSize.evaluate(ye,{},E),{horizontal:{},vertical:void 0}),Oe=ye.text;let Ye,tt=[0,0];if(Oe){const ct=Oe.toString(),yt=A.get("text-letter-spacing").evaluate(ye,{},E)*go,st=A.get("text-line-height").evaluate(ye,{},E)*go,Bt=Ga(ct)?yt:0,Qt=A.get("text-anchor").evaluate(ye,{},E),Nt=A.get("text-variable-anchor");if(!Nt){const Hn=A.get("text-radial-offset").evaluate(ye,{},E);tt=Hn?pI(Qt,[Hn*go,dM]):A.get("text-offset").evaluate(ye,{},E).map(In=>In*go)}let An=ee?"center":A.get("text-justify").evaluate(ye,{},E);const xn=A.get("symbol-placement")==="point",cn=xn?A.get("text-max-width").evaluate(ye,{},E)*go:1/0,nn=Hn=>{l.allowVerticalPlacement&&Wr(ct)&&($e.vertical=Sn(Oe,n,o,g,De,cn,st,Qt,Hn,Bt,tt,He.vertical,!0,Re,Ie))};if(!ee&&Nt){const Hn=An==="auto"?Nt.map(kn=>fM(kn)):[An];let In=!1;for(let kn=0;kn<Hn.length;kn++){const yi=Hn[kn];if(!$e.horizontal[yi])if(In)$e.horizontal[yi]=$e.horizontal[0];else{const Ri=Sn(Oe,n,o,g,De,cn,st,"center",yi,Bt,tt,He.horizontal,!1,Re,Ie);Ri&&($e.horizontal[yi]=Ri,In=Ri.positionedLines.length===1)}}nn("left")}else{if(An==="auto"&&(An=fM(Qt)),xn||A.get("text-writing-mode").indexOf("horizontal")>=0||!Wr(ct)){const Hn=Sn(Oe,n,o,g,De,cn,st,Qt,An,Bt,tt,He.horizontal,!1,Re,Ie);Hn&&($e.horizontal[An]=Hn)}nn(xn?"left":An)}}let Je=!1;if(ye.icon&&ye.icon.namePrimary){const ct=xx(l.iconSizeData,D["icon-size"],E,l.zoom,ye)*F.iconScaleFactor*R,yt=ye.icon.getPrimary().scaleSelf(ct).serialize(),st=u[yt];st&&(Ye=Pn(g[yt],ye.icon.nameSecondary?g[ye.icon.getSecondary().scaleSelf(ct).serialize()]:void 0,A.get("icon-offset").evaluate(ye,{},E),A.get("icon-anchor").evaluate(ye,{},E)),Je=st.sdf,l.sdfIcons===void 0?l.sdfIcons=st.sdf:l.sdfIcons!==st.sdf&&Wn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(st.pixelRatio!==l.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0))}const rt=gI($e.horizontal)||$e.vertical;l.iconsInText||(l.iconsInText=!!rt&&rt.iconsInText),(rt||Ye)&&fB(l,ye,$e,Ye,u,F,Re,0,tt,Je,v,E,z,L,de)}d&&l.generateCollisionDebugBuffers(C,l.collisionBoxArray,F.textScaleFactor)},r.e5=m1,r.e6=qn,r.e7=ex,r.e8=h,r.e9=I,r.ea=function(l){let n=0;if(new Uint32Array(l,0,1)[0]!==FD){const o=new Uint32Array(l,0,7),[,,u,g,d,v]=o;n=o.byteLength+g+d+v+d,(u!==l.byteLength||n>=l.byteLength)&&Wn("Invalid b3dm header information.")}return VD(l,n)},r.eb=function(l,n){const o=GD(l);for(const u of o){for(const g of u.meshes)j4(g);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(G4(u.lights,n)))}return o},r.ec=l1,r.ed=iD,r.ee=Br,r.ef=function(l){at(),Mt!=null&&Mt.then(n=>{n.keys().then(o=>{for(let u=0;u<o.length-l;u++)n.delete(o[u])})})},r.f=function(l){return l.indexOf("mapbox:")===0},r.g=function(l,n){return er(On(l,{method:"GET"}),n)},r.h=yc,r.i=function(l){return Sr.API_STYLE_REGEX.test(l)&&!xc(l)},r.j=function(l){return decodeURIComponent(atob(l).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.k=function(l){return btoa(encodeURIComponent(l).replace(/%([0-9A-F]{2})/g,(n,o)=>String.fromCharCode(+("0x"+o))))},r.l=On,r.m=ht,r.n=function(l,n){return er(On(l,{type:"json"}),n)},r.o=To,r.p=function(l,n){return er(On(l,{method:"POST"}),n)},r.q=je,r.r=no,r.s=function(l){try{const n=self[l];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=Te,r.u=function(){return function l(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()},r.v=function(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)},r.w=Wn,r.x=function(){return DM||(DM=new zg),DM},r.y=yo,r.z=Oo}),y(["./shared"],function(r){function I(At){const he=At?At.url.toString():void 0;return he?performance.getEntriesByName(he):[]}function k(At){if(typeof At=="number"||typeof At=="boolean"||typeof At=="string"||At==null)return JSON.stringify(At);if(Array.isArray(At)){let _e="[";for(const Te of At)_e+=`${k(Te)},`;return`${_e}]`}let he="{";for(const _e of Object.keys(At).sort())he+=`${_e}:${k(At[_e])},`;return`${he}}`}function B(At){let he="";for(const _e of r.bm)(At.type!=="model"||_e!=="minzoom"&&_e!=="maxzoom")&&(he+=`/${k(At[_e])}`);return he}class U{constructor(he){this.keyCache={},this._layers={},this._layerConfigs={},he&&this.replace(he)}replace(he,_e){this._layerConfigs={},this._layers={},this.update(he,[],_e)}update(he,_e,Te){this._options=Te;for(const We of he)this._layerConfigs[We.id]=We,(this._layers[We.id]=r.cu(We,this.scope,null,this._options)).compileFilter(Te),this.keyCache[We.id]&&delete this.keyCache[We.id];for(const We of _e)delete this.keyCache[We],delete this._layerConfigs[We],delete this._layers[We];this.familiesBySource={};const je=function(We,Qe){const ft={};for(let St=0;St<We.length;St++){const wt=We[St];let Mt=Qe&&Qe[wt.id];!Mt&&(Mt=B(wt),wt.type==="line"&&wt.paint)&&function Ze(at){return typeof at=="string"&&at==="line-progress"||(Array.isArray(at)?at.some(Ze):!(!at||typeof at!="object")&&Object.values(at).some(Ze))}(wt.paint["line-width"])&&(Mt+=`/${k(wt.paint["line-width"])}`),Qe&&(Qe[wt.id]=Mt);let we=ft[Mt];we||(we=ft[Mt]=[]),we.push(wt)}const nt=[];for(const St in ft)nt.push(ft[St]);return nt}(r.bj(this._layerConfigs),this.keyCache);for(const We of je){const Qe=We.map(we=>this._layers[we.id]),ft=Qe[0];if(ft.visibility==="none")continue;const nt=ft.source||"";let St=this.familiesBySource[nt];St||(St=this.familiesBySource[nt]={});const wt=ft.sourceLayer||"_geojsonTileLayer";let Mt=St[wt];Mt||(Mt=St[wt]=[]),Mt.push(Qe)}}}const H=1*r.dX;class Y{constructor(he){const _e={},Te=[];for(const ft in he){const nt=he[ft],St=_e[ft]={};for(const wt in nt.glyphs){const Mt=nt.glyphs[+wt];if(!Mt||Mt.bitmap.width===0||Mt.bitmap.height===0)continue;const we=Mt.metrics.localGlyph?H:1,Ze={x:0,y:0,w:Mt.bitmap.width+2*we,h:Mt.bitmap.height+2*we};Te.push(Ze),St[wt]=Ze}}const{w:je,h:We}=r.F(Te),Qe=new r.dW({width:je||1,height:We||1});for(const ft in he){const nt=he[ft];for(const St in nt.glyphs){const wt=nt.glyphs[+St];if(!wt||wt.bitmap.width===0||wt.bitmap.height===0)continue;const Mt=_e[ft][St],we=wt.metrics.localGlyph?H:1;r.dW.copy(wt.bitmap,Qe,{x:0,y:0},{x:Mt.x+we,y:Mt.y+we},wt.bitmap)}}this.image=Qe,this.positions=_e}}r.dV(Y,"GlyphAtlas");const X="3d_elevation_id",Q="hd_road_elevation";class J{constructor(){this._valid=!1}reset(he){return this.feature=he,this._valid=!0,this._geometry=he.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(he,_e){return this._valid&&he(_e(this._geometry)),this}require(he,_e,Te){return this.get(he,!0,_e,Te)}optional(he,_e,Te){return this.get(he,!1,_e,Te)}success(){return this._valid}get(he,_e,Te,je){const We=this.feature.properties.hasOwnProperty(he)?+this.feature.properties[he]:void 0;return this._valid&&We!==void 0?Te(je?je(We):We):_e&&(this._valid=!1),this}}class j{constructor(he,_e){this.featureFunc=he,this.vertexFunc=_e}parseFeature(he,_e,Te){return this.featureFunc(he,_e,Te)}parseVertex(he,_e,Te){return this.vertexFunc(he,_e,Te)}}const oe=new j((At,he,_e)=>At.reset(he).require(X,Te=>{_e.id=Te}).optional("fixed_height_relative",Te=>{_e.constantHeight=Te},pe.decodeRelativeHeight).geometry(Te=>{_e.bounds=Te},pe.computeBounds).success(),(At,he,_e)=>At.reset(he).require(X,Te=>{_e.id=Te}).require("elevation_idx",Te=>{_e.idx=Te}).require("extent",Te=>{_e.extent=Te}).require("height_relative",Te=>{_e.height=Te},pe.decodeRelativeHeight).geometry(Te=>{_e.position=Te},pe.getPoint).success()),ce=new j((At,he,_e)=>At.reset(he).require(X,Te=>{_e.id=Te}).optional("fixed_height",Te=>{_e.constantHeight=Te},pe.decodeMetricHeight).geometry(Te=>{_e.bounds=Te},pe.computeBounds).success(),(At,he,_e)=>At.reset(he).require(X,Te=>{_e.id=Te}).require("elevation_idx",Te=>{_e.idx=Te}).require("extent",Te=>{_e.extent=Te}).require("height",Te=>{_e.height=Te},pe.decodeMetricHeight).geometry(Te=>{_e.position=Te},pe.getPoint).success());class pe{static computeBounds(he){const _e=new r.P(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Te=new r.P(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const je of he[0])_e.x>je.x&&(_e.x=je.x),_e.y>je.y&&(_e.y=je.y),Te.x<je.x&&(Te.x=je.x),Te.y<je.y&&(Te.y=je.y);return{min:_e,max:Te}}static getPoint(he){return r.ab.vec2.fromValues(he[0][0].x,he[0][0].y)}static decodeRelativeHeight(he){return 1e-4*he*5}static decodeMetricHeight(he){return 1e-4*he}static parse(he){const _e=[],Te=[],je=he.length,We=new J;for(let ft=0;ft<je;ft++){const nt=he.feature(ft),St=nt.properties.hasOwnProperty("version")?String(nt.properties.version):void 0,wt=(Qe=St)?Qe==="1.0.1"?ce:void 0:oe;if(wt===void 0){r.w(`Unknown elevation feature version number ${St||"(unknown)"}`);continue}const Mt=nt.properties.hasOwnProperty("type")?nt.properties.type:void 0;if(Mt){if(r.dY.VectorTileFeature.types[nt.type]==="Point"&&Mt==="curve_point"){const we={};wt.parseVertex(We,nt,we)&&_e.push(we)}else if(r.dY.VectorTileFeature.types[nt.type]==="Polygon"&&Mt==="curve_meta"){const we={};wt.parseFeature(We,nt,we)&&Te.push(we)}}}var Qe;return{vertices:_e,features:Te}}}class Ae{constructor(he,_e,Te,je,We,Qe){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=he,this.heightRange={min:Te,max:Te},this.safeArea=_e,this.constantHeight=Te,this.constantHeight==null&&(this.constantHeight!=null||je.length!==0)){this.vertices=je,this.edges=We,this.edges=this.edges.filter(ft=>ft.a<this.vertices.length&&ft.b<this.vertices.length&&!r.ab.vec2.exactEquals(this.vertices[ft.a].position,this.vertices[ft.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const ft of this.vertices)this.vertexProps.push({dir:r.ab.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,ft.height),this.heightRange.max=Math.max(this.heightRange.max,ft.height);for(const ft of this.edges){const nt=this.vertices[ft.a].position,St=this.vertices[ft.b].position,wt=r.ab.vec2.subtract(r.ab.vec2.create(),St,nt),Mt=r.ab.vec2.length(wt),we=r.ab.vec2.scale(r.ab.vec2.create(),wt,1/Mt);this.edgeProps.push({vec:wt,dir:we,len:Mt});const Ze=this.vertexProps[ft.a].dir,at=this.vertexProps[ft.b].dir;r.ab.vec2.add(Ze,Ze,we),r.ab.vec2.add(at,at,we)}for(const ft of this.vertexProps)ft.dir[0]===0&&ft.dir[1]===0||r.ab.vec2.normalize(ft.dir,ft.dir);this.tessellate(Qe)}}pointElevation(he){if(this.constantHeight!=null)return this.constantHeight;const _e=this.getClosestEdge(he);if(_e==null)return 0;const[Te,je]=_e;return(1-(We=je))*this.vertices[this.edges[Te].a].height+We*this.vertices[this.edges[Te].b].height;var We}getClosestEdge(he){if(this.edges.length===0)return;let _e=0,Te=Number.POSITIVE_INFINITY,je=0;const We=r.ab.vec2.fromValues(he.x,he.y);for(let Qe=0;Qe<this.edges.length;Qe++){const ft=this.edges[Qe],nt=this.edgeProps[Qe].dir,St=new r.dZ(We,this.edgeProps[Qe].dir),wt=this.vertices[ft.a].position,Mt=this.vertices[ft.b].position,we=r.ab.vec2.create(),Ze=r.ab.vec2.create(),at=St.intersectsPlane(wt,this.vertexProps[ft.a].dir,we),vt=St.intersectsPlane(Mt,this.vertexProps[ft.b].dir,Ze);if(!at||!vt)continue;const ht=r.ab.vec2.subtract(r.ab.vec2.create(),Ze,we),qt=r.ab.vec2.subtract(r.ab.vec2.create(),We,we),Jt=r.ab.vec2.dot(ht,ht),En=Jt>0?r.ab.vec2.dot(qt,ht)/Jt:0,Tn=r.aw(En,0,1),Bn=Math.abs((En-Tn)*this.edgeProps[Qe].len),$n=r.ab.vec2.subtract(r.ab.vec2.create(),We,wt),Vn=Bn+Math.abs(r.ab.vec2.dot($n,r.ab.vec2.fromValues(nt[1],-nt[0])));Vn<Te&&(_e=Qe,Te=Vn,je=Tn)}return[_e,je]}tessellate(he){for(let _e=this.edges.length-1;_e>=0;--_e){const Te=this.edges[_e].a,je=this.edges[_e].b,{position:We,height:Qe,extent:ft}=this.vertices[Te],{position:nt,height:St,extent:wt}=this.vertices[je],Mt=this.vertexProps[Te].dir,we=this.vertexProps[je].dir,Ze=r.ab.vec3.fromValues(We[0]/he,We[1]/he,Qe),at=r.ab.vec3.fromValues(nt[0]/he,nt[1]/he,St),vt=r.ab.vec3.fromValues(Mt[1],-Mt[0],0);r.ab.vec3.scale(vt,vt,ft);const ht=r.ab.vec3.fromValues(we[1],-we[0],0);if(r.ab.vec3.scale(ht,ht,wt),this.distSqLines(r.ab.vec3.fromValues(Ze[0]+.5*vt[0],Ze[1]+.5*vt[1],Ze[2]+.5*vt[2]),r.ab.vec3.fromValues(at[0]-.5*ht[0],at[1]-.5*ht[1],at[2]-.5*ht[2]),r.ab.vec3.fromValues(Ze[0]-.5*vt[0],Ze[1]-.5*vt[1],Ze[2]-.5*vt[2]),r.ab.vec3.fromValues(at[0]+.5*ht[0],at[1]+.5*ht[1],at[2]+.5*ht[2]))<=.05*.05)continue;const qt=this.vertices.length,Jt=r.ab.vec2.add(r.ab.vec2.create(),We,nt);this.vertices.push({position:r.ab.vec2.scale(Jt,Jt,.5),height:.5*(Qe+St),extent:.5*(ft+wt)});const En=r.ab.vec2.add(r.ab.vec2.create(),Mt,we);this.vertexProps.push({dir:r.ab.vec2.normalize(En,En)}),this.edges.splice(_e,1),this.edgeProps.splice(_e,1),this.edges.push({a:Te,b:qt}),this.edges.push({a:qt,b:je});const Tn=r.ab.vec2.subtract(r.ab.vec2.create(),this.vertices[qt].position,We),Bn=r.ab.vec2.length(Tn),$n={vec:Tn,dir:r.ab.vec2.scale(r.ab.vec2.create(),Tn,1/Bn),len:Bn};this.edgeProps.push($n),this.edgeProps.push($n)}}distSqLines(he,_e,Te,je){const We=r.ab.vec3.subtract(r.ab.vec3.create(),_e,he),Qe=r.ab.vec3.subtract(r.ab.vec3.create(),je,Te),ft=r.ab.vec3.subtract(r.ab.vec3.create(),he,Te),nt=r.ab.vec3.dot(We,We),St=r.ab.vec3.dot(We,Qe),wt=r.ab.vec3.dot(We,ft),Mt=r.ab.vec3.dot(Qe,Qe),we=r.ab.vec3.dot(Qe,ft),Ze=nt*Mt-St*St;if(Ze===0){const Jt=r.ab.vec3.dot(ft,Qe)/r.ab.vec3.dot(Qe,Qe),En=r.ab.vec3.lerp(r.ab.vec3.create(),Te,je,Jt);return r.ab.vec3.squaredDistance(En,he)}const at=(St*we-wt*Mt)/Ze,vt=(nt*we-St*wt)/Ze,ht=r.ab.vec3.lerp(r.ab.vec3.create(),he,_e,at),qt=r.ab.vec3.lerp(r.ab.vec3.create(),Te,je,vt);return r.ab.vec3.squaredDistance(ht,qt)}}class Ee{static parseFrom(he,_e){const Te=pe.parse(he);if(!Te)return[];let{vertices:je,features:We}=Te;const Qe=1/r.cc(_e);We.sort((wt,Mt)=>wt.id-Mt.id),je.sort((wt,Mt)=>wt.id-Mt.id||wt.idx-Mt.idx),je=je.filter((wt,Mt,we)=>Mt===we.findIndex(Ze=>Ze.id===wt.id&&Ze.idx===wt.idx));const ft=new Array;let nt=0;const St=je.length;for(const wt of We){if(wt.constantHeight){ft.push(new Ae(wt.id,wt.bounds,wt.constantHeight));continue}for(;nt!==St&&je[nt].id<wt.id;)nt++;if(nt===St||je[nt].id!==wt.id)continue;const Mt=new Array,we=new Array,Ze=nt;for(;nt!==St&&je[nt].id===wt.id;){const at=je[nt];if(Mt.push({position:at.position,height:at.height,extent:at.extent}),nt!==Ze&&je[nt-1].idx===at.idx-1){const vt=nt-Ze;we.push({a:vt-1,b:vt})}nt++}ft.push(new Ae(wt.id,wt.bounds,void 0,Mt,we,Qe))}return ft}}r.dV(Ae,"ElevationFeature");class be{constructor(he){this.tileID=new r.aG(he.tileID.overscaledZ,he.tileID.wrap,he.tileID.canonical.z,he.tileID.canonical.x,he.tileID.canonical.y),this.tileZoom=he.tileZoom,this.uid=he.uid,this.zoom=he.zoom,this.lut=he.lut,this.canonical=he.tileID.canonical,this.pixelRatio=he.pixelRatio,this.tileSize=he.tileSize,this.source=he.source,this.scope=he.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=he.showCollisionBoxes,this.collectResourceTiming=!!he.request&&he.request.collectResourceTiming,this.promoteId=he.promoteId,this.isSymbolTile=he.isSymbolTile,this.tileTransform=r.aQ(he.tileID.canonical,he.projection),this.projection=he.projection,this.worldview=he.worldview,this.localizableLayerIds=he.localizableLayerIds,this.brightness=he.brightness,this.extraShadowCaster=!!he.extraShadowCaster,this.tessellationStep=he.tessellationStep,this.scaleFactor=he.scaleFactor}parse(he,_e,Te,je,We){this.status="parsing",this.data=he,this.collisionBoxArray=new r.aW;const Qe=new r.d_(Object.keys(he.layers).sort()),ft=new r.d$(this.tileID,this.promoteId);ft.bucketLayerIDs=[];const nt={},St=new r.e0(256,256),wt={featureIndex:ft,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:St,availableImages:Te,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Mt=_e.familiesBySource[this.source];for(const Jt in Mt){const En=he.layers[Jt];if(!En)continue;let Tn=!1,Bn=!1,$n=!1;for(const er of Mt[Jt])er[0].type==="symbol"?Tn=!0:Bn=!0,er[0].is3D()&&er[0].type!=="model"&&($n=!0);if(this.extraShadowCaster&&!$n||this.isSymbolTile===!0&&!Tn||this.isSymbolTile===!1&&!Bn)continue;En.version===1&&r.w(`Vector tile source "${this.source}" layer "${Jt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Vn=Qe.encode(Jt),Pi=[];let or=!1;for(let er=0,qi=0;er<En.length;er++){const Ci=En.feature(er),Li=ft.getId(Ci,Jt);if(this.localizableLayerIds&&this.localizableLayerIds.has(Jt)){const ia=Ci.properties?Ci.properties.worldview:null;if(this.worldview&&typeof ia=="string")if(ia==="all")Ci.properties.$localized=!0;else{if(!ia.split(",").includes(this.worldview))continue;Ci.properties.$localized=!0,Ci.properties.worldview=this.worldview}}!or&&Ci.properties&&Ci.properties.hasOwnProperty(X)&&(or=!0),Pi.push({feature:Ci,id:Li,index:qi,sourceLayerIndex:Vn}),qi++}or&&he.layers.hasOwnProperty(Q)&&(wt.elevationFeatures=Ee.parseFrom(he.layers[Q],this.canonical));for(const er of Mt[Jt]){const qi=er[0];(!this.extraShadowCaster||qi.is3D()&&qi.type!=="model")&&(this.isSymbolTile!==void 0&&qi.type==="symbol"!==this.isSymbolTile||qi.minzoom&&this.zoom<Math.floor(qi.minzoom)||qi.maxzoom&&this.zoom>=qi.maxzoom||qi.visibility!=="none"&&(Ve(er,this.zoom,wt.brightness,Te),(nt[qi.id]=qi.createBucket({index:ft.bucketLayerIDs.length,layers:er,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Vn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Pi,wt,this.tileID.canonical,this.tileTransform),ft.bucketLayerIDs.push(er.map(Ci=>r.aC(Ci.id,Ci.scope)))))}}let we,Ze,at,vt;St.trim();const ht={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},qt=()=>{if(we)return this.status="done",We(we);if(this.extraShadowCaster)this.status="done",We(null,{buckets:r.bj(nt).filter(Jt=>!Jt.isEmpty()),featureIndex:ft,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:wt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Ze&&at&&vt){const Jt=new Y(Ze),En=new r.e3(at,vt,this.lut);for(const Tn in nt){const Bn=nt[Tn];Bn instanceof r.aX?(Ve(Bn.layers,this.zoom,wt.brightness,Te),r.e4(Bn,Ze,Jt.positions,at,En.iconPositions,this.showCollisionBoxes,Te,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.pixelRatio,this.brightness)):Bn.hasPattern&&(Bn instanceof r.b1||Bn instanceof r.b2||Bn instanceof r.d5)&&(Ve(Bn.layers,this.zoom,wt.brightness,Te),Bn.addFeatures(wt,this.tileID.canonical,En.patternPositions,Te,this.tileTransform,this.brightness))}this.status="done",We(null,{buckets:r.bj(nt).filter(Tn=>!Tn.isEmpty()),featureIndex:ft,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Jt.image,lineAtlas:St,imageAtlas:En,brightness:wt.brightness})}};if(!this.extraShadowCaster){const Jt=r.e1(wt.glyphDependencies,Bn=>Object.keys(Bn).map(Number));Object.keys(Jt).length?je.send("getGlyphs",{uid:this.uid,stacks:Jt,scope:this.scope},(Bn,$n)=>{we||(we=Bn,Ze=$n,qt())},void 0,!1,ht):Ze={};const En=Object.keys(wt.iconDependencies);En.length?je.send("getImages",{icons:En,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Bn,$n)=>{if(we)return;we=Bn;const Vn={};Object.values($n).some(Pi=>Pi.usvg)?this.rasterize(je,Vn,$n,wt.iconDependencies,()=>{at=Vn,qt()}):(this.fillImageMap(Vn,wt.iconDependencies,$n),at=Vn,qt())},void 0,!1,ht):at={};const Tn=Object.keys(wt.patternDependencies);Tn.length?je.send("getImages",{icons:Tn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Bn,$n)=>{if(!we){we=Bn;const Vn={};Object.values($n).some(Pi=>Pi.usvg)?this.rasterize(je,Vn,$n,wt.patternDependencies,()=>{vt=Vn,qt()}):(this.fillImageMap(Vn,wt.patternDependencies,$n),vt=Vn,qt())}},void 0,!1,ht):vt={}}qt()}fillImageMap(he,_e,Te){for(const je in Te){const We=_e[je]||[];for(const Qe of We)Te[Qe.id].usvg||(he[Qe.serialize()]=Te[Qe.id])}}getImageTaskQueue(he,_e,Te){const je={};for(const We in _e){const Qe=Te[We]||[];for(const ft of Qe){const nt=ft.serialize();_e[ft.id].usvg?je[nt]||(je[nt]=ft):he[nt]=_e[ft.id]}}return je}rasterize(he,_e,Te,je,We){const Qe=this.getImageTaskQueue(_e,Te,je);this.rasterizeTask=he.send("rasterizeImages",{scope:this.scope,imageTasks:Qe},(ft,nt)=>{if(!ft)for(const St in nt){const{id:wt}=r.e2.deserializeFromString(St);_e[St]=Object.assign({},Te[wt],{data:nt[St]})}We()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Ve(At,he,_e,Te){const je=new r.a8(he,{brightness:_e});for(const We of At)We.recalculate(je,Te)}class Se extends r.E{constructor(he,_e,Te,je,We,Qe){super(),this.actor=he,this.layerIndex=_e,this.availableImages=Te,this.loadVectorData=We||r.aD,this.loading={},this.loaded={},this.deduped=new r.aB(he.scheduler),this.isSpriteLoaded=je,this.scheduler=he.scheduler,this.brightness=Qe}loadTile(he,_e){const Te=he.uid,je=he&&he.request,We=je&&je.collectResourceTiming,Qe=this.loading[Te]=new be(he);Qe.abort=this.loadVectorData(he,(ft,nt)=>{const St=!this.loading[Te];if(delete this.loading[Te],Qe.cancelRasterize(),St||ft||!nt)return Qe.status="done",St||(this.loaded[Te]=Qe),_e(ft);const wt=nt.rawData,Mt={};nt.expires&&(Mt.expires=nt.expires),nt.cacheControl&&(Mt.cacheControl=nt.cacheControl),Qe.vectorTile=nt.vectorTile||new r.dY.VectorTile(new r.bh(wt));const we=()=>{Qe.parse(Qe.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ze,at)=>{if(Ze||!at)return _e(Ze);const vt={};if(We){const ht=I(je);ht.length>0&&(vt.resourceTiming=JSON.parse(JSON.stringify(ht)))}_e(null,r.l({rawTileData:wt.slice(0)},at,Mt,vt))})};this.isSpriteLoaded?we():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(we,{type:"parseTile",isSymbolTile:he.isSymbolTile,zoom:he.tileZoom}):we()}),this.loaded=this.loaded||{},this.loaded[Te]=Qe})}reloadTile(he,_e){const Te=this.loaded,je=he.uid;if(Te&&Te[je]){const We=Te[je];We.scaleFactor=he.scaleFactor,We.showCollisionBoxes=he.showCollisionBoxes,We.projection=he.projection,We.brightness=he.brightness,We.tileTransform=r.aQ(he.tileID.canonical,he.projection),We.extraShadowCaster=he.extraShadowCaster,We.lut=he.lut;const Qe=(ft,nt)=>{const St=We.reloadCallback;St&&(delete We.reloadCallback,We.parse(We.vectorTile,this.layerIndex,this.availableImages,this.actor,St)),_e(ft,nt)};We.status==="parsing"?We.reloadCallback=Qe:We.status==="done"&&(We.vectorTile?We.parse(We.vectorTile,this.layerIndex,this.availableImages,this.actor,Qe):Qe())}else _e(null,void 0)}abortTile(he,_e){const Te=he.uid,je=this.loading[Te];je&&(je.abort&&je.abort(),delete this.loading[Te]),_e()}removeTile(he,_e){const Te=this.loaded,je=he.uid;Te&&Te[je]&&delete Te[je],_e()}}class xe{loadTile(he,_e){const{uid:Te,encoding:je,rawImageData:We,padding:Qe}=he,ft=ImageBitmap&&We instanceof ImageBitmap?this.getImageData(We,Qe):We;_e(null,new r.e5(Te,ft,je,Qe<1))}getImageData(he,_e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(he.width,he.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=he.width,this.offscreenCanvas.height=he.height,this.offscreenCanvasContext.drawImage(he,0,0,he.width,he.height);const Te=this.offscreenCanvasContext.getImageData(-_e,-_e,he.width+2*_e,he.height+2*_e);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Te}}r.bg.setPbf(r.bh);class Fe{decodeRasterArray({task:he,buffer:_e},Te){r.bg.performDecoding(_e,he).then(je=>{Te(null,je)},je=>{Te(je)})}}const Ct=r.dY.VectorTileFeature.prototype.toGeoJSON;class Et{constructor(he){this._feature=he,this.extent=r.ag,this.type=he.type,this.properties=he.tags,"id"in he&&!isNaN(he.id)&&(this.id=parseInt(he.id,10))}loadGeometry(){if(this._feature.type===1){const he=[];for(const _e of this._feature.geometry)he.push([new r.P(_e[0],_e[1])]);return he}{const he=[];for(const _e of this._feature.geometry){const Te=[];for(const je of _e)Te.push(new r.P(je[0],je[1]));he.push(Te)}return he}}toGeoJSON(he,_e,Te){return Ct.call(this,he,_e,Te)}}class Tt{constructor(he){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.ag,this.length=he.length,this._features=he}feature(he){return new Et(this._features[he])}}const _t=64/4096,et=128;class Lt{constructor(){this.features=new Map}clear(){this.features.clear()}load(he=[],_e){for(const Te of he){const je=Te.id;if(je==null)continue;let We=this.features.get(je);We&&this.updateCache(We,_e),Te.geometry?(We=ut(Te),this.updateCache(We,_e),this.features.set(je,We)):this.features.delete(je),this.updateCache(We,_e)}}updateCache(he,_e){for(const{canonical:Te,uid:je}of Object.values(_e)){const{z:We,x:Qe,y:ft}=Te;lt(he,Math.pow(2,We),Qe,ft)&&delete _e[je]}}getTile(he,_e,Te){const je=Math.pow(2,he),We=[];for(const Qe of this.features.values())lt(Qe,je,_e,Te)&&We.push(Xt(Qe,je,_e,Te));return{features:We}}getFeatures(){return[...this.features.values()]}}function lt({minX:At,minY:he,maxX:_e,maxY:Te},je,We,Qe){return At<(We+1+_t)/je&&he<(Qe+1+_t)/je&&_e>(We-_t)/je&&Te>(Qe-_t)/je}function ut(At){const{id:he,geometry:_e,properties:Te}=At;if(!_e)return;if(_e.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:je,coordinates:We}=_e,Qe={id:he,type:1,geometry:[],tags:Te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},ft=Qe.geometry;if(je==="Point")Xe(We,ft,Qe);else if(je==="MultiPoint")for(const nt of We)Xe(nt,ft,Qe);else if(je==="LineString")Qe.type=2,kt(We,ft,Qe);else if(je==="MultiLineString")Qe.type=2,_n(We,ft,Qe);else if(je==="Polygon")Qe.type=3,_n(We,ft,Qe,!0);else{if(je!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Qe.type=3;for(const nt of We)_n(nt,ft,Qe,!0)}return Qe}function Xe([At,he],_e,Te){const je=r.at(At);let We=r.aA(he);We=We<0?0:We>1?1:We,_e.push(je,We),Te.minX=Math.min(Te.minX,je),Te.minY=Math.min(Te.minY,We),Te.maxX=Math.max(Te.maxX,je),Te.maxY=Math.max(Te.maxY,We)}function kt(At,he,_e,Te=!1,je=!1){const We=[];for(const Qe of At)Xe(Qe,We,_e);he.push(We),Te&&function(Qe,ft){let nt=0;for(let St=0,wt=Qe.length,Mt=wt-2;St<wt;Mt=St,St+=2)nt+=(Qe[St]-Qe[Mt])*(Qe[St+1]+Qe[Mt+1]);if(nt>0===ft)for(let St=0,wt=Qe.length;St<wt/2;St+=2){const Mt=Qe[St],we=Qe[St+1];Qe[St]=Qe[wt-2-St],Qe[St+1]=Qe[wt-1-St],Qe[wt-2-St]=Mt,Qe[wt-1-St]=we}}(We,je)}function _n(At,he,_e,Te=!1){for(let je=0;je<At.length;je++)kt(At[je],he,_e,Te,je===0)}function Xt(At,he,_e,Te){const{id:je,type:We,geometry:Qe,tags:ft}=At,nt=[];if(We===1)(function(St,wt,Mt,we,Ze){for(let at=0;at<St.length;at+=2){const vt=Math.round(r.ag*(St[at+0]*wt-Mt)),ht=Math.round(r.ag*(St[at+1]*wt-we));Ze.push([vt,ht])}})(Qe,he,_e,Te,nt);else for(const St of Qe)It(St,he,_e,Te,nt);return{id:je,type:We,geometry:nt,tags:ft}}function It(At,he,_e,Te,je){const Qe=r.ag+et;let ft;for(let nt=0;nt<At.length-2;nt+=2){let St=Math.round(r.ag*(At[nt+0]*he-_e)),wt=Math.round(r.ag*(At[nt+1]*he-Te)),Mt=Math.round(r.ag*(At[nt+2]*he-_e)),we=Math.round(r.ag*(At[nt+3]*he-Te));const Ze=Mt-St,at=we-wt;St<-128&&Mt<-128||(St<-128?(wt+=Math.round(at*((-128-St)/Ze)),St=-128):Mt<-128&&(we=wt+Math.round(at*((-128-St)/Ze)),Mt=-128),wt<-128&&we<-128||(wt<-128?(St+=Math.round(Ze*((-128-wt)/at)),wt=-128):we<-128&&(Mt=St+Math.round(Ze*((-128-wt)/at)),we=-128),St>=Qe&&Mt>=Qe||(St>=Qe?(wt+=Math.round(at*((Qe-St)/Ze)),St=Qe):Mt>=Qe&&(we=wt+Math.round(at*((Qe-St)/Ze)),Mt=Qe),wt>=Qe&&we>=Qe||(wt>=Qe?(St+=Math.round(Ze*((Qe-wt)/at)),wt=Qe):we>=Qe&&(Mt=St+Math.round(Ze*((Qe-wt)/at)),we=Qe),ft&&St===ft[ft.length-1][0]&&wt===ft[ft.length-1][1]||(ft=[[St,wt]],je.push(ft)),ft.push([Mt,we])))))}}var ln,fn,$t,pn={exports:{}},jn=function(){if($t)return pn.exports;$t=1;var At=r.e8(),he=function(){if(fn)return ln;fn=1;var wt=r.e6(),Mt=r.e7().VectorTileFeature;function we(at,vt){this.options=vt||{},this.features=at,this.length=at.length}function Ze(at,vt){this.id=typeof at.id=="number"?at.id:void 0,this.type=at.type,this.rawGeometry=at.type===1?[at.geometry]:at.geometry,this.properties=at.tags,this.extent=vt||4096}return ln=we,we.prototype.feature=function(at){return new Ze(this.features[at],this.options.extent)},Ze.prototype.loadGeometry=function(){var at=this.rawGeometry;this.geometry=[];for(var vt=0;vt<at.length;vt++){for(var ht=at[vt],qt=[],Jt=0;Jt<ht.length;Jt++)qt.push(new wt(ht[Jt][0],ht[Jt][1]));this.geometry.push(qt)}return this.geometry},Ze.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var at=this.geometry,vt=1/0,ht=-1/0,qt=1/0,Jt=-1/0,En=0;En<at.length;En++)for(var Tn=at[En],Bn=0;Bn<Tn.length;Bn++){var $n=Tn[Bn];vt=Math.min(vt,$n.x),ht=Math.max(ht,$n.x),qt=Math.min(qt,$n.y),Jt=Math.max(Jt,$n.y)}return[vt,qt,ht,Jt]},Ze.prototype.toGeoJSON=Mt.prototype.toGeoJSON,ln}();function _e(wt){var Mt=new At;return function(we,Ze){for(var at in we.layers)Ze.writeMessage(3,Te,we.layers[at])}(wt,Mt),Mt.finish()}function Te(wt,Mt){var we;Mt.writeVarintField(15,wt.version||1),Mt.writeStringField(1,wt.name||""),Mt.writeVarintField(5,wt.extent||4096);var Ze={keys:[],values:[],keycache:{},valuecache:{}};for(we=0;we<wt.length;we++)Ze.feature=wt.feature(we),Mt.writeMessage(2,je,Ze);var at=Ze.keys;for(we=0;we<at.length;we++)Mt.writeStringField(3,at[we]);var vt=Ze.values;for(we=0;we<vt.length;we++)Mt.writeMessage(4,St,vt[we])}function je(wt,Mt){var we=wt.feature;we.id!==void 0&&Mt.writeVarintField(1,we.id),Mt.writeMessage(2,We,wt),Mt.writeVarintField(3,we.type),Mt.writeMessage(4,nt,we)}function We(wt,Mt){var we=wt.feature,Ze=wt.keys,at=wt.values,vt=wt.keycache,ht=wt.valuecache;for(var qt in we.properties){var Jt=we.properties[qt],En=vt[qt];if(Jt!==null){En===void 0&&(Ze.push(qt),vt[qt]=En=Ze.length-1),Mt.writeVarint(En);var Tn=typeof Jt;Tn!=="string"&&Tn!=="boolean"&&Tn!=="number"&&(Jt=JSON.stringify(Jt));var Bn=Tn+":"+Jt,$n=ht[Bn];$n===void 0&&(at.push(Jt),ht[Bn]=$n=at.length-1),Mt.writeVarint($n)}}}function Qe(wt,Mt){return(Mt<<3)+(7&wt)}function ft(wt){return wt<<1^wt>>31}function nt(wt,Mt){for(var we=wt.loadGeometry(),Ze=wt.type,at=0,vt=0,ht=we.length,qt=0;qt<ht;qt++){var Jt=we[qt],En=1;Ze===1&&(En=Jt.length),Mt.writeVarint(Qe(1,En));for(var Tn=Ze===3?Jt.length-1:Jt.length,Bn=0;Bn<Tn;Bn++){Bn===1&&Ze!==1&&Mt.writeVarint(Qe(2,Tn-1));var $n=Jt[Bn].x-at,Vn=Jt[Bn].y-vt;Mt.writeVarint(ft($n)),Mt.writeVarint(ft(Vn)),at+=$n,vt+=Vn}Ze===3&&Mt.writeVarint(Qe(7,1))}}function St(wt,Mt){var we=typeof wt;we==="string"?Mt.writeStringField(1,wt):we==="boolean"?Mt.writeBooleanField(7,wt):we==="number"&&(wt%1!=0?Mt.writeDoubleField(3,wt):wt<0?Mt.writeSVarintField(6,wt):Mt.writeVarintField(5,wt))}return pn.exports=_e,pn.exports.fromVectorTileJs=_e,pn.exports.fromGeojsonVt=function(wt,Mt){Mt=Mt||{};var we={};for(var Ze in wt)we[Ze]=new he(wt[Ze].features,Mt),we[Ze].name=Ze,we[Ze].version=Mt.version,we[Ze].extent=Mt.extent;return _e({layers:we})},pn.exports.GeoJSONWrapper=he,pn.exports}(),Pe=r.e9(jn);const Gn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:At=>At},vn=Math.fround||(qn=new Float32Array(1),At=>(qn[0]=+At,qn[0]));var qn;const ke=3,Fi=5,di=6;class bi{constructor(he){this.options=Object.assign(Object.create(Gn),he),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(he){const{log:_e,minZoom:Te,maxZoom:je}=this.options;_e&&console.time("total time");const We=`prepare ${he.length} points`;_e&&console.time(We),this.points=he;const Qe=[];for(let nt=0;nt<he.length;nt++){const St=he[nt];if(!St.geometry)continue;const[wt,Mt]=St.geometry.coordinates,we=vn(ei(wt)),Ze=vn(ot(Mt));Qe.push(we,Ze,1/0,nt,-1,1),this.options.reduce&&Qe.push(0)}let ft=this.trees[je+1]=this._createTree(Qe);_e&&console.timeEnd(We);for(let nt=je;nt>=Te;nt--){const St=+Date.now();ft=this.trees[nt]=this._createTree(this._cluster(ft,nt)),_e&&console.log("z%d: %d clusters in %dms",nt,ft.numItems,+Date.now()-St)}return _e&&console.timeEnd("total time"),this}getClusters(he,_e){let Te=((he[0]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,he[1]));let We=he[2]===180?180:((he[2]+180)%360+360)%360-180;const Qe=Math.max(-90,Math.min(90,he[3]));if(he[2]-he[0]>=360)Te=-180,We=180;else if(Te>We){const Mt=this.getClusters([Te,je,180,Qe],_e),we=this.getClusters([-180,je,We,Qe],_e);return Mt.concat(we)}const ft=this.trees[this._limitZoom(_e)],nt=ft.range(ei(Te),ot(Qe),ei(We),ot(je)),St=ft.data,wt=[];for(const Mt of nt){const we=this.stride*Mt;wt.push(St[we+Fi]>1?Mn(St,we,this.clusterProps):this.points[St[we+ke]])}return wt}getChildren(he){const _e=this._getOriginId(he),Te=this._getOriginZoom(he),je="No cluster with the specified id.",We=this.trees[Te];if(!We)throw new Error(je);const Qe=We.data;if(_e*this.stride>=Qe.length)throw new Error(je);const ft=this.options.radius/(this.options.extent*Math.pow(2,Te-1)),nt=We.within(Qe[_e*this.stride],Qe[_e*this.stride+1],ft),St=[];for(const wt of nt){const Mt=wt*this.stride;Qe[Mt+4]===he&&St.push(Qe[Mt+Fi]>1?Mn(Qe,Mt,this.clusterProps):this.points[Qe[Mt+ke]])}if(St.length===0)throw new Error(je);return St}getLeaves(he,_e,Te){const je=[];return this._appendLeaves(je,he,_e=_e||10,Te=Te||0,0),je}getTile(he,_e,Te){const je=this.trees[this._limitZoom(he)],We=Math.pow(2,he),{extent:Qe,radius:ft}=this.options,nt=ft/Qe,St=(Te-nt)/We,wt=(Te+1+nt)/We,Mt={features:[]};return this._addTileFeatures(je.range((_e-nt)/We,St,(_e+1+nt)/We,wt),je.data,_e,Te,We,Mt),_e===0&&this._addTileFeatures(je.range(1-nt/We,St,1,wt),je.data,We,Te,We,Mt),_e===We-1&&this._addTileFeatures(je.range(0,St,nt/We,wt),je.data,-1,Te,We,Mt),Mt.features.length?Mt:null}getClusterExpansionZoom(he){let _e=this._getOriginZoom(he)-1;for(;_e<=this.options.maxZoom;){const Te=this.getChildren(he);if(_e++,Te.length!==1)break;he=Te[0].properties.cluster_id}return _e}_appendLeaves(he,_e,Te,je,We){const Qe=this.getChildren(_e);for(const ft of Qe){const nt=ft.properties;if(nt&&nt.cluster?We+nt.point_count<=je?We+=nt.point_count:We=this._appendLeaves(he,nt.cluster_id,Te,je,We):We<je?We++:he.push(ft),he.length===Te)break}return We}_createTree(he){const _e=new r.bE(he.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Te=0;Te<he.length;Te+=this.stride)_e.add(he[Te],he[Te+1]);return _e.finish(),_e.data=he,_e}_addTileFeatures(he,_e,Te,je,We,Qe){for(const ft of he){const nt=ft*this.stride,St=_e[nt+Fi]>1;let wt,Mt,we;if(St)wt=wi(_e,nt,this.clusterProps),Mt=_e[nt],we=_e[nt+1];else{const vt=this.points[_e[nt+ke]];wt=vt.properties;const[ht,qt]=vt.geometry.coordinates;Mt=ei(ht),we=ot(qt)}const Ze={type:1,geometry:[[Math.round(this.options.extent*(Mt*We-Te)),Math.round(this.options.extent*(we*We-je))]],tags:wt};let at;at=St||this.options.generateId?_e[nt+ke]:this.points[_e[nt+ke]].id,at!==void 0&&(Ze.id=at),Qe.features.push(Ze)}}_limitZoom(he){return Math.max(this.options.minZoom,Math.min(Math.floor(+he),this.options.maxZoom+1))}_cluster(he,_e){const{radius:Te,extent:je,reduce:We,minPoints:Qe}=this.options,ft=Te/(je*Math.pow(2,_e)),nt=he.data,St=[],wt=this.stride;for(let Mt=0;Mt<nt.length;Mt+=wt){if(nt[Mt+2]<=_e)continue;nt[Mt+2]=_e;const we=nt[Mt],Ze=nt[Mt+1],at=he.within(nt[Mt],nt[Mt+1],ft),vt=nt[Mt+Fi];let ht=vt;for(const qt of at){const Jt=qt*wt;nt[Jt+2]>_e&&(ht+=nt[Jt+Fi])}if(ht>vt&&ht>=Qe){let qt,Jt=we*vt,En=Ze*vt,Tn=-1;const Bn=(Mt/wt<<5)+(_e+1)+this.points.length;for(const $n of at){const Vn=$n*wt;if(nt[Vn+2]<=_e)continue;nt[Vn+2]=_e;const Pi=nt[Vn+Fi];Jt+=nt[Vn]*Pi,En+=nt[Vn+1]*Pi,nt[Vn+4]=Bn,We&&(qt||(qt=this._map(nt,Mt,!0),Tn=this.clusterProps.length,this.clusterProps.push(qt)),We(qt,this._map(nt,Vn)))}nt[Mt+4]=Bn,St.push(Jt/ht,En/ht,1/0,Bn,-1,ht),We&&St.push(Tn)}else{for(let qt=0;qt<wt;qt++)St.push(nt[Mt+qt]);if(ht>1)for(const qt of at){const Jt=qt*wt;if(!(nt[Jt+2]<=_e)){nt[Jt+2]=_e;for(let En=0;En<wt;En++)St.push(nt[Jt+En])}}}}return St}_getOriginId(he){return he-this.points.length>>5}_getOriginZoom(he){return(he-this.points.length)%32}_map(he,_e,Te){if(he[_e+Fi]>1){const Qe=this.clusterProps[he[_e+di]];return Te?Object.assign({},Qe):Qe}const je=this.points[he[_e+ke]].properties,We=this.options.map(je);return Te&&We===je?Object.assign({},We):We}}function Mn(At,he,_e){return{type:"Feature",id:At[he+ke],properties:wi(At,he,_e),geometry:{type:"Point",coordinates:[(Te=At[he],360*(Te-.5)),Ue(At[he+1])]}};var Te}function wi(At,he,_e){const Te=At[he+Fi],je=Te>=1e4?`${Math.round(Te/1e3)}k`:Te>=1e3?Math.round(Te/100)/10+"k":Te,We=At[he+di],Qe=We===-1?{}:Object.assign({},_e[We]);return Object.assign(Qe,{cluster:!0,cluster_id:At[he+ke],point_count:Te,point_count_abbreviated:je})}function ei(At){return At/360+.5}function ot(At){const he=Math.sin(At*Math.PI/180),_e=.5-.25*Math.log((1+he)/(1-he))/Math.PI;return _e<0?0:_e>1?1:_e}function Ue(At){const he=(180-360*At)*Math.PI/180;return 360*Math.atan(Math.exp(he))/Math.PI-90}function Yt(At,he,_e,Te){let je=Te;const We=he+(_e-he>>1);let Qe,ft=_e-he;const nt=At[he],St=At[he+1],wt=At[_e],Mt=At[_e+1];for(let we=he+3;we<_e;we+=3){const Ze=gt(At[we],At[we+1],nt,St,wt,Mt);if(Ze>je)Qe=we,je=Ze;else if(Ze===je){const at=Math.abs(we-We);at<ft&&(Qe=we,ft=at)}}je>Te&&(Qe-he>3&&Yt(At,he,Qe,Te),At[Qe+2]=je,_e-Qe>3&&Yt(At,Qe,_e,Te))}function gt(At,he,_e,Te,je,We){let Qe=je-_e,ft=We-Te;if(Qe!==0||ft!==0){const nt=((At-_e)*Qe+(he-Te)*ft)/(Qe*Qe+ft*ft);nt>1?(_e=je,Te=We):nt>0&&(_e+=Qe*nt,Te+=ft*nt)}return Qe=At-_e,ft=he-Te,Qe*Qe+ft*ft}function Kt(At,he,_e,Te){const je={id:At??null,type:he,geometry:_e,tags:Te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(he==="Point"||he==="MultiPoint"||he==="LineString")an(je,_e);else if(he==="Polygon")an(je,_e[0]);else if(he==="MultiLineString")for(const We of _e)an(je,We);else if(he==="MultiPolygon")for(const We of _e)an(je,We[0]);return je}function an(At,he){for(let _e=0;_e<he.length;_e+=3)At.minX=Math.min(At.minX,he[_e]),At.minY=Math.min(At.minY,he[_e+1]),At.maxX=Math.max(At.maxX,he[_e]),At.maxY=Math.max(At.maxY,he[_e+1])}function Xn(At,he,_e,Te){if(!he.geometry)return;const je=he.geometry.coordinates;if(je&&je.length===0)return;const We=he.geometry.type,Qe=Math.pow(_e.tolerance/((1<<_e.maxZoom)*_e.extent),2);let ft=[],nt=he.id;if(_e.promoteId?nt=he.properties[_e.promoteId]:_e.generateId&&(nt=Te||0),We==="Point")On(je,ft);else if(We==="MultiPoint")for(const St of je)On(St,ft);else if(We==="LineString")Jn(je,ft,Qe,!1);else if(We==="MultiLineString"){if(_e.lineMetrics){for(const St of je)ft=[],Jn(St,ft,Qe,!1),At.push(Kt(nt,"LineString",ft,he.properties));return}Ni(je,ft,Qe,!1)}else if(We==="Polygon")Ni(je,ft,Qe,!0);else{if(We!=="MultiPolygon"){if(We==="GeometryCollection"){for(const St of he.geometry.geometries)Xn(At,{id:nt,geometry:St,properties:he.properties},_e,Te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const St of je){const wt=[];Ni(St,wt,Qe,!0),ft.push(wt)}}At.push(Kt(nt,We,ft,he.properties))}function On(At,he){he.push(Un(At[0]),si(At[1]),0)}function Jn(At,he,_e,Te){let je,We,Qe=0;for(let nt=0;nt<At.length;nt++){const St=Un(At[nt][0]),wt=si(At[nt][1]);he.push(St,wt,0),nt>0&&(Qe+=Te?(je*wt-St*We)/2:Math.sqrt(Math.pow(St-je,2)+Math.pow(wt-We,2))),je=St,We=wt}const ft=he.length-3;he[2]=1,Yt(he,0,ft,_e),he[ft+2]=1,he.size=Math.abs(Qe),he.start=0,he.end=he.size}function Ni(At,he,_e,Te){for(let je=0;je<At.length;je++){const We=[];Jn(At[je],We,_e,Te),he.push(We)}}function Un(At){return At/360+.5}function si(At){const he=Math.sin(At*Math.PI/180),_e=.5-.25*Math.log((1+he)/(1-he))/Math.PI;return _e<0?0:_e>1?1:_e}function ci(At,he,_e,Te,je,We,Qe,ft){if(Te/=he,We>=(_e/=he)&&Qe<Te)return At;if(Qe<_e||We>=Te)return null;const nt=[];for(const St of At){const wt=St.geometry;let Mt=St.type;const we=je===0?St.minX:St.minY,Ze=je===0?St.maxX:St.maxY;if(we>=_e&&Ze<Te){nt.push(St);continue}if(Ze<_e||we>=Te)continue;let at=[];if(Mt==="Point"||Mt==="MultiPoint")_i(wt,at,_e,Te,je);else if(Mt==="LineString")ui(wt,at,_e,Te,je,!1,ft.lineMetrics);else if(Mt==="MultiLineString")Si(wt,at,_e,Te,je,!1);else if(Mt==="Polygon")Si(wt,at,_e,Te,je,!0);else if(Mt==="MultiPolygon")for(const vt of wt){const ht=[];Si(vt,ht,_e,Te,je,!0),ht.length&&at.push(ht)}if(at.length){if(ft.lineMetrics&&Mt==="LineString"){for(const vt of at)nt.push(Kt(St.id,Mt,vt,St.tags));continue}Mt!=="LineString"&&Mt!=="MultiLineString"||(at.length===1?(Mt="LineString",at=at[0]):Mt="MultiLineString"),Mt!=="Point"&&Mt!=="MultiPoint"||(Mt=at.length===3?"Point":"MultiPoint"),nt.push(Kt(St.id,Mt,at,St.tags))}}return nt.length?nt:null}function _i(At,he,_e,Te,je){for(let We=0;We<At.length;We+=3){const Qe=At[We+je];Qe>=_e&&Qe<=Te&&Wn(he,At[We],At[We+1],At[We+2])}}function ui(At,he,_e,Te,je,We,Qe){let ft=Ai(At);const nt=je===0?Ot:ai;let St,wt,Mt=At.start;for(let ht=0;ht<At.length-3;ht+=3){const qt=At[ht],Jt=At[ht+1],En=At[ht+2],Tn=At[ht+3],Bn=At[ht+4],$n=je===0?qt:Jt,Vn=je===0?Tn:Bn;let Pi=!1;Qe&&(St=Math.sqrt(Math.pow(qt-Tn,2)+Math.pow(Jt-Bn,2))),$n<_e?Vn>_e&&(wt=nt(ft,qt,Jt,Tn,Bn,_e),Qe&&(ft.start=Mt+St*wt)):$n>Te?Vn<Te&&(wt=nt(ft,qt,Jt,Tn,Bn,Te),Qe&&(ft.start=Mt+St*wt)):Wn(ft,qt,Jt,En),Vn<_e&&$n>=_e&&(wt=nt(ft,qt,Jt,Tn,Bn,_e),Pi=!0),Vn>Te&&$n<=Te&&(wt=nt(ft,qt,Jt,Tn,Bn,Te),Pi=!0),!We&&Pi&&(Qe&&(ft.end=Mt+St*wt),he.push(ft),ft=Ai(At)),Qe&&(Mt+=St)}let we=At.length-3;const Ze=At[we],at=At[we+1],vt=je===0?Ze:at;vt>=_e&&vt<=Te&&Wn(ft,Ze,at,At[we+2]),we=ft.length-3,We&&we>=3&&(ft[we]!==ft[0]||ft[we+1]!==ft[1])&&Wn(ft,ft[0],ft[1],ft[2]),ft.length&&he.push(ft)}function Ai(At){const he=[];return he.size=At.size,he.start=At.start,he.end=At.end,he}function Si(At,he,_e,Te,je,We){for(const Qe of At)ui(Qe,he,_e,Te,je,We,!1)}function Wn(At,he,_e,Te){At.push(he,_e,Te)}function Ot(At,he,_e,Te,je,We){const Qe=(We-he)/(Te-he);return Wn(At,We,_e+(je-_e)*Qe,1),Qe}function ai(At,he,_e,Te,je,We){const Qe=(We-_e)/(je-_e);return Wn(At,he+(Te-he)*Qe,We,1),Qe}function on(At,he){const _e=[];for(let Te=0;Te<At.length;Te++){const je=At[Te],We=je.type;let Qe;if(We==="Point"||We==="MultiPoint"||We==="LineString")Qe=wn(je.geometry,he);else if(We==="MultiLineString"||We==="Polygon"){Qe=[];for(const ft of je.geometry)Qe.push(wn(ft,he))}else if(We==="MultiPolygon"){Qe=[];for(const ft of je.geometry){const nt=[];for(const St of ft)nt.push(wn(St,he));Qe.push(nt)}}_e.push(Kt(je.id,We,Qe,je.tags))}return _e}function wn(At,he){const _e=[];_e.size=At.size,At.start!==void 0&&(_e.start=At.start,_e.end=At.end);for(let Te=0;Te<At.length;Te+=3)_e.push(At[Te]+he,At[Te+1],At[Te+2]);return _e}function Kn(At,he){if(At.transformed)return At;const _e=1<<At.z,Te=At.x,je=At.y;for(const We of At.features){const Qe=We.geometry,ft=We.type;if(We.geometry=[],ft===1)for(let nt=0;nt<Qe.length;nt+=2)We.geometry.push(ti(Qe[nt],Qe[nt+1],he,_e,Te,je));else for(let nt=0;nt<Qe.length;nt++){const St=[];for(let wt=0;wt<Qe[nt].length;wt+=2)St.push(ti(Qe[nt][wt],Qe[nt][wt+1],he,_e,Te,je));We.geometry.push(St)}}return At.transformed=!0,At}function ti(At,he,_e,Te,je,We){return[Math.round(_e*(At*Te-je)),Math.round(_e*(he*Te-We))]}function Vi(At,he,_e,Te,je){const We=he===je.maxZoom?0:je.tolerance/((1<<he)*je.extent),Qe={features:[],numPoints:0,numSimplified:0,numFeatures:At.length,source:null,x:_e,y:Te,z:he,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ft of At)Zr(Qe,ft,We,je);return Qe}function Zr(At,he,_e,Te){const je=he.geometry,We=he.type,Qe=[];if(At.minX=Math.min(At.minX,he.minX),At.minY=Math.min(At.minY,he.minY),At.maxX=Math.max(At.maxX,he.maxX),At.maxY=Math.max(At.maxY,he.maxY),We==="Point"||We==="MultiPoint")for(let ft=0;ft<je.length;ft+=3)Qe.push(je[ft],je[ft+1]),At.numPoints++,At.numSimplified++;else if(We==="LineString")ga(Qe,je,At,_e,!1,!1);else if(We==="MultiLineString"||We==="Polygon")for(let ft=0;ft<je.length;ft++)ga(Qe,je[ft],At,_e,We==="Polygon",ft===0);else if(We==="MultiPolygon")for(let ft=0;ft<je.length;ft++){const nt=je[ft];for(let St=0;St<nt.length;St++)ga(Qe,nt[St],At,_e,!0,St===0)}if(Qe.length){let ft=he.tags||null;if(We==="LineString"&&Te.lineMetrics){ft={};for(const St in he.tags)ft[St]=he.tags[St];ft.mapbox_clip_start=je.start/je.size,ft.mapbox_clip_end=je.end/je.size}const nt={geometry:Qe,type:We==="Polygon"||We==="MultiPolygon"?3:We==="LineString"||We==="MultiLineString"?2:1,tags:ft};he.id!==null&&(nt.id=he.id),At.features.push(nt)}}function ga(At,he,_e,Te,je,We){const Qe=Te*Te;if(Te>0&&he.size<(je?Qe:Te))return void(_e.numPoints+=he.length/3);const ft=[];for(let nt=0;nt<he.length;nt+=3)(Te===0||he[nt+2]>Qe)&&(_e.numSimplified++,ft.push(he[nt],he[nt+1])),_e.numPoints++;je&&function(nt,St){let wt=0;for(let Mt=0,we=nt.length,Ze=we-2;Mt<we;Ze=Mt,Mt+=2)wt+=(nt[Mt]-nt[Ze])*(nt[Mt+1]+nt[Ze+1]);if(wt>0===St)for(let Mt=0,we=nt.length;Mt<we/2;Mt+=2){const Ze=nt[Mt],at=nt[Mt+1];nt[Mt]=nt[we-2-Mt],nt[Mt+1]=nt[we-1-Mt],nt[we-2-Mt]=Ze,nt[we-1-Mt]=at}}(ft,We),At.push(ft)}const Cr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class oo{constructor(he,_e){const Te=(_e=this.options=function(We,Qe){for(const ft in Qe)We[ft]=Qe[ft];return We}(Object.create(Cr),_e)).debug;if(Te&&console.time("preprocess data"),_e.maxZoom<0||_e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(_e.promoteId&&_e.generateId)throw new Error("promoteId and generateId cannot be used together.");let je=function(We,Qe){const ft=[];if(We.type==="FeatureCollection")for(let nt=0;nt<We.features.length;nt++)Xn(ft,We.features[nt],Qe,nt);else Xn(ft,We.type==="Feature"?We:{geometry:We},Qe);return ft}(he,_e);this.tiles={},this.tileCoords=[],Te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",_e.indexMaxZoom,_e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),je=function(We,Qe){const ft=Qe.buffer/Qe.extent;let nt=We;const St=ci(We,1,-1-ft,ft,0,-1,2,Qe),wt=ci(We,1,1-ft,2+ft,0,-1,2,Qe);return(St||wt)&&(nt=ci(We,1,-ft,1+ft,0,-1,2,Qe)||[],St&&(nt=on(St,1).concat(nt)),wt&&(nt=nt.concat(on(wt,-1)))),nt}(je,_e),je.length&&this.splitTile(je,0,0,0),Te&&(je.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(he,_e,Te,je,We,Qe,ft){const nt=[he,_e,Te,je],St=this.options,wt=St.debug;for(;nt.length;){je=nt.pop(),Te=nt.pop(),_e=nt.pop(),he=nt.pop();const Mt=1<<_e,we=Sr(_e,Te,je);let Ze=this.tiles[we];if(!Ze&&(wt>1&&console.time("creation"),Ze=this.tiles[we]=Vi(he,_e,Te,je,St),this.tileCoords.push({z:_e,x:Te,y:je}),wt)){wt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",_e,Te,je,Ze.numFeatures,Ze.numPoints,Ze.numSimplified),console.timeEnd("creation"));const Pi=`z${_e}`;this.stats[Pi]=(this.stats[Pi]||0)+1,this.total++}if(Ze.source=he,We==null){if(_e===St.indexMaxZoom||Ze.numPoints<=St.indexMaxPoints)continue}else{if(_e===St.maxZoom||_e===We)continue;if(We!=null){const Pi=We-_e;if(Te!==Qe>>Pi||je!==ft>>Pi)continue}}if(Ze.source=null,he.length===0)continue;wt>1&&console.time("clipping");const at=.5*St.buffer/St.extent,vt=.5-at,ht=.5+at,qt=1+at;let Jt=null,En=null,Tn=null,Bn=null,$n=ci(he,Mt,Te-at,Te+ht,0,Ze.minX,Ze.maxX,St),Vn=ci(he,Mt,Te+vt,Te+qt,0,Ze.minX,Ze.maxX,St);he=null,$n&&(Jt=ci($n,Mt,je-at,je+ht,1,Ze.minY,Ze.maxY,St),En=ci($n,Mt,je+vt,je+qt,1,Ze.minY,Ze.maxY,St),$n=null),Vn&&(Tn=ci(Vn,Mt,je-at,je+ht,1,Ze.minY,Ze.maxY,St),Bn=ci(Vn,Mt,je+vt,je+qt,1,Ze.minY,Ze.maxY,St),Vn=null),wt>1&&console.timeEnd("clipping"),nt.push(Jt||[],_e+1,2*Te,2*je),nt.push(En||[],_e+1,2*Te,2*je+1),nt.push(Tn||[],_e+1,2*Te+1,2*je),nt.push(Bn||[],_e+1,2*Te+1,2*je+1)}}getTile(he,_e,Te){he=+he,_e=+_e,Te=+Te;const je=this.options,{extent:We,debug:Qe}=je;if(he<0||he>24)return null;const ft=1<<he,nt=Sr(he,_e=_e+ft&ft-1,Te);if(this.tiles[nt])return Kn(this.tiles[nt],We);Qe>1&&console.log("drilling down to z%d-%d-%d",he,_e,Te);let St,wt=he,Mt=_e,we=Te;for(;!St&&wt>0;)wt--,Mt>>=1,we>>=1,St=this.tiles[Sr(wt,Mt,we)];return St&&St.source?(Qe>1&&(console.log("found parent tile z%d-%d-%d",wt,Mt,we),console.time("drilling down")),this.splitTile(St.source,wt,Mt,we,he,_e,Te),Qe>1&&console.timeEnd("drilling down"),this.tiles[nt]?Kn(this.tiles[nt],We):null):null}}function Sr(At,he,_e){return 32*((1<<At)*_e+he)+At}function yc(At,he){const _e=At.tileID.canonical;if(!this._geoJSONIndex)return void he(null,null);const Te=this._geoJSONIndex.getTile(_e.z,_e.x,_e.y);if(!Te)return void he(null,null);const je=new Tt(Te.features);let We=Pe(je);We.byteOffset===0&&We.byteLength===We.buffer.byteLength||(We=new Uint8Array(We)),he(null,{vectorTile:je,rawData:We.buffer})}class xc extends Se{constructor(he,_e,Te,je,We,Qe){super(he,_e,Te,je,yc,Qe),We&&(this.loadGeoJSON=We),this._dynamicIndex=new Lt}loadData(he,_e){const Te=he&&he.request,je=Te&&Te.collectResourceTiming;this.loadGeoJSON(he,(We,Qe)=>{if(We||!Qe)return _e(We);if(typeof Qe!="object")return _e(new Error(`Input data given to '${he.source}' is not a valid GeoJSON object.`));{try{if(he.filter){const nt=r.U(he.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(nt.result==="error")throw new Error(nt.value.map(St=>`${St.key}: ${St.message}`).join(", "));Qe.features=Qe.features.filter(St=>nt.value.evaluate({zoom:0},St))}he.dynamic?(Qe.type==="Feature"&&(Qe={type:"FeatureCollection",features:[Qe]}),he.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Qe.features,this.loaded),he.cluster&&(Qe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=he.cluster?new bi(function({superclusterOptions:nt,clusterProperties:St}){if(!St||!nt)return nt;const wt={},Mt={},we={accumulated:null,zoom:0},Ze={properties:null},at=Object.keys(St);for(const vt of at){const[ht,qt]=St[vt],Jt=r.U(qt),En=r.U(typeof ht=="string"?[ht,["accumulated"],["get",vt]]:ht);wt[vt]=Jt.value,Mt[vt]=En.value}return nt.map=vt=>{Ze.properties=vt;const ht={};for(const qt of at)ht[qt]=wt[qt].evaluate(we,Ze);return ht},nt.reduce=(vt,ht)=>{Ze.properties=ht;for(const qt of at)we.accumulated=vt[qt],vt[qt]=Mt[qt].evaluate(we,Ze)},nt}(he)).load(Qe.features):he.dynamic?this._dynamicIndex:function(nt,St){return new oo(nt,St)}(Qe,he.geojsonVtOptions)}catch(nt){return _e(nt)}const ft={};if(je){const nt=I(Te);nt&&(ft.resourceTiming={},ft.resourceTiming[he.source]=JSON.parse(JSON.stringify(nt)))}_e(null,ft)}})}reloadTile(he,_e){const Te=this.loaded;return Te&&Te[he.uid]?he.partial?_e(null,void 0):super.reloadTile(he,_e):this.loadTile(he,_e)}loadGeoJSON(he,_e){if(he.request)r.n(he.request,_e);else{if(typeof he.data!="string")return _e(new Error(`Input data given to '${he.source}' is not a valid GeoJSON object.`));try{return _e(null,JSON.parse(he.data))}catch{return _e(new Error(`Input data given to '${he.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(he,_e){try{_e(null,this._geoJSONIndex.getClusterExpansionZoom(he.clusterId))}catch(Te){_e(Te)}}getClusterChildren(he,_e){try{_e(null,this._geoJSONIndex.getChildren(he.clusterId))}catch(Te){_e(Te)}}getClusterLeaves(he,_e){try{_e(null,this._geoJSONIndex.getLeaves(he.clusterId,he.limit,he.offset))}catch(Te){_e(Te)}}}class $o{constructor(he,_e){this.tileID=new r.aG(he.tileID.overscaledZ,he.tileID.wrap,he.tileID.canonical.z,he.tileID.canonical.x,he.tileID.canonical.y),this.tileZoom=he.tileZoom,this.uid=he.uid,this.zoom=he.zoom,this.canonical=he.tileID.canonical,this.pixelRatio=he.pixelRatio,this.tileSize=he.tileSize,this.source=he.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=he.projection,this.brightness=_e}parse(he,_e,Te,je){this.status="parsing";const We=new r.aG(Te.tileID.overscaledZ,Te.tileID.wrap,Te.tileID.canonical.z,Te.tileID.canonical.x,Te.tileID.canonical.y),Qe=[],ft=_e.familiesBySource[Te.source],nt=new r.d$(We,Te.promoteId);return nt.bucketLayerIDs=[],nt.is3DTile=!0,r.ea(he).then(St=>{if(!St)return je(new Error("Could not parse tile"));const wt=r.eb(St,1/r.cc(Te.tileID.canonical)),Mt=St.json.extensionsUsed&&St.json.extensionsUsed.includes("MAPBOX_mesh_features")||St.json.asset.extras&&St.json.asset.extras.MAPBOX_mesh_features,we=St.json.extensionsUsed&&St.json.extensionsUsed.includes("EXT_meshopt_compression"),Ze=new r.a8(this.zoom,{brightness:this.brightness});for(const at in ft)for(const vt of ft[at]){const ht=vt[0];nt.bucketLayerIDs.push(vt.map(Jt=>r.aC(Jt.id,Jt.scope))),ht.recalculate(Ze,[]);const qt=new r.ec(vt,wt,We,Mt,we,this.brightness,nt);Mt||(qt.needsUpload=!0),Qe.push(qt),qt.evaluate(ht)}this.status="done",je(null,{buckets:Qe,featureIndex:nt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(St=>je(new Error(St.message)))}}class Sa{constructor(he,_e,Te,je,We,Qe){this.actor=he,this.layerIndex=_e,this.availableImages=Te,this.brightness=Qe,this.loading={},this.loaded={}}loadTile(he,_e){const Te=he.uid,je=this.loading[Te]=new $o(he,this.brightness);r.bi(he.request,(We,Qe)=>{const ft=!this.loading[Te];return delete this.loading[Te],ft||We?(je.status="done",ft||(this.loaded[Te]=je),_e(We)):Qe&&Qe.byteLength!==0?void je.parse(Qe,this.layerIndex,he,(nt,St)=>{je.status="done",this.loaded=this.loaded||{},this.loaded[Te]=je,nt||!St?_e(nt):_e(null,St)}):(je.status="done",this.loaded[Te]=je,_e())})}reloadTile(he,_e){const Te=this.loaded,je=he.uid;if(Te&&Te[je]){const We=Te[je];We.projection=he.projection,We.brightness=he.brightness;const Qe=(ft,nt)=>{We.reloadCallback&&(delete We.reloadCallback,this.loadTile(he,_e)),_e(ft,nt)};We.status==="parsing"?We.reloadCallback=Qe:We.status==="done"&&this.loadTile(he,_e)}}abortTile(he,_e){const Te=he.uid;this.loading[Te]&&delete this.loading[Te],_e()}removeTile(he,_e){const Te=this.loaded,je=he.uid;Te&&Te[je]&&delete Te[je],_e()}}class Xo{constructor(he){this.self=he,this.actor=new r.ed(he,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new r.I,this.projections={},this.defaultProjection=r.bP({name:"mercator"}),this.workerSourceTypes={vector:Se,geojson:xc,"batched-model":Sa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(_e,Te)=>{if(this.workerSourceTypes[_e])throw new Error(`Worker source with name "${_e}" already registered.`);this.workerSourceTypes[_e]=Te},this.self.registerRTLTextPlugin=_e=>{if(r.ee.isParsed())throw new Error("RTL text plugin already registered.");r.ee.applyArabicShaping=_e.applyArabicShaping,r.ee.processBidirectionalText=_e.processBidirectionalText,r.ee.processStyledBidirectionalText=_e.processStyledBidirectionalText}}clearCaches(he,_e,Te){delete this.layerIndexes[he],delete this.availableImages[he],delete this.workerSources[he],delete this.demWorkerSources[he],delete this.rasterArrayWorkerSource,Te()}checkIfReady(he,_e,Te){Te()}setReferrer(he,_e){this.referrer=_e}spriteLoaded(he,{scope:_e,isLoaded:Te}){if(this.isSpriteLoaded[he]||(this.isSpriteLoaded[he]={}),this.isSpriteLoaded[he][_e]=Te,this.workerSources[he]&&this.workerSources[he][_e])for(const je in this.workerSources[he][_e]){const We=this.workerSources[he][_e][je];for(const Qe in We){const ft=We[Qe];ft instanceof Se&&(ft.isSpriteLoaded=Te,ft.fire(new r.z("isSpriteLoaded")))}}}setImages(he,{scope:_e,images:Te},je){if(this.availableImages[he]||(this.availableImages[he]={}),this.availableImages[he][_e]=Te,this.workerSources[he]&&this.workerSources[he][_e]){for(const We in this.workerSources[he][_e]){const Qe=this.workerSources[he][_e][We];for(const ft in Qe)Qe[ft].availableImages=Te}je()}else je()}setProjection(he,_e){this.projections[he]=r.bP(_e)}setBrightness(he,_e,Te){this.brightness=_e,Te()}setLayers(he,_e,Te){this.getLayerIndex(he,_e.scope).replace(_e.layers,_e.options),Te()}updateLayers(he,_e,Te){this.getLayerIndex(he,_e.scope).update(_e.layers,_e.removedIds,_e.options),Te()}loadTile(he,_e,Te){_e.projection=this.projections[he]||this.defaultProjection,this.getWorkerSource(he,_e.type,_e.source,_e.scope).loadTile(_e,Te)}loadDEMTile(he,_e,Te){this.getDEMWorkerSource(he,_e.source,_e.scope).loadTile(_e,Te)}decodeRasterArray(he,_e,Te){this.getRasterArrayWorkerSource().decodeRasterArray(_e,Te)}reloadTile(he,_e,Te){_e.projection=this.projections[he]||this.defaultProjection,this.getWorkerSource(he,_e.type,_e.source,_e.scope).reloadTile(_e,Te)}abortTile(he,_e,Te){this.getWorkerSource(he,_e.type,_e.source,_e.scope).abortTile(_e,Te)}removeTile(he,_e,Te){this.getWorkerSource(he,_e.type,_e.source,_e.scope).removeTile(_e,Te)}removeSource(he,_e,Te){if(!(this.workerSources[he]&&this.workerSources[he][_e.scope]&&this.workerSources[he][_e.scope][_e.type]&&this.workerSources[he][_e.scope][_e.type][_e.source]))return;const je=this.workerSources[he][_e.scope][_e.type][_e.source];delete this.workerSources[he][_e.scope][_e.type][_e.source],je.removeSource!==void 0?je.removeSource(_e,Te):Te()}loadWorkerSource(he,_e,Te){try{this.self.importScripts(_e.url),Te()}catch(je){Te(je.toString())}}syncRTLPluginState(he,_e,Te){try{r.ee.setState(_e);const je=r.ee.getPluginURL();if(r.ee.isLoaded()&&!r.ee.isParsed()&&je!=null){this.self.importScripts(je);const We=r.ee.isParsed();Te(We?void 0:new Error(`RTL Text Plugin failed to import scripts from ${je}`),We)}}catch(je){Te(je.toString())}}setDracoUrl(he,_e){this.dracoUrl=_e}getAvailableImages(he,_e){this.availableImages[he]||(this.availableImages[he]={});let Te=this.availableImages[he][_e];return Te||(Te=[]),Te}getLayerIndex(he,_e){this.layerIndexes[he]||(this.layerIndexes[he]={});let Te=this.layerIndexes[he][_e];return Te||(Te=this.layerIndexes[he][_e]=new U,Te.scope=_e),Te}getWorkerSource(he,_e,Te,je){return this.workerSources[he]||(this.workerSources[he]={}),this.workerSources[he][je]||(this.workerSources[he][je]={}),this.workerSources[he][je][_e]||(this.workerSources[he][je][_e]={}),this.isSpriteLoaded[he]||(this.isSpriteLoaded[he]={}),this.workerSources[he][je][_e][Te]||(this.workerSources[he][je][_e][Te]=new this.workerSourceTypes[_e]({send:(We,Qe,ft,nt,St,wt)=>{this.actor.send(We,Qe,ft,he,St,wt)},scheduler:this.actor.scheduler},this.getLayerIndex(he,je),this.getAvailableImages(he,je),this.isSpriteLoaded[he][je],void 0,this.brightness)),this.workerSources[he][je][_e][Te]}rasterizeImages(he,_e,Te){const{imageTasks:je,scope:We}=_e,Qe={};for(const ft in je){const{image:nt,imageIdWithOptions:St}=je[ft];Qe[ft]=this.imageRasterizer.rasterize(St,nt,We,he)}Te(void 0,Qe)}removeRasterizedImages(he,_e,Te){const{imageIds:je,scope:We}=_e;this.imageRasterizer.removeImagesFromCacheByIds(je,We,he),Te()}getDEMWorkerSource(he,_e,Te){return this.demWorkerSources[he]||(this.demWorkerSources[he]={}),this.demWorkerSources[he][Te]||(this.demWorkerSources[he][Te]={}),this.demWorkerSources[he][Te][_e]||(this.demWorkerSources[he][Te][_e]=new xe),this.demWorkerSources[he][Te][_e]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Fe),this.rasterArrayWorkerSource}enforceCacheSizeLimit(he,_e){r.ef(_e)}getWorkerPerformanceMetrics(he,_e,Te){Te(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Xo(self)),Xo}),y(["./shared"],function(r){var I="3.10.0";const k={create:"create",load:"load",fullLoad:"fullLoad"},B={mark(f){performance.mark(f)},measure(f,i,s){performance.measure(f,i,s)}};function U(f){const i=f.name.split("?")[0];return r.a(i)&&i.includes("mapbox-gl.js")?"javascript":r.a(i)&&i.includes("mapbox-gl.css")?"css":r.b(i)?"fontRange":r.c(i)?"sprite":r.i(i)?"style":r.d(i)?"tilejson":"other"}var H,Y={},X=function(){if(H)return Y;function f(m){return!i(m)}function i(m){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,T,P=new Blob([""],{type:"text/javascript"}),N=URL.createObjectURL(P);try{T=new Worker(N),b=!0}catch{b=!1}return T&&T.terminate(),URL.revokeObjectURL(N),b}()?function(){var b=document.createElement("canvas");b.width=b.height=1;var T=b.getContext("2d");if(!T)return!1;var P=T.getImageData(0,0,1,1);return P&&P.width===b.width}()?(s[x=m&&m.failIfMajorPerformanceCaveat]===void 0&&(s[x]=function(b){var T,P=function(N){var V=document.createElement("canvas"),q=Object.create(f.webGLContextAttributes);return q.failIfMajorPerformanceCaveat=N,V.getContext("webgl2",q)}(b);if(!P)return!1;try{T=P.createShader(P.VERTEX_SHADER)}catch{return!1}return!(!T||P.isContextLost())&&(P.shaderSource(T,"void main() {}"),P.compileShader(T),P.getShaderParameter(T,P.COMPILE_STATUS)===!0)}(x)),s[x]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var x}H=1,Y.supported=f,Y.notSupportedReason=i;var s={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Y}();function Q(f,i,s){const m=document.createElement(f);return i!=null&&(m.className=i),s&&s.appendChild(m),m}function J(f,i,s){const m=document.createElementNS("http://www.w3.org/2000/svg",f);for(const x of Object.keys(i))m.setAttributeNS(null,x,String(i[x]));return s&&s.appendChild(m),m}const j=typeof document<"u"?document.documentElement&&document.documentElement.style:null,oe=j&&j.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ce;function pe(){j&&oe&&(ce=j[oe],j[oe]="none")}function Ae(){j&&oe&&(j[oe]=ce)}function Ee(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",Ee,!0)}function be(){window.addEventListener("click",Ee,!0),window.setTimeout(()=>{window.removeEventListener("click",Ee,!0)},0)}function Ve(f,i){const s=f.getBoundingClientRect();return Fe(f,s,i)}function Se(f,i){const s=f.getBoundingClientRect(),m=[];for(let x=0;x<i.length;x++)m.push(Fe(f,s,i[x]));return m}function xe(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function Fe(f,i,s){const m=f.offsetWidth===i.width?1:f.offsetWidth/i.width;return new r.P((s.clientX-i.left)*m,(s.clientY-i.top)*m)}const Ct="01",Et="NO_ACCESS_TOKEN";class Tt{constructor(i,s,m){this._transformRequestFn=i,this._customAccessToken=s,this._silenceAuthErrors=!!m,this._createSkuToken()}_createSkuToken(){const i=function(){let s="";for(let m=0;m<10;m++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ct,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,s){return this._transformRequestFn&&this._transformRequestFn(i,s)||{url:i}}normalizeStyleURL(i,s){if(!r.f(i))return i;const m=et(i);return m.params.push(`sdk=js-${I}`),m.path=`/styles/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||s)}normalizeGlyphsURL(i,s){if(!r.f(i))return i;const m=et(i);return m.path=`/fonts/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||s)}normalizeModelURL(i,s){if(!r.f(i))return i;const m=et(i);return m.path=`/models/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||s)}normalizeSourceURL(i,s,m,x){if(!r.f(i))return i;const b=et(i);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),m&&b.params.push(`language=${m}`),x&&b.params.push(`worldview=${x}`),this._makeAPIURL(b,this._customAccessToken||s)}normalizeIconsetURL(i,s){const m=et(i);return r.f(i)?(m.path=`/styles/v1${m.path}/iconset.pbf`,this._makeAPIURL(m,this._customAccessToken||s)):Lt(m)}normalizeSpriteURL(i,s,m,x){const b=et(i);return r.f(i)?(b.path=`/styles/v1${b.path}/sprite${s}${m}`,this._makeAPIURL(b,this._customAccessToken||x)):(b.path+=`${s}${m}`,Lt(b))}normalizeTileURL(i,s,m){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!r.f(i))return i;const x=et(i);x.path=x.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${s||m&&x.authority!=="raster"&&m===512?"@2x":""}${r.m.supported?".webp":"$1"}`),x.authority==="raster"?x.path=`/${r.e.RASTER_URL_PREFIX}${x.path}`:x.authority==="rasterarrays"?x.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${x.path}`:x.authority==="3dtiles"?x.path=`/${r.e.TILES3D_URL_PREFIX}${x.path}`:(x.path=x.path.replace(/^.+\/v4\//,"/"),x.path=`/${r.e.TILE_URL_VERSION}${x.path}`);const b=this._customAccessToken||function(T){for(const P of T){const N=P.match(/^access_token=(.*)$/);if(N)return N[1]}return null}(x.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&x.params.push(`sku=${this._skuToken}`),this._makeAPIURL(x,b)}canonicalizeTileURL(i,s){const m=et(i);if(!m.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!m.path.match(/\.[\w]+$/))return i;let x="mapbox://";m.path.match(/^\/raster\/v1\//)?x+=`raster/${m.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:m.path.match(/^\/rasterarrays\/v1\//)?x+=`rasterarrays/${m.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:x+=`tiles/${m.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let b=m.params;return s&&(b=b.filter(T=>!T.match(/^access_token=/))),b.length&&(x+=`?${b.join("&")}`),x}canonicalizeTileset(i,s){const m=!!s&&r.f(s),x=[];for(const b of i.tiles||[])r.h(b)?x.push(this.canonicalizeTileURL(b,m)):x.push(b);return x}_makeAPIURL(i,s){const m="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",x=et(r.e.API_URL);if(i.protocol=x.protocol,i.authority=x.authority,i.protocol==="http"){const b=i.params.indexOf("secure");b>=0&&i.params.splice(b,1)}if(x.path!=="/"&&(i.path=`${x.path}${i.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return Lt(i);if(s=s||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!s)throw new Error(`An API access token is required to use Mapbox GL. ${m}`);if(s[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${m}`)}return i.params=i.params.filter(b=>b.indexOf("access_token")===-1),i.params.push(`access_token=${s||""}`),Lt(i)}}const _t=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function et(f){const i=f.match(_t);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function Lt(f){const i=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${i}`}const lt="mapbox.eventData";function ut(f){if(!f)return null;const i=f.split(".");if(!i||i.length!==3)return null;try{return JSON.parse(r.j(i[1]))}catch{return null}}class Xe{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const s=ut(r.e.ACCESS_TOKEN);let m="";return m=s&&s.u?r.k(s.u):r.e.ACCESS_TOKEN||"",i?`${lt}.${i}:${m}`:`${lt}:${m}`}fetchEventData(){const i=r.s("localStorage"),s=this.getStorageKey(),m=this.getStorageKey("uuid");if(i)try{const x=localStorage.getItem(s);x&&(this.eventData=JSON.parse(x));const b=localStorage.getItem(m);b&&(this.anonId=b)}catch{r.w("Unable to read from LocalStorage")}}saveEventData(){const i=r.s("localStorage"),s=this.getStorageKey(),m=this.getStorageKey("uuid"),x=this.anonId;if(i&&x)try{localStorage.setItem(m,x),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData))}catch{r.w("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,s,m,x){if(!r.e.EVENTS_URL)return;const b=et(r.e.EVENTS_URL);b.params.push(`access_token=${x||r.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(i).toISOString()},P=s?r.l(T,s):T,N={url:Lt(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=r.p(N,V=>{this.pendingRequest=null,m(V),this.saveEventData(),this.processRequests(x)})}queueRequest(i,s){this.queue.push(i),this.processRequests(s)}}const kt=new class extends Xe{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,i){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(s=>r.f(s)||r.h(s))&&this.queueRequest(Date.now(),i)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=ut(r.e.ACCESS_TOKEN),s=i?i.u:r.e.ACCESS_TOKEN;let m=s!==this.eventData.tokenU;r.v(this.anonId)||(this.anonId=r.u(),m=!0);const x=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),T=new Date(x),P=(x-this.eventData.lastSuccess)/864e5;m=m||P>=1||P<-1||b.getDate()!==T.getDate()}else m=!0;m?this.postEvent(x,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:Ct,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=x,this.eventData.tokenU=s)},f):this.processRequests()}},_n=kt.postTurnstileEvent.bind(kt),Xt=new class extends Xe{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,i,s,m){this.skuToken=i,this.errorCb=m,r.e.EVENTS_URL&&(s||r.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},s):this.errorCb(new Error(Et)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:s}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),r.v(this.anonId)||(this.anonId=r.u()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:Ct,skuToken:this.skuToken,userId:this.anonId},m=>{m?this.errorCb(m):i&&(this.success[i]=!0)},f))}remove(){this.errorCb=null}},It=Xt.postMapLoadEvent.bind(Xt),ln=new class extends Xe{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let i=this.mapInstanceIdMap.get(f);return i||(i=r.u(),this.mapInstanceIdMap.set(f,i)),i}getEventId(f){const i=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,i+1),i}postStyleLoadEvent(f,i){const{map:s,style:m,importedStyles:x}=i;if(!r.e.EVENTS_URL||!f&&!r.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(s),T={mapInstanceId:b,eventId:this.getEventId(b),style:m};x.length&&(T.importedStyles=x),this.queueRequest({timestamp:Date.now(),payload:T},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,payload:s}=this.queue.shift();this.postEvent(i,s,()=>{},f)}},fn=ln.postStyleLoadEvent.bind(ln),$t=new class extends Xe{constructor(){super("gljs.performance")}postPerformanceEvent(f,i){r.e.EVENTS_URL&&(f||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,performanceData:s}=this.queue.shift(),m=function(x){const b=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),P=function(ne){const fe={};if(ne){for(const ue in ne)if(ue!=="other")for(const ve of ne[ue]){const ge=`${ue}ResolveRangeMin`,Ce=`${ue}ResolveRangeMax`,ze=`${ue}RequestCount`,Le=`${ue}RequestCachedCount`;fe[ge]=Math.min(fe[ge]||1/0,ve.startTime),fe[Ce]=Math.max(fe[Ce]||-1/0,ve.responseEnd);const qe=Ne=>{fe[Ne]===void 0&&(fe[Ne]=0),++fe[Ne]};ve.transferSize!==void 0&&ve.transferSize===0&&qe(Le),qe(ze)}}return fe}(function(ne,fe){const ue={};if(ne)for(const ve of ne){const ge=fe(ve);ue[ge]===void 0&&(ue[ge]=[]),ue[ge].push(ve)}return ue}(b,U)),N=window.devicePixelRatio,V=navigator.connection||navigator.mozConnection||navigator.webkitConnection,q=V?V.effectiveType:void 0,Z={counters:[],metadata:[],attributes:[]},K=(ne,fe,ue)=>{ue!=null&&ne.push({name:fe,value:ue.toString()})};for(const ne in P)K(Z.counters,ne,P[ne]);if(x.interactionRange[0]!==1/0&&x.interactionRange[1]!==-1/0&&(K(Z.counters,"interactionRangeMin",x.interactionRange[0]),K(Z.counters,"interactionRangeMax",x.interactionRange[1])),T)for(const ne of Object.keys(k)){const fe=k[ne],ue=T.find(ve=>ve.name===fe);ue&&K(Z.counters,fe,ue.startTime)}return K(Z.counters,"visibilityHidden",x.visibilityHidden),K(Z.attributes,"style",function(ne){if(ne)for(const fe of ne){const ue=fe.name.split("?")[0];if(r.i(ue)){const ve=ue.split("/").slice(-2);if(ve.length===2)return`mapbox://styles/${ve[0]}/${ve[1]}`}}}(b)),K(Z.attributes,"terrainEnabled",x.terrainEnabled?"true":"false"),K(Z.attributes,"fogEnabled",x.fogEnabled?"true":"false"),K(Z.attributes,"projection",x.projection),K(Z.attributes,"zoom",x.zoom),K(Z.metadata,"devicePixelRatio",N),K(Z.metadata,"connectionEffectiveType",q),K(Z.metadata,"navigatorUserAgent",navigator.userAgent),K(Z.metadata,"screenWidth",window.screen.width),K(Z.metadata,"screenHeight",window.screen.height),K(Z.metadata,"windowWidth",window.innerWidth),K(Z.metadata,"windowHeight",window.innerHeight),K(Z.metadata,"mapWidth",x.width/N),K(Z.metadata,"mapHeight",x.height/N),K(Z.metadata,"webglRenderer",x.renderer),K(Z.metadata,"webglVendor",x.vendor),K(Z.metadata,"sdkVersion",I),K(Z.metadata,"sdkIdentifier","mapbox-gl-js"),Z}(s);for(const x of m.metadata);for(const x of m.counters);for(const x of m.attributes);this.postEvent(i,m,()=>{},f)}},pn=$t.postPerformanceEvent.bind($t),jn=new class extends Xe{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,i,s,m){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const x=et(r.e.API_URL+r.e.SESSION_PATH);x.params.push(`sku=${i||""}`),x.params.push(`access_token=${m||r.e.ACCESS_TOKEN||""}`);const b={url:Lt(x),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(b,T=>{this.pendingRequest=null,s(T),this.saveEventData(),this.processRequests(m)})}getSessionAPI(f,i,s,m){this.skuToken=i,this.errorCb=m,r.e.SESSION_PATH&&r.e.API_URL&&(s||r.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},s):this.errorCb(new Error(Et)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:s}=this.queue.shift();i&&this.success[i]||this.getSession(s,this.skuToken,m=>{m?this.errorCb(m):i&&(this.success[i]=!0)},f)}remove(){this.errorCb=null}},Pe=jn.getSessionAPI.bind(jn),Gn=new Set;function vn(f,i){i?Gn.add(f):Gn.delete(f)}class qn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,s){this._updatedSourceCaches[i]=s,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){const s=i.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(i.id),this.setDirty()}removeLayer(i){const s=i.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][i.id]=i,this._updatedLayers[s].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){const i={};for(const s in this._updatedLayers)i[s]=i[s]||{},i[s].updatedIds=Array.from(this._updatedLayers[s].values());for(const s in this._removedLayers)i[s]=i[s]||{},i[s].removedIds=Object.keys(this._removedLayers[s]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(i){this._updatedImages.add(i),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function ke(f){const{userImage:i}=f;return!!(i&&i.render&&i.render())&&(f.data.replace(new Uint8Array(i.data.buffer)),!0)}class Fi extends r.E{constructor(i){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=i,i!=="raster"&&r.t()&&(this.imageRasterizerDispatcher=new r.D(r.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.I),this._imageRasterizer}createScope(i){this.images[i]={},this.loaded[i]=!1,this.updatedImages[i]={},this.patterns[i]={},this.callbackDispatchedThisFrame[i]={},this.atlasImage[i]=new r.r({width:1,height:1})}isLoaded(){for(const i in this.loaded)if(!this.loaded[i])return!1;return!0}setLoaded(i,s){if(this.loaded[s]!==i&&(this.loaded[s]=i,i)){for(const{ids:m,callback:x}of this.requestors)this._notify(m,s,x);this.requestors=[]}}hasImage(i,s){return!!this.getImage(i,s)}getImage(i,s){return this.images[s][i]}addImage(i,s,m){this._validate(i,m)&&(this.images[s][i]=m)}_validate(i,s){let m=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new r.y(new Error(`Image "${i}" has invalid "stretchX" value`))),m=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new r.y(new Error(`Image "${i}" has invalid "stretchY" value`))),m=!1),this._validateContent(s.content,s)||(this.fire(new r.y(new Error(`Image "${i}" has invalid "content" value`))),m=!1),m}_validateStretch(i,s){if(!i)return!0;let m=0;for(const x of i){if(x[0]<m||x[1]<x[0]||s<x[1])return!1;m=x[1]}return!0}_validateContent(i,s){return i?i.length!==4||!s.usvg&&(i[0]<0||s.data.width<i[0]||i[1]<0||s.data.height<i[1]||i[2]<0||s.data.width<i[2]||i[3]<0||s.data.height<i[3])?!1:!(i[2]<i[0]||i[3]<i[1]):!0}updateImage(i,s,m){m.version=this.images[s][i].version+1,this.images[s][i]=m,this.updatedImages[s][i]=!0,this.removeFromImageRasterizerCache(i,s)}removeFromImageRasterizerCache(i,s){this.spriteFormat!=="raster"&&(r.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[i],scope:s}):this.imageRasterizer.removeImagesFromCacheByIds([i],s))}removeImage(i,s){const m=this.images[s][i];delete this.images[s][i],delete this.patterns[s][i],this.removeFromImageRasterizerCache(i,s),m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(i){return Object.keys(this.images[i])}getImages(i,s,m){let x=!0;const b=!!this.loaded[s];if(!b)for(const T of i)this.images[s][T]||(x=!1);b||x?this._notify(i,s,m):this.requestors.push({ids:i,scope:s,callback:m})}rasterizeImages({scope:i,imageTasks:s},m){const x={};for(const b in s){const T=s[b],P=this.getImage(T.id,i);P&&(x[b]={image:P,imageIdWithOptions:T})}r.t()?this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{imageTasks:x,scope:i},m):this.rasterizeImagesInMainThread({imageTasks:x,scope:i},m)}rasterizeImagesInMainThread(i,s){const{imageTasks:m,scope:x}=i,b={};for(const T in m){const{image:P,imageIdWithOptions:N}=m[T];b[T]=this.imageRasterizer.rasterize(N,P,x,"")}s(void 0,b)}getUpdatedImages(i){return this.updatedImages[i]}_notify(i,s,m){const x={};for(const b of i){this.images[s][b]||this.fire(new r.z("styleimagemissing",{id:b}));const T=this.images[s][b];T?x[b]={data:T.usvg?null:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,usvg:T.usvg,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)}:r.w(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}m(null,x)}getPixelSize(i){const{width:s,height:m}=this.atlasImage[i];return{width:s,height:m}}getPattern(i,s,m){const x=this.patterns[s][i],b=this.getImage(i,s);if(!b)return null;if(x&&x.position.version===b.version)return x.position;if(x)x.position.version=b.version;else{b.usvg&&!b.data&&(b.data=this.imageRasterizer.rasterize(r.A.from(i).getPrimary(),b,s,""));const T={w:b.data.width+2*r.B,h:b.data.height+2*r.B,x:0,y:0},P=new r.C(T,b,r.B);this.patterns[s][i]={bin:T,position:P}}return this._updatePatternAtlas(s,m),this.patterns[s][i].position}bind(i,s){const m=i.gl;let x=this.atlasTexture[s];x?this.dirty&&(x.update(this.atlasImage[s]),this.dirty=!1):(x=new r.T(i,this.atlasImage[s],m.RGBA8),this.atlasTexture[s]=x),x.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(i,s){const m=[];for(const P in this.patterns[i])m.push(this.patterns[i][P].bin);const{w:x,h:b}=r.F(m),T=this.atlasImage[i];T.resize({width:x||1,height:b||1});for(const P in this.patterns[i]){const{bin:N,position:V}=this.patterns[i][P];let q=V.padding;const Z=N.x+q,K=N.y+q,ne=this.images[i][P].data,fe=ne.width,ue=ne.height;q=q>1?q-1:q,r.r.copy(ne,T,{x:0,y:0},{x:Z,y:K},{width:fe,height:ue},s),r.r.copy(ne,T,{x:0,y:ue-q},{x:Z,y:K-q},{width:fe,height:q},s),r.r.copy(ne,T,{x:0,y:0},{x:Z,y:K+ue},{width:fe,height:q},s),r.r.copy(ne,T,{x:fe-q,y:0},{x:Z-q,y:K},{width:q,height:ue},s),r.r.copy(ne,T,{x:0,y:0},{x:Z+fe,y:K},{width:q,height:ue},s),r.r.copy(ne,T,{x:fe-q,y:ue-q},{x:Z-q,y:K-q},{width:q,height:q},s),r.r.copy(ne,T,{x:0,y:ue-q},{x:Z+fe,y:K-q},{width:q,height:q},s),r.r.copy(ne,T,{x:0,y:0},{x:Z+fe,y:K+ue},{width:q,height:q},s),r.r.copy(ne,T,{x:fe-q,y:0},{x:Z-q,y:K+ue},{width:q,height:q},s)}this.dirty=!0}beginFrame(){for(const i in this.images)this.callbackDispatchedThisFrame[i]={}}dispatchRenderCallbacks(i,s){for(const m of i){if(this.callbackDispatchedThisFrame[s][m])continue;this.callbackDispatchedThisFrame[s][m]=!0;const x=this.images[s][m];ke(x)&&this.updateImage(m,s,x)}}}function di(f){const i=f.key,s=f.value,m=f.valueSpec||{},x=f.objectElementValidators||{},b=f.style,T=f.styleSpec;let P=[];const N=r.H(s);if(N!=="object")return[new r.V(i,s,`object expected, ${N} found`)];for(const V in s){const q=V.split(".")[0];let Z;x[q]?Z=x[q]:m[q]?Z=Wn:x["*"]?Z=x["*"]:m["*"]&&(Z=Wn),Z?P=P.concat(Z({key:(i&&`${i}.`)+V,value:s[V],valueSpec:m[q]||m["*"],style:b,styleSpec:T,object:s,objectKey:V},s)):P.push(new r.G(i,s[V],`unknown property "${V}"`))}for(const V in m)x[V]||m[V].required&&m[V].default===void 0&&s[V]===void 0&&P.push(new r.V(i,s,`missing required property "${V}"`));return P}function bi(f){const i=f.value,s=f.valueSpec,m=f.style,x=f.styleSpec,b=f.key,T=f.arrayElementValidator||Wn;if(r.H(i)!=="array")return[new r.V(b,i,`array expected, ${r.H(i)} found`)];if(s.length&&i.length!==s.length)return[new r.V(b,i,`array length ${s.length} expected, length ${i.length} found`)];if(s["min-length"]&&i.length<s["min-length"])return[new r.V(b,i,`array length at least ${s["min-length"]} expected, length ${i.length} found`)];let P={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};x.$version<7&&(P.function=s.function),r.H(s.value)==="object"&&(P=s.value);let N=[];for(let V=0;V<i.length;V++)N=N.concat(T({array:i,arrayIndex:V,value:i[V],valueSpec:P,style:m,styleSpec:x,key:`${b}[${V}]`},!0));return N}function Mn(f){const i=f.key,s=f.value,m=f.valueSpec;let x=r.H(s);if(x==="number"&&s!=s&&(x="NaN"),x!=="number")return[new r.V(i,s,`number expected, ${x} found`)];if("minimum"in m){let b=m.minimum;if(r.H(m.minimum)==="array"&&(b=m.minimum[f.arrayIndex]),s<b)return[new r.V(i,s,`${s} is less than the minimum value ${b}`)]}if("maximum"in m){let b=m.maximum;if(r.H(m.maximum)==="array"&&(b=m.maximum[f.arrayIndex]),s>b)return[new r.V(i,s,`${s} is greater than the maximum value ${b}`)]}return[]}function wi(f){const i=f.valueSpec,s=r.K(f.value.type);let m,x,b,T={};const P=s!=="categorical"&&f.value.property===void 0,N=!P,V=r.H(f.value.stops)==="array"&&r.H(f.value.stops[0])==="array"&&r.H(f.value.stops[0][0])==="object",q=di({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(ne){if(s==="identity")return[new r.V(ne.key,ne.value,'identity function may not have a "stops" property')];let fe=[];const ue=ne.value;return fe=fe.concat(bi({key:ne.key,value:ue,valueSpec:ne.valueSpec,style:ne.style,styleSpec:ne.styleSpec,arrayElementValidator:Z})),r.H(ue)==="array"&&ue.length===0&&fe.push(new r.V(ne.key,ue,"array must have at least one stop")),fe},default:function(ne){return Wn({key:ne.key,value:ne.value,valueSpec:i,style:ne.style,styleSpec:ne.styleSpec})}}});return s==="identity"&&P&&q.push(new r.V(f.key,f.value,'missing required property "property"')),s==="identity"||f.value.stops||q.push(new r.V(f.key,f.value,'missing required property "stops"')),s==="exponential"&&f.valueSpec.expression&&!r.L(f.valueSpec)&&q.push(new r.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(N&&!r.M(f.valueSpec)?q.push(new r.V(f.key,f.value,"property functions not supported")):P&&!r.N(f.valueSpec)&&q.push(new r.V(f.key,f.value,"zoom functions not supported"))),s!=="categorical"&&!V||f.value.property!==void 0||q.push(new r.V(f.key,f.value,'"property" property is required')),q;function Z(ne){let fe=[];const ue=ne.value,ve=ne.key;if(r.H(ue)!=="array")return[new r.V(ve,ue,`array expected, ${r.H(ue)} found`)];if(ue.length!==2)return[new r.V(ve,ue,`array length 2 expected, length ${ue.length} found`)];if(V){if(r.H(ue[0])!=="object")return[new r.V(ve,ue,`object expected, ${r.H(ue[0])} found`)];if(ue[0].zoom===void 0)return[new r.V(ve,ue,"object stop key must have zoom")];if(ue[0].value===void 0)return[new r.V(ve,ue,"object stop key must have value")];const ge=r.K(ue[0].zoom);if(typeof ge!="number")return[new r.V(ve,ue[0].zoom,"stop zoom values must be numbers")];if(b&&b>ge)return[new r.V(ve,ue[0].zoom,"stop zoom values must appear in ascending order")];ge!==b&&(b=ge,x=void 0,T={}),fe=fe.concat(di({key:`${ve}[0]`,value:ue[0],valueSpec:{zoom:{}},style:ne.style,styleSpec:ne.styleSpec,objectElementValidators:{zoom:Mn,value:K}}))}else fe=fe.concat(K({key:`${ve}[0]`,value:ue[0],style:ne.style,styleSpec:ne.styleSpec},ue));return r.O(r.Q(ue[1]))?fe.concat([new r.V(`${ve}[1]`,ue[1],"expressions are not allowed in function stops.")]):fe.concat(Wn({key:`${ve}[1]`,value:ue[1],valueSpec:i,style:ne.style,styleSpec:ne.styleSpec}))}function K(ne,fe){const ue=r.H(ne.value),ve=r.K(ne.value),ge=ne.value!==null?ne.value:fe;if(m){if(ue!==m)return[new r.V(ne.key,ge,`${ue} stop domain type must match previous stop domain type ${m}`)]}else m=ue;if(ue!=="number"&&ue!=="string"&&ue!=="boolean"&&typeof ve!="number"&&typeof ve!="string"&&typeof ve!="boolean")return[new r.V(ne.key,ge,"stop domain value must be a number, string, or boolean")];if(ue!=="number"&&s!=="categorical"){let Ce=`number expected, ${ue} found`;return r.M(i)&&s===void 0&&(Ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(ne.key,ge,Ce)]}return s!=="categorical"||ue!=="number"||typeof ve=="number"&&isFinite(ve)&&Math.floor(ve)===ve?s!=="categorical"&&ue==="number"&&typeof ve=="number"&&typeof x=="number"&&x!==void 0&&ve<x?[new r.V(ne.key,ge,"stop domain values must appear in ascending order")]:(x=ve,s==="categorical"&&ve in T?[new r.V(ne.key,ge,"stop domain values must be unique")]:(T[ve]=!0,[])):[new r.V(ne.key,ge,`integer expected, found ${String(ve)}`)]}}function ei(f){const i=(f.expressionContext==="property"?r.S:r.U)(r.Q(f.value),f.valueSpec);if(i.result==="error")return i.value.map(m=>new r.V(`${f.key}${m.key}`,f.value,m.message));const s=i.value.expression||i.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!s.outputDefined())return[new r.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!r.W(s))return[new r.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return ot(s,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!r.X(s,["zoom","feature-state"]))return[new r.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!r.Y(s))return[new r.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ot(f,i){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const x of i.valueSpec.expression.parameters)s.delete(x);if(s.size===0)return[];const m=[];return f instanceof r.Z&&s.has(f.name)?[new r.V(i.key,i.value,`["${f.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(f.eachChild(x=>{m.push(...ot(x,i))}),m)}function Ue(f){const i=f.key,s=f.value,m=f.valueSpec,x=[];return Array.isArray(m.values)?m.values.indexOf(r.K(s))===-1&&x.push(new r.V(i,s,`expected one of [${m.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(m.values).indexOf(r.K(s))===-1&&x.push(new r.V(i,s,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(s)} found`)),x}function Yt(f){return r.$(r.Q(f.value))?ei(r.J({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):gt(f)}function gt(f){const i=f.value,s=f.key;if(r.H(i)!=="array")return[new r.V(s,i,`array expected, ${r.H(i)} found`)];const m=f.styleSpec;let x,b=[];if(i.length<1)return[new r.V(s,i,"filter array must have at least 1 element")];switch(b=b.concat(Ue({key:`${s}[0]`,value:i[0],valueSpec:m.filter_operator,style:f.style,styleSpec:f.styleSpec})),r.K(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&r.K(i[1])==="$type"&&b.push(new r.V(s,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&b.push(new r.V(s,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(x=r.H(i[1]),x!=="string"&&b.push(new r.V(`${s}[1]`,i[1],`string expected, ${x} found`)));for(let T=2;T<i.length;T++)x=r.H(i[T]),r.K(i[1])==="$type"?b=b.concat(Ue({key:`${s}[${T}]`,value:i[T],valueSpec:m.geometry_type,style:f.style,styleSpec:f.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&b.push(new r.V(`${s}[${T}]`,i[T],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let T=1;T<i.length;T++)b=b.concat(gt({key:`${s}[${T}]`,value:i[T],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":x=r.H(i[1]),i.length!==2?b.push(new r.V(s,i,`filter array for "${i[0]}" operator must have 2 elements`)):x!=="string"&&b.push(new r.V(`${s}[1]`,i[1],`string expected, ${x} found`))}return b}function Kt(f,i){const s=f.key,m=f.style,x=f.layer,b=f.styleSpec,T=f.value,P=f.objectKey,N=b[`${i}_${f.layerType}`];if(!N)return[];const V=P.match(/^(.*)-use-theme$/);if(i==="paint"&&V&&N[V[1]])return r.O(T)?[].concat(Wn({key:f.key,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:m,styleSpec:b,expressionContext:"property",propertyType:i,propertyKey:P})):Wn({key:s,value:T,valueSpec:{type:"string"},style:m,styleSpec:b});const q=P.match(/^(.*)-transition$/);if(i==="paint"&&q&&N[q[1]]&&N[q[1]].transition)return Wn({key:s,value:T,valueSpec:b.transition,style:m,styleSpec:b});const Z=f.valueSpec||N[P];if(!Z)return[new r.G(s,T,`unknown property "${P}"`)];let K;if(r.H(T)==="string"&&r.M(Z)&&!Z.tokens&&(K=/^{([^}]+)}$/.exec(T))){const fe=`\`{ "type": "identity", "property": ${K?JSON.stringify(K[1]):'"_"'} }\``;return[new r.V(s,T,`"${P}" does not support interpolation syntax
Use an identity property function instead: ${fe}.`)]}const ne=[];if(f.layerType==="symbol")P!=="text-field"||!m||m.glyphs||m.imports||ne.push(new r.V(s,T,'use of "text-field" requires a style "glyphs" property')),P==="text-font"&&r.a0(r.Q(T))&&r.K(T.type)==="identity"&&ne.push(new r.V(s,T,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&i==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&r.M(Z)&&(r.a1(Z)||r.N(Z))){const fe=r.S(r.Q(T),Z),ue=fe.value.expression||fe.value._styleExpression.expression;ue&&!r.X(ue,["measure-light"])&&(P==="model-emissive-strength"&&r.Y(ue)&&r.W(ue)||ne.push(new r.V(s,T,`${P} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return ne.concat(Wn({key:f.key,value:T,valueSpec:Z,style:m,styleSpec:b,expressionContext:"property",propertyType:i,propertyKey:P}))}function an(f){return Kt(f,"paint")}function Xn(f){return Kt(f,"layout")}function On(f){let i=[];const s=f.value,m=f.key,x=f.style,b=f.styleSpec;s.type||s.ref||i.push(new r.V(m,s,'either "type" or "ref" is required'));let T=r.K(s.type);const P=r.K(s.ref);if(s.id){const N=r.K(s.id);for(let V=0;V<f.arrayIndex;V++){const q=x.layers[V];r.K(q.id)===N&&i.push(new r.V(m,s.id,`duplicate layer id "${s.id}", previously used at line ${q.id.__line__}`))}}if("ref"in s){let N;["type","source","source-layer","filter","layout"].forEach(V=>{V in s&&i.push(new r.V(m,s[V],`"${V}" is prohibited for ref layers`))}),x.layers.forEach(V=>{r.K(V.id)===P&&(N=V)}),N?N.ref?i.push(new r.V(m,s.ref,"ref cannot reference another ref layer")):T=r.K(N.type):typeof P=="string"&&i.push(new r.V(m,s.ref,`ref layer "${P}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(s.source){const N=x.sources&&x.sources[s.source],V=N&&r.K(N.type);N?V==="vector"&&T==="raster"?i.push(new r.V(m,s.source,`layer "${s.id}" requires a raster source`)):V==="raster"&&T!=="raster"?i.push(new r.V(m,s.source,`layer "${s.id}" requires a vector source`)):V!=="vector"||s["source-layer"]?V==="raster-dem"&&T!=="hillshade"?i.push(new r.V(m,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):V!=="raster-array"||["raster","raster-particle"].includes(T)?T!=="line"||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||V==="geojson"&&N.lineMetrics?T==="raster-particle"&&V!=="raster-array"&&i.push(new r.V(m,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):i.push(new r.V(m,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new r.V(m,s.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new r.V(m,s,`layer "${s.id}" must specify a "source-layer"`)):i.push(new r.V(m,s.source,`source "${s.source}" not found`))}else i.push(new r.V(m,s,'missing required property "source"'));return i=i.concat(di({key:m,value:s,valueSpec:b.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Wn({key:`${m}.type`,value:s.type,valueSpec:b.layer.type,style:f.style,styleSpec:f.styleSpec,object:s,objectKey:"type"}),filter:N=>Yt(r.J({layerType:T},N)),layout:N=>di({layer:s,key:N.key,value:N.value,valueSpec:{},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{"*":V=>Xn(r.J({layerType:T},V))}}),paint:N=>di({layer:s,key:N.key,value:N.value,valueSpec:{},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{"*":V=>an(r.J({layerType:T,layer:s},V))}})}})),i}function Jn(f){const i=f.value,s=f.key,m=r.H(i);return m!=="string"?[new r.V(s,i,`string expected, ${m} found`)]:[]}const Ni={promoteId:function f({key:i,value:s}){if(r.H(s)==="string")return Jn({key:i,value:s});if(Array.isArray(s)){const m=[],x=r.Q(s),b=r.U(x);return b.result==="error"&&b.value.forEach(T=>{m.push(new r.V(`${i}${T.key}`,null,`${T.message}`))}),r.X(b.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||m.push(new r.V(`${i}`,null,"promoteId expression should be only feature dependent")),m}{const m=[];for(const x in s)m.push(...f({key:`${i}.${x}`,value:s[x]}));return m}}};function Un(f){const i=f.value,s=f.key,m=f.styleSpec,x=f.style;if(!i.type)return[new r.V(s,i,'"type" is required')];const b=r.K(i.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&(i.url||i.tiles||T.push(new r.G(s,i,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(di({key:s,value:i,valueSpec:m[`source_${b.replace("-","_")}`],style:f.style,styleSpec:m,objectElementValidators:Ni})),T;case"geojson":if(T=di({key:s,value:i,valueSpec:m.source_geojson,style:x,styleSpec:m,objectElementValidators:Ni}),i.cluster)for(const P in i.clusterProperties){const[N,V]=i.clusterProperties[P],q=typeof N=="string"?[N,["accumulated"],["get",P]]:N;T.push(...ei({key:`${s}.${P}.map`,value:V,expressionContext:"cluster-map"})),T.push(...ei({key:`${s}.${P}.reduce`,value:q,expressionContext:"cluster-reduce"}))}return T;case"video":return di({key:s,value:i,valueSpec:m.source_video,style:x,styleSpec:m});case"image":return di({key:s,value:i,valueSpec:m.source_image,style:x,styleSpec:m});case"canvas":return[new r.V(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ue({key:`${s}.type`,value:i.type,valueSpec:{values:si(m)}})}}function si(f){return f.source.reduce((i,s)=>{const m=f[s];return m.type.type==="enum"&&(i=i.concat(Object.keys(m.type.values))),i},[])}function ci(f){const i=f.value,s=f.styleSpec,m=s.light,x=f.style;let b=[];const T=r.H(i);if(i===void 0)return b;if(T!=="object")return b=b.concat([new r.V("light",i,`object expected, ${T} found`)]),b;for(const P in i){const N=P.match(/^(.*)-transition$/),V=P.match(/^(.*)-use-theme$/);b=b.concat(V&&m[V[1]]?Wn({key:P,value:i[P],valueSpec:{type:"string"},style:x,styleSpec:s}):N&&m[N[1]]&&m[N[1]].transition?Wn({key:P,value:i[P],valueSpec:s.transition,style:x,styleSpec:s}):m[P]?Wn({key:P,value:i[P],valueSpec:m[P],style:x,styleSpec:s}):[new r.V(P,i[P],`unknown property "${P}"`)])}return b}function _i(f){const i=f.value;let s=[];if(!i)return s;const m=r.H(i);if(m!=="object")return s=s.concat([new r.V("light-3d",i,`object expected, ${m} found`)]),s;const x=f.styleSpec,b=x["light-3d"],T=f.key,P=f.style,N=f.style.lights;for(const Z of["type","id"])if(!(Z in i))return s=s.concat([new r.V("light-3d",i,`missing property ${Z} on light`)]),s;if(i.type&&N)for(let Z=0;Z<f.arrayIndex;Z++){const K=r.K(i.type),ne=N[Z];r.K(ne.type)===K&&s.push(new r.V(T,i.id,`duplicate light type "${i.type}", previously defined at line ${ne.id.__line__}`))}const V=`properties_light_${i.type}`;if(!(V in x))return s=s.concat([new r.V("light-3d",i,`Invalid light type ${i.type}`)]),s;const q=x[V];for(const Z in i)if(Z==="properties"){const K=i[Z],ne=r.H(K);if(ne!=="object")return s=s.concat([new r.V("properties",K,`object expected, ${ne} found`)]),s;for(const fe in K)s=s.concat(q[fe]?Wn({key:fe,value:K[fe],valueSpec:q[fe],style:P,styleSpec:x}):[new r.G(f.key,K[fe],`unknown property "${fe}"`)])}else{const K=Z.match(/^(.*)-transition$/),ne=Z.match(/^(.*)-use-theme$/);s=s.concat(ne&&b[ne[1]]?Wn({key:Z,value:i[Z],valueSpec:{type:"string"},style:P,styleSpec:x}):K&&b[K[1]]&&b[K[1]].transition?Wn({key:Z,value:i[Z],valueSpec:x.transition,style:P,styleSpec:x}):b[Z]?Wn({key:Z,value:i[Z],valueSpec:b[Z],style:P,styleSpec:x}):[new r.G(Z,i[Z],`unknown property "${Z}"`)])}return s}function ui(f){const i=f.value,s=f.key,m=f.style,x=f.styleSpec,b=x.terrain;let T=[];const P=r.H(i);if(i===void 0||P==="null")return T;if(P!=="object")return T=T.concat([new r.V("terrain",i,`object expected, ${P} found`)]),T;for(const N in i){const V=N.match(/^(.*)-transition$/),q=N.match(/^(.*)-use-theme$/);T=T.concat(q&&b[q[1]]?Wn({key:N,value:i[N],valueSpec:{type:"string"},style:m,styleSpec:x}):V&&b[V[1]]&&b[V[1]].transition?Wn({key:N,value:i[N],valueSpec:x.transition,style:m,styleSpec:x}):b[N]?Wn({key:N,value:i[N],valueSpec:b[N],style:m,styleSpec:x}):[new r.G(N,i[N],`unknown property "${N}"`)])}if(i.source){const N=m.sources&&m.sources[i.source],V=N&&r.K(N.type);N?V!=="raster-dem"&&T.push(new r.V(s,i.source,`terrain cannot be used with a source of type ${String(V)}, it only be used with a "raster-dem" source type`)):T.push(new r.V(s,i.source,`source "${i.source}" not found`))}else T.push(new r.V(s,i,'terrain is missing required property "source"'));return T}function Ai(f){const i=f.value,s=f.style,m=f.styleSpec,x=m.fog;let b=[];const T=r.H(i);if(i===void 0)return b;if(T!=="object")return b=b.concat([new r.V("fog",i,`object expected, ${T} found`)]),b;for(const P in i){const N=P.match(/^(.*)-transition$/),V=P.match(/^(.*)-use-theme$/);b=b.concat(V&&x[V[1]]?Wn({key:P,value:i[P],valueSpec:{type:"string"},style:s,styleSpec:m}):N&&x[N[1]]&&x[N[1]].transition?Wn({key:P,value:i[P],valueSpec:m.transition,style:s,styleSpec:m}):x[P]?Wn({key:P,value:i[P],valueSpec:x[P],style:s,styleSpec:m}):[new r.G(P,i[P],`unknown property "${P}"`)])}return b}const Si={"*":()=>[],array:bi,boolean:function(f){const i=f.value,s=f.key,m=r.H(i);return m!=="boolean"?[new r.V(s,i,`boolean expected, ${m} found`)]:[]},number:Mn,color:function(f){const i=f.key,s=f.value,m=r.H(s);return m!=="string"?[new r.V(i,s,`color expected, ${m} found`)]:r._.parseCSSColor(s)===null?[new r.V(i,s,`color expected, "${s}" found`)]:[]},enum:Ue,filter:Yt,function:wi,layer:On,object:di,source:Un,model:r.a2,light:ci,"light-3d":_i,terrain:ui,fog:Ai,string:Jn,formatted:function(f){return Jn(f).length===0?[]:ei(f)},resolvedImage:function(f){return Jn(f).length===0?[]:ei(f)},projection:function(f){const i=f.value,s=f.styleSpec,m=s.projection,x=f.style;let b=[];const T=r.H(i);if(T==="object")for(const P in i)b=b.concat(Wn({key:P,value:i[P],valueSpec:m[P],style:x,styleSpec:s}));else T!=="string"&&(b=b.concat([new r.V("projection",i,`object or string expected, ${T} found`)]));return b},import:function(f){const{value:i,styleSpec:s}=f,{data:m,...x}=i;Object.defineProperty(x,"__line__",{value:i.__line__,enumerable:!1});let b=di(r.J({},f,{value:x,valueSpec:s.import}));return r.K(x.id)===""&&b.push(new r.V(`${f.key}.id`,x,"import id can't be an empty string")),m&&(b=b.concat(ai(m,s,{key:`${f.key}.data`}))),b}};function Wn(f,i=!1){const s=f.value,m=f.valueSpec,x=f.styleSpec;if(m.expression&&r.a0(r.K(s)))return wi(f);if(m.expression&&r.O(r.Q(s)))return ei(f);if(m.type&&Si[m.type]){const b=Si[m.type](f);return i===!0&&b.length>0&&r.H(f.value)==="array"?ei(f):b}return di(r.J({},f,{valueSpec:m.type?x[m.type]:m}))}function Ot(f){const i=f.value,s=f.key,m=Jn(f);return m.length||(i.indexOf("{fontstack}")===-1&&m.push(new r.V(s,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&m.push(new r.V(s,i,'"glyphs" url must include a "{range}" token'))),m}function ai(f,i=r.a3,s={}){return Wn({key:s.key||"",value:f,valueSpec:i.$root,styleSpec:i,style:f,objectElementValidators:{glyphs:Ot,"*":()=>[]}})}function on(f,i=r.a3){return Sa(ai(f,i))}const wn=f=>Sa(Un(f)),Kn=f=>Sa(ci(f)),ti=f=>Sa(_i(f)),Vi=f=>Sa(ui(f)),Zr=f=>Sa(Ai(f)),ga=f=>Sa(function(i){const s=i.value,m=i.style,x=i.styleSpec,b=x.snow;let T=[];const P=r.H(s);if(s===void 0)return T;if(P!=="object")return T=T.concat([new r.V("snow",s,`object expected, ${P} found`)]),T;for(const N in s){const V=N.match(/^(.*)-transition$/);T=T.concat(V&&b[V[1]]&&b[V[1]].transition?Wn({key:N,value:s[N],valueSpec:x.transition,style:m,styleSpec:x}):b[N]?Wn({key:N,value:s[N],valueSpec:b[N],style:m,styleSpec:x}):[new r.G(N,s[N],`unknown property "${N}"`)])}return T}(f)),Cr=f=>Sa(function(i){const s=i.value,m=i.style,x=i.styleSpec,b=x.rain;let T=[];const P=r.H(s);if(s===void 0)return T;if(P!=="object")return T=T.concat([new r.V("rain",s,`object expected, ${P} found`)]),T;for(const N in s){const V=N.match(/^(.*)-transition$/);T=T.concat(V&&b[V[1]]&&b[V[1]].transition?Wn({key:N,value:s[N],valueSpec:x.transition,style:m,styleSpec:x}):b[N]?Wn({key:N,value:s[N],valueSpec:b[N],style:m,styleSpec:x}):[new r.G(N,s[N],`unknown property "${N}"`)])}return T}(f)),oo=f=>Sa(On(f)),Sr=f=>Sa(Yt(f)),yc=f=>Sa(an(f)),xc=f=>Sa(Xn(f)),$o=f=>Sa(r.a2(f));function Sa(f){return f.slice().sort((i,s)=>i.line&&s.line?i.line-s.line:0)}function Xo(f,i){let s=!1;if(i&&i.length)for(const m of i)m instanceof r.G?r.w(m.message):(f.fire(new r.y(new Error(m.message))),s=!0);return s}let At;class he extends r.E{constructor(i,s="flat"){super(),this._transitionable=new r.a4(At||(At=new r.a5({anchor:new r.a6(r.a3.light.anchor),position:new r.a7(r.a3.light.position),color:new r.a6(r.a3.light.color),intensity:new r.a6(r.a3.light.intensity)}))),this.setLight(i,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,s,m={}){this._validate(Kn,i,m)||(this._transitionable.setTransitionOrValue(i),this.id=s)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,s,m){return(!m||m.validate!==!1)&&Xo(this,i.call(on,r.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}}let _e=class extends r.E{constructor(f,i,s,m){super(),this.scope=s,this._transitionable=new r.a4(new r.a5({source:new r.a6(r.a3.terrain.source),exaggeration:new r.a6(r.a3.terrain.exaggeration)}),s,m),this._transitionable.setTransitionOrValue(f,m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(f,i){this._transitionable.setTransitionOrValue(f,i)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new r.a8(f)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const i=f.value.expression;if(!i)return null;let s=-1,m=-1,x=1;for(const b of i.zoomStops)x=i.evaluate(new r.a8(b)),x>.01?(s=b,m=-1):m=b;return x<.01&&s>0&&m>s?[s,m]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof r.a9}};const Te=45,je=65,We=.05;function Qe(f,i,s,m){const x=r.ac(Te,je,s),[b,T]=ft(f,m);let P=1-Math.min(1,Math.exp((i-b)/(T-b)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*x*f.alpha}function ft(f,i){const s=.5/Math.tan(.5*i);return[f.range[0]+s,f.range[1]+s]}function nt(f,i,s,m,x){const b=r.ab.vec3.transformMat4([],[i,s,m],x.mercatorFogMatrix);return Qe(f,r.ab.vec3.length(b),x.pitch,x._fov)}function St(f,i,s,m,x,b,T){const P=[[s,m,0],[x,m,0],[x,b,0],[s,b,0]];let N=Number.MAX_VALUE,V=-Number.MAX_VALUE;for(const q of P){const Z=r.ab.vec3.transformMat4([],q,i),K=r.ab.vec3.length(Z);N=Math.min(N,K),V=Math.max(V,K)}return[Qe(f,N,T.pitch,T._fov),Qe(f,V,T.pitch,T._fov)]}class wt extends r.E{constructor(i,s,m,x){super();const b=new r.a5({range:new r.a6(r.a3.fog.range),color:new r.a6(r.a3.fog.color),"color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.a6(r.a3.fog["high-color"]),"high-color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.a6(r.a3.fog["space-color"]),"space-color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.a6(r.a3.fog["horizon-blend"]),"star-intensity":new r.a6(r.a3.fog["star-intensity"]),"vertical-range":new r.a6(r.a3.fog["vertical-range"])});this._transitionable=new r.a4(b,m,new Map(x)),this.set(i,x),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new r.ad(b),this.scope=m}get state(){const i=this._transform,s=i.projection.name==="globe",m=r.ae(i.zoom),x=this.properties.get("range"),b=[.5,3];return{range:s?[r.af(b[0],x[0],m),r.af(b[1],x[1],m)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,s,m={}){if(this._validate(Zr,i,m))return;const x=r.l({},i);for(const b of Object.keys(r.a3.fog))x[b]===void 0&&(x[b]=r.a3.fog[b].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ac(Te,je,i))*s.a}getOpacityAtLatLng(i,s){return this._transform.projection.supportsFog?function(m,x,b){const T=r.aa.fromLngLat(x),P=b.elevation?b.elevation.getAtPointOrZero(T):0;return nt(m,T.x,T.y,P,b)}(this.state,i,s):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];const s=this._transform.calculateFogTileMatrix(i.toUnwrapped());return St(this.state,s,0,0,r.ag,r.ag,this._transform)}getOpacityForBounds(i,s,m,x,b){return this._transform.projection.supportsFog?St(this.state,i,s,m,x,b,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?ft(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;const s=[4,5,6,7];for(const m of s){const x=i.points[m];let b;if(x[2]>=0)b=x;else{const T=i.points[m-4];b=r.ah(T,x,T[2]/(T[2]-x[2]))}if(nt(this.state,b[0],b[1],0,this._transform)>=We)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,s,m){return(!m||m.validate!==!1)&&Xo(this,i.call(on,r.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}}let Mt,we,Ze,at,vt=class extends r.E{constructor(f,i,s,m){super();const x=Mt||(Mt=new r.a5({density:new r.a6(r.a3.snow.density),intensity:new r.a6(r.a3.snow.intensity),color:new r.a6(r.a3.snow.color),opacity:new r.a6(r.a3.snow.opacity),vignette:new r.a6(r.a3.snow.vignette),"vignette-color":new r.a6(r.a3.snow["vignette-color"]),"center-thinning":new r.a6(r.a3.snow["center-thinning"]),direction:new r.a6(r.a3.snow.direction),"flake-size":new r.a6(r.a3.snow["flake-size"])}));this._transitionable=new r.a4(x,s,new Map(m)),this.set(f,m),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ad(x),this.scope=s}get state(){const f=this.properties.get("opacity"),i=this.properties.get("color"),s=this.properties.get("direction"),m=r.ai(s[0]),x=-Math.max(r.ai(s[1]),.01),b=[Math.cos(m)*Math.cos(x),Math.sin(m)*Math.cos(x),Math.sin(x)],T=this.properties.get("vignette"),P=this.properties.get("vignette-color");return P.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.aj(i.r,i.g,i.b,i.a*f),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:P}}get(){return this._transitionable.serialize()}set(f,i,s={}){if(this._validate(ga,f,s))return;const m=r.l({},f);for(const x of Object.keys(r.a3.snow))m[x]===void 0&&(m[x]=r.a3.snow[x].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,i,s){return(!s||s.validate!==!1)&&Xo(this,f.call(on,r.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}},ht=class extends r.E{constructor(f,i,s,m){super();const x=we||(we=new r.a5({density:new r.a6(r.a3.rain.density),intensity:new r.a6(r.a3.rain.intensity),color:new r.a6(r.a3.rain.color),opacity:new r.a6(r.a3.rain.opacity),vignette:new r.a6(r.a3.rain.vignette),"vignette-color":new r.a6(r.a3.rain["vignette-color"]),"center-thinning":new r.a6(r.a3.rain["center-thinning"]),direction:new r.a6(r.a3.rain.direction),"droplet-size":new r.a6(r.a3.rain["droplet-size"]),"distortion-strength":new r.a6(r.a3.rain["distortion-strength"])}));this._transitionable=new r.a4(x,s,new Map(m)),this.set(f,m),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ad(x),this.scope=s}get state(){const f=this.properties.get("opacity"),i=this.properties.get("color"),s=this.properties.get("direction"),m=r.ai(s[0]),x=-Math.max(r.ai(s[1]),.01),b=[Math.cos(m)*Math.cos(x),Math.sin(m)*Math.cos(x),Math.sin(x)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.aj(i.r,i.g,i.b,i.a*f),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(f,i,s={}){if(this._validate(Cr,f,s))return;const m=r.l({},f);for(const x of Object.keys(r.a3.rain))m[x]===void 0&&(m[x]=r.a3.rain[x].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,i,s){return(!s||s.validate!==!1)&&Xo(this,f.call(on,r.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}};class qt extends r.E{constructor(i,s,m,x){super(),this.scope=m,this._options=i,this.properties=new r.ad(s),this._transitionable=new r.a4(s,m,new Map(x)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,s){this._options=i,this._transitionable.setTransitionOrValue(i.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Jt{constructor(i,s,m,x){this.screenBounds=i,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(i,s){let m,x;if(i instanceof r.P||typeof i[0]=="number"){const b=r.P.convert(i);m=[b],x=s.isPointAboveHorizon(b)}else{const b=r.P.convert(i[0]),T=r.P.convert(i[1]);m=[b,T],x=r.al(b,T).every(P=>s.isPointAboveHorizon(P))}return new Jt(m,s.getCameraPoint(),x,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return r.al(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const s=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],x=r.al(s,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<m.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?x[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(x[3]=this.cameraPoint)),r.am(x,i)}bufferedCameraGeometryGlobe(i){const s=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],x=r.al(s,m,i),b=this.cameraPoint.clone();switch(3*((b.y>s.y)+(b.y>m.y))+((b.x>s.x)+(b.x>m.x))){case 0:x[0]=b,x[4]=b.clone();break;case 1:x.splice(1,0,b);break;case 2:x[1]=b;break;case 3:x.splice(4,0,b);break;case 5:x.splice(2,0,b);break;case 6:x[3]=b;break;case 7:x.splice(3,0,b);break;case 8:x[2]=b}return x}containsTile(i,s,m,x=0){const b=i.queryPadding/s._pixelsPerMercatorPixel+1,T=m?this._bufferedCameraMercator(b,s):this._bufferedScreenMercator(b,s);let P=i.tileID.wrap+(T.unwrapped?x:0);const N=T.polygon.map(ve=>r.an(i.tileTransform,ve,P));if(!r.ao(N,0,0,r.ag,r.ag))return;P=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const V=this.screenGeometryMercator.polygon.map(ve=>r.ap(i.tileTransform,ve,P)),q=V.map(ve=>new r.P(ve[0],ve[1])),Z=s.getFreeCameraOptions().position||new r.aa(0,0,0),K=r.ap(i.tileTransform,Z,P),ne=V.map(ve=>{const ge=r.ab.vec3.sub(ve,ve,K);return r.ab.vec3.normalize(ge,ge),new r.aq(K,ge)}),fe=r.ar(i,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:q,tilespaceRays:ne,bufferedTilespaceGeometry:N,bufferedTilespaceBounds:(ue=r.as(N),ue.min.x=r.aw(ue.min.x,0,r.ag),ue.min.y=r.aw(ue.min.y,0,r.ag),ue.max.x=r.aw(ue.max.x,0,r.ag),ue.max.y=r.aw(ue.max.y,0,r.ag),ue),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:fe};var ue}_bufferedScreenMercator(i,s){const m=Bn(i);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let x;return x=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),s):{polygon:this.bufferedScreenGeometry(i).map(b=>s.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[m]=x,x}}_bufferedCameraMercator(i,s){const m=Bn(i);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let x;return x=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),s):{polygon:this.bufferedCameraGeometry(i).map(b=>s.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[m]=x,x}}_projectAndResample(i,s){const m=function(b,T){const P=r.ab.mat4.multiply([],T.pixelMatrix,T.globeMatrix),N=[0,-r.ax,0,1],V=[0,r.ax,0,1],q=[0,0,0,1];r.ab.vec4.transformMat4(N,N,P),r.ab.vec4.transformMat4(V,V,P),r.ab.vec4.transformMat4(q,q,P);const Z=new r.P(N[0]/N[3],N[1]/N[3]),K=new r.P(V[0]/V[3],V[1]/V[3]),ne=r.au(b,Z)&&N[3]<q[3],fe=r.au(b,K)&&V[3]<q[3];if(!ne&&!fe)return null;const ue=function(Ge,Be,Ke){for(let it=1;it<Ge.length;it++){const Rt=Tn(Be.pointCoordinate3D(Ge[it-1]).x),xt=Tn(Be.pointCoordinate3D(Ge[it]).x);if(Ke<0){if(Rt<xt)return{idx:it,t:-Rt/(xt-1-Rt)}}else if(xt<Rt)return{idx:it,t:(1-Rt)/(xt+1-Rt)}}return null}(b,T,ne?-1:1);if(!ue)return null;const{idx:ve,t:ge}=ue;let Ce=ve>1?En(b.slice(0,ve),T):[],ze=ve<b.length?En(b.slice(ve),T):[];Ce=Ce.map(Ge=>new r.P(Tn(Ge.x),Ge.y)),ze=ze.map(Ge=>new r.P(Tn(Ge.x),Ge.y));const Le=[...Ce];Le.length===0&&Le.push(ze[ze.length-1]);const qe=r.af(Le[Le.length-1].y,(ze.length===0?Ce[0]:ze[0]).y,ge);let Ne;return Ne=ne?[new r.P(0,qe),new r.P(0,0),new r.P(1,0),new r.P(1,qe)]:[new r.P(1,qe),new r.P(1,1),new r.P(0,1),new r.P(0,qe)],Le.push(...Ne),ze.length===0?Le.push(Ce[0]):Le.push(...ze),{polygon:Le.map(Ge=>new r.aa(Ge.x,Ge.y)),unwrapped:!1}}(i,s);if(m)return m;const x=function(b,T){let P=!1,N=-1/0,V=0;for(let Z=0;Z<b.length-1;Z++)b[Z].x>N&&(N=b[Z].x,V=Z);for(let Z=0;Z<b.length-1;Z++){const K=(V+Z)%(b.length-1),ne=b[K],fe=b[K+1];Math.abs(ne.x-fe.x)>.5&&(ne.x<fe.x?(ne.x+=1,K===0&&(b[b.length-1].x+=1)):(fe.x+=1,K+1===b.length-1&&(b[0].x+=1)),P=!0)}const q=r.at(T.center.lng);return P&&q<Math.abs(q-1)&&b.forEach(Z=>{Z.x-=1}),{polygon:b,unwrapped:P}}(En(i,s).map(b=>new r.P(Tn(b.x),b.y)),s);return{polygon:x.polygon.map(b=>new r.aa(b.x,b.y)),unwrapped:x.unwrapped}}}function En(f,i){return r.av(f,s=>{const m=i.pointCoordinate3D(s);s.x=m.x,s.y=m.y},1/256)}function Tn(f){return f<0?1+f%1:f%1}function Bn(f){return 100*f|0}function $n(f,i,s,m,x){const b=function(P,N){if(P)return x(P);if(N){if(f.url&&N.tiles&&f.tiles&&delete f.tiles,N.variants){if(!Array.isArray(N.variants))return x(new Error("variants must be an array"));for(const q of N.variants){if(q==null||typeof q!="object"||q.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(q.capabilities))return x(new Error("capabilities must be an array"));if(q.capabilities.length===1&&q.capabilities[0]==="meshopt"){N=r.l(N,q);break}}}const V=r.ay(r.l({},N,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);V.tiles=i.canonicalizeTileset(V,f.url),x(null,V)}},T=function(P,N,V){if(!P)return null;if(!N&&!V)return P;V=V||P.worldview_default;const q=Object.values(P.language||{});if(q.length===0)return null;const Z=Object.values(P.worldview||{});if(Z.length===0)return null;const K=q.every(fe=>fe===N),ne=Z.every(fe=>fe===V);return K&&ne?P:N in(P.language_options||{})||V in(P.worldview_options||{})?null:P.language_options&&P.worldview_options?P:null}(f.data,s,m);return T?r.q.frame(()=>b(null,T)):f.url?r.n(i.transformRequest(i.normalizeSourceURL(f.url,null,s,m),r.R.Source),b):r.q.frame(()=>{const{data:P,...N}=f;b(null,N)})}class Vn{constructor(i,s,m){this.bounds=r.az.convert(this.validateBounds(i)),this.minzoom=s||0,this.maxzoom=m||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const s=Math.pow(2,i.z),m=Math.floor(r.at(this.bounds.getWest())*s),x=Math.floor(r.aA(this.bounds.getNorth())*s),b=Math.ceil(r.at(this.bounds.getEast())*s),T=Math.ceil(r.aA(this.bounds.getSouth())*s);return i.x>=m&&i.x<b&&i.y>=x&&i.y<T}}class Pi extends r.E{constructor(i,s,m,x){if(super(),this.id=i,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.l(this,r.ay(s,["url","scheme","tileSize","promoteId"])),this._options=r.l({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new r.aB}load(i){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map.getWorldview();this._tileJSONRequest=$n(this._options,this.map._requestManager,s,m,(x,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,x)s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),m&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new r.y(x));else if(b){if(r.l(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of b.vector_layers)this.vectorLayerIds.push(T.id),b.worldview&&b.worldview[T.source]&&this.localizableLayerIds.add(T.id)}b.bounds&&(this.tileBounds=new Vn(b.bounds,this.minzoom,this.maxzoom)),_n(b.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}i&&i(x)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}loadTile(i,s){const m=i.tileID.canonical.url(this.tiles,this.scheme),x=this.map._requestManager.normalizeTileURL(m),b=this.map._requestManager.transformRequest(x,r.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,P=T?{image:T.image.clone()}:null,N={request:b,data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,lut:P,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&r.f(m)&&(N.worldview=this.map.getWorldview()||this.worldviewDefault,N.localizableLayerIds=this.localizableLayerIds),N.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=s:i.request=i.actor.send("reloadTile",N,V.bind(this));else if(i.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",N,V.bind(this),void 0,!0);else{const q=r.aD.call({deduped:this._deduped},N,(Z,K)=>{Z||!K?V.call(this,Z):(N.data={cacheControl:K.cacheControl,expires:K.expires,rawData:K.rawData.slice(0)},i.actor&&i.actor.send("loadTile",N,V.bind(this),void 0,!0))},!0);i.request={cancel:q}}function V(q,Z){return delete i.request,i.aborted?s(null):q&&q.status!==404?s(q):(Z&&Z.resourceTiming&&(i.resourceTiming=Z.resourceTiming),this.map._refreshExpiredTiles&&Z&&i.setExpiryData(Z),i.loadVectorData(Z,this.map.painter),r.aE(this.dispatcher),s(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,s){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class or extends r.E{constructor(i,s,m,x){super(),this.id=i,this.dispatcher=m,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.l({type:"raster"},s),r.l(this,r.ay(s,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._tileJSONRequest=$n(this._options,this.map._requestManager,null,null,(s,m)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new r.y(s)):m&&(r.l(this,m),m.raster_layers&&(this.rasterLayers=m.raster_layers,this.rasterLayerIds=this.rasterLayers.map(x=>x.id)),m.bounds&&(this.tileBounds=new Vn(m.bounds,this.minzoom,this.maxzoom)),_n(m.tiles),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),i&&i(s)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,s){const m=r.q.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);i.request=r.o(this.map._requestManager.transformRequest(x,r.R.Tile),(b,T,P,N)=>(delete i.request,i.aborted?(i.state="unloaded",s(null)):b?(i.state="errored",s(b)):T?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:P,expires:N}),i.setTexture(T,this.map.painter),i.state="loaded",r.aE(this.dispatcher),void s(null)):s(null)))}abortTile(i,s){i.request&&(i.request.cancel(),delete i.request),s&&s()}unloadTile(i,s){i.texture&&i.texture instanceof r.T?(i.destroy(!0),i.texture&&i.texture instanceof r.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),s&&s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class er extends or{constructor(i,s,m,x){super(i,s,m,x),this.type="raster-array",this.maxzoom=22,this._options=r.l({type:"raster-array"},s)}triggerRepaint(i){const s=this.map.painter._terrain,m=this.map.style.getSourceCache(this.id);s&&s.enabled&&m&&s._clearRenderCacheForTile(m.id,i.tileID),this.map.triggerRepaint()}loadTile(i,s){const m=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(m,r.R.Tile);i.requestParams=x,i.actor||(i.actor=this.dispatcher.getActor()),i.request=i.fetchHeader(void 0,(b,T,P,N)=>{if(delete i.request,i.aborted)return i.state="unloaded",s(null);if(b)return b.code===20?void 0:(i.state="errored",s(b));this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:P,expires:N}),i.state="empty",s(null)})}unloadTile(i,s){const m=i.texture;m&&m instanceof r.T?(i.destroy(!0),this.map.painter.saveTileTexture(m)):(i.destroy(),i.flushQueues(),i._isHeaderLoaded=!1,delete i._mrt,delete i.textureDescriptor),i.fbo&&(i.fbo.destroy(),delete i.fbo),delete i.request,delete i.requestParams,delete i.neighboringTiles,i.state="unloaded"}prepareTile(i,s,m){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBand(s,m,(x,b)=>{if(x)return i.state="errored",this.fire(new r.y(x)),void this.triggerRepaint(i);b&&(i.setTexture(b,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;const s=this.rasterLayers.find(({id:b})=>b===i),m=s&&s.fields,x=m&&m.bands&&m.bands;return x?x[0]:0}getTextureDescriptor(i,s,m){if(!i)return;const x=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let b=null;s instanceof r.aH?b=s.paint.get("raster-array-band"):s instanceof r.aI&&(b=s.paint.get("raster-particle-array-band"));const T=b||this.getInitialBand(x);if(T!=null)if(i.textureDescriptor){if(!i.updateNeeded(x,T)||m)return Object.assign({},i.textureDescriptor,{texture:i.texture})}else this.prepareTile(i,x,T)}}const qi={vector:Pi,raster:or,"raster-dem":class extends or{constructor(f,i,s,m){super(f,i,s,m),this.type="raster-dem",this.maxzoom=22,this._options=r.l({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(f,i){const s=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(x,b){x&&(f.state="errored",i(x)),b&&(f.dem=b,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",i(null))}f.request=r.o(this.map._requestManager.transformRequest(s,r.R.Tile),(function(x,b,T,P){if(delete f.request,f.aborted)f.state="unloaded",i(null);else if(x)f.state="errored",i(x);else if(b){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:T,expires:P});const N=ImageBitmap&&b instanceof ImageBitmap&&r.t(),V=1-(b.width-r.aF(b.width))/2;V<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const q=N?b:r.q.getImageData(b,V),Z={uid:f.uid,coord:f.tileID,source:this.id,scope:this.scope,rawImageData:q,encoding:this.encoding,padding:V};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",Z,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const i=f.canonical,s=Math.pow(2,i.z),m=(i.x-1+s)%s,x=i.x===0?f.wrap-1:f.wrap,b=(i.x+1+s)%s,T=i.x+1===s?f.wrap+1:f.wrap,P={};return P[new r.aG(f.overscaledZ,x,i.z,m,i.y).key]={backfilled:!1},P[new r.aG(f.overscaledZ,T,i.z,b,i.y).key]={backfilled:!1},i.y>0&&(P[new r.aG(f.overscaledZ,x,i.z,m,i.y-1).key]={backfilled:!1},P[new r.aG(f.overscaledZ,f.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},P[new r.aG(f.overscaledZ,T,i.z,b,i.y-1).key]={backfilled:!1}),i.y+1<s&&(P[new r.aG(f.overscaledZ,x,i.z,m,i.y+1).key]={backfilled:!1},P[new r.aG(f.overscaledZ,f.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},P[new r.aG(f.overscaledZ,T,i.z,b,i.y+1).key]={backfilled:!1}),P}},"raster-array":er,geojson:class extends r.E{constructor(f,i,s,m){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(m),this._data=i.data,this._options=r.l({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const x=r.ag/this.tileSize;this.workerOptions=r.l({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*x,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*x,extent:r.ag,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:r.ag,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*x,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new r.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new r.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const i=new Map;for(const s of this._data.features)i.set(s.id,s);for(const s of f.features)i.set(s.id,s);this._data.features=[...i.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},i),this}getClusterChildren(f,i){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},i),this}getClusterLeaves(f,i,s,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:i,offset:s},m),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.z("dataloading",{dataType:"source"})),this._loaded=!1;const i=r.l({append:f},this.workerOptions);i.scope=this.scope;const s=this._data;typeof s=="string"?(i.request=this.map._requestManager.transformRequest(r.q.resolveURL(s),r.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,(m,x)=>{if(this._loaded=!0,this._pendingLoad=null,m)this.fire(new r.y(m));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(b.resourceTiming=x.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new r.z("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const f=r.aC(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,i){const s=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const m=this.map.style?this.map.style.getLut(this.scope):null,x=m?{image:m.image.clone()}:null,b=this._partialReload,T={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:x,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:b};f.request=this.actor.send(s,T,(P,N)=>b&&!N?(f.state="loaded",i(null)):(delete f.request,f.destroy(),f.aborted?i(null):P?i(P):(f.loadVectorData(N,this.map.painter,s==="reloadTile"),i(null))),void 0,s==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,i){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aJ{constructor(f,i,s,m){super(f,i,s,m),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const i of f.urls)this.urls.push(this.map._requestManager.transformRequest(i,r.R.Source).url);r.aK(this.urls,(i,s)=>{this._loaded=!0,i?this.fire(new r.y(i)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const i=this.video.seekable;f<i.start(0)||f>i.end(0)?this.fire(new r.y(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,i=f.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(f,this.video,i.RGBA8),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aJ,model:class extends r.E{constructor(f,i,s,m){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){const f=[];for(const i in this._options.models){const s=this._options.models[i],m=r.aM(this.map._requestManager.transformRequest(s.uri,r.R.Model).url).then(x=>{if(!x)return;const b=r.aN(x),T=new r.aO(i,s.position,s.orientation,b);T.computeBoundsAndApplyParent(),this.models.push(T)}).catch(x=>{this.fire(new r.y(new Error(`Could not load model ${i} from ${s.uri}: ${x.message}`)))});f.push(m)}return Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this.fire(new r.y(new Error(`Could not load models: ${i.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,i){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(f,i,s,m){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(m)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(f))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map.getWorldview();this._tileJSONRequest=$n(this._options,this.map._requestManager,i,s,(m,x)=>{this._tileJSONRequest=null,this._loaded=!0,m?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new r.y(m))):x&&(r.l(this,x),x.bounds&&(this.tileBounds=new Vn(x.bounds,this.minzoom,this.maxzoom)),_n(x.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),f&&f(m)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,i){const s=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(s,r.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=i;else{if(f.buckets){const b=Object.values(f.buckets);for(const T of b)T.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",m,x.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",m,x.bind(this),void 0,!0);function x(b,T){return f.aborted?i(null):b&&b.status!==404?i(b):(this.map._refreshExpiredTiles&&T&&f.setExpiryData(T),f.loadModelData(T,this.map.painter),f.state="loaded",void i(null))}}serialize(){return r.l({},this._options)}},canvas:class extends r.aJ{constructor(f,i,s,m){super(f,i,s,m),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(b=>typeof b!="number"))||this.fire(new r.y(new r.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.y(new r.V(`sources.${f}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new r.y(new r.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new r.y(new r.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.y(new r.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof r.aL||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(i,this.canvas,i.gl.RGBA8,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends r.E{constructor(f,i,s,m){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=i,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Vn(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),r.l(this,r.ay(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.ay(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:i,y:s,z:m}=f.canonical;return this._implementation.hasTile({x:i,y:s,z:m})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,i){const{x:s,y:m,z:x}=f.tileID.canonical,b=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:s,y:m,z:x},{signal:b.signal})).then((function(T){return delete f.request,f.aborted?(f.state="unloaded",i(null)):T===void 0?(f.state="errored",i(null)):T===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",i(null)):function(P){return P instanceof ImageData||P instanceof HTMLCanvasElement||P instanceof ImageBitmap||P instanceof HTMLImageElement}(T)?(this.loadTileData(f,T),f.state="loaded",void i(null)):(f.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.code!==20&&(f.state="errored",i(T))}),f.request.cancel=()=>b.abort()}loadTileData(f,i){f.setTexture(i,this.map.painter)}unloadTile(f,i){if(f.texture&&f.texture instanceof r.T?(f.destroy(!0),f.texture&&f.texture instanceof r.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:s,y:m,z:x}=f.tileID.canonical;this._implementation.unloadTile({x:s,y:m,z:x})}i&&i()}abortTile(f,i){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),i&&i()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=r.aC(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}}},Ci=function(f,i,s,m){const x=new qi[i.type](f,i,s,m);if(x.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${x.id}`);return r.aP(["load","abort","unload","serialize","prepare"],x),x};function Li(f,i,s=""){return`${s}:${i.id||""}:${i.layer.id}:${function(m){if("layerId"in m)return`layer:${m.layerId}`;{const{featuresetId:x,importId:b}=m;return`featureset:${x}${b?`:import:${b}`:""}`}}(f.target)}`}function ia(f,i,s,m=""){if(f.uniqueFeatureID){const x=Li(f,i,m);if(s.has(x))return!0;s.add(x)}return!1}function gr(f,i,s,m,x=!1){const b=i.sourceCache.transform,T=i.sourceCache.tilesIn(f,i.has3DLayers,x);T.sort(vo);const P=[];for(const N of T){const V=N.tile.queryRenderedFeatures(i,N,s,m,b,x);Object.keys(V).length&&P.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:V})}return P.length===0?{}:function(N){const V={},q={};for(const Z of N){const K=Z.queryResults,ne=Z.wrappedTileID,fe=q[ne]=q[ne]||{};for(const ue in K){const ve=K[ue],ge=fe[ue]=fe[ue]||{},Ce=V[ue]=V[ue]||[];for(const ze of ve)ge[ze.featureIndex]||(ge[ze.featureIndex]=!0,Ce.push(ze))}}return V}(P)}function To(f,i,s,m,x){const b={},T=m.queryRenderedSymbols(f),P=[];for(const N of Object.keys(T).map(Number))P.push(x[N]);P.sort(vo);for(const N of P){const V=N.featureIndex.lookupSymbolFeatures(T[N.bucketInstanceId],N.bucketIndex,N.sourceLayerIndex,i,s);for(const q in V){const Z=b[q]=b[q]||[],K=V[q];K.sort((ne,fe)=>{const ue=N.featureSortOrder;if(ue){const ve=ue.indexOf(ne.featureIndex);return ue.indexOf(fe.featureIndex)-ve}return fe.featureIndex-ne.featureIndex});for(const ne of K)Z.push(ne)}}return b}function ws(f,i){const s=f.getRenderableIds().map(b=>f.getTileByID(b)),m=[],x={};for(let b=0;b<s.length;b++){const T=s[b],P=T.tileID.canonical.key;x[P]||(x[P]=!0,T.querySourceFeatures(m,i))}return m}function vo(f,i){const s=f.tileID,m=i.tileID;return s.overscaledZ-m.overscaledZ||s.canonical.y-m.canonical.y||s.wrap-m.wrap||s.canonical.x-m.canonical.x}function Ua(f,i){const s={};if(!i)return s;for(const m of f){const x=m.layerIds.map(b=>i.getLayer(b)).filter(Boolean);if(x.length!==0){m.layers=x,m.stateDependentLayerIds&&(m.stateDependentLayers=m.stateDependentLayerIds.map(b=>x.filter(T=>T.id===b)[0]));for(const b of x)s[b.fqid]=m}}return s}const cr=32,ua=33,_a=new Uint16Array(8184);for(let f=0;f<2046;f++){let i=f+2,s=0,m=0,x=0,b=0,T=0,P=0;for(1&i?x=b=T=cr:s=m=P=cr;(i>>=1)>1;){const V=s+x>>1,q=m+b>>1;1&i?(x=s,b=m,s=T,m=P):(s=x,m=b,x=T,b=P),T=V,P=q}const N=4*f;_a[N+0]=s,_a[N+1]=m,_a[N+2]=x,_a[N+3]=b}const Vr=new Uint16Array(2178),ra=new Uint8Array(1089),Oo=new Uint16Array(1089);function yo(f){return f===0?-.03125:f===32?.03125:0}const Fm={type:2,extent:r.ag,loadGeometry:()=>[[new r.P(0,0),new r.P(r.ag+1,0),new r.P(r.ag+1,r.ag+1),new r.P(0,r.ag+1),new r.P(0,0)]]};class kl{constructor(i,s,m,x,b){this.tileID=i,this.uid=r.aV(),this.uses=0,this.tileSize=s,this.tileZoom=m,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection)}registerFadeDuration(i){const s=i+this.timeAdded;s<r.q.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aQ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,s,m){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=Ua(i.buckets,s.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const b=this.buckets[x];if(b instanceof r.aX){if(this.hasSymbolBuckets=!0,!m)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const b=this.buckets[x];if(b instanceof r.aX&&b.hasRTLText){this.hasRTLText=!0,r.aY();break}}this.queryPadding=0;for(const x in this.buckets){const b=this.buckets[x],T=s.style.getOwnLayer(x);if(!T)continue;const P=T.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,P)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new r.aW}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(i,s,m){i&&(i.resourceTiming&&(this.resourceTiming=i.resourceTiming),this.buckets=Object.assign({},this.buckets,Ua(i.buckets,s.style)),i.featureIndex&&(this.latestFeatureIndex=i.featureIndex))}getBucket(i){return this.buckets[i.fqid]}upload(i){for(const x in this.buckets){const b=this.buckets[x];b.uploadPending()&&b.upload(i)}const s=i.gl,m=this.imageAtlas;if(m&&!m.uploaded){const x=!!Object.keys(m.patternPositions).length;this.imageAtlasTexture=new r.T(i,m.image,s.RGBA8,{useMipmap:x}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(i,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(i,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(i,s,m){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,m),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=s.style.getBrightness();(this._lastUpdatedBrightness||x)&&(this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this.updateBuckets(s,this._lastUpdatedBrightness!==x),this._lastUpdatedBrightness=x))}queryRenderedFeatures(i,s,m,x,b,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const P=function(N,V){const q=r.ab.mat4.fromScaling([],[.5*N.width,.5*-N.height,1]);return r.ab.mat4.translate(q,q,[1,-1,0]),r.ab.mat4.multiply(q,q,N.calculateProjMatrix(V.toUnwrapped())),Float32Array.from(q)}(b,this.tileID);return this.latestFeatureIndex.query(i,{tilespaceGeometry:s,pixelPosMatrix:P,transform:x,availableImages:m,tileTransform:this.tileTransform})}querySourceFeatures(i,s){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const x=m.loadVTLayers(),b=s?s.sourceLayer:"",T=x._geojsonTileLayer||x[b];if(!T)return;const P=r.aZ(s&&s.filter),{z:N,x:V,y:q}=this.tileID.canonical,Z={z:N,x:V,y:q};for(let K=0;K<T.length;K++){const ne=T.feature(K);if(P.needGeometry){const ve=r.a_(ne,!0);if(!P.filter(new r.a8(this.tileID.overscaledZ),ve,this.tileID.canonical))continue}else if(!P.filter(new r.a8(this.tileID.overscaledZ),ne))continue;const fe=m.getId(ne,b),ue=new r.a$(ne,N,V,q,fe);ue.tile=Z,i.push(ue)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const s=this.expirationTime;if(i.cacheControl){const m=r.b0(i.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const m=Date.now();let x=!1;if(this.expirationTime>m)x=!1;else if(s)if(this.expirationTime<s)x=!0;else{const b=this.expirationTime-s;b?this.expirationTime=m+Math.max(b,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(i){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&i&&this.updateBuckets(i)}updateBuckets(i,s){if(!this.latestFeatureIndex||!i.style)return;const m=this.latestFeatureIndex.loadVTLayers(),x=i.style.listImages(),b=i.style.getBrightness();for(const T in this.buckets){if(!i.style.hasLayer(T))continue;const P=this.buckets[T],N=P.layers[0],V=N.sourceLayer||"_geojsonTileLayer",q=m[V],Z=i.style.getLayerSourceCache(N);let K={};Z&&(K=Z._state.getState(V,void 0));const ne=this.imageAtlas&&this.imageAtlas.patternPositions||{},fe=Object.keys(K).length>0&&!s;fe&&!P.stateDependentLayers.length&&!s||P.update(K,q,x,ne,fe?P.stateDependentLayers:P.layers,s,b),(P instanceof r.b1||P instanceof r.b2)&&i._terrain&&i._terrain.enabled&&Z&&P.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(Z.id,this.tileID);const ue=i&&i.style&&i.style.getOwnLayer(T);ue&&(this.queryPadding=Math.max(this.queryPadding,ue.queryRadius(P)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=r.q.now()+i}setTexture(i,s){const m=s.context,x=m.gl;this.texture=this.texture||s.getTileTexture(i.width),this.texture&&this.texture instanceof r.T?this.texture.update(i):(this.texture=new r.T(m,i,x.RGBA8,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(i,s){const m={};for(const x of s)m[x]=!0;this.dependencies[i]=m}hasDependency(i,s){for(const m of i){const x=this.dependencies[m];if(x){for(const b of s)if(x[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const m=r.b3(Fm,this.tileID.canonical,this.tileTransform)[0],x=new r.b4,b=new r.b5;for(let T=0;T<m.length;T++){const{x:P,y:N}=m[T];x.emplaceBack(P,N),b.emplaceBack(T)}b.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(b),this._tileDebugBuffer=i.createVertexBuffer(x,r.b6.members),this._tileDebugSegments=r.b7.simpleSegment(0,0,x.length,b.length)}_makeTileBoundsBuffers(i,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const m=r.b3(Fm,this.tileID.canonical,this.tileTransform)[0];let x,b;if(this.isRaster){const T=function(P,N){const V=r.aQ(P,N),q=Math.pow(2,P.z);for(let ve=0;ve<ua;ve++)for(let ge=0;ge<ua;ge++){const Ce=r.aR((P.x+(ge+yo(ge))/cr)/q),ze=r.aS((P.y+(ve+yo(ve))/cr)/q),Le=N.project(Ce,ze),qe=ve*ua+ge;Vr[2*qe+0]=Math.round((Le.x*V.scale-V.x)*r.ag),Vr[2*qe+1]=Math.round((Le.y*V.scale-V.y)*r.ag)}ra.fill(0),Oo.fill(0);for(let ve=2045;ve>=0;ve--){const ge=4*ve,Ce=_a[ge+0],ze=_a[ge+1],Le=_a[ge+2],qe=_a[ge+3],Ne=Ce+Le>>1,Ge=ze+qe>>1,Be=Ne+Ge-ze,Ke=Ge+Ce-Ne,it=ze*ua+Ce,Rt=qe*ua+Le,xt=Ge*ua+Ne,jt=Math.hypot((Vr[2*it+0]+Vr[2*Rt+0])/2-Vr[2*xt+0],(Vr[2*it+1]+Vr[2*Rt+1])/2-Vr[2*xt+1])>=16;ra[xt]=ra[xt]||(jt?1:0),ve<1022&&(ra[xt]=ra[xt]||ra[(ze+Ke>>1)*ua+(Ce+Be>>1)]||ra[(qe+Ke>>1)*ua+(Le+Be>>1)])}const Z=new r.aT,K=new r.aU;let ne=0;function fe(ve,ge){const Ce=ge*ua+ve;return Oo[Ce]===0&&(Z.emplaceBack(Vr[2*Ce+0],Vr[2*Ce+1],ve*r.ag/cr,ge*r.ag/cr),Oo[Ce]=++ne),Oo[Ce]-1}function ue(ve,ge,Ce,ze,Le,qe){const Ne=ve+Ce>>1,Ge=ge+ze>>1;if(Math.abs(ve-Le)+Math.abs(ge-qe)>1&&ra[Ge*ua+Ne])ue(Le,qe,ve,ge,Ne,Ge),ue(Ce,ze,Le,qe,Ne,Ge);else{const Be=fe(ve,ge),Ke=fe(Ce,ze),it=fe(Le,qe);K.emplaceBack(Be,Ke,it)}}return ue(0,0,cr,cr,cr,0),ue(cr,cr,0,0,0,cr),{vertices:Z,indices:K}}(this.tileID.canonical,s);x=T.vertices,b=T.indices}else{x=new r.aT,b=new r.aU;for(const{x:P,y:N}of m)x.emplaceBack(P,N,0,0);const T=r.b8(x.int16,void 0,4);for(let P=0;P<T.length;P+=3)b.emplaceBack(T[P],T[P+1],T[P+2])}this._tileBoundsBuffer=i.createVertexBuffer(x,r.b9.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(b),this._tileBoundsSegments=r.b7.simpleSegment(0,0,x.length,b.length)}_makeGlobeTileDebugBuffers(i,s){const m=s.projection;if(!m||m.name!=="globe"||s.freezeTileCoverage)return;const x=this.tileID.canonical,b=r.ba(x,s),T=r.bb(b),P=r.ae(s.zoom);let N;P>0&&(N=r.ab.mat4.invert(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,x,s,T,N,P),this._makeGlobeTileDebugTextBuffer(i,x,s,T,N,P)}_globePoint(i,s,m,x,b,T,P){let N=r.bc(i,s,m);if(T){const V=1<<m.z,q=r.at(x.center.lng),Z=r.aA(x.center.lat),K=(m.x+.5)/V-q;let ne=0;K>.5?ne=-1:K<-.5&&(ne=1);let fe=(i/r.ag+m.x)/V+ne,ue=(s/r.ag+m.y)/V;fe=(fe-q)*x._pixelsPerMercatorPixel+q,ue=(ue-Z)*x._pixelsPerMercatorPixel+Z;const ve=[fe*x.worldSize,ue*x.worldSize,0];r.ab.vec3.transformMat4(ve,ve,T),N=r.bd(N,ve,P)}return r.ab.vec3.transformMat4(N,N,b)}_makeGlobeTileDebugBorderBuffer(i,s,m,x,b,T){const P=new r.b4,N=new r.b5,V=new r.be,q=(K,ne,fe,ue,ve)=>{const ge=(fe-K)/(ve-1),Ce=(ue-ne)/(ve-1),ze=P.length;for(let Le=0;Le<ve;Le++){const qe=K+Le*ge,Ne=ne+Le*Ce;P.emplaceBack(qe,Ne);const Ge=this._globePoint(qe,Ne,s,m,x,b,T);V.emplaceBack(Ge[0],Ge[1],Ge[2]),N.emplaceBack(ze+Le)}},Z=r.ag;q(0,0,Z,0,16),q(Z,0,Z,Z,16),q(Z,Z,0,Z,16),q(0,Z,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(N),this._tileDebugBuffer=i.createVertexBuffer(P,r.b6.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(V,r.bf.members),this._tileDebugSegments=r.b7.simpleSegment(0,0,P.length,N.length)}_makeGlobeTileDebugTextBuffer(i,s,m,x,b,T){const P=r.ag/4,N=new r.b4,V=new r.aU,q=new r.be,Z=25;V.reserve(32),N.reserve(Z),q.reserve(Z);const K=(ne,fe)=>Z*ne+fe;for(let ne=0;ne<Z;ne++){const fe=ne*P;for(let ue=0;ue<Z;ue++){const ve=ue*P;N.emplaceBack(ve,fe);const ge=this._globePoint(ve,fe,s,m,x,b,T);q.emplaceBack(ge[0],ge[1],ge[2])}}for(let ne=0;ne<4;ne++)for(let fe=0;fe<4;fe++){const ue=K(ne,fe),ve=K(ne,fe+1),ge=K(ne+1,fe),Ce=K(ne+1,fe+1);V.emplaceBack(ue,ve,ge),V.emplaceBack(ge,ve,Ce)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(V),this._tileDebugTextBuffer=i.createVertexBuffer(N,r.b6.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(q,r.bf.members),this._tileDebugTextSegments=r.b7.simpleSegment(0,0,Z,32)}destroy(i=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bg.setPbf(r.bh);class Fl extends kl{constructor(i,s,m,x,b){super(i,s,m,x,b),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(i,s){const m=s.context,x=m.gl;this.texture=this.texture||s.getTileTexture(i.width),this.texture&&this.texture instanceof r.T?this.texture.update(i,{premultiply:!1}):this.texture=new r.T(m,i,x.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(i=16384,s){const m=this._mrt=new r.bg(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=r.bi(x,(b,T,P,N)=>{if(b)s(b);else try{const V=m.getHeaderLength(T);if(V>i)return void(this.request=this.fetchHeader(V,s));m.parseHeader(T),this._isHeaderLoaded=!0;let q=0;for(const Z of Object.values(m.layers))q=Math.max(q,Z.dataIndex[Z.dataIndex.length-1].last_byte);T.byteLength>=q&&(this.entireBuffer=T),s(null,this.entireBuffer||T,P,N)}catch(V){s(V)}}),this.request}fetchBand(i,s,m){const x=this._mrt;if(!this._isHeaderLoaded||!x)return void m(new Error("Tile header is not ready"));const b=this.actor;if(!b)return void m(new Error("Can't fetch tile band without an actor"));let T;const P=(Z,K)=>{T.complete(Z,K),Z?m(Z):(this.updateTextureDescriptor(i,s),m(null,this.textureDescriptor&&this.textureDescriptor.img))},N=(Z,K)=>{if(Z)return m(Z);const ne=b.send("decodeRasterArray",{buffer:K,task:T},P,void 0,!0);this._workQueue.push(()=>{ne&&ne.cancel(),T.cancel()})},V=x.getLayer(i);if(!V)return void m(new Error(`Unknown sourceLayer "${i}"`));if(V.hasDataForBand(s))return this.updateTextureDescriptor(i,s),void m(null,this.textureDescriptor?this.textureDescriptor.img:null);const q=V.getDataRange([s]);if(T=x.createDecodingTask(q),!T||T.tasks.length)if(this.flushQueues(),this.entireBuffer)N(null,this.entireBuffer.slice(q.firstByte,q.lastByte+1));else{const Z=Object.assign({},this.requestParams,{headers:{Range:`bytes=${q.firstByte}-${q.lastByte}`}}),K=r.bi(Z,N);this._fetchQueue.push(()=>{K.cancel(),T.cancel()})}else m(null)}updateNeeded(i,s){return(!this.textureDescriptor||this.textureDescriptor.band!==s||this.textureDescriptor.layer!==i)&&this.state!=="errored"}updateTextureDescriptor(i,s){if(!this._mrt)return;const m=this._mrt.getLayer(i);if(!m||!m.hasBand(s)||!m.hasDataForBand(s))return;const{bytes:x,tileSize:b,buffer:T,offset:P,scale:N}=m.getBandView(s),V=b+2*T,q={data:x,width:V,height:V},Z=this.texture;Z&&Z instanceof r.T&&Z.update(q,{premultiply:!1}),this.textureDescriptor={layer:i,band:s,img:q,buffer:T,offset:P,tileSize:b,format:m.pixelFormat,mix:[N,256*N,65536*N,16777216*N]}}}class rp{constructor(i,s){this.max=i,this.onRemove=s,this.reset()}reset(){for(const i in this.data)for(const s of this.data[i])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(i,s,m){const x=i.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const b={value:s,timeout:void 0};if(m!==void 0&&(b.timeout=setTimeout(()=>{this.remove(i,b)},m)),this.data[x].push(b),this.order.push(x),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const s=this.data[i].shift();return s.timeout&&clearTimeout(s.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),s.value}getByKey(i){const s=this.data[i];return s?s[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,s){if(!this.has(i))return this;const m=i.wrapped().key,x=s===void 0?0:this.data[m].indexOf(s),b=this.data[m][x];return this.data[m].splice(x,1),b.timeout&&clearTimeout(b.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(b.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(i){const s=[];for(const m in this.data)for(const x of this.data[m])i(x.value)||s.push(x);for(const m of s)this.remove(m.value.tileID,m)}}class Nm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,s,m){const x=String(s);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][x]=this.stateChanges[i][x]||{},r.l(this.stateChanges[i][x],m),this.deletedStates[i]===null){this.deletedStates[i]={};for(const b in this.state[i])b!==x&&(this.deletedStates[i][b]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][x]===null){this.deletedStates[i][x]={};for(const b in this.state[i][x])m[b]||(this.deletedStates[i][x][b]=null)}else for(const b in m)this.deletedStates[i]&&this.deletedStates[i][x]&&this.deletedStates[i][x][b]===null&&delete this.deletedStates[i][x][b]}removeFeatureState(i,s,m){if(this.deletedStates[i]===null)return;const x=String(s);if(this.deletedStates[i]=this.deletedStates[i]||{},m&&s!==void 0)this.deletedStates[i][x]!==null&&(this.deletedStates[i][x]=this.deletedStates[i][x]||{},this.deletedStates[i][x][m]=null);else if(s!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][x])for(m in this.deletedStates[i][x]={},this.stateChanges[i][x])this.deletedStates[i][x][m]=null;else this.deletedStates[i][x]=null;else this.deletedStates[i]=null}getState(i,s){const m=this.state[i]||{},x=this.stateChanges[i]||{},b=this.deletedStates[i];if(b===null)return{};if(s!==void 0){const P=String(s),N=r.l({},m[P],x[P]);if(b){const V=b[s];if(V===null)return{};for(const q in V)delete N[q]}return N}const T=r.l({},m,x);if(b)for(const P in b)delete T[P];return T}initializeTileState(i,s){i.refreshFeatureState(s)}coalesceChanges(i,s){const m={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const b={};for(const T in this.stateChanges[x])this.state[x][T]||(this.state[x][T]={}),r.l(this.state[x][T],this.stateChanges[x][T]),b[T]=this.state[x][T];m[x]=b}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const b={};if(this.deletedStates[x]===null)for(const T in this.state[x])b[T]={},this.state[x][T]={};else for(const T in this.deletedStates[x]){if(this.deletedStates[x][T]===null)this.state[x][T]={};else if(this.state[x][T])for(const P of Object.keys(this.deletedStates[x][T]))delete this.state[x][T][P];b[T]=this.state[x][T]}m[x]=m[x]||{},r.l(m[x],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const x in i)i[x].refreshFeatureState(s)}}class Ss extends r.E{constructor(i,s,m){super(),this.id=i,this._onlySymbols=m,s.on("data",x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new rp(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Nm,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const s=this._tiles[i];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,s){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,s)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i)}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i)}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const m=this._tiles[s];m.upload(i),m.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return r.bj(this._tiles).map(i=>i.tileID).sort(tr).map(i=>i.key)}getRenderableIds(i,s){const m=[];for(const x in this._tiles)this._isIdRenderable(+x,i,s)&&m.push(this._tiles[x]);return i?m.sort((x,b)=>{const T=x.tileID,P=b.tileID,N=new r.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),V=new r.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-P.overscaledZ||V.y-N.y||V.x-N.x}).map(x=>x.tileID.key):m.map(x=>x.tileID).sort(tr).map(x=>x.key)}hasRenderableParent(i){const s=this.findLoadedParent(i,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(i,s,m){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(s||!this._tiles[i].holdingForFade())&&(m||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,s){const m=this._tiles[i];m&&(m.state!=="loading"&&(m.state=s),this._loadTile(m,this._tileLoaded.bind(this,m,i,s)))}_tileLoaded(i,s,m,x){if(x)if(i.state="errored",x.status!==404)this._source.fire(new r.y(x,{tile:i}));else{if(this._source.fire(new r.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:i})),!(i.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=r.q.now(),m==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(s,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new r.z("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const s=this.getRenderableIds();for(let x=0;x<s.length;x++){const b=s[x];if(i.neighboringTiles&&i.neighboringTiles[b]){const T=this.getTileByID(b);m(i,T),m(T,i)}}function m(x,b){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let T=b.tileID.canonical.x-x.tileID.canonical.x;const P=b.tileID.canonical.y-x.tileID.canonical.y,N=Math.pow(2,x.tileID.canonical.z),V=b.tileID.key;T===0&&P===0||Math.abs(P)>1||(Math.abs(T)>1&&(Math.abs(T+N)===1?T+=N:Math.abs(T-N)===1&&(T-=N)),b.dem&&x.dem&&(x.dem.backfillBorder(b.dem,T,P),x.neighboringTiles&&x.neighboringTiles[V]&&(x.neighboringTiles[V].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,s,m,x){for(const b in this._tiles){let T=this._tiles[b];if(x[b]||!T.hasData()||T.tileID.overscaledZ<=s||T.tileID.overscaledZ>m)continue;let P=T.tileID;for(;T&&T.tileID.overscaledZ>s+1;){const V=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[V.key],T&&T.hasData()&&(P=V)}let N=P;for(;N.overscaledZ>s;)if(N=N.scaledTo(N.overscaledZ-1),i[N.key]){x[P.key]=P;break}}}findLoadedParent(i,s){if(i.key in this._loadedParentTiles){const m=this._loadedParentTiles[i.key];return m&&m.tileID.overscaledZ>=s?m:null}for(let m=i.overscaledZ-1;m>=s;m--){const x=i.scaledTo(m),b=this._getLoadedTile(x);if(b)return b}}_getLoadedTile(i){const s=this._tiles[i.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,s){s=s||this._source.tileSize;const m=Math.ceil(i.width/s)+1,x=Math.ceil(i.height/s)+1,b=Math.floor(m*x*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(P)}handleWrapJump(i){const s=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,s){const m={};for(const x in this._tiles){const b=this._tiles[x];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+s),m[b.tileID.key]=b}this._tiles=m;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(i,s,m,x){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!m)return;this.updateCacheSize(i,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const b=this._source.type==="batched-model";let T,P=this._source.maxzoom;const N=this.map&&this.map.painter?this.map.painter._terrain:null;if(N&&N.sourceCache===this&&N.attenuationRange()){const Z=N.attenuationRange()[0],K=Math.floor(Z)-Math.log2(N.getDemUpscale());P>K&&(P=K)}if(this.used||this.usedForTerrain){if(this._source.tileID)T=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(Z=>new r.aG(Z.canonical.z,Z.wrap,Z.canonical.z,Z.canonical.x,Z.canonical.y));else if(this.tileCoverLift!==0){const Z=i.clone();Z.tileCoverLift=this.tileCoverLift,T=Z.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:P,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.minzoom<=1&&i.projection.name==="globe"&&(T.push(new r.aG(1,0,1,0,0)),T.push(new r.aG(1,0,1,1,0)),T.push(new r.aG(1,0,1,0,1)),T.push(new r.aG(1,0,1,1,1)))}else if(T=i.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:P,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.hasTile){const Z=this._source.hasTile.bind(this._source);T=T.filter(K=>Z(K))}}else T=[];if(T.length>0&&this.castsShadows&&x&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Dd(this._source.type)){const Z=i.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!m}),K=Math.min(Z,this._source.maxzoom);if(b){const ne=i.extendTileCover(T,K);for(const fe of ne)T.push(fe)}else{const ne=i.extendTileCover(T,K,x);for(const fe of ne)this._shadowCasterTiles[fe.key]=!0,T.push(fe)}}const V=this._updateRetainedTiles(T);if(Dd(this._source.type)&&T.length!==0){const Z={},K={},ne=Object.keys(V);for(const ue of ne){const ve=V[ue],ge=this._tiles[ue];if(!ge||ge.fadeEndTime&&ge.fadeEndTime<=r.q.now())continue;const Ce=this.findLoadedParent(ve,Math.max(ve.overscaledZ-Ss.maxOverzooming,this._source.minzoom));Ce&&(this._addTile(Ce.tileID),Z[Ce.tileID.key]=Ce.tileID),K[ue]=ve}const fe=T[T.length-1].overscaledZ;for(const ue in this._tiles){const ve=this._tiles[ue];if(V[ue]||!ve.hasData())continue;let ge=ve.tileID;for(;ge.overscaledZ>fe;){ge=ge.scaledTo(ge.overscaledZ-1);const Ce=this._tiles[ge.key];if(Ce&&Ce.hasData()&&K[ge.key]){V[ue]=ve.tileID;break}}}for(const ue in Z)V[ue]||(this._coveredTiles[ue]=!0,V[ue]=Z[ue])}for(const Z in V)this._tiles[Z].clearFadeHold();const q=r.bk(this._tiles,V);for(const Z of q){const K=this._tiles[Z];K.hasSymbolBuckets&&!K.holdingForFade()?K.setHoldDuration(this.map._fadeDuration):K.hasSymbolBuckets&&!K.symbolFadeFinished()||this._removeTile(+Z)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const s={};if(i.length===0)return s;const m={},x=i.reduce((V,q)=>Math.min(V,q.overscaledZ),1/0),b=i[0].overscaledZ,T=Math.max(b-Ss.maxOverzooming,this._source.minzoom),P=Math.max(b+Ss.maxUnderzooming,this._source.minzoom),N={};for(const V of i){const q=this._addTile(V);s[V.key]=V,q.hasData()||x<this._source.maxzoom&&(N[V.key]=V)}this._retainLoadedChildren(N,x,P,s);for(const V of i){let q=this._tiles[V.key];if(q.hasData())continue;if(V.canonical.z>=this._source.maxzoom){const K=V.children(this._source.maxzoom)[0],ne=this.getTile(K);if(ne&&ne.hasData()){s[K.key]=K;continue}}else{const K=V.children(this._source.maxzoom);if(s[K[0].key]&&s[K[1].key]&&s[K[2].key]&&s[K[3].key])continue}let Z=q.wasRequested();for(let K=V.overscaledZ-1;K>=T;--K){const ne=V.scaledTo(K);if(m[ne.key]||(m[ne.key]=!0,q=this.getTile(ne),!q&&Z&&(q=this._addTile(ne)),q&&(s[ne.key]=ne,Z=q.wasRequested(),q.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const s=[];let m,x=this._tiles[i].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){m=this._loadedParentTiles[x.key];break}s.push(x.key);const b=x.scaledTo(x.overscaledZ-1);if(m=this._getLoadedTile(b),m)break;x=b}for(const b of s)this._loadedParentTiles[b]=m}}_addTile(i){let s=this._tiles[i.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),s;s=this._cache.getAndRemove(i),s&&(this._setTileReloadTimer(i.key,s),s.tileID=i,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,s)));const m=!!s;if(!m){const x=this.map?this.map.painter:null,b=this._source.tileSize*i.overscaleFactor();s=this._source.type==="raster-array"?new Fl(i,b,this.transform.tileZoom,x,this._isRaster):new kl(i,b,this.transform.tileZoom,x,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,i.key,s.state))}return s?(s.uses++,this._tiles[i.key]=s,m||this._source.fire(new r.z("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(i,s){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const m=s.getExpiryTimeout();m&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},m))}_removeTile(i){const s=this._tiles[i];s&&(s.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,s,m){const x=[],b=this.transform;if(!b)return x;const T=b.projection.name==="globe",P=r.at(b.center.lng);for(const N in this._tiles){const V=this._tiles[N];if(m&&V.clearQueryDebugViz(),V.holdingForFade())continue;let q;if(T){const Z=V.tileID.canonical;if(Z.z===0){const K=[Math.abs(r.aw(P,...oi(Z,-1))-P),Math.abs(r.aw(P,...oi(Z,1))-P)];q=[0,2*K.indexOf(Math.min(...K))-1]}else{const K=[Math.abs(r.aw(P,...oi(Z,-1))-P),Math.abs(r.aw(P,...oi(Z,0))-P),Math.abs(r.aw(P,...oi(Z,1))-P)];q=[K.indexOf(Math.min(...K))-1]}}else q=[0];for(const Z of q){const K=i.containsTile(V,b,s,Z);K&&x.push(K)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,s){const m=this.getRenderableIds(i,s).map(b=>this._tiles[b].tileID),x=this.transform.projection.name==="globe";for(const b of m)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=x?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return m}sortCoordinatesByDistance(i){const s=i.slice(),m=this.transform._camera.position,x=this.transform._camera.forward(),b={};for(const T of s){const P=1/(1<<T.canonical.z);b[T.key]=((T.canonical.x+.5)*P+T.wrap-m[0])*x[0]+((T.canonical.y+.5)*P-m[1])*x[1]-m[2]*x[2]}return s.sort((T,P)=>b[T.key]-b[P.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(Dd(this._source.type))for(const i in this._tiles){const s=this._tiles[i];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=r.q.now())return!0}return!1}setFeatureState(i,s,m){this._state.updateState(i=i||"_geojsonTileLayer",s,m)}removeFeatureState(i,s,m){this._state.removeFeatureState(i=i||"_geojsonTileLayer",s,m)}getFeatureState(i,s){return this._state.getState(i=i||"_geojsonTileLayer",s)}setDependencies(i,s,m){const x=this._tiles[i];x&&x.setDependencies(s,m)}reloadTilesForDependencies(i,s){for(const m in this._tiles)this._tiles[m].hasDependency(i,s)&&this._reloadTile(+m,"reloading");this._cache.filter(m=>!m.hasDependency(i,s))}_preloadTiles(i,s){if(!this._sourceLoaded){const N=()=>{this._sourceLoaded&&(this._source.off("data",N),this._preloadTiles(i,s))};return void this._source.on("data",N)}const m=new Map,x=Array.isArray(i)?i:[i],b=this.map.painter.terrain,T=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const N of x){const V=N.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const q of V)m.set(q.key,q);this.usedForTerrain&&N.updateElevation(!1)}const P=Array.from(m.values());r.bl(P,(N,V)=>{const q=new kl(N,this._source.tileSize*N.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(q,Z=>{this._source.type==="raster-dem"&&q.dem&&this._backfillDEM(q),V(Z,q)})},s)}}function tr(f,i){const s=Math.abs(2*f.wrap)-+(f.wrap<0),m=Math.abs(2*i.wrap)-+(i.wrap<0);return f.overscaledZ-i.overscaledZ||m-s||i.canonical.y-f.canonical.y||i.canonical.x-f.canonical.x}function Dd(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function oi(f,i){const s=1<<f.z;return[f.x/s+i,(f.x+1)/s+i]}Ss.maxOverzooming=10,Ss.maxUnderzooming=3;class _u{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const i=!1,s=!1;for(const m in this.style._mergedLayers){const x=this.style._mergedLayers[m];if(x.type==="fill-extrusion")this.layers.push({layer:x,visible:i,visibilityChanged:s});else if(x.type==="model"){const b=this.style.getLayerSource(x);b&&b.type==="batched-model"&&this.layers.push({layer:x,visible:i,visibilityChanged:s})}}}onNewFrame(i){this.layersGotHidden=!1;for(const s of this.layers){const m=s.layer;let x=!1;m.type==="fill-extrusion"?x=!m.isHidden(i)&&m.paint.get("fill-extrusion-opacity")>0:m.type==="model"&&(x=!m.isHidden(i)&&m.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!x&&s.visible,s.visible=x}}updateZOffset(i,s){this.currentBuildingBuckets=[];for(const x of this.layers){const b=x.layer,T=this.style.getLayerSourceCache(b);let P=1;b.type==="fill-extrusion"&&(P=x.visible?b.paint.get("fill-extrusion-vertical-scale"):0);let N=T?T.getTile(s):null;if(!N&&T&&s.canonical.z>T.getSource().minzoom){let V=s.scaledTo(Math.min(T.getSource().maxzoom,s.overscaledZ-1));for(;V.overscaledZ>=T.getSource().minzoom&&(N=T.getTile(V),!N&&V.overscaledZ!==0);)V=V.scaledTo(V.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:N?N.getBucket(b):null,tileID:N?N.tileID:s,verticalScale:P})}i.hasAnyZOffset=!1;let m=!1;for(let x=0;x<i.symbolInstances.length;x++){const b=i.symbolInstances.get(x),T=b.zOffset,P=this._getHeightAtTileOffset(s,b.tileAnchorX,b.tileAnchorY);b.zOffset=P!==Number.NEGATIVE_INFINITY?P:T,m||T===b.zOffset||(m=!0),i.hasAnyZOffset||b.zOffset===0||(i.hasAnyZOffset=!0)}m&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,s,m,x){let b=s,T=m;if(i.canonical.z!==x.canonical.z){const P=x.canonical,N=1/(1<<i.canonical.z-P.z);b=(s+i.canonical.x*r.ag)*N-P.x*r.ag|0,T=(m+i.canonical.y*r.ag)*N-P.y*r.ag|0}return{tileX:b,tileY:T}}_getHeightAtTileOffset(i,s,m){let x,b;for(let T=0;T<this.layers.length;++T){if(this.layers[T].layer.type!=="fill-extrusion")continue;const{bucket:P,tileID:N,verticalScale:V}=this.currentBuildingBuckets[T];if(!P)continue;const{tileX:q,tileY:Z}=this._mapCoordToOverlappingTile(i,s,m,N),K=P.getHeightAtTileCoord(q,Z);K&&K.height!==void 0&&(K.hidden?x=K.height:b=Math.max(K.height*V,b||0))}if(b!==void 0)return b;for(let T=0;T<this.layers.length;++T){const P=this.layers[T];if(P.layer.type!=="model"||!P.visible)continue;const{bucket:N,tileID:V}=this.currentBuildingBuckets[T];if(!N)continue;const{tileX:q,tileY:Z}=this._mapCoordToOverlappingTile(i,s,m,V),K=N.getHeightAtTileCoord(q,Z);if(K&&!K.hidden)return K.height===void 0&&x!==void 0?Math.min(K.maxHeight,x)*K.verticalScale:K.height?K.height*K.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Nl(f,i){const s={};for(const m in f)m!=="ref"&&(s[m]=f[m]);return r.bm.forEach(m=>{m in i&&(s[m]=i[m])}),s}function Pd(f){f=f.slice();const i=Object.create(null);for(let s=0;s<f.length;s++)i[f[s].id]=f[s];for(let s=0;s<f.length;s++)"ref"in f[s]&&(f[s]=Nl(f[s],i[f[s].ref]));return f}const Bi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Ld(f,i,s){s.push({command:Bi.addSource,args:[f,i[f]]})}function qs(f,i,s){i.push({command:Bi.removeSource,args:[f]}),s[f]=!0}function Nn(f,i,s,m){qs(f,s,m),Ld(f,i,s)}function ir(f,i,s){let m;for(m in f[s])if(f[s].hasOwnProperty(m)&&m!=="data"&&!r.bn(f[s][m],i[s][m]))return!1;for(m in i[s])if(i[s].hasOwnProperty(m)&&m!=="data"&&!r.bn(f[s][m],i[s][m]))return!1;return!0}function Gi(f,i,s,m,x,b){let T;for(T in i=i||{},f=f||{})f.hasOwnProperty(T)&&(r.bn(f[T],i[T])||s.push({command:b,args:[m,T,i[T],x]}));for(T in i)i.hasOwnProperty(T)&&!f.hasOwnProperty(T)&&(r.bn(f[T],i[T])||s.push({command:b,args:[m,T,i[T],x]}))}function Wa(f){return f.id}function Es(f,i){return f[i.id]=i,f}class nr{constructor(i,s){this.reset(i,s)}reset(i,s){this.points=i||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=r.aw(i,0,1);let s=1,m=this._distances[s];const x=i*this.paddedLength+this.padding;for(;m<x&&s<this._distances.length;)m=this._distances[++s];const b=s-1,T=this._distances[b],P=m-T,N=P>0?(x-T)/P:0;return this.points[b].mult(1-N).add(this.points[s].mult(N))}}class bc{constructor(i,s,m){const x=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(i/m),this.yCellCount=Math.ceil(s/m);for(let T=0;T<this.xCellCount*this.yCellCount;T++)x.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=s,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,s,m,x,b){this._forEachCell(s,m,x,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(s),this.bboxes.push(m),this.bboxes.push(x),this.bboxes.push(b)}insertCircle(i,s,m,x){this._forEachCell(s-x,m-x,s+x,m+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(s),this.circles.push(m),this.circles.push(x)}_insertBoxCell(i,s,m,x,b,T){this.boxCells[b].push(T)}_insertCircleCell(i,s,m,x,b,T){this.circleCells[b].push(T)}_query(i,s,m,x,b,T){if(m<0||i>this.width||x<0||s>this.height)return!b&&[];const P=[];if(i<=0&&s<=0&&this.width<=m&&this.height<=x){if(b)return!0;for(let N=0;N<this.boxKeys.length;N++)P.push({key:this.boxKeys[N],x1:this.bboxes[4*N],y1:this.bboxes[4*N+1],x2:this.bboxes[4*N+2],y2:this.bboxes[4*N+3]});for(let N=0;N<this.circleKeys.length;N++){const V=this.circles[3*N],q=this.circles[3*N+1],Z=this.circles[3*N+2];P.push({key:this.circleKeys[N],x1:V-Z,y1:q-Z,x2:V+Z,y2:q+Z})}return T?P.filter(T):P}return this._forEachCell(i,s,m,x,this._queryCell,P,{hitTest:b,seenUids:{box:{},circle:{}}},T),b?P.length>0:P}_queryCircle(i,s,m,x,b){const T=i-m,P=i+m,N=s-m,V=s+m;if(P<0||T>this.width||V<0||N>this.height)return!x&&[];const q=[];return this._forEachCell(T,N,P,V,this._queryCellCircle,q,{hitTest:x,circle:{x:i,y:s,radius:m},seenUids:{box:{},circle:{}}},b),x?q.length>0:q}query(i,s,m,x,b){return this._query(i,s,m,x,!1,b)}hitTest(i,s,m,x,b){return this._query(i,s,m,x,!0,b)}hitTestCircle(i,s,m,x){return this._queryCircle(i,s,m,!0,x)}_queryCell(i,s,m,x,b,T,P,N){const V=P.seenUids,q=this.boxCells[b];if(q!==null){const K=this.bboxes;for(const ne of q)if(!V.box[ne]){V.box[ne]=!0;const fe=4*ne;if(i<=K[fe+2]&&s<=K[fe+3]&&m>=K[fe+0]&&x>=K[fe+1]&&(!N||N(this.boxKeys[ne]))){if(P.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[ne],x1:K[fe],y1:K[fe+1],x2:K[fe+2],y2:K[fe+3]})}}}const Z=this.circleCells[b];if(Z!==null){const K=this.circles;for(const ne of Z)if(!V.circle[ne]){V.circle[ne]=!0;const fe=3*ne;if(this._circleAndRectCollide(K[fe],K[fe+1],K[fe+2],i,s,m,x)&&(!N||N(this.circleKeys[ne]))){if(P.hitTest)return T.push(!0),!0;{const ue=K[fe],ve=K[fe+1],ge=K[fe+2];T.push({key:this.circleKeys[ne],x1:ue-ge,y1:ve-ge,x2:ue+ge,y2:ve+ge})}}}}}_queryCellCircle(i,s,m,x,b,T,P,N){const V=P.circle,q=P.seenUids,Z=this.boxCells[b];if(Z!==null){const ne=this.bboxes;for(const fe of Z)if(!q.box[fe]){q.box[fe]=!0;const ue=4*fe;if(this._circleAndRectCollide(V.x,V.y,V.radius,ne[ue+0],ne[ue+1],ne[ue+2],ne[ue+3])&&(!N||N(this.boxKeys[fe])))return T.push(!0),!0}}const K=this.circleCells[b];if(K!==null){const ne=this.circles;for(const fe of K)if(!q.circle[fe]){q.circle[fe]=!0;const ue=3*fe;if(this._circlesCollide(ne[ue],ne[ue+1],ne[ue+2],V.x,V.y,V.radius)&&(!N||N(this.circleKeys[fe])))return T.push(!0),!0}}}_forEachCell(i,s,m,x,b,T,P,N){const V=this._convertToXCellCoord(i),q=this._convertToYCellCoord(s),Z=this._convertToXCellCoord(m),K=this._convertToYCellCoord(x);for(let ne=V;ne<=Z;ne++)for(let fe=q;fe<=K;fe++)if(b.call(this,i,s,m,x,this.xCellCount*fe+ne,T,P,N))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,s,m,x,b,T){const P=x-i,N=b-s,V=m+T;return V*V>P*P+N*N}_circleAndRectCollide(i,s,m,x,b,T,P){const N=(T-x)/2,V=Math.abs(i-(x+N));if(V>N+m)return!1;const q=(P-b)/2,Z=Math.abs(s-(b+q));if(Z>q+m)return!1;if(V<=N||Z<=q)return!0;const K=V-N,ne=Z-q;return K*K+ne*ne<=m*m}}const ls={unknown:0,flipRequired:1,flipNotRequired:2},_h=Math.tan(85*Math.PI/180);function Fr(f,i,s,m,x,b,T){const P=r.ab.mat4.create();if(s)if(b.name==="globe"){const N=r.bo(x,i);r.ab.mat4.multiply(P,P,N)}else{const N=r.ab.mat2.invert([],T);P[0]=N[0],P[1]=N[1],P[4]=N[2],P[5]=N[3],m||r.ab.mat4.rotateZ(P,P,x.angle)}else r.ab.mat4.multiply(P,x.labelPlaneMatrix,f);return P}function Nr(f,i,s,m,x,b,T){const P=Fr(f,i,s,m,x,b,T);return b.name==="globe"&&s||(P[2]=P[6]=P[10]=P[14]=0),P}function vh(f,i,s,m,x,b,T){if(s){if(b.name==="globe"){const P=Fr(f,i,s,m,x,b,T);return r.ab.mat4.invert(P,P),r.ab.mat4.multiply(P,f,P),P}{const P=r.ab.mat4.clone(f),N=r.ab.mat4.identity([]);return N[0]=T[0],N[1]=T[1],N[4]=T[2],N[5]=T[3],r.ab.mat4.multiply(P,P,N),m||r.ab.mat4.rotateZ(P,P,-x.angle),P}}return x.glCoordMatrix}function $a(f,i,s,m){const x=[f,i,s,1];s?r.ab.vec4.transformMat4(x,x,m):Ms(x,x,m);const b=x[3];return x[0]/=b,x[1]/=b,x[2]/=b,x}function ap(f,i){return Math.min(.5+f/i*.5,1.5)}function vu(f,i){const s=f[0]/f[3],m=f[1]/f[3];return s>=-i[0]&&s<=i[0]&&m>=-i[1]&&m<=i[1]}function yh(f,i,s,m,x,b,T,P,N,V){const q=s.transform,Z=m?f.textSizeData:f.iconSizeData,K=r.bp(Z,s.transform.zoom),ne=q.projection.name==="globe",fe=[256/s.width*2+1,256/s.height*2+1],ue=m?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;ue.clear();let ve=null;ne&&(ve=m?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const ge=f.lineVertexArray,Ce=m?f.text.placedSymbolArray:f.icon.placedSymbolArray,ze=s.transform.width/s.transform.height;let Le,qe=!1;for(let Ne=0;Ne<Ce.length;Ne++){const Ge=Ce.get(Ne),{numGlyphs:Be,writingMode:Ke}=Ge;if(Ke!==r.bq.vertical||qe||Le===r.bq.horizontal||(qe=!0),Le=Ke,(Ge.hidden||Ke===r.bq.vertical)&&!qe){Yr(Be,ue);continue}qe=!1;const it=new r.P(Ge.tileAnchorX,Ge.tileAnchorY);let{x:Rt,y:xt,z:jt}=q.projection.projectTilePoint(it.x,it.y,V.canonical);if(N){const[Gt,rn,mn]=N(it);Rt+=Gt,xt+=rn,jt+=mn}const zt=[Rt,xt,jt,1];if(r.ab.vec4.transformMat4(zt,zt,i),!vu(zt,fe)){Yr(Be,ue);continue}const pt=zt[3],Dt=ap(s.transform.getCameraToCenterDistance(q.projection),pt),tn=r.br(Z,K,Ge),dt=T?tn/Dt:tn*Dt,Ut=$a(Rt,xt,jt,x);if(Ut[3]<=0){Yr(Be,ue);continue}let Pt={};const dn=T?null:N,Zt=Ws(Ge,dt,!1,P,i,x,b,f.glyphOffsetArray,ge,ue,ve,Ut,it,Pt,ze,dn,q.projection,V,T);qe=Zt.useVertical,dn&&Zt.needsFlipping&&(Pt={}),(Zt.notEnoughRoom||qe||Zt.needsFlipping&&Ws(Ge,dt,!0,P,i,x,b,f.glyphOffsetArray,ge,ue,ve,Ut,it,Pt,ze,dn,q.projection,V,T).notEnoughRoom)&&Yr(Be,ue)}m?(f.text.dynamicLayoutVertexBuffer.updateData(ue),ve&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(ve)):(f.icon.dynamicLayoutVertexBuffer.updateData(ue),ve&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(ve))}function Bl(f,i,s,m,x,b,T,P,N,V,q,Z,K,ne,fe,ue){const{lineStartIndex:ve,glyphStartIndex:ge,segment:Ce}=P,ze=ge+P.numGlyphs,Le=ve+P.lineLength,qe=i.getoffsetX(ge),Ne=i.getoffsetX(ze-1),Ge=Ul(f*qe,s,m,x,b,T,Ce,ve,Le,N,V,q,Z,K,!0,ne,fe,ue);if(!Ge)return null;const Be=Ul(f*Ne,s,m,x,b,T,Ce,ve,Le,N,V,q,Z,K,!0,ne,fe,ue);return Be?{first:Ge,last:Be}:null}function Va(f,i,s,m){return f===r.bq.horizontal&&Math.abs(m)>Math.abs(s)?{useVertical:!0}:f===r.bq.vertical?m>0?{needsFlipping:!0}:null:i!==ls.unknown&&function(x,b){return x===0||Math.abs(b/x)>_h}(s,m)?i===ls.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function Ws(f,i,s,m,x,b,T,P,N,V,q,Z,K,ne,fe,ue,ve,ge,Ce){const ze=i/24,Le=f.lineOffsetX*ze,qe=f.lineOffsetY*ze,{lineStartIndex:Ne,glyphStartIndex:Ge,numGlyphs:Be,segment:Ke,writingMode:it,flipState:Rt}=f,xt=Ne+f.lineLength,jt=zt=>{if(q){const[dt,Ut,Pt]=zt.up,dn=V.length;r.bs(q,dn+0,dt,Ut,Pt),r.bs(q,dn+1,dt,Ut,Pt),r.bs(q,dn+2,dt,Ut,Pt),r.bs(q,dn+3,dt,Ut,Pt)}const[pt,Dt,tn]=zt.point;r.bt(V,pt,Dt,tn,zt.angle)};if(Be>1){const zt=Bl(ze,P,Le,qe,s,Z,K,f,N,b,ne,ue,!1,ve,ge,Ce);if(!zt)return{notEnoughRoom:!0};if(m&&!s){let[pt,Dt,tn]=zt.first.point,[dt,Ut,Pt]=zt.last.point;[pt,Dt]=$a(pt,Dt,tn,T),[dt,Ut]=$a(dt,Ut,Pt,T);const dn=Va(it,Rt,(dt-pt)*fe,Ut-Dt);if(f.flipState=dn&&dn.needsFlipping?ls.flipRequired:ls.flipNotRequired,dn)return dn}jt(zt.first);for(let pt=Ge+1;pt<Ge+Be-1;pt++){const Dt=Ul(ze*P.getoffsetX(pt),Le,qe,s,Z,K,Ke,Ne,xt,N,b,ne,ue,!1,!1,ve,ge,Ce);if(!Dt)return V.length-=4*(pt-Ge),{notEnoughRoom:!0};jt(Dt)}jt(zt.last)}else{if(m&&!s){const pt=$a(K.x,K.y,0,x),Dt=Ne+Ke+1,tn=new r.P(N.getx(Dt),N.gety(Dt)),dt=$a(tn.x,tn.y,0,x),Ut=dt[3]>0?dt:Bm(K,tn,pt,1,x,void 0,ve,ge.canonical),Pt=Va(it,Rt,(Ut[0]-pt[0])*fe,Ut[1]-pt[1]);if(f.flipState=Pt&&Pt.needsFlipping?ls.flipRequired:ls.flipNotRequired,Pt)return Pt}const zt=Ul(ze*P.getoffsetX(Ge),Le,qe,s,Z,K,Ke,Ne,xt,N,b,ne,ue,!1,!1,ve,ge,Ce);if(!zt)return{notEnoughRoom:!0};jt(zt)}return{}}function so(f,i,s,m,x){const{x:b,y:T,z:P}=m.projectTilePoint(f.x,f.y,i);if(!x)return $a(b,T,P,s);const[N,V,q]=x(f);return $a(b+N,T+V,P+q,s)}function Bm(f,i,s,m,x,b,T,P){const N=so(f.sub(i)._unit()._add(f),P,x,T,b);return r.ab.vec3.sub(N,s,N),r.ab.vec3.normalize(N,N),r.ab.vec3.scaleAndAdd(N,s,N,m)}function Ul(f,i,s,m,x,b,T,P,N,V,q,Z,K,ne,fe,ue,ve,ge){const Ce=m?f-i:f+i;let ze=Ce>0?1:-1,Le=0;m&&(ze*=-1,Le=Math.PI),ze<0&&(Le+=Math.PI);let qe=P+T+(ze>0?0:1)|0,Ne=x,Ge=x,Be=0,Ke=0;const it=Math.abs(Ce),Rt=[],xt=[];let jt=b,zt=jt;const pt=()=>Bm(zt,jt,Ge,it-Be+1,q,K,ue,ve.canonical);for(;Be+Ke<=it;){if(qe+=ze,qe<P||qe>=N)return null;if(Ge=Ne,zt=jt,Rt.push(Ge),ne&&xt.push(zt),jt=new r.P(V.getx(qe),V.gety(qe)),Ne=Z[qe],!Ne){const rn=so(jt,ve.canonical,q,ue,K);Ne=rn[3]>0?Z[qe]=rn:pt()}Be+=Ke,Ke=r.ab.vec3.distance(Ge,Ne)}fe&&K&&(Z[qe]&&(Ne=pt(),Ke=r.ab.vec3.distance(Ge,Ne)),Z[qe]=Ne);const Dt=(it-Be)/Ke,tn=jt.sub(zt)._mult(Dt)._add(zt),dt=r.ab.vec3.sub([],Ne,Ge),Ut=r.ab.vec3.scaleAndAdd([],Ge,dt,Dt);let Pt=[0,0,1],dn=dt[0],Zt=dt[1];if(ge&&(Pt=ue.upVector(ve.canonical,tn.x,tn.y),Pt[0]!==0||Pt[1]!==0||Pt[2]!==1)){const rn=[Pt[2],0,-Pt[0]],mn=r.ab.vec3.cross([],Pt,rn);r.ab.vec3.normalize(rn,rn),r.ab.vec3.normalize(mn,mn),dn=r.ab.vec3.dot(dt,rn),Zt=r.ab.vec3.dot(dt,mn)}if(s){const rn=r.ab.vec3.cross([],Pt,dt);r.ab.vec3.normalize(rn,rn),r.ab.vec3.scaleAndAdd(Ut,Ut,rn,s*ze)}const Gt=Le+Math.atan2(Zt,dn);return Rt.push(Ut),ne&&xt.push(tn),{point:Ut,angle:Gt,path:Rt,tilePath:xt,up:Pt}}function Yr(f,i){const s=i.length,m=s+4*f;i.resize(m),i.float32.fill(-1/0,4*s,4*m)}function Ms(f,i,s){const m=i[0],x=i[1];return f[0]=s[0]*m+s[4]*x+s[12],f[1]=s[1]*m+s[5]*x+s[13],f[3]=s[3]*m+s[7]*x+s[15],f}const Xa=100;class va{constructor(i,s,m=new bc(i.width+200,i.height+200,25),x=new bc(i.width+200,i.height+200,25)){this.transform=i,this.grid=m,this.ignoredGrid=x,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Xa,this.screenBottomBoundary=i.height+Xa,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=s}placeCollisionBox(i,s,m,x,b,T,P,N){let V=m.projectedAnchorX,q=m.projectedAnchorY,Z=m.projectedAnchorZ;const K=m.elevation,ne=m.tileID,fe=i.getProjection();if(K&&ne){const[Ne,Ge,Be]=fe.upVector(ne.canonical,m.tileAnchorX,m.tileAnchorY),Ke=fe.upVectorScale(ne.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;V+=Ne*K*Ke,q+=Ge*K*Ke,Z+=Be*K*Ke}const ue=this.projectAndGetPerspectiveRatio(P,V,q,Z,m.tileID,fe.name==="globe"||!!K||this.transform.pitch>0,fe),ve=T*ue.perspectiveRatio,ge=(m.x1*s+x.x-m.padding)*ve+ue.point.x,Ce=(m.y1*s+x.y-m.padding)*ve+ue.point.y,ze=(m.x2*s+x.x+m.padding)*ve+ue.point.x,Le=(m.y2*s+x.y+m.padding)*ve+ue.point.y,qe=ue.perspectiveRatio<=.55||ue.occluded;return!this.isInsideGrid(ge,Ce,ze,Le)||!b&&this.grid.hitTest(ge,Ce,ze,Le,N)||qe?{box:[],offscreen:!1,occluded:ue.occluded}:{box:[ge,Ce,ze,Le],offscreen:this.isOffscreen(ge,Ce,ze,Le),occluded:!1}}placeCollisionCircles(i,s,m,x,b,T,P,N,V,q,Z,K,ne,fe,ue){const ve=[],ge=this.transform.elevation,Ce=i.getProjection(),ze=ge?ge.getAtTileOffsetFunc(ue,this.transform.center.lat,this.transform.worldSize,Ce):null,Le=new r.P(m.tileAnchorX,m.tileAnchorY);let{x:qe,y:Ne,z:Ge}=Ce.projectTilePoint(Le.x,Le.y,ue.canonical);if(ze){const[tn,dt,Ut]=ze(Le);qe+=tn,Ne+=dt,Ge+=Ut}const Be=Ce.name==="globe",Ke=this.projectAndGetPerspectiveRatio(P,qe,Ne,Ge,ue,Be||!!ge||this.transform.pitch>0,Ce),{perspectiveRatio:it}=Ke,Rt=(Z?T/it:T*it)/r.bw,xt=$a(qe,Ne,Ge,N),jt=Ke.signedDistanceFromCamera>0?Bl(Rt,b,m.lineOffsetX*Rt,m.lineOffsetY*Rt,!1,xt,Le,m,x,N,{},ge&&!Z?ze:null,Z&&!!ge,Ce,ue,Z):null;let zt=!1,pt=!1,Dt=!0;if(jt&&!Ke.occluded){const tn=.5*ne*it+fe,dt=new r.P(-100,-100),Ut=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Pt=new nr,{first:dn,last:Zt}=jt,Gt=dn.path.length;let rn=[];for(let zn=Gt-1;zn>=1;zn--)rn.push(dn.path[zn]);for(let zn=1;zn<Zt.path.length;zn++)rn.push(Zt.path[zn]);const mn=2.5*tn;V&&(rn=rn.map(([zn,ni,Yn],Zn)=>(ze&&!Be&&(Yn=ze(Zn<Gt-1?dn.tilePath[Gt-1-Zn]:Zt.tilePath[Zn-Gt+2])[2]),$a(zn,ni,Yn,V))),rn.some(zn=>zn[3]<=0)&&(rn=[]));let Cn=[];if(rn.length>0){let zn=1/0,ni=-1/0,Yn=1/0,Zn=-1/0;for(const mi of rn)zn=Math.min(zn,mi[0]),Yn=Math.min(Yn,mi[1]),ni=Math.max(ni,mi[0]),Zn=Math.max(Zn,mi[1]);ni>=dt.x&&zn<=Ut.x&&Zn>=dt.y&&Yn<=Ut.y&&(Cn=[rn.map(mi=>new r.P(mi[0],mi[1]))],(zn<dt.x||ni>Ut.x||Yn<dt.y||Zn>Ut.y)&&(Cn=r.bu(Cn,dt.x,dt.y,Ut.x,Ut.y)))}for(const zn of Cn){Pt.reset(zn,.25*tn);let ni=0;ni=Pt.length<=.5*tn?1:Math.ceil(Pt.paddedLength/mn)+1;for(let Yn=0;Yn<ni;Yn++){const Zn=Yn/Math.max(ni-1,1),mi=Pt.lerp(Zn),gi=mi.x+Xa,pr=mi.y+Xa;ve.push(gi,pr,tn,0);const Qr=gi-tn,Pr=pr-tn,Ei=gi+tn,Qi=pr+tn;if(Dt=Dt&&this.isOffscreen(Qr,Pr,Ei,Qi),pt=pt||this.isInsideGrid(Qr,Pr,Ei,Qi),!s&&this.grid.hitTestCircle(gi,pr,tn,K)&&(zt=!0,!q))return{circles:[],offscreen:!1,collisionDetected:zt,occluded:!1}}}}return{circles:!q&&zt||!pt?[]:ve,offscreen:Dt,collisionDetected:zt,occluded:Ke.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let m=1/0,x=1/0,b=-1/0,T=-1/0;for(const q of i){const Z=new r.P(q.x+Xa,q.y+Xa);m=Math.min(m,Z.x),x=Math.min(x,Z.y),b=Math.max(b,Z.x),T=Math.max(T,Z.y),s.push(Z)}const P=this.grid.query(m,x,b,T).concat(this.ignoredGrid.query(m,x,b,T)),N={},V={};for(const q of P){const Z=q.key;if(N[Z.bucketInstanceId]===void 0&&(N[Z.bucketInstanceId]={}),N[Z.bucketInstanceId][Z.featureIndex])continue;const K=[new r.P(q.x1,q.y1),new r.P(q.x2,q.y1),new r.P(q.x2,q.y2),new r.P(q.x1,q.y2)];r.bv(s,K)&&(N[Z.bucketInstanceId][Z.featureIndex]=!0,V[Z.bucketInstanceId]===void 0&&(V[Z.bucketInstanceId]=[]),V[Z.bucketInstanceId].push(Z.featureIndex))}return V}insertCollisionBox(i,s,m,x,b){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:x,collisionGroupID:b},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,s,m,x,b){const T=s?this.ignoredGrid:this.grid,P={bucketInstanceId:m,featureIndex:x,collisionGroupID:b};for(let N=0;N<i.length;N+=4)T.insertCircle(P,i[N],i[N+1],i[N+2])}projectAndGetPerspectiveRatio(i,s,m,x,b,T,P){const N=[s,m,x,1];let V=!1;x||this.transform.pitch>0?(r.ab.vec4.transformMat4(N,N,i),this.fogState&&b&&P.name!=="globe"&&(V=function(K,ne,fe,ue,ve,ge){const Ce=ge.calculateFogTileMatrix(ve),ze=[ne,fe,ue];return r.ab.vec3.transformMat4(ze,ze,Ce),Qe(K,r.ab.vec3.length(ze),ge.pitch,ge._fov)}(this.fogState,s,m,x,b.toUnwrapped(),this.transform)>.9)):Ms(N,N,i);const q=N[3];return{point:new r.P((N[0]/q+1)/2*this.transform.width+Xa,(-N[1]/q+1)/2*this.transform.height+Xa),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(P)/q*.5,1.5),signedDistanceFromCamera:q,occluded:T&&N[2]>q||V}}isOffscreen(i,s,m,x){return m<Xa||i>=this.screenRightBoundary||x<Xa||s>this.screenBottomBoundary}isInsideGrid(i,s,m,x){return m>=0&&i<this.gridRightBoundary&&x>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const i=r.ab.mat4.identity([]);return r.ab.mat4.translate(i,i,[-100,-100,0]),i}}function Od(f,i,s){const m=i.createTileMatrix(f,f.worldSize,s.toUnwrapped());return r.ab.mat4.multiply(new Float32Array(16),f.projMatrix,m)}function $s(f,i,s){if(i.projection.name===s.projection.name)return f.projMatrix;const m=s.clone();return m.setProjection(i.projection),Od(m,i.getProjection(),f)}function wc(f,i,s){return i.name===s.projection.name?f.projMatrix:Od(s,i,f)}class zd{constructor(i,s,m,x){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?s:-s))):x&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class Xs{constructor(i,s,m,x,b,T=!1){this.text=new zd(i?i.text:null,s,m,b),this.icon=new zd(i?i.icon:null,s,x,b),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Um{constructor(i,s,m,x=!1){this.text=i,this.icon=s,this.skipFade=m,this.clipped=x}}class Vl{constructor(){this.invProjMatrix=r.ab.mat4.create(),this.viewportMatrix=r.ab.mat4.create(),this.circles=[]}}class Vm{constructor(i,s,m,x,b){this.bucketInstanceId=i,this.featureIndex=s,this.sourceLayerIndex=m,this.bucketIndex=x,this.tileID=b}}class jm{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const s=++this.maxGroupID;this.collisionGroups[i]={ID:s,predicate:m=>m.collisionGroupID===s}}return this.collisionGroups[i]}}function zo(f,i,s,m,x){const{horizontalAlign:b,verticalAlign:T}=r.bD(f),P=-(b-.5)*i,N=-(T-.5)*s,V=r.bC(f,m);return new r.P(P+V[0]*x,N+V[1]*x)}function Gm(f,i,s,m,x){const b=new r.P(f,i);return s&&b._rotate(m?x:-x),b}class kd{constructor(i,s,m,x,b,T){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new va(this.transform,b),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new jm(m),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,s,m,x,b=1){const T=m.getBucket(s),P=m.latestFeatureIndex;if(!T||!P||s.fqid!==T.layerIds[0])return;const N=T.layers[0].layout,V=T.layers[0].paint,q=m.collisionBoxArray,Z=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),K=m.tileSize/r.ag,ne=m.tileID.toUnwrapped();this.transform.setProjection(T.projection);const fe=(ue=m.tileID,ve=T.getProjection(),ge=this.transform,ve.name===this.projection?ge.calculateProjMatrix(ue.toUnwrapped()):Od(ge,ve,ue));var ue,ve,ge;const Ce=N.get("text-pitch-alignment")==="map",ze=N.get("text-rotation-alignment")==="map";s.compileFilter(s.options);const Le=s.dynamicFilter(),qe=s.dynamicFilterNeedsFeature(),Ne=this.transform.calculatePixelsToTileUnitsMatrix(m),Ge=Nr(fe,m.tileID.canonical,Ce,ze,this.transform,T.getProjection(),Ne);let Be=null;if(Ce){const tn=vh(fe,m.tileID.canonical,Ce,ze,this.transform,T.getProjection(),Ne);Be=r.ab.mat4.multiply([],this.transform.labelPlaneMatrix,tn)}let Ke=null;Le&&m.latestFeatureIndex&&(Ke={unwrappedTileID:ne,dynamicFilter:Le,dynamicFilterNeedsFeature:qe}),this.retainedQueryData[T.bucketInstanceId]=new Vm(T.bucketInstanceId,P,T.sourceLayerIndex,T.index,m.tileID);const[it,Rt]=T.layers[0].layout.get("text-size-scale-range"),xt=r.aw(b,it,Rt),[jt,zt]=N.get("icon-size-scale-range"),pt=r.aw(b,jt,zt),Dt={bucket:T,layout:N,paint:V,posMatrix:fe,textLabelPlaneMatrix:Ge,labelToScreenMatrix:Be,clippingData:Ke,scale:Z,textPixelRatio:K,holdingForFade:m.holdingForFade(),collisionBoxArray:q,partiallyEvaluatedTextSize:r.bp(T.textSizeData,this.transform.zoom,xt),partiallyEvaluatedIconSize:r.bp(T.iconSizeData,this.transform.zoom,pt),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:m.latestFeatureIndex};if(x)for(const tn of T.sortKeyRanges){const{sortKey:dt,symbolInstanceStart:Ut,symbolInstanceEnd:Pt}=tn;i.push({sortKey:dt,symbolInstanceStart:Ut,symbolInstanceEnd:Pt,parameters:Dt})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Dt})}attemptAnchorPlacement(i,s,m,x,b,T,P,N,V,q,Z,K,ne,fe,ue,ve,ge,Ce){const{textOffset0:ze,textOffset1:Le,crossTileID:qe}=K,Ne=[ze,Le],Ge=zo(i,m,x,Ne,b),Be=this.collisionIndex.placeCollisionBox(fe,b,s,Gm(Ge.x,Ge.y,T,P,this.transform.angle),Z,N,V,q.predicate);if(ve){const Ke=fe.getSymbolInstanceIconSize(Ce,this.transform.zoom,K.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(fe,Ke,ve,Gm(Ge.x,Ge.y,T,P,this.transform.angle),Z,N,V,q.predicate).box.length===0)return}if(Be.box.length>0){let Ke;return this.prevPlacement&&this.prevPlacement.variableOffsets[qe]&&this.prevPlacement.placements[qe]&&this.prevPlacement.placements[qe].text&&(Ke=this.prevPlacement.variableOffsets[qe].anchor),this.variableOffsets[qe]={textOffset:Ne,width:m,height:x,anchor:i,textScale:b,prevAnchor:Ke},this.markUsedJustification(fe,i,K,ue),fe.allowVerticalPlacement&&(this.markUsedOrientation(fe,ue,K),this.placedOrientations[qe]=ue),{shift:Ge,placedGlyphBoxes:Be}}}placeLayerBucketPart(i,s,m,x,b=1){const{bucket:T,layout:P,paint:N,posMatrix:V,textLabelPlaneMatrix:q,labelToScreenMatrix:Z,clippingData:K,textPixelRatio:ne,holdingForFade:fe,collisionBoxArray:ue,partiallyEvaluatedTextSize:ve,partiallyEvaluatedIconSize:ge,collisionGroup:Ce,latestFeatureIndex:ze}=i.parameters,Le=P.get("text-optional"),qe=P.get("icon-optional"),Ne=P.get("text-allow-overlap"),Ge=P.get("icon-allow-overlap"),Be=P.get("text-rotation-alignment")==="map",Ke=P.get("text-pitch-alignment")==="map",it=P.get("symbol-z-elevate"),Rt=N.get("symbol-z-offset"),xt=P.get("symbol-elevation-reference")==="sea",[jt,zt]=P.get("text-size-scale-range"),[pt,Dt]=P.get("icon-size-scale-range"),tn=r.aw(b,jt,zt),dt=r.aw(b,pt,Dt);this.transform.setProjection(T.projection);let Ut=Ne&&(Ge||!T.hasIconData()||qe),Pt=Ge&&(Ne||!T.hasTextData()||Le);const dn=!Rt.isConstant();!T.collisionArrays&&ue&&T.deserializeCollisionBoxes(ue),m&&x&&T.updateCollisionDebugBuffers(this.transform.zoom,ue,tn,dt);const Zt=(Gt,rn,mn)=>{const{crossTileID:Cn,numVerticalGlyphVertices:zn}=Gt;let ni=null;if(K&&K.dynamicFilterNeedsFeature||dn){const hr=this.retainedQueryData[T.bucketInstanceId];ni=ze.loadFeature({featureIndex:Gt.featureIndex,bucketIndex:hr.bucketIndex,sourceLayerIndex:hr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(K&&!(0,K.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},ni,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new r.P(Gt.tileAnchorX,Gt.tileAnchorY),this.transform.calculateDistanceTileData(K.unwrappedTileID)))return this.placements[Cn]=new Um(!1,!1,!1,!0),void s.add(Cn);const Yn=Rt.evaluate(ni,{});if(s.has(Cn))return;if(fe)return void(this.placements[Cn]=new Um(!1,!1,!1));let Zn=!1,mi=!1,gi=!0,pr=!1,Qr=!1,Pr=null,Ei={box:null,offscreen:null,occluded:null},Qi={box:null},Rn=null,li=null,ri=null,hi=0,Hi=0,Lr=0;mn.textFeatureIndex?hi=mn.textFeatureIndex:Gt.useRuntimeCollisionCircles&&(hi=Gt.featureIndex),mn.verticalTextFeatureIndex&&(Hi=mn.verticalTextFeatureIndex);const jr=hr=>{hr.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const ur=this.transform.elevation;hr.elevation=xt?Yn:Yn+(ur?ur.getAtTileOffset(hr.tileID,hr.tileAnchorX,hr.tileAnchorY):0),hr.elevation+=Gt.zOffset},ea=mn.textBox;if(ea){jr(ea);const hr=Xi=>{let Tr=r.bq.horizontal;if(T.allowVerticalPlacement&&!Xi&&this.prevPlacement){const la=this.prevPlacement.placedOrientations[Cn];la&&(this.placedOrientations[Cn]=la,Tr=la,this.markUsedOrientation(T,Tr,Gt))}return Tr},ur=(Xi,Tr)=>{if(T.allowVerticalPlacement&&zn>0&&mn.verticalTextBox){for(const la of T.writingModes)if(la===r.bq.vertical?(Ei=Tr(),Qi=Ei):Ei=Xi(),Ei&&Ei.box&&Ei.box.length)break}else Ei=Xi()};if(P.get("text-variable-anchor")){let Xi=P.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Cn]){const mr=this.prevPlacement.variableOffsets[Cn];Xi.indexOf(mr.anchor)>0&&(Xi=Xi.filter(ca=>ca!==mr.anchor),Xi.unshift(mr.anchor))}const Tr=(mr,ca,ns)=>{const Io=T.getSymbolInstanceTextSize(ve,Gt,this.transform.zoom,rn),mo=(mr.x2-mr.x1)*Io+2*mr.padding,_s=(mr.y2-mr.y1)*Io+2*mr.padding,to=Gt.hasIconTextFit&&!Ge?ca:null;to&&jr(to);let Do={box:[],offscreen:!1,occluded:!1};const vs=Ne?2*Xi.length:Xi.length;for(let is=0;is<vs;++is){const ic=this.attemptAnchorPlacement(Xi[is%Xi.length],mr,mo,_s,Io,Be,Ke,ne,V,Ce,is>=Xi.length,Gt,rn,T,ns,to,ve,ge);if(ic&&(Do=ic.placedGlyphBoxes,Do&&Do.box&&Do.box.length)){Zn=!0,Pr=ic.shift;break}}return Do};ur(()=>Tr(ea,mn.iconBox,r.bq.horizontal),()=>{const mr=mn.verticalTextBox;return mr&&jr(mr),T.allowVerticalPlacement&&!(Ei&&Ei.box&&Ei.box.length)&&zn>0&&mr?Tr(mr,mn.verticalIconBox,r.bq.vertical):{box:null,offscreen:null,occluded:null}}),Ei&&(Zn=Ei.box,gi=Ei.offscreen,pr=Ei.occluded);const la=hr(!(!Ei||!Ei.box));if(!Zn&&this.prevPlacement){const mr=this.prevPlacement.variableOffsets[Cn];mr&&(this.variableOffsets[Cn]=mr,this.markUsedJustification(T,mr.anchor,Gt,la))}}else{const Xi=(Tr,la)=>{const mr=T.getSymbolInstanceTextSize(ve,Gt,this.transform.zoom,rn,b),ca=this.collisionIndex.placeCollisionBox(T,mr,Tr,new r.P(0,0),Ne,ne,V,Ce.predicate);return ca&&ca.box&&ca.box.length&&(this.markUsedOrientation(T,la,Gt),this.placedOrientations[Cn]=la),ca};ur(()=>Xi(ea,r.bq.horizontal),()=>{const Tr=mn.verticalTextBox;return T.allowVerticalPlacement&&zn>0&&Tr?(jr(Tr),Xi(Tr,r.bq.vertical)):{box:null,offscreen:null,occluded:null}}),hr(!!(Ei&&Ei.box&&Ei.box.length))}}if(Rn=Ei,Zn=Rn&&Rn.box&&Rn.box.length>0,gi=Rn&&Rn.offscreen,pr=Rn&&Rn.occluded,Gt.useRuntimeCollisionCircles){const hr=T.text.placedSymbolArray.get(Gt.centerJustifiedTextSymbolIndex>=0?Gt.centerJustifiedTextSymbolIndex:Gt.verticalPlacedTextSymbolIndex),ur=r.br(T.textSizeData,ve,hr),Xi=P.get("text-padding");li=this.collisionIndex.placeCollisionCircles(T,Ne,hr,T.lineVertexArray,T.glyphOffsetArray,ur,V,q,Z,m,Ke,Ce.predicate,Gt.collisionCircleDiameter*ur/r.bw,Xi,this.retainedQueryData[T.bucketInstanceId].tileID),Zn=Ne||li.circles.length>0&&!li.collisionDetected,gi=gi&&li.offscreen,pr=li.occluded}if(mn.iconFeatureIndex&&(Lr=mn.iconFeatureIndex),mn.iconBox){const hr=ur=>{jr(ur);const Xi=Gt.hasIconTextFit&&Pr?Gm(Pr.x,Pr.y,Be,Ke,this.transform.angle):new r.P(0,0),Tr=T.getSymbolInstanceIconSize(ge,this.transform.zoom,Gt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,Tr,ur,Xi,Ge,ne,V,Ce.predicate)};Qi&&Qi.box&&Qi.box.length&&mn.verticalIconBox?(ri=hr(mn.verticalIconBox),mi=ri.box.length>0):(ri=hr(mn.iconBox),mi=ri.box.length>0),gi=gi&&ri.offscreen,Qr=ri.occluded}const Vo=Le||Gt.numHorizontalGlyphVertices===0&&zn===0,ha=qe||Gt.numIconVertices===0;if(Vo||ha?ha?Vo||(mi=mi&&Zn):Zn=mi&&Zn:mi=Zn=mi&&Zn,Zn&&Rn&&Rn.box&&this.collisionIndex.insertCollisionBox(Rn.box,P.get("text-ignore-placement"),T.bucketInstanceId,Qi&&Qi.box&&Hi?Hi:hi,Ce.ID),mi&&ri&&this.collisionIndex.insertCollisionBox(ri.box,P.get("icon-ignore-placement"),T.bucketInstanceId,Lr,Ce.ID),li&&(Zn&&this.collisionIndex.insertCollisionCircles(li.circles,P.get("text-ignore-placement"),T.bucketInstanceId,hi,Ce.ID),m)){const hr=T.bucketInstanceId;let ur=this.collisionCircleArrays[hr];ur===void 0&&(ur=this.collisionCircleArrays[hr]=new Vl);for(let Xi=0;Xi<li.circles.length;Xi+=4)ur.circles.push(li.circles[Xi+0]),ur.circles.push(li.circles[Xi+1]),ur.circles.push(li.circles[Xi+2]),ur.circles.push(li.collisionDetected?1:0)}const Yi=T.projection.name!=="globe";Ut=Ut&&(Yi||!pr),Pt=Pt&&(Yi||!Qr),this.placements[Cn]=new Um(Zn||Ut,mi||Pt,gi||T.justReloaded),s.add(Cn)};if(it&&this.buildingIndex&&(this.buildingIndex.updateZOffset(T,this.retainedQueryData[T.bucketInstanceId].tileID),T.updateZOffset()),T.sortFeaturesByY){const Gt=T.getSortedSymbolIndexes(this.transform.angle);for(let rn=Gt.length-1;rn>=0;--rn){const mn=Gt[rn];Zt(T.symbolInstances.get(mn),mn,T.collisionArrays[mn])}T.hasAnyZOffset&&r.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const Gt=T.getSortedIndexesByZOffset();for(let rn=0;rn<Gt.length;++rn){const mn=Gt[rn];Zt(T.symbolInstances.get(mn),mn,T.collisionArrays[mn])}}else for(let Gt=i.symbolInstanceStart;Gt<i.symbolInstanceEnd;Gt++)Zt(T.symbolInstances.get(Gt),Gt,T.collisionArrays[Gt]);if(m&&T.bucketInstanceId in this.collisionCircleArrays){const Gt=this.collisionCircleArrays[T.bucketInstanceId];r.ab.mat4.invert(Gt.invProjMatrix,V),Gt.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(i,s,m,x){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:N,crossTileID:V}=m,q=r.bB(s),Z=x===r.bq.vertical?N:q==="left"?b:q==="center"?T:q==="right"?P:-1;b>=0&&(i.text.placedSymbolArray.get(b).crossTileID=Z>=0&&b!==Z?0:V),T>=0&&(i.text.placedSymbolArray.get(T).crossTileID=Z>=0&&T!==Z?0:V),P>=0&&(i.text.placedSymbolArray.get(P).crossTileID=Z>=0&&P!==Z?0:V),N>=0&&(i.text.placedSymbolArray.get(N).crossTileID=Z>=0&&N!==Z?0:V)}markUsedOrientation(i,s,m){const x=s===r.bq.horizontal||s===r.bq.horizontalOnly?s:0,b=s===r.bq.vertical?s:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:N,verticalPlacedTextSymbolIndex:V}=m,q=i.text.placedSymbolArray;T>=0&&(q.get(T).placedOrientation=x),P>=0&&(q.get(P).placedOrientation=x),N>=0&&(q.get(N).placedOrientation=x),V>=0&&(q.get(V).placedOrientation=b)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let m=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const x=s?s.symbolFadeChange(i):1,b=s?s.opacities:{},T=s?s.variableOffsets:{},P=s?s.placedOrientations:{};for(const N in this.placements){const V=this.placements[N],q=b[N];q?(this.opacities[N]=new Xs(q,x,V.text,V.icon,null,V.clipped),m=m||V.text!==q.text.placed||V.icon!==q.icon.placed):(this.opacities[N]=new Xs(null,x,V.text,V.icon,V.skipFade,V.clipped),m=m||V.text||V.icon)}for(const N in b){const V=b[N];if(!this.opacities[N]){const q=new Xs(V,x,!1,!1);q.isHidden()||(this.opacities[N]=q,m=m||V.text.placed||V.icon.placed)}}for(const N in T)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=T[N]);for(const N in P)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=P[N]);m?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:i)}updateLayerOpacities(i,s,m,x){const b=new Set;for(const T of s){const P=T.getBucket(i);P&&T.latestFeatureIndex&&i.fqid===P.layerIds[0]&&(this.updateBucketOpacities(P,b,T,T.collisionBoxArray,m,x,T.tileID,i.scope),P.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(P,T.tileID),P.updateZOffset()))}}updateBucketOpacities(i,s,m,x,b,T,P,N){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const V=i.layers[0].layout,q=i.layers[0].paint,Z=!!i.layers[0].dynamicFilter(),K=new Xs(null,0,!1,!1,!0),ne=V.get("text-allow-overlap"),fe=V.get("icon-allow-overlap"),ue=V.get("text-variable-anchor"),ve=V.get("text-rotation-alignment")==="map",ge=V.get("text-pitch-alignment")==="map",Ce=q.get("symbol-z-offset"),ze=V.get("symbol-elevation-reference")==="sea",Le=!Ce.isConstant(),qe=new Xs(null,0,ne&&(fe||!i.hasIconData()||V.get("icon-optional")),fe&&(ne||!i.hasTextData()||V.get("text-optional")),!0);!i.collisionArrays&&x&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(x);const Ne=(Be,Ke,it)=>{for(let Rt=0;Rt<Ke/4;Rt++)Be.opacityVertexArray.emplaceBack(it)};let Ge=0;T&&i.updateReplacement(P,T);for(let Be=0;Be<i.symbolInstances.length;Be++){const Ke=i.symbolInstances.get(Be),{numHorizontalGlyphVertices:it,numVerticalGlyphVertices:Rt,crossTileID:xt,numIconVertices:jt,tileAnchorX:zt,tileAnchorY:pt}=Ke;let Dt=null;const tn=this.retainedQueryData[i.bucketInstanceId];Le&&Ke&&tn&&(Dt=m.latestFeatureIndex.loadFeature({featureIndex:Ke.featureIndex,bucketIndex:tn.bucketIndex,sourceLayerIndex:tn.sourceLayerIndex,layoutVertexArrayOffset:0}));const dt=Ce.evaluate(Dt,{}),Ut=s.has(xt);let Pt=this.opacities[xt];Ut?Pt=K:Pt||(Pt=qe,this.opacities[xt]=Pt),s.add(xt);const dn=it>0||Rt>0,Zt=jt>0,Gt=this.placedOrientations[xt],rn=Gt===r.bq.vertical,mn=Gt===r.bq.horizontal||Gt===r.bq.horizontalOnly;!dn&&!Zt||Pt.isHidden()||Ge++;let Cn=!1;if((dn||Zt)&&T)for(const zn of i.activeReplacements){if(r.bx(zn,b,r.by.Symbol,N)||zn.min.x>zt||zt>zn.max.x||zn.min.y>pt||pt>zn.max.y)continue;const ni=r.bz(zt,pt,P.canonical,zn.footprintTileId.canonical);if(Cn=r.bA(ni,zn.footprint),Cn)break}if(dn){const zn=Cn?Zs:Hm(Pt.text);Ne(i.text,it,rn?Zs:zn),Ne(i.text,Rt,mn?Zs:zn);const ni=Pt.text.isHidden(),{leftJustifiedTextSymbolIndex:Yn,centerJustifiedTextSymbolIndex:Zn,rightJustifiedTextSymbolIndex:mi,verticalPlacedTextSymbolIndex:gi}=Ke,pr=i.text.placedSymbolArray,Qr=ni||rn?1:0;Yn>=0&&(pr.get(Yn).hidden=Qr),Zn>=0&&(pr.get(Zn).hidden=Qr),mi>=0&&(pr.get(mi).hidden=Qr),gi>=0&&(pr.get(gi).hidden=ni||mn?1:0);const Pr=this.variableOffsets[xt];Pr&&this.markUsedJustification(i,Pr.anchor,Ke,Gt);const Ei=this.placedOrientations[xt];Ei&&(this.markUsedJustification(i,"left",Ke,Ei),this.markUsedOrientation(i,Ei,Ke))}if(Zt){const zn=Cn?Zs:Hm(Pt.icon),{placedIconSymbolIndex:ni,verticalPlacedIconSymbolIndex:Yn}=Ke,Zn=i.icon.placedSymbolArray,mi=Pt.icon.isHidden()?1:0;ni>=0&&(Ne(i.icon,jt,rn?Zs:zn),Zn.get(ni).hidden=mi),Yn>=0&&(Ne(i.icon,Ke.numVerticalIconVertices,mn?Zs:zn),Zn.get(Yn).hidden=mi)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const zn=i.collisionArrays[Be];if(zn){let ni=new r.P(0,0),Yn=!0;if(zn.textBox||zn.verticalTextBox){if(ue){const mi=this.variableOffsets[xt];mi?(ni=zo(mi.anchor,mi.width,mi.height,mi.textOffset,mi.textScale),ve&&ni._rotate(ge?this.transform.angle:-this.transform.angle)):Yn=!1}Z&&(Yn=!Pt.clipped),zn.textBox&&Fd(i.textCollisionBox.collisionVertexArray,Pt.text.placed,!Yn||rn,dt,ze,ni.x,ni.y),zn.verticalTextBox&&Fd(i.textCollisionBox.collisionVertexArray,Pt.text.placed,!Yn||mn,dt,ze,ni.x,ni.y)}const Zn=Yn&&!!(!mn&&zn.verticalIconBox);zn.iconBox&&Fd(i.iconCollisionBox.collisionVertexArray,Pt.icon.placed,Zn,dt,ze,Ke.hasIconTextFit?ni.x:0,Ke.hasIconTextFit?ni.y:0),zn.verticalIconBox&&Fd(i.iconCollisionBox.collisionVertexArray,Pt.icon.placed,!Zn,dt,ze,Ke.hasIconTextFit?ni.x:0,Ke.hasIconTextFit?ni.y:0)}}}if(i.fullyClipped=Ge===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const Be=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=Be.invProjMatrix,i.placementViewportMatrix=Be.viewportMatrix,i.collisionCircleArray=Be.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,s){const m=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*m>i}setStale(){this.stale=!0}}function Fd(f,i,s,m,x,b,T){f.emplaceBack(i?1:0,s?1:0,b||0,T||0,m,x?1:0),f.emplaceBack(i?1:0,s?1:0,b||0,T||0,m,x?1:0),f.emplaceBack(i?1:0,s?1:0,b||0,T||0,m,x?1:0),f.emplaceBack(i?1:0,s?1:0,b||0,T||0,m,x?1:0)}const Nd=Math.pow(2,25),jy=Math.pow(2,24),Gy=Math.pow(2,17),Bd=Math.pow(2,16),Ud=Math.pow(2,9),Hy=Math.pow(2,8),xh=Math.pow(2,1);function Hm(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const i=f.placed?1:0,s=Math.floor(127*f.opacity);return s*Nd+i*jy+s*Gy+i*Bd+s*Ud+i*Hy+s*xh+i}const Zs=0;class Ts{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,s,m,x,b,T){const P=this._bucketParts;for(;this._currentTileIndex<i.length;)if(s.getBucketParts(P,x,i[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((N,V)=>N.sortKey-V.sortKey));this._currentPartIndex<P.length;){const N=P[this._currentPartIndex];if(s.placeLayerBucketPart(N,this._seenCrossTileIDs,m,N.symbolInstanceStart===0,T),this._currentPartIndex++,b())return!0}return!1}}class qy{constructor(i,s,m,x,b,T,P,N,V){this.placement=new kd(i,b,T,P,N,V),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(i,s,m,x,b){const T=r.q.now(),P=()=>{const N=r.q.now()-T;return!this._forceFullPlacement&&N>2};for(;this._currentPlacementIndex>=0;){const N=s[i[this._currentPlacementIndex]],V=this.placement.collisionIndex.transform.zoom;if(N.type==="symbol"&&(!N.minzoom||N.minzoom<=V)&&(!N.maxzoom||N.maxzoom>V)){const q=N,Z=q.layout.get("symbol-z-elevate"),K=q.layout.get("symbol-sort-key").constantOr(1)!==void 0,ne=q.layout.get("symbol-z-order"),fe=ne==="viewport-y"||ne==="auto"&&!(ne!=="viewport-y"&&K),ue=q.layout.get("text-allow-overlap")||q.layout.get("icon-allow-overlap")||q.layout.get("text-ignore-placement")||q.layout.get("icon-ignore-placement"),ve=fe&&ue,ge=this._inProgressLayer=this._inProgressLayer||new Ts(q),Ce=r.aC(N.source,N.scope);if(ge.continuePlacement(Z||ve?x[Ce]:m[Ce],this.placement,this._showCollisionBoxes,N,P,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const op=512/r.ag/2;class M_{constructor(i,s,m){this.tileID=i,this.bucketInstanceId=m,this.index=new r.bE(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=i.canonical.x*r.ag,b=i.canonical.y*r.ag;for(let T=0;T<s.length;T++){const{key:P,crossTileID:N,tileAnchorX:V,tileAnchorY:q}=s.get(T),Z=Math.floor((x+V)*op),K=Math.floor((b+q)*op);this.index.add(Z,K),this.keys.push(P),this.crossTileIDs.push(N)}this.index.finish()}findMatches(i,s,m){const x=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),b=op/Math.pow(2,s.canonical.z-this.tileID.canonical.z),T=s.canonical.x*r.ag,P=s.canonical.y*r.ag;for(let N=0;N<i.length;N++){const V=i.get(N);if(V.crossTileID)continue;const{key:q,tileAnchorX:Z,tileAnchorY:K}=V,ne=Math.floor((T+Z)*b),fe=Math.floor((P+K)*b),ue=this.index.range(ne-x,fe-x,ne+x,fe+x);for(const ve of ue){const ge=this.crossTileIDs[ve];if(this.keys[ve]===q&&!m.has(ge)){m.add(ge),V.crossTileID=ge;break}}}}}class qm{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class T_{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const s=Math.round((i-this.lng)/360);if(s!==0)for(const m in this.indexes){const x=this.indexes[m],b={};for(const T in x){const P=x[T];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+s),b[P.tileID.key]=P}this.indexes[m]=b}this.lng=i}addBucket(i,s,m){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let b=0;b<s.symbolInstances.length;b++)s.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const x=this.usedCrossTileIDs[i.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>i.overscaledZ)for(const P in T){const N=T[P];N.tileID.isChildOf(i)&&N.findMatches(s.symbolInstances,i,x)}else{const P=T[i.scaledTo(Number(b)).key];P&&P.findMatches(s.symbolInstances,i,x)}}for(let b=0;b<s.symbolInstances.length;b++){const T=s.symbolInstances.get(b);T.crossTileID||(T.crossTileID=m.generate(),x.add(T.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new M_(i,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(i,s){for(const m of s.crossTileIDs)this.usedCrossTileIDs[i].delete(m)}removeStaleBuckets(i){let s=!1;for(const m in this.indexes){const x=this.indexes[m];for(const b in x)i[x[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,x[b]),delete x[b],s=!0)}return s}}class sp{constructor(){this.layerIndexes={},this.crossTileIDs=new qm,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,s,m,x){let b=this.layerIndexes[i.fqid];b===void 0&&(b=this.layerIndexes[i.fqid]=new T_);let T=!1;const P={};x.name!=="globe"&&b.handleWrapJump(m);for(const N of s){const V=N.getBucket(i);V&&i.fqid===V.layerIds[0]&&(V.bucketInstanceId||(V.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(N.tileID,V,this.crossTileIDs)&&(T=!0),P[V.bucketInstanceId]=!0)}return b.removeStaleBuckets(P)&&(T=!0),T}pruneUnusedLayers(i){const s={};i.forEach(m=>{s[m]=!0});for(const m in this.layerIndexes)s[m]||delete this.layerIndexes[m]}}const As=771;class Ui{constructor(i,s,m,x){this.blendFunction=i,this.blendColor=s,this.mask=m,this.blendEquation=x}}Ui.Replace=[1,0,1,0],Ui.disabled=new Ui(Ui.Replace,r.aj.transparent,[!1,!1,!1,!1]),Ui.unblended=new Ui(Ui.Replace,r.aj.transparent,[!0,!0,!0,!0]),Ui.alphaBlended=new Ui([1,As,1,As],r.aj.transparent,[!0,!0,!0,!0]),Ui.alphaBlendedNonPremultiplied=new Ui([770,As,770,As],r.aj.transparent,[!0,!0,!0,!0]),Ui.multiply=new Ui([774,0,774,0],r.aj.transparent,[!0,!0,!0,!0]);class Qn{constructor(i,s,m){this.func=i,this.mask=s,this.range=m}}Qn.ReadOnly=!1,Qn.ReadWrite=!0,Qn.disabled=new Qn(519,Qn.ReadOnly,[0,1]);const lp=7680;class pi{constructor(i,s,m,x,b,T){this.test=i,this.ref=s,this.mask=m,this.fail=x,this.depthFail=b,this.pass=T}}pi.disabled=new pi({func:519,mask:0},0,0,lp,lp,lp);const yu=1029,Sc=2305;class fi{constructor(i,s,m){this.enable=i,this.mode=s,this.frontFace=m}}function bh(f,i){const s=r.bG(f,3);r.ab.mat4.fromQuat(f,i),r.bI(f,3,s)}function dl(f,i){const s=r.ab.quat.identity([]);return r.ab.quat.rotateZ(s,s,-i),r.ab.quat.rotateX(s,s,-f),s}function cp(f,i){const s=[f[0],f[1],0],m=[i[0],i[1],0];if(r.ab.vec3.length(s)>=1e-15){const T=r.ab.vec3.normalize([],s);r.ab.vec3.scale(m,T,r.ab.vec3.dot(m,T)),i[0]=m[0],i[1]=m[1]}const x=r.ab.vec3.cross([],i,f);if(r.ab.vec3.len(x)<1e-15)return null;const b=Math.atan2(-x[1],x[0]);return dl(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),b)}fi.disabled=new fi(!1,yu,Sc),fi.backCCW=new fi(!0,yu,Sc),fi.backCW=new fi(!0,yu,2304),fi.frontCW=new fi(!0,1028,2304),fi.frontCCW=new fi(!0,1028,Sc);class Vd{constructor(i,s){this.position=i,this.orientation=s}get position(){return this._position}set position(i){if(i){const s=i instanceof r.aa?i:new r.aa(i[0],i[1],i[2]);this._renderWorldCopies&&(s.x=r.bF(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(i,s){if(this.orientation=null,!this.position)return;const m=this.position,x=this._elevation?this._elevation.getAtPointOrZero(r.aa.fromLngLat(i)):0,b=r.aa.fromLngLat(i,x),T=[b.x-m.x,b.y-m.y,b.z-m.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=cp(T,s)}setPitchBearing(i,s){this.orientation=dl(r.ai(i),r.ai(-s))}}class xo{constructor(i,s){this._transform=r.ab.mat4.identity([]),this.orientation=s,this.position=i}get mercatorPosition(){const i=this.position;return new r.aa(i[0],i[1],i[2])}get position(){const i=r.bG(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var s;i&&r.bI(this._transform,3,[(s=i)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||r.ab.quat.identity([]),i&&bh(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,s){this._orientation=dl(i,s),bh(this._transform,this._orientation)}forward(){const i=r.bG(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=r.bG(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=r.bG(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,s){const m=new Float64Array(16);return r.ab.mat4.invert(m,this.getWorldToCamera(i,s)),m}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,s,m){const x=this.position;r.ab.vec3.scale(x,x,-i);const b=new Float64Array(16);return r.ab.mat4.fromScaling(b,[m,m,m]),r.ab.mat4.translate(b,b,x),b[10]*=s,b}getWorldToCamera(i,s){const m=new Float64Array(16),x=new Float64Array(4),b=this.position;return r.ab.quat.conjugate(x,this._orientation),r.ab.vec3.scale(b,b,-i),r.ab.mat4.fromQuat(m,x),r.ab.mat4.translate(m,m,b),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=s,m[9]*=s,m[10]*=s,m[11]*=s,m}getCameraToClipPerspective(i,s,m,x){const b=new Float64Array(16);return r.ab.mat4.perspective(b,i,s,m,x),b}getCameraToClipOrthographic(i,s,m,x,b,T){const P=new Float64Array(16);return r.ab.mat4.ortho(P,i,s,m,x,b,T),P}getDistanceToElevation(i,s=!1){const m=i===0?0:r.bH(i,s?r.aS(this.position[1]):this.position[1]),x=this.forward();return(m-this.position[2])/x[2]}clone(){return new xo([...this.position],[...this.orientation])}}const ja={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class yn{constructor(i=0,s=0,m=0,x=0){if(isNaN(i)||i<0||isNaN(s)||s<0||isNaN(m)||m<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=s,this.left=m,this.right=x}interpolate(i,s,m){return s.top!=null&&i.top!=null&&(this.top=r.af(i.top,s.top,m)),s.bottom!=null&&i.bottom!=null&&(this.bottom=r.af(i.bottom,s.bottom,m)),s.left!=null&&i.left!=null&&(this.left=r.af(i.left,s.left,m)),s.right!=null&&i.right!=null&&(this.right=r.af(i.right,s.right,m)),this}getCenter(i,s){const m=r.aw((this.left+i-this.right)/2,0,i),x=r.aw((this.top+s-this.bottom)/2,0,s);return new r.P(m,x)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new yn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const up=(f,i,s)=>(1-s)*f+s*i,jd=f=>f*f*f*f*f;class Gd{constructor(i,s,m,x,b,T,P){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=i||0,this._maxZoom=s||22,this._minPitch=m??0,this._maxPitch=x??60,this.setProjection(T),this.setMaxBounds(P),this.width=0,this.height=0,this._center=new r.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new yn,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new xo,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const i=new Gd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,s=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(i||m)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return r.ay(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=r.bP(this.projectionOptions);const m=this.getProjection(),x=!r.bn(s,m);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.bP({name:"mercator"});const s=i!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bF(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const s=-i*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=r.ab.mat2.create(),r.ab.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const s=r.aw(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=r.ai(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const s=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){const i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const m=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&m.exaggeration()&&this._centerAltitudeValidForExaggeration!==m.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*m.exaggeration(),this._centerAltitudeValidForExaggeration=m.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=m.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let x=0,b=0;for(let T=0;T<s.length;T++){const P=new r.P(s[T][0]*this.width,m+s[T][1]*(this.height-m)),N=i.pointCoordinate(P);if(!N)continue;const V=1/Math.hypot(N[0]-this._camera.position[0],N[1]-this._camera.position[1]);x+=N[3]*V,b+=V}return b===0?NaN:x/b}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*s,x=this._mercatorZfromZoom(i),b=this._mercatorZfromZoom(this._maxZoom),T=Math.max(x-m,b);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let m;m=i.z<this._camera.position[2]?[s.x,s.y,s.z]:[i.x,i.y,i.z];const x=r.ab.vec3.length(r.ab.vec3.sub([],this._camera.position,m));return r.aw(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let s=!1;if(i.orientation&&!r.ab.quat.exactEquals(i.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(i.orientation)),i.position){const m=[i.position.x,i.position.y,i.position.z];r.ab.vec3.exactEquals(m,this._camera.position)||(this._setCameraPosition(m),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,s=new Vd;return s.position=new r.aa(i[0],i[1],i[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(i){if(!r.ab.quat.length(i))return!1;r.ab.quat.normalize(i,i);const s=r.ab.vec3.transformQuat([],[0,0,-1],i),m=r.ab.vec3.transformQuat([],[0,-1,0],i);if(m[2]<0)return!1;const x=cp(s,m);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(i){const s=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;i[2]=r.aw(i[2],x/m,x/s),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,s,m){this._unmodified=!1,this._edgeInsets.interpolate(i,s,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const s=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(i){const s=[new r.bQ(0,i)];if(this.renderWorldCopies){const m=this.pointCoordinate(new r.P(0,0)),x=this.pointCoordinate(new r.P(this.width,0)),b=this.pointCoordinate(new r.P(this.width,this.height)),T=this.pointCoordinate(new r.P(0,this.height)),P=Math.floor(Math.min(m.x,x.x,b.x,T.x)),N=Math.floor(Math.max(m.x,x.x,b.x,T.x)),V=1;for(let q=P-V;q<=N+V;q++)q!==0&&s.push(new r.bQ(q,i))}return s}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(i,s,m){let x=[];const b=m!==void 0,T=!b;if(T&&this.zoom<s||b&&m[0]===0&&m[1]===0)return x;const P=new Set,N=(q,Z,K,ne,fe)=>{const ue=r.c5(Z,q,K,ne,fe);P.has(ue)||(x.push(new r.aG(q,Z,K,ne,fe)),P.add(ue))};for(let q=0;q<i.length;q++){const Z=i[q];if(T&&Z.canonical.z!==s)continue;const K=Z.canonical,ne=Z.overscaledZ,fe=Z.wrap,ue=1<<K.z,ve=K.x+1<ue,ge=K.x>0,Ce=K.y+1<ue,ze=K.y>0,Le=Z.wrap-(ge?0:1),qe=Z.wrap+(ve?0:1),Ne=ge?K.x-1:ue-1,Ge=ve?K.x+1:0;if(b)m[0]<0?(N(ne,qe,K.z,Ge,K.y),m[1]<0&&Ce&&(N(ne,fe,K.z,K.x,K.y+1),N(ne,qe,K.z,Ge,K.y+1)),m[1]>0&&ze&&(N(ne,fe,K.z,K.x,K.y-1),N(ne,qe,K.z,Ge,K.y-1))):m[0]>0?(N(ne,Le,K.z,Ne,K.y),m[1]<0&&Ce&&(N(ne,fe,K.z,K.x,K.y+1),N(ne,Le,K.z,Ne,K.y+1)),m[1]>0&&ze&&(N(ne,fe,K.z,K.x,K.y-1),N(ne,Le,K.z,Ne,K.y-1))):m[1]<0&&Ce?N(ne,fe,K.z,K.x,K.y+1):ze&&N(ne,fe,K.z,K.x,K.y-1);else{const Be=Z.visibleQuadrants;1&Be&&(N(ne,Le,K.z,Ne,K.y),ze&&(N(ne,fe,K.z,K.x,K.y-1),N(ne,Le,K.z,Ne,K.y-1))),2&Be&&(N(ne,qe,K.z,Ge,K.y),ze&&(N(ne,fe,K.z,K.x,K.y-1),N(ne,qe,K.z,Ge,K.y-1))),4&Be&&(N(ne,Le,K.z,Ne,K.y),Ce&&(N(ne,fe,K.z,K.x,K.y+1),N(ne,Le,K.z,Ne,K.y+1))),8&Be&&(N(ne,qe,K.z,Ge,K.y),Ce&&(N(ne,fe,K.z,K.x,K.y+1),N(ne,qe,K.z,Ge,K.y+1)))}}const V=[];for(const q of x)x.some(Z=>q.isChildOf(Z))||V.push(q);if(x=V.filter(q=>!i.some(Z=>!!(q.overscaledZ<s&&Z.isChildOf(q))||q.equals(Z)||q.isChildOf(Z))),T){const q=1<<s,Z=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=[q*Z.x,q*Z.y],ne=4,fe=ne*ne;x=x.filter(ue=>{const ve=ue.canonical.x+.5-K[0],ge=ue.canonical.y+.5-K[1];return ve*ve+ge*ge<fe})}return x}coveringTiles(i){let s=this.coveringZoomLevel(i);const m=s,x=this.elevation&&this.elevation.exaggeration(),b=x&&!i.isTerrainDEM,T=this.projection.name==="mercator";if(i.minzoom!==void 0&&s<i.minzoom)return[];i.maxzoom!==void 0&&s>i.maxzoom&&(s=i.maxzoom);const P=this.locationCoordinate(this.center),N=this.center.lat,V=1<<s,q=[V*P.x,V*P.y,0],Z=this.projection.name==="globe",K=!Z,ne=r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,K),fe=Z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ue=V*r.bH(1,this.center.lat),ve=this._camera.position[2]/r.bH(1,this.center.lat),ge=[V*fe.x,V*fe.y,ve*(K?1:ue)],Ce=Z||x,ze=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),Le=this.isLODDisabled(!0)?s:0;let qe;if(this._elevation&&i.isTerrainDEM)qe=1e4*this._elevation.exaggeration();else if(this._elevation){const dt=this._elevation.getMinMaxForVisibleTiles();qe=dt?dt.max:this._centerAltitude}else qe=this._centerAltitude;const Ne=i.isTerrainDEM?-qe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ge=this.projection.isReprojectedInTileSpace?r.bS(this):1,Be=dt=>{const Pt=new r.aa(dt.x+25e-6,dt.y,dt.z),dn=new r.aa(dt.x,dt.y+25e-6,dt.z),Zt=dt.toLngLat(),Gt=Pt.toLngLat(),rn=dn.toLngLat(),mn=this.locationCoordinate(Zt),Cn=this.locationCoordinate(Gt),zn=this.locationCoordinate(rn),ni=Math.hypot(Cn.x-mn.x,Cn.y-mn.y),Yn=Math.hypot(zn.x-mn.x,zn.y-mn.y);return Math.sqrt(ni*Yn)*Ge/25e-6},Ke=dt=>{const Ut=qe,Pt=Ne;return{aabb:r.bV(this,V,0,0,0,dt,Pt,Ut,this.projection),zoom:0,x:0,y:0,minZ:Pt,maxZ:Ut,wrap:dt,fullyVisible:!1}},it=[];let Rt=[];const xt=s,jt=i.reparseOverscaled?m:s,zt=(ve-this._centerAltitude)*ue,pt=dt=>{if(!this._elevation||!dt.tileID||!T)return;const Ut=this._elevation.getMinMaxForTile(dt.tileID),Pt=dt.aabb;Ut?(Pt.min[2]=Ut.min,Pt.max[2]=Ut.max,Pt.center[2]=(Pt.min[2]+Pt.max[2])/2):(dt.shouldSplit=tn(dt),dt.shouldSplit||(Pt.min[2]=Pt.max[2]=Pt.center[2]=this._centerAltitude))},Dt=(dt,Ut)=>{if(.707*Ut<dt)return 1;const Pt=Ut/dt;return Pt/(1.4144271570014144+(Math.pow(1.1,Pt-1.4144271570014144+1)-1)/(1.1-1)-1)},tn=dt=>{if(dt.zoom<Le)return!0;if(dt.zoom===xt)return!1;if(dt.shouldSplit!=null)return dt.shouldSplit;const Ut=dt.aabb.distanceX(ge),Pt=dt.aabb.distanceY(ge);let dn=zt,Zt=1;if(Z){dn=dt.aabb.distanceZ(ge);const Yn=Math.pow(2,dt.zoom),Zn=r.aS((dt.y+1)/Yn),mi=r.aS(dt.y/Yn),gi=Math.min(Math.max(N,Zn),mi),pr=r.c9(gi)/r.c9(N);if(Zt=gi===N?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,pr/this._mercatorScaleRatio),this.zoom<=r.c6&&dt.zoom===xt-1&&pr>=.9)return!0}else if(b&&(dn=dt.aabb.distanceZ(ge)*ue),this.projection.isReprojectedInTileSpace&&m<=5){const Yn=Math.pow(2,dt.zoom),Zn=Be(new r.aa((dt.x+.5)/Yn,(dt.y+.5)/Yn));Zt=Zn>.85?1:Zn}if(!T){const Yn=Math.sqrt(Ut*Ut+Pt*Pt+dn*dn);let Zn=(1<<xt-dt.zoom)*ze*Zt;return Zn*=Dt(Math.max(dn,zt),Yn),Yn<Zn}let Gt=Number.MAX_VALUE,rn=0;const mn=dt.aabb.getCorners(),Cn=[];for(const Yn of mn){r.ab.vec3.sub(Cn,Yn,ge),Z||(b?Cn[2]*=ue:Cn[2]=zt);const Zn=r.ab.vec3.dot(Cn,this._camera.forward());Zn<Gt&&(Gt=Zn,rn=Math.abs(Cn[2]))}let zn=(1<<xt-dt.zoom)*ze*Zt;if(zn*=Dt(Math.max(rn,zt),Gt),Gt<zn)return!0;const ni=dt.aabb.closestPoint(q);return ni[0]===q[0]&&ni[1]===q[1]};if(this.renderWorldCopies)for(let dt=1;dt<=3;dt++)it.push(Ke(-dt)),it.push(Ke(dt));for(it.push(Ke(0));it.length>0;){const dt=it.pop(),Ut=dt.x,Pt=dt.y;let dn=dt.fullyVisible;const Zt=()=>this.projection.name==="globe"&&(dt.y===0||dt.y===(1<<dt.zoom)-1);if(!dn){let Gt=Ce?dt.aabb.intersects(ne):dt.aabb.intersectsFlat(ne);if(Gt===0&&Zt()){const rn=new r.bT(dt.zoom,Ut,Pt);Gt=r.bU(this,V,rn,!0).intersects(ne)}if(Gt===0)continue;dn=Gt===2}if(dt.zoom!==xt&&tn(dt))for(let Gt=0;Gt<4;Gt++){const rn=(Ut<<1)+Gt%2,mn=(Pt<<1)+(Gt>>1),Cn={aabb:T?dt.aabb.quadrant(Gt):r.bV(this,V,dt.zoom+1,rn,mn,dt.wrap,dt.minZ,dt.maxZ,this.projection),zoom:dt.zoom+1,x:rn,y:mn,wrap:dt.wrap,fullyVisible:dn,tileID:void 0,shouldSplit:void 0,minZ:dt.minZ,maxZ:dt.maxZ};b&&!Z&&(Cn.tileID=new r.aG(dt.zoom+1===xt?jt:dt.zoom+1,dt.wrap,dt.zoom+1,rn,mn),pt(Cn)),it.push(Cn)}else{const Gt=dt.zoom===xt?jt:dt.zoom;if(i.minzoom&&i.minzoom>Gt)continue;let rn=0;if(!dn){let ni=Ce?dt.aabb.intersectsPrecise(ne):dt.aabb.intersectsPreciseFlat(ne);if(ni===0&&Zt()){const Yn=new r.bT(dt.zoom,Ut,Pt);ni=r.bU(this,V,Yn,!0).intersectsPrecise(ne)}if(ni===0)continue;if(i.calculateQuadrantVisibility)if(ne.containsPoint(dt.aabb.center))rn=15;else for(let Yn=0;Yn<4;Yn++)dt.aabb.quadrant(Yn).intersects(ne)!==0&&(rn|=1<<Yn)}const mn=q[0]-(.5+Ut+(dt.wrap<<dt.zoom))*(1<<s-dt.zoom),Cn=q[1]-.5-Pt,zn=dt.tileID?dt.tileID:new r.aG(Gt,dt.wrap,dt.zoom,Ut,Pt);i.calculateQuadrantVisibility&&(zn.visibleQuadrants=rn),Rt.push({tileID:zn,distanceSq:mn*mn+Cn*Cn})}}if(this.fogCullDistSq){const dt=this.fogCullDistSq,Ut=this.horizonLineFromTop();Rt=Rt.filter(Pt=>{const dn=[0,0,0,1],Zt=[r.ag,r.ag,0,1],Gt=this.calculateFogTileMatrix(Pt.tileID.toUnwrapped());r.ab.vec4.transformMat4(dn,dn,Gt),r.ab.vec4.transformMat4(Zt,Zt,Gt);const rn=r.ab.vec4.min([],dn,Zt),mn=r.ab.vec4.max([],dn,Zt),Cn=r.bW(rn,mn);if(Cn===0)return!0;let zn=!1;const ni=this._elevation;if(ni&&Cn>dt&&Ut!==0){const Yn=this.calculateProjMatrix(Pt.tileID.toUnwrapped());let Zn;i.isTerrainDEM||(Zn=ni.getMinMaxForTile(Pt.tileID)),Zn||(Zn={min:Ne,max:qe});const mi=r.c7(this.rotation),gi=[mi[0]*r.ag,mi[1]*r.ag,Zn.max];r.ab.vec3.transformMat4(gi,gi,Yn),zn=(1-gi[1])*this.height*.5<Ut}return Cn<dt||zn})}return Rt.sort((dt,Ut)=>dt.distanceSq-Ut.distanceSq).map(dt=>dt.tileID)}resize(i,s){this.width=i,this.height=s,this.pixelsToGLUnits=[2/i,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const s=r.aw(i.lat,-r.bX,r.bX),m=this.projection.project(i.lng,s);return new r.P(m.x*this.worldSize,m.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,s){let m,x;const b=this.centerPoint;if(this.projection.name==="globe"){const P=this.worldSize;m=(s.x-b.x)/P,x=(s.y-b.y)/P}else{const P=this.pointCoordinate(s),N=this.pointCoordinate(b);m=P.x-N.x,x=P.y-N.y}const T=this.locationCoordinate(i);this.setLocation(new r.aa(T.x-m,T.y-x))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,s){const m=s?r.bH(s,i.lat):void 0,x=this.projection.project(i.lng,i.lat);return new r.aa(x.x,x.y,m)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,s){const m=s??this._centerAltitude,x=[i.x,i.y,0,1],b=[i.x,i.y,1,1];r.ab.vec4.transformMat4(x,x,this.pixelMatrixInverse),r.ab.vec4.transformMat4(b,b,this.pixelMatrixInverse);const T=b[3];r.ab.vec4.scale(x,x,1/x[3]),r.ab.vec4.scale(b,b,1/T);const P=x[2],N=b[2];return{p0:x,p1:b,t:P===N?0:(m-P)/(N-P)}}screenPointToMercatorRay(i){const s=[i.x,i.y,0,1],m=[i.x,i.y,1,1];return r.ab.vec4.transformMat4(s,s,this.pixelMatrixInverse),r.ab.vec4.transformMat4(m,m,this.pixelMatrixInverse),r.ab.vec4.scale(s,s,1/s[3]),r.ab.vec4.scale(m,m,1/m[3]),s[2]=r.bH(s[2],this._center.lat)*this.worldSize,m[2]=r.bH(m[2],this._center.lat)*this.worldSize,r.ab.vec4.scale(s,s,1/this.worldSize),r.ab.vec4.scale(m,m,1/this.worldSize),new r.aq([s[0],s[1],s[2]],r.ab.vec3.normalize([],r.ab.vec3.sub([],m,s)))}rayIntersectionCoordinate(i){const{p0:s,p1:m,t:x}=i,b=r.bH(s[2],this._center.lat),T=r.bH(m[2],this._center.lat);return new r.aa(r.af(s[0],m[0],x)/this.worldSize,r.af(s[1],m[1],x)/this.worldSize,r.af(b,T,x))}pointCoordinate(i,s=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,s)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let s=this.projection.pointCoordinate3D(this,i.x,i.y);if(s)return new r.aa(s[0],s[1],s[2]);let m=0,x=this.horizonLineFromTop();if(i.y>x)return this.pointCoordinate(i);const b=.02*x,T=i.clone();for(let P=0;P<10&&x-m>b;P++){T.y=r.af(m,x,.66);const N=this.projection.pointCoordinate3D(this,T.x,T.y);N?(x=T.y,s=N):m=T.y}return s?new r.aa(s[0],s[1],s[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=r.bY)return!this.isPointAboveHorizon(i);const s=this.pointCoordinate(i);return s.y>=0&&s.y<=1}_coordinatePoint(i,s){const m=s&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,x=[i.x*this.worldSize,i.y*this.worldSize,m+i.toAltitude(),1];return r.ab.vec4.transformMat4(x,x,this.pixelMatrix),x[3]>0?new r.P(x[0]/x[3],x[1]/x[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:s}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,b=this.pointLocation3D(new r.P(s,i)),T=this.pointLocation3D(new r.P(x,i)),P=this.pointLocation3D(new r.P(x,m)),N=this.pointLocation3D(new r.P(s,m));let V=Math.min(b.lng,T.lng,P.lng,N.lng),q=Math.max(b.lng,T.lng,P.lng,N.lng),Z=Math.min(b.lat,T.lat,P.lat,N.lat),K=Math.max(b.lat,T.lat,P.lat,N.lat);const ne=Math.pow(2,-this.zoom)/16*270,fe=this.projection.name==="globe"?1:4,ue=(ve,ge,Ce,ze,Le)=>{const qe=(ve+Ce)/2,Ne=(ge+ze)/2,Ge=new r.P(qe,Ne),{lng:Be,lat:Ke}=this.pointLocation3D(Ge),it=Math.max(0,V-Be,Z-Ke,Be-q,Ke-K);V=Math.min(V,Be),q=Math.max(q,Be),Z=Math.min(Z,Ke),K=Math.max(K,Ke),(Le<fe||it>ne)&&(ue(ve,ge,qe,Ne,Le+1),ue(qe,Ne,Ce,ze,Le+1))};if(ue(s,i,x,i,1),ue(x,i,x,m,1),ue(x,m,s,m,1),ue(s,m,s,i,1),this.projection.name==="globe"){const[ve,ge]=r.bZ(this);ve?(K=90,q=180,V=-180):ge&&(Z=-90,q=180,V=-180)}return new r.az(new r.bO(V,Z),new r.bO(q,K))}_getBoundsRectangular(i,s){const{top:m,left:x}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,P=new r.P(x,m),N=new r.P(T,m),V=new r.P(T,b),q=new r.P(x,b);let Z=this.pointCoordinate(P,i),K=this.pointCoordinate(N,i);const ne=this.pointCoordinate(V,s),fe=this.pointCoordinate(q,s),ue=(ve,ge)=>(ge.y-ve.y)/(ge.x-ve.x);return Z.y>1&&K.y>=0?Z=new r.aa((1-fe.y)/ue(fe,Z)+fe.x,1):Z.y<0&&K.y<=1&&(Z=new r.aa(-fe.y/ue(fe,Z)+fe.x,0)),K.y>1&&Z.y>=0?K=new r.aa((1-ne.y)/ue(ne,K)+ne.x,1):K.y<0&&Z.y<=1&&(K=new r.aa(-ne.y/ue(ne,K)+ne.x,0)),new r.az().extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(fe)).extend(this.coordinateLocation(ne))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=i.visibleDemTiles.reduce((m,x)=>{if(x.dem){const b=x.dem.tree;m.min=Math.min(m.min,b.minimums[0]),m.max=Math.max(m.max,b.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*i.exaggeration(),s.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,m=this.height/2-s*(1-this._horizonShift);return i?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-r.bX,this.maxLat=r.bX,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.at(this.minLng)*this.tileSize,this.worldMaxX=r.at(this.maxLng)*this.tileSize,this.worldMinY=r.aA(this.maxLat)*this.tileSize,this.worldMaxY=r.aA(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,s){return this.projection.createTileMatrix(this,s,i)}calculateDistanceTileData(i){const s=i.key,m=this._distanceTileDataCache;if(m[s])return m[s];const x=i.canonical,b=1/this.height,T=this.cameraWorldSize,P=T/this.zoomScale(x.z),N=(x.x+Math.pow(2,x.z)*i.wrap)*P,V=x.y*P,q=this.point;q.x*=T/this.worldSize,q.y*=T/this.worldSize;const Z=this.angle,K=Math.sin(-Z),ne=-Math.cos(-Z);return m[s]={bearing:[K,ne],center:[(q.x-N)*b,(q.y-V)*b],scale:P/r.ag*b},m[s]}calculateFogTileMatrix(i){const s=i.key,m=this._fogTileMatrixCache;if(m[s])return m[s];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return r.ab.mat4.multiply(x,this.worldToFogMatrix,x),m[s]=new Float32Array(x),m[s]}calculateProjMatrix(i,s=!1,m=!1){const x=i.key;let b;if(b=m?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,b[x])return b[x];const T=this.calculatePosMatrix(i,this.worldSize);let P;return P=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:m?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,r.ab.mat4.multiply(T,P,T),b[x]=new Float32Array(T),b[x]}calculatePixelsToTileUnitsMatrix(i){const s=i.tileID.key,m=this._pixelsToTileUnitsCache;if(m[s])return m[s];const x=r.b_(i,this);return m[s]=x,m[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,s=r.ab.mat4.fromScaling([],[i,i,i]);return r.ab.mat4.multiply(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const s=r.bH(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(s),x=this._camera.forward(),b=r.bH(1,this._center.lat);m[2]/=b,x[2]/=b,r.ab.vec3.normalize(x,x);const T=i.raycast(m,x,i.exaggeration());if(T){const P=r.ab.vec3.scaleAndAdd([],m,x,T),N=new r.aa(P[0],P[1],r.bH(P[2],r.aS(P[1]))),V=(N.z+r.ab.vec3.length([N.x-m[0],N.y-m[1],N.z-m[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(V),this._centerAltitude=N.toAltitude(),this._center=this.coordinateLocation(N),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const s=this._elevation,m=r.bH(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(m),b=s.getAtPointOrZero(new r.aa(...x)),T=this.pixelsPerMeter/this.worldSize*b,P=this._minimumHeightOverTerrain(),N=x[2]-T;if(N<=P)if(N<0||i){const V=this.locationCoordinate(this._center,this._centerAltitude),q=[x[0],x[1],V.z-x[2]],Z=r.ab.vec3.length(q);q[2]-=(P-N)/this._pixelsPerMercatorPixel;const K=r.ab.vec3.length(q);if(K===0)return;r.ab.vec3.scale(q,q,Z/K*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],V.z*this._pixelsPerMercatorPixel-q[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const K=this.center;return K.lat=r.aw(K.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(K.lng=r.aw(K.lng,this.minLng,this.maxLng)),this.center=K,void(this._constraining=!1)}const s=this._unmodified,{x:m,y:x}=this.point;let b=0,T=m,P=x;const N=this.width/2,V=this.height/2,q=this.worldMinY*this.scale,Z=this.worldMaxY*this.scale;if(x-V<q&&(P=q+V),x+V>Z&&(P=Z-V),Z-q<this.height&&(b=Math.max(b,this.height/(Z-q)),P=(Z+q)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const K=this.worldMinX*this.scale,ne=this.worldMaxX*this.scale,fe=this.worldSize/2-(K+ne)/2;T=(m+fe+this.worldSize)%this.worldSize-fe,T-N<K&&(T=K+N),T+N>ne&&(T=ne-N),ne-K<this.width&&(b=Math.max(b,this.width/(ne-K)),T=(ne+K)/2)}T===m&&P===x||(this.center=this.unproject(new r.P(T,P))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,s=this.projection.name==="globe",m=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.bH(1,this.center.lat)/r.bH(1,r.c8));const x=r.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?m:1,T=this._camera.getWorldToCamera(this.worldSize,b);let P;const N=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(N[8]=2*-i.x/this.width,N[9]=2*i.y/this.height,this.isOrthographic){let Ke=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),it=Ke*this.aspect,Rt=-it,xt=-Ke;it-=i.x,Rt-=i.x,Ke+=i.y,xt+=i.y,P=this._camera.getCameraToClipOrthographic(Rt,it,xt,Ke,this._nearZ,this._farZ),((jt,zt,pt,Dt)=>{for(let tn=0;tn<16;tn++)jt[tn]=up(zt[tn],pt[tn],Dt)})(P,P,N,jd(this.pitch>=15?1:this.pitch/15))}else P=N;const V=r.ab.mat4.mul([],N,T);let q=r.ab.mat4.mul([],P,T);if(this.projection.isReprojectedInTileSpace){const Ke=this.locationCoordinate(this.center),it=r.ab.mat4.identity([]);r.ab.mat4.translate(it,it,[Ke.x*this.worldSize,Ke.y*this.worldSize,0]),r.ab.mat4.multiply(it,it,r.c0(this)),r.ab.mat4.translate(it,it,[-Ke.x*this.worldSize,-Ke.y*this.worldSize,0]),r.ab.mat4.multiply(q,q,it),r.ab.mat4.multiply(V,V,it),this.inverseAdjustmentMatrix=r.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.ab.mat4.scale([],q,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=q,this.invProjMatrix=r.ab.mat4.invert(new Float64Array(16),this.projMatrix),s){const Ke=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ke[8]=2*-i.x/this.width,Ke[9]=2*i.y/this.height,this.expandedFarZProjMatrix=r.ab.mat4.mul([],Ke,T)}else this.expandedFarZProjMatrix=this.projMatrix;const Z=r.ab.mat4.invert([],P);this.frustumCorners=r.c2.fromInvProjectionMatrix(Z,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);const K=new Float32Array(16);r.ab.mat4.identity(K),r.ab.mat4.scale(K,K,[1,-1,1]),r.ab.mat4.rotateX(K,K,this._pitch),r.ab.mat4.rotateZ(K,K,this.angle);const ne=r.ab.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.ab.mat4.clone(ne);const fe=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;ne[8]=2*-i.x/this.width,ne[9]=2*(i.y+fe)/this.height,this.skyboxMatrix=r.ab.mat4.multiply(K,ne,K);const ue=this.point,ve=ue.x,ge=ue.y,Ce=this.width%2/2,ze=this.height%2/2,Le=Math.cos(this.angle),qe=Math.sin(this.angle),Ne=ve-Math.round(ve)+Le*Ce+qe*ze,Ge=ge-Math.round(ge)+Le*ze+qe*Ce,Be=new Float64Array(q);if(r.ab.mat4.translate(Be,Be,[Ne>.5?Ne-1:Ne,Ge>.5?Ge-1:Ge,0]),this.alignedProjMatrix=Be,q=r.ab.mat4.create(),r.ab.mat4.scale(q,q,[this.width/2,-this.height/2,1]),r.ab.mat4.translate(q,q,[1,-1,0]),this.labelPlaneMatrix=q,q=r.ab.mat4.create(),r.ab.mat4.scale(q,q,[1,-1,1]),r.ab.mat4.translate(q,q,[-1,-1,0]),r.ab.mat4.scale(q,q,[2/this.width,2/this.height,1]),this.glCoordMatrix=q,this.pixelMatrix=r.ab.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,V),this._calcFogMatrices(),this._distanceTileDataCache={},q=r.ab.mat4.invert(new Float64Array(16),this.pixelMatrix),!q)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=q,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.c3(this);const Ke=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.ab.vec3.transformMat4(Ke,Ke,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=q;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,m=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,b=[i,i,s];r.ab.vec3.scale(b,b,x),r.ab.vec3.scale(m,m,-1),r.ab.vec3.multiply(m,m,b);const T=r.ab.mat4.create();r.ab.mat4.translate(T,T,m),r.ab.mat4.scale(T,T,b),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,s,x)}_computeCameraPosition(i){const s=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),x=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-i/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-m[0]*b,x.y/this.worldSize-m[1]*b,i/this.worldSize*this._centerAltitude-m[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],x=i[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(b=Math.min((s-m)/x,1)),this._camera.position=r.ab.vec3.scaleAndAdd([],this._camera.position,i,b),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,s=this._camera.forward(),{pitch:m,bearing:x}=this._camera.getPitchBearing(),b=r.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.ai(this._maxPitch)),P=Math.max((i[2]-b)/Math.cos(m),T),N=this._zoomFromMercatorZ(P);r.ab.vec3.scaleAndAdd(i,i,s,P),this._pitch=r.aw(m,r.ai(this.minPitch),r.ai(this.maxPitch)),this.angle=r.bF(x,-Math.PI,Math.PI),this._setZoom(r.aw(N,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.aa(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let s=0,m=r.bY,x=0,b=1/0;for(;m-s>1e-6&&m>s;){const T=s+.5*(m-s),P=this.tileSize*Math.pow(2,T),N=this.getCameraToCenterDistance(this.projection,T,P),V=this.scaleZoom(N/(i*this.tileSize)),q=Math.abs(T-V);q<b&&(b=q,x=T),T<V?s=T:m=T}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,s){const m=Math.min(i.x,s.x),x=Math.max(i.x,s.x),b=Math.min(i.y,s.y),T=Math.max(i.y,s.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const P=[new r.P(m,b),new r.P(x,T),new r.P(m,T),new r.P(x,b)],N=this.renderWorldCopies?-3:0,V=this.renderWorldCopies?4:1;for(const q of P){const Z=this.pointRayIntersection(q);if(Z.t<0)return!0;const K=this.rayIntersectionCoordinate(Z);if(K.x<N||K.y<0||K.x>V||K.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(i,s){const m=r.ab.vec3.length(r.ab.vec3.sub([],this._camera.position,i)),x=this._zoomFromMercatorZ(m)+s;return m-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([s,m,x],b){const T=[s,m,x,1];r.ab.vec4.transformMat4(T,T,b);const P=T[3]=Math.max(T[3],1e-6);return T[0]/=P,T[1]/=P,T[2]/=P,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,i))}}getCameraToCenterDistance(i,s=this.zoom,m=this.worldSize){const x=r.b$(i,s,this.width,this.height,1024),b=i.pixelSpaceConversion(this.center.lat,m,x);let T=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(T=up(1,T,jd(this.pitch>=15?1:this.pitch/15))),T}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.ab.mat4.multiply(i,i,this.globeMatrix),i}getFrustum(i){return r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}const Ec=(f,i)=>{if(i>0&&f.terrain&&r.w("Cutoff is currently disabled on terrain"),i<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const s=f.transform,m=Math.max(Math.abs(s._zoom-(f.minCutoffZoom-1)),1),x=s.isLODDisabled(!1)?r.ac(60,45,s.pitch):r.ac(30,15,s.pitch),b=s._farZ-s._nearZ,T=i*s.height,P=((1-(N=x))*s.cameraToCenterDistance+N*(s._farZ+T))*m;var N;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(P-s._nearZ)/b,(P-T-s._nearZ)/b]}}},Za={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class jl{constructor(i,s){this.aabb=i,this.lastCascade=s}}class Wm{add(i,s){const m=this.receivers[i.key];m!==void 0?(m.aabb.min[0]=Math.min(m.aabb.min[0],s.min[0]),m.aabb.min[1]=Math.min(m.aabb.min[1],s.min[1]),m.aabb.min[2]=Math.min(m.aabb.min[2],s.min[2]),m.aabb.max[0]=Math.max(m.aabb.max[0],s.max[0]),m.aabb.max[1]=Math.max(m.aabb.max[1],s.max[1]),m.aabb.max[2]=Math.max(m.aabb.max[2],s.max[2])):this.receivers[i.key]=new jl(s,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,s,m){const x=r.cd.fromPoints(i.points);let b=0;for(const T in this.receivers){const P=this.receivers[T];if(!P||!x.intersectsAabb(P.aabb))continue;P.aabb.min=x.closestPoint(P.aabb.min),P.aabb.max=x.closestPoint(P.aabb.max);const N=P.aabb.getCorners();for(let V=0;V<m.length;V++){let q=!0;for(const Z of N){const K=[Z[0]*s,Z[1]*s,Z[2]];if(r.ab.vec3.transformMat4(K,K,m[V].matrix),K[0]<-1||K[0]>1||K[1]<-1||K[1]>1){q=!1;break}}if(P.lastCascade=V,b=Math.max(b,V),q)break}}return b+1}}class Ya{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Wm,this._depthMode=new Qn(i.context.gl.LEQUAL,Qn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,i.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),i.tp.registerParameter(Za,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter(Za,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),i.tp.registerParameter(Za,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),i.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,s){const m=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;const x=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||x<=0||(this._shadowLayerCount=m.style.order.reduce((fe,ue)=>{const ve=m.style._mergedLayers[ue];return fe+(ve.hasShadowPass()&&!ve.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const b=m.context,T=Za.shadowMapResolution,P=Za.shadowMapResolution;if(this._cascades.length===0||Za.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let fe=0;fe<Za.cascadeCount;++fe){const ue=m._shadowMapDebug,ve=b.gl,ge=b.createFramebuffer(T,P,ue,"texture"),Ce=new r.T(b,{width:T,height:P,data:null},ve.DEPTH_COMPONENT16);if(ge.depthAttachment.set(Ce.texture),ue){const ze=new r.T(b,{width:T,height:P,data:null},ve.RGBA8);ge.colorAttachment.set(ze.texture)}this._cascades.push({framebuffer:ge,texture:Ce,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.bR,scale:0})}}this.shadowDirection=Mc(s);let N=0;if(i.elevation){const fe=i.elevation,ue=[1e4,-1e4];fe.visibleDemTiles.filter(ve=>ve.dem).forEach(ve=>{const ge=ve.dem.tree;ue[0]=Math.min(ue[0],ge.minimums[0]),ue[1]=Math.max(ue[1],ge.maximums[0])}),ue[0]!==1e4&&(N=(ue[1]-ue[0])*fe.exaggeration())}const V=1.5*i.cameraToCenterDistance,q=3*V,Z=new Float64Array(16);for(let fe=0;fe<this._cascades.length;++fe){const ue=this._cascades[fe];let ve=i.height/50,ge=1;Za.cascadeCount===1?ge=q:fe===0?ge=V:(ve=V,ge=q);const[Ce,ze]=A_(i,this.shadowDirection,ve,ge,Za.shadowMapResolution,N);ue.scale=i.scale,ue.matrix=Ce,ue.boundingSphereRadius=ze,r.ab.mat4.invert(Z,ue.matrix),ue.frustum=r.bR.fromInvProjectionMatrix(Z,1,0,!0),ue.far=ge}const K=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[K].far,this._cascades[K].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Za.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Za.shadowMapResolution,this._uniformValues.u_shadowmap_0=ja.ShadowMap0,this._uniformValues.u_shadowmap_1=ja.ShadowMap0+1,this._groundShadowTiles=m.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const ne=m.transform.elevation;for(const fe of this._groundShadowTiles){let ue={min:0,max:0};if(ne){const ve=ne.getMinMaxForTile(fe);ve&&(ue=ve)}this.addShadowReceiver(fe.toUnwrapped(),ue.min,ue.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,s){if(!this.enabled)return;const m=this.painter,x=m.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(m.transform.getFrustum(0),m.transform.worldSize,this._cascades),x.viewport.set([0,0,Za.shadowMapResolution,Za.shadowMapResolution]);for(let b=0;b<this._numCascadesToRender;++b){m.currentShadowCascade=b,x.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),x.clear({color:r.aj.white,depth:1});for(const T of i.order){const P=i._mergedLayers[T];if(!P.hasShadowPass()||P.isHidden(m.transform.zoom))continue;const N=i.getLayerSourceCache(P),V=N?s[N.id]:void 0;(P.type==="model"||V&&V.length)&&m.renderLayer(m,N,P,V)}}m.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const i=this.painter,s=i.style,m=i.context,x=s.directionalLight,b=s.ambientLight;if(!x||!b)return;const T=[],P=Ec(i,i.longestCutoffRange);P.shouldRenderCutoff&&T.push("RENDER_CUTOFF"),T.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&T.push("NORMAL_OFFSET");const N=hp(s,x,b),V=new Qn(m.gl.LEQUAL,Qn.ReadOnly,i.depthRangeFor3D);for(const q of this._groundShadowTiles){const Z=q.toUnwrapped(),K=i.isTileAffectedByFog(q),ne=i.getOrCreateProgram("groundShadow",{defines:T,overrideFog:K});this.setupShadows(Z,ne),i.uploadCommonUniforms(m,ne,Z,null,P);const fe={u_matrix:i.transform.calculateProjMatrix(Z),u_ground_shadow_factor:N};ne.draw(i,m.gl.TRIANGLES,V,pi.disabled,Ui.multiply,fi.disabled,fe,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,{},i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ui.unblended:Ui.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){const s=this.painter.transform,m=s.calculatePosMatrix(i,s.worldSize);return r.ab.mat4.multiply(m,this._cascades[this.painter.currentShadowCascade].matrix,m),Float32Array.from(m)}calculateShadowPassMatrixFromMatrix(i){return r.ab.mat4.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,s,m,x=0){if(!this.enabled)return;const b=this.painter.transform,T=this.painter.context,P=T.gl,N=this._uniformValues,V=new Float64Array(16),q=b.calculatePosMatrix(i,b.worldSize);for(let Z=0;Z<this._cascades.length;Z++)r.ab.mat4.multiply(V,this._cascades[Z].matrix,q),N[Z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(V),T.activeTexture.set(P.TEXTURE0+ja.ShadowMap0+Z),this._cascades[Z].texture.bind(P.NEAREST,P.CLAMP_TO_EDGE);if(this.useNormalOffset=!!m,this.useNormalOffset){const Z=r.cc(i.canonical),K=2/b.tileSize*r.ag/Za.shadowMapResolution,ne=K*this._cascades[0].boundingSphereRadius,fe=K*this._cascades[this._cascades.length-1].boundingSphereRadius,ue=(m==="vector-tile"?1:3)/Math.pow(2,x-i.canonical.z-(1-b.zoom+Math.floor(b.zoom)));N.u_shadow_normal_offset=[Z,ne*ue,fe*ue],N.u_shadow_bias=[6e-5,.0012,.012]}else N.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(T,N)}setupShadowsFromMatrix(i,s,m=!1){if(!this.enabled)return;const x=this.painter.context,b=x.gl,T=this._uniformValues,P=new Float64Array(16);for(let N=0;N<Za.cascadeCount;N++)r.ab.mat4.multiply(P,this._cascades[N].matrix,i),T[N===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),x.activeTexture.set(b.TEXTURE0+ja.ShadowMap0+N),this._cascades[N].texture.bind(b.NEAREST,b.CLAMP_TO_EDGE);if(this.useNormalOffset=m,m){const N=Za.normalOffset;T.u_shadow_normal_offset=[1,N,N],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(x,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,s,m,x){if(x[2]>=0)return{};const b=function(N,V,q){const Z=q/(1<<N.canonical.z);return new r.cd([N.canonical.x*Z+N.wrap*q,N.canonical.y*Z+N.wrap*q,0],[(N.canonical.x+1)*Z+N.wrap*q,(N.canonical.y+1)*Z+N.wrap*q,V])}(i,s,m).getCorners(),T=s/-x[2];x[0]<0?(r.ab.vec3.add(b[0],b[0],[x[0]*T,0,0]),r.ab.vec3.add(b[3],b[3],[x[0]*T,0,0])):x[0]>0&&(r.ab.vec3.add(b[1],b[1],[x[0]*T,0,0]),r.ab.vec3.add(b[2],b[2],[x[0]*T,0,0])),x[1]<0?(r.ab.vec3.add(b[0],b[0],[0,x[1]*T,0]),r.ab.vec3.add(b[1],b[1],[0,x[1]*T,0])):x[1]>0&&(r.ab.vec3.add(b[2],b[2],[0,x[1]*T,0]),r.ab.vec3.add(b[3],b[3],[0,x[1]*T,0]));const P={};return P.vertices=b,P.planes=[Ys(b[1],b[0],b[4]),Ys(b[2],b[1],b[5]),Ys(b[3],b[2],b[6]),Ys(b[0],b[3],b[7])],P}addShadowReceiver(i,s,m){this._receivers.add(i,r.cd.fromTileIdAndHeight(i,s,m))}getMaxCascadeForTile(i){const s=this._receivers.get(i);return s&&s.lastCascade?s.lastCascade:0}}function Ys(f,i,s){const m=r.ab.vec3.sub([],s,i),x=r.ab.vec3.sub([],f,i),b=r.ab.vec3.cross([],m,x),T=r.ab.vec3.length(b);return T===0?[0,0,1,0]:(r.ab.vec3.scale(b,b,1/T),[b[0],b[1],b[2],-r.ab.vec3.dot(b,i)])}function Mc(f){const i=f.properties.get("direction"),s=r.cb(i.x,i.y,i.z);s[2]=r.aw(s[2],0,75);const m=r.ce([s[0],s[1],s[2]]);return r.ab.vec3.fromValues(m.x,m.y,m.z)}function hp(f,i,s){const m=i.properties.get("color-use-theme")==="none",x=i.properties.get("color"),b=i.properties.get("intensity"),T=i.properties.get("direction"),P=[T.x,T.y,T.z],N=s.properties.get("color-use-theme")==="none",V=s.properties.get("color"),q=s.properties.get("intensity"),Z=Math.max(r.ab.vec3.dot([0,0,1],P),0),K=[0,0,0];r.ab.vec3.scale(K,V.toRenderColor(N?null:f.getLut(i.scope)).toArray01Linear().slice(0,3),q);const ne=[0,0,0];return r.ab.vec3.scale(ne,x.toRenderColor(m?null:f.getLut(s.scope)).toArray01Linear().slice(0,3),Z*b),r.cf([K[0]>0?K[0]/(K[0]+ne[0]):0,K[1]>0?K[1]/(K[1]+ne[1]):0,K[2]>0?K[2]/(K[2]+ne[2]):0])}function A_(f,i,s,m,x,b){const T=f.zoom,P=f.scale,N=f.worldSize,V=1/N,q=f.aspect,Z=Math.sqrt(1+q*q)*Math.tan(.5*f.fovX),K=Z*Z,ne=m-s,fe=m+s;let ue,ve;K>ne/fe?(ue=m,ve=m*Z):(ue=.5*fe*(1+K),ve=.5*Math.sqrt(ne*ne+2*(m*m+s*s)*K+fe*fe*K*K));const ge=f.projection.pixelsPerMeter(f.center.lat,N),Ce=f._camera.getCameraToWorldMercator(),ze=[0,0,-ue*V];r.ab.vec3.transformMat4(ze,ze,Ce);let Le=ve*V;const qe=f._edgeInsets;if(!(qe.left===0&&qe.top===0&&qe.right===0&&qe.bottom===0||qe.left===qe.right&&qe.top===qe.bottom)){const dn=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?ge:1),Zt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,s,m);Zt[8]=2*-f.centerOffset.x/f.width,Zt[9]=2*f.centerOffset.y/f.height;const Gt=new Float64Array(16);r.ab.mat4.mul(Gt,Zt,dn);const rn=new Float64Array(16);r.ab.mat4.invert(rn,Gt);const mn=r.bR.fromInvProjectionMatrix(rn,N,T,!0);for(const Cn of mn.points){const zn=((Ne=Cn)[0]/=P,Ne[1]/=P,Ne[2]=r.bH(Ne[2],f._center.lat),Ne);Le=Math.max(Le,r.ab.vec3.len(r.ab.vec3.subtract([],ze,zn)))}}var Ne;Le*=x/(x-1);const Ge=Math.acos(i[2]),Be=Math.atan2(-i[0],-i[1]),Ke=new xo;Ke.position=ze,Ke.setPitchBearing(Ge,Be);const it=Ke.getWorldToCamera(N,ge),Rt=Le*N,xt=Math.min(f._mercatorZfromZoom(17)*N*-2,-2*Rt),jt=Ke.getCameraToClipOrthographic(-Rt,Rt,-Rt,Rt,xt,(Rt+b*ge)/i[2]),zt=new Float64Array(16);r.ab.mat4.multiply(zt,jt,it);const pt=r.ab.vec3.fromValues(Math.floor(1e6*ze[0])/1e6*N,Math.floor(1e6*ze[1])/1e6*N,0),Dt=.5*x,tn=[0,0,0];r.ab.vec3.transformMat4(tn,pt,zt),r.ab.vec3.scale(tn,tn,Dt);const dt=[Math.floor(tn[0]),Math.floor(tn[1]),Math.floor(tn[2])],Ut=[0,0,0];r.ab.vec3.sub(Ut,tn,dt),r.ab.vec3.scale(Ut,Ut,-1/Dt);const Pt=new Float64Array(16);return r.ab.mat4.identity(Pt),r.ab.mat4.translate(Pt,Pt,Ut),r.ab.mat4.multiply(zt,Pt,zt),[zt,Rt]}class dp extends r.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(i,s){return r.aM(this.requestManager.transformRequest(s,r.R.Model).url).then(m=>{if(!m)return;const x=r.aN(m),b=new r.aO(i,void 0,void 0,x);return b.computeBoundsAndApplyParent(),b}).catch(m=>{if(m&&m.status===404)return null;this.fire(new r.y(new Error(`Could not load model ${i} from ${s}: ${m.message}`)))})}load(i,s,m={keepNumReferences:!1}){this.models[s]||(this.models[s]={});const x=Object.keys(i);this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+x.length;const b=[];for(const T of x)b.push(this.loadModel(T,i[T]));Promise.allSettled(b).then(T=>{for(let P=0;P<T.length;P++){const{status:N,value:V}=T[P];if(N==="fulfilled"&&V){const q=this.models[s][x[P]];this.models[s][x[P]]={model:V,numReferences:m.keepNumReferences&&q?q.numReferences:1}}}this.numModelsLoading[s]-=x.length,this.fire(new r.z("data",{dataType:"style"}))}).catch(T=>{this.fire(new r.y(new Error(`Could not load models: ${T.message}`)))})}isLoaded(){for(const i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,s){return!!this.getModel(i,s)}getModel(i,s){return this.models[s]||(this.models[s]={}),this.models[s][i]?this.models[s][i].model:void 0}addModel(i,s,m){this.models[m]||(this.models[m]={}),this.modelUris[m]||(this.modelUris[m]={}),this.hasModel(i,m)&&this.models[m][i].numReferences++,this.modelUris[m][i]=this.requestManager.normalizeModelURL(s),this.load({[i]:this.modelUris[m][i]},m)}addModels(i,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const m=this.modelUris[s];for(const x in i)this.models[s][x]={},m[x]=this.requestManager.normalizeModelURL(i[x]);this.load(m,s,{keepNumReferences:!0})}reloadModels(i){this.load(this.modelUris[i],i)}addModelsFromBucket(i,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const m={};for(const x of i)this.hasModel(x,s)?this.models[s][x].numReferences++:(this.modelUris[s][x]=this.requestManager.normalizeModelURL(x),m[x]=this.modelUris[s][x]);this.load(m,s)}removeModel(i,s){if(this.models[s]&&this.models[s][i]&&(this.models[s][i].numReferences--,this.models[s][i].numReferences===0)){const m=this.models[s][i].model;delete this.models[s][i],delete this.modelUris[s][i],m.destroy()}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,s){this.models[s]||(this.models[s]={});for(const m in this.models[s])this.models[s][m].model&&this.models[s][m].model.upload(i.context)}}const $m=new r.a5({data:new r.a6(r.a3.colorTheme.data)}),C_={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Xm(f){return f=f||{},Object.assign(f,C_)}class Tc extends r.E{constructor(i){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},r.aP(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=i,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(i=>{i.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new r.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=i.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=i.stylesheet.indoor.buildingFeaturesetId,this._scope=i.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:i=>(i.feature&&i.feature.properties.floorplan&&this.selectFloorplan(i.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(i){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(T,P){const[N,V]=T,{center:q,radius:Z}=P,[K,ne]=q,fe=Math.abs(N-K);return Math.sqrt((fe>180?360-fe:fe)**2+(V-ne)**2)<=Z}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new r.z("floorplangone")));const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},m=new r.P(this._map.transform.width/2,this._map.transform.height/2),x=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],b=this._map.queryRenderedFeatures(i?x:m,s);b.length>0&&(this._selectedFloorplan&&b[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=b[0],this._floorplanSelected(!1)))}_floorplanSelected(i){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(b){const[[T,P],[N,V]]=b,q=(N-T+360)%360,Z=q>180?360-q:q;return{center:[(T+Z/2+360)%360,(P+V)/2],radius:Math.sqrt(Z**2+(V-P)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const s=this._floorplanStates[this._indoorData.id].selectedBuilding,m=this._floorplanStates[this._indoorData.id].selectedLevel;let x;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const b of this._indoorData.levels)b.id===this._selectedLevel.id&&(x=b.id);if(this.fire(new r.z("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:x})),s){const b=this._indoorData.buildings.find(T=>T.id===s);this._buildingSelected(b,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(m){const b=this._indoorData.levels.find(T=>T.id===m);this._updateLevels(b,i)}else i&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(i,s){s&&i&&i.extent&&this._map.fitBounds(i.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=i?i.id:void 0;const m=this._indoorData.levels.filter(x=>i.levels.includes(x.id));this.fire(new r.z("buildingselected",{buildingId:i.id,levels:m}))}_levelSelected(i){if(i==="overview")this._updateLevels(void 0,!0);else{const s=this._indoorData.levels.find(m=>m.id===i);this._updateLevels(s,!0)}this.fire(new r.z("levelselected",{levelId:i==="overview"?void 0:i}))}_updateLevels(i,s){if(!i)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(s&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function m(V){const q=V.indexOf("/floor/");if(q===-1)return V;const Z=q+7,K=V.indexOf("/",Z);return K===-1?V.slice(Z):V.slice(Z,K)}this._selectedLevel=i,this._floorplanStates[this._indoorData.id].selectedLevel=i?i.id:void 0;const x=[],b={},T={},P={},N={};for(const V of this._indoorData.levels)if(x.push(V.id),b[V.id]=V.height,T[V.id]=V.base,i){if(this.mergeFloors){const q=m(i.id),Z=m(V.id);P[V.id]=Z===q?"true":"false"}else P[V.id]=V.id===i.id?"true":"false";N[V.id]=V.base<i.base?"true":"false"}else N[V.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",x]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",b]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",T]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",P]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",N]),i&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!i.isUnderground),s&&i.extent)){const V=this._map.cameraForBounds(i.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),q=this._map.getZoom(),Z=V.zoom?Math.abs(q-V.zoom):0;this._map.fitBounds(i.extent,Z>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:q})}}selectFloorplan(i){const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},m=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],x=this._map.queryRenderedFeatures(m,s);if(x.length>0){for(const b of x)if(JSON.parse(b.properties["indoor-data"]).floorplanIDs.includes(i)){this._selectedFloorplan=b,this._floorplanSelected(!0);break}}}selectBuilding(i){const s=this._indoorData.buildings.find(m=>m.id===i);this._buildingSelected(s,!0)}selectLevel(i){this._levelSelected(i)}}function Zm(f){if(!f.metadata||!f.metadata.content_area)return;const i=r.q.devicePixelRatio,{left:s,top:m,width:x,height:b}=f.metadata.content_area,T=s*i,P=m*i;return[T,P,T+x*i,P+b*i]}function wh(f){if(f)return f.map(([i,s])=>[i*r.q.devicePixelRatio,s*r.q.devicePixelRatio])}const Gl=(f,i)=>Xo(f,i&&i.filter(s=>s.identifier!=="source.canvas")),R_=r.ay(Bi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),Ac=r.ay(Bi,["setCenter","setZoom","setBearing","setPitch"]),Cc=new Set(["background","sky","slot","custom"]),xu={version:8,layers:[],sources:{}},Ym={duration:300,delay:0};class lo extends r.E{constructor(i,s={}){super(),this.map=i,this.scope=s.scope||"",this.globalId=null,this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=r.l({},Ym),this._buildingIndex=new _u(this),this.crossTileSymbolIndex=new sp,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=s.styleChanges||new qn,this.dispatcher=s.dispatcher?s.dispatcher:new r.D(r.ci(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new Fi(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new r.cj(i._requestManager,s.localFontFamily?r.ck.all:s.localIdeographFontFamily?r.ck.ideographs:r.ck.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new dp(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._config=s.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:s.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=s.initialConfig,this.dispatcher.broadcast("setReferrer",r.cl());const m=this;this._rtlTextPluginCallback=lo.registerForPluginStateChange(x=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(b,T)=>{if(r.cm(b),T&&T.every(P=>P))for(const P in m._sourceCaches){const N=m._sourceCaches[P],V=N.getSource().type;V!=="vector"&&V!=="geojson"||N.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const b=this.getOwnSource(x.sourceId);if(b&&b.vectorLayerIds)for(const T in this._layers){const P=this._layers[T];P.source===b.id&&this._validateLayer(P)}})}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(r.f(i))return i;const s=r.cn(i);if(!s.startsWith("http"))try{return new URL(s,location.href).toString()}catch{return s}return s}return`json://${r.co(JSON.stringify(i))}`}_diffStyle(i,s,m){this.globalId=this._getGlobalId(i);const x=(b,T)=>{try{T(null,this.setState(b,m))}catch(P){T(P,!1)}};if(typeof i=="string"){const b=this.map._requestManager.normalizeStyleURL(i),T=this.map._requestManager.transformRequest(b,r.R.Style);r.n(T,(P,N)=>{P?this.fire(new r.y(P)):N&&x(N,s)})}else typeof i=="object"&&x(i,s)}loadURL(i,s={}){this.fire(new r.z("dataloading",{dataType:"style"}));const m=typeof s.validate=="boolean"?s.validate:!r.f(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,s.accessToken),this.resolvedImports.add(i);const x=this.importsCache.get(i);if(x)return this._load(x,m);const b=this.map._requestManager.transformRequest(i,r.R.Style);this._request=r.n(b,(T,P)=>{if(this._request=null,T)this.fire(new r.y(T));else if(P)return this.importsCache.set(i,P),this._load(P,m)})}loadJSON(i,s={}){this.fire(new r.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=r.q.frame(()=>{this._request=null,this._load(i,s.validate!==!1)})}loadEmpty(){this.fire(new r.z("dataloading",{dataType:"style"})),this._load(xu,!1)}_loadImports(i,s,m){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const b of i){const T=this._createFragmentStyle(b),P=new Promise(q=>{T.once("style.import.load",q),T.once("error",q)}).then(()=>this.mergeAll());if(x.push(P),this.resolvedImports.has(b.url)){T.loadEmpty();continue}const N=b.data||this.importsCache.get(b.url);N?(T.loadJSON(N,{validate:s}),this._isInternalStyle(N)&&(T.globalId=null)):b.url?T.loadURL(b.url,{validate:s}):T.loadEmpty();const V={style:T,id:b.id,config:b.config};if(m){const q=this.fragments.findIndex(({id:Z})=>Z===m);this.fragments=this.fragments.slice(0,q).concat(V).concat(this.fragments.slice(q))}else this.fragments.push(V)}return Promise.allSettled(x)}getImportGlobalIds(i=this,s=new Set){for(const m of i.fragments)m.style.globalId&&s.add(m.style.globalId),this.getImportGlobalIds(m.style,s);return[...s.values()]}_createFragmentStyle(i){const s=this.scope?r.aC(i.id,this.scope):i.id;let m;const x=this._initialConfig&&this._initialConfig[s];(i.config||x)&&(m=r.l({},i.config,x));const b=new lo(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:m,configOptions:this.options,colorThemeOverride:i["color-theme"],configDependentLayers:this._configDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,s){const m=i.indoor?Xm(i.schema):i.schema;if(this._isInternalStyle(i)){const T=r.l({},xu,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(T,s)}if(this.updateConfig(this._config,m),s&&Gl(this,on(i)))return;this._loaded=!0,this.stylesheet=r.cp(i);const x=()=>{for(const V in i.sources)this.addSource(V,i.sources[V],{validate:!1,isInitialLoad:!0});i.sprite?this._loadIconset(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(i.glyphs,this.scope);const T=Pd(this.stylesheet.layers);if(this._order=T.map(V=>V.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const V=this.stylesheet.lights[0];this.light=new he(V.properties,V.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new he(this.stylesheet.light)),this._layers={};for(const V of T){const q=r.cu(V,this.scope,this._styleColorTheme.lut,this.options);q.configDependencies.size!==0&&this._configDependentLayers.add(q.fqid),q.setEventedParent(this,{layer:{id:q.id}}),this._layers[q.id]=q;const Z=this.getOwnLayerSourceCache(q),K=!!this.directionalLight&&this.directionalLight.shadowsEnabled();Z&&q.canCastShadows()&&K&&(Z.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const P=this.stylesheet.terrain;P&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(P,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.z("data",{dataType:"style"}));const N=this.isRootStyle();i.imports?this._loadImports(i.imports,s).then(()=>{this._reloadImports(),this.fire(new r.z(N?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.z(N?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const b=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(b){const T=this._evaluateColorThemeData(b);this._loadColorTheme(T).then(()=>{x()}).catch(P=>{r.w(`Couldn't load color theme from the stylesheet: ${P}`),x()})}else this._styleColorTheme.lut=null,x()}isRootStyle(){return this.importDepth===0}mergeAll(){let i,s,m,x,b,T,P,N,V,q;const Z={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(K=>{if(K.stylesheet){if(K.light!=null&&(i=K.light),K.stylesheet.lights)for(const ne of K.stylesheet.lights)ne.type==="ambient"&&K.ambientLight!=null&&(s=K.ambientLight),ne.type==="directional"&&K.directionalLight!=null&&(m=K.directionalLight);x=this._prioritizeTerrain(x,K.terrain,K.stylesheet.terrain),K.stylesheet.fog&&K.fog!=null&&(b=K.fog),K.stylesheet.snow&&K.snow!=null&&(T=K.snow),K.stylesheet.rain&&K.rain!=null&&(P=K.rain),K.stylesheet.camera!=null&&(q=K.stylesheet.camera),K.stylesheet.projection!=null&&(N=K.stylesheet.projection),K.stylesheet.transition!=null&&(V=K.stylesheet.transition),Z[K.scope]=K._styleColorTheme}}),this.light=i,this.ambientLight=s,this.directionalLight=m,this.fog=b,this.snow=T,this.rain=P,this._styleColorThemeForScope=Z,x===null?delete this.terrain:this.terrain=x,this.camera=q||{"camera-projection":"perspective"},this.projection=N||{name:"mercator"},this.transition=r.l({},Ym,V),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){const s=m=>{for(const x of m.fragments)s(x.style);i(m)};s(this)}_prioritizeTerrain(i,s,m){const x=i&&i.drapeRenderMode===0;return m===null?s&&s.drapeRenderMode===0?s:x?i:null:s!=null&&(!i||x||s&&s.drapeRenderMode===1)?s:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(s=>{i=this._prioritizeTerrain(i,s.terrain,s.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(s=>{s.stylesheet.projection!=null&&(i=s.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){const i={},s={},m={};this.forEachFragmentStyle(x=>{for(const b in x._sourceCaches){const T=r.aC(b,x.scope);i[T]=x._sourceCaches[b]}for(const b in x._otherSourceCaches){const T=r.aC(b,x.scope);s[T]=x._otherSourceCaches[b]}for(const b in x._symbolSourceCaches){const T=r.aC(b,x.scope);m[T]=x._symbolSourceCaches[b]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=m}mergeLayers(){const i={},s=[],m={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(b=>{for(const T of b._order){const P=b._layers[T];if(P.type==="slot"){const N=r.cq(T);if(i[N])continue;i[N]=[]}P.slot&&i[P.slot]?i[P.slot].push(P):s.push(P)}}),this._mergedOrder=[];const x=(b=[])=>{for(const T of b)if(T.type==="slot"){const P=r.cq(T.id);i[P]&&x(i[P]),this._mergedSlots.push(P)}else{const P=r.aC(T.id,T.scope);this._mergedOrder.push(P),m[P]=T,T.is3D()&&(this._has3DLayers=!0),T.type==="circle"&&(this._hasCircleLayers=!0),T.type==="symbol"&&(this._hasSymbolLayers=!0),T.type==="clip"&&(this._clipLayerPresent=!0)}};x(s),this._mergedOrder.sort((b,T)=>{const P=m[b],N=m[T];return P.hasInitialOcclusionOpacityProperties?N.is3D()?1:0:P.is3D()&&N.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=m,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=r.l({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(i){return i.data?function(s,m,x){const b=r.l({},m);for(const P of Object.keys(r.a3.colorTheme))b[P]===void 0&&(b[P]=r.a3.colorTheme[P].default);const T=new r.a4($m,s,new Map(x));return T.setTransitionOrValue(b,x),T.untransitioned().possiblyEvaluate(new r.a8(0))}(this.scope,i,this.options).get("data"):null}_loadColorTheme(i){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const s=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((m,x)=>{const b="data:image/png;base64,";if(!i||i.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void m();let T=i;T.startsWith(b)||(T=b+T);const P="mapbox-reserved-lut",N=new Image;N.src=T,N.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},N.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==s)return void m();this._styleColorTheme.lutLoading=!1;const{width:V,height:q,data:Z}=r.q.getImageData(N);if(q>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(V!==q*q)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(P)&&this.removeImage(P),this.addImage(P,{data:new r.r({width:V,height:q},Z),pixelRatio:1,sdf:!1,usvg:!1,version:0});const K=this.imageManager.getImage(P,this.scope);K?(this._styleColorTheme.lut={image:K.data,data:i},m()):x(new Error("Missing LUT image."))}})}getLut(i){const s=this._styleColorThemeForScope[i];return s?s.lut:null}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(s,m,x){let b,T,P;const N=r.q.devicePixelRatio>1?"@2x":"";let V=r.n(m.transformRequest(m.normalizeSpriteURL(s,N,".json"),r.R.SpriteJSON),(K,ne)=>{V=null,P||(P=K,b=ne,Z())}),q=r.o(m.transformRequest(m.normalizeSpriteURL(s,N,".png"),r.R.SpriteImage),(K,ne)=>{q=null,P||(P=K,T=ne,Z())});function Z(){if(P)x(P);else if(b&&T){const K=r.q.getImageData(T),ne={};for(const fe in b){const{width:ue,height:ve,x:ge,y:Ce,sdf:ze,pixelRatio:Le,stretchX:qe,stretchY:Ne,content:Ge}=b[fe],Be=new r.r({width:ue,height:ve});r.r.copy(K,Be,{x:ge,y:Ce},{x:0,y:0},{width:ue,height:ve},null),ne[fe]={data:Be,pixelRatio:Le,sdf:ze,stretchX:qe,stretchY:Ne,content:Ge,usvg:!1}}x(null,ne)}}return{cancel(){V&&(V.cancel(),V=null),q&&(q.cancel(),q=null)}}}(i,this.map._requestManager,(s,m)=>{if(this._spriteRequest=null,s)this.fire(new r.y(s));else if(m)for(const x in m)this.imageManager.addImage(x,this.scope,m[x]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))})}_loadIconset(i){if(!r.f(i)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(i);const s=this.map._spriteFormat==="auto";var m,x;this._spriteRequest=(x=(b,T)=>{if(this._spriteRequest=null,b)s?this._loadSprite(i):this.fire(new r.y(b));else if(T)for(const P in T)this.imageManager.addImage(P,this.scope,T[P]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))},r.bi((m=this.map._requestManager).transformRequest(m.normalizeIconsetURL(i),r.R.Iconset),(b,T)=>{if(b)return void x(b);const P={},N=r.cg(new r.bh(T));for(const V of N.icons){const q={version:1,pixelRatio:r.q.devicePixelRatio,content:Zm(V),stretchX:V.metadata?wh(V.metadata.stretch_x_areas):void 0,stretchY:V.metadata?wh(V.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:V};P[V.name]=q}x(null,P)}))}_validateLayer(i){const s=this.getOwnSource(i.source);if(!s)return;const m=i.sourceLayer;m&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(m)===-1)&&this.fire(new r.y(new Error(`Source layer "${m}" does not exist on source "${s.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,s)=>{const m=this.fragments[s];return m&&m.style&&(i.data=m.style.serialize()),i})}_serializeSources(){const i={};for(const s in this._sourceCaches){const m=this._sourceCaches[s].getSource();i[m.id]||(i[m.id]=m.serialize())}return i}_serializeLayers(i){const s=[];for(const m of i){const x=this._layers[m];x&&x.type!=="custom"&&s.push(x.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(i){return i?this.order:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){const s=this.getOwnLayer(i);if(s)return s;this.fire(new r.y(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){const s=this.getOwnSource(i);if(s)return s;this.fire(new r.y(new Error(`The source '${i}' does not exist in the map's style.`)))}precompilePrograms(i,s){const m=this.map.painter;if(m)for(let x=i.minzoom||0;x<(i.maxzoom||25.5);x++){const b=i.getProgramIds();if(b)for(const T of b){const P=i.getDefaultProgramParams(T,s.zoom,this._styleColorTheme.lut);P&&(m.style=this,this.fog&&(m._fogVisible=!0,P.overrideFog=!0,m.getOrCreateProgram(T,P)),m._fogVisible=!1,P.overrideFog=!1,m.getOrCreateProgram(T,P),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(P.overrideRtt=!0,m.getOrCreateProgram(T,P)))}}}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);const s=this.calculateLightsBrightness();i.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s));const m=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const T=this._changes.getLayerUpdatesByScope();for(const P in T){const{updatedIds:N,removedIds:V}=T[P];(N||V)&&(this._updateWorkerLayers(P,N,V),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this.snow&&this.snow.updateTransitions(i),this.rain&&this.rain.updateTransitions(i),this._changes.reset()}const b={};for(const T in this._mergedSourceCaches){const P=this._mergedSourceCaches[T];b[T]=P.used,P.used=!1,P.tileCoverLift=0}for(const T of this._mergedOrder){const P=this._mergedLayers[T];if(P.recalculate(i,this._availableImages),!P.isHidden(i.zoom)){const N=this.getLayerSourceCache(P);N&&(N.used=!0,N.tileCoverLift=Math.max(N.tileCoverLift,P.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(P,i)}):this.precompilePrograms(P,i))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();for(const T in b){const P=this._mergedSourceCaches[T];b[T]!==P.used&&P.getSource().fire(new r.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:P.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.snow&&this.snow.recalculate(i),this.rain&&this.rain.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),m&&this.fire(new r.z("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=this._changes.getUpdatedImages();if(i.length){for(const s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],i);this._changes.resetUpdatedImages()}}_updateWorkerLayers(i,s,m){const x=this.getFragmentStyle(i);x&&this.dispatcher.broadcast("updateLayers",{layers:s?x._serializeLayers(s):[],scope:i,removedIds:m||[],options:x.options})}setState(i,s){if(this._checkLoaded(),Gl(this,on(i)))return!1;(i=r.cp(i)).layers=Pd(i.layers);const m=function(T,P){if(!T)return[{command:Bi.setStyle,args:[P]}];let N=[];try{if(!r.bn(T.version,P.version))return[{command:Bi.setStyle,args:[P]}];if(r.bn(T.center,P.center)||N.push({command:Bi.setCenter,args:[P.center]}),r.bn(T.zoom,P.zoom)||N.push({command:Bi.setZoom,args:[P.zoom]}),r.bn(T.bearing,P.bearing)||N.push({command:Bi.setBearing,args:[P.bearing]}),r.bn(T.pitch,P.pitch)||N.push({command:Bi.setPitch,args:[P.pitch]}),r.bn(T.sprite,P.sprite)||N.push({command:Bi.setSprite,args:[P.sprite]}),r.bn(T.glyphs,P.glyphs)||N.push({command:Bi.setGlyphs,args:[P.glyphs]}),r.bn(T.imports,P.imports)||function(ne=[],fe=[],ue){fe=fe||[];const ve=(ne=ne||[]).map(Wa),ge=fe.map(Wa),Ce=ne.reduce(Es,{}),ze=fe.reduce(Es,{}),Le=ve.slice();let qe,Ne,Ge,Be;for(qe=0,Ne=0;qe<ve.length;qe++)Ge=ve[qe],ze.hasOwnProperty(Ge)?Ne++:(ue.push({command:Bi.removeImport,args:[Ge]}),Le.splice(Le.indexOf(Ge,Ne),1));for(qe=0,Ne=0;qe<ge.length;qe++)Ge=ge[ge.length-1-qe],Le[Le.length-1-qe]!==Ge&&(Ce.hasOwnProperty(Ge)?(ue.push({command:Bi.removeImport,args:[Ge]}),Le.splice(Le.lastIndexOf(Ge,Le.length-Ne),1)):Ne++,Be=Le[Le.length-qe],ue.push({command:Bi.addImport,args:[ze[Ge],Be]}),Le.splice(Le.length-qe,0,Ge));for(const Ke of fe){const it=Ce[Ke.id];it&&!r.bn(it,Ke)&&ue.push({command:Bi.updateImport,args:[Ke.id,Ke]})}}(T.imports,P.imports,N),r.bn(T.transition,P.transition)||N.push({command:Bi.setTransition,args:[P.transition]}),r.bn(T.light,P.light)||N.push({command:Bi.setLight,args:[P.light]}),r.bn(T.fog,P.fog)||N.push({command:Bi.setFog,args:[P.fog]}),r.bn(T.snow,P.snow)||N.push({command:Bi.setSnow,args:[P.snow]}),r.bn(T.rain,P.rain)||N.push({command:Bi.setRain,args:[P.rain]}),r.bn(T.projection,P.projection)||N.push({command:Bi.setProjection,args:[P.projection]}),r.bn(T.lights,P.lights)||N.push({command:Bi.setLights,args:[P.lights]}),r.bn(T.camera,P.camera)||N.push({command:Bi.setCamera,args:[P.camera]}),!r.bn(T["color-theme"],P["color-theme"]))return[{command:Bi.setStyle,args:[P]}];const V={},q=[];(function(ne,fe,ue,ve){let ge;for(ge in fe=fe||{},ne=ne||{})ne.hasOwnProperty(ge)&&(fe.hasOwnProperty(ge)||qs(ge,ue,ve));for(ge in fe){if(!fe.hasOwnProperty(ge))continue;const Ce=fe[ge];ne.hasOwnProperty(ge)?r.bn(ne[ge],Ce)||(ne[ge].type==="geojson"&&Ce.type==="geojson"&&ir(ne,fe,ge)?ue.push({command:Bi.setGeoJSONSourceData,args:[ge,Ce.data]}):Nn(ge,fe,ue,ve)):Ld(ge,fe,ue)}})(T.sources,P.sources,q,V);const Z=[];T.layers&&T.layers.forEach(ne=>{ne.source&&V[ne.source]?N.push({command:Bi.removeLayer,args:[ne.id]}):Z.push(ne)});let K=T.terrain;K&&V[K.source]&&(N.push({command:Bi.setTerrain,args:[void 0]}),K=void 0),N=N.concat(q),r.bn(K,P.terrain)||N.push({command:Bi.setTerrain,args:[P.terrain]}),function(ne,fe,ue){fe=fe||[];const ve=(ne=ne||[]).map(Wa),ge=fe.map(Wa),Ce=ne.reduce(Es,{}),ze=fe.reduce(Es,{}),Le=ve.slice(),qe=Object.create(null);let Ne,Ge,Be,Ke,it,Rt,xt;for(Ne=0,Ge=0;Ne<ve.length;Ne++)Be=ve[Ne],ze.hasOwnProperty(Be)?Ge++:(ue.push({command:Bi.removeLayer,args:[Be]}),Le.splice(Le.indexOf(Be,Ge),1));for(Ne=0,Ge=0;Ne<ge.length;Ne++)Be=ge[ge.length-1-Ne],Le[Le.length-1-Ne]!==Be&&(Ce.hasOwnProperty(Be)?(ue.push({command:Bi.removeLayer,args:[Be]}),Le.splice(Le.lastIndexOf(Be,Le.length-Ge),1)):Ge++,Rt=Le[Le.length-Ne],ue.push({command:Bi.addLayer,args:[ze[Be],Rt]}),Le.splice(Le.length-Ne,0,Be),qe[Be]=!0);for(Ne=0;Ne<ge.length;Ne++)if(Be=ge[Ne],Ke=Ce[Be],it=ze[Be],!qe[Be]&&!r.bn(Ke,it))if(r.bn(Ke.source,it.source)&&r.bn(Ke["source-layer"],it["source-layer"])&&r.bn(Ke.type,it.type)){for(xt in Gi(Ke.layout,it.layout,ue,Be,null,Bi.setLayoutProperty),Gi(Ke.paint,it.paint,ue,Be,null,Bi.setPaintProperty),r.bn(Ke.slot,it.slot)||ue.push({command:Bi.setSlot,args:[Be,it.slot]}),r.bn(Ke.filter,it.filter)||ue.push({command:Bi.setFilter,args:[Be,it.filter]}),r.bn(Ke.minzoom,it.minzoom)&&r.bn(Ke.maxzoom,it.maxzoom)||ue.push({command:Bi.setLayerZoomRange,args:[Be,it.minzoom,it.maxzoom]}),Ke)Ke.hasOwnProperty(xt)&&xt!=="layout"&&xt!=="paint"&&xt!=="filter"&&xt!=="metadata"&&xt!=="minzoom"&&xt!=="maxzoom"&&xt!=="slot"&&(xt.indexOf("paint.")===0?Gi(Ke[xt],it[xt],ue,Be,xt.slice(6),Bi.setPaintProperty):r.bn(Ke[xt],it[xt])||ue.push({command:Bi.setLayerProperty,args:[Be,xt,it[xt]]}));for(xt in it)it.hasOwnProperty(xt)&&!Ke.hasOwnProperty(xt)&&xt!=="layout"&&xt!=="paint"&&xt!=="filter"&&xt!=="metadata"&&xt!=="minzoom"&&xt!=="maxzoom"&&xt!=="slot"&&(xt.indexOf("paint.")===0?Gi(Ke[xt],it[xt],ue,Be,xt.slice(6),Bi.setPaintProperty):r.bn(Ke[xt],it[xt])||ue.push({command:Bi.setLayerProperty,args:[Be,xt,it[xt]]}))}else ue.push({command:Bi.removeLayer,args:[Be]}),Rt=Le[Le.lastIndexOf(Be)+1],ue.push({command:Bi.addLayer,args:[it,Rt]})}(Z,P.layers,N)}catch(V){console.warn("Unable to compute style diff:",V),N=[{command:Bi.setStyle,args:[P]}]}return N}(this.serialize(),i).filter(T=>!(T.command in Ac));if(m.length===0)return!1;const x=m.filter(T=>!(T.command in R_));if(x.length>0)throw new Error(`Unimplemented: ${x.map(T=>T.command).join(", ")}.`);const b=[];return m.forEach(T=>{b.push(this[T.command].apply(this,T.args))}),s&&Promise.all(b).then(s),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(i,s){return this.getImage(i)?this.fire(new r.y(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,this.scope,s),this._afterImageUpdated(i),this)}updateImage(i,s,m=!1){this.imageManager.updateImage(i,this.scope,s),m&&this._afterImageUpdated(i)}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._afterImageUpdated(i),this):this.fire(new r.y(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(i),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.z("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(i,s,m={}){return this._checkLoaded(),this._validate($o,`models.${i}`,s,null,m)||(this.modelManager.addModel(i,s,this.scope),this._changes.setDirty()),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope),this):this.fire(new r.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,s,m={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(wn,`sources.${i}`,s,null,m))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const x=Ci(i,s,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const b=T=>{const P=(T?"symbol:":"other:")+x.id,N=r.aC(P,this.scope),V=this._sourceCaches[P]=new Ss(N,x,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=V,V.onAdd(this.map)};b(!1),s.type!=="vector"&&s.type!=="geojson"||b(!0),x.onAdd&&x.onAdd(this.map),m.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();const s=this.getOwnSource(i);if(!s)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===i)return this.fire(new r.y(new Error(`Source "${i}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new r.y(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const m=this.getOwnSourceCaches(i);for(const x of m){const b=r.cq(x.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(x.id),x.fire(new r.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,s){this._checkLoaded(),this.getOwnSource(i).setData(s),this._changes.setDirty()}getOwnSource(i){const s=this.getOwnSourceCache(i);return s&&s.getSource()}getOwnSources(){const i=[];for(const s in this._otherSourceCaches){const m=this.getOwnSourceCache(s);m&&i.push(m.getSource())}return i}areTilesLoaded(){const i=this._mergedSourceCaches;for(const s in i){const m=i[s]._tiles;for(const x in m){const b=m[x];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;const s=this._getTransitionParameters();for(const x of i){if(this._validate(ti,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){const b=this.ambientLight;b.set(x),b.updateTransitions(s)}else this.ambientLight=new qt(x,Ze||(Ze=new r.a5({color:new r.a6(r.a3.properties_light_ambient.color),"color-use-theme":new r.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a6(r.a3.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const b=this.directionalLight;b.set(x),b.updateTransitions(s)}else this.directionalLight=new qt(x,at||(at=new r.a5({direction:new r.ak(r.a3.properties_light_directional.direction),color:new r.a6(r.a3.properties_light_directional.color),"color-use-theme":new r.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a6(r.a3.properties_light_directional.intensity),"cast-shadows":new r.a6(r.a3.properties_light_directional["cast-shadows"]),"shadow-quality":new r.a6(r.a3.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.a6(r.a3.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const m=new r.a8(this.z||0,s);this.ambientLight&&this.ambientLight.recalculate(m),this.directionalLight&&this.directionalLight.recalculate(m),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const i=this.directionalLight,s=this.ambientLight;if(!i||!s)return;const m=K=>.2126*(K[0]<=.03928?K[0]/12.92:Math.pow((K[0]+.055)/1.055,2.4))+.7152*(K[1]<=.03928?K[1]/12.92:Math.pow((K[1]+.055)/1.055,2.4))+.0722*(K[2]<=.03928?K[2]/12.92:Math.pow((K[2]+.055)/1.055,2.4)),x=i.properties.get("color").toRenderColor(null).toArray01(),b=i.properties.get("intensity"),T=i.properties.get("direction"),P=1-r.cb(T.x,T.y,T.z)[2]/90,N=m(x)*b*P,V=s.properties.get("color").toRenderColor(null).toArray01(),q=s.properties.get("intensity"),Z=m(V)*q;return Number(((N+Z)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(!i)return this;if(r.cr(i)){const s=r.cs(i),m=this.fragments.find(({id:b})=>b===s);if(!m)throw new Error(`Style import '${i}' not found`);const x=r.cq(i);return m.style.getFragmentStyle(x)}{const s=this.fragments.find(({id:m})=>m===i);return s?s.style:void 0}}setFeaturesetSelectors(i){if(!i)return;const s={},m=(x,b="")=>`${x}::${b}`;this._featuresetSelectors={};for(const x in i){const b=this._featuresetSelectors[x]=[];for(const T of i[x].selectors){if(T.featureNamespace){const N=this.getOwnLayer(T.layer);if(!N){r.w(`Layer is undefined for selector: ${T.layer}`);continue}const V=m(N.source,N.sourceLayer);if(V in s&&s[V]!==T.featureNamespace){r.w(`"featureNamespace ${T.featureNamespace} of featureset ${x}'s selector is not associated to the same source, skip this selector`);continue}s[V]=T.featureNamespace}let P;if(T.properties)for(const N in T.properties){const V=r.U(T.properties[N]);V.result==="success"&&(P=P||{},P[N]=V.value)}b.push({layerId:T.layer,namespace:T.featureNamespace,properties:P,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(i){const s=this.getFragmentStyle(i);if(!s||!s.stylesheet.featuresets)return[];const m=[];for(const x in s.stylesheet.featuresets)m.push({featuresetId:x,importId:s.scope?s.scope:void 0});return m}getFeaturesetLayers(i,s){const m=this.getFragmentStyle(s),x=m.stylesheet.featuresets;if(!x||!x[i])return this.fire(new r.y(new Error(`The featureset '${i}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const T of x[i].selectors){const P=m.getOwnLayer(T.layer);P&&b.push(P)}return b}getConfigProperty(i,s){const m=this.getFragmentStyle(i);if(!m)return null;const x=r.aC(s,m.scope),b=m.options.get(x),T=b?b.value||b.default:null;return T?T.serialize():null}setConfigProperty(i,s,m){const x=this.getFragmentStyle(i);if(!x)return;const b=x.stylesheet.indoor?Xm(x.stylesheet.schema):x.stylesheet.schema;if(!b||!b[s])return;const T=r.U(m);if(T.result!=="success")return void Gl(this,T.value);const P=T.value.expression,N=r.aC(s,x.scope),V=x.options.get(N);if(!V)return;let q;const{minValue:Z,maxValue:K,stepValue:ne,type:fe,values:ue}=b[s],ve=r.U(b[s].default);ve.result==="success"&&(q=ve.value.expression),q?(this.options.set(N,Object.assign({},V,{value:P,default:q,minValue:Z,maxValue:K,stepValue:ne,type:fe,values:ue})),this.updateConfigDependencies(s)):this.fire(new r.y(new Error(`No schema defined for the config option "${s}" in the "${i}" fragment.`)))}getConfig(i){const s=this.getFragmentStyle(i);if(!s)return null;const m=s.stylesheet.schema;if(!m)return null;const x={};for(const b in m){const T=r.aC(b,s.scope),P=s.options.get(T),N=P?P.value||P.default:null;x[b]=N?N.serialize():null}return x}setConfig(i,s){const m=this.getFragmentStyle(i);m&&(m.updateConfig(s,m.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){const s=this.getFragmentStyle(i);return s?s.stylesheet.schema:null}setSchema(i,s){const m=this.getFragmentStyle(i);m&&(m.stylesheet.schema=s,m.updateConfig(m._config,s),this.updateConfigDependencies())}updateConfig(i,s){if(this._config=i,i||s)if(s)for(const m in s){let x,b;const T=r.U(s[m].default);if(T.result==="success"&&(x=T.value.expression),i&&i[m]!==void 0){const K=r.U(i[m]);K.result==="success"&&(b=K.value.expression)}const{minValue:P,maxValue:N,stepValue:V,type:q,values:Z}=s[m];if(x){const K=r.aC(m,this.scope);this.options.set(K,{default:x,value:b,minValue:P,maxValue:N,stepValue:V,type:q,values:Z})}else this.fire(new r.y(new Error(`No schema defined for config option "${m}".`)))}else this.fire(new r.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(i){for(const s of this._configDependentLayers){const m=this.getLayer(s);if(m){if(i&&!m.configDependencies.has(i))continue;m.possiblyEvaluateVisibility(),this._updateLayer(m)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(s=>{const m=s._styleColorTheme.colorThemeOverride?s._styleColorTheme.colorThemeOverride:s._styleColorTheme.colorTheme;if(m){const x=s._evaluateColorThemeData(m);(!s._styleColorTheme.lut&&x!==""||s._styleColorTheme.lut&&x!==s._styleColorTheme.lut.data)&&s.setColorTheme(m)}}),this._changes.setDirty()}addLayer(i,s,m={}){this._checkLoaded();const x=i.id;if(this._layers[x])return void this.fire(new r.y(new Error(`Layer with id "${x}" already exists on this map`)));let b;if(i.type==="custom"){if(Gl(this,r.ct(i)))return;b=r.cu(i,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof i.source=="object"&&(this.addSource(x,i.source),i=r.cp(i),i=r.l(i,{source:x})),this._validate(oo,`layers.${x}`,i,{arrayIndex:-1},m))return;b=r.cu(i,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:x}})}b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid);let T=this._order.length;if(s){const q=this._order.indexOf(s);if(q===-1)return void this.fire(new r.y(new Error(`Layer with id "${s}" does not exist on this map.`)));b.slot===this._layers[s].slot?T=q:r.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,x),this._layerOrderChanged=!0,this._layers[x]=b;const P=this.getOwnLayerSourceCache(b),N=!!this.directionalLight&&this.directionalLight.shadowsEnabled();P&&b.canCastShadows()&&N&&(P.castsShadows=!0);const V=this._changes.getRemovedLayer(b);if(V&&b.source&&P&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const q=r.aC(b.source,b.scope);V.type!==b.type?this._changes.updateSourceCache(q,"clear"):(this._changes.updateSourceCache(q,"reload"),P.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(i,s){this._checkLoaded();const m=this._checkLayer(i);if(!m||i===s)return;const x=this._order.indexOf(i);this._order.splice(x,1);let b=this._order.length;if(s){const T=this._order.indexOf(s);if(T===-1)return void this.fire(new r.y(new Error(`Layer with id "${s}" does not exist on this map.`)));m.slot===this._layers[s].slot?b=T:r.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();const s=this._checkLayer(i);if(!s)return;s.setEventedParent(null);const m=this._order.indexOf(i);this._order.splice(m,1),delete this._layers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._changes.removeLayer(s);const x=this.getOwnLayerSourceCache(s);if(x&&x.castsShadows){let b=!1;for(const T in this._layers)if(this._layers[T].source===s.source&&this._layers[T].canCastShadows()){b=!0;break}x.castsShadows=b}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(const s in this._layers)if(this._layers[s].type===i)return!0;return!1}setLayerZoomRange(i,s,m){this._checkLoaded();const x=this._checkLayer(i);x&&(x.minzoom===s&&x.maxzoom===m||(s!=null&&(x.minzoom=s),m!=null&&(x.maxzoom=m),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(i,s){this._checkLoaded();const m=this._checkLayer(i);m&&m.slot!==s&&(m.slot=s,this._updateLayer(m))}setFilter(i,s,m={}){this._checkLoaded();const x=this._checkLayer(i);if(x&&!r.bn(x.filter,s))return s==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(Sr,`layers.${x.id}.filter`,s,{layerType:x.type},m)||(x.filter=r.cp(s),this._updateLayer(x)))}getFilter(i){const s=this._checkLayer(i);if(s)return r.cp(s.filter)}setLayoutProperty(i,s,m,x={}){this._checkLoaded();const b=this._checkLayer(i);if(b&&!r.bn(b.getLayoutProperty(s),m)){if(m!=null&&(!x||x.validate!==!1)&&Gl(b,xc.call(on,{key:`layers.${i}.layout.${s}`,layerType:b.type,objectKey:s,value:m,styleSpec:r.a3,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(s,m),b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),this._updateLayer(b)}}getLayoutProperty(i,s){const m=this._checkLayer(i);if(m)return m.getLayoutProperty(s)}setPaintProperty(i,s,m,x={}){this._checkLoaded();const b=this._checkLayer(i);if(!b||r.bn(b.getPaintProperty(s),m)||m!=null&&(!x||x.validate!==!1)&&Gl(b,yc.call(on,{key:`layers.${i}.paint.${s}`,layerType:b.type,objectKey:s,value:m,styleSpec:r.a3})))return;const T=b.setPaintProperty(s,m);b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),T&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(i,s){const m=this._checkLayer(i);if(m)return m.getPaintProperty(s)}setFeatureState(i,s){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){const{featuresetId:N,importId:V}=i.target,q=this.getFragmentStyle(V),Z=q.getFeaturesetLayers(N);for(const{source:K,sourceLayer:ne}of Z)q.setFeatureState({id:i.id,source:K,sourceLayer:ne},s)}else if("layerId"in i.target){const{layerId:N}=i.target,V=this.getLayer(N);this.setFeatureState({id:i.id,source:V.source,sourceLayer:V.sourceLayer},s)}return}const m=i.source,x=i.sourceLayer,b=this._checkSource(m);if(!b)return;const T=b.type;if(T==="geojson"&&x)return void this.fire(new r.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!x)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided.")));const P=this.getOwnSourceCaches(m);for(const N of P)N.setFeatureState(x,i.id,s)}removeFeatureState(i,s){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){const{featuresetId:N,importId:V}=i.target,q=this.getFragmentStyle(V),Z=q.getFeaturesetLayers(N);for(const{source:K,sourceLayer:ne}of Z)q.removeFeatureState({id:i.id,source:K,sourceLayer:ne},s)}else if("layerId"in i.target){const{layerId:N}=i.target,V=this.getLayer(N);this.removeFeatureState({id:i.id,source:V.source,sourceLayer:V.sourceLayer},s)}return}const m=i.source,x=this._checkSource(m);if(!x)return;const b=x.type,T=b==="vector"?i.sourceLayer:void 0;if(b==="vector"&&!T)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new r.y(new Error("A feature id is required to remove its specific state property.")));const P=this.getOwnSourceCaches(m);for(const N of P)N.removeFeatureState(T,i.id,s)}getFeatureState(i){if(this._checkLoaded(),"target"in i){let b;if("featuresetId"in i.target){const{featuresetId:T,importId:P}=i.target,N=this.getFragmentStyle(P),V=N.getFeaturesetLayers(T);for(const{source:q,sourceLayer:Z}of V){const K=N.getFeatureState({id:i.id,source:q,sourceLayer:Z});if(K&&!b)b=K;else if(!r.bn(b,K))return void this.fire(new r.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in i.target){const{layerId:T}=i.target,P=this.getLayer(T);b=this.getFeatureState({id:i.id,source:P.source,sourceLayer:P.sourceLayer})}return b}const s=i.source,m=i.sourceLayer,x=this._checkSource(s);if(x){if(x.type!=="vector"||m)return i.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(s)[0].getFeatureState(m,i.id);this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=r.l({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return r.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const i=this.getTerrain(),s=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return r.cv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},m=>m!==void 0)}_updateFilteredLayers(i){for(const s of Object.values(this._mergedLayers))i(s)&&this._updateLayer(s)}_updateLayer(i){this._changes.updateLayer(i);const s=this.getLayerSourceCache(i),m=r.aC(i.source,i.scope),x=this._changes.getUpdatedSourceCaches();i.source&&!x[m]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(m,"reload"),s.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const s=P=>this._mergedLayers[P].is3D(),m=this.order,x={},b=[];for(let P=m.length-1;P>=0;P--){const N=m[P];if(s(N)){x[N]=P;for(const V of i){const q=V[N];if(q)for(const Z of q)b.push(Z)}}}b.sort((P,N)=>N.intersectionZ-P.intersectionZ);const T=[];for(let P=m.length-1;P>=0;P--){const N=m[P];if(s(N))for(let V=b.length-1;V>=0;V--){const q=b[V].feature;if(q.layer&&x[q.layer.id]<P)break;T.push(q),b.pop()}else for(const V of i){const q=V[N];if(q)for(const Z of q)T.push(Z.feature)}}return T}queryRenderedFeatures(i,s,m){let x;s&&!Array.isArray(s)&&s.filter&&(this._validate(Sr,"queryRenderedFeatures.filter",s.filter,null,s),x=r.aZ(s.filter));const b={},T=q=>{if(Cc.has(q.type))return;const Z=this.getOwnLayerSourceCache(q),K=b[Z.id]=b[Z.id]||{sourceCache:Z,layers:{},has3DLayers:!1};q.is3D()&&(K.has3DLayers=!0),K.layers[q.fqid]=K.layers[q.fqid]||{styleLayer:q,targets:[]},K.layers[q.fqid].targets.push({filter:x})};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new r.y(new Error("parameters.layers must be an Array."))),[];for(const q of s.layers){const Z=this._layers[q];if(!Z)return this.fire(new r.y(new Error(`The layer '${q}' does not exist in the map's style and cannot be queried for features.`))),[];T(Z)}}else for(const q in this._layers)T(this._layers[q]);const P=this._queryRenderedFeatures(i,b,m),N=this._flattenAndSortRenderedFeatures(P),V=[];for(const q of N)r.cs(q.layer.id)===this.scope&&V.push(q);return V}queryRenderedFeatureset(i,s,m){let x;s&&!Array.isArray(s)&&s.filter&&(this._validate(Sr,"queryRenderedFeatures.filter",s.filter,null,s),x=r.aZ(s.filter));const b="mock",T=[];if(s&&s.target)T.push(Object.assign({},s,{targetId:b,filter:x}));else{const q=this.getFeaturesetDescriptors();for(const Z of q)T.push({targetId:b,filter:x,target:Z});for(const{style:Z}of this.fragments){const K=Z.getFeaturesetDescriptors();for(const ne of K)T.push({targetId:b,filter:x,target:ne})}}const P=this.queryRenderedTargets(i,T,m),N=[],V=new Set;for(const q of P)for(const Z of q.variants[b])ia(Z,q,V)||N.push(new r.cw(q,Z));return N}queryRenderedTargets(i,s,m){const x={},b=(P,N,V,q)=>{const Z=x[N.id]=x[N.id]||{sourceCache:N,layers:{},has3DLayers:!1};if(Z.layers[P.fqid]=Z.layers[P.fqid]||{styleLayer:P,targets:[]},P.is3D()&&(Z.has3DLayers=!0),!q)return V.uniqueFeatureID=!1,void Z.layers[P.fqid].targets.push(V);Z.layers[P.fqid].targets.push(Object.assign({},V,{namespace:q.namespace,properties:q.properties,uniqueFeatureID:q.uniqueFeatureID}))};for(const P of s)if("featuresetId"in P.target){const{featuresetId:N,importId:V}=P.target,q=this.getFragmentStyle(V);if(!q||!q._featuresetSelectors)continue;const Z=q._featuresetSelectors[N];if(!Z){this.fire(new r.y(new Error(`The featureset '${N}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const K of Z){const ne=q.getOwnLayer(K.layerId);ne&&!Cc.has(ne.type)&&b(ne,q.getOwnLayerSourceCache(ne),P,K)}}else if("layerId"in P.target){const{layerId:N}=P.target,V=this.getLayer(N);if(!V||Cc.has(V.type))continue;b(V,this.getLayerSourceCache(V),P)}const T=this._queryRenderedFeatures(i,x,m);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(i,s,m){const x=[],b=!!this.map._showQueryGeometry,T=Jt.createFromScreenPoints(i,m);for(const P in s){const N=gr(T,s[P],this._availableImages,m,b);Object.keys(N).length&&x.push(N)}if(this.placement)for(const P in s){if(!s[P].sourceCache._onlySymbols)continue;const N=To(T.screenGeometry,s[P],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(N).length&&x.push(N)}return x}querySourceFeatures(i,s){const m=s&&s.filter;m&&this._validate(Sr,"querySourceFeatures.filter",m,null,s);let x=[];const b=this.getOwnSourceCaches(i);for(const T of b)x=x.concat(ws(T,s));return x}addSourceType(i,s,m){return lo.getSourceType(i)?m(new Error(`A source type called "${i}" already exists.`)):(lo.setSourceType(i,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:s.workerSourceURL},m):m(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,s,m={}){this._checkLoaded();const x=this.light.getLight();let b=!1;for(const P in i)if(!r.bn(i[P],x[P])){b=!0;break}if(!b)return;const T=this._getTransitionParameters();this.light.setLight(i,s,m),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(i,s=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),s===0&&delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let m=i;const x=i.source==null;if(s===1){if(this.disableElevatedTerrain)return;if(typeof m.source=="object"){const P="terrain-dem-src";this.addSource(P,m.source),m=r.cp(m),m=r.l(m,{source:P})}const b=r.l({},m),T={};if(this.terrain&&x){b.source=this.terrain.get().source;const P=this.terrain?this.getFragmentStyle(this.terrain.scope):null;P&&(T.style=P.serialize())}if(this._validate(Vi,"terrain",b,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&s!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,s),this.fire(new r.z("data",{dataType:"style"}))}else{const b=this.terrain,T=b.get();for(const P of Object.keys(r.a3.terrain))!m.hasOwnProperty(P)&&r.a3.terrain[P].default&&(m[P]=r.a3.terrain[P].default);for(const P in i)if(!r.bn(i[P],T[P])){b.set(i,this.options),this.stylesheet.terrain=i;const N=this._getTransitionParameters({duration:0});b.updateTransitions(N),this.fire(new r.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const s=this.fog=new wt(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();const m=this._getTransitionParameters({duration:0});s.updateTransitions(m)}_createSnow(i){const s=this.snow=new vt(i,this.map.transform,this.scope,this.options);this.stylesheet.snow=s.get();const m=this._getTransitionParameters({duration:0});s.updateTransitions(m)}_createRain(i){const s=this.rain=new ht(i,this.map.transform,this.scope,this.options);this.stylesheet.rain=s.get();const m=this._getTransitionParameters({duration:0});s.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog;if(!r.bn(s.get(),i)){s.set(i,this.options),this.stylesheet.fog=s.get();const m=this._getTransitionParameters({duration:0});s.updateTransitions(m)}}else this._createFog(i);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(i){if(this._checkLoaded(),!i)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const s=this.snow;if(!r.bn(s.get(),i)){s.set(i,this.options),this.stylesheet.snow=s.get();const m=this._getTransitionParameters({duration:0});s.updateTransitions(m)}}else this._createSnow(i);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(i){if(this._checkLoaded(),!i)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const s=this.rain;if(!r.bn(s.get(),i)){s.set(i,this.options),this.stylesheet.rain=s.get();const m=this._getTransitionParameters({duration:0});s.updateTransitions(m)}}else this._createRain(i);this._markersNeedUpdate=!0}_reloadColorTheme(){const i=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()},s=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!s)return this._styleColorTheme.lut=null,void i();const m=this._evaluateColorThemeData(s);this._loadColorTheme(m).then(()=>{this.fire(new r.z("colorthemeset")),i()}).catch(x=>{r.w(`Couldn't set color theme: ${x}`)})}setColorTheme(i){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=i,this._reloadColorTheme()}setImportColorTheme(i,s){const m=this.getFragmentStyle(i);m&&(m._styleColorTheme.colorThemeOverride=s,m._reloadColorTheme())}_getTransitionParameters(i){return{now:r.q.now(),transition:r.l(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;const i=[],s=[];for(const m of this._mergedOrder)this.isLayerDraped(this._mergedLayers[m])?i.push(m):s.push(m);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...s)}_createTerrain(i,s){const m=this.terrain=new _e(i,s,this.scope,this.options);s===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});m.updateTransitions(x)}_force3DLayerUpdate(){for(const i in this._layers){const s=this._layers[i];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const s=this._layers[i];s.type==="symbol"&&this._updateLayer(s)}}_validate(i,s,m,x,b={}){if(b&&b.validate===!1)return!1;const T=r.l({},this.serialize());return Gl(this,i.call(on,r.l({key:s,style:T,value:m,styleSpec:r.a3},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.cx.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(i){const s=this.getSourceCaches(i);for(const m of s)m.clearTiles()}clearSources(){for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}reloadSource(i){const s=this.getSourceCaches(i);for(const m of s)m.resume(),m.reload()}reloadSources(){for(const i of this.getSources())i.reload&&i.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(i=>{i.modelManager.reloadModels(i.scope)})}updateSources(i){let s;this.directionalLight&&(s=Mc(this.directionalLight));for(const m in this._mergedSourceCaches)this._mergedSourceCaches[m].update(i,void 0,void 0,s)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const s=this._sourceCaches[i];s.resume(),s.reload()}}_updatePlacement(i,s,m,x,b,T,P=!1){let N=!1,V=!1;const q={},Z={};for(const K of this._mergedOrder){const ne=this._mergedLayers[K];if(ne.type!=="symbol")continue;const fe=r.aC(ne.source,ne.scope);let ue=q[fe];if(!ue){const ge=this.getLayerSourceCache(ne);if(!ge)continue;const Ce=ge.getRenderableIds(!0).map(ze=>ge.getTileByID(ze));Z[fe]=Ce.slice(),ue=q[fe]=Ce.sort((ze,Le)=>Le.tileID.overscaledZ-ze.tileID.overscaledZ||(ze.tileID.isLessThan(Le.tileID)?-1:1))}const ve=this.crossTileSymbolIndex.addLayer(ne,ue,s.center.lng,s.projection);N=N||ve}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),P=P||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new r.z("neworder")),(P||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.q.now(),s.zoom))&&(this.pauseablePlacement=new qy(s,this._mergedOrder,P,m,x,b,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,q,Z,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.q.now()),V=!0),N&&this.pauseablePlacement.placement.setStale()),V||N){this._buildingIndex.onNewFrame(s.zoom);for(let K=0;K<this._mergedOrder.length;K++){const ne=this._mergedLayers[this._mergedOrder[K]];if(ne.type!=="symbol")continue;const fe=this.isLayerClipped(ne);this.placement.updateLayerOpacities(ne,q[r.aC(ne.source,ne.scope)],K,fe?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.q.now())}}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,s){this._checkLoaded();const m=this.stylesheet.imports=this.stylesheet.imports||[];if(m.findIndex(({id:b})=>b===i.id)!==-1)return void this.fire(new r.y(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!s)return m.push(i),this._loadImports([i],!0);const x=m.findIndex(({id:b})=>b===s);return x===-1&&this.fire(new r.y(new Error(`Import with id "${s}" does not exist on this map.`))),this.stylesheet.imports=m.slice(0,x).concat(i).concat(m.slice(x)),this._loadImports([i],!0,s)}updateImport(i,s){this._checkLoaded();const m=this.stylesheet.imports||[],x=this.getImportIndex(i);return x===-1?this:typeof s=="string"?(this.setImportUrl(i,s),this):(s.url&&s.url!==m[x].url&&this.setImportUrl(i,s.url),r.bn(s.config,m[x].config)||this.setImportConfig(i,s.config,s.data.schema),r.bn(s.data,m[x].data)||this.setImportData(i,s.data),this)}moveImport(i,s){this._checkLoaded();let m=this.stylesheet.imports||[];const x=this.getImportIndex(i);if(x===-1)return this;const b=this.getImportIndex(s);if(b===-1)return this;const T=m[x],P=this.fragments[x];return m=m.filter(({id:N})=>N!==i),this.fragments=this.fragments.filter(({id:N})=>N!==i),this.stylesheet.imports=m.slice(0,b).concat(T).concat(m.slice(b)),this.fragments=this.fragments.slice(0,b).concat(P).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(i,s){this._checkLoaded();const m=this.stylesheet.imports||[],x=this.getImportIndex(i);if(x===-1)return this;m[x].url=s;const b=this.fragments[x];return b.style=this._createFragmentStyle(m[x]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(s),this}setImportData(i,s){this._checkLoaded();const m=this.getImportIndex(i),x=this.stylesheet.imports||[];return m===-1?this:s?(this.fragments[m].style.setState(s),this._reloadImports(),this):(delete x[m].data,this.setImportUrl(i,x[m].url))}setImportConfig(i,s,m){this._checkLoaded();const x=this.getImportIndex(i),b=this.stylesheet.imports||[];if(x===-1)return this;s?b[x].config=s:delete b[x].config;const T=this.fragments[x];m&&T.style.stylesheet&&(T.style.stylesheet.schema=m);const P=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=s,T.style.updateConfig(s,P),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();const s=this.stylesheet.imports||[],m=this.getImportIndex(i);m!==-1&&(s.splice(m,1),this.fragments[m].style._remove(),this.fragments.splice(m,1),this._reloadImports())}getImportIndex(i){const s=(this.stylesheet.imports||[]).findIndex(m=>m.id===i);return s===-1&&this.fire(new r.y(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),s}getLayer(i){return this._mergedLayers[i]}getSources(){const i=[];for(const s in this._mergedOtherSourceCaches){const m=this._mergedOtherSourceCaches[s];m&&i.push(m.getSource())}return i}getSource(i,s){const m=this.getSourceCache(i,s);return m&&m.getSource()}getLayerSource(i){const s=this.getLayerSourceCache(i);return s&&s.getSource()}getSourceCache(i,s){const m=r.aC(i,s);return this._mergedOtherSourceCaches[m]}getLayerSourceCache(i){const s=r.aC(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);const s=[];return this._mergedOtherSourceCaches[i]&&s.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&s.push(this._mergedSymbolSourceCaches[i]),s}updateSourceCaches(){const i=this._changes.getUpdatedSourceCaches();for(const s in i){const m=i[s];m==="reload"?this.reloadSource(s):m==="clear"&&this.clearSource(s)}}updateLayers(i){const s=this._changes.getUpdatedPaintProperties();for(const m of s){const x=this.getLayer(m);x&&x.updateTransitions(i)}}getImages(i,s,m){this.imageManager.getImages(s.icons,s.scope,m),this._updateTilesForChangedImages();const x=b=>{b&&b.setDependencies(s.tileID.key,s.type,s.icons)};x(this._otherSourceCaches[s.source]),x(this._symbolSourceCaches[s.source])}rasterizeImages(i,s,m){this.imageManager.rasterizeImages(s,m)}getGlyphs(i,s,m){this.glyphManager.getGlyphs(s.stacks,s.scope,m)}getResource(i,s,m){return r.cy(s,m)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){const s=[];return this._otherSourceCaches[i]&&s.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&s.push(this._symbolSourceCaches[i]),s}_isSourceCacheLoaded(i){const s=this.getOwnSourceCaches(i);return s.length===0?(this.fire(new r.y(new Error(`There is no source with ID '${i}'`))),!1):s.every(m=>m.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(i,s){if(!this._clipLayerPresent&&i.type!=="fill-extrusion")return!1;const m=i.type==="fill-extrusion"&&i.sourceLayer==="building";if(i.is3D()){if(m||s&&s.type==="batched-model"||i.type==="model")return!0}else if(i.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}lo.getSourceType=function(f){return qi[f]},lo.setSourceType=function(f,i){qi[f]=i},lo.registerForPluginStateChange=r.ch;var Hd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Sh=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,qd=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Rc="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",fp=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Km=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ic=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,bu=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Eh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,ko=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,co=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Cs=[];Lc(Hd,Cs),Lc(qd,Cs),Lc(Sh,Cs);const Dc={"_prelude_fog.vertex.glsl":Km,"_prelude_terrain.vertex.glsl":fp,"_prelude_shadow.vertex.glsl":ko,"_prelude_fog.fragment.glsl":Ic,"_prelude_shadow.fragment.glsl":co,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":bu,"_prelude_raster_particle.glsl":Eh},Pc={};Wi("",fp),Wi(Ic,Km),Wi(co,ko),Wi(bu,""),Wi(Eh,"");const wu=Wi(Sh,qd),Su=Hd;var cs={background:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Wi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Wi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Wi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Wi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Wi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Wi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Wi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Wi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Wi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Wi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Wi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Wi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Wi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Wi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Wi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Wi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Rc),skyboxGradient:Wi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Rc),skyboxCapture:Wi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Wi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Wi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Wi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Wi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Wi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Wi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Wi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Lc(f,i){const s=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of s)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=m.split(" ");for(const b of x)i.includes(b)||i.push(b)}}function Wi(f,i){const s=/#include\s+"([^"]+)"/g,m=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let x=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);x&&(x=x.map(V=>{const q=V.split(" ");return q[q.length-1]}),x=[...new Set(x)]);const b={},T=[],P=[];if(f=f.replace(s,(V,q)=>(P.push(q),"")),(i=i.replace(s,(V,q)=>(T.push(q),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let N=[...Cs];Lc(f,N),Lc(i,N);for(const V of[...T,...P])Dc[V]||console.error(`Undefined include: ${V}`),Pc[V]||(Pc[V]=[],Lc(Dc[V],Pc[V])),N=[...N,...Pc[V]];return{fragmentSource:f=f.replace(m,(V,q,Z,K,ne)=>(b[ne]=!0,q==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
in ${Z} ${K} ${ne};
#else
uniform ${Z} ${K} u_${ne};
#endif
`:q==="initialize"?`
#ifdef HAS_UNIFORM_u_${ne}
    ${Z} ${K} ${ne} = u_${ne};
#endif
`:q==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ne}
    in ${Z} ${K} ${ne};
#endif
`:q==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(m,(V,q,Z,K,ne)=>{const fe=K==="float"?"vec2":K,ue=ne.match(/color/)?"color":fe;return q==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${ne}
in ${Z} ${K} a_${ne};
#endif
`:b[ne]?q==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
in ${Z} ${fe} a_${ne};
out ${Z} ${K} ${ne};
#else
uniform ${Z} ${K} u_${ne};
#endif
`:q==="initialize"?ue==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = a_${ne};
#else
    ${Z} ${K} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = unpack_mix_${ue}(a_${ne}, u_${ne}_t);
#else
    ${Z} ${K} ${ne} = u_${ne};
#endif
`:q==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ne}
    in ${Z} ${K} a_${ne};
    out ${Z} ${K} ${ne};
#endif
`:q==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ne}
    ${ne} = a_${ne};
#endif
`:void 0:q==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
in ${Z} ${fe} a_${ne};
#else
uniform ${Z} ${K} u_${ne};
#endif
`:q==="define-instanced"?ue==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${ne}0;
in vec4 a_${ne}1;
in vec4 a_${ne}2;
in vec4 a_${ne}3;
#else
uniform ${Z} ${K} u_${ne};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${Z} ${fe} a_${ne};
#else
uniform ${Z} ${K} u_${ne};
#endif
`:q==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${ne}
    ${Z} ${K} ${ne} = a_${ne};
#endif
`:ue==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${Z} ${K} ${ne} = a_${ne};
#else
    ${Z} ${K} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${Z} ${K} ${ne} = unpack_mix_${ue}(a_${ne}, u_${ne}_t);
#else
    ${Z} ${K} ${ne} = u_${ne};
#endif
`}),staticAttributes:x,usedDefines:N,vertexIncludes:T,fragmentIncludes:P}}class Eu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,s,m,x,b,T,P,N){this.context=i;let V=this.boundPaintVertexBuffers.length!==x.length;for(let Z=0;!V&&Z<x.length;Z++)this.boundPaintVertexBuffers[Z]!==x[Z]&&(V=!0);let q=this.boundDynamicVertexBuffers.length!==P.length;for(let Z=0;!q&&Z<P.length;Z++)this.boundDynamicVertexBuffers[Z]!==P[Z]&&(q=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==m||V||q||this.boundIndexBuffer!==b||this.boundVertexOffset!==T)this.freshBind(s,m,x,b,T,P,N);else{i.bindVertexArrayOES.set(this.vao);for(const Z of P)Z&&(Z.bind(),N&&Z.instanceCount&&Z.setVertexAttribDivisor(i.gl,s,N));b&&b.dynamicDraw&&b.bind()}}freshBind(i,s,m,x,b,T,P){const N=i.numAttributes,V=this.context,q=V.gl;this.vao&&this.destroy(),this.vao=V.gl.createVertexArray(),V.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=x,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=T,s.enableAttributes(q,i),s.bind(),s.setVertexAttribPointers(q,i,b);for(const Z of m)Z.enableAttributes(q,i),Z.bind(),Z.setVertexAttribPointers(q,i,b);for(const Z of T)Z&&(Z.enableAttributes(q,i),Z.bind(),Z.setVertexAttribPointers(q,i,b),P&&Z.instanceCount&&Z.setVertexAttribDivisor(q,i,P));x&&x.bind(),V.currentNumAttributes=N}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Mu(f,i){const s=Math.pow(2,i.canonical.z),m=i.canonical.y;return[new r.aa(0,m/s).toLngLat().lat,new r.aa(0,(m+1)/s).toLngLat().lat]}function us(f,i,s,m,x,b,T){const P=f.context,N=P.gl,V=s.hillshadeFBO;if(!V)return;f.prepareDrawTile();const q=f.isTileAffectedByFog(i),Z=f.getOrCreateProgram("hillshade",{overrideFog:q});P.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,V.colorAttachment.get());const K=((ve,ge,Ce,ze)=>{const Le=Ce.paint.get("hillshade-shadow-color"),qe=Ce.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ne=Ce.paint.get("hillshade-highlight-color"),Ge=Ce.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Be=Ce.paint.get("hillshade-accent-color"),Ke=Ce.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",it=Ce.paint.get("hillshade-emissive-strength");let Rt=r.ai(Ce.paint.get("hillshade-illumination-direction"));if(Ce.paint.get("hillshade-illumination-anchor")==="viewport")Rt-=ve.transform.angle;else if(ve.style&&ve.style.enable3dLights()&&ve.style.directionalLight){const jt=ve.style.directionalLight.properties.get("direction"),zt=r.cb(jt.x,jt.y,jt.z);Rt=r.ai(zt[1])}const xt=!ve.options.moving;return{u_matrix:ze||ve.transform.calculateProjMatrix(ge.tileID.toUnwrapped(),xt),u_image:0,u_latrange:Mu(0,ge.tileID),u_light:[Ce.paint.get("hillshade-exaggeration"),Rt],u_shadow:Le.toRenderColor(qe?null:Ce.lut),u_highlight:Ne.toRenderColor(Ge?null:Ce.lut),u_emissive_strength:it,u_accent:Be.toRenderColor(Ke?null:Ce.lut)}})(f,s,m,f.terrain?i.projMatrix:null);f.uploadCommonUniforms(P,Z,i.toUnwrapped());const{tileBoundsBuffer:ne,tileBoundsIndexBuffer:fe,tileBoundsSegments:ue}=f.getTileBoundsBuffers(s);Z.draw(f,N.TRIANGLES,x,b,T,fi.disabled,K,m.id,ne,fe,ue)}function Tu(f,i,s){if(!i.needsDEMTextureUpload)return;const m=f.context,x=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||f.getTileTexture(s.stride);const b=s.getPixels();i.demTexture?i.demTexture.update(b,{premultiply:!1}):i.demTexture=new r.T(m,b,x.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function Mh(f,i,s){const m=f.context,x=m.gl;if(!i.dem)return;const b=i.dem;if(m.activeTexture.set(x.TEXTURE1),Tu(f,i,b),!i.demTexture)return;i.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const T=b.dim;m.activeTexture.set(x.TEXTURE0);let P=i.hillshadeFBO;if(!P){const K=new r.T(m,{width:T,height:T,data:null},x.RGBA8);K.bind(x.LINEAR,x.CLAMP_TO_EDGE),P=i.hillshadeFBO=m.createFramebuffer(T,T,!0,"renderbuffer"),P.colorAttachment.set(K.texture)}m.bindFramebuffer.set(P.framebuffer),m.viewport.set([0,0,T,T]);const{tileBoundsBuffer:N,tileBoundsIndexBuffer:V,tileBoundsSegments:q}=f.getMercatorTileBoundsBuffers(),Z=[];f.linearFloatFilteringSupported()&&Z.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:Z}).draw(f,x.TRIANGLES,Qn.disabled,pi.disabled,Ui.unblended,fi.disabled,((K,ne)=>{const fe=ne.stride,ue=r.ab.mat4.create();return r.ab.mat4.ortho(ue,0,r.ag,-r.ag,0,0,1),r.ab.mat4.translate(ue,ue,[0,-r.ag,0]),{u_matrix:ue,u_image:1,u_dimension:[fe,fe],u_zoom:K.overscaledZ}})(i.tileID,b),s.id,N,V,q),i.needsHillshadePrepare=!1}class Rr{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Th extends Rr{getDefault(){return r.aj.transparent}set(i){const s=this.current;(i.r!==s.r||i.g!==s.g||i.b!==s.b||i.a!==s.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Zo extends Rr{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Yo extends Rr{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Hl extends Rr{getDefault(){return[!0,!0,!0,!0]}set(i){const s=this.current;(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2]||i[3]!==s[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class fl extends Rr{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class pl extends Rr{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Au extends Rr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const s=this.current;(i.func!==s.func||i.ref!==s.ref||i.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Ah extends Rr{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const s=this.current;(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Cu extends Rr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;i?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=i,this.dirty=!1}}class pp extends Rr{getDefault(){return[0,1]}set(i){const s=this.current;(i[0]!==s[0]||i[1]!==s[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Kr extends Rr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;i?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=i,this.dirty=!1}}class Ka extends Rr{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Ir extends Rr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;i?s.enable(s.BLEND):s.disable(s.BLEND),this.current=i,this.dirty=!1}}class Ko extends Rr{getDefault(){const i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){const s=this.current;(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2]||i[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Rs extends Rr{getDefault(){return r.aj.transparent}set(i){const s=this.current;(i.r!==s.r||i.g!==s.g||i.b!==s.b||i.a!==s.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Wd extends Rr{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class ml extends Rr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;i?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=i,this.dirty=!1}}class mp extends Rr{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class gp extends Rr{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let Oc=class extends Rr{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class Ch extends Rr{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Rh extends Rr{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const s=this.current;(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2]||i[3]!==s[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class gl extends Rr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class I_ extends Rr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Jm extends Rr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class D_ extends Rr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class _p extends Rr{getDefault(){return null}set(i){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class P_ extends Rr{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class $d extends Rr{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class vp extends Rr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class zc extends Rr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class kc extends Rr{constructor(i,s){super(i),this.context=i,this.parent=s}getDefault(){return null}}class ql extends kc{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Ru extends kc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Xd extends kc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Qm extends Ru{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const yp=(f,i,s)=>({u_matrix:f,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:s}),Jo=(f,i,s,m,x,b,T,P,N,V,q,Z,K,ne,fe,ue)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:s,u_zoom_transition:x,u_merc_center:b,u_image0:0,u_frustum_tl:T,u_frustum_tr:P,u_frustum_br:N,u_frustum_bl:V,u_globe_pos:q,u_globe_radius:Z,u_viewport:K,u_grid_matrix:ue?Float32Array.from(ue):new Float32Array(9),u_skirt_height:ne,u_far_z_cutoff:fe});function xp(f,i){return f!=null&&i!=null&&!(!f.hasData()||!i.hasData())&&f.demTexture!=null&&i.demTexture!=null&&f.tileID.key!==i.tileID.key}const uo=new class{constructor(){this.operations={}}newMorphing(f,i,s,m,x){if(f in this.operations){const b=this.operations[f];b.to.tileID.key!==s.tileID.key&&(b.queued=s)}else this.operations[f]={startTime:m,phase:0,duration:x,from:i,to:s,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const i=this.operations[f];return{from:i.from,to:i.to,phase:i.phase}}update(f){for(const i in this.operations){const s=this.operations[i];for(s.phase=(f-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,f)){delete this.operations[i];break}}}_nextOp(f,i){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=i,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Iu={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Ih(f,i,s){if(i===0)return 0;const m=i<1&&s===514?.25/i:1;return 6*Math.pow(1.5,22-f)*Math.max(i,1)*m}function bp(f,i){const s=1<<f.z;return!i&&(f.x===0||f.x===s-1)||f.y===0||f.y===s-1}const Dh=f=>({u_matrix:f});function Ao(f,i,s,m,x){if(x>0){const b=r.q.now(),T=(b-f.timeAdded)/x,P=i?(b-i.timeAdded)/x:-1,N=s.getSource(),V=m.coveringZoomLevel({tileSize:N.tileSize,roundZoom:N.roundZoom}),q=!i||Math.abs(i.tileID.overscaledZ-V)>Math.abs(f.tileID.overscaledZ-V),Z=q&&f.refreshedUponExpiration?1:r.aw(q?T:1-P,0,1);return f.refreshedUponExpiration&&T>=1&&(f.refreshedUponExpiration=!1),i?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}class Is extends Ss{constructor(i){const s={type:"raster-dem",maxzoom:i.transform.maxZoom},m=new r.D(r.ci(),null),x=Ci("mock-dem",s,m,i.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,s){i.state="loaded",s(null)}}class Fc extends Ss{constructor(i){const s=Ci("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new r.D(r.ci(),null),i.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,s,m){if(i.freezeTileCoverage)return;this.transform=i;const x=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,T)=>{if(b[T.key]="",!this._tiles[T.key]){const P=new kl(T,this._source.tileSize*T.overscaleFactor(),i.tileZoom);P.state="loaded",this._tiles[T.key]=P}return b},{});for(const b in this._tiles)b in x||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(i){const s=this.proxyCachedFBO[i];if(s!==void 0){const m=Object.values(s);this.renderCachePool.push(...m),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class wp extends r.aG{constructor(i,s,m){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=s,this.projMatrix=m}}class hs extends r.cJ{constructor(i,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,x,b]=function(N){const V=new r.b4,q=new r.aU,Z=131;V.reserve(17161),q.reserve(33800);const K=r.ag/128,ne=r.ag+K/2,fe=ne+K;for(let ve=-K;ve<fe;ve+=K)for(let ge=-K;ge<fe;ge+=K){const Ce=ge<0||ge>ne||ve<0||ve>ne?24575:0,ze=r.aw(Math.round(ge),0,r.ag),Le=r.aw(Math.round(ve),0,r.ag);V.emplaceBack(ze+Ce,Le)}const ue=(ve,ge)=>{const Ce=ge*Z+ve;q.emplaceBack(Ce+1,Ce,Ce+Z),q.emplaceBack(Ce+Z,Ce+Z+1,Ce+1)};for(let ve=1;ve<129;ve++)for(let ge=1;ge<129;ge++)ue(ge,ve);return[0,129].forEach(ve=>{for(let ge=0;ge<130;ge++)ue(ge,ve),ue(ve,ge)}),[V,q,32768]}(),T=i.context;this.gridBuffer=T.createVertexBuffer(m,r.b6.members),this.gridIndexBuffer=T.createIndexBuffer(x),this.gridSegments=r.b7.simpleSegment(0,0,m.length,x.length),this.gridNoSkirtSegments=r.b7.simpleSegment(0,0,m.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Fc(s.map),this.orthoMatrix=r.ab.mat4.create(),r.ab.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.ag,0,r.ag,0,1);const P=T.gl;this._overlapStencilMode=new pi({func:P.GEQUAL,mask:255},0,255,P.KEEP,P.KEEP,P.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Is(s.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,s,m){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);const x=i.terrain.properties,b=i.terrain.drapeRenderMode===0,T=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.q.now();const P=i.terrain&&i.terrain.scope,N=x.get("source"),V=b?this._mockSourceCache:i.getSourceCache(N,P);if(!V)return void r.w(`Couldn't find terrain source "${N}".`);if(this.sourceCache=V,this._attenuationRange=i.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(s):x.get("exaggeration"),!s.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const q=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Z=this.getScaledDemTileSize();this.sourceCache.update(s,Z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,q(),this._initializing=!0),q(),s.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(i){if(this._attenuationRange&&i.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(i.zoom);const s=this._previousCameraAltitude,m=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=m;const x=s!=null?m-s:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const b=i.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(b);let P=b-this._previousZoom;const N=this._previousUpdateTimestamp;let V=b;this._evaluationZoom!=null&&(V=this._evaluationZoom,Math.abs(b-V)>.5&&(P=.5*(b-V+P)),P*x<0&&(V+=P)),this._evaluationZoom=V;const q=T.getExaggeration(V),Z=q===T.getExaggeration(Math.max(0,V-.1));if(Z&&Math.abs(q-this._exaggeration)<.01)return q;let K=Math.min(.1,.00375*(this._updateTimestamp-N));return(Z||q<.1||Math.abs(P)<1e-4)&&(K=Math.min(.2,4*K)),r.af(this._exaggeration,q,K)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(r.aa.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=s.getIds().map(N=>{const V=s.getTileByID(N).tileID;return V.projMatrix=m.calculateProjMatrix(V.toUnwrapped()),V});(function(N,V){const q=V.transform.pointCoordinate(V.transform.getCameraPoint()),Z=new r.P(q.x,q.y);N.sort((K,ne)=>{if(ne.overscaledZ-K.overscaledZ)return ne.overscaledZ-K.overscaledZ;const fe=new r.P(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ue=new r.P(ne.canonical.x+(1<<ne.canonical.z)*ne.wrap,ne.canonical.y),ve=Z.mult(1<<K.canonical.z);return ve.x-=.5,ve.y-=.5,ve.distSqr(fe)-ve.distSqr(ue)})})(x,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},x.forEach(N=>{this.proxyToSource[N.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const N in T){const V=T[N];if(!V.used||(V!==this.sourceCache&&this.resetTileLookupCache(V.id),this._setupProxiedCoordsForOrtho(V,i[N],b),V.usedForTerrain))continue;const q=i[N];V.getSource().reparseOverscaled&&this._assignTerrainTiles(q)}this.proxiedCoords[s.id]=x.map(N=>new wp(N,N.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const P={};this._visibleDemTiles=[];for(const N of this.proxyCoords){const V=this.terrainTileForTile[N.key];if(!V)continue;const q=V.tileID.key;q in P||(this._visibleDemTiles.push(V),P[q]=q)}}_assignTerrainTiles(i){this._initializing||i.forEach(s=>{if(this.terrainTileForTile[s.key])return;const m=this._findTileCoveringTileID(s,this.sourceCache);m&&(this.terrainTileForTile[s.key]=m)})}_prepareDEMTextures(){const i=this.painter.context,s=i.gl;for(const m in this.terrainTileForTile){const x=this.terrainTileForTile[m],b=x.dem;!b||x.demTexture&&!x.needsDEMTextureUpload||(i.activeTexture.set(s.TEXTURE1),Tu(this.painter,x,b))}}_prepareDemTileUniforms(i,s,m,x){if(!s||s.demTexture==null)return!1;const b=i.tileID.canonical,T=Math.pow(2,s.tileID.canonical.z-b.z),P=x||"";return m[`u_dem_tl${P}`]=[b.x*T%1,b.y*T%1],m[`u_dem_scale${P}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let i=0;const s=this._visibleDemTiles.reduce((m,x)=>{if(!x.dem)return m;const b=x.dem.tree.minimums[0];return b>0&&i++,m+b},0);return i?s/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,s=i.gl;i.activeTexture.set(s.TEXTURE2);const m=this._getLoadedAreaMinimum(),x=new r.cK({width:1,height:1},new Float32Array([m]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(x,{premultiply:!1}):b=this._emptyDEMTexture=new r.T(i,x,s.R32F,{premultiply:!1}),b}setupElevationDraw(i,s,m){const x=this.painter.context,b=x.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let P=null,N=null,V=1;if(m&&m.morphing&&this._useVertexMorphing){const ne=m.morphing.srcDemTile,fe=m.morphing.dstDemTile;V=m.morphing.phase,ne&&fe&&(this._prepareDemTileUniforms(i,ne,T,"_prev")&&(N=ne),this._prepareDemTileUniforms(i,fe,T)&&(P=fe))}const q=ne=>ne&&ne.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let Z=null;var K;if(this.enabled?N&&P?(Z=P.demTexture,x.activeTexture.set(b.TEXTURE4),N.demTexture.bind(q(N),b.CLAMP_TO_EDGE),T.u_dem_lerp=V):(P=this.terrainTileForTile[i.tileID.key],Z=this._prepareDemTileUniforms(i,P,T)?P.demTexture:this.emptyDEMTexture):Z=this.emptyDEMTexture,x.activeTexture.set(b.TEXTURE2),Z&&(T.u_dem_size=(K=Z).size[0]===1?1:K.size[0]-2,Z.bind(q(P),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(m&&m.useDepthForOcclusion,s,T),m&&m.useMeterToDem&&P){const ne=(1<<P.tileID.canonical.z)*r.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=ne}if(m&&m.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),s.setTerrainUniformValues(x,T),this.painter.transform.projection.name==="globe"){const ne=this.globeUniformValues(this.painter.transform,i.tileID.canonical,m&&m.useDenormalizedUpVectorScale);s.setGlobeUniformValues(x,ne)}}globeUniformValues(i,s,m){const x=i.projection;return{u_tile_tl_up:x.upVector(s,0,0),u_tile_tr_up:x.upVector(s,r.ag,0),u_tile_br_up:x.upVector(s,r.ag,r.ag),u_tile_bl_up:x.upVector(s,0,r.ag),u_tile_up_scale:m?r.cL(1):x.upVectorScale(s,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const s=this.painter,m=this.painter.context;i.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,b,T,P,N){if(x.transform.projection.name==="globe")(function(V,q,Z,K,ne){const fe=V.context,ue=fe.gl;let ve,ge;const Ce=V.transform,ze=r.cC(V,fe,Ce),Le=(jt,zt)=>{if(ge===zt)return;const pt=[Iu[zt],"PROJECTION_GLOBE_VIEW"];ze&&pt.push("CUSTOM_ANTIALIASING");const Dt=V.isTileAffectedByFog(jt);ve=V.getOrCreateProgram("globeRaster",{defines:pt,overrideFog:Dt}),ge=zt},qe=V.colorModeForRenderPass(),Ne=new Qn(ue.LEQUAL,Qn.ReadWrite,V.depthRangeFor3D);uo.update(ne);const Ge=r.cD(Ce),Be=[r.at(Ce.center.lng),r.aA(Ce.center.lat)],Ke=V.globeSharedBuffers,it=[Ce.width*r.q.devicePixelRatio,Ce.height*r.q.devicePixelRatio],Rt=Float32Array.from(Ce.globeMatrix),xt={useDenormalizedUpVectorScale:!0};{const jt=V.transform,zt=Ih(jt.zoom,q.exaggeration(),q.sourceCache._source.tileSize);ge=-1;const pt=ue.TRIANGLES;for(const Dt of K){const tn=Z.getTile(Dt),dt=pi.disabled,Ut=q.prevTerrainTileForTile[Dt.key],Pt=q.terrainTileForTile[Dt.key];xp(Ut,Pt)&&uo.newMorphing(Dt.key,Ut,Pt,ne,250),fe.activeTexture.set(ue.TEXTURE0),tn.texture&&tn.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);const dn=uo.getMorphValuesForProxy(Dt.key),Zt=dn?1:0;dn&&r.J(xt,{morphing:{srcDemTile:dn.from,dstDemTile:dn.to,phase:r.cB(dn.phase)}});const Gt=r.cE(Dt.canonical),rn=r.cF(Gt.getCenter().lat),mn=r.cG(Dt.canonical,Gt,rn,jt.worldSize/jt._pixelsPerMercatorPixel),Cn=r.bb(r.cH(Dt.canonical)),zn=Jo(jt.expandedFarZProjMatrix,Rt,Ge,Cn,r.ae(jt.zoom),Be,jt.frustumCorners.TL,jt.frustumCorners.TR,jt.frustumCorners.BR,jt.frustumCorners.BL,jt.globeCenterInViewSpace,jt.globeRadius,it,zt,jt._farZ,mn);if(Le(Dt,Zt),ve&&(q.setupElevationDraw(tn,ve,xt),V.uploadCommonUniforms(fe,ve,Dt.toUnwrapped()),Ke)){const[ni,Yn,Zn]=Ke.getGridBuffers(rn,zt!==0);ve.draw(V,pt,Ne,dt,qe,fi.backCCW,zn,"globe_raster",ni,Yn,Zn)}}}if(Ke&&(V.renderDefaultNorthPole||V.renderDefaultSouthPole)){const jt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ze&&jt.push("CUSTOM_ANTIALIASING"),ve=V.getOrCreateProgram("globeRaster",{defines:jt});for(const zt of K){const{x:pt,y:Dt,z:tn}=zt.canonical,dt=Dt===0,Ut=Dt===(1<<tn)-1,[Pt,dn,Zt,Gt]=Ke.getPoleBuffers(tn,!1);if(Gt&&(dt||Ut)){const rn=Z.getTile(zt);fe.activeTexture.set(ue.TEXTURE0),rn.texture&&rn.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);let mn=r.cI(tn,pt,Ce);const Cn=r.bb(r.cH(zt.canonical)),zn=(ni,Yn)=>ni.draw(V,ue.TRIANGLES,Ne,pi.disabled,qe,fi.disabled,Jo(Ce.expandedFarZProjMatrix,mn,mn,Cn,0,Be,Ce.frustumCorners.TL,Ce.frustumCorners.TR,Ce.frustumCorners.BR,Ce.frustumCorners.BL,Ce.globeCenterInViewSpace,Ce.globeRadius,it,0,Ce._farZ),"globe_pole_raster",Yn,Zt,Gt);q.setupElevationDraw(rn,ve,xt),V.uploadCommonUniforms(fe,ve,zt.toUnwrapped()),dt&&V.renderDefaultNorthPole&&zn(ve,Pt),Ut&&V.renderDefaultSouthPole&&(mn=r.ab.mat4.scale(r.ab.mat4.create(),mn,[1,-1,1]),zn(ve,dn))}}}})(x,b,T,P,N);else{const V=x.context,q=V.gl;let Z,K;const ne=x.shadowRenderer,fe=Ec(x,x.longestCutoffRange),ue=qe=>{if(K===qe)return;const Ne=[];Ne.push(Iu[qe]),fe.shouldRenderCutoff&&Ne.push("RENDER_CUTOFF"),ne&&(Ne.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ne.useNormalOffset&&Ne.push("NORMAL_OFFSET")),Z=x.getOrCreateProgram("terrainRaster",{defines:Ne}),K=qe},ve=x.colorModeForRenderPass(),ge=new Qn(q.LEQUAL,Qn.ReadWrite,x.depthRangeFor3D);uo.update(N);const Ce=x.transform,ze=Ih(Ce.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let Le=[0,0,0];if(ne){const qe=x.style.directionalLight,Ne=x.style.ambientLight;qe&&Ne&&(Le=hp(x.style,qe,Ne))}{K=-1;const qe=q.TRIANGLES,[Ne,Ge]=[b.gridIndexBuffer,b.gridSegments];for(const Be of P){const Ke=T.getTile(Be),it=pi.disabled,Rt=b.prevTerrainTileForTile[Be.key],xt=b.terrainTileForTile[Be.key];xp(Rt,xt)&&uo.newMorphing(Be.key,Rt,xt,N,250),V.activeTexture.set(q.TEXTURE0),Ke.texture&&Ke.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const jt=uo.getMorphValuesForProxy(Be.key),zt=jt?1:0;let pt;jt&&(pt={morphing:{srcDemTile:jt.from,dstDemTile:jt.to,phase:r.cB(jt.phase)}});const Dt=yp(Be.projMatrix,bp(Be.canonical,Ce.renderWorldCopies)?ze/10:ze,Le);if(ue(zt),!Z)continue;b.setupElevationDraw(Ke,Z,pt);const tn=Be.toUnwrapped();ne&&ne.setupShadows(tn,Z),x.uploadCommonUniforms(V,Z,tn,null,fe),Z.draw(x,qe,ge,it,ve,fi.backCCW,Dt,"terrain_raster",b.gridBuffer,Ne,Ge)}}}}(s,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const s=this.painter,m=this.painter.context,x=this.proxySourceCache,b=this.proxiedCoords[x.id],T=this._drapedRenderBatches.shift(),P=s.style.order,N=[];let V=0;for(const q of b){const Z=x.getTileByID(q.proxyTileKey),K=x.proxyCachedFBO[q.key]?x.proxyCachedFBO[q.key][i]:void 0,ne=K!==void 0?x.renderCache[K]:this.pool[V++],fe=K!==void 0;if(Z.texture=ne.tex,fe&&!ne.dirty){N.push(Z.tileID);continue}let ue;m.bindFramebuffer.set(ne.fb.framebuffer),this.renderedToTile=!1,ne.dirty&&(m.clear({color:r.aj.transparent,stencil:0}),ne.dirty=!1);for(let ve=T.start;ve<=T.end;++ve){const ge=s.style._mergedLayers[P[ve]];if(ge.isHidden(s.transform.zoom))continue;const Ce=s.style.getLayerSourceCache(ge),ze=Ce?this.proxyToSource[q.key][Ce.id]:[q];if(!ze)continue;const Le=ze;m.viewport.set([0,0,ne.fb.width,ne.fb.height]),ue!==(Ce?Ce.id:null)&&(this._setupStencil(ne,ze,ge,Ce),ue=Ce?Ce.id:null),s.renderLayer(s,Ce,ge,Le)}if(this._drapedRenderBatches.length===0)for(const ve of this._pendingGroundEffectLayers){const ge=s.style._mergedLayers[P[ve]];if(ge.isHidden(s.transform.zoom))continue;const Ce=s.style.getLayerSourceCache(ge),ze=Ce?this.proxyToSource[q.key][Ce.id]:[q];if(!ze)continue;const Le=ze;m.viewport.set([0,0,ne.fb.width,ne.fb.height]),ue!==(Ce?Ce.id:null)&&(this._setupStencil(ne,ze,ge,Ce),ue=Ce?Ce.id:null),s.renderLayer(s,Ce,ge,Le)}this.renderedToTile?(ne.dirty=!0,N.push(Z.tileID)):fe||--V,V===5&&(V=0,this.renderToBackBuffer(N))}return this.renderToBackBuffer(N),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,s.width,s.height]),T.end+1}postRender(){}isLayerOrderingCorrect(i){const s=i.order.length;let m=-1,x=s;for(let b=0;b<s;++b)this._style.isLayerDraped(i._mergedLayers[i.order[b]])?m=Math.max(m,b):x=Math.min(x,b);return x>m}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{i=Math.min(i,s.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,s,m){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const T=b.tileID,P=1<<T.overscaledZ,{x:N,y:V}=T.canonical,q=N/P,Z=(N+1)/P,K=V/P,ne=(V+1)/P;return{minx:q,miny:K,maxx:Z,maxy:ne,t:b.dem.tree.raycastRoot(q,K,Z,ne,i,s,m),tile:b}});x.sort((b,T)=>(b.t!==null?b.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const b of x){if(b.t==null)return null;const T=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,i,s,m);if(T!=null)return T}return null}_createFBO(){const i=this.painter.context,s=i.gl,m=this.drapeBufferSize;i.activeTexture.set(s.TEXTURE0);const x=new r.T(i,{width:m[0],height:m[1],data:null},s.RGBA8);x.bind(s.LINEAR,s.CLAMP_TO_EDGE);const b=i.createFramebuffer(m[0],m[1],!0,null);return b.colorAttachment.set(x.texture),b.depthAttachment=new Qm(i,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:b,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const s=this._style._mergedLayers[i],m=s.isHidden(this.painter.transform.zoom);return s.type==="hillshade"||s.type==="custom"?!m&&s.shouldRedrape():!m&&s.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const m of this._style.getSources())if(m instanceof Pi){i=!0;break}if(!i)return;const s={};for(let m=0;m<this._style.order.length;++m){const x=this._style._mergedLayers[this._style.order[m]],b=this._style.getLayerSourceCache(x);if(b&&!s[b.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof r.a9){s[b.id]=!0;for(const T of this.proxyCoords){const P=this.proxyToSource[T.key][b.id];if(P)for(const N of P)this._clearRenderCacheForTile(b.id,N)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const m in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[m]._source instanceof or){i=!0;break}if(!i)return;const s={};for(let m=0;m<this._style.order.length;++m){const x=this._style._mergedLayers[this._style.order[m]],b=this._style.getLayerSourceCache(x);if(!b||s[b.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const T=x.paint.get("raster-fade-duration");for(const P of this.proxyCoords){const N=this.proxyToSource[P.key][b.id];if(N)for(const V of N){const q=Ao(b.getTile(V),b.findLoadedParent(V,0),b,this.painter.transform,T);(q.opacity!==1||q.mix!==0)&&this._clearRenderCacheForTile(b.id,V)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const i=this._style.order,s=i.length;if(s===0)return;const m=[];this._pendingGroundEffectLayers=[];let x,b=0,T=this._style._mergedLayers[i[b]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++b<s;)T=this._style._mergedLayers[i[b]];for(;b<s;++b){const P=this._style._mergedLayers[i[b]];P.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(P)?x===void 0&&(x=b):(P.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),x!==void 0&&(m.push({start:x,end:b-1}),x=void 0)))}if(x!==void 0&&m.push({start:x,end:b-1}),m.length!==0){const P=m[m.length-1];this._pendingGroundEffectLayers.every(N=>N>P.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=m}_setupRenderCache(i){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const T=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let P=0;P<T.length;++P){const N=Object.values(T[P]);s.renderCachePool.push(...N)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,x=this._tilesDirty;for(let T=m.length-1;T>=0;T--){const P=m[T];if(s.getTileByID(P.key),s.proxyCachedFBO[P.key]!==void 0){const N=i[P.key],V=this.proxyToSource[P.key];let q=0;for(const Z in V){const K=V[Z],ne=N[Z];if(!ne||ne.length!==K.length||K.some((fe,ue)=>fe!==ne[ue]||x[Z]&&x[Z].hasOwnProperty(fe.key))){q=-1;break}++q}for(const Z in s.proxyCachedFBO[P.key])s.renderCache[s.proxyCachedFBO[P.key][Z]].dirty=q<0||q!==Object.values(N).length}}const b=[...this._drapedRenderBatches];b.sort((T,P)=>P.end-P.start-(T.end-T.start));for(const T of b)for(const P of m){if(s.proxyCachedFBO[P.key])continue;let N=s.renderCachePool.pop();N===void 0&&s.renderCache.length<50&&(N=s.renderCache.length,s.renderCache.push(this._createFBO())),N!==void 0&&(s.proxyCachedFBO[P.key]={},s.proxyCachedFBO[P.key][T.start]=N,s.renderCache[N].dirty=!0)}this._tilesDirty={}}_setupStencil(i,s,m,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,T=b.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let P;if(m.isTileClipped())P=s.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);P=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+P>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=P,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):pi.disabled}_renderTileClippingMasks(i,s){const m=this.painter,x=this.painter.context,b=x.gl;m._tileClippingMaskIDs={},x.setColorMode(Ui.disabled),x.setDepthMode(Qn.disabled);const T=m.getOrCreateProgram("clippingMask");for(const P of i){const N=m._tileClippingMaskIDs[P.key]=--s;T.draw(m,b.TRIANGLES,Qn.disabled,new pi({func:b.ALWAYS,mask:0},N,255,b.KEEP,b.KEEP,b.REPLACE),Ui.disabled,fi.disabled,Dh(P.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(i){const s=this.painter.transform;if(i.x<0||i.x>s.width||i.y<0||i.y>s.height)return null;const m=[i.x,i.y,1,1];r.ab.vec4.transformMat4(m,m,s.pixelMatrixInverse),r.ab.vec4.scale(m,m,1/m[3]),m[0]/=s.worldSize,m[1]/=s.worldSize;const x=s._camera.position,b=r.bH(1,s.center.lat),T=[x[0],x[1],x[2]/b,0],P=r.ab.vec3.subtract([],m.slice(0,3),T);r.ab.vec3.normalize(P,P);const N=this.raycast(T,P,this._exaggeration);return N!==null&&N?(r.ab.vec3.scaleAndAdd(T,T,P,N),T[3]=T[2],T[2]*=b,T):null}_setupProxiedCoordsForOrtho(i,s,m){if(i.getSource()instanceof r.aJ)return this._setupProxiedCoordsForImageSource(i,s,m);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const x=this.proxiedCoords[i.id]=[],b=this.proxyCoords;for(let N=0;N<b.length;N++){const V=b[N],q=this._findTileCoveringTileID(V,i);if(q){const Z=this._createProxiedId(V,q,m[V.key]&&m[V.key][i.id]);x.push(Z),this.proxyToSource[V.key][i.id]=[Z]}}let T=!1;const P=new Set;for(let N=0;N<s.length;N++){const V=i.getTile(s[N]);if(!V||!V.hasData())continue;const q=this._findTileCoveringTileID(V.tileID,this.proxySourceCache);if(q&&q.tileID.canonical.z!==V.tileID.canonical.z){const Z=this.proxyToSource[q.tileID.key][i.id],K=this._createProxiedId(q.tileID,V,m[q.tileID.key]&&m[q.tileID.key][i.id]);Z?Z.splice(Z.length-1,0,K):this.proxyToSource[q.tileID.key][i.id]=[K];const ne=this.proxyToSource[q.tileID.key][i.id];P.has(ne)||P.add(ne),x.push(K),T=!0}}if(this._sourceTilesOverlap[i.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const N of P)N.sort((V,q)=>q.overscaledZ-V.overscaledZ)}_setupProxiedCoordsForImageSource(i,s,m){if(!i.getSource().loaded())return;const x=this.proxiedCoords[i.id]=[],b=this.proxyCoords,T=i.getSource(),P=T.tileID;if(!P)return;const N=new r.P(P.x,P.y)._div(1<<P.z),V=T.coordinates.map(r.aa.fromLngLat).reduce((Z,K)=>(Z.min.x=Math.min(Z.min.x,K.x-N.x),Z.min.y=Math.min(Z.min.y,K.y-N.y),Z.max.x=Math.max(Z.max.x,K.x-N.x),Z.max.y=Math.max(Z.max.y,K.y-N.y),Z),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),q=(Z,K)=>{const ne=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),fe=Z.canonical.y/(1<<Z.canonical.z),ue=r.ag/(1<<Z.canonical.z),ve=K.wrap+K.canonical.x/(1<<K.canonical.z),ge=K.canonical.y/(1<<K.canonical.z);return ne+ue<ve+V.min.x||ne>ve+V.max.x||fe+ue<ge+V.min.y||fe>ge+V.max.y};for(let Z=0;Z<b.length;Z++){const K=b[Z];for(let ne=0;ne<s.length;ne++){const fe=i.getTile(s[ne]);if(!fe||!fe.hasData()||q(K,fe.tileID))continue;const ue=this._createProxiedId(K,fe,m[K.key]&&m[K.key][i.id]),ve=this.proxyToSource[K.key][i.id];ve?ve.push(ue):this.proxyToSource[K.key][i.id]=[ue],x.push(ue)}}}_createProxiedId(i,s,m){let x=this.orthoMatrix;if(m){const b=m.find(T=>T.key===s.tileID.key);if(b)return b}if(s.tileID.key!==i.key){const b=i.canonical.z-s.tileID.canonical.z;let T,P,N;x=r.ab.mat4.create();const V=s.tileID.wrap-i.wrap<<i.overscaledZ;b>0?(T=r.ag>>b,P=T*((s.tileID.canonical.x<<b)-i.canonical.x+V),N=T*((s.tileID.canonical.y<<b)-i.canonical.y)):(T=r.ag<<-b,P=r.ag*(s.tileID.canonical.x-(i.canonical.x+V<<-b)),N=r.ag*(s.tileID.canonical.y-(i.canonical.y<<-b))),r.ab.mat4.ortho(x,0,T,0,T,0,1),r.ab.mat4.translate(x,x,[P,N,0])}return new wp(s.tileID,i.key,x)}_findTileCoveringTileID(i,s){let m=s.getTile(i);if(m&&m.hasData())return m;const x=this._findCoveringTileCache[s.id],b=x[i.key];if(m=b?s.getTileByID(b):null,m&&m.hasData()||b===null)return m;let T=m?m.tileID:i,P=T.overscaledZ;const N=s.getSource().minzoom,V=[];if(!b){const Z=s.getSource().maxzoom;if(i.canonical.z>=Z){const K=i.canonical.z-Z;s.getSource().reparseOverscaled?(P=Math.max(i.canonical.z+2,s.transform.tileZoom),T=new r.aG(P,i.wrap,Z,i.canonical.x>>K,i.canonical.y>>K)):K!==0&&(P=Z,T=new r.aG(P,i.wrap,Z,i.canonical.x>>K,i.canonical.y>>K))}T.key!==i.key&&(V.push(T.key),m=s.getTile(T))}const q=Z=>{V.forEach(K=>{x[K]=Z}),V.length=0};for(P-=1;P>=N&&(!m||!m.hasData());P--){m&&q(m.tileID.key);const Z=T.calculateScaledKey(P);if(m=s.getTileByID(Z),m&&m.hasData())break;const K=x[Z];if(K===null)break;K===void 0?V.push(Z):m=s.getTileByID(K)}return q(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,s){let m=this._tilesDirty[i];m||(m=this._tilesDirty[i]={}),m[s.key]=!0}}function Wl(f,i,s){const m=function(P,N,V){const q=r.ab.vec3.dot(N,P),Z=r.ab.vec3.dot(V,[.2126,.7152,.0722]),K=(fe,ue,ve)=>(1-ve)*fe+ve*ue,ne=K(1-.3*Math.min(Z,1),1,Math.min(q+1,1));return K(.92,1,Math.asin(r.aw(N[2],-1,1))/Math.PI+.5)*ne}(f,[0,0,1],i),x=[0,0,0];r.ab.vec3.scale(x,s.slice(0,3),m);const b=[0,0,0];r.ab.vec3.scale(b,i.slice(0,3),f[2]);const T=[0,0,0];return r.ab.vec3.add(T,x,b),r.cf(T)}const Ja=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Zd=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class L_{static cacheKey(i,s,m,x){let b=`${s}${x?x.cacheKey:""}`;for(const T of m)i.usedDefines.includes(T)&&(b+=`/${T}`);return b}constructor(i,s,m,x,b,T){const P=i.gl;this.program=P.createProgram(),this.configuration=x,this.name=s,this.fixedDefines=[...T];const N=x?x.getBinderAttributes():[],V=(m.staticAttributes||[]).concat(N);let q=x?x.defines():[];q=q.concat(T.map(ve=>`#define ${ve}`));const Z=`#version 300 es
`;let K=Z+q.concat("precision mediump float;",Su,wu.fragmentSource).join(`
`);for(const ve of m.fragmentIncludes)K+=`
${Dc[ve]}`;K+=`
${m.fragmentSource}`;let ne=Z+q.concat("precision highp float;",Su,wu.vertexSource).join(`
`);for(const ve of m.vertexIncludes)ne+=`
${Dc[ve]}`;this.forceManualRenderingForInstanceIDShaders=i.forceManualRenderingForInstanceIDShaders&&m.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(ne+=`
uniform int u_instanceID;
`),ne+=`
${m.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(ne=ne.replaceAll("gl_InstanceID","u_instanceID"));const fe=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);P.shaderSource(fe,K),P.compileShader(fe),P.attachShader(this.program,fe);const ue=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(ue,ne),P.compileShader(ue),P.attachShader(this.program,ue),this.attributes={},this.numAttributes=V.length;for(let ve=0;ve<this.numAttributes;ve++)if(V[ve]){const ge=V[ve].startsWith("a_")?V[ve]:`a_${V[ve]}`;P.bindAttribLocation(this.program,ve,ge),this.attributes[ge]=ve}P.linkProgram(this.program),P.deleteShader(ue),P.deleteShader(fe),this.fixedUniforms=b(i),this.binderUniforms=x?x.getUniforms(i):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ve=>({u_instanceID:new r.bN(ve)}))(i)),(T.includes("TERRAIN")||s.indexOf("symbol")!==-1||s.indexOf("circle")!==-1)&&(this.terrainUniforms=(ve=>({u_dem:new r.bN(ve),u_dem_prev:new r.bN(ve),u_dem_tl:new r.bK(ve),u_dem_scale:new r.bM(ve),u_dem_tl_prev:new r.bK(ve),u_dem_scale_prev:new r.bM(ve),u_dem_size:new r.bM(ve),u_dem_lerp:new r.bM(ve),u_exaggeration:new r.bM(ve),u_depth:new r.bN(ve),u_depth_size_inv:new r.bK(ve),u_depth_range_unpack:new r.bK(ve),u_occluder_half_size:new r.bM(ve),u_occlusion_depth_offset:new r.bM(ve),u_meter_to_dem:new r.bM(ve),u_label_plane_matrix_inv:new r.bJ(ve)}))(i)),T.includes("GLOBE")&&(this.globeUniforms=(ve=>({u_tile_tl_up:new r.bL(ve),u_tile_tr_up:new r.bL(ve),u_tile_br_up:new r.bL(ve),u_tile_bl_up:new r.bL(ve),u_tile_up_scale:new r.bM(ve)}))(i)),T.includes("FOG")&&(this.fogUniforms=(ve=>({u_fog_matrix:new r.bJ(ve),u_fog_range:new r.bK(ve),u_fog_color:new r.ca(ve),u_fog_horizon_blend:new r.bM(ve),u_fog_vertical_limit:new r.bK(ve),u_fog_temporal_offset:new r.bM(ve),u_frustum_tl:new r.bL(ve),u_frustum_tr:new r.bL(ve),u_frustum_br:new r.bL(ve),u_frustum_bl:new r.bL(ve),u_globe_pos:new r.bL(ve),u_globe_radius:new r.bM(ve),u_globe_transition:new r.bM(ve),u_is_globe:new r.bN(ve),u_viewport:new r.bK(ve)}))(i)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ve=>({u_cutoff_params:new r.ca(ve)}))(i)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ve=>({u_lighting_ambient_color:new r.bL(ve),u_lighting_directional_dir:new r.bL(ve),u_lighting_directional_color:new r.bL(ve),u_ground_radiance:new r.bL(ve)}))(i)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ve=>({u_light_matrix_0:new r.bJ(ve),u_light_matrix_1:new r.bJ(ve),u_fade_range:new r.bK(ve),u_shadow_normal_offset:new r.bL(ve),u_shadow_intensity:new r.bM(ve),u_shadow_texel_size:new r.bM(ve),u_shadow_map_resolution:new r.bM(ve),u_shadow_direction:new r.bL(ve),u_shadow_bias:new r.bL(ve),u_shadowmap_0:new r.bN(ve),u_shadowmap_1:new r.bN(ve)}))(i))}}setTerrainUniformValues(i,s){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in s)m[x]&&m[x].set(this.program,x,s[x])}}setGlobeUniformValues(i,s){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in s)m[x]&&m[x].set(this.program,x,s[x])}}setFogUniformValues(i,s){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in s)m[x].set(this.program,x,s[x])}}setCutoffUniformValues(i,s){if(!this.cutoffUniforms)return;const m=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in s)m[x].set(this.program,x,s[x])}}setLightsUniformValues(i,s){if(!this.lightsUniforms)return;const m=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in s)m[x].set(this.program,x,s[x])}}setShadowUniformValues(i,s){if(this.failedToCreate||!this.shadowUniforms)return;const m=this.shadowUniforms;i.program.set(this.program);for(const x in s)m[x].set(this.program,x,s[x])}_drawDebugWireframe(i,s,m,x,b,T,P,N,V,q){const Z=i.options.wireframe;if(Z.terrain===!1&&Z.layers2D===!1&&Z.layers3D===!1)return;const K=i.context;if(!(!(!Z.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Z.layers2D||i._terrain&&i._terrain.renderingToTexture||!Ja.includes(this.name))||!(!Z.layers3D||!Zd.includes(this.name))))return;const ne=K.gl,fe=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,b,K);if(!fe)return;const ue=[...this.fixedDefines];ue.push("DEBUG_WIREFRAME");const ve=i.getOrCreateProgram(this.name,{config:this.configuration,defines:ue});K.program.set(ve.program);const ge=(Le,qe,Ne)=>{if(qe[Le]&&Ne[Le])for(const Ge in qe[Le])Ne[Le][Ge]&&Ne[Le][Ge].set(Ne.program,Ge,qe[Le][Ge].current)};V&&V.setUniforms(ve.program,K,ve.binderUniforms,P,{zoom:N}),ge("fixedUniforms",this,ve),ge("terrainUniforms",this,ve),ge("globeUniforms",this,ve),ge("fogUniforms",this,ve),ge("lightsUniforms",this,ve),ge("shadowUniforms",this,ve),fe.bind(),K.setColorMode(new Ui([ne.ONE,ne.ONE_MINUS_SRC_ALPHA,ne.ZERO,ne.ONE],r.aj.transparent,[!0,!0,!0,!1])),K.setDepthMode(new Qn(s.func===ne.LESS?ne.LEQUAL:s.func,Qn.ReadOnly,s.range)),K.setStencilMode(pi.disabled);const Ce=3*T.primitiveLength*2,ze=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Le=q||1;for(let qe=0;qe<Le;++qe)ve.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",qe),ne.drawElements(ne.LINES,Ce,ne.UNSIGNED_SHORT,ze)}else q&&q>1?ne.drawElementsInstanced(ne.LINES,Ce,ne.UNSIGNED_SHORT,ze,q):ne.drawElements(ne.LINES,Ce,ne.UNSIGNED_SHORT,ze);b.bind(),K.program.set(this.program),K.setDepthMode(s),K.setStencilMode(m),K.setColorMode(x)}checkUniforms(i,s,m){if(this.fixedDefines.includes(s)){for(const x of Object.keys(m))if(!m[x].initialized)throw new Error(`Program '${this.name}', from draw '${i}': uniform ${x} not set but required by ${s} being defined`)}}draw(i,s,m,x,b,T,P,N,V,q,Z,K,ne,fe,ue,ve){const ge=i.context,Ce=ge.gl;if(this.failedToCreate)return;ge.program.set(this.program),ge.setDepthMode(m),ge.setStencilMode(x),ge.setColorMode(b),ge.setCullFace(T);for(const qe of Object.keys(this.fixedUniforms))this.fixedUniforms[qe].set(this.program,qe,P[qe]);fe&&fe.setUniforms(this.program,ge,this.binderUniforms,K,{zoom:ne});const ze={[Ce.POINTS]:1,[Ce.LINES]:2,[Ce.TRIANGLES]:3,[Ce.LINE_STRIP]:1}[s];this.checkUniforms(N,"RENDER_SHADOWS",this.shadowUniforms);const Le=ve&&ve>0?1:void 0;for(const qe of Z.get()){const Ne=qe.vaos||(qe.vaos={});if((Ne[N]||(Ne[N]=new Eu)).bind(ge,this,V,fe?fe.getPaintVertexBuffers():[],q,qe.vertexOffset,ue||[],Le),this.forceManualRenderingForInstanceIDShaders){const Ge=ve||1;for(let Be=0;Be<Ge;++Be)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Be),q?Ce.drawElements(s,qe.primitiveLength*ze,Ce.UNSIGNED_SHORT,qe.primitiveOffset*ze*2):Ce.drawArrays(s,qe.vertexOffset,qe.vertexLength)}else ve&&ve>1?Ce.drawElementsInstanced(s,qe.primitiveLength*ze,Ce.UNSIGNED_SHORT,qe.primitiveOffset*ze*2,ve):q?Ce.drawElements(s,qe.primitiveLength*ze,Ce.UNSIGNED_SHORT,qe.primitiveOffset*ze*2):Ce.drawArrays(s,qe.vertexOffset,qe.vertexLength);s===Ce.TRIANGLES&&q&&this._drawDebugWireframe(i,m,x,b,q,qe,K,ne,fe,ve)}}}function Sp(f,i){const s=Math.pow(2,i.tileID.overscaledZ),m=i.tileSize*Math.pow(2,f.transform.tileZoom)/s,x=m*(i.tileID.canonical.x+i.tileID.wrap*s),b=m*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ar(i,1,f.transform.tileZoom),u_pixel_coord_upper:[x>>16,b>>16],u_pixel_coord_lower:[65535&x,65535&b]}}const Ph={terrain:0,flat:1},ya=r.ab.mat4.create(),Lh=(f,i,s,m,x,b,T,P,N,V,q,Z,K,ne,fe,ue,ve,ge)=>{const Ce=i.style.light,ze=Ce.properties.get("position"),Le=[ze.x,ze.y,ze.z],qe=r.ab.mat3.create();Ce.properties.get("anchor")==="viewport"&&(r.ab.mat3.fromRotation(qe,-i.transform.angle),r.ab.vec3.transformMat3(Le,Le,qe));const Ne=Ce.properties.get("color"),Ge=i.transform,Be={u_matrix:f,u_lightpos:Le,u_lightintensity:Ce.properties.get("intensity"),u_lightcolor:[Ne.r,Ne.g,Ne.b],u_vertical_gradient:+s,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ya,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Ph[V],u_base_type:Ph[q],u_ao:x,u_edge_radius:b,u_width_scale:T,u_flood_light_color:fe,u_vertical_scale:ue,u_flood_light_intensity:ve,u_ground_shadow_factor:ge};return Ge.projection.name==="globe"&&(Be.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],Be.u_zoom_transition=Z,Be.u_inv_rot_matrix=ne,Be.u_merc_center=K,Be.u_up_dir=Ge.projection.upVector(new r.bT(0,0,0),K[0]*r.ag,K[1]*r.ag),Be.u_height_lift=N),Be},$l=(f,i,s,m,x,b)=>({u_matrix:f,u_edge_radius:i,u_width_scale:s,u_vertical_scale:m,u_height_type:Ph[x],u_base_type:Ph[b]}),Oh=(f,i,s,m,x,b,T,P,N,V,q,Z,K,ne,fe,ue,ve)=>{const ge=Lh(f,i,s,m,x,b,T,P,V,q,Z,K,ne,fe,ue,ve,1,[0,0,0]),Ce={u_height_factor:-Math.pow(2,P.overscaledZ)/N.tileSize/8};return r.l(ge,Sp(i,N),Ce)},Du=(f,i)=>({u_matrix:f,u_emissive_strength:i}),_l=(f,i,s,m)=>r.l(Du(f,i),Sp(s,m)),Nc=(f,i,s)=>({u_matrix:f,u_world:s,u_emissive_strength:i}),O_=(f,i,s,m,x)=>r.l(_l(f,i,s,m),{u_world:x}),z_=(f,i,s,m)=>{const x=r.ag/s.tileSize;return{u_matrix:f,u_camera_to_center_distance:i.getCameraToCenterDistance(m),u_extrude_scale:[i.pixelsToGLUnits[0]/x,i.pixelsToGLUnits[1]/x]}},Pu=(f,i,s=1)=>({u_matrix:f,u_color:i.toRenderColor(null),u_overlay:0,u_overlay_scale:s}),Yd=r.ab.mat4.create(),Ln=(f,i,s,m,x,b,T)=>{const P=f.transform,N=P.projection.name==="globe",V=N?r.cN(P.zoom,i.canonical)*P._pixelsPerMercatorPixel:r.ar(s,1,b),q={u_matrix:i.projMatrix,u_extrude_scale:V,u_intensity:T,u_inv_rot_matrix:Yd,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(N){q.u_inv_rot_matrix=m,q.u_merc_center=x,q.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],q.u_zoom_transition=r.ae(P.zoom);const Z=x[0]*r.ag,K=x[1]*r.ag;q.u_up_dir=P.projection.upVector(new r.bT(0,0,0),Z,K)}return q};function Kd(f,[i,s,m,x],[b,T]){if(b===T)return[0,0,0,0];const P=255*(f-1)/(f*(T-b));return[i*P,s*P,m*P,x*P]}function zh(f,i,[s,m]){return s===m?0:.5/f+(i-s)*(f-1)/(f*(m-s))}const Xl=(f,i,s,m,x,b,T,P,N,V,q,Z,K,ne,fe,ue,ve,ge,Ce,ze,Le)=>({u_matrix:f,u_normalize_matrix:i,u_globe_matrix:s,u_merc_matrix:m,u_grid_matrix:x,u_tl_parent:b,u_scale_parent:V,u_fade_t:q.mix,u_opacity:q.opacity*Z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Z.paint.get("raster-brightness-min"),u_brightness_high:Z.paint.get("raster-brightness-max"),u_saturation_factor:r.cO(Z.paint.get("raster-saturation")),u_contrast_factor:r.cP(Z.paint.get("raster-contrast")),u_spin_weights:Qo(Z.paint.get("raster-hue-rotate")),u_perspective_transform:K,u_raster_elevation:ne,u_zoom_transition:T,u_merc_center:P,u_cutoff_params:N,u_colorization_mix:Kd(r.cQ,ue,ge),u_colorization_offset:zh(r.cQ,ve,ge),u_color_ramp:fe,u_texture_offset:[ze/(Ce+2*ze),Ce/(Ce+2*ze)],u_texture_res:[Ce+2*ze,Ce+2*ze],u_emissive_strength:Le});function Qo(f){f*=Math.PI/180;const i=Math.sin(f),s=Math.cos(f);return[(2*s+1)/3,(-Math.sqrt(3)*i-s+1)/3,(Math.sqrt(3)*i-s+1)/3]}const gn=.05,Wr=(f,i,s,m,x,b,T,P,N,V,q,Z)=>({u_matrix:f,u_normalize_matrix:i,u_globe_matrix:s,u_merc_matrix:m,u_grid_matrix:x,u_tl_parent:b,u_scale_parent:V,u_fade_t:q.mix,u_opacity:q.opacity,u_image0:0,u_image1:1,u_raster_elevation:Z,u_zoom_transition:T,u_merc_center:P,u_cutoff_params:N}),Ga=(f,i,s,m,x,b,T,P,N,V)=>({u_particle_texture:f,u_particle_texture_side_len:i,u_tile_offset:s,u_velocity:m,u_color_ramp:b,u_velocity_res:x,u_max_speed:T,u_uv_offset:P,u_data_scale:[255*N[0],255*N[1]],u_data_offset:V,u_particle_pos_scale:1.1,u_particle_pos_offset:[gn,gn]}),Ep=(f,i,s,m,x,b,T,P,N,V)=>({u_particle_texture:f,u_particle_texture_side_len:i,u_velocity:s,u_velocity_res:m,u_max_speed:x,u_speed_factor:b,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:P,u_data_scale:[255*N[0],255*N[1]],u_data_offset:V,u_particle_pos_scale:1.1,u_particle_pos_offset:[gn,gn]}),Zl=r.ab.mat4.create(),Yl=(f,i,s,m,x,b,T,P,N,V,q,Z,K,ne,fe,ue,ve,ge,Ce,ze,Le,qe)=>{const Ne=x.transform,Ge={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:Ne.getCameraToCenterDistance(Ce),u_rotate_symbol:+s,u_aspect_ratio:Ne.width/Ne.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:P,u_is_text:+V,u_elevation_from_sea:N?1:0,u_pitch_with_map:+m,u_texsize:q,u_texsize_icon:Z,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Zl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Zl,u_up_vector:[0,-1,0],u_color_adj_mat:ze,u_icon_transition:Le||0,u_gamma_scale:m?x.transform.getCameraToCenterDistance(Ce)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:r.q.devicePixelRatio,u_is_halo:1,u_scale_factor:qe||1};return Ce.name==="globe"&&(Ge.u_tile_id=[ne.canonical.x,ne.canonical.y,1<<ne.canonical.z],Ge.u_zoom_transition=fe,Ge.u_inv_rot_matrix=ve,Ge.u_merc_center=ue,Ge.u_camera_forward=Ne._camera.forward(),Ge.u_ecef_origin=r.cR(Ne.globeMatrix,ne.toUnwrapped()),Ge.u_tile_matrix=Float32Array.from(Ne.globeMatrix),Ge.u_up_vector=ge),Ge},kh=(f,i,s,m)=>({u_matrix:f,u_emissive_strength:i,u_opacity:s,u_color:m}),Fh=(f,i,s,m,x,b,T,P,N)=>r.l(function(V,q,Z,K,ne,fe){const{width:ue,height:ve}=K.imageManager.getPixelSize(q),ge=Math.pow(2,fe.tileID.overscaledZ),Ce=fe.tileSize*Math.pow(2,K.transform.tileZoom)/ge,ze=Ce*(fe.tileID.canonical.x+fe.tileID.wrap*ge),Le=Ce*fe.tileID.canonical.y;return{u_image:0,u_pattern_tl:Z.tl,u_pattern_br:Z.br,u_texsize:[ue,ve],u_pattern_size:Z.displaySize,u_pattern_units_to_pixels:ne?[K.transform.width,-1*K.transform.height]:[1/r.ar(fe,1,K.transform.tileZoom),1/r.ar(fe,1,K.transform.tileZoom)],u_pixel_coord_upper:[ze>>16,Le>>16],u_pixel_coord_lower:[65535&ze,65535&Le]}}(0,b,T,m,P,N),{u_matrix:f,u_emissive_strength:i,u_opacity:s}),Bc=new Float32Array(r.ab.mat4.identity([])),Jd=(f,i,s,m,x,b,T,P,N,V,q,Z,K,ne=[0,0,0],fe)=>{const ue=x.style.light,ve=ue.properties.get("position"),ge=[-ve.x,-ve.y,ve.z],Ce=r.ab.mat3.create();ue.properties.get("anchor")==="viewport"&&(r.ab.mat3.fromRotation(Ce,-x.transform.angle),r.ab.vec3.transformMat3(ge,ge,Ce));const ze=q.alphaMode==="MASK",Le=ue.properties.get("color").toRenderColor(null),qe=K.paint.get("model-ambient-occlusion-intensity"),Ne=K.paint.get("model-color").constantOr(r.aj.white).toRenderColor(null),Ge=K.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:f,u_lighting_matrix:i,u_normal_matrix:s,u_node_matrix:m||Bc,u_lightpos:ge,u_lightintensity:ue.properties.get("intensity"),u_lightcolor:[Le.r,Le.g,Le.b],u_camera_pos:ne,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+ze,u_alphaCutoff:q.alphaCutoff,u_baseColorFactor:[T.r,T.g,T.b,T.a],u_emissiveFactor:[P[0],P[1],P[2],1],u_metallicFactor:N,u_roughnessFactor:V,u_baseColorTexture:ja.BaseColor,u_metallicRoughnessTexture:ja.MetallicRoughness,u_normalTexture:ja.Normal,u_occlusionTexture:ja.Occlusion,u_emissionTexture:ja.Emission,u_lutTexture:ja.LUT,u_color_mix:[Ne.r,Ne.g,Ne.b,Ge],u_aoIntensity:qe,u_emissive_strength:Z,u_occlusionTextureTransform:fe||[0,0,0,0]}},xa=(f,i=Bc,s=Bc)=>({u_matrix:f,u_instance:i,u_node_matrix:s}),Qd={fillExtrusion:f=>({u_matrix:new r.bJ(f),u_lightpos:new r.bL(f),u_lightintensity:new r.bM(f),u_lightcolor:new r.bL(f),u_vertical_gradient:new r.bM(f),u_opacity:new r.bM(f),u_edge_radius:new r.bM(f),u_width_scale:new r.bM(f),u_ao:new r.bK(f),u_height_type:new r.bN(f),u_base_type:new r.bN(f),u_tile_id:new r.bL(f),u_zoom_transition:new r.bM(f),u_inv_rot_matrix:new r.bJ(f),u_merc_center:new r.bK(f),u_up_dir:new r.bL(f),u_height_lift:new r.bM(f),u_flood_light_color:new r.bL(f),u_vertical_scale:new r.bM(f),u_flood_light_intensity:new r.bM(f),u_ground_shadow_factor:new r.bL(f)}),fillExtrusionDepth:f=>({u_matrix:new r.bJ(f),u_edge_radius:new r.bM(f),u_width_scale:new r.bM(f),u_vertical_scale:new r.bM(f),u_height_type:new r.bN(f),u_base_type:new r.bN(f)}),fillExtrusionPattern:f=>({u_matrix:new r.bJ(f),u_lightpos:new r.bL(f),u_lightintensity:new r.bM(f),u_lightcolor:new r.bL(f),u_vertical_gradient:new r.bM(f),u_height_factor:new r.bM(f),u_edge_radius:new r.bM(f),u_width_scale:new r.bM(f),u_ao:new r.bK(f),u_height_type:new r.bN(f),u_base_type:new r.bN(f),u_tile_id:new r.bL(f),u_zoom_transition:new r.bM(f),u_inv_rot_matrix:new r.bJ(f),u_merc_center:new r.bK(f),u_up_dir:new r.bL(f),u_height_lift:new r.bM(f),u_image:new r.bN(f),u_texsize:new r.bK(f),u_pixel_coord_upper:new r.bK(f),u_pixel_coord_lower:new r.bK(f),u_tile_units_to_pixels:new r.bM(f),u_opacity:new r.bM(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new r.bJ(f),u_opacity:new r.bM(f),u_ao_pass:new r.bM(f),u_meter_to_tile:new r.bM(f),u_ao:new r.bK(f),u_flood_light_intensity:new r.bM(f),u_flood_light_color:new r.bL(f),u_attenuation:new r.bM(f),u_edge_radius:new r.bM(f),u_fb:new r.bN(f),u_fb_size:new r.bM(f),u_dynamic_offset:new r.bM(f)}),fill:f=>({u_matrix:new r.bJ(f),u_emissive_strength:new r.bM(f)}),fillPattern:f=>({u_matrix:new r.bJ(f),u_emissive_strength:new r.bM(f),u_image:new r.bN(f),u_texsize:new r.bK(f),u_pixel_coord_upper:new r.bK(f),u_pixel_coord_lower:new r.bK(f),u_tile_units_to_pixels:new r.bM(f)}),fillOutline:f=>({u_matrix:new r.bJ(f),u_emissive_strength:new r.bM(f),u_world:new r.bK(f)}),fillOutlinePattern:f=>({u_matrix:new r.bJ(f),u_emissive_strength:new r.bM(f),u_world:new r.bK(f),u_image:new r.bN(f),u_texsize:new r.bK(f),u_pixel_coord_upper:new r.bK(f),u_pixel_coord_lower:new r.bK(f),u_tile_units_to_pixels:new r.bM(f)}),circle:r.cS,collisionBox:f=>({u_matrix:new r.bJ(f),u_camera_to_center_distance:new r.bM(f),u_extrude_scale:new r.bK(f)}),collisionCircle:f=>({u_matrix:new r.bJ(f),u_inv_matrix:new r.bJ(f),u_camera_to_center_distance:new r.bM(f),u_viewport_size:new r.bK(f)}),debug:f=>({u_color:new r.cz(f),u_matrix:new r.bJ(f),u_overlay:new r.bN(f),u_overlay_scale:new r.bM(f)}),clippingMask:f=>({u_matrix:new r.bJ(f)}),heatmap:f=>({u_extrude_scale:new r.bM(f),u_intensity:new r.bM(f),u_matrix:new r.bJ(f),u_inv_rot_matrix:new r.bJ(f),u_merc_center:new r.bK(f),u_tile_id:new r.bL(f),u_zoom_transition:new r.bM(f),u_up_dir:new r.bL(f)}),heatmapTexture:f=>({u_image:new r.bN(f),u_color_ramp:new r.bN(f),u_opacity:new r.bM(f)}),hillshade:f=>({u_matrix:new r.bJ(f),u_image:new r.bN(f),u_latrange:new r.bK(f),u_light:new r.bK(f),u_shadow:new r.cz(f),u_highlight:new r.cz(f),u_emissive_strength:new r.bM(f),u_accent:new r.cz(f)}),hillshadePrepare:f=>({u_matrix:new r.bJ(f),u_image:new r.bN(f),u_dimension:new r.bK(f),u_zoom:new r.bM(f)}),line:r.cT,linePattern:r.cU,raster:f=>({u_matrix:new r.bJ(f),u_normalize_matrix:new r.bJ(f),u_globe_matrix:new r.bJ(f),u_merc_matrix:new r.bJ(f),u_grid_matrix:new r.cA(f),u_tl_parent:new r.bK(f),u_scale_parent:new r.bM(f),u_fade_t:new r.bM(f),u_opacity:new r.bM(f),u_image0:new r.bN(f),u_image1:new r.bN(f),u_brightness_low:new r.bM(f),u_brightness_high:new r.bM(f),u_saturation_factor:new r.bM(f),u_contrast_factor:new r.bM(f),u_spin_weights:new r.bL(f),u_perspective_transform:new r.bK(f),u_raster_elevation:new r.bM(f),u_zoom_transition:new r.bM(f),u_merc_center:new r.bK(f),u_cutoff_params:new r.ca(f),u_colorization_mix:new r.ca(f),u_colorization_offset:new r.bM(f),u_color_ramp:new r.bN(f),u_texture_offset:new r.bK(f),u_texture_res:new r.bK(f),u_emissive_strength:new r.bM(f)}),rasterParticle:f=>({u_matrix:new r.bJ(f),u_normalize_matrix:new r.bJ(f),u_globe_matrix:new r.bJ(f),u_merc_matrix:new r.bJ(f),u_grid_matrix:new r.cA(f),u_tl_parent:new r.bK(f),u_scale_parent:new r.bM(f),u_fade_t:new r.bM(f),u_opacity:new r.bM(f),u_image0:new r.bN(f),u_image1:new r.bN(f),u_raster_elevation:new r.bM(f),u_zoom_transition:new r.bM(f),u_merc_center:new r.bK(f),u_cutoff_params:new r.ca(f)}),rasterParticleTexture:f=>({u_texture:new r.bN(f),u_opacity:new r.bM(f)}),rasterParticleDraw:f=>({u_particle_texture:new r.bN(f),u_particle_texture_side_len:new r.bM(f),u_tile_offset:new r.bK(f),u_velocity:new r.bN(f),u_color_ramp:new r.bN(f),u_velocity_res:new r.bK(f),u_max_speed:new r.bM(f),u_uv_offset:new r.bK(f),u_data_scale:new r.bK(f),u_data_offset:new r.bM(f),u_particle_pos_scale:new r.bM(f),u_particle_pos_offset:new r.bK(f)}),rasterParticleUpdate:f=>({u_particle_texture:new r.bN(f),u_particle_texture_side_len:new r.bM(f),u_velocity:new r.bN(f),u_velocity_res:new r.bK(f),u_max_speed:new r.bM(f),u_speed_factor:new r.bM(f),u_reset_rate:new r.bM(f),u_rand_seed:new r.bM(f),u_uv_offset:new r.bK(f),u_data_scale:new r.bK(f),u_data_offset:new r.bM(f),u_particle_pos_scale:new r.bM(f),u_particle_pos_offset:new r.bK(f)}),symbol:f=>({u_is_size_zoom_constant:new r.bN(f),u_is_size_feature_constant:new r.bN(f),u_size_t:new r.bM(f),u_size:new r.bM(f),u_camera_to_center_distance:new r.bM(f),u_rotate_symbol:new r.bN(f),u_aspect_ratio:new r.bM(f),u_fade_change:new r.bM(f),u_matrix:new r.bJ(f),u_label_plane_matrix:new r.bJ(f),u_coord_matrix:new r.bJ(f),u_is_text:new r.bN(f),u_elevation_from_sea:new r.bN(f),u_pitch_with_map:new r.bN(f),u_texsize:new r.bK(f),u_texsize_icon:new r.bK(f),u_texture:new r.bN(f),u_texture_icon:new r.bN(f),u_gamma_scale:new r.bM(f),u_device_pixel_ratio:new r.bM(f),u_tile_id:new r.bL(f),u_zoom_transition:new r.bM(f),u_inv_rot_matrix:new r.bJ(f),u_merc_center:new r.bK(f),u_camera_forward:new r.bL(f),u_tile_matrix:new r.bJ(f),u_up_vector:new r.bL(f),u_ecef_origin:new r.bL(f),u_is_halo:new r.bN(f),u_icon_transition:new r.bM(f),u_color_adj_mat:new r.bJ(f),u_scale_factor:new r.bM(f)}),background:f=>({u_matrix:new r.bJ(f),u_emissive_strength:new r.bM(f),u_opacity:new r.bM(f),u_color:new r.cz(f)}),backgroundPattern:f=>({u_matrix:new r.bJ(f),u_emissive_strength:new r.bM(f),u_opacity:new r.bM(f),u_image:new r.bN(f),u_pattern_tl:new r.bK(f),u_pattern_br:new r.bK(f),u_texsize:new r.bK(f),u_pattern_size:new r.bK(f),u_pixel_coord_upper:new r.bK(f),u_pixel_coord_lower:new r.bK(f),u_pattern_units_to_pixels:new r.bK(f)}),terrainRaster:f=>({u_matrix:new r.bJ(f),u_image0:new r.bN(f),u_skirt_height:new r.bM(f),u_ground_shadow_factor:new r.bL(f)}),skybox:f=>({u_matrix:new r.bJ(f),u_sun_direction:new r.bL(f),u_cubemap:new r.bN(f),u_opacity:new r.bM(f),u_temporal_offset:new r.bM(f)}),skyboxGradient:f=>({u_matrix:new r.bJ(f),u_color_ramp:new r.bN(f),u_center_direction:new r.bL(f),u_radius:new r.bM(f),u_opacity:new r.bM(f),u_temporal_offset:new r.bM(f)}),skyboxCapture:f=>({u_matrix_3f:new r.cA(f),u_sun_direction:new r.bL(f),u_sun_intensity:new r.bM(f),u_color_tint_r:new r.ca(f),u_color_tint_m:new r.ca(f),u_luminance:new r.bM(f)}),globeRaster:f=>({u_proj_matrix:new r.bJ(f),u_globe_matrix:new r.bJ(f),u_normalize_matrix:new r.bJ(f),u_merc_matrix:new r.bJ(f),u_zoom_transition:new r.bM(f),u_merc_center:new r.bK(f),u_image0:new r.bN(f),u_grid_matrix:new r.cA(f),u_skirt_height:new r.bM(f),u_far_z_cutoff:new r.bM(f),u_frustum_tl:new r.bL(f),u_frustum_tr:new r.bL(f),u_frustum_br:new r.bL(f),u_frustum_bl:new r.bL(f),u_globe_pos:new r.bL(f),u_globe_radius:new r.bM(f),u_viewport:new r.bK(f)}),globeAtmosphere:f=>({u_frustum_tl:new r.bL(f),u_frustum_tr:new r.bL(f),u_frustum_br:new r.bL(f),u_frustum_bl:new r.bL(f),u_horizon:new r.bM(f),u_transition:new r.bM(f),u_fadeout_range:new r.bM(f),u_color:new r.ca(f),u_high_color:new r.ca(f),u_space_color:new r.ca(f),u_temporal_offset:new r.bM(f),u_horizon_angle:new r.bM(f)}),model:f=>({u_matrix:new r.bJ(f),u_lighting_matrix:new r.bJ(f),u_normal_matrix:new r.bJ(f),u_node_matrix:new r.bJ(f),u_lightpos:new r.bL(f),u_lightintensity:new r.bM(f),u_lightcolor:new r.bL(f),u_camera_pos:new r.bL(f),u_opacity:new r.bM(f),u_baseColorFactor:new r.ca(f),u_emissiveFactor:new r.ca(f),u_metallicFactor:new r.bM(f),u_roughnessFactor:new r.bM(f),u_baseTextureIsAlpha:new r.bN(f),u_alphaMask:new r.bN(f),u_alphaCutoff:new r.bM(f),u_baseColorTexture:new r.bN(f),u_metallicRoughnessTexture:new r.bN(f),u_normalTexture:new r.bN(f),u_occlusionTexture:new r.bN(f),u_emissionTexture:new r.bN(f),u_lutTexture:new r.bN(f),u_color_mix:new r.ca(f),u_aoIntensity:new r.bM(f),u_emissive_strength:new r.bM(f),u_occlusionTextureTransform:new r.ca(f)}),modelDepth:f=>({u_matrix:new r.bJ(f),u_instance:new r.bJ(f),u_node_matrix:new r.bJ(f)}),groundShadow:f=>({u_matrix:new r.bJ(f),u_ground_shadow_factor:new r.bL(f)}),stars:f=>({u_matrix:new r.bJ(f),u_up:new r.bL(f),u_right:new r.bL(f),u_intensity_multiplier:new r.bM(f)}),snowParticle:f=>({u_modelview:new r.bJ(f),u_projection:new r.bJ(f),u_time:new r.bM(f),u_cam_pos:new r.bL(f),u_velocityConeAperture:new r.bM(f),u_velocity:new r.bM(f),u_horizontalOscillationRadius:new r.bM(f),u_horizontalOscillationRate:new r.bM(f),u_boxSize:new r.bM(f),u_billboardSize:new r.bM(f),u_simpleShapeParameters:new r.bK(f),u_screenSize:new r.bK(f),u_thinningCenterPos:new r.bK(f),u_thinningShape:new r.bL(f),u_thinningAffectedRatio:new r.bM(f),u_thinningParticleOffset:new r.bM(f),u_particleColor:new r.ca(f),u_direction:new r.bL(f)}),rainParticle:f=>({u_modelview:new r.bJ(f),u_projection:new r.bJ(f),u_time:new r.bM(f),u_cam_pos:new r.bL(f),u_texScreen:new r.bN(f),u_velocityConeAperture:new r.bM(f),u_velocity:new r.bM(f),u_boxSize:new r.bM(f),u_rainDropletSize:new r.bK(f),u_distortionStrength:new r.bM(f),u_rainDirection:new r.bL(f),u_color:new r.ca(f),u_screenSize:new r.bK(f),u_thinningCenterPos:new r.bK(f),u_thinningShape:new r.bL(f),u_thinningAffectedRatio:new r.bM(f),u_thinningParticleOffset:new r.bM(f),u_shapeDirectionalPower:new r.bM(f),u_shapeNormalPower:new r.bM(f),u_mode:new r.bM(f)}),vignette:f=>({u_vignetteShape:new r.bL(f),u_vignetteColor:new r.ca(f)}),occlusion:f=>({u_matrix:new r.bJ(f),u_anchorPos:new r.bL(f),u_screenSizePx:new r.bK(f),u_occluderSizePx:new r.bK(f),u_color:new r.ca(f)})};class Ds{constructor(i,s,m,x){this.id=Ds.uniqueIdxCounter,Ds.uniqueIdxCounter++,this.context=i;const b=i.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||x||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=Ds.uniqueIdxCounter,Ds.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ds.uniqueIdxCounter=0;const Fo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Kl{constructor(i,s,m,x,b,T){this.length=s.length,this.attributes=m,this.itemSize=s.bytesPerElement,this.dynamicDraw=x,this.instanceCount=T,this.context=i;const P=i.gl;this.buffer=P.createBuffer(),i.bindVertexBuffer.set(this.buffer),P.bufferData(P.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||b||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,s){for(let m=0;m<this.attributes.length;m++){const x=s.attributes[this.attributes[m].name];x!==void 0&&i.enableVertexAttribArray(x)}}setVertexAttribPointers(i,s,m){for(let x=0;x<this.attributes.length;x++){const b=this.attributes[x],T=s.attributes[b.name];T!==void 0&&i.vertexAttribPointer(T,b.components,i[Fo[b.type]],!1,this.itemSize,b.offset+this.itemSize*(m||0))}}setVertexAttribDivisor(i,s,m){for(let x=0;x<this.attributes.length;x++){const b=s.attributes[this.attributes[x].name];b!==void 0&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(b,m)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class eg{constructor(i,s,m,x,b){this.context=i,this.width=s,this.height=m;const T=this.framebuffer=i.gl.createFramebuffer();x&&(this.colorAttachment=new ql(i,T)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new Ru(i,T):new Xd(i,T))}destroy(){const i=this.context.gl;if(this.colorAttachment){const s=this.colorAttachment.get();s&&i.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const s=this.depthAttachment.get();s&&i.deleteRenderbuffer(s)}else{const s=this.depthAttachment.get();s&&i.deleteTexture(s)}i.deleteFramebuffer(this.framebuffer)}}class ef{constructor(i,s){this.gl=i,this.clearColor=new Th(this),this.clearDepth=new Zo(this),this.clearStencil=new Yo(this),this.colorMask=new Hl(this),this.depthMask=new fl(this),this.stencilMask=new pl(this),this.stencilFunc=new Au(this),this.stencilOp=new Ah(this),this.stencilTest=new Cu(this),this.depthRange=new pp(this),this.depthTest=new Kr(this),this.depthFunc=new Ka(this),this.blend=new Ir(this),this.blendFunc=new Ko(this),this.blendColor=new Rs(this),this.blendEquation=new Wd(this),this.cullFace=new ml(this),this.cullFaceSide=new mp(this),this.frontFace=new gp(this),this.program=new Oc(this),this.activeTexture=new Ch(this),this.viewport=new Rh(this),this.bindFramebuffer=new gl(this),this.bindRenderbuffer=new I_(this),this.bindTexture=new Jm(this),this.bindVertexBuffer=new D_(this),this.bindElementBuffer=new _p(this),this.bindVertexArrayOES=new P_(this),this.pixelStoreUnpack=new $d(this),this.pixelStoreUnpackPremultiplyAlpha=new vp(this),this.pixelStoreUnpackFlipY=new zc(this),this.options=s?Object.assign({},s):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=s&&!!s.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,s,m){return new Ds(this,i,s,m)}createVertexBuffer(i,s,m,x,b){return new Kl(this,i,s,m,x,b)}createRenderbuffer(i,s,m){const x=this.gl,b=x.createRenderbuffer();return this.bindRenderbuffer.set(b),x.renderbufferStorage(x.RENDERBUFFER,i,s,m),this.bindRenderbuffer.set(null),b}createFramebuffer(i,s,m,x){return new eg(this,i,s,m,x)}clear({color:i,depth:s,stencil:m,colorMask:x}){const b=this.gl;let T=0;i&&(T|=b.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set(x||[!0,!0,!0,!0])),s!==void 0&&(T|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),m!==void 0&&(T|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),b.clear(T)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){r.bn(i.blendFunction,Ui.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Uc;function Nh(f,i,s,m,x,b,T){const P=f.context,N=P.gl,V=f.transform,q=f.getOrCreateProgram("collisionBox"),Z=[];let K=0,ne=0;for(let Le=0;Le<m.length;Le++){const qe=m[Le],Ne=i.getTile(qe),Ge=Ne.getBucket(s);if(!Ge)continue;const Be=$s(qe,Ge,V);let Ke=Be;x[0]===0&&x[1]===0||(Ke=f.translatePosMatrix(Be,Ne,x,b));const it=T?Ge.textCollisionBox:Ge.iconCollisionBox,Rt=Ge.collisionCircleArray;if(Rt.length>0){const xt=r.ab.mat4.create(),jt=Ke;r.ab.mat4.mul(xt,Ge.placementInvProjMatrix,V.glCoordMatrix),r.ab.mat4.mul(xt,xt,Ge.placementViewportMatrix),Z.push({circleArray:Rt,circleOffset:ne,transform:jt,invTransform:xt,projection:Ge.getProjection()}),K+=Rt.length/4,ne=K}it&&(f.terrain&&f.terrain.setupElevationDraw(Ne,q),q.draw(f,N.LINES,Qn.disabled,pi.disabled,f.colorModeForRenderPass(),fi.disabled,z_(Ke,V,Ne,Ge.getProjection()),s.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,null,V.zoom,null,[it.collisionVertexBuffer,it.collisionVertexBufferExt]))}if(!T||!Z.length)return;const fe=f.getOrCreateProgram("collisionCircle"),ue=new r.cV;ue.resize(4*K),ue._trim();let ve=0;for(const Le of Z)for(let qe=0;qe<Le.circleArray.length/4;qe++){const Ne=4*qe,Ge=Le.circleArray[Ne+0],Be=Le.circleArray[Ne+1],Ke=Le.circleArray[Ne+2],it=Le.circleArray[Ne+3];ue.emplace(ve++,Ge,Be,Ke,it,0),ue.emplace(ve++,Ge,Be,Ke,it,1),ue.emplace(ve++,Ge,Be,Ke,it,2),ue.emplace(ve++,Ge,Be,Ke,it,3)}(!Uc||Uc.length<2*K)&&(Uc=function(Le){const qe=2*Le,Ne=new r.aU;Ne.resize(qe),Ne._trim();for(let Ge=0;Ge<qe;Ge++){const Be=6*Ge;Ne.uint16[Be+0]=4*Ge+0,Ne.uint16[Be+1]=4*Ge+1,Ne.uint16[Be+2]=4*Ge+2,Ne.uint16[Be+3]=4*Ge+2,Ne.uint16[Be+4]=4*Ge+3,Ne.uint16[Be+5]=4*Ge+0}return Ne}(K));const ge=P.createIndexBuffer(Uc,!0),Ce=P.createVertexBuffer(ue,r.cW.members,!0);for(const Le of Z){const qe={u_matrix:Le.transform,u_inv_matrix:Le.invTransform,u_camera_to_center_distance:(ze=V).getCameraToCenterDistance(Le.projection),u_viewport_size:[ze.width,ze.height]};fe.draw(f,N.TRIANGLES,Qn.disabled,pi.disabled,f.colorModeForRenderPass(),fi.disabled,qe,s.id,Ce,ge,r.b7.simpleSegment(0,2*Le.circleOffset,Le.circleArray.length,Le.circleArray.length/2),null,V.zoom)}var ze;Ce.destroy(),ge.destroy()}const ho=r.ab.mat4.create();function Br(f){const i=f._camera.getWorldToCamera(f.worldSize,1),s=r.ab.mat4.multiply([],i,f.globeMatrix);r.ab.mat4.invert(s,s);const m=[0,0,0],x=[0,1,0,0];return r.ab.vec4.transformMat4(x,x,s),m[0]=x[0],m[1]=x[1],m[2]=x[2],r.ab.vec3.normalize(m,m),m}function Er({width:f,height:i,anchor:s,textOffset:m,textScale:x},b){const{horizontalAlign:T,verticalAlign:P}=r.bD(s),N=-(T-.5)*f,V=-(P-.5)*i,q=r.bC(s,m);return new r.P((N/x+q[0])*b,(V/x+q[1])*b)}function Vc(f,i,s,m,x,b,T,P,N,V,q){const Z=f.text.placedSymbolArray,K=f.text.dynamicLayoutVertexArray,ne=f.icon.dynamicLayoutVertexArray,fe={},ue=f.getProjection(),ve=wc(P,ue,b),ge=b.elevation,Ce=ue.upVectorScale(P.canonical,b.center.lat,b.worldSize).metersToTile;K.clear();for(let ze=0;ze<Z.length;ze++){const Le=Z.get(ze),{tileAnchorX:qe,tileAnchorY:Ne,numGlyphs:Ge}=Le,Be=Le.hidden||!Le.crossTileID||f.allowVerticalPlacement&&!Le.placedOrientation?null:m[Le.crossTileID];if(Be){let Ke=0,it=0,Rt=0;if(ge){const Pt=ge?ge.getAtTileOffset(P,qe,Ne):0,[dn,Zt,Gt]=ue.upVector(P.canonical,qe,Ne);Ke=Pt*dn*Ce,it=Pt*Zt*Ce,Rt=Pt*Gt*Ce}let[xt,jt,zt,pt]=$a(Le.projectedAnchorX+Ke,Le.projectedAnchorY+it,Le.projectedAnchorZ+Rt,s?ve:T);const Dt=ap(b.getCameraToCenterDistance(ue),pt);let tn=x.evaluateSizeForFeature(f.textSizeData,V,Le)*Dt/r.bw;s&&(tn*=f.tilePixelRatio/N);const dt=Er(Be,tn);s?({x:xt,y:jt,z:zt}=ue.projectTilePoint(qe+dt.x,Ne+dt.y,P.canonical),[xt,jt,zt]=$a(xt+Ke,jt+it,zt+Rt,T)):(i&&dt._rotate(-b.angle),xt+=dt.x,jt+=dt.y,zt=0);const Ut=f.allowVerticalPlacement&&Le.placedOrientation===r.bq.vertical?Math.PI/2:0;for(let Pt=0;Pt<Ge;Pt++)r.bt(K,xt,jt,zt,Ut);q&&Le.associatedIconIndex>=0&&(fe[Le.associatedIconIndex]={x:xt,y:jt,z:zt,angle:Ut})}else Yr(Ge,K)}if(q){ne.clear();const ze=f.icon.placedSymbolArray;for(let Le=0;Le<ze.length;Le++){const qe=ze.get(Le),{numGlyphs:Ne}=qe,Ge=fe[Le];if(qe.hidden||!Ge)Yr(Ne,ne);else{const{x:Be,y:Ke,z:it,angle:Rt}=Ge;for(let xt=0;xt<Ne;xt++)r.bt(ne,Be,Ke,it,Rt)}}f.icon.dynamicLayoutVertexBuffer.updateData(ne)}f.text.dynamicLayoutVertexBuffer.updateData(K)}function jc(f,i,s,m,x,b,T={}){const P=s.paint.get("icon-translate"),N=s.paint.get("text-translate"),V=s.paint.get("icon-translate-anchor"),q=s.paint.get("text-translate-anchor"),Z=s.layout.get("icon-rotation-alignment"),K=s.layout.get("text-rotation-alignment"),ne=s.layout.get("icon-pitch-alignment"),fe=s.layout.get("text-pitch-alignment"),ue=s.layout.get("icon-keep-upright"),ve=s.layout.get("text-keep-upright"),ge=s.paint.get("icon-color-saturation"),Ce=s.paint.get("icon-color-contrast"),ze=s.paint.get("icon-color-brightness-min"),Le=s.paint.get("icon-color-brightness-max"),qe=s.layout.get("symbol-elevation-reference")==="sea",Ne=f.context,Ge=Ne.gl,Be=f.transform,Ke=Z==="map",it=K==="map",Rt=ne==="map",xt=fe==="map",jt=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let zt=!1;const pt=f.depthModeForSublayer(0,Qn.ReadOnly),Dt=[r.at(Be.center.lng),r.aA(Be.center.lat)],tn=s.layout.get("text-variable-anchor"),dt=Be.projection.name==="globe",Ut=[],Pt=[0,-1,0];for(const dn of m){const Zt=i.getTile(dn),Gt=Zt.getBucket(s);if(!Gt||Gt.projection.name==="mercator"&&dt||Gt.fullyClipped)continue;const rn=Gt.projection.name==="globe",mn=rn?r.ae(Be.zoom):0,Cn=wc(dn,Gt.getProjection(),Be),zn=Be.calculatePixelsToTileUnitsMatrix(Zt),ni=tn&&Gt.hasTextData(),Yn=Gt.hasIconTextFit()&&ni&&Gt.hasIconData(),Zn=Gt.getProjection().createInversionMatrix(Be,dn.canonical),mi=ri=>{Be.depthOcclusionForSymbolsAndCircles&&(s.hasInitialOcclusionOpacityProperties||f.terrain)&&(ri.push("DEPTH_D24"),ri.push("DEPTH_OCCLUSION"))},gi=()=>{const ri=Ke&&s.layout.get("symbol-placement")!=="point",hi=[];mi(hi);const Hi=ri||Yn,Lr=s.paint.get("icon-image-cross-fade").constantOr(0);f.terrainRenderModeElevated()&&Rt&&hi.push("PITCH_WITH_MAP_TERRAIN"),rn&&(hi.push("PROJECTION_GLOBE_VIEW"),Hi&&hi.push("PROJECTED_POS_ON_VIEWPORT")),Lr>0&&hi.push("ICON_TRANSITION"),Gt.icon.zOffsetVertexBuffer&&hi.push("Z_OFFSET"),ge===0&&Ce===0&&ze===0&&Le===1||hi.push("COLOR_ADJUSTMENT"),Gt.sdfIcons&&hi.push("RENDER_SDF");const jr=Gt.icon.programConfigurations.get(s.id),ea=f.getOrCreateProgram("symbol",{config:jr,defines:hi}),Vo=Zt.imageAtlasTexture?Zt.imageAtlasTexture.size:[0,0],ha=Gt.iconSizeData,Yi=r.bp(ha,Be.zoom),hr=Rt||Be.pitch!==0,ur=Fr(Cn,Zt.tileID.canonical,Rt,Ke,Be,Gt.getProjection(),zn),Xi=vh(Cn,Zt.tileID.canonical,Rt,Ke,Be,Gt.getProjection(),zn),Tr=f.translatePosMatrix(Xi,Zt,P,V,!0),la=f.translatePosMatrix(Cn,Zt,P,V),mr=Hi?ho:ur,ca=Ke&&!Rt&&!ri;let ns=Pt;!dt&&!Be.mercatorFromTransition||Ke||(ns=Br(Be));const Io=rn?ns:Pt,mo=s.getColorAdjustmentMatrix(ge,Ce,ze,Le),_s=Yl(ha.kind,Yi,ca,Rt,f,la,mr,Tr,qe,!1,Vo,[0,0],!0,dn,mn,Dt,Zn,Io,Gt.getProjection(),mo,Lr),to=Zt.imageAtlasTexture?Zt.imageAtlasTexture:null,Do=s.layout.get("icon-size").constantOr(0)!==1||Gt.iconsNeedLinear,vs=Gt.sdfIcons||f.options.rotating||f.options.zooming||Do||hr?Ge.LINEAR:Ge.NEAREST,is=Gt.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,ic=f.terrain&&Rt&&ri?r.ab.mat4.invert(r.ab.mat4.create(),ur):ho;if(ri&&Gt.icon){const eu=Be.elevation,tu=eu?eu.getAtTileOffsetFunc(dn,Be.center.lat,Be.worldSize,Gt.getProjection()):null,_f=Nr(Cn,Zt.tileID.canonical,Rt,Ke,Be,Gt.getProjection(),zn);yh(Gt,Cn,f,!1,_f,Xi,Rt,ue,tu,dn)}return{program:ea,buffers:Gt.icon,uniformValues:_s,atlasTexture:to,atlasTextureIcon:null,atlasInterpolation:vs,atlasInterpolationIcon:null,isSDF:Gt.sdfIcons,hasHalo:is,tile:Zt,labelPlaneMatrixInv:ic}},pr=()=>{const ri=it&&s.layout.get("symbol-placement")!=="point",hi=[],Hi=ri||tn||Yn;f.terrainRenderModeElevated()&&xt&&hi.push("PITCH_WITH_MAP_TERRAIN"),rn&&(hi.push("PROJECTION_GLOBE_VIEW"),Hi&&hi.push("PROJECTED_POS_ON_VIEWPORT")),Gt.text.zOffsetVertexBuffer&&hi.push("Z_OFFSET"),Gt.iconsInText&&hi.push("RENDER_TEXT_AND_SYMBOL"),hi.push("RENDER_SDF"),mi(hi);const Lr=Gt.text.programConfigurations.get(s.id),jr=f.getOrCreateProgram("symbol",{config:Lr,defines:hi});let ea,Vo=[0,0],ha=null;const Yi=Gt.textSizeData;Gt.iconsInText&&(Vo=Zt.imageAtlasTexture?Zt.imageAtlasTexture.size:[0,0],ha=Zt.imageAtlasTexture?Zt.imageAtlasTexture:null,ea=xt||Be.pitch!==0||f.options.rotating||f.options.zooming||Yi.kind==="composite"||Yi.kind==="camera"?Ge.LINEAR:Ge.NEAREST);const hr=Zt.glyphAtlasTexture?Zt.glyphAtlasTexture.size:[0,0],ur=s.layout.get("text-size-scale-range"),Xi=r.aw(f.scaleFactor,ur[0],ur[1]),Tr=r.bp(Yi,Be.zoom,Xi),la=Fr(Cn,Zt.tileID.canonical,xt,it,Be,Gt.getProjection(),zn),mr=vh(Cn,Zt.tileID.canonical,xt,it,Be,Gt.getProjection(),zn),ca=f.translatePosMatrix(mr,Zt,N,q,!0),ns=f.translatePosMatrix(Cn,Zt,N,q),Io=Hi?ho:la,mo=it&&!xt&&!ri;let _s=Pt;!dt&&!Be.mercatorFromTransition||it||(_s=Br(Be));const to=Yl(Yi.kind,Tr,mo,xt,f,ns,Io,ca,qe,!0,hr,Vo,!0,dn,mn,Dt,Zn,rn?_s:Pt,Gt.getProjection(),null,null,Xi),Do=Zt.glyphAtlasTexture?Zt.glyphAtlasTexture:null,vs=Ge.LINEAR,is=s.paint.get("text-halo-width").constantOr(1)!==0,ic=f.terrain&&xt&&ri?r.ab.mat4.invert(r.ab.mat4.create(),la):ho;if(ri&&Gt.text){const eu=Be.elevation,tu=eu?eu.getAtTileOffsetFunc(dn,Be.center.lat,Be.worldSize,Gt.getProjection()):null,_f=Nr(Cn,Zt.tileID.canonical,xt,it,Be,Gt.getProjection(),zn);yh(Gt,Cn,f,!0,_f,mr,xt,ve,tu,dn)}return{program:jr,buffers:Gt.text,uniformValues:to,atlasTexture:Do,atlasTextureIcon:ha,atlasInterpolation:vs,atlasInterpolationIcon:ea,isSDF:!0,hasHalo:is,tile:Zt,labelPlaneMatrixInv:ic}},Qr=Gt.icon.segments.get().length,Pr=Gt.text.segments.get().length,Ei=Qr&&!T.onlyText?gi():null,Qi=Pr&&!T.onlyIcons?pr():null,Rn=s.paint.get("icon-opacity").constantOr(1),li=s.paint.get("text-opacity").constantOr(1);if(jt&&Gt.canOverlap){zt=!0;const ri=Rn&&!T.onlyText?Gt.icon.segments.get():[],hi=li&&!T.onlyIcons?Gt.text.segments.get():[];for(const Hi of ri)Ut.push({segments:new r.b7([Hi]),sortKey:Hi.sortKey,state:Ei});for(const Hi of hi)Ut.push({segments:new r.b7([Hi]),sortKey:Hi.sortKey,state:Qi})}else T.onlyText||Ut.push({segments:Rn?Gt.icon.segments:new r.b7([]),sortKey:0,state:Ei}),T.onlyIcons||Ut.push({segments:li?Gt.text.segments:new r.b7([]),sortKey:0,state:Qi})}zt&&Ut.sort((dn,Zt)=>dn.sortKey-Zt.sortKey);for(const dn of Ut){const Zt=dn.state;if(Zt)if(f.terrain?f.terrain.setupElevationDraw(Zt.tile,Zt.program,{useDepthForOcclusion:Be.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Zt.labelPlaneMatrixInv}):f.setupDepthForOcclusion(Be.depthOcclusionForSymbolsAndCircles,Zt.program),Ne.activeTexture.set(Ge.TEXTURE0),Zt.atlasTexture&&Zt.atlasTexture.bind(Zt.atlasInterpolation,Ge.CLAMP_TO_EDGE,!0),Zt.atlasTextureIcon&&(Ne.activeTexture.set(Ge.TEXTURE1),Zt.atlasTextureIcon&&Zt.atlasTextureIcon.bind(Zt.atlasInterpolationIcon,Ge.CLAMP_TO_EDGE,!0)),f.uploadCommonLightUniforms(f.context,Zt.program),Zt.hasHalo){const Gt=Zt.uniformValues;Gt.u_is_halo=1,Bh(Zt.buffers,dn.segments,s,f,Zt.program,pt,x,b,Gt,2),Gt.u_is_halo=0}else{if(Zt.isSDF){const Gt=Zt.uniformValues;Zt.hasHalo&&(Gt.u_is_halo=1,Bh(Zt.buffers,dn.segments,s,f,Zt.program,pt,x,b,Gt,1)),Gt.u_is_halo=0}Bh(Zt.buffers,dn.segments,s,f,Zt.program,pt,x,b,Zt.uniformValues,1)}}}function Bh(f,i,s,m,x,b,T,P,N,V){const q=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer];x.draw(m,m.context.gl.TRIANGLES,b,T,P,fi.disabled,N,s.id,f.layoutVertexBuffer,f.indexBuffer,i,s.paint,m.transform.zoom,f.programConfigurations.get(s.id),q,V)}function Ks(f,i,s,m,x,b,T){const P=f.context.gl,N=s.paint.get("fill-pattern"),V=s.is3D(),q=V?f.stencilModeFor3D():pi.disabled,Z=N&&N.constantOr(1);let K,ne,fe,ue,ve;T?(ne=Z&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",K=P.LINES):(ne=Z?"fillPattern":"fill",K=P.TRIANGLES);for(const ge of m){const Ce=i.getTile(ge);if(Z&&!Ce.patternsLoaded())continue;const ze=Ce.getBucket(s);if(!ze)continue;f.prepareDrawTile();const Le=ze.programConfigurations.get(s.id),qe=f.isTileAffectedByFog(ge),Ne=f.getOrCreateProgram(ne,{config:Le,overrideFog:qe});Z&&(f.context.activeTexture.set(P.TEXTURE0),Ce.imageAtlasTexture&&Ce.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Le.updatePaintBuffers());const Ge=N.constantOr(null);if(Ge&&Ce.imageAtlas){const it=Ce.imageAtlas,Rt=r.A.from(Ge).getPrimary().scaleSelf(r.q.devicePixelRatio).serialize(),xt=it.patternPositions[Rt];xt&&Le.setConstantPatternPositions(xt)}const Be=f.translatePosMatrix(ge.projMatrix,Ce,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor")),Ke=s.paint.get("fill-emissive-strength");if(T){ue=ze.indexBuffer2,ve=ze.segments2;const it=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[P.drawingBufferWidth,P.drawingBufferHeight];fe=ne==="fillOutlinePattern"&&Z?O_(Be,Ke,f,Ce,it):Nc(Be,Ke,it)}else ue=ze.indexBuffer,ve=ze.segments,fe=Z?_l(Be,Ke,f,Ce):Du(Be,Ke);f.uploadCommonUniforms(f.context,Ne,ge.toUnwrapped()),Ne.draw(f,K,x,V?q:f.stencilModeForClipping(ge),b,fi.disabled,fe,s.id,ze.layoutVertexBuffer,ue,ve,s.paint,f.transform.zoom,Le,void 0)}}function Gc(f,i,s,m,x,b,T,P){s.resetLayerRenderingStats(f);const N=f.context,V=N.gl,q=f.transform,Z=s.paint.get("fill-extrusion-pattern"),K=Z.constantOr(1),ne=s.paint.get("fill-extrusion-opacity"),fe=f.style.enable3dLights(),ue=s.paint.get(fe&&!K?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ve=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),ue],ge=s.layout.get("fill-extrusion-edge-radius"),Ce=ge>0&&!s.paint.get("fill-extrusion-rounded-roof"),ze=Ce?0:ge,Le=q.projection.name==="globe"?r.d3():0,qe=q.projection.name==="globe",Ne=qe?r.ae(q.zoom):0,Ge=[r.at(q.center.lng),r.aA(q.center.lat)],Be=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ke=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(Be?null:s.lut).toArray01().slice(0,3),it=s.paint.get("fill-extrusion-flood-light-intensity"),Rt=s.paint.get("fill-extrusion-vertical-scale"),xt=s.paint.get("fill-extrusion-line-width").constantOr(1)!==0,jt=s.paint.get("fill-extrusion-height-alignment"),zt=s.paint.get("fill-extrusion-base-alignment"),pt=Ec(f,s.paint.get("fill-extrusion-cutoff-fade-range")),Dt=[];let tn;qe&&Dt.push("PROJECTION_GLOBE_VIEW"),ve[0]>0&&Dt.push("FAUX_AO"),Ce&&Dt.push("ZERO_ROOF_RADIUS"),P&&Dt.push("HAS_CENTROID"),it>0&&Dt.push("FLOOD_LIGHT"),pt.shouldRenderCutoff&&Dt.push("RENDER_CUTOFF"),xt&&Dt.push("RENDER_WALL_MODE");const dt=f.renderPass==="shadow",Ut=f.shadowRenderer,Pt=dt&&!!Ut;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let dn=[0,0,0];if(Ut){const rn=f.style.directionalLight,mn=f.style.ambientLight;rn&&mn&&(dn=hp(f.style,rn,mn)),dt||(Dt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Ut.useNormalOffset&&Dt.push("NORMAL_OFFSET")),tn=Dt.concat(["SHADOWS_SINGLE_CASCADE"])}const Zt=Pt?"fillExtrusionDepth":K?"fillExtrusionPattern":"fillExtrusion",Gt=s.getLayerRenderingStats();for(const rn of m){const mn=i.getTile(rn),Cn=mn.getBucket(s);if(!Cn||Cn.projection.name!==q.projection.name)continue;let zn=!1;Ut&&(zn=Ut.getMaxCascadeForTile(rn.toUnwrapped())===0);const ni=f.isTileAffectedByFog(rn),Yn=Cn.programConfigurations.get(s.id),Zn=f.getOrCreateProgram(Zt,{config:Yn,defines:zn?tn:Dt,overrideFog:ni});if(f.terrain&&f.terrain.setupElevationDraw(mn,Zn,{useMeterToDem:!0}),!Cn.centroidVertexBuffer){const Qi=Zn.attributes.a_centroid_pos;Qi!==void 0&&V.vertexAttrib2f(Qi,0,0)}!dt&&Ut&&Ut.setupShadows(mn.tileID.toUnwrapped(),Zn,"vector-tile",mn.tileID.overscaledZ),K&&(f.context.activeTexture.set(V.TEXTURE0),mn.imageAtlasTexture&&mn.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),Yn.updatePaintBuffers());const mi=Z.constantOr(null);if(mi&&mn.imageAtlas){const Qi=mn.imageAtlas,Rn=r.A.from(mi).getPrimary().scaleSelf(r.q.devicePixelRatio),li=Qi.patternPositions[Rn.serialize()];li&&Yn.setConstantPatternPositions(li)}const gi=s.paint.get("fill-extrusion-vertical-gradient"),pr=1/Cn.tileToMeter;let Qr;if(dt&&Ut){if(Ou(mn.tileID,Cn,f))continue;const Qi=Ut.calculateShadowPassMatrixFromTile(mn.tileID.toUnwrapped());Qr=$l(Qi,ze,pr,Rt,jt,zt)}else{const Qi=f.translatePosMatrix(rn.expandedProjMatrix,mn,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Rn=q.projection.createInversionMatrix(q,rn.canonical);Qr=K?Oh(Qi,f,gi,ne,ve,ze,pr,rn,mn,Le,jt,zt,Ne,Ge,Rn,Ke,Rt):Lh(Qi,f,gi,ne,ve,ze,pr,rn,Le,jt,zt,Ne,Ge,Rn,Ke,Rt,it,dn)}f.uploadCommonUniforms(N,Zn,rn.toUnwrapped(),null,pt);let Pr=Cn.segments;if(q.projection.name==="mercator"&&!dt&&(Pr=Cn.getVisibleSegments(mn.tileID,f.terrain,f.transform.getFrustum(0)),!Pr.get().length))continue;if(Gt)if(dt)for(const Qi of Pr.get())Gt.numRenderedVerticesInShadowPass+=Qi.primitiveLength;else for(const Qi of Pr.get())Gt.numRenderedVerticesInTransparentPass+=Qi.primitiveLength;const Ei=[];(f.terrain||P)&&Ei.push(Cn.centroidVertexBuffer),qe&&Ei.push(Cn.layoutVertexExtBuffer),xt&&Ei.push(Cn.wallVertexBuffer),Zn.draw(f,N.gl.TRIANGLES,x,b,T,fi.backCCW,Qr,s.id,Cn.layoutVertexBuffer,Cn.indexBuffer,Pr,s.paint,f.transform.zoom,Yn,Ei)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}function Hc(f,i,s,m,x,b,T,P,N,V,q,Z,K,ne,fe,ue,ve,ge,Ce){const ze=f.context,Le=ze.gl,qe=f.transform,Ne=f.transform.zoom,Ge=[],Be=Ec(f,s.paint.get("fill-extrusion-cutoff-fade-range"));V==="clear"?(Ge.push("CLEAR_SUBPASS"),Ce&&(Ge.push("CLEAR_FROM_TEXTURE"),ze.activeTexture.set(Le.TEXTURE0),Ce.bind(Le.LINEAR,Le.CLAMP_TO_EDGE))):V==="sdf"&&Ge.push("SDF_SUBPASS"),ve&&Ge.push("HAS_CENTROID"),Be.shouldRenderCutoff&&Ge.push("RENDER_CUTOFF");const Ke=s.layout.get("fill-extrusion-edge-radius"),it=(Rt,xt,jt,zt,pt)=>{const Dt=xt.programConfigurations.get(s.id),tn=f.isTileAffectedByFog(Rt),dt=f.getOrCreateProgram("fillExtrusionGroundEffect",{config:Dt,defines:Ge,overrideFog:tn}),Ut=((dn,Zt,Gt,rn,mn,Cn,zn,ni,Yn,Zn,mi)=>({u_matrix:Zt,u_opacity:Gt,u_ao_pass:rn?1:0,u_meter_to_tile:mn,u_ao:Cn,u_flood_light_intensity:zn,u_flood_light_color:ni,u_attenuation:Yn,u_edge_radius:Zn,u_fb:0,u_fb_size:mi,u_dynamic_offset:1}))(0,zt,q,N,pt,[Z,K*pt],ne,fe,ue,Ne>=17?0:Ke*pt,Ce?Ce.size[0]:0),Pt=[];ve&&Pt.push(xt.hiddenByLandmarkVertexBuffer),f.uploadCommonUniforms(ze,dt,Rt.toUnwrapped(),null,Be),dt.draw(f,ze.gl.TRIANGLES,x,b,T,P,Ut,s.id,xt.vertexBuffer,xt.indexBuffer,jt,s.paint,Ne,Dt,Pt)};for(const Rt of m){const xt=i.getTile(Rt),jt=xt.getBucket(s);if(!jt||jt.projection.name!==qe.projection.name||!jt.groundEffect||jt.groundEffect&&!jt.groundEffect.hasData())continue;const zt=jt.groundEffect,pt=1/jt.tileToMeter;{const Dt=f.translatePosMatrix(Rt.projMatrix,xt,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),tn=zt.getDefaultSegment();it(Rt,zt,tn,Dt,pt)}if(ge)for(let Dt=0;Dt<4;Dt++){const tn=r.d4[Dt](Rt),dt=i.getTile(tn);if(!dt)continue;const Ut=dt.getBucket(s);if(!Ut||Ut.projection.name!==qe.projection.name||!Ut.groundEffect||Ut.groundEffect&&!Ut.groundEffect.hasData())continue;const Pt=Ut.groundEffect;let dn,Zt;Dt===0?(dn=[-r.ag,0,0],Zt=1):Dt===1?(dn=[r.ag,0,0],Zt=0):Dt===2?(dn=[0,-r.ag,0],Zt=3):(dn=[0,r.ag,0],Zt=2);const Gt=Pt.regionSegments[Zt];if(!Gt)continue;const rn=new Float32Array(16);r.ab.mat4.translate(rn,Rt.projMatrix,dn),it(Rt,Pt,Gt,f.translatePosMatrix(rn,xt,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),pt)}}}function qc(f,i,s,m,x,b,T){m.centroidVertexArray.length===0&&m.createCentroidsBuffer();const P=b?b.findDEMTileFor(s):null;if(!(P&&P.dem||T))return;b&&P&&P.dem&&m.selfDEMTileTimestamp!==P.dem._timestamp&&(m.borderDoneWithNeighborZ=[-1,-1,-1,-1],m.selfDEMTileTimestamp=P.dem._timestamp);const N=ge=>new r.P(Math.ceil((ge+r.d7)*r.d8),0),V=ge=>{const Ce=i.getSource().minzoom,ze=qe=>{const Ne=i.getTileByID(qe);if(Ne&&Ne.hasData())return Ne.getBucket(x)},Le=[0,-1,1];for(const qe of Le){if(ge.overscaledZ+qe<Ce)continue;const Ne=ze(ge.calculateScaledKey(ge.overscaledZ+qe));if(Ne)return Ne}},q=[0,0,0],Z=(ge,Ce)=>(q[0]=Math.min(ge.min.y,Ce.min.y),q[1]=Math.max(ge.max.y,Ce.max.y),q[2]=r.ag-Ce.min.x>ge.max.x?Ce.min.x-r.ag:ge.max.x,q),K=(ge,Ce)=>(q[0]=Math.min(ge.min.x,Ce.min.x),q[1]=Math.max(ge.max.x,Ce.max.x),q[2]=r.ag-Ce.min.y>ge.max.y?Ce.min.y-r.ag:ge.max.y,q),ne=[(ge,Ce)=>Z(ge,Ce),(ge,Ce)=>Z(Ce,ge),(ge,Ce)=>K(ge,Ce),(ge,Ce)=>K(Ce,ge)],fe=(ge,Ce,ze,Le,qe,Ne,Ge)=>{if(!b)return 0;const Be=[[Ne?ze:ge,Ne?ge:ze,0],[Ne?ze:Ce,Ne?Ce:ze,0]],Ke=Ge<0?r.ag+Ge:Ge,it=[Ne?Ke:(ge+Ce)/2,Ne?(ge+Ce)/2:Ke,0];return ze===0&&Ge<0||ze!==0&&Ge>0?b.getForTilePoints(qe,[it],!0,Le):Be.push(it),b.getForTilePoints(s,Be,!0,P),Math.max(Be[0][2],Be[1][2],it[2])/b.exaggeration()};for(let ge=0;ge<4;ge++){const Ce=m.borderFeatureIndices[ge];if(Ce.length===0)continue;const ze=r.d4[ge](s),Le=V(ze);if(!(Le&&Le instanceof r.d5))continue;const qe=b?b.findDEMTileFor(ze):null;if(!(qe&&qe.dem||T)||(b&&qe&&qe.dem&&m.borderDEMTileTimestamp[ge]!==qe.dem._timestamp&&(m.borderDoneWithNeighborZ[ge]=-1,m.borderDEMTileTimestamp[ge]=qe.dem._timestamp),m.borderDoneWithNeighborZ[ge]===Le.canonical.z))continue;Le.centroidVertexArray.length===0&&Le.createCentroidsBuffer();const Ne=(ge<2?1:5)-ge,Ge=Le.borderDoneWithNeighborZ[Ne]!==m.canonical.z,Be=Le.borderFeatureIndices[Ne];let Ke=0;if(m.canonical.z!==Le.canonical.z){for(const it of Ce)m.showCentroid(m.featuresOnBorder[it]);if(Ge)for(const it of Be)Le.showCentroid(Le.featuresOnBorder[it]);m.borderDoneWithNeighborZ[ge]=Le.canonical.z,Le.borderDoneWithNeighborZ[Ne]=m.canonical.z}for(const it of Ce){const Rt=m.featuresOnBorder[it],xt=m.centroidData[Rt.centroidDataIndex],jt=Rt.borders[ge];let zt;for(;Ke<Be.length;){zt=Le.featuresOnBorder[Be[Ke]];const pt=zt.borders[Ne];if(pt[1]>jt[0]+3||pt[0]>jt[0]-3)break;Le.showCentroid(zt),Ke++}if(zt&&Ke<Be.length){const pt=Ke;let Dt=0;for(;!(zt.borders[Ne][0]>jt[1]-3)&&(Dt++,++Ke!==Be.length);)zt=Le.featuresOnBorder[Be[Ke]];zt=Le.featuresOnBorder[Be[pt]];let tn=!1;if(Dt>=1){const Pt=zt.borders[Ne];Math.abs(jt[0]-Pt[0])<3&&Math.abs(jt[1]-Pt[1])<3&&(Dt=1,tn=!0,Ke=pt+1)}else if(Dt===0){m.showCentroid(Rt);continue}const dt=Le.centroidData[zt.centroidDataIndex];T&&tn&&(((ue=xt).flags|(ve=dt).flags)&r.d6?(ue.flags|=r.d6,ve.flags|=r.d6):(ue.flags&=~r.d6,ve.flags&=~r.d6));const Ut=Rt.intersectsCount()>1||zt.intersectsCount()>1;if(Dt>1)Ke=pt,xt.centroidXY=dt.centroidXY=new r.P(0,0);else if(qe&&qe.dem&&!Ut){const Pt=ne[ge](xt,dt),dn=ge%2?r.ag-1:0,Zt=fe(Pt[0],Math.min(r.ag-1,Pt[1]),dn,qe,ze,ge<2,Pt[2]);xt.centroidXY=dt.centroidXY=N(Zt)}else Ut?xt.centroidXY=dt.centroidXY=new r.P(0,0):(xt.centroidXY=m.encodeBorderCentroid(Rt),dt.centroidXY=Le.encodeBorderCentroid(zt));m.writeCentroidToBuffer(xt),Le.writeCentroidToBuffer(dt)}else m.showCentroid(Rt)}m.borderDoneWithNeighborZ[ge]=Le.canonical.z,Le.borderDoneWithNeighborZ[Ne]=m.canonical.z}var ue,ve;(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(f)}const Lu=[1,0,0],hn=[0,1,0],Dn=[0,0,1];function Ou(f,i,s){const m=s.transform,x=s.shadowRenderer;if(!x)return!0;const b=f.toUnwrapped(),T=m.tileSize*x._cascades[s.currentShadowCascade].scale;let P=i.maxHeight;if(m.elevation){const ue=m.elevation.getMinMaxForTile(f);ue&&(P+=ue.max)}const N=[...x.shadowDirection];N[2]=-N[2];const V=x.computeSimplifiedTileShadowVolume(b,P,T,N);if(!V)return!1;const q=[Lu,hn,Dn,N,[N[0],0,N[2]],[0,N[1],N[2]]],Z=m.projection.name==="globe",K=m.scaleZoom(T),ne=r.bR.fromInvProjectionMatrix(m.invProjMatrix,m.worldSize,K,!Z),fe=x.getCurrentCascadeFrustum();return ne.intersectsPrecise(V.vertices,V.planes,q)===0||fe.intersectsPrecise(V.vertices,V.planes,q)===0}function $r(f){return[f[0]*r.d9,f[1]*r.d9,f[2]*r.d9,0]}function bt(f,i,s,m,x,b,T,P,N){const V=m.getSource(),q=s.globeSharedBuffers;if(!q)return;let Z,K,ne;if(i&&(Z=m.getTile(i)),V instanceof r.aJ?(K=V.texture,ne=r.cI(0,0,s.transform)):Z&&i&&(K=Z.texture,ne=r.cI(i.canonical.z,i.canonical.x,s.transform)),!K||!ne)return;f||(ne=r.ab.mat4.scale(r.ab.mat4.create(),ne,[1,-1,1]));const fe=s.context,ue=fe.gl,ve=x.paint.get("raster-resampling")==="nearest"?ue.NEAREST:ue.LINEAR,ge=s.colorModeForDrapableLayerRenderPass(b),Ce=T.defines;Ce.push("GLOBE_POLES");const ze=new Qn(ue.LEQUAL,Qn.ReadWrite,s.depthRangeFor3D),Le=Float32Array.from(s.transform.expandedFarZProjMatrix),qe=Float32Array.from(r.bb(r.cH(new r.bT(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),fe.activeTexture.set(ue.TEXTURE0),K.bind(ve,ue.CLAMP_TO_EDGE),fe.activeTexture.set(ue.TEXTURE1),K.bind(ve,ue.CLAMP_TO_EDGE),K.useMipmap&&fe.extTextureFilterAnisotropic&&s.transform.pitch>20&&ue.texParameterf(ue.TEXTURE_2D,fe.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,fe.extTextureFilterAnisotropicMax);const[Ne,Ge,Be,Ke]=i?q.getPoleBuffers(i.canonical.z,!1):q.getPoleBuffers(0,!0),it=x.paint.get("raster-elevation");let Rt;f?(Rt=Ne,s.renderDefaultNorthPole=it!==0):(Rt=Ge,s.renderDefaultSouthPole=it!==0);const xt=$r(T.mix),jt=((pt,Dt,tn,dt,Ut,Pt,dn,Zt,Gt,rn,mn,Cn,zn)=>Xl(pt,Dt,tn,new Float32Array(16),new Float32Array(9),[0,0],dt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Pt,[0,0],Zt,2,rn,mn,Cn,1,0,zn))(Le,qe,ne,r.ae(s.transform.zoom),0,x,0,it,0,xt,T.offset,T.range,b),zt=s.getOrCreateProgram("raster",{defines:Ce});s.uploadCommonUniforms(fe,zt,null),zt.draw(s,ue.TRIANGLES,ze,N,ge,P,jt,x.id,Rt,Be,Ke)}function Mp(f){const i=f._nearZ,s=f.projection.farthestPixelDistance(f),m=s-i,x=.2*f.height,b=i+x;return[i,s,(b-x-i)/m,(b-i)/m]}function tf(f,i,s,m){if(f)return i instanceof er&&f instanceof Fl?i.getTextureDescriptor(f,s,!0):{texture:f.texture,mix:$r(m.mix),offset:m.offset,buffer:0,tileSize:1}}var tg=r.da([{name:"a_index",type:"Int16",components:1}]);class ng{constructor(i,s,m,x){const b={width:m[0],height:m[1],data:null},T=i.gl;this.targetColorTexture=new r.T(i,b,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(i,b,T.RGBA8,{useMipmap:!1}),this.context=i,this.updateParticleTexture(s,x),this.lastInvalidatedAt=0}updateParticleTexture(i,s){if(this.particleTextureDimension===s.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const m=this.context.gl,x=s.width*s.height;this.particleTexture0=new r.T(this.context,s,m.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,s,m.RGBA8,{premultiply:!1,useMipmap:!1});const b=new r.db;b.reserve(x);for(let T=0;T<x;T++)b.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(b,tg.members,!0),this.particleSegment=r.b7.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=s.width}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=r.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function ig(f,i,s){if(!f)return null;const m=i.getTextureDescriptor(f,s,!0);if(!m)return null;let{texture:x,mix:b,offset:T,tileSize:P,buffer:N,format:V}=m;if(!x||!V)return null;let q=!1;return V==="uint32"&&(q=!0,b[3]=0,b=Kd(r.dc,b,[0,s.paint.get("raster-particle-max-speed")]),T=zh(r.dc,T,[0,s.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[N/(P+2*N),P/(P+2*N)],tileSize:P,scalarData:q,scale:b,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[V]]}}function rg(f){const i=f._nearZ,s=f.projection.farthestPixelDistance(f),m=s-i,x=.2*f.height,b=i+x;return[i,s,(b-x-i)/m,(b-i)/m]}const Wc=new r.aj(1,0,0,1),k_=new r.aj(0,1,0,1),F_=new r.aj(0,0,1,1),ag=new r.aj(1,0,1,1),nf=new r.aj(0,1,1,1);function Jl(f,i,s,m,x,b,T){const P=f.context,N=f.transform,V=P.gl,q=N.projection.name==="globe",Z=q?["PROJECTION_GLOBE_VIEW"]:[];let K=r.ab.mat4.clone(s.projMatrix);if(q&&r.ae(N.zoom)>0){const xt=r.ba(s.canonical,N),jt=r.dd(xt);K=r.ab.mat4.multiply(new Float32Array(16),N.globeMatrix,jt),r.ab.mat4.multiply(K,N.projMatrix,K)}const ne=r.ab.mat4.create();ne[12]+=2*x/(r.q.devicePixelRatio*N.width),ne[13]+=2*b/(r.q.devicePixelRatio*N.height),r.ab.mat4.multiply(K,ne,K);const fe=f.getOrCreateProgram("debug",{defines:Z}),ue=i.getTileByID(s.key);f.terrain&&f.terrain.setupElevationDraw(ue,fe);const ve=Qn.disabled,ge=pi.disabled,Ce=f.colorModeForRenderPass(),ze="$debug";P.activeTexture.set(V.TEXTURE0),f.emptyTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),q?ue._makeGlobeTileDebugBuffers(f.context,N):ue._makeDebugTileBoundsBuffers(f.context,N.projection);const Le=ue._tileDebugBuffer||f.debugBuffer,qe=ue._tileDebugIndexBuffer||f.debugIndexBuffer,Ne=ue._tileDebugSegments||f.debugSegments;if(fe.draw(f,V.LINE_STRIP,ve,ge,Ce,fi.disabled,Pu(K,m),ze,Le,qe,Ne,null,null,null,[ue._globeTileDebugBorderBuffer]),T){const xt=ue.latestRawTileData,jt=Math.floor((xt&&xt.byteLength||0)/1024);let zt=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(zt+=` => ${s.overscaledZ}`),zt+=` ${ue.state}`,zt+=` ${jt}kb`,function(pt,Dt){pt.initDebugOverlayCanvas();const tn=pt.debugOverlayCanvas,dt=pt.context.gl,Ut=pt.debugOverlayCanvas.getContext("2d");Ut.clearRect(0,0,tn.width,tn.height),Ut.shadowColor="white",Ut.shadowBlur=2,Ut.lineWidth=1.5,Ut.strokeStyle="white",Ut.textBaseline="top",Ut.font="bold 36px Open Sans, sans-serif",Ut.fillText(Dt,5,5),Ut.strokeText(Dt,5,5),pt.debugOverlayTexture.update(tn),pt.debugOverlayTexture.bind(dt.LINEAR,dt.CLAMP_TO_EDGE)}(f,zt)}const Ge=i.getTile(s).tileSize,Be=512/Math.min(Ge,512)*(s.overscaledZ/N.zoom)*.5,Ke=ue._tileDebugTextBuffer||f.debugBuffer,it=ue._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Rt=ue._tileDebugTextSegments||f.debugSegments;fe.draw(f,V.TRIANGLES,ve,ge,Ui.alphaBlended,fi.disabled,Pu(K,r.aj.transparent,Be),ze,Ke,it,Rt,null,null,null,[ue._globeTileDebugTextBuffer])}function og(f,i,s,m){Ps(f,0,i+s/2,f.transform.width,s,m)}function Tp(f,i,s,m){Ps(f,i-s/2,0,s,f.transform.height,m)}function Ps(f,i,s,m,x,b){const T=f.context,P=T.gl;P.enable(P.SCISSOR_TEST),P.scissor(i*r.q.devicePixelRatio,s*r.q.devicePixelRatio,m*r.q.devicePixelRatio,x*r.q.devicePixelRatio),T.clear({color:b}),P.disable(P.SCISSOR_TEST)}const rf=r.da([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ds}=rf;function Ls(f,i,s,m){f.emplaceBack(i,s,m)}class sg{constructor(i){this.vertexArray=new r.de,this.indices=new r.aU,Ls(this.vertexArray,-1,-1,1),Ls(this.vertexArray,1,-1,1),Ls(this.vertexArray,-1,1,1),Ls(this.vertexArray,1,1,1),Ls(this.vertexArray,-1,-1,-1),Ls(this.vertexArray,1,-1,-1),Ls(this.vertexArray,-1,1,-1),Ls(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,ds),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=r.b7.simpleSegment(0,0,36,12)}}function Ca(f,i,s,m,x,b){const T=f.context.gl,P=i.paint.get("sky-atmosphere-color"),N=i.paint.get("sky-atmosphere-halo-color"),V=i.paint.get("sky-atmosphere-sun-intensity"),q=((Z,K,ne,fe,ue)=>({u_matrix_3f:Z,u_sun_direction:K,u_sun_intensity:ne,u_color_tint_r:[fe.r,fe.g,fe.b,fe.a],u_color_tint_m:[ue.r,ue.g,ue.b,ue.a],u_luminance:5e-5}))(r.ab.mat3.fromMat4(r.ab.mat3.create(),m),x,V,P,N);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+b,i.skyboxTexture,0),s.draw(f,T.TRIANGLES,Qn.disabled,pi.disabled,Ui.unblended,fi.frontCW,q,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const N_=r.da([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Uh{constructor(i){const s=new r.df;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const m=new r.aU;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(s,N_.members),this.indexBuffer=i.createIndexBuffer(m),this.segments=r.b7.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Dr=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class sr{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ap{constructor(i){this.colorModeAlphaBlendedWriteRGB=new Ui([1,As,1,As],r.aj.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ui([1,0,1,0],r.aj.transparent,[!1,!1,!1,!0]),this.params=new sr,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){const s=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Uh(s);const m=this.params.sizeRange,x=this.params.intensityRange,b=function(q){const Z=r.di(30),K=[];for(let ne=0;ne<q;++ne){const fe=2*Math.PI*Z(),ue=Math.acos(1-2*Z())-.5*Math.PI;K.push(r.ab.vec3.fromValues(Math.cos(ue)*Math.cos(fe),Math.cos(ue)*Math.sin(fe),Math.sin(ue)))}return K}(this.params.starsCount),T=r.di(300),P=new r.dg,N=new r.aU;let V=0;for(let q=0;q<b.length;++q){const Z=r.ab.vec3.scale([],b[q],200),K=Math.max(0,1+.01*m*(1*T()-.5)),ne=Math.max(0,1+.01*x*(1*T()-.5));P.emplaceBack(Z[0],Z[1],Z[2],-1,-1,K,ne),P.emplaceBack(Z[0],Z[1],Z[2],1,-1,K,ne),P.emplaceBack(Z[0],Z[1],Z[2],1,1,K,ne),P.emplaceBack(Z[0],Z[1],Z[2],-1,1,K,ne),N.emplaceBack(V+0,V+1,V+2),N.emplaceBack(V+0,V+2,V+3),V+=4}this.starsVx=s.createVertexBuffer(P,Dr.members),this.starsIdx=s.createIndexBuffer(N),this.starsSegments=r.b7.simpleSegment(0,0,P.length,N.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,s){const m=i.context,x=m.gl,b=i.transform,T=new Qn(x.LEQUAL,Qn.ReadOnly,[0,1]),P=r.ae(b.zoom),N=i.style.getLut(s.scope),V=s.properties.get("color-use-theme")==="none",q=s.properties.get("color").toRenderColor(V?null:N).toArray01(),Z=s.properties.get("high-color-use-theme")==="none",K=s.properties.get("high-color").toRenderColor(Z?null:N).toArray01(),ne=s.properties.get("space-color-use-theme")==="none",fe=s.properties.get("space-color").toRenderColor(ne?null:N).toArray01PremultipliedAlpha(),ue=5e-4,ve=r.dh(s.properties.get("horizon-blend"),0,1,ue,.25),ge=r.cC(i,m,b)&&ve===ue?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,Ce=i.frameCounter/1e3%1,ze=r.ab.vec3.length(b.globeCenterInViewSpace),Le=Math.sqrt(Math.pow(ze,2)-Math.pow(ge,2)),qe=Math.acos(Le/ze),Ne=Ge=>{const Be=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ge&&Be.push("ALPHA_PASS");const Ke=i.getOrCreateProgram("globeAtmosphere",{defines:Be}),it=((xt,jt,zt,pt,Dt,tn,dt,Ut,Pt,dn,Zt,Gt)=>({u_frustum_tl:xt,u_frustum_tr:jt,u_frustum_br:zt,u_frustum_bl:pt,u_horizon:Dt,u_transition:tn,u_fadeout_range:dt,u_color:Ut,u_high_color:Pt,u_space_color:dn,u_temporal_offset:Zt,u_horizon_angle:Gt}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,P,ve,q,K,fe,Ce,qe);i.uploadCommonUniforms(m,Ke);const Rt=this.atmosphereBuffer;Rt&&Ke.draw(i,x.TRIANGLES,T,pi.disabled,Ge?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,fi.backCW,it,Ge?"atmosphere_glow_alpha":"atmosphere_glow",Rt.vertexBuffer,Rt.indexBuffer,Rt.segments)};Ne(!1),Ne(!0)}drawStars(i,s){const m=r.aw(s.properties.get("star-intensity"),0,1);if(m===0)return;const x=i.context,b=x.gl,T=i.transform,P=i.getOrCreateProgram("stars"),N=r.ab.quat.identity([]);r.ab.quat.rotateX(N,N,-T._pitch),r.ab.quat.rotateZ(N,N,-T.angle),r.ab.quat.rotateX(N,N,r.ai(T._center.lat)),r.ab.quat.rotateY(N,N,-r.ai(T._center.lng));const V=r.ab.mat4.fromQuat(new Float32Array(16),N),q=r.ab.mat4.multiply([],T.starsProjMatrix,V),Z=r.ab.mat3.fromMat4([],V),K=r.ab.mat3.invert([],Z),ne=[0,1,0];r.ab.vec3.transformMat3(ne,ne,K),r.ab.vec3.scale(ne,ne,this.params.sizeMultiplier);const fe=[1,0,0];r.ab.vec3.transformMat3(fe,fe,K),r.ab.vec3.scale(fe,fe,this.params.sizeMultiplier);const ue=(ve=ne,ge=fe,Ce=m,{u_matrix:Float32Array.from(q),u_up:ve,u_right:ge,u_intensity_multiplier:Ce});var ve,ge,Ce;i.uploadCommonUniforms(x,P),this.starsVx&&this.starsIdx&&P.draw(i,b.TRIANGLES,Qn.disabled,pi.disabled,this.colorModeAlphaBlendedWriteRGB,fi.disabled,ue,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function vl(f,i){const s=[...f],m=i.cameraWorldSizeForFog/i.worldSize,x=r.ab.mat4.identity([]);return r.ab.mat4.scale(x,x,[m,m,1]),r.ab.mat4.multiply(s,x,s),r.ab.mat4.multiply(s,i.worldToFogMatrix,s),s}function zu(f,i,s,m,x){const b=s.material,T=m.context,{baseColorTexture:P,metallicRoughnessTexture:N}=b.pbrMetallicRoughness,{normalTexture:V,occlusionTexture:q,emissionTexture:Z}=b;function K(fe,ue,ve){if(fe&&(f.push(ue),T.activeTexture.set(T.gl.TEXTURE0+ve),fe.gfxTexture)){const{minFilter:ge,magFilter:Ce,wrapS:ze,wrapT:Le}=fe.sampler;fe.gfxTexture.bindExtraParam(ge,Ce,ze,Le)}}K(P,"HAS_TEXTURE_u_baseColorTexture",ja.BaseColor),K(N,"HAS_TEXTURE_u_metallicRoughnessTexture",ja.MetallicRoughness),K(V,"HAS_TEXTURE_u_normalTexture",ja.Normal),K(q,"HAS_TEXTURE_u_occlusionTexture",ja.Occlusion),K(Z,"HAS_TEXTURE_u_emissionTexture",ja.Emission),x&&(x.texture||(x.texture=new r.dk(m.context,x.image,[x.image.height,x.image.height,x.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+ja.LUT),x.texture&&x.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),s.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(s.texcoordBuffer)),s.colorBuffer&&(f.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(s.colorBuffer)),s.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(s.normalBuffer)),s.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(s.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||f.push("DIFFUSE_SHADED");const ne=m.shadowRenderer;ne&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ne.useNormalOffset&&f.push("NORMAL_OFFSET"))}function Js(f,i,s,m,x,b){const T=s.paint.get("model-opacity").constantOr(1),P=i.context,N=new Qn(i.context.gl.LEQUAL,Qn.ReadWrite,i.depthRangeFor3D),V=i.transform,q=f.mesh,Z=q.material,K=Z.pbrMetallicRoughness,ne=i.style.fog;let fe;fe=i.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:r.ab.mat4.multiply([],m.zScaleMatrix,f.nodeModelMatrix),r.ab.mat4.multiply(fe,m.negCameraPosMatrix,fe);const ue=r.ab.mat4.invert([],fe);r.ab.mat4.transpose(ue,ue);const ve=s.paint.get("model-color-use-theme").constantOr("default")==="none",ge=s.paint.get("model-emissive-strength").constantOr(0),Ce=Jd(new Float32Array(f.worldViewProjection),new Float32Array(fe),new Float32Array(ue),null,i,T,K.baseColorFactor.toRenderColor(null),Z.emissiveFactor,K.metallicFactor,K.roughnessFactor,Z,ge,s),ze={defines:[]},Le=[],qe=i.shadowRenderer;qe&&(qe.useNormalOffset=!1),zu(ze.defines,Le,q,i,ve?null:s.lut);let Ne=null;if(ne){const Ke=vl(f.nodeModelMatrix,i.transform);if(Ne=new Float32Array(Ke),V.projection.name!=="globe"){const it=q.aabb.min,Rt=q.aabb.max,[xt,jt]=ne.getOpacityForBounds(Ke,it[0],it[1],Rt[0],Rt[1]);ze.overrideFog=xt>=We||jt>=We}}const Ge=Ec(i,s.paint.get("model-cutoff-fade-range"));Ge.shouldRenderCutoff&&ze.defines.push("RENDER_CUTOFF");const Be=i.getOrCreateProgram("model",ze);i.uploadCommonUniforms(P,Be,null,Ne,Ge),i.renderPass!=="shadow"&&qe&&qe.setupShadowsFromMatrix(f.nodeModelMatrix,Be),Be.draw(i,P.gl.TRIANGLES,N,x,b,q.material.doubleSided?fi.disabled:fi.backCCW,Ce,s.id,q.vertexBuffer,q.indexBuffer,q.segments,s.paint,i.transform.zoom,void 0,Le)}function af(f,i,s,m,x,b,T){let P;P=f.projection.name==="globe"?r.dl(s,f):[...s],r.ab.mat4.multiply(P,P,i.matrix);const N=r.ab.mat4.multiply([],m,P);if(i.meshes)for(const V of i.meshes){if(V.material.alphaMode!=="BLEND"){T.push({mesh:V,depth:0,modelIndex:x,worldViewProjection:N,nodeModelMatrix:P});continue}const q=r.ab.vec3.transformMat4([],V.centroid,N);!f.isOrthographic&&q[2]<=0||b.push({mesh:V,depth:q[2],modelIndex:x,worldViewProjection:N,nodeModelMatrix:P})}if(i.children)for(const V of i.children)af(f,V,s,m,x,b,T)}function Vh(f,i,s,m){const x=s.shadowRenderer;if(!x)return;const b=x.getShadowPassDepthMode(),T=x.getShadowPassColorMode(),P=x.calculateShadowPassMatrixFromMatrix(i),N=xa(P);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,b,pi.disabled,T,fi.backCCW,N,m.id,f.vertexBuffer,f.indexBuffer,f.segments,m.paint,s.transform.zoom,void 0,void 0)}function yl(f,i,s){const m=i.updateZoomBasedPaintProperties(),x=function(b,T,P){let N,V,q,Z=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&Z>0){const K=b.terrain,ne=K.findDEMTileFor(P);ne&&ne.dem?N=r.dn.create(K,P,ne):Z=0}if(Z===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),Z===T.validForExaggeration&&(Z===0||N&&N._demTile&&N._demTile.tileID===T.validForDEMTile.id&&N._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const K in T.instancesPerModel){const ne=T.instancesPerModel[K];for(let fe=0;fe<ne.instancedDataArray.length;++fe){const ue=(N?Z*N.getElevationAt(0|ne.instancedDataArray.float32[16*fe],0|ne.instancedDataArray.float32[16*fe+1],!0,!0):0)+ne.instancesEvaluatedElevation[fe];ne.instancedDataArray.float32[16*fe+6]=ue,V=V?Math.min(T.terrainElevationMin,ue):ue,q=q?Math.max(T.terrainElevationMax,ue):ue}}return T.terrainElevationMin=V||0,T.terrainElevationMax=q||0,T.validForExaggeration=Z,T.validForDEMTile=N&&N._demTile?{id:N._demTile.tileID,timestamp:N._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,i,s);(m||x)&&(i.uploaded=!1,i.upload(f.context))}const Qa={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.cd([0,0,0],[r.ag,r.ag,0])};function of(f,i){const s=1<<f.canonical.z,m=i.getFreeCameraOptions().position,x=i.elevation,b=f.canonical.x/s,T=(f.canonical.x+1)/s,P=f.canonical.y/s,N=(f.canonical.y+1)/s;let V=i._centerAltitude;if(x){const ne=x.getMinMaxForTile(f);ne&&ne.max>V&&(V=ne.max)}const q=r.aw(m.x,b,T)-m.x,Z=r.aw(m.y,P,N)-m.y,K=r.bH(V,i.center.lat)-m.z;return i._zoomFromMercatorZ(Math.sqrt(q*q+Z*Z+K*K))}function jh(f,i,s,m,x,b,T){const P=f.context,N=f.renderPass==="shadow",V=f.shadowRenderer,q=N&&V?V.getShadowPassDepthMode():new Qn(P.gl.LEQUAL,Qn.ReadWrite,f.depthRangeFor3D),Z=f.isTileAffectedByFog(b);if(s.meshes)for(const K of s.meshes){const ne=["MODEL_POSITION_ON_GPU"],fe=[];let ue,ve,ge;m.instancedDataArray.length>20&&ne.push("INSTANCED_ARRAYS");const Ce=Ec(f,i.paint.get("model-cutoff-fade-range"));if(Ce.shouldRenderCutoff&&ne.push("RENDER_CUTOFF"),N&&V)ue=f.getOrCreateProgram("modelDepth",{defines:ne}),ve=xa(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(s.matrix)),ge=V.getShadowPassColorMode();else{zu(ne,fe,K,f,i.paint.get("model-color-use-theme").constantOr("default")==="none"?null:i.lut),ue=f.getOrCreateProgram("model",{defines:ne,overrideFog:Z});const Le=K.material,qe=Le.pbrMetallicRoughness,Ne=i.paint.get("model-opacity").constantOr(1),Ge=i.paint.get("model-emissive-strength").constantOr(0);ve=Jd(b.expandedProjMatrix,Float32Array.from(s.matrix),new Float32Array(16),null,f,Ne,qe.baseColorFactor.toRenderColor(null),Le.emissiveFactor,qe.metallicFactor,qe.roughnessFactor,Le,Ge,i,x),V&&(T.shadowUniformsInitialized?ue.setShadowUniformValues(P,V.getShadowUniformValues()):(V.setupShadows(b.toUnwrapped(),ue,"model-tile",b.overscaledZ),T.shadowUniformsInitialized=!0)),ge=Ce.shouldRenderCutoff||Ne<1||Le.alphaMode!=="OPAQUE"?Ui.alphaBlended:Ui.unblended}f.uploadCommonUniforms(P,ue,b.toUnwrapped(),null,Ce);const ze=K.material.doubleSided?fi.disabled:fi.backCCW;if(m.instancedDataArray.length>20)fe.push(m.instancedDataBuffer),ue.draw(f,P.gl.TRIANGLES,q,pi.disabled,ge,ze,ve,i.id,K.vertexBuffer,K.indexBuffer,K.segments,i.paint,f.transform.zoom,void 0,fe,m.instancedDataArray.length);else{const Le=N?"u_instance":"u_normal_matrix";for(let qe=0;qe<m.instancedDataArray.length;++qe)ve[Le]=new Float32Array(m.instancedDataArray.arrayBuffer,64*qe,16),ue.draw(f,P.gl.TRIANGLES,q,pi.disabled,ge,ze,ve,i.id,K.vertexBuffer,K.indexBuffer,K.segments,i.paint,f.transform.zoom,void 0,fe)}}if(s.children)for(const K of s.children)jh(f,i,K,m,x,b,T)}const sf=[1,-1,1];function Cp(f,i,s,m){if(!s.modelManager)return!0;const x=s.modelManager;if(!s.shadowRenderer)return!0;const b=s.shadowRenderer,T=i.aabb;let P=!0,N=f.maxHeight;if(N===0){let q=0;for(const Z in f.instancesPerModel){const K=x.getModel(Z,m);K?q=Math.max(q,Math.max(Math.max(K.aabb.max[0],K.aabb.max[1]),K.aabb.max[2])):P=!1}N=f.maxScale*q*1.41+f.maxVerticalOffset,P&&(f.maxHeight=N)}T.max[2]=N,T.min[2]+=f.terrainElevationMin,T.max[2]+=f.terrainElevationMax,r.ab.vec3.transformMat4(T.min,T.min,i.tileMatrix),r.ab.vec3.transformMat4(T.max,T.max,i.tileMatrix);const V=T.intersects(b.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=V===2),V===0}function $c(f,i){const s=f.uniformValues.u_cutoff_params[0],m=f.uniformValues.u_cutoff_params[1],x=f.uniformValues.u_cutoff_params[2],b=f.uniformValues.u_cutoff_params[3];return m===s||b===x?1:r.aw(((i-s)/(m-s)-x)/(b-x),0,1)}function lg(f,i,s,m){if(i.pitch<20)return 1;const x=i.getWorldToCameraMatrix();r.ab.mat4.multiply(x,x,f);const b=r.ab.vec4.fromValues(s.min[0],s.min[1],s.min[2],1);let T=r.ab.vec4.transformMat4(r.ab.vec4.create(),b,x),P=T,N=T;b[1]=s.max[1],T=r.ab.vec4.transformMat4(r.ab.vec4.create(),b,x),P=T[1]<P[1]?T:P,N=T[1]>N[1]?T:N,b[0]=s.max[0],T=r.ab.vec4.transformMat4(r.ab.vec4.create(),b,x),P=T[1]<P[1]?T:P,N=T[1]>N[1]?T:N,b[1]=s.min[1],T=r.ab.vec4.transformMat4(r.ab.vec4.create(),b,x),P=T[1]<P[1]?T:P,N=T[1]>N[1]?T:N;const V=r.aw(m[0],0,1),q=100*i.pixelsPerMeter*r.aw(m[1],0,1),Z=r.aw(m[2],0,1),K=r.ab.vec4.lerp(r.ab.vec4.create(),P,N,V),ne=Math.tan(.5*i.fovX),fe=-K[2]*ne;if(q===0)return K[1]<-Math.abs(fe)?Z:1;const ue=(-Math.abs(fe)-K[1])/q,ve=(Ce,ze,Le)=>(1-Le)*Ce+Le*ze,ge=r.aw(ve(1,Z,ue),Z,1);return ve(1,ge,r.aw((i.pitch-20)/20,0,1))}class Xc{}class Rp{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,s,m){{const Z=this._storage.get(s.id);if(Z)return Z.lastUsedFrameIdx=i,Z.buf}const x=m.gl,b=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),T=new ArrayBuffer(b),P=new Int16Array(T);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const N=new r.dq;for(let Z=0;Z<b/2;Z+=3){const K=P[Z],ne=P[Z+1],fe=P[Z+2];N.emplaceBack(K,ne),N.emplaceBack(ne,fe),N.emplaceBack(fe,K)}const V=m.bindVertexArrayOES.current,q=new Xc;return q.buf=new Ds(m,N),q.lastUsedFrameIdx=i,this._storage.set(s.id,q),m.bindVertexArrayOES.set(V),q.buf}update(i){for(const[s,m]of this._storage)i-m.lastUsedFrameIdx>30&&(m.buf.destroy(),this._storage.delete(s))}destroy(){for(const[i,s]of this._storage)s.buf.destroy(),this._storage.delete(i)}}class Zc{constructor(i){this.occluderSize=30,this.depthOffset=-1e-4,i.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),i.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const lf=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Gh{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Ha{constructor(i,s){this.revealStart=11,this.revealRange=2,i.registerParameter(this,[...s,"Reveal"],"revealStart",{min:0,max:17,step:.05}),i.registerParameter(this,[...s,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Ip=r.da([{type:"Float32",name:"a_pos_2f",components:2}]);class Os{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(i,s){const m=i.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new r.dr,P=new r.aU;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),P.emplaceBack(0,1,2),P.emplaceBack(0,2,3),this.vignetteVx=i.context.createVertexBuffer(T,Ip.members),this.vignetteIdx=i.context.createIndexBuffer(P)}const x=r.b7.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){i.uploadCommonUniforms(i.context,m);const T={u_vignetteShape:(b={vignetteShape:[s.start,s.range,Math.pow(10,s.fadePower)],vignetteColor:[s.color.r,s.color.g,s.color.b,s.color.a*s.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};m.draw(i,i.context.gl.TRIANGLES,Qn.disabled,pi.disabled,Ui.alphaBlended,fi.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,x,{})}var b}}class Qs{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(i,s){const m=i.getFreeCameraOptions().position,x=m.toAltitude(),b=m.toLngLat(),T=r.ai(b.lng),P=r.ai(b.lat),N=i.pixelsPerMeter/s,V=T*r.ds,q=r.ds*Math.log(Math.tan(Math.PI/4+P/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const Z=-this._offsetYPrev+q,K=-this._elevationPrev+x;this._accumulatedOffsetX+=(-this._offsetXPrev+V)*N,this._accumulatedOffsetY+=Z*N,this._accumulatedElevation+=K*N,this._offsetXPrev=V,this._offsetYPrev=q,this._elevationPrev=x}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function No(f,i){return[-(f[0]-Math.floor(f[0]/i)*i),-(f[1]-Math.floor(f[1]/i)*i),-(f[2]-Math.floor(f[2]/i)*i)]}function xl(f){const i=r.di(1323123451230),s=[];for(let m=0;m<f;++m){const x=2*i()-1,b=2*i()-1,T=2*i()-1;s.push(r.ab.vec3.fromValues(x,b,T))}return s}function zs(f,i,s,m,x){const b=r.aw((x-s)/(m-s),0,1);return(1-b)*f+b*i}class Hh{constructor(i){this._movement=new Qs,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Os,this._ppmScaleFactor=i}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(i,s){const m=i.transform;this._movement.update(m,this._ppmScaleFactor);const x=m.starsProjMatrix,b=r.ab.quat.identity([]);r.ab.quat.rotateX(b,b,r.ai(90)-m._pitch),r.ab.quat.rotateZ(b,b,-m.angle);const T=r.ab.mat4.fromQuat(new Float32Array(16),b),P=r.ab.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),N=r.ab.mat4.transpose([],P),V=r.ab.mat4.multiply([],N,T),q=Date.now()/1e3;return this._accumulatedTimeFromStart+=(q-this._prevTime)*s,this._prevTime=q,{projectionMatrix:x,modelviewMatrix:V}}}class ku extends Hh{constructor(i){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Ha(i.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(i){const s=i.context;if(!this.particlesVx){const m=xl(this.particlesCount),x=new r.dt,b=new r.aU;let T=0;const P=r.di(1323123451230);for(let N=0;N<m.length;++N){const V=m[N],q=[2*P()-1,P(),P(),P()];x.emplaceBack(V[0],V[1],V[2],-1,-1,...q),x.emplaceBack(V[0],V[1],V[2],1,-1,...q),x.emplaceBack(V[0],V[1],V[2],1,1,...q),x.emplaceBack(V[0],V[1],V[2],-1,1,...q),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=s.createVertexBuffer(x,lf.members),this.particlesIdx=s.createIndexBuffer(b)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.rain)return;const s=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},m=i.transform.zoom;if(s.revealStart>m)return;const x=zs(0,1,s.revealStart,s.revealStart+s.revealRange,m);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let T=[-b.direction.x,b.direction.y,-100];r.ab.vec3.normalize(T,T);const P=structuredClone(this._vignetteParams);P.strength*=x,b.overrideStyleParameters||(b.intensity=i.style.rain.state.density,b.timeFactor=i.style.rain.state.intensity,b.color=structuredClone(i.style.rain.state.color),T=structuredClone(i.style.rain.state.direction),b.screenThinning.intensity=i.style.rain.state.centerThinning,b.dropletSizeX=i.style.rain.state.dropletSize[0],b.dropletSizeYScale=i.style.rain.state.dropletSize[1]/i.style.rain.state.dropletSize[0],b.distortionStrength=100*i.style.rain.state.distortionStrength,P.strength=1,P.color=structuredClone(i.style.rain.state.vignetteColor));const N=this.updateOnRender(i,b.timeFactor),V=i.context,q=V.gl,Z=i.transform;this.screenTexture&&this.screenTexture.size[0]===i.width&&this.screenTexture.size[1]===i.height||(this.screenTexture=new r.T(V,{width:i.width,height:i.height,data:null},q.RGBA8)),b.distortionStrength>0&&(V.activeTexture.set(q.TEXTURE0),this.screenTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),q.copyTexSubImage2D(q.TEXTURE_2D,0,0,0,0,0,i.width,i.height));const K=i.getOrCreateProgram("rainParticle");i.uploadCommonUniforms(V,K),V.activeTexture.set(q.TEXTURE0),this.screenTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const ne=[b.color.r,b.color.g,b.color.b,b.color.a],fe=(ue,ve)=>{const ge=No(this._movement.getPosition(),ue),Ce=b.dropletSizeX,ze=b.dropletSizeX*b.dropletSizeYScale,Le=i.width/2,qe=i.height/2,Ne=zs(0,b.screenThinning.start,0,1,b.screenThinning.intensity),Ge=zs(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),Be=zs(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),Ke=(it={modelview:N.modelviewMatrix,projection:N.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ge,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:ue,rainDropletSize:[Ce,ze],distortionStrength:b.distortionStrength,rainDirection:T,color:ne,screenSize:[Z.width,Z.height],thinningCenterPos:[Le,qe],thinningShape:[Ne,Ge,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:Be,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:ve?0:1},{u_modelview:Float32Array.from(it.modelview),u_projection:Float32Array.from(it.projection),u_time:it.time,u_cam_pos:it.camPos,u_texScreen:0,u_velocityConeAperture:it.velocityConeAperture,u_velocity:it.velocity,u_boxSize:it.boxSize,u_rainDropletSize:it.rainDropletSize,u_distortionStrength:it.distortionStrength,u_rainDirection:it.rainDirection,u_color:it.color,u_screenSize:it.screenSize,u_thinningCenterPos:it.thinningCenterPos,u_thinningShape:it.thinningShape,u_thinningAffectedRatio:it.thinningAffectedRatio,u_thinningParticleOffset:it.thinningParticleOffset,u_shapeDirectionalPower:it.shapeDirectionalPower,u_shapeNormalPower:it.shapeNormalPower,u_mode:it.mode});var it;const Rt=Math.round(b.intensity*this.particlesCount),xt=r.b7.simpleSegment(0,0,4*Rt,2*Rt);K.draw(i,q.TRIANGLES,Qn.disabled,pi.disabled,Ui.alphaBlended,fi.disabled,Ke,"rain_particles",this.particlesVx,this.particlesIdx,xt,{})};b.distortionStrength>0&&fe(b.boxSize,!0),fe(b.boxSize,!1),this._vignette.draw(i,P)}}const Dp=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Ql extends Hh{constructor(i){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Ha(i.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(i){const s=i.context;if(!this.particlesVx){const m=xl(this.particlesCount),x=new r.du,b=new r.aU;let T=0;const P=r.di(1323123451230);for(let N=0;N<m.length;++N){const V=m[N],q=P(),Z=P(),K=P(),ne=[N/m.length,q,Z,K],fe=[P(),P()];x.emplaceBack(V[0],V[1],V[2],-1,-1,...ne,...fe),x.emplaceBack(V[0],V[1],V[2],1,-1,...ne,...fe),x.emplaceBack(V[0],V[1],V[2],1,1,...ne,...fe),x.emplaceBack(V[0],V[1],V[2],-1,1,...ne,...fe),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=s.createVertexBuffer(x,Dp.members),this.particlesIdx=s.createIndexBuffer(b)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.snow)return;const s=structuredClone(this._params);let m=[-s.direction.x,s.direction.y,-100];r.ab.vec3.normalize(m,m);const x=structuredClone(this._vignetteParams),b=s.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=i.transform.zoom;if(b.revealStart>T)return;const P=zs(0,1,b.revealStart,b.revealStart+b.revealRange,T);x.strength*=P,s.overrideStyleParameters||(s.intensity=i.style.snow.state.density,s.timeFactor=i.style.snow.state.intensity,s.color=structuredClone(i.style.snow.state.color),m=structuredClone(i.style.snow.state.direction),s.screenThinning.intensity=i.style.snow.state.centerThinning,s.billboardSize=2.79*i.style.snow.state.flakeSize,x.strength=1,x.color=structuredClone(i.style.snow.state.vignetteColor));const N=this.updateOnRender(i,s.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const V=i.context,q=V.gl,Z=i.transform,K=i.getOrCreateProgram("snowParticle");i.uploadCommonUniforms(V,K),((ne,fe,ue)=>{const ve=No(this._movement.getPosition(),ne),ge=Z.width/2,Ce=Z.height/2,ze=zs(0,ue.screenThinning.start,0,1,ue.screenThinning.intensity),Le=zs(.001,ue.screenThinning.range,0,1,ue.screenThinning.intensity),qe=zs(0,ue.screenThinning.particleOffset,0,1,ue.screenThinning.intensity),Ne=(Ge={modelview:N.modelviewMatrix,projection:N.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ve,velocityConeAperture:ue.velocityConeAperture,velocity:ue.velocity,horizontalOscillationRadius:ue.horizontalOscillationRadius,horizontalOscillationRate:ue.horizontalOscillationRate,boxSize:ne,billboardSize:1*ue.billboardSize,simpleShapeParameters:[ue.shapeFadeStart,ue.shapeFadePower],screenSize:[Z.width,Z.height],thinningCenterPos:[ge,Ce],thinningShape:[ze,Le,Math.pow(10,ue.screenThinning.fadePower)],thinningAffectedRatio:ue.screenThinning.affectedRatio,thinningParticleOffset:qe,color:[ue.color.r,ue.color.g,ue.color.b,ue.color.a],direction:m},{u_modelview:Float32Array.from(Ge.modelview),u_projection:Float32Array.from(Ge.projection),u_time:Ge.time,u_cam_pos:Ge.camPos,u_velocityConeAperture:Ge.velocityConeAperture,u_velocity:Ge.velocity,u_horizontalOscillationRadius:Ge.horizontalOscillationRadius,u_horizontalOscillationRate:Ge.horizontalOscillationRate,u_boxSize:Ge.boxSize,u_billboardSize:Ge.billboardSize,u_simpleShapeParameters:Ge.simpleShapeParameters,u_screenSize:Ge.screenSize,u_thinningCenterPos:Ge.thinningCenterPos,u_thinningShape:Ge.thinningShape,u_thinningAffectedRatio:Ge.thinningAffectedRatio,u_thinningParticleOffset:Ge.thinningParticleOffset,u_particleColor:Ge.color,u_direction:Ge.direction});var Ge;const Be=Math.round(ue.intensity*this.particlesCount),Ke=r.b7.simpleSegment(0,0,4*Be,2*Be);this.particlesVx&&this.particlesIdx&&K.draw(i,q.TRIANGLES,Qn.disabled,pi.disabled,Ui.alphaBlended,fi.disabled,Ne,"snow_particles",this.particlesVx,this.particlesIdx,Ke,{})})(s.boxSize,0,s),this._vignette.draw(i,x)}}const Yc={symbol:function(f,i,s,m,x){if(f.renderPass!=="translucent")return;const b=pi.disabled,T=f.colorModeForRenderPass(),P=s.layout.get("text-variable-anchor"),N=s.layout.get("text-size-scale-range"),V=r.aw(f.scaleFactor,N[0],N[1]);P&&function(K,ne,fe,ue,ve,ge,Ce,ze){const Le=ne.transform,qe=ve==="map",Ne=ge==="map";for(const Ge of K){const Be=ue.getTile(Ge),Ke=Be.getBucket(fe);if(!Ke||!Ke.text||!Ke.text.segments.get().length)continue;const it=r.bp(Ke.textSizeData,Le.zoom,ze),Rt=wc(Ge,Ke.getProjection(),Le),xt=Le.calculatePixelsToTileUnitsMatrix(Be),jt=Fr(Rt,Be.tileID.canonical,Ne,qe,Le,Ke.getProjection(),xt),zt=Ke.hasIconTextFit()&&Ke.hasIconData();if(it){const pt=Math.pow(2,Le.zoom-Be.tileID.overscaledZ);Vc(Ke,qe,Ne,Ce,r.cX,Le,jt,Ge,pt,it,zt)}}}(m,f,s,i,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),x,V);const q=s.paint.get("icon-opacity").constantOr(1)!==0,Z=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(q||Z)?jc(f,i,s,m,b,T):(q&&jc(f,i,s,m,b,T,{onlyIcons:!0}),Z&&jc(f,i,s,m,b,T,{onlyText:!0})),i.map.showCollisionBoxes&&(Nh(f,i,s,m,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),Nh(f,i,s,m,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(f,i,s,m){if(f.renderPass!=="translucent")return;const x=s.paint.get("circle-opacity"),b=s.paint.get("circle-stroke-width"),T=s.paint.get("circle-stroke-opacity"),P=s.layout.get("circle-sort-key").constantOr(1)!==void 0,N=s.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(b.constantOr(1)===0||T.constantOr(1)===0))return;const V=f.context,q=V.gl,Z=f.transform,K=f.depthModeForSublayer(0,Qn.ReadOnly),ne=pi.disabled,fe=f.colorModeForDrapableLayerRenderPass(N),ue=Z.projection.name==="globe",ve=[r.at(Z.center.lng),r.aA(Z.center.lat)],ge=[];for(let ze=0;ze<m.length;ze++){const Le=m[ze],qe=i.getTile(Le),Ne=qe.getBucket(s);if(!Ne||Ne.projection.name!==Z.projection.name)continue;const Ge=Ne.programConfigurations.get(s.id),Be=r.cY(s),Ke=f.isTileAffectedByFog(Le);ue&&Be.push("PROJECTION_GLOBE_VIEW"),Be.push("DEPTH_D24"),f.terrain&&Z.depthOcclusionForSymbolsAndCircles&&Be.push("DEPTH_OCCLUSION");const it=f.getOrCreateProgram("circle",{config:Ge,defines:Be,overrideFog:Ke}),Rt=Ne.layoutVertexBuffer,xt=Ne.globeExtVertexBuffer,jt=Ne.indexBuffer,zt=Z.projection.createInversionMatrix(Z,Le.canonical),pt={programConfiguration:Ge,program:it,layoutVertexBuffer:Rt,globeExtVertexBuffer:xt,indexBuffer:jt,uniformValues:r.cZ(f,Le,qe,zt,ve,s),tile:qe};if(P){const Dt=Ne.segments.get();for(const tn of Dt)ge.push({segments:new r.b7([tn]),sortKey:tn.sortKey,state:pt})}else ge.push({segments:Ne.segments,sortKey:0,state:pt})}P&&ge.sort((ze,Le)=>ze.sortKey-Le.sortKey);const Ce={useDepthForOcclusion:Z.depthOcclusionForSymbolsAndCircles};for(const ze of ge){const{programConfiguration:Le,program:qe,layoutVertexBuffer:Ne,globeExtVertexBuffer:Ge,indexBuffer:Be,uniformValues:Ke,tile:it}=ze.state,Rt=ze.segments;f.terrain&&f.terrain.setupElevationDraw(it,qe,Ce),f.uploadCommonUniforms(V,qe,it.tileID.toUnwrapped()),qe.draw(f,q.TRIANGLES,K,ne,fe,fi.disabled,Ke,s.id,Ne,Be,Rt,s.paint,Z.zoom,Le,[Ge])}},heatmap:function(f,i,s,m){if(s.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const x=f.context,b=x.gl,T=pi.disabled,P=new Ui([b.ONE,b.ONE,b.ONE,b.ONE],r.aj.transparent,[!0,!0,!0,!0]);(function(ne,fe,ue,ve){const ge=ne.gl,Ce=fe.width*ve,ze=fe.height*ve;ne.activeTexture.set(ge.TEXTURE1),ne.viewport.set([0,0,Ce,ze]);let Le=ue.heatmapFbo;if(!Le||Le&&(Le.width!==Ce||Le.height!==ze)){Le&&Le.destroy();const qe=ge.createTexture();ge.bindTexture(ge.TEXTURE_2D,qe),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_S,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_T,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MIN_FILTER,ge.LINEAR),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MAG_FILTER,ge.LINEAR),Le=ue.heatmapFbo=ne.createFramebuffer(Ce,ze,!0,null),function(Ne,Ge,Be,Ke,it,Rt){const xt=Ne.gl;xt.texImage2D(xt.TEXTURE_2D,0,Ne.extRenderToTextureHalfFloat?xt.RGBA16F:xt.RGBA,it,Rt,0,xt.RGBA,Ne.extRenderToTextureHalfFloat?xt.HALF_FLOAT:xt.UNSIGNED_BYTE,null),Ke.colorAttachment.set(Be)}(ne,0,qe,Le,Ce,ze)}else ge.bindTexture(ge.TEXTURE_2D,Le.colorAttachment.get()),ne.bindFramebuffer.set(Le.framebuffer)})(x,f,s,f.transform.projection.name==="globe"?.5:.25),x.clear({color:r.aj.transparent});const N=f.transform,V=N.projection.name==="globe",q=V?["PROJECTION_GLOBE_VIEW"]:[],Z=V?fi.frontCCW:fi.disabled,K=[r.at(N.center.lng),r.aA(N.center.lat)];for(let ne=0;ne<m.length;ne++){const fe=m[ne];if(i.hasRenderableParent(fe))continue;const ue=i.getTile(fe),ve=ue.getBucket(s);if(!ve||ve.projection.name!==N.projection.name)continue;const ge=f.isTileAffectedByFog(fe),Ce=ve.programConfigurations.get(s.id),ze=f.getOrCreateProgram("heatmap",{config:Ce,defines:q,overrideFog:ge}),{zoom:Le}=f.transform;f.terrain&&f.terrain.setupElevationDraw(ue,ze),f.uploadCommonUniforms(x,ze,fe.toUnwrapped());const qe=N.projection.createInversionMatrix(N,fe.canonical);ze.draw(f,b.TRIANGLES,Qn.disabled,T,P,Z,Ln(f,fe,ue,qe,K,Le,s.paint.get("heatmap-intensity")),s.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,s.paint,f.transform.zoom,Ce,V?[ve.globeExtVertexBuffer]:null)}x.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(x,b){const T=x.context,P=T.gl,N=b.heatmapFbo;if(!N)return;T.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,N.colorAttachment.get()),T.activeTexture.set(P.TEXTURE1);let V=b.colorRampTexture;V||(V=b.colorRampTexture=new r.T(T,b.colorRamp,P.RGBA8)),V.bind(P.LINEAR,P.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,P.TRIANGLES,Qn.disabled,pi.disabled,x.colorModeForRenderPass(),fi.disabled,((q,Z,K,ne)=>({u_image:0,u_color_ramp:1,u_opacity:Z.paint.get("heatmap-opacity")}))(0,b),b.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,b.paint,x.transform.zoom)}(f,s))},line:function(f,i,s,m){if(f.renderPass!=="translucent")return;const x=s.paint.get("line-opacity"),b=s.paint.get("line-width");if(x.constantOr(1)===0||b.constantOr(1)===0)return;const T=s.paint.get("line-emissive-strength"),P=s.paint.get("line-occlusion-opacity"),N=s.layout.get("line-elevation-reference"),V=s.layout.get("line-width-unit")==="meters",q=N==="sea",Z=f.context,K=Z.gl;if(s.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const ne=s.layout.get("line-cross-slope"),fe=ne!==void 0,ue=ne<1,ve=f.colorModeForDrapableLayerRenderPass(T),ge=f.terrain&&f.terrain.renderingToTexture,Ce=ge?1:r.q.devicePixelRatio,ze=s.paint.get("line-dasharray"),Le=ze.constantOr(1),qe=s.layout.get("line-cap"),Ne=ze.constantOr(null),Ge=qe.constantOr(null),Be=s.paint.get("line-pattern"),Ke=Be.constantOr(1),it=Be.constantOr(null),Rt=s.paint.get("line-opacity").constantOr(1);let xt=!Ke&&Rt!==1||f.depthOcclusion&&P>0&&P<1;const jt=s.paint.get("line-gradient"),zt=Ke?"linePattern":"line",pt=r.c_(s);let Dt;if(ge&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(xt=!1),P!==0&&f.depthOcclusion){const dt=s.paint._values["line-opacity"];dt&&dt.value&&dt.value.kind==="constant"?Dt=dt.value:r.w(`Occlusion opacity for layer ${s.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&pt.push("VARIABLE_LINE_WIDTH");const tn=(dt,Ut,Pt,dn,Zt)=>{for(const Gt of dt){const rn=i.getTile(Gt);if(Ke&&!rn.patternsLoaded())continue;const mn=rn.getBucket(s);if(!mn||mn.hasZOffset&&!Zt||!mn.hasZOffset&&Zt)continue;f.prepareDrawTile();const Cn=mn.programConfigurations.get(s.id),zn=f.isTileAffectedByFog(Gt),ni=f.getOrCreateProgram(zt,{config:Cn,defines:Ut,overrideFog:zn,overrideRtt:!Zt&&void 0});if(it&&rn.imageAtlas){const Ei=r.A.from(it).getPrimary().scaleSelf(Ce).serialize(),Qi=rn.imageAtlas.patternPositions[Ei];Qi&&Cn.setConstantPatternPositions(Qi)}if(!Ke&&Ne&&Ge&&rn.lineAtlas){const Ei=rn.lineAtlas.getDash(Ne,Ge);Ei&&Cn.setConstantPatternPositions(Ei)}let[Yn,Zn]=s.paint.get("line-trim-offset");(Ge==="round"||Ge==="square")&&Yn!==Zn&&(Yn===0&&(Yn-=1),Zn===1&&(Zn+=1));const mi=ge?Gt.projMatrix:null,gi=V?1/mn.tileToMeter/r.ar(rn,1,f.transform.zoom):1,pr=V?1/mn.tileToMeter/r.ar(rn,1,Math.floor(f.transform.zoom)):1,Qr=Ke?r.c$(f,rn,s,mi,Ce,gi,pr,[Yn,Zn]):r.d0(f,rn,s,mi,mn.lineClipsArray.length,Ce,gi,pr,[Yn,Zn]);if(jt){const Ei=mn.gradients[s.id];let Qi=Ei.texture;if(s.gradientVersion!==Ei.version){let Rn=256;if(s.stepInterpolant){const li=i.getSource().maxzoom,ri=Gt.canonical.z===li?Math.ceil(1<<f.transform.maxZoom-Gt.canonical.z):1;Rn=r.aw(r.d1(mn.maxLineLength/r.ag*1024*ri),256,Z.maxTextureSize)}Ei.gradient=r.d2({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:Rn,image:Ei.gradient||void 0,clips:mn.lineClipsArray}),Ei.texture?Ei.texture.update(Ei.gradient):Ei.texture=new r.T(Z,Ei.gradient,K.RGBA8),Ei.version=s.gradientVersion,Qi=Ei.texture}Z.activeTexture.set(K.TEXTURE1),Qi.bind(s.stepInterpolant?K.NEAREST:K.LINEAR,K.CLAMP_TO_EDGE)}Le&&(Z.activeTexture.set(K.TEXTURE0),rn.lineAtlasTexture&&rn.lineAtlasTexture.bind(K.LINEAR,K.REPEAT),Cn.updatePaintBuffers()),Ke&&(Z.activeTexture.set(K.TEXTURE0),rn.imageAtlasTexture&&rn.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),Cn.updatePaintBuffers()),Zt&&!q&&f.terrain.setupElevationDraw(rn,ni),f.uploadCommonUniforms(Z,ni,Gt.toUnwrapped());const Pr=Ei=>{Dt!=null&&(Dt.value=Rt*P),ni.draw(f,K.TRIANGLES,Pt,Ei,ve,fi.disabled,Qr,s.id,mn.layoutVertexBuffer,mn.indexBuffer,mn.segments,s.paint,f.transform.zoom,Cn,[mn.layoutVertexBuffer2,mn.patternVertexBuffer,mn.zOffsetVertexBuffer]),Dt!=null&&(Dt.value=Rt)};if(xt&&!Zt){const Ei=f.stencilModeForClipping(Gt).ref;Ei===0&&ge&&Z.clear({stencil:0});const Qi={func:K.EQUAL,mask:255};Qr.u_alpha_discard_threshold=.8,Pr(new pi(Qi,Ei,255,K.KEEP,K.KEEP,K.INVERT)),Qr.u_alpha_discard_threshold=0,Pr(new pi(Qi,Ei,255,K.KEEP,K.KEEP,K.KEEP))}else xt&&Zt&&(Qr.u_alpha_discard_threshold=.001),Pr(Zt?dn:f.stencilModeForClipping(Gt))}};if(s.hasNonElevatedBuckets){const dt=!ge&&f.terrain;P!==0&&dt?r.w(`Occlusion opacity for layer ${s.id} is supported on terrain only if the layer has line-z-offset enabled.`):dt?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${s.id}.`):tn(m,pt,f.depthModeForSublayer(0,Qn.ReadOnly),pi.disabled,!1)}if(s.hasElevatedBuckets){pt.push("ELEVATED"),fe&&pt.push(ue?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),q&&pt.push("ELEVATION_REFERENCE_SEA");const dt=xt?f.stencilModeFor3D():pi.disabled,Ut=new Qn(f.depthOcclusion?K.GREATER:K.LEQUAL,Qn.ReadOnly,f.depthRangeFor3D);f.forceTerrainMode=!0,tn(m,pt,Ut,dt,!0),f.forceTerrainMode=!1}xt&&(f.resetStencilClippingMasks(),ge&&Z.clear({stencil:0})),P===0||f.depthOcclusion||ge||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,i,s,m){const x=s.paint.get("fill-color"),b=s.paint.get("fill-opacity"),T=s.is3D(),P=new Qn(f.context.gl.LEQUAL,Qn.ReadWrite,f.depthRangeFor3D);if(b.constantOr(1)===0)return;const N=s.paint.get("fill-emissive-strength"),V=f.colorModeForDrapableLayerRenderPass(N),q=s.paint.get("fill-pattern"),Z=f.opaquePassEnabledForLayer()&&!q.constantOr(1)&&x.constantOr(r.aj.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===Z){const K=T?P:f.depthModeForSublayer(1,f.renderPass==="opaque"?Qn.ReadWrite:Qn.ReadOnly);Ks(f,i,s,m,K,V,!1)}if(!T&&f.renderPass==="translucent"&&s.paint.get("fill-antialias")){const K=T?P:f.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,Qn.ReadOnly);Ks(f,i,s,m,K,V,!0)}},"fill-extrusion":function(f,i,s,m){const x=s.paint.get("fill-extrusion-opacity"),b=f.context,T=b.gl,P=f.terrain,N=P&&P.renderingToTexture;if(x===0)return;const V=f.conflationActive&&f.style.isLayerClipped(s,i.getSource()),q=f.style.order.indexOf(s.fqid);if(V&&function(Z,K,ne,fe,ue){for(const ve of fe){const ge=K.getTile(ve).getBucket(ne);ge&&(ge.updateReplacement(ve,Z.replacementSource,ue),ge.uploadCentroid(Z.context))}}(f,i,s,m,q),P||V)for(const Z of m){const K=i.getTile(Z).getBucket(s);K&&qc(f.context,i,Z,K,s,P,V)}if(f.renderPass==="shadow"&&f.shadowRenderer){const Z=f.shadowRenderer;if(P&&x<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.a9)return;const K=Z.getShadowPassDepthMode(),ne=Z.getShadowPassColorMode();Gc(f,i,s,m,K,pi.disabled,ne,V)}else if(f.renderPass==="translucent"){const Z=!s.paint.get("fill-extrusion-pattern").constantOr(1),K=s.paint.get("fill-extrusion-color").constantOr(r.aj.white);if(!N&&K.a!==0){const ne=new Qn(f.context.gl.LEQUAL,Qn.ReadWrite,f.depthRangeFor3D);x===1&&Z?Gc(f,i,s,m,ne,pi.disabled,Ui.unblended,V):(Gc(f,i,s,m,ne,pi.disabled,Ui.disabled,V),Gc(f,i,s,m,ne,f.stencilModeFor3D(),f.colorModeForRenderPass(),V),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&Z&&(!P&&f.transform.projection.name!=="globe"||N)){const ne=s.paint.get("fill-extrusion-opacity"),fe=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),ue=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ve=s.paint.get("fill-extrusion-flood-light-intensity"),ge=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ce=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(ge?null:s.lut).toArray01().slice(0,3),ze=fe>0&&ue>0,Le=ve>0,qe=(Ge,Be,Ke)=>(1-Ke)*Ge+Ke*Be,Ne=Ge=>{const Be=f.depthModeForSublayer(1,Qn.ReadOnly,T.LEQUAL,!0),Ke=s.paint.get(Ge?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),it=qe(.1,3,Ke),Rt=f._showOverdrawInspector;if(!Rt){const xt=new pi({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),jt=new Ui([T.ONE,T.ONE,T.ONE,T.ONE],r.aj.transparent,[!1,!1,!1,!0],T.MIN);Hc(f,i,s,m,Be,xt,jt,fi.disabled,Ge,"sdf",ne,fe,ue,ve,Ce,it,V,!1)}{const xt=Rt?pi.disabled:new pi({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),jt=Rt?f.colorModeForRenderPass():new Ui([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],r.aj.transparent,[!0,!0,!0,!0]);Hc(f,i,s,m,Be,xt,jt,fi.disabled,Ge,"color",ne,fe,ue,ve,Ce,it,V,!1)}};if(N){const Ge=(Be,Ke,it)=>{const Rt=f.depthModeForSublayer(1,Qn.ReadOnly,T.LEQUAL,!1),xt=s.paint.get(Be?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),jt=qe(.1,3,xt);{const zt=new Ui([T.ONE,T.ONE,T.ONE,T.ONE],r.aj.transparent,[!1,!1,!1,!0]);Hc(f,i,s,m,Rt,pi.disabled,zt,fi.disabled,Be,"clear",ne,fe,ue,ve,Ce,jt,V,Ke)}{const zt=new pi({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),pt=new Ui([T.ONE,T.ONE,T.ONE,T.ONE],r.aj.transparent,[!1,!1,!1,!0],T.MIN);Hc(f,i,s,m,Rt,zt,pt,fi.disabled,Be,"sdf",ne,fe,ue,ve,Ce,jt,V,Ke)}{const zt=Be?T.ZERO:T.ONE_MINUS_DST_ALPHA,pt=new pi({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),Dt=new Ui([zt,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],r.aj.transparent,[!0,!0,!0,!0]);Hc(f,i,s,m,Rt,pt,Dt,fi.disabled,Be,"color",ne,fe,ue,ve,Ce,jt,V,Ke)}{const zt=new Ui([T.ONE,T.ONE,T.ONE,Be?T.ZERO:T.ONE],r.aj.transparent,[!1,!1,!1,!0],Be?T.FUNC_ADD:T.MAX);Hc(f,i,s,m,Rt,pi.disabled,zt,fi.disabled,Be,"clear",ne,fe,ue,ve,Ce,jt,V,Ke,it)}};if(ze||Le){let Be;if(f.prepareDrawTile(),P){const Ke=P.drapeBufferSize[0],it=P.drapeBufferSize[1];Be=P.framebufferCopyTexture,Be&&(!Be||Be.size[0]===Ke&&Be.size[1]===it)||(Be&&Be.destroy(),Be=P.framebufferCopyTexture=new r.T(b,new r.r({width:Ke,height:it}),T.RGBA8)),Be.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,Ke,it)}ze&&Ge(!0,!1,Be),Le&&Ge(!1,!0,Be)}}else ze&&Ne(!0),Le&&Ne(!1),(ze||Le)&&f.resetStencilClippingMasks()}}},hillshade:function(f,i,s,m){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const x=f.context,b=f.terrain&&f.terrain.renderingToTexture,[T,P]=f.renderPass!=="translucent"||b?[{},m]:f.stencilConfigForOverlap(m);for(const N of P){const V=i.getTile(N);if(V.needsHillshadePrepare&&f.renderPass==="offscreen")Mh(f,V,s);else if(f.renderPass==="translucent"){const q=f.depthModeForSublayer(0,Qn.ReadOnly),Z=s.paint.get("hillshade-emissive-strength"),K=f.colorModeForDrapableLayerRenderPass(Z),ne=b&&f.terrain?f.terrain.stencilModeForRTTOverlap(N):T[N.overscaledZ];us(f,N,V,s,q,ne,K)}}x.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,i,s,m,x,b){if(f.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;const T=f.transform.projection.name==="globe",P=s.paint.get("raster-elevation")!==0,N=P&&T;if(f.renderElevatedRasterBackface&&!N)return;const V=f.context,q=V.gl,Z=i.getSource(),K=function(Ne,Ge,Be,Ke){const it=Ge.paint.get("raster-color"),Rt=Ne.type==="raster-array",xt=[],jt=Ge.paint.get("raster-resampling"),zt=Ge.paint.get("raster-color-mix");let pt=Ge.paint.get("raster-color-range");const Dt=[zt[0],zt[1],zt[2],0],tn=zt[3];let dt=jt==="nearest"?Ke.NEAREST:Ke.LINEAR;if(Rt&&(xt.push("RASTER_ARRAY"),it||xt.push("RASTER_COLOR"),jt==="linear"&&xt.push("RASTER_ARRAY_LINEAR"),dt=Ke.NEAREST,!pt&&Ne.rasterLayers)){const Ut=Ne.rasterLayers.find(({id:Pt})=>Pt===Ge.sourceLayer);Ut&&Ut.fields&&Ut.fields.range&&(pt=Ut.fields.range)}if(pt=pt||[0,1],it){xt.push("RASTER_COLOR"),Be.activeTexture.set(Ke.TEXTURE2),Ge.updateColorRamp(pt);let Ut=Ge.colorRampTexture;Ut||(Ut=Ge.colorRampTexture=new r.T(Be,Ge.colorRamp,Ke.RGBA8)),Ut.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE)}return{mix:Dt,range:pt,offset:tn,defines:xt,resampling:dt}}(Z,s,V,q);if(Z instanceof r.aJ&&!m.length&&!T)return;const ne=s.paint.get("raster-emissive-strength"),fe=f.colorModeForDrapableLayerRenderPass(ne),ue=f.terrain&&f.terrain.renderingToTexture,ve=!f.options.moving,ge=s.paint.get("raster-resampling")==="nearest"?q.NEAREST:q.LINEAR;if(Z instanceof r.aJ&&!m.length&&(Z.onNorthPole||Z.onSouthPole)){const Ne=P?f.stencilModeFor3D():pi.disabled;return void bt(!!Z.onNorthPole,null,f,i,s,ne,K,fi.disabled,Ne)}if(!m.length)return;const[Ce,ze]=Z instanceof r.aJ||ue?[{},m]:f.stencilConfigForOverlap(m),Le=ze[ze.length-1].overscaledZ;N&&K.defines.push("PROJECTION_GLOBE_VIEW"),P&&K.defines.push("RENDER_CUTOFF");const qe=(Ne,Ge,Be)=>{for(const Ke of Ne){const it=Ke.toUnwrapped(),Rt=i.getTile(Ke);if(ue&&(!Rt||!Rt.hasData()))continue;V.activeTexture.set(q.TEXTURE0);const xt=tf(Rt,Z,s,K);if(!xt||!xt.texture)continue;const{texture:jt,mix:zt,offset:pt,tileSize:Dt,buffer:tn}=xt;let dt,Ut;ue?(dt=Qn.disabled,Ut=Ke.projMatrix):P?(dt=new Qn(q.LEQUAL,Qn.ReadWrite,f.depthRangeFor3D),Ut=T?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(it,ve)):(dt=f.depthModeForSublayer(Ke.overscaledZ-Le,s.paint.get("raster-opacity")===1?Qn.ReadWrite:Qn.ReadOnly,q.LESS),Ut=f.transform.calculateProjMatrix(it,ve));const Pt=f.terrain&&ue?f.terrain.stencilModeForRTTOverlap(Ke):Ce[Ke.overscaledZ],dn=b?0:s.paint.get("raster-fade-duration");Rt.registerFadeDuration(dn);const Zt=i.findLoadedParent(Ke,0),Gt=Ao(Rt,Zt,i,f.transform,dn);let rn,mn;f.terrain&&f.terrain.prepareDrawTile(),V.activeTexture.set(q.TEXTURE0),jt.bind(ge,q.CLAMP_TO_EDGE),V.activeTexture.set(q.TEXTURE1),Zt?(Zt.texture&&Zt.texture.bind(ge,q.CLAMP_TO_EDGE),rn=Math.pow(2,Zt.tileID.overscaledZ-Rt.tileID.overscaledZ),mn=[Rt.tileID.canonical.x*rn%1,Rt.tileID.canonical.y*rn%1]):jt.bind(ge,q.CLAMP_TO_EDGE),jt.useMipmap&&V.extTextureFilterAnisotropic&&f.transform.pitch>20&&q.texParameterf(q.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax);const Cn=f.transform;let zn;const ni=P?Mp(Cn):[0,0,0,0];let Yn,Zn,mi,gi,pr,Qr=0;if(N&&Z instanceof r.aJ&&Z.coordinates.length>3)Yn=Float32Array.from(r.bb(r.cH(new r.bT(0,0,0)))),Zn=Float32Array.from(Cn.globeMatrix),mi=Float32Array.from(r.cD(Cn)),gi=[r.at(Cn.center.lng),r.aA(Cn.center.lat)],zn=Z.elevatedGlobePerspectiveTransform,pr=Z.elevatedGlobeGridMatrix||new Float32Array(9);else if(N){const Rn=r.cE(Ke.canonical);Qr=r.cF(Rn.getCenter().lat),Yn=Float32Array.from(r.bb(r.cH(Ke.canonical))),Zn=Float32Array.from(Cn.globeMatrix),mi=Float32Array.from(r.cD(Cn)),gi=[r.at(Cn.center.lng),r.aA(Cn.center.lat)],zn=[0,0],pr=Float32Array.from(r.cG(Ke.canonical,Rn,Qr,Cn.worldSize/Cn._pixelsPerMercatorPixel))}else zn=Z instanceof r.aJ?Z.perspectiveTransform:[0,0],Yn=new Float32Array(16),Zn=new Float32Array(9),mi=new Float32Array(16),gi=[0,0],pr=new Float32Array(9);const Pr=Xl(Ut,Yn,Zn,mi,pr,mn||[0,0],r.ae(f.transform.zoom),gi,ni,rn||1,Gt,s,zn,P?s.paint.get("raster-elevation"):0,2,zt,pt,K.range,Dt,tn,ne),Ei=f.isTileAffectedByFog(Ke),Qi=f.getOrCreateProgram("raster",{defines:K.defines,overrideFog:Ei});if(f.uploadCommonUniforms(V,Qi,it),Z instanceof r.aJ){const Rn=Z.elevatedGlobeVertexBuffer,li=Z.elevatedGlobeIndexBuffer;if(ue||!T)Z.boundsBuffer&&Z.boundsSegments&&Qi.draw(f,q.TRIANGLES,dt,pi.disabled,fe,fi.disabled,Pr,s.id,Z.boundsBuffer,f.quadTriangleIndexBuffer,Z.boundsSegments);else if(Rn&&li){const ri=Cn.zoom<=r.c6?Z.elevatedGlobeSegments:Z.getSegmentsForLongitude(Cn.center.lng);ri&&Qi.draw(f,q.TRIANGLES,dt,pi.disabled,fe,Ge,Pr,s.id,Rn,li,ri)}}else if(N){dt=new Qn(q.LEQUAL,Qn.ReadOnly,f.depthRangeFor3D);const Rn=f.globeSharedBuffers;if(Rn){const[li,ri,hi]=Rn.getGridBuffers(Qr,!1);Qi.draw(f,q.TRIANGLES,dt,Be||Pt,f.colorModeForRenderPass(),Ge,Pr,s.id,li,ri,hi)}}else{const{tileBoundsBuffer:Rn,tileBoundsIndexBuffer:li,tileBoundsSegments:ri}=f.getTileBoundsBuffers(Rt);Qi.draw(f,q.TRIANGLES,dt,Pt,fe,fi.disabled,Pr,s.id,Rn,li,ri)}}if(!(Z instanceof r.aJ)&&N)for(const Ke of Ne){const it=Ke.canonical.y===(1<<Ke.canonical.z)-1;Ke.canonical.y===0&&bt(!0,Ke,f,i,s,ne,K,Ge,Be||pi.disabled),it&&bt(!1,Ke,f,i,s,ne,K,Ge===fi.frontCW?fi.backCW:fi.frontCW,Be||pi.disabled)}};N?qe(ze,f.renderElevatedRasterBackface?fi.backCW:fi.frontCW,f.stencilModeFor3D()):qe(ze,fi.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,i,s,m,x,b){f.renderPass==="offscreen"&&function(T,P,N,V){if(!V.length)return;const q=T.context,Z=q.gl,K=P.getSource();if(!(K instanceof er))return;const ne=Math.ceil(Math.sqrt(N.paint.get("raster-particle-count")));let fe=N.particlePositionRGBAImage;if(!fe||fe.width!==ne){const ze=function(Le){const qe=Le*Le,Ne=new Uint8Array(4*qe),Ge=function(Ke){return Ke|=0,Ke=Math.imul(2747636419^Ke,2654435769),Ke=Math.imul(Ke^Ke>>>16,2654435769),((Ke=Math.imul(Ke^Ke>>>16,2654435769))>>>0)/4294967296},Be=1/1.1;for(let Ke=0;Ke<qe;Ke++){const it=Be*(Ge(2*Ke+0)+gn),Rt=Be*(Ge(2*Ke+1)+gn),xt=255*it%1,jt=255*Rt%1,zt=xt,pt=Rt-jt/255,Dt=jt;Ne[4*Ke+0]=255*(it-xt/255),Ne[4*Ke+1]=255*zt,Ne[4*Ke+2]=255*pt,Ne[4*Ke+3]=255*Dt}return Ne}(ne);fe=N.particlePositionRGBAImage=new r.r({width:ne,height:ne},ze)}let ue=N.particleFramebuffer;ue?ue.width!==ne&&(ue.destroy(),ue=N.particleFramebuffer=q.createFramebuffer(ne,ne,!0,null)):ue=N.particleFramebuffer=q.createFramebuffer(ne,ne,!0,null);const ve=[];for(const ze of V){const Le=P.getTile(ze);if(!(Le instanceof Fl))continue;const qe=ig(Le,K,N);if(!qe)continue;const Ne=[Le.tileSize,Le.tileSize];let Ge=N.tileFramebuffer;Ge||(Ge=N.tileFramebuffer=q.createFramebuffer(Ne[0],Ne[1],!0,null));let Be=Le.rasterParticleState;Be||(Be=Le.rasterParticleState=new ng(q,ze,Ne,fe));const Ke=Be.update(N.lastInvalidatedAt);Be.particleTextureDimension!==ne&&Be.updateParticleTexture(ze,fe);const it=Be.targetColorTexture;Be.targetColorTexture=Be.backgroundColorTexture,Be.backgroundColorTexture=it;const Rt=Be.particleTexture0;Be.particleTexture0=Be.particleTexture1,Be.particleTexture1=Rt,ve.push([ze,qe,Be,Ke])}if(ve.length===0)return;const ge=r.q.now(),Ce=N.previousDrawTimestamp?.001*(ge-N.previousDrawTimestamp):.0167;if(N.previousDrawTimestamp=ge,N.hasColorMap()){q.activeTexture.set(Z.TEXTURE0+2);let ze=N.colorRampTexture;ze||(ze=N.colorRampTexture=new r.T(q,N.colorRamp,Z.RGBA8)),ze.bind(Z.LINEAR,Z.CLAMP_TO_EDGE)}q.bindFramebuffer.set(N.tileFramebuffer.framebuffer),function(ze,Le,qe){const Ne=ze.context,Ge=Ne.gl,Be=Le.tileFramebuffer;Ne.activeTexture.set(Ge.TEXTURE0);const Ke={u_texture:0,u_opacity:1.05*(Rt=Le.paint.get("raster-particle-fade-opacity-factor"))/(Rt+.05)},it=ze.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Rt;for(const xt of qe){const[,,jt,zt]=xt;Be.colorAttachment.set(jt.targetColorTexture.texture),Ne.viewport.set([0,0,Be.width,Be.height]),Ne.clear({color:r.aj.transparent}),zt&&(jt.backgroundColorTexture.bind(Ge.NEAREST,Ge.CLAMP_TO_EDGE),it.draw(ze,Ge.TRIANGLES,Qn.disabled,pi.disabled,Ui.alphaBlended,fi.disabled,Ke,Le.id,ze.viewportBuffer,ze.quadTriangleIndexBuffer,ze.viewportSegments))}}(T,N,ve),function(ze,Le,qe,Ne){const Ge=ze.context,Be=Ge.gl,Ke=qe.tileFramebuffer,it=ze.transform.projection.name==="globe",Rt=qe.paint.get("raster-particle-max-speed");for(const xt of Ne){const[jt,zt,pt]=xt;Ge.activeTexture.set(Be.TEXTURE0+0),zt.texture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE),Ke.colorAttachment.set(pt.targetColorTexture.texture);const Dt=ze.getOrCreateProgram("rasterParticleDraw",{defines:zt.defines,overrideFog:!1});Ge.activeTexture.set(Be.TEXTURE0+1);const tn=zt.scalarData?[]:[0,1,2,3].map(Pt=>r.d4[Pt](jt));tn.push(jt);const dt=jt.canonical.x,Ut=jt.canonical.y;for(const Pt of tn){const dn=Le.getTile(it?Pt.wrapped():Pt);if(!dn)continue;const Zt=dn.rasterParticleState;if(!Zt)continue;const Gt=Pt.canonical.x+(1<<Pt.canonical.z)*(Pt.wrap-jt.wrap),rn=Pt.canonical.y;Zt.particleTexture0.bind(Be.NEAREST,Be.CLAMP_TO_EDGE);const mn=Ga(1,Zt.particleTexture0.size[0],[Gt-dt,rn-Ut],0,zt.texture.size,2,Rt,zt.textureOffset,zt.scale,zt.offset);Dt.draw(ze,Be.POINTS,Qn.disabled,pi.disabled,Ui.alphaBlended,fi.disabled,mn,qe.id,Zt.particleIndexBuffer,void 0,Zt.particleSegment)}}}(T,P,N,ve),q.bindFramebuffer.set(N.particleFramebuffer.framebuffer),function(ze,Le,qe,Ne){const Ge=ze.context,Be=Ge.gl,Ke=Le.paint.get("raster-particle-max-speed"),it=Ne*Le.paint.get("raster-particle-speed-factor")*.15,Rt=function(jt){return Math.pow(jt,6)}(.01+1*Le.paint.get("raster-particle-reset-rate-factor")),xt=Le.particleFramebuffer;Ge.viewport.set([0,0,xt.width,xt.height]);for(const jt of qe){const[,zt,pt]=jt;Ge.activeTexture.set(Be.TEXTURE0+0),zt.texture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE),Ge.activeTexture.set(Be.TEXTURE0+1);const Dt=pt.particleTexture0;Dt.bind(Be.NEAREST,Be.CLAMP_TO_EDGE);const tn=Ep(1,Dt.size[0],0,zt.texture.size,Ke,it,Rt,zt.textureOffset,zt.scale,zt.offset);xt.colorAttachment.set(pt.particleTexture1.texture),Ge.clear({color:r.aj.transparent}),ze.getOrCreateProgram("rasterParticleUpdate",{defines:zt.defines}).draw(ze,Be.TRIANGLES,Qn.disabled,pi.disabled,Ui.unblended,fi.disabled,tn,Le.id,ze.viewportBuffer,ze.quadTriangleIndexBuffer,ze.viewportSegments)}}(T,N,ve,Ce)}(f,i,s,m),f.renderPass==="translucent"&&(function(T,P,N,V,q){const Z=T.context,K=Z.gl,ne=P.getSource().tileSize,fe=5*(1-r.ac(r.bY,r.bY+1,T.transform.zoom))*ne+N.paint.get("raster-particle-elevation"),ue=!T.options.moving,ve=T.transform.projection.name==="globe";if(!V.length)return;const[ge,Ce]=T.stencilConfigForOverlap(V),ze=[];ve&&ze.push("PROJECTION_GLOBE_VIEW");const Le=T.stencilModeFor3D();for(const qe of Ce){const Ne=qe.toUnwrapped(),Ge=P.getTile(qe);if(!Ge.rasterParticleState)continue;const Be=Ge.rasterParticleState,Ke=100;Ge.registerFadeDuration(Ke);const it=P.findLoadedParent(qe,0),Rt=Ao(Ge,it,P,T.transform,Ke);let xt,jt;T.terrain&&T.terrain.prepareDrawTile(),Z.activeTexture.set(K.TEXTURE0),Be.targetColorTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),Z.activeTexture.set(K.TEXTURE1),it&&it.rasterParticleState?(it.rasterParticleState.targetColorTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),xt=Math.pow(2,it.tileID.overscaledZ-Ge.tileID.overscaledZ),jt=[Ge.tileID.canonical.x*xt%1,Ge.tileID.canonical.y*xt%1]):Be.targetColorTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const zt=ve?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(Ne,ue),pt=T.transform,Dt=rg(pt),tn=r.cE(qe.canonical),dt=r.cF(tn.getCenter().lat);let Ut,Pt,dn,Zt,Gt;ve?(Ut=Float32Array.from(r.bb(r.cH(qe.canonical))),Pt=Float32Array.from(pt.globeMatrix),dn=Float32Array.from(r.cD(pt)),Zt=[r.at(pt.center.lng),r.aA(pt.center.lat)],Gt=Float32Array.from(r.cG(qe.canonical,tn,dt,pt.worldSize/pt._pixelsPerMercatorPixel))):(Ut=new Float32Array(16),Pt=new Float32Array(9),dn=new Float32Array(16),Zt=[0,0],Gt=new Float32Array(9));const rn=Wr(zt,Ut,Pt,dn,Gt,jt||[0,0],r.ae(T.transform.zoom),Zt,Dt,xt||1,Rt,fe),mn=T.isTileAffectedByFog(qe),Cn=T.getOrCreateProgram("rasterParticle",{defines:ze,overrideFog:mn});if(T.uploadCommonUniforms(Z,Cn,Ne),ve){const zn=new Qn(K.LEQUAL,Qn.ReadOnly,T.depthRangeFor3D),ni=0,Yn=T.globeSharedBuffers;if(Yn){const[Zn,mi,gi]=Yn.getGridBuffers(dt,ni!==0);Cn.draw(T,K.TRIANGLES,zn,Le,Ui.alphaBlended,T.renderElevatedRasterBackface?fi.frontCCW:fi.backCCW,rn,N.id,Zn,mi,gi)}}else{const zn=T.depthModeForSublayer(0,Qn.ReadOnly),ni=ge[qe.overscaledZ],{tileBoundsBuffer:Yn,tileBoundsIndexBuffer:Zn,tileBoundsSegments:mi}=T.getTileBoundsBuffers(Ge);Cn.draw(T,K.TRIANGLES,zn,ni,Ui.alphaBlended,fi.disabled,rn,N.id,Yn,Zn,mi)}}T.resetStencilClippingMasks()}(f,i,s,m),f.style.map.triggerRepaint())},background:function(f,i,s,m){const x=s.paint.get("background-color"),b=s.paint.get("background-color-use-theme").constantOr("default")==="none",T=s.paint.get("background-opacity"),P=s.paint.get("background-emissive-strength"),N=s.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const V=f.context,q=V.gl,Z=f.transform,K=Z.tileSize,ne=s.paint.get("background-pattern");let fe;if(ne!==void 0&&(ne===null||(fe=f.imageManager.getPattern(ne.toString(),s.scope,f.style.getLut(s.scope)),!fe)))return;const ue=!ne&&x.a===1&&T===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==ue)return;const ve=pi.disabled,ge=f.depthModeForSublayer(0,ue==="opaque"?Qn.ReadWrite:Qn.ReadOnly),Ce=f.colorModeForDrapableLayerRenderPass(P),ze=ne?"backgroundPattern":"background";let Le,qe=m;if(qe||(Le=f.getBackgroundTiles(),qe=Object.values(Le).map(Ne=>Ne.tileID)),ne&&(V.activeTexture.set(q.TEXTURE0),f.imageManager.bind(f.context,s.scope)),N){const Ne=f.getOrCreateProgram(ze,{overrideFog:!1,overrideRtt:!0}),Ge=new Float32Array(r.ab.mat4.identity([])),Be=new r.aG(0,0,0,0,0),Ke=ne?Fh(Ge,P,T,f,0,s.scope,fe,N,{tileID:Be,tileSize:K}):kh(Ge,P,T,x.toRenderColor(b?null:s.lut));Ne.draw(f,q.TRIANGLES,ge,ve,Ce,fi.disabled,Ke,s.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const Ne of qe){const Ge=f.isTileAffectedByFog(Ne),Be=f.getOrCreateProgram(ze,{overrideFog:Ge}),Ke=Ne.toUnwrapped(),it=m?Ne.projMatrix:f.transform.calculateProjMatrix(Ke);f.prepareDrawTile();const Rt=i?i.getTile(Ne):Le?Le[Ne.key]:new kl(Ne,K,Z.zoom,f),xt=ne?Fh(it,P,T,f,0,s.scope,fe,N,{tileID:Ne,tileSize:K}):kh(it,P,T,x.toRenderColor(b?null:s.lut));f.uploadCommonUniforms(V,Be,Ke);const{tileBoundsBuffer:jt,tileBoundsIndexBuffer:zt,tileBoundsSegments:pt}=f.getTileBoundsBuffers(Rt);Be.draw(f,q.TRIANGLES,ge,ve,Ce,fi.disabled,xt,s.id,jt,zt,pt)}},sky:function(f,i,s){const m=f._atmosphere?r.ae(f.transform.zoom):1,x=s.paint.get("sky-opacity")*m;if(x===0)return;const b=f.context,T=s.paint.get("sky-type"),P=new Qn(b.gl.LEQUAL,Qn.ReadOnly,[0,1]),N=f.frameCounter/1e3%1;T==="atmosphere"?f.renderPass==="offscreen"?s.needsSkyboxCapture(f)&&(function(V,q,Z,K){const ne=V.context,fe=ne.gl;let ue=q.skyboxFbo;if(!ue){ue=q.skyboxFbo=ne.createFramebuffer(32,32,!0,null),q.skyboxGeometry=new sg(ne),q.skyboxTexture=ne.gl.createTexture(),fe.bindTexture(fe.TEXTURE_CUBE_MAP,q.skyboxTexture),fe.texParameteri(fe.TEXTURE_CUBE_MAP,fe.TEXTURE_WRAP_S,fe.CLAMP_TO_EDGE),fe.texParameteri(fe.TEXTURE_CUBE_MAP,fe.TEXTURE_WRAP_T,fe.CLAMP_TO_EDGE),fe.texParameteri(fe.TEXTURE_CUBE_MAP,fe.TEXTURE_MIN_FILTER,fe.LINEAR),fe.texParameteri(fe.TEXTURE_CUBE_MAP,fe.TEXTURE_MAG_FILTER,fe.LINEAR);for(let ze=0;ze<6;++ze)fe.texImage2D(fe.TEXTURE_CUBE_MAP_POSITIVE_X+ze,0,fe.RGBA,32,32,0,fe.RGBA,fe.UNSIGNED_BYTE,null)}ne.bindFramebuffer.set(ue.framebuffer),ne.viewport.set([0,0,32,32]);const ve=q.getCenter(V,!0),ge=V.getOrCreateProgram("skyboxCapture"),Ce=new Float64Array(16);r.ab.mat4.identity(Ce),r.ab.mat4.rotateY(Ce,Ce,.5*-Math.PI),Ca(V,q,ge,Ce,ve,0),r.ab.mat4.identity(Ce),r.ab.mat4.rotateY(Ce,Ce,.5*Math.PI),Ca(V,q,ge,Ce,ve,1),r.ab.mat4.identity(Ce),r.ab.mat4.rotateX(Ce,Ce,.5*-Math.PI),Ca(V,q,ge,Ce,ve,2),r.ab.mat4.identity(Ce),r.ab.mat4.rotateX(Ce,Ce,.5*Math.PI),Ca(V,q,ge,Ce,ve,3),r.ab.mat4.identity(Ce),Ca(V,q,ge,Ce,ve,4),r.ab.mat4.identity(Ce),r.ab.mat4.rotateY(Ce,Ce,Math.PI),Ca(V,q,ge,Ce,ve,5),ne.viewport.set([0,0,V.width,V.height])}(f,s),s.markSkyboxValid(f)):f.renderPass==="sky"&&function(V,q,Z,K,ne){const fe=V.context,ue=fe.gl,ve=V.transform,ge=V.getOrCreateProgram("skybox");fe.activeTexture.set(ue.TEXTURE0),ue.bindTexture(ue.TEXTURE_CUBE_MAP,q.skyboxTexture);const Ce=((ze,Le,qe,Ne,Ge)=>({u_matrix:ze,u_sun_direction:Le,u_cubemap:0,u_opacity:Ne,u_temporal_offset:Ge}))(ve.skyboxMatrix,q.getCenter(V,!1),0,K,ne);V.uploadCommonUniforms(fe,ge),ge.draw(V,ue.TRIANGLES,Z,pi.disabled,V.colorModeForRenderPass(),fi.backCW,Ce,"skybox",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)}(f,s,P,x,N):T==="gradient"&&f.renderPass==="sky"&&function(V,q,Z,K,ne){const fe=V.context,ue=fe.gl,ve=V.transform,ge=V.getOrCreateProgram("skyboxGradient");q.skyboxGeometry||(q.skyboxGeometry=new sg(fe)),fe.activeTexture.set(ue.TEXTURE0);let Ce=q.colorRampTexture;Ce||(Ce=q.colorRampTexture=new r.T(fe,q.colorRamp,ue.RGBA8)),Ce.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);const ze=((Le,qe,Ne,Ge,Be)=>({u_matrix:Le,u_color_ramp:0,u_center_direction:qe,u_radius:r.ai(Ne),u_opacity:Ge,u_temporal_offset:Be}))(ve.skyboxMatrix,q.getCenter(V,!1),q.paint.get("sky-gradient-radius"),K,ne);V.uploadCommonUniforms(fe,ge),ge.draw(V,ue.TRIANGLES,Z,pi.disabled,V.colorModeForRenderPass(),fi.backCW,ze,"skyboxGradient",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)}(f,s,P,x,N)},debug:function(f,i,s,m,x,b){for(let T=0;T<s.length;T++)if(x){const V=new r.aj(m.r*.8,m.g*.8,m.b*.8,1);Jl(f,i,s[T],m,-1,-1,b),Jl(f,i,s[T],m,-1,1,b),Jl(f,i,s[T],m,1,1,b),Jl(f,i,s[T],m,1,-1,b),Jl(f,i,s[T],V,0,0,b)}else Jl(f,i,s[T],m,0,0,b)},custom:function(f,i,s,m){const x=f.context,b=s.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&s.isDraped(i)){if(f.renderPass==="offscreen"){const T=b.prerender;if(T){if(f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const P=f.transform.pointMerc;T.call(b,x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),r.ae(f.transform.zoom),[P.x,P.y],f.transform.pixelsPerMeterRatio)}else T.call(b,x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const P=b.renderToTile;if(P){const N=m[0].canonical,V=new r.aa(N.x+m[0].wrap*(1<<N.z),N.y,N.z);x.setDepthMode(Qn.disabled),x.setStencilMode(pi.disabled),x.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),P.call(b,x.gl,V),x.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),x.setStencilMode(pi.disabled);const T=b.renderingMode==="3d"?new Qn(f.context.gl.LEQUAL,Qn.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Qn.ReadOnly);if(x.setDepthMode(T),f.transform.projection.name==="globe"){const P=f.transform.pointMerc;b.render(x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),r.ae(f.transform.zoom),[P.x,P.y],f.transform.pixelsPerMeterRatio)}else b.render(x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState(),x.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,i,s,m){if(f.renderPass==="opaque")return;const x=s.paint.get("model-opacity").constantOr(1);if(x===0)return;const b=s.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!b||f.terrain&&x<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof r.a9))return;const T=f.shadowRenderer,P=s.paint.get("model-receive-shadows");T&&(T.useNormalOffset=!0,P||(T.enabled=!1));const N=()=>{T&&(T.useNormalOffset=!0,P||(T.enabled=!0))},V=i.getSource();if(f.renderPass==="light-beam"&&V.type!=="batched-model")return;if(V.type==="vector"||V.type==="geojson")return function(ge,Ce,ze,Le,qe){const Ne=ge.transform;if(Ne.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${Ne.projection.name} projection is not yet implemented`);const Ge=Ne.getFreeCameraOptions().position;if(!ge.modelManager)return;const Be=ge.modelManager;ze.modelManager=Be;const Ke=ge.shadowRenderer;if(!ze._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const it=ze._unevaluatedLayout._values["model-id"],Rt=Object.assign({},ze.layout.get("model-id").parameters),xt=ge.style.order.indexOf(ze.fqid);for(const jt of Le){const zt=Ce.getTile(jt).getBucket(ze);if(!zt||zt.projection.name!==Ne.projection.name)continue;const pt=zt.getModelUris();pt&&!zt.modelsRequested&&(Be.addModelsFromBucket(pt,qe),zt.modelsRequested=!0);const Dt=of(jt,Ne);Rt.zoom=Dt;const tn=it.possiblyEvaluate(Rt);if(yl(ge,zt,jt),Qa.shadowUniformsInitialized=!1,Qa.useSingleShadowCascade=!!Ke&&Ke.getMaxCascadeForTile(jt.toUnwrapped())===0,ge.renderPass==="shadow"&&Ke){if(ge.currentShadowCascade===1&&zt.isInsideFirstShadowMapFrustum)continue;const Pt=Ne.calculatePosMatrix(jt.toUnwrapped(),Ne.worldSize);if(Qa.tileMatrix.set(Pt),Qa.shadowTileMatrix=Float32Array.from(Ke.calculateShadowPassMatrixFromMatrix(Pt)),Qa.aabb.min.fill(0),Qa.aabb.max[0]=Qa.aabb.max[1]=r.ag,Qa.aabb.max[2]=0,Cp(zt,Qa,ge,ze.scope))continue}const dt=1<<jt.canonical.z,Ut=[((Ge.x-jt.wrap)*dt-jt.canonical.x)*r.ag,(Ge.y*dt-jt.canonical.y)*r.ag,Ge.z*dt*r.ag];ge.conflationActive&&Object.keys(zt.instancesPerModel).length>0&&ge.style.isLayerClipped(ze,Ce.getSource())&&zt.updateReplacement(jt,ge.replacementSource,xt,qe)&&(zt.uploaded=!1,zt.upload(ge.context));for(let Pt in zt.instancesPerModel){const dn=zt.instancesPerModel[Pt];dn.features.length>0&&(Pt=tn.evaluate(dn.features[0].feature,{}));const Zt=Be.getModel(Pt,qe);if(Zt&&Zt.uploaded)for(const Gt of Zt.nodes)jh(ge,ze,Gt,dn,Ut,jt,Qa)}}}(f,i,s,m,V.type==="vector"?s.scope:""),void N();if(!V.loaded())return;if(V.type==="batched-model")return function(ge,Ce,ze,Le){ze.resetLayerRenderingStats(ge);const qe=ge.context,Ne=ge.transform,Ge=ge.style.fog,Be=ge.shadowRenderer;if(Ne.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${Ne.projection.name} projection is not yet implemented`);const Ke=ge.transform.getFreeCameraOptions().position,it=r.ab.vec3.scale([],[Ke.x,Ke.y,Ke.z],ge.transform.worldSize),Rt=r.ab.vec3.negate([],it),xt=r.ab.mat4.identity([]),jt=r.dj(Ne.center.lat,Ne.zoom),zt=r.ab.mat4.fromScaling([],[1,1,1/jt]);r.ab.mat4.translate(xt,xt,Rt);const pt=ze.paint.get("model-opacity").constantOr(1),Dt=new Qn(qe.gl.LEQUAL,Qn.ReadWrite,ge.depthRangeFor3D),tn=new Qn(qe.gl.LEQUAL,Qn.ReadOnly,ge.depthRangeFor3D),dt=new r.cd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ut=ge.renderPass==="shadow",Pt=Ut&&Be?Be.getCurrentCascadeFrustum():Ne.getFrustum(Ne.scaleZoom(Ne.worldSize)),dn=ze.paint.get("model-front-cutoff"),Zt=dn[2]<1,Gt=Ec(ge,ze.paint.get("model-cutoff-fade-range")),rn=ze.getLayerRenderingStats();(function(mn,Cn,zn,ni){const Yn=mn.terrain?mn.terrain.exaggeration():0,Zn=mn.transform.zoom;for(const mi of ni){const gi=Cn.getTile(mi).getBucket(zn);gi&&(mn.conflationActive&&gi.updateReplacement(mi,mn.replacementSource),gi.evaluateScale(mn,zn),mn.terrain&&Yn>0&&gi.elevationUpdate(mn.terrain,Yn,mi,zn.source),gi.needsReEvaluation(mn,Zn,zn)&&gi.evaluate(zn))}})(ge,Ce,ze,Le),function(){let mn,Cn,zn;Zt?(mn=Le.length-1,Cn=-1,zn=-1):(mn=0,Cn=Le.length,zn=1);const ni=new Float64Array(16),Yn=r.ab.vec3.create(),Zn=new r.P(0,0);for(let mi=mn;mi!==Cn;mi+=zn){const gi=Le[mi],pr=Ce.getTile(gi).getBucket(ze);if(!pr||!pr.uploaded)continue;let Qr=!1;Be&&(Qr=Be.getMaxCascadeForTile(gi.toUnwrapped())===0);const Pr=Ne.calculatePosMatrix(gi.toUnwrapped(),Ne.worldSize),Ei=pr.modelTraits;!Ut&&Zt&&(r.ab.mat4.invert(ni,Pr),r.ab.vec3.transformMat4(Yn,it,ni),Zn.x=Yn[0],Zn.y=Yn[1]);const Qi=[];for(const Rn of pr.getNodesInfo()){if(Rn.hiddenByReplacement||!Rn.node.meshes)continue;const li=Rn.node;let ri=0;ge.terrain&&li.elevation&&(ri=li.elevation*ge.terrain.exaggeration());const hi=(()=>{const Xi=Rn.aabb;return dt.min=[...Xi.min],dt.max=[...Xi.max],dt.min[2]+=ri,dt.max[2]+=ri,r.ab.vec3.transformMat4(dt.min,dt.min,Pr),r.ab.vec3.transformMat4(dt.max,dt.max,Pr),dt})(),Hi=Rn.evaluatedScale;if(Hi[0]<=1&&Hi[1]<=1&&Hi[2]<=1&&hi.intersects(Pt)===0)continue;if(!Ut&&Zt){const Xi=.16666666666666666;Rn.cameraCollisionOpacity=it[0]>hi.min[0]&&it[0]<hi.max[0]&&it[1]>hi.min[1]&&it[1]<hi.max[1]&&it[2]*jt<hi.max[2]&&li.footprint&&r.bA(Zn,li.footprint)?Math.max(Rn.cameraCollisionOpacity-Xi,0):Math.min(1,Rn.cameraCollisionOpacity+Xi)}const Lr=[...Pr],jr=li.anchor?li.anchor[0]:0,ea=li.anchor?li.anchor[1]:0;r.ab.mat4.translate(Lr,Lr,[jr*(Hi[0]-1),ea*(Hi[1]-1),ri]),r.ab.vec3.exactEquals(Hi,r.dm)||r.ab.mat4.scale(Lr,Lr,Hi);const Vo=r.ab.mat4.multiply([],Lr,li.matrix),ha=r.ab.mat4.multiply([],Ne.expandedFarZProjMatrix,Vo),Yi=r.ab.mat4.multiply([],Ne.expandedFarZProjMatrix,Lr),hr=r.ab.vec4.transformMat4([],[jr,ea,ri,1],ha)[2];li.hidden=!1;let ur=pt;Ut||(Zt&&(ur*=Rn.cameraCollisionOpacity,ur*=lg(Lr,Ne,Rn.aabb,dn)),ur*=$c(Gt,hr)),ur!==0?Qi.push({nodeInfo:Rn,depth:hr,opacity:ur,wvpForNode:ha,wvpForTile:Yi,nodeModelMatrix:Vo,tileModelMatrix:Lr}):li.hidden=!0}Ut||Qi.sort((Rn,li)=>!Zt||Rn.opacity===1&&li.opacity===1?Rn.depth<li.depth?-1:1:Rn.opacity===1?-1:li.opacity===1?1:Rn.depth>li.depth?-1:1);for(const Rn of Qi){const li=Rn.nodeInfo,ri=li.node;let hi=r.ab.mat4.multiply([],zt,Rn.tileModelMatrix);r.ab.mat4.multiply(hi,xt,hi);const Hi=r.ab.mat4.invert([],hi);r.ab.mat4.transpose(Hi,Hi),r.ab.mat4.scale(Hi,Hi,sf),hi=r.ab.mat4.multiply(hi,hi,ri.matrix);const Lr=ge.renderPass==="light-beam",jr=ze.paint.get("model-color-use-theme").constantOr("default")==="none",ea=Ei&r.dp.HasMapboxMeshFeatures,Vo=ea?0:li.evaluatedRMEA[0][2];for(let ha=0;ha<ri.meshes.length;++ha){const Yi=ri.meshes[ha],hr=ha===ri.lightMeshIndex;let ur=Rn.wvpForNode;if(hr){if(!Lr&&!ge.terrain&&ge.shadowRenderer){ge.currentLayer<ge.firstLightBeamLayer&&(ge.firstLightBeamLayer=ge.currentLayer);continue}ur=Rn.wvpForTile}else if(Lr)continue;const Xi={defines:[]},Tr=[];if(!Ut&&Be&&(Be.useNormalOffset=!!Yi.normalBuffer),zu(Xi.defines,Tr,Yi,ge,jr?null:ze.lut),ea||Xi.defines.push("DIFFUSE_SHADED"),Qr&&Xi.defines.push("SHADOWS_SINGLE_CASCADE"),rn&&(Ut?rn.numRenderedVerticesInShadowPass+=Yi.vertexArray.length:rn.numRenderedVerticesInTransparentPass+=Yi.vertexArray.length),Ut){Vh(Yi,Rn.nodeModelMatrix,ge,ze);continue}let la=null;if(Ge){const _s=vl(Rn.nodeModelMatrix,ge.transform);if(la=new Float32Array(_s),Ne.projection.name!=="globe"){const to=Yi.aabb.min,Do=Yi.aabb.max,[vs,is]=Ge.getOpacityForBounds(_s,to[0],to[1],Do[0],Do[1]);Xi.overrideFog=vs>=We||is>=We}}const mr=Yi.material;let ca;mr.occlusionTexture&&mr.occlusionTexture.offsetScale&&(ca=mr.occlusionTexture.offsetScale,Xi.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const ns=ge.getOrCreateProgram("model",Xi);!Ut&&Be&&Be.setupShadowsFromMatrix(Rn.tileModelMatrix,ns,Be.useNormalOffset),ge.uploadCommonUniforms(qe,ns,null,la);const Io=mr.pbrMetallicRoughness;Io.metallicFactor=.9,Io.roughnessFactor=.5;const mo=Jd(new Float32Array(ur),new Float32Array(hi),new Float32Array(Hi),new Float32Array(ri.matrix),ge,Rn.opacity,Io.baseColorFactor.toRenderColor(null),mr.emissiveFactor,Io.metallicFactor,Io.roughnessFactor,mr,Vo,ze,[0,0,0],ca);!hr&&(li.hasTranslucentParts||Rn.opacity<1)&&ns.draw(ge,qe.gl.TRIANGLES,Dt,pi.disabled,Ui.disabled,fi.backCCW,mo,ze.id,Yi.vertexBuffer,Yi.indexBuffer,Yi.segments,ze.paint,ge.transform.zoom,void 0,Tr),ns.draw(ge,qe.gl.TRIANGLES,hr?tn:Dt,pi.disabled,hr||Rn.opacity<1||li.hasTranslucentParts?Ui.alphaBlended:Ui.unblended,fi.backCCW,mo,ze.id,Yi.vertexBuffer,Yi.indexBuffer,Yi.segments,ze.paint,ge.transform.zoom,void 0,Tr)}}}}()}(f,i,s,m),void N();if(V.type!=="model")return;const q=V.getModels(),Z=[],K=f.transform.getFreeCameraOptions().position,ne=r.ab.vec3.scale([],[K.x,K.y,K.z],f.transform.worldSize);r.ab.vec3.negate(ne,ne);const fe=[],ue=[];let ve=0;for(const ge of q){const Ce=s.paint.get("model-rotation").constantOr(null),ze=s.paint.get("model-scale").constantOr(null),Le=s.paint.get("model-translation").constantOr(null);ge.computeModelMatrix(f,Ce,ze,Le,!0,!0,!1);const qe=r.ab.mat4.identity([]),Ne=r.dj(ge.position.lat,f.transform.zoom),Ge=r.ab.mat4.fromScaling([],[1,1,1/Ne]);r.ab.mat4.translate(qe,qe,ne),Z.push({zScaleMatrix:Ge,negCameraPosMatrix:qe});for(const Be of ge.nodes)af(f.transform,Be,ge.matrix,f.transform.expandedFarZProjMatrix,ve,fe,ue);ve++}if(fe.sort((ge,Ce)=>Ce.depth-ge.depth),f.renderPass!=="shadow"){if(x===1)for(const ge of ue)Js(ge,f,s,Z[ge.modelIndex],pi.disabled,f.colorModeForRenderPass());else{for(const ge of ue)Js(ge,f,s,Z[ge.modelIndex],pi.disabled,Ui.disabled);for(const ge of ue)Js(ge,f,s,Z[ge.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(const ge of fe)Js(ge,f,s,Z[ge.modelIndex],pi.disabled,f.colorModeForRenderPass());N()}else{for(const ge of ue)Vh(ge.mesh,ge.nodeModelMatrix,f,s);for(const ge of fe)Vh(ge.mesh,ge.nodeModelMatrix,f,s);N()}}},qh={line:function(f,i,s){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(i){const m=i.getVisibleCoordinates();for(const x of m){const b=i.getTile(x).getBucket(f);if(b&&(b.hasZOffset?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,i,s){const m=i.getSource();if(!m.loaded())return;if(m.type==="vector"||m.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,m.type==="vector"?f.scope:""));if(m.type==="batched-model"||m.type!=="model")return;const x=m.getModels();for(const b of x)b.upload(s.context)},raster:function(f,i,s){const m=i.getSource();if(!(m instanceof er&&m.loaded()))return;const x=f.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!x)return;const b=f.paint.get("raster-array-band")||m.getInitialBand(x);if(b==null)return;const T=i.getIds().map(P=>i.getTileByID(P));for(const P of T)P.updateNeeded(x,b)&&m.prepareTile(P,x,b)},"raster-particle":function(f,i,s){const m=i.getSource();if(!(m instanceof er&&m.loaded()))return;const x=f.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!x)return;const b=f.paint.get("raster-particle-array-band")||m.getInitialBand(x);if(b==null)return;const T=i.getIds().map(P=>i.getTileByID(P));for(const P of T)P.updateNeeded(x,b)&&m.prepareTile(P,x,b)}};class Pp{constructor(i,s,m,x,b){this.context=new ef(i,s),this.transform=m,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=r.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const N of T)this._debugParams.enabledLayers[N]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const N of T)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],N);this.occlusionParams=new Zc(b),this.setup(),this.numSublayers=Ss.maxUnderzooming+Ss.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.dv,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Ya(this),this._wireframeDebugCache=new Rp,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const P=new r.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,P,i.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=x}updateTerrain(i,s){const m=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new hs(this,i));const x=this._terrain;this.transform.elevation=m?x:null,x.update(i,this.transform,s),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(i){const s=i.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,x]=s.getFovAdjustedRange(this.transform._fov);if(m>x)return void(this.transform.fogCullDistSq=null);const b=m+.78*(x-m);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(i){i&&!this._terrain&&(this._terrain=new hs(this,this.style)),this._forceTerrainMode=i}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,s){if(this.width=i*r.q.devicePixelRatio,this.height=s*r.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._mergedLayers[m].resize()}setup(){const i=this.context,s=new r.b4;s.emplaceBack(0,0),s.emplaceBack(r.ag,0),s.emplaceBack(0,r.ag),s.emplaceBack(r.ag,r.ag),this.tileExtentBuffer=i.createVertexBuffer(s,r.b6.members),this.tileExtentSegments=r.b7.simpleSegment(0,0,4,2);const m=new r.b4;m.emplaceBack(0,0),m.emplaceBack(r.ag,0),m.emplaceBack(0,r.ag),m.emplaceBack(r.ag,r.ag),this.debugBuffer=i.createVertexBuffer(m,r.b6.members),this.debugSegments=r.b7.simpleSegment(0,0,4,5);const x=new r.b4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(x,r.b6.members),this.viewportSegments=r.b7.simpleSegment(0,0,4,2);const b=new r.aT;b.emplaceBack(0,0,0,0),b.emplaceBack(r.ag,0,r.ag,0),b.emplaceBack(0,r.ag,0,r.ag),b.emplaceBack(r.ag,r.ag,r.ag,r.ag),this.mercatorBoundsBuffer=i.createVertexBuffer(b,r.b9.members),this.mercatorBoundsSegments=r.b7.simpleSegment(0,0,4,2);const T=new r.aU;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(T);const P=new r.b5;for(const V of[0,1,3,2,0])P.emplaceBack(V);this.debugIndexBuffer=i.createIndexBuffer(P),this.emptyTexture=new r.T(i,new r.r({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA8),this.identityMat=r.ab.mat4.create();const N=this.context.gl;this.stencilClearMode=new pi({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,Qn.disabled,this.stencilClearMode,Ui.disabled,fi.disabled,Dh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,s,m){if(!s||this.currentStencilSource===s.id||!i.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let P=!1;for(const N of m)if(this._tileClippingMaskIDs[N.key]===void 0){P=!0;break}if(!P)return}this.currentStencilSource=s.id;const x=this.context,b=x.gl;this.nextStencilID+m.length>256&&this.clearStencil(),x.setColorMode(Ui.disabled),x.setDepthMode(Qn.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of m){const N=s.getTile(P),V=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,{tileBoundsBuffer:q,tileBoundsIndexBuffer:Z,tileBoundsSegments:K}=this.getTileBoundsBuffers(N);T.draw(this,b.TRIANGLES,Qn.disabled,new pi({func:b.ALWAYS,mask:0},V,255,b.KEEP,b.KEEP,b.REPLACE),Ui.disabled,fi.disabled,Dh(P.projMatrix),"$clipping",q,Z,K)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,s=this.context.gl;return new pi({func:s.NOTEQUAL,mask:255},i,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const s=this.context.gl;return new pi({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(i){const s=this.context.gl,m=i.sort((T,P)=>P.overscaledZ-T.overscaledZ),x=m[m.length-1].overscaledZ,b=m[0].overscaledZ-x+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let P=0;P<b;P++)T[P+x]=new pi({func:s.GEQUAL,mask:255},P+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=b,[T,m]}return[{[x]:pi.disabled},m]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Ui([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new r.aj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ui.unblended:Ui.alphaBlended}colorModeForDrapableLayerRenderPass(i){const s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Ui([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new r.aj(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,s,m,x=!1){if(this.depthOcclusion)return new Qn(this.context.gl.GREATER,Qn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return Qn.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new Qn(m||this.context.gl.LEQUAL,s,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const i=this.context.gl,s=Math.ceil(this.width),m=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),b=i.getParameter(i.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===s&&this.depthFBO.height===m||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),s!==0&&m!==0&&(this.depthFBO=new eg(this.context,s,m,!1,"texture"),this.depthTexture=new r.T(this.context,{width:s,height:m,data:null},i.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),i.bindTexture(i.TEXTURE_2D,b),this.depthFBO&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),i.blitFramebuffer(0,0,s,m,0,0,s,m,i.DEPTH_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((i,s)=>i+s/this._fpsHistory.length,0))}render(i,s){const m=r.q.now();this._dt=m-this._timeStamp,this._timeStamp=m,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=s;const x=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(b).filter(pt=>{const Dt=x[pt];return!(Dt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Dt.type]});let P=T(),N=!1,V=!1;for(const pt of P){const Dt=x[pt];Dt.type==="circle"&&(N=!0),Dt.type==="symbol"&&(Dt.hasInitialOcclusionOpacityProperties?V=!0:N=!0)}let q=P.map(pt=>x[pt]);const Z=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(r.q.now()),this.imageManager.beginFrame();let K=0,ne=!1;for(const pt in Z){const Dt=Z[pt];Dt.used&&(Dt.prepare(this.context),Dt.getSource().usedInConflation&&++K)}let fe=!1;for(const pt of q)pt.isHidden(this.transform.zoom)||(pt.type==="clip"&&(fe=!0),this.prepareLayer(pt));const ue={},ve={},ge={},Ce={},ze={};for(const pt in Z){const Dt=Z[pt];ue[pt]=Dt.getVisibleCoordinates(),ve[pt]=ue[pt].slice().reverse(),ge[pt]=Dt.getVisibleCoordinates(!0).reverse(),Ce[pt]=Dt.getShadowCasterCoordinates(),ze[pt]=Dt.sortCoordinatesByDistance(ue[pt])}const Le=pt=>{const Dt=this.style.getLayerSourceCache(pt);return Dt&&Dt.used?Dt.getSource():null};if(K||fe||this._clippingActiveLastFrame){const pt=[],Dt=[];let tn=0;for(const dt of q)this.isSourceForClippingOrConflation(dt,Le(dt))&&(pt.push(dt),Dt.push(tn)),tn++;if(pt&&(fe||pt.length>1)||this._clippingActiveLastFrame){fe=!1;const dt=[];for(let Ut=0;Ut<pt.length;Ut++){const Pt=pt[Ut],dn=Dt[Ut],Zt=this.style.getLayerSourceCache(Pt);if(!Zt||!Zt.used||!Zt.getSource().usedInConflation&&Pt.type!=="clip")continue;let Gt=r.dx,rn=r.by.None;const mn=[];let Cn=!0;if(Pt.type==="clip"){Gt=dn;for(const zn of Pt.layout.get("clip-layer-types"))rn|=zn==="model"?r.by.Model:zn==="symbol"?r.by.Symbol:r.by.FillExtrusion;for(const zn of Pt.layout.get("clip-layer-scope"))mn.push(zn);Pt.isHidden(this.transform.zoom)?Cn=!1:fe=!0}Cn&&dt.push({layer:Pt.fqid,cache:Zt,order:Gt,clipMask:rn,clipScope:mn})}this.replacementSource.setSources(dt),ne=!0}}this._clippingActiveLastFrame=fe,ne||this.replacementSource.clear(),this.conflationActive=ne,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let pt=0;pt<q.length;pt++){const Dt=q[pt],tn=Dt.cutoffRange();if(this.longestCutoffRange=Math.max(tn,this.longestCutoffRange),tn>0){const dt=Le(Dt);dt&&(this.minCutoffZoom=Math.max(dt.minzoom,this.minCutoffZoom)),Dt.minzoom&&(this.minCutoffZoom=Math.max(Dt.minzoom,this.minCutoffZoom))}Dt.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=pt),this._lastOcclusionLayer=pt)}const qe=this.style&&this.style.fog;qe?(this._fogVisible=qe.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=qe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ge),this.opaquePassCutoff=0,P=T(),q=P.map(pt=>x[pt]));const Ne=this._shadowRenderer;if(Ne){Ne.updateShadowParameters(this.transform,this.style.directionalLight);for(const pt in Z)for(const Dt of ue[pt]){let tn={min:0,max:0};this.terrain&&(tn=this.terrain.getMinMaxForTile(Dt)||tn),Ne.addShadowReceiver(Dt.toUnwrapped(),tn.min,tn.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.dw(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ap(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Ge=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Be=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Ge&&!this._snow&&(this._snow=new Ql(this)),!Ge&&this._snow&&(this._snow.destroy(),delete this._snow),Be&&!this._rain&&(this._rain=new ku(this)),!Be&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Gn.has(this.context.gl))return;this.renderPass="offscreen";for(const pt of q){const Dt=i.getLayerSourceCache(pt);if(!pt.hasOffscreenPass()||pt.isHidden(this.transform.zoom))continue;const tn=Dt?ve[Dt.id]:void 0;(pt.type==="custom"||pt.type==="raster"||pt.type==="raster-particle"||pt.isSky()||tn&&tn.length)&&this.renderLayer(this,Dt,pt,tn)}this.depthRangeFor3D=[0,1-(q.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Ce)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ke=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),it=(()=>{if(s.showOverdrawInspector)return r.aj.black;const pt=this.style.fog;if(pt&&this.transform.projection.supportsFog){const Dt=this.style.getLut(pt.scope);if(!Ke){const tn=pt.properties.get("color-use-theme")==="none",dt=pt.properties.get("color").toRenderColor(tn?null:Dt).toArray01();return new r.aj(...dt)}if(Ke){const tn=pt.properties.get("space-color-use-theme")==="none",dt=pt.properties.get("space-color").toRenderColor(tn?null:Dt).toArray01();return new r.aj(...dt)}}return r.aj.transparent})();if(this.context.clear({color:it,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ke&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=P.length-1;this.currentLayer>=0;this.currentLayer--){const pt=q[this.currentLayer],Dt=i.getLayerSourceCache(pt);if(pt.isSky())continue;const tn=Dt?(pt.is3D()?ze:ve)[Dt.id]:void 0;this._renderTileClippingMasks(pt,Dt,tn),this.renderLayer(this,Dt,pt,tn)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ke&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.ae(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<P.length;this.currentLayer++){const pt=q[this.currentLayer],Dt=i.getLayerSourceCache(pt);pt.isSky()&&this.renderLayer(this,Dt,pt,Dt?ve[Dt.id]:void 0)}function Rt(pt,Dt){let tn;return Dt&&(tn=(pt.type==="symbol"?ge:pt.is3D()?ze:ve)[Dt.id]),tn}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<P.length;){const pt=q[this.currentLayer];if(pt.type==="raster"||pt.type==="raster-particle"){const Dt=i.getLayerSourceCache(pt);this.renderLayer(this,Dt,pt,Rt(pt,Dt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let xt=0;Ne&&(xt=Ne.getShadowCastingLayerCount());let jt=!1,zt=-1;for(let pt=0;pt<P.length;++pt){const Dt=q[pt];Dt.isHidden(this.transform.zoom)||Dt.is3D()&&(zt=pt)}for(V&&zt===-1&&(N=!0);this.currentLayer<P.length;){const pt=q[this.currentLayer],Dt=i.getLayerSourceCache(pt);if(pt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(pt)){if(pt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(N&&!jt&&this.terrain&&!this.transform.isOrthographic&&(jt=!0,this.blitDepth()),V&&zt!==-1&&this.currentLayer===zt+1&&!this.transform.isOrthographic&&this.blitDepth(),pt.is3D()||this.terrain||this._renderTileClippingMasks(pt,Dt,Dt?ue[Dt.id]:void 0),this.renderLayer(this,Dt,pt,Rt(pt,Dt)),!this.terrain&&Ne&&xt>0&&pt.hasShadowPass()&&--xt==0&&(Ne.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const tn=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=tn;this.currentLayer++){const dt=q[this.currentLayer];if(!dt.hasLightBeamPass())continue;const Ut=i.getLayerSourceCache(dt);this.renderLayer(this,Ut,dt,Ut?ve[Ut.id]:void 0)}this.currentLayer=tn,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const tn=this.currentLayer;this.depthOcclusion=!0;for(const dt of this.layersWithOcclusionOpacity){this.currentLayer=dt;const Ut=q[this.currentLayer],Pt=i.getLayerSourceCache(Ut),dn=Pt?ve[Pt.id]:void 0;Ut.is3D()||this.terrain||this._renderTileClippingMasks(Ut,Pt,Pt?ue[Pt.id]:void 0),this.renderLayer(this,Pt,Ut,dn)}this.depthOcclusion=!1,this.currentLayer=tn,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let pt=null;q.forEach(Dt=>{const tn=i.getLayerSourceCache(Dt);tn&&!Dt.isHidden(this.transform.zoom)&&tn.getVisibleCoordinates().length&&(!pt||pt.getSource().maxzoom<tn.getSource().maxzoom)&&(pt=tn)}),pt&&this.options.showTileBoundaries&&Yc.debug(this,pt,pt.getVisibleCoordinates(),r.aj.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Yc.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.aj(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(pt){const Dt=pt.transform.padding;og(pt,pt.transform.height-(Dt.top||0),3,Wc),og(pt,Dt.bottom||0,3,k_),Tp(pt,Dt.left||0,3,F_),Tp(pt,pt.transform.width-(Dt.right||0),3,ag);const tn=pt.transform.centerPoint;(function(dt,Ut,Pt,dn){Ps(dt,Ut-1,Pt-10,2,20,dn),Ps(dt,Ut-10,Pt-1,20,2,dn)})(pt,tn.x,pt.transform.height-tn.y,nf)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),ne||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);const{unsupportedLayers:s}=this.transform.projection,m=!s||!s.includes(i.type);if(qh[i.type]&&(m||this.terrain&&i.type==="custom")){const x=this.style.getLayerSourceCache(i);qh[i.type](i,x,this)}this.gpuTimingEnd()}renderLayer(i,s,m,x){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||m.type==="model"||m.type==="raster"||m.type==="raster-particle"||x&&x.length)&&(this.id=m.id,this.gpuTimingStart(m),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(m.type)&&(!i.terrain||m.type!=="custom")||m.type==="clip"||Yc[m.type](i,s,m,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery,m=this.context.gl;let x=this.gpuTimers[i.id];x||(x=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:m.createQuery()}),x.calls++,m.beginQuery(s.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,s=this.context.gl,m=s.createQuery();this.deferredRenderGpuTimeQueries.push(m),s.beginQuery(i.TIME_ELAPSED_EXT,m)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const s={};for(const m in i){const x=i[m],b=this.context.extTimerQuery,T=b.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(x.query),s[m]=T}return s}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.gl;let m=0;for(const x of i)m+=s.getQueryParameter(x,s.QUERY_RESULT)/1e6,s.deleteQuery(x);return m}translatePosMatrix(i,s,m,x,b){if(!m[0]&&!m[1])return i;const T=b?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(T){const V=Math.sin(T),q=Math.cos(T);m=[m[0]*q-m[1]*V,m[0]*V+m[1]*q]}const P=[b?m[0]:r.ar(s,m[0],this.transform.zoom),b?m[1]:r.ar(s,m[1],this.transform.zoom),0],N=new Float32Array(16);return r.ab.mat4.translate(N,i,P),N}saveTileTexture(i){const s=i.size[0],m=this._tileTextures[s];m?m.push(i):this._tileTextures[s]=[i]}getTileTexture(i){const s=this._tileTextures[i];return s&&s.length>0?s.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,s,m){const x=m===void 0?this.terrain&&this.terrain.renderingToTexture:m,b=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||x||s!==void 0&&!s||b.push("FOG","FOG_DITHERING"),x&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(i,s){this.cache=this.cache||{};const m=s&&s.defines||[],x=s&&s.config,b=this.currentGlobalDefines(i,s&&s.overrideFog,s&&s.overrideRtt).concat(m),T=L_.cacheKey(cs[i],i,b,x);return this.cache[T]||(this.cache[T]=new L_(this.context,i,cs[i],x,Qd[i],b)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,s){if(this.style.enable3dLights()){const m=this.style.directionalLight,x=this.style.ambientLight;if(m&&x){const b=((T,P,N)=>{const V=T.properties.get("direction"),q=T.properties.get("color-use-theme")==="none",Z=T.properties.get("color").toRenderColor(q?null:N.getLut(T.scope)).toArray01(),K=T.properties.get("intensity"),ne=P.properties.get("color-use-theme")==="none",fe=P.properties.get("color").toRenderColor(ne?null:N.getLut(P.scope)).toArray01(),ue=P.properties.get("intensity"),ve=[V.x,V.y,V.z],ge=r.cM(fe,ue),Ce=r.cM(Z,K);return{u_lighting_ambient_color:ge,u_lighting_directional_dir:ve,u_lighting_directional_color:Ce,u_ground_radiance:Wl(ve,Ce,ge)}})(m,x,this.style);s.setLightsUniformValues(i,b)}}}uploadCommonUniforms(i,s,m,x,b){if(this.uploadCommonLightUniforms(i,s),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const P=T.getOpacity(this.transform.pitch),N=((V,q,Z,K,ne,fe,ue,ve,ge,Ce,ze,Le)=>{const qe=V.transform,Ne=q.properties.get("color-use-theme")==="none",Ge=q.properties.get("color").toRenderColor(Ne?null:V.style.getLut(q.scope)).toArray01();Ge[3]=K;const Be=V.frameCounter/1e3%1,[Ke,it]=q.properties.get("vertical-range");return{u_fog_matrix:Z?qe.calculateFogTileMatrix(Z):Le||V.identityMat,u_fog_range:q.getFovAdjustedRange(qe._fov),u_fog_color:Ge,u_fog_horizon_blend:q.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ke,it),it],u_fog_temporal_offset:Be,u_frustum_tl:ne,u_frustum_tr:fe,u_frustum_br:ue,u_frustum_bl:ve,u_globe_pos:ge,u_globe_radius:Ce,u_viewport:ze,u_globe_transition:r.ae(qe.zoom),u_is_globe:+(qe.projection.name==="globe")}})(this,T,m,P,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.q.devicePixelRatio,this.transform.height*r.q.devicePixelRatio],x);s.setFogUniformValues(i,N)}b&&s.setCutoffUniformValues(i,b.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,s=i.createTexture();return i.bindTexture(i.TEXTURE_2D,s),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,s=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const x of m)s[x.key]=i[x.key]||new kl(x,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(i,s){return!(!i.is3D()||i.type!=="clip"&&(i.minzoom&&i.minzoom>this.transform.zoom||(this.style._clipLayerPresent||i.sourceLayer!=="building")&&(!s||s.type!=="batched-model")))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[i.key];return s||(this._cachedTileFogOpacities[i.key]=s=this.style.fog.getOpacityForTile(i)),s[0]>=We||s[1]>=We}setupDepthForOcclusion(i,s,m){const x=this.context,b=x.gl,T=!!m;var P;m||(m={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(b.TEXTURE3),i&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),m.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],m.u_depth_range_unpack=[2/((P=this.depthRangeFor3D)[1]-P[0]),-1-2*P[0]/(P[1]-P[0])],m.u_occluder_half_size=.5*this.occlusionParams.occluderSize,m.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),x.activeTexture.set(b.TEXTURE0),T||s.setTerrainUniformValues(x,m)}}function cf(f,i){let s=!1,m=null;const x=()=>{m=null,s&&(f(),m=setTimeout(x,i),s=!1)};return()=>(s=!0,m||x(),m)}class uf{constructor(i){this._hashName=i&&encodeURIComponent(i),r.aP(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=cf(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const s=Lp(i);if(this._hashName){const m=this._hashName;let x=!1;const b=location.hash.slice(1).split("&").map(T=>{const P=T.split("=")[0];return P===m?(x=!0,`${P}=${s}`):T}).filter(T=>T);return x||b.push(`${m}=${s}`),`#${b.join("&")}`}return`#${s}`}_getCurrentHash(){const i=location.hash.replace("#","");if(this._hashName){let s;return i.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(s=m)}),(s&&s[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(m=>isNaN(m))){const m=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(s[3]||0):i.getBearing();return i.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:m,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Lp(f,i){const s=f.getCenter(),m=Math.round(100*f.getZoom())/100,x=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,x),T=Math.round(s.lng*b)/b,P=Math.round(s.lat*b)/b,N=f.getBearing(),V=f.getPitch();let q=i?`/${T}/${P}/${m}`:`${m}/${P}/${T}`;return(N||V)&&(q+="/"+Math.round(10*N)/10),V&&(q+=`/${Math.round(V)}`),q}const Fu={linearity:.3,easing:r.dy(0,0,.3,1)},cg=r.l({deceleration:2500,maxSpeed:1400},Fu),ug=r.l({deceleration:20,maxSpeed:1400},Fu),B_=r.l({deceleration:1e3,maxSpeed:360},Fu),hg=r.l({deceleration:1e3,maxSpeed:90},Fu);class eo{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.q.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,s=r.q.now();for(;i.length>0&&s-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)s.zoom+=b.zoomDelta||0,s.bearing+=b.bearingDelta||0,s.pitch+=b.pitchDelta||0,b.panDelta&&s.pan._add(b.panDelta),b.around&&(s.around=b.around),b.pinchAround&&(s.pinchAround=b.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(s.pan.mag()){const b=Wh(s.pan.mag(),m,r.l({},cg,i||{}));x.offset=s.pan.mult(b.amount/s.pan.mag()),x.center=this._map.transform.center,za(x,b)}if(s.zoom){const b=Wh(s.zoom,m,ug);x.zoom=this._map.transform.zoom+b.amount,za(x,b)}if(s.bearing){const b=Wh(s.bearing,m,B_);x.bearing=this._map.transform.bearing+r.aw(b.amount,-179,179),za(x,b)}if(s.pitch){const b=Wh(s.pitch,m,hg);x.pitch=this._map.transform.pitch+b.amount,za(x,b)}if(x.zoom||x.bearing){const b=s.pinchAround===void 0?s.around:s.pinchAround;x.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function za(f,i){(!f.duration||f.duration<i.duration)&&(f.duration=i.duration,f.easing=i.easing)}function Wh(f,i,s){const{maxSpeed:m,linearity:x,deceleration:b}=s,T=r.aw(f*x/(i/1e3),-m,m),P=Math.abs(T)/(b*x);return{easing:s.easing,duration:1e3*P,amount:T*(P/2)}}class Bo extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,s,m,x={}){const b=Ve(s.getCanvasContainer(),m),T=s.unproject(b);super(i,r.l({point:b,lngLat:T,originalEvent:m},x)),this._defaultPrevented=!1,this.target=s}}class $h extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,s,m){const x=i==="touchend"?m.changedTouches:m.touches,b=Se(s.getCanvasContainer(),x),T=b.map(N=>s.unproject(N)),P=b.reduce((N,V,q,Z)=>N.add(V.div(Z.length)),new r.P(0,0));super(i,{points:b,point:P,lngLats:T,lngLat:s.unproject(P),originalEvent:m}),this._defaultPrevented=!1}}class dg extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,s){super("wheel",{originalEvent:s}),this._defaultPrevented=!1}}class U_{constructor(i,s){this._map=i,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new dg(this._map,i))}mousedown(i,s){return this._mousedownPos=s,this._firePreventable(new Bo(i.type,this._map,i))}mouseup(i){this._map.fire(new Bo(i.type,this._map,i))}preclick(i){const s=r.l({},i);s.type="preclick",this._map.fire(new Bo(s.type,this._map,s))}click(i,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Bo(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Bo(i.type,this._map,i))}mouseover(i){this._map.fire(new Bo(i.type,this._map,i))}mouseout(i){this._map.fire(new Bo(i.type,this._map,i))}touchstart(i){return this._firePreventable(new $h(i.type,this._map,i))}touchmove(i){this._map.fire(new $h(i.type,this._map,i))}touchend(i){this._map.fire(new $h(i.type,this._map,i))}touchcancel(i){this._map.fire(new $h(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hf{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new Bo(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Bo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Bo(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Jr{constructor(i,s){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,s){this.isEnabled()&&i.shiftKey&&i.button===0&&(pe(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(i,s){if(!this._active)return;const m=s,x=this._startPos,b=this._lastPos;if(!x||!b||b.equals(m)||!this._box&&m.dist(x)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=Q("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const T=Math.min(x.x,m.x),P=Math.max(x.x,m.x),N=Math.min(x.y,m.y),V=Math.max(x.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${N}px)`,this._box.style.width=P-T+"px",this._box.style.height=V-N+"px")})}mouseupWindow(i,s){if(!this._active)return;const m=this._startPos,x=s;if(m&&i.button===0){if(this.reset(),be(),m.x!==x.x||m.y!==x.y)return this._map.fire(new r.z("boxzoomend",{originalEvent:i})),{cameraAnimation:b=>b.fitScreenCoordinates(m,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ae(),delete this._startPos,delete this._lastPos}_fireEvent(i,s){return this._map.fire(new r.z(i,{originalEvent:s}))}}function df(f,i){const s={};for(let m=0;m<f.length;m++)s[f[m].identifier]=i[m];return s}class V_{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,s,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),m.length===this.numTouches&&(this.centroid=function(x){const b=new r.P(0,0);for(const T of x)b._add(T);return b.div(x.length)}(s),this.touches=df(m,s)))}touchmove(i,s,m){if(this.aborted||!this.centroid)return;const x=df(m,s);for(const b in this.touches){const T=x[b];(!T||T.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(i,s,m){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Op{constructor(i){this.singleTap=new V_(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,s,m){this.singleTap.touchstart(i,s,m)}touchmove(i,s,m){this.singleTap.touchmove(i,s,m)}touchend(i,s,m){const x=this.singleTap.touchend(i,s,m);if(x){const b=i.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(x)<30;if(b&&T||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Nu{constructor(){this._zoomIn=new Op({numTouches:1,numTaps:2}),this._zoomOut=new Op({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,s,m){this._zoomIn.touchstart(i,s,m),this._zoomOut.touchstart(i,s,m)}touchmove(i,s,m){this._zoomIn.touchmove(i,s,m),this._zoomOut.touchmove(i,s,m)}touchend(i,s,m){const x=this._zoomIn.touchend(i,s,m),b=this._zoomOut.touchend(i,s,m);return x?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(x)},{originalEvent:i})}):b?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const zp={0:1,2:2};class Bu{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,s){return!1}_move(i,s){return{}}mousedown(i,s){if(this._lastPoint)return;const m=xe(i);this._correctButton(i,m)&&(this._lastPoint=s,this._eventButton=m)}mousemoveWindow(i,s){const m=this._lastPoint;if(m){if(i.preventDefault(),this._eventButton!=null&&function(x,b){const T=zp[b];return x.buttons===void 0||(x.buttons&T)!==T}(i,this._eventButton))this.reset();else if(this._moved||!(s.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(m,s)}}mouseupWindow(i){this._lastPoint&&xe(i)===this._eventButton&&(this._moved&&be(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ff extends Bu{mousedown(i,s){super.mousedown(i,s),this._lastPoint&&(this._active=!0)}_correctButton(i,s){return s===0&&!i.ctrlKey}_move(i,s){return{around:s,panDelta:s.sub(i)}}}class ks extends Bu{_correctButton(i,s){return s===0&&i.ctrlKey||s===2}_move(i,s){const m=.8*(s.x-i.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(i){i.preventDefault()}}class Uu extends Bu{_correctButton(i,s){return s===0&&i.ctrlKey||s===2}_move(i,s){const m=-.5*(s.y-i.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(i){i.preventDefault()}}class aa{constructor(i,s){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),r.aP(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(i,s,m){return this._calculateTransform(i,s,m)}touchmove(i,s,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!r.dz())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,s,m)}}touchend(i,s,m){this._calculateTransform(i,s,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,s,m){m.length>0&&(this._active=!0);const x=df(m,s),b=new r.P(0,0),T=new r.P(0,0);let P=0;for(const V in x){const q=x[V],Z=this._touches[V];Z&&(b._add(q),T._add(q.sub(Z)),P++,x[V]=q)}if(this._touches=x,P<this._minTouches||!T.mag())return;const N=T.div(P);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(P),panDelta:N}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Q("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class fs{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,s,m){return{}}touchstart(i,s,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([s[0],s[1]]))}touchmove(i,s,m){const x=this._firstTwoTouches;if(!x)return;i.preventDefault();const[b,T]=x,P=Kc(m,s,b),N=Kc(m,s,T);if(!P||!N)return;const V=this._aroundCenter?null:P.add(N).div(2);return this._move([P,N],V,i)}touchend(i,s,m){if(!this._firstTwoTouches)return;const[x,b]=this._firstTwoTouches,T=Kc(m,s,x),P=Kc(m,s,b);T&&P||(this._active&&be(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Kc(f,i,s){for(let m=0;m<f.length;m++)if(f[m].identifier===s)return i[m]}function Xh(f,i){return Math.log(f/i)/Math.LN2}class bl extends fs{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,s){const m=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Xh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Xh(this._distance,m),pinchAround:s}}}function kp(f,i){return 180*f.angleWith(i)/Math.PI}class pf extends fs{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,s){const m=this._vector;if(this._vector=i[0].sub(i[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:kp(this._vector,m),pinchAround:s}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const s=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const x=kp(i,m);return Math.abs(x)<s}}function Fp(f){return Math.abs(f.y)>Math.abs(f.x)}class fg extends fs{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,Fp(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,s,m){const x=this._lastPoints;if(!x)return;const b=i[0].sub(x[0]),T=i[1].sub(x[1]);return this._map._cooperativeGestures&&!r.dz()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(b,T,m.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(b.y+T.y)/2*-.5})}gestureBeginsVertically(i,s,m){if(this._valid!==void 0)return this._valid;const x=i.mag()>=2,b=s.mag()>=2;if(!x&&!b)return;if(!x||!b)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const T=i.y>0==s.y>0;return Fp(i)&&Fp(s)&&T}}const ec={panStep:100,bearingStep:15,pitchStep:10};class el{constructor(){const i=ec;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let s=0,m=0,x=0,b=0,T=0;switch(i.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:i.shiftKey?m=-1:(i.preventDefault(),b=-1);break;case 39:i.shiftKey?m=1:(i.preventDefault(),b=1);break;case 38:i.shiftKey?x=1:(i.preventDefault(),T=-1);break;case 40:i.shiftKey?x=-1:(i.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(m=0,x=0),{cameraAnimation:P=>{const N=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:es,zoom:s?Math.round(N)+s*(i.shiftKey?2:1):N,bearing:P.getBearing()+m*this._bearingStep,pitch:P.getPitch()+x*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:P.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function es(f){return f*(2-f)}const Uo=4.000244140625,tl=1/450;class ps{constructor(i,s){this._map=i,this._el=i.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=tl,r.aP(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||r.dz()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const m=r.q.now(),x=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,s!==0&&s%Uo==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=s,this._timeout=window.setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(x*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),i.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=i,this._delta-=s,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=Ve(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const V=this._type==="wheel"&&Math.abs(this._delta)>Uo?this._wheelZoomRate:this._defaultZoomRate;let q=2/(1+Math.exp(-Math.abs(this._delta*V)));this._delta<0&&q!==0&&(q=1/q);const Z=s(),K=Math.pow(2,Z),ne=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):K;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(ne*q))),this._type==="wheel"&&(this._startZoom=Z,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:s(),x=this._startZoom,b=this._easing;let T,P=!1;if(this._type==="wheel"&&x&&b){const V=Math.min((r.q.now()-this._lastWheelEventTime)/200,1),q=b(V);T=r.af(x,m,q),V<1?this._frameId||(this._frameId=!0):P=!0}else T=m,P=!0;this._active=!0,P&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let N=T-s();return N*this._lastDelta<0&&(N=0),{noInertia:!0,needsRenderFrame:!P,zoomDelta:N,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let s=r.dA;if(this._prevEase){const m=this._prevEase,x=(r.q.now()-m.start)/m.duration,b=m.easing(x+.01)-m.easing(x),T=.27/Math.sqrt(b*b+1e-4)*.01,P=Math.sqrt(.0729-T*T);s=r.dy(T,P,.25,1)}return this._prevEase={start:r.q.now(),duration:i,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Q("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Fs{constructor(i,s){this._clickZoom=i,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class wl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,s){return i.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(i.shiftKey?-1:1),around:m.unproject(s)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ts{constructor(){this._tap=new Op({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,s,m){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=s[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(i,s,m))}touchmove(i,s,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const x=s[0],b=x.y-this._swipePoint.y;return this._swipePoint=x,i.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(i,s,m)}touchend(i,s,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(i,s,m)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Co{constructor(i,s,m){this._el=i,this._mousePan=s,this._touchPan=m}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Np{constructor(i,s,m){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=s,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class j_{constructor(i,s,m,x){this._el=i,this._touchZoom=s,this._touchRotate=m,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const nl=f=>f.zoom||f.drag||f.pitch||f.rotate;class Bp extends r.z{}class fo{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,s){const m=r.ab.vec3.sub([],s,i);this.radius=r.ab.vec3.length(m[2]<0?r.ab.vec3.div([],m,this.constants):[m[0],m[1],0])}projectRay(i){r.ab.vec3.div(i,i,this.constants),r.ab.vec3.normalize(i,i),r.ab.vec3.mul(i,i,this.constants);const s=r.ab.vec3.scale([],i,this.radius);if(s[2]>0){const m=r.ab.vec3.scale([],[0,0,1],r.ab.vec3.dot(s,[0,0,1])),x=r.ab.vec3.scale([],r.ab.vec3.normalize([],[s[0],s[1],0]),this.radius),b=r.ab.vec3.add([],s,r.ab.vec3.scale([],r.ab.vec3.sub([],r.ab.vec3.add([],x,m),s),2));s[0]=b[0],s[1]=b[1]}return s}}function ms(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class tc{constructor(i,s){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new eo(i),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new fo,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),r.aP(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,b,T]of this._listeners){const P=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(b,P,T)}}destroy(){for(const[i,s,m]of this._listeners){const x=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(s,x,m)}}_addDefaultHandlers(i){const s=this._map,m=s.getCanvasContainer();this._add("mapEvent",new U_(s,i));const x=s.boxZoom=new Jr(s,i);this._add("boxZoom",x);const b=new Nu,T=new wl;s.doubleClickZoom=new Fs(T,b),this._add("tapZoom",b),this._add("clickZoom",T);const P=new ts;this._add("tapDragZoom",P);const N=s.touchPitch=new fg(s);this._add("touchPitch",N);const V=new ks(i),q=new Uu(i);s.dragRotate=new Np(i,V,q),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]);const Z=new ff(i),K=new aa(s,i);s.dragPan=new Co(m,Z,K),this._add("mousePan",Z),this._add("touchPan",K,["touchZoom","touchRotate"]);const ne=new pf,fe=new bl;s.touchZoomRotate=new j_(m,fe,ne,P),this._add("touchRotate",ne,["touchPan","touchZoom"]),this._add("touchZoom",fe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new hf(s));const ue=s.scrollZoom=new ps(s,this);this._add("scrollZoom",ue,["mousePan"]);const ve=s.keyboard=new el;this._add("keyboard",ve);for(const ge of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[ge]&&s[ge].enable(i[ge])}_add(i,s,m){this._handlers.push({handlerName:i,handler:s,allowed:m}),this._handlersById[i]=s}stop(i){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!nl(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,s,m){for(const x in i)if(x!==m&&(!s||s.indexOf(x)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const s=[];for(const m of i)this._el.contains(m.target)&&s.push(m);return s}handleEvent(i,s){this._updatingCamera=!0;const m=i.type==="renderFrame",x=m?void 0:i,b={needsRenderFrame:!1},T={},P={},N=i.touches?this._getMapTouches(i.touches):void 0,V=N?Se(this._el,N):m?void 0:Ve(this._el,i);for(const{handlerName:K,handler:ne,allowed:fe}of this._handlers){if(!ne.isEnabled())continue;let ue;this._blockedByActive(P,fe,K)?ne.reset():ne[s||i.type]&&(ue=ne[s||i.type](i,V,N),this.mergeHandlerResult(b,T,ue,K,x),ue&&ue.needsRenderFrame&&this._triggerRenderFrame()),(ue||ne.isActive())&&(P[K]=ne)}const q={};for(const K in this._previousActiveHandlers)P[K]||(q[K]=x);this._previousActiveHandlers=P,(Object.keys(q).length||ms(b))&&(this._changes.push([b,T,q]),this._triggerRenderFrame()),(Object.keys(P).length||ms(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Z}=b;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))}mergeHandlerResult(i,s,m,x,b){if(!m)return;r.l(i,m);const T={handlerName:x,originalEvent:m.originalEvent||b};m.zoomDelta!==void 0&&(s.zoom=T),m.panDelta!==void 0&&(s.drag=T),m.pitchDelta!==void 0&&(s.pitch=T),m.bearingDelta!==void 0&&(s.rotate=T)}_applyChanges(){const i={},s={},m={};for(const[x,b,T]of this._changes)x.panDelta&&(i.panDelta=(i.panDelta||new r.P(0,0))._add(x.panDelta)),x.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(i.around=x.around),x.aroundCoord!==void 0&&(i.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(i.pinchAround=x.pinchAround),x.noInertia&&(i.noInertia=x.noInertia),r.l(s,b),r.l(m,T);this._updateMapTransform(i,s,m),this._changes=[]}_updateMapTransform(i,s,m){const x=this._map,b=x.transform,T=Ce=>[Ce.x,Ce.y,Ce.z];if((Ce=>{const ze=this._eventsInProgress.drag;return ze&&!this._handlersById[ze.handlerName].isActive()})()&&!ms(i)){const Ce=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),Ce!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&x._stop(!0),!ms(i))return void this._fireEvents(s,m,!0);let{panDelta:P,zoomDelta:N,bearingDelta:V,pitchDelta:q,around:Z,aroundCoord:K,pinchAround:ne}=i;b._isCameraConstrained&&(N>0&&(N=0),b._isCameraConstrained=!1),ne!==void 0&&(Z=ne),(N||(Ce=>s[Ce]&&!this._eventsInProgress[Ce])("drag"))&&Z&&(this._dragOrigin=T(b.pointCoordinate3D(Z)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",x._stop(!0),Z=Z||x.transform.centerPoint,V&&(b.bearing+=V),q&&(b.pitch+=q),b._updateCameraState();const fe=[0,0,0];if(P)if(b.projection.name==="mercator"){const Ce=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(Z).dir),ze=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(Z.sub(P)).dir);fe[0]=ze[0]-Ce[0],fe[1]=ze[1]-Ce[1]}else{const Ce=b.pointCoordinate(Z);if(b.projection.name==="globe"){P=P.rotate(-b.angle);const ze=b._pixelsPerMercatorPixel/b.worldSize;fe[0]=-P.x*r.dB(r.aS(Ce.y))*ze,fe[1]=-P.y*r.dB(b.center.lat)*ze}else{const ze=b.pointCoordinate(Z.sub(P));Ce&&ze&&(fe[0]=ze.x-Ce.x,fe[1]=ze.y-Ce.y)}}const ue=b.zoom,ve=[0,0,0];if(N){const Ce=T(K||b.pointCoordinate3D(Z)),ze={dir:r.ab.vec3.normalize([],r.ab.vec3.sub([],Ce,b._camera.position))};if(ze.dir[2]<0){const Le=b.zoomDeltaToMovement(Ce,N);r.ab.vec3.scale(ve,ze.dir,Le)}}const ge=r.ab.vec3.add(fe,fe,ve);b._translateCameraConstrained(ge),N&&Math.abs(b.zoom-ue)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(s,m,!0)}_fireEvents(i,s,m){const x=nl(this._eventsInProgress),b=nl(i),T={};for(const q in i){const{originalEvent:Z}=i[q];this._eventsInProgress[q]||(T[`${q}start`]=Z),this._eventsInProgress[q]=i[q]}!x&&b&&this._fireEvent("movestart",b.originalEvent);for(const q in T)this._fireEvent(q,T[q]);b&&this._fireEvent("move",b.originalEvent);for(const q in i){const{originalEvent:Z}=i[q];this._fireEvent(q,Z)}const P={};let N;for(const q in this._eventsInProgress){const{handlerName:Z,originalEvent:K}=this._eventsInProgress[q];this._handlersById[Z].isActive()||(delete this._eventsInProgress[q],N=s[Z]||K,P[`${q}end`]=N)}for(const q in P)this._fireEvent(q,P[q]);const V=nl(this._eventsInProgress);if(m&&(x||b)&&!V){this._updatingCamera=!0;const q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=K=>K!==0&&-this._bearingSnap<K&&K<this._bearingSnap;q?(Z(q.bearing||this._map.getBearing())&&(q.bearing=0),this._map.easeTo(q,{originalEvent:N})):(this._map.fire(new r.z("moveend",{originalEvent:N})),Z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,s){this._map.fire(new r.z(i,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new Bp("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Zh="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Jc extends r.E{constructor(i,s){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,r.aP(["_renderFrameCallback"],this)}getCenter(){return new r.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(i,s){return this.jumpTo({center:i},s)}panBy(i,s,m){return i=r.P.convert(i).mult(-1),this.panTo(this.transform.center,r.l({offset:i},s),m)}panTo(i,s,m){return this.easeTo(r.l({center:i},s),m)}getZoom(){return this.transform.zoom}setZoom(i,s){return this.jumpTo({zoom:i},s),this}zoomTo(i,s,m){return this.easeTo(r.l({zoom:i},s),m)}zoomIn(i,s){return this.zoomTo(this.getZoom()+1,i,s),this}zoomOut(i,s){return this.zoomTo(this.getZoom()-1,i,s),this}getBearing(){return this.transform.bearing}setBearing(i,s){return this.jumpTo({bearing:i},s),this}getPadding(){return this.transform.padding}setPadding(i,s){return this.jumpTo({padding:i},s),this}rotateTo(i,s,m){return this.easeTo(r.l({bearing:i},s),m)}resetNorth(i,s){return this.rotateTo(0,r.l({duration:1e3},i),s),this}resetNorthPitch(i,s){return this.easeTo(r.l({bearing:0,pitch:0,duration:1e3},i),s),this}snapToNorth(i,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,s):this}getPitch(){return this.transform.pitch}setPitch(i,s){return this.jumpTo({pitch:i},s),this}cameraForBounds(i,s){i=r.az.convert(i);const m=s&&s.bearing||0,x=s&&s.pitch||0,b=i.getNorthWest(),T=i.getSouthEast();return this._cameraForBounds(this.transform,b,T,m,x,s)}_extendPadding(i){const s={top:0,right:0,bottom:0,left:0};return i==null?r.l({},s,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:r.l({},s,i)}_extendCameraOptions(i){return(i=r.l({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,s){const m=s.max[0]-s.min[0],x=s.max[1]-s.min[1];return m/x>i.aspect?m/(2*Math.tan(.5*i.fovX)*i.aspect):x/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,s,m,x,b,T){const P=i.clone(),N=this._extendCameraOptions(T);P.bearing=x,P.pitch=b;const V=r.bO.convert(s),q=r.bO.convert(m),Z=.5*(V.lat+q.lat),K=.5*(V.lng+q.lng),ne=r.dC(Z,K),fe=r.ab.vec3.normalize([],ne),ue=r.ab.vec3.normalize([],r.ab.vec3.cross([],fe,[0,1,0])),ve=r.ab.vec3.cross([],ue,fe),ge=[ue[0],ue[1],ue[2],0,ve[0],ve[1],ve[2],0,fe[0],fe[1],fe[2],0,0,0,0,1],Ce=[ne,r.dC(V.lat,V.lng),r.dC(q.lat,V.lng),r.dC(q.lat,q.lng),r.dC(V.lat,q.lng),r.dC(Z,V.lng),r.dC(Z,q.lng),r.dC(V.lat,K),r.dC(q.lat,K)];let ze=r.cd.fromPoints(Ce.map(Pt=>[r.ab.vec3.dot(ue,Pt),r.ab.vec3.dot(ve,Pt),r.ab.vec3.dot(fe,Pt)]));const Le=r.ab.vec3.transformMat4([],ze.center,ge);r.ab.vec3.squaredLength(Le)===0&&r.ab.vec3.set(Le,0,0,1),r.ab.vec3.normalize(Le,Le),r.ab.vec3.scale(Le,Le,r.ax),P.center=r.dD(Le);const qe=P.getWorldToCameraMatrix(),Ne=r.ab.mat4.invert(new Float64Array(16),qe);ze=r.cd.applyTransform(ze,r.ab.mat4.multiply([],qe,ge));const Ge=this._extendAABB(ze,P,N,x);if(!Ge)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ze=Ge,r.ab.vec3.transformMat4(Le,Le,qe);const Be=.5*(ze.max[2]-ze.min[2]),Ke=this._minimumAABBFrustumDistance(P,ze),it=r.ab.vec3.scale([],[0,0,1],Be),Rt=r.ab.vec3.add(it,Le,it),xt=Ke+(P.pitch===0?0:r.ab.vec3.distance(Le,Rt)),jt=P.globeCenterInViewSpace,zt=r.ab.vec3.sub([],Le,[jt[0],jt[1],jt[2]]);r.ab.vec3.normalize(zt,zt),r.ab.vec3.scale(zt,zt,xt);const pt=r.ab.vec3.add([],Le,zt);r.ab.vec3.transformMat4(pt,pt,Ne);const Dt=r.ds/r.ax,tn=r.ab.vec3.length(pt),dt=r.bH(Math.max(tn*Dt-r.ds,Number.EPSILON),0),Ut=Math.min(P.zoomFromMercatorZAdjusted(dt),N.maxZoom);return Ut>.5*(r.c6+r.bY)?(P.setProjection({name:"mercator"}),P.zoom=Ut,this._cameraForBounds(P,s,m,x,b,T)):{center:P.center,zoom:Ut,bearing:x,pitch:b}}_extendAABB(i,s,m,x){const b=.5*((m.padding.left||0)+(m.padding.right||0)),T=.5*((m.padding.top||0)+(m.padding.bottom||0)),P=T,N=b,V=b,q=T,Z=s.width-(N+V),K=s.height-(P+q),ne=r.ab.vec3.sub([],i.max,i.min),fe=Math.min(Z/ne[0],K/ne[1]),ue=Math.min(s.scaleZoom(s.scale*fe),m.maxZoom);if(isNaN(ue))return null;const ve=s.scale/s.zoomScale(ue),ge=new r.cd([i.min[0]-N*ve,i.min[1]-q*ve,i.min[2]],[i.max[0]+V*ve,i.max[1]+P*ve,i.max[2]]),Ce=(typeof m.offset.x=="number"&&typeof m.offset.y=="number"?new r.P(m.offset.x,m.offset.y):r.P.convert(m.offset)).rotate(-r.ai(x));return ge.center[0]-=Ce.x*ve,ge.center[1]+=Ce.y*ve,ge}queryTerrainElevation(i,s){const m=this.transform.elevation;return m?(s=r.l({},{exaggerated:!0},s),m.getAtPoint(r.aa.fromLngLat(i),null,s.exaggerated)):null}_cameraForBounds(i,s,m,x,b,T){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,s,m,x,b,T);const P=i.clone(),N=this._extendCameraOptions(T);P.bearing=x,P.pitch=b;const V=r.bO.convert(s),q=r.bO.convert(m),Z=new r.bO(V.lng,q.lat),K=new r.bO(q.lng,V.lat),ne=P.project(V),fe=P.project(q),ue=this.queryTerrainElevation(V),ve=this.queryTerrainElevation(q),ge=this.queryTerrainElevation(Z),Ce=this.queryTerrainElevation(K),ze=[[ne.x,ne.y,Math.min(ue||0,ve||0,ge||0,Ce||0)],[fe.x,fe.y,Math.max(ue||0,ve||0,ge||0,Ce||0)]];let Le=r.cd.fromPoints(ze);const qe=P.getWorldToCameraMatrix(),Ne=r.ab.mat4.invert(new Float64Array(16),qe);Le=r.cd.applyTransform(Le,qe);const Ge=this._extendAABB(Le,P,N,x);if(!Ge)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Le=Ge;const Be=.5*r.ab.vec3.sub([],Le.max,Le.min)[2],Ke=this._minimumAABBFrustumDistance(P,Le),it=[0,0,1,0];r.ab.vec4.transformMat4(it,it,qe),r.ab.vec4.normalize(it,it);const Rt=r.ab.vec3.scale([],it,Ke+Be),xt=r.ab.vec3.add([],Le.center,Rt);r.ab.vec3.transformMat4(Le.center,Le.center,Ne),r.ab.vec3.transformMat4(xt,xt,Ne);const jt=P.unproject(new r.P(Le.center[0],Le.center[1])),zt=r.dE(P.projection,jt),pt=Math.pow(2,zt),Dt=Math.min(P._zoomFromMercatorZ(xt[2]*P.pixelsPerMeter*pt/P.worldSize),N.maxZoom);return P.mercatorFromTransition&&Dt<.5*(r.c6+r.bY)?(P.setProjection({name:"globe"}),P.zoom=Dt,this._cameraForBounds(P,s,m,x,b,T)):{center:jt,zoom:Dt,bearing:x,pitch:b}}fitBounds(i,s,m){const x=this.cameraForBounds(i,s);return this._fitInternal(x,s,m)}fitScreenCoordinates(i,s,m,x,b){const T=r.P.convert(i),P=r.P.convert(s),N=new r.P(Math.min(T.x,P.x),Math.min(T.y,P.y)),V=new r.P(Math.max(T.x,P.x),Math.max(T.y,P.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,P))return this;const q=this.transform.pointLocation3D(N),Z=this.transform.pointLocation3D(V),K=this.transform.pointLocation3D(new r.P(N.x,V.y)),ne=this.transform.pointLocation3D(new r.P(V.x,N.y)),fe=[Math.min(q.lng,Z.lng,K.lng,ne.lng),Math.min(q.lat,Z.lat,K.lat,ne.lat)],ue=[Math.max(q.lng,Z.lng,K.lng,ne.lng),Math.max(q.lat,Z.lat,K.lat,ne.lat)],ve=x&&x.pitch?x.pitch:this.getPitch(),ge=this._cameraForBounds(this.transform,fe,ue,m,ve,x);return this._fitInternal(ge,x,b)}_fitInternal(i,s,m){return i?(s=r.l(i,s)).linear?this.easeTo(s,m):this.flyTo(s,m):this}jumpTo(i,s){this.stop();const m=i.preloadOnly?this.transform.clone():this.transform;let x=!1,b=!1,T=!1;"zoom"in i&&m.zoom!==+i.zoom&&(x=!0,m.zoom=+i.zoom),i.center!==void 0&&(m.center=r.bO.convert(i.center)),"bearing"in i&&m.bearing!==+i.bearing&&(b=!0,m.bearing=+i.bearing),"pitch"in i&&m.pitch!==+i.pitch&&(T=!0,m.pitch=+i.pitch);const P=typeof i.padding=="number"?this._extendPadding(i.padding):i.padding;if(i.padding!=null&&!m.isPaddingEqual(P))if(i.retainPadding===!1){const N=m.clone();N.padding=P,m.setLocationAtPoint(m.center,N.centerPoint)}else m.padding=P;return i.preloadOnly?(this._preloadTiles(m),this):(this.fire(new r.z("movestart",s)).fire(new r.z("move",s)),x&&this.fire(new r.z("zoomstart",s)).fire(new r.z("zoom",s)).fire(new r.z("zoomend",s)),b&&this.fire(new r.z("rotatestart",s)).fire(new r.z("rotate",s)).fire(new r.z("rotateend",s)),T&&this.fire(new r.z("pitchstart",s)).fire(new r.z("pitch",s)).fire(new r.z("pitchend",s)),this.fire(new r.z("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(Zh),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,s){const m=this.transform;if(!m.projection.supportsFreeCamera)return r.w(Zh),this;this.stop();const x=m.zoom,b=m.pitch,T=m.bearing;m.setFreeCameraOptions(i);const P=x!==m.zoom,N=b!==m.pitch,V=T!==m.bearing;return this.fire(new r.z("movestart",s)).fire(new r.z("move",s)),P&&this.fire(new r.z("zoomstart",s)).fire(new r.z("zoom",s)).fire(new r.z("zoomend",s)),V&&this.fire(new r.z("rotatestart",s)).fire(new r.z("rotate",s)).fire(new r.z("rotateend",s)),N&&this.fire(new r.z("pitchstart",s)).fire(new r.z("pitch",s)).fire(new r.z("pitchend",s)),this.fire(new r.z("moveend",s)),this}easeTo(i,s){this._stop(!1,i.easeId),((i=r.l({offset:[0,0],duration:500,easing:r.dA},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const m=this.transform,x=this.getZoom(),b=this.getBearing(),T=this.getPitch(),P=this.getPadding(),N="zoom"in i?+i.zoom:x,V="bearing"in i?this._normalizeBearing(i.bearing,b):b,q="pitch"in i?+i.pitch:T,Z=this._extendPadding(i.padding),K=r.P.convert(i.offset);let ne,fe,ue;if(m.projection.name==="globe"){const it=r.aa.fromLngLat(m.center),Rt=K.rotate(-m.angle);it.x+=Rt.x/m.worldSize,it.y+=Rt.y/m.worldSize;const xt=it.toLngLat(),jt=r.bO.convert(i.center||xt);this._normalizeCenter(jt),ne=m.centerPoint.add(Rt),fe=new r.P(it.x,it.y).mult(m.worldSize),ue=new r.P(r.at(jt.lng),r.aA(jt.lat)).mult(m.worldSize).sub(fe)}else{ne=m.centerPoint.add(K);const it=m.pointLocation(ne),Rt=r.bO.convert(i.center||it);this._normalizeCenter(Rt),fe=m.project(it),ue=m.project(Rt).sub(fe)}const ve=m.zoomScale(N-x);let ge,Ce;i.around&&(ge=r.bO.convert(i.around),Ce=m.locationPoint(ge));const ze=this._zooming||N!==x,Le=this._rotating||b!==V,qe=this._pitching||q!==T,Ne=!m.isPaddingEqual(Z),Ge=i.retainPadding===!1?m.clone():m,Be=it=>Rt=>{if(ze&&(it.zoom=r.af(x,N,Rt)),Le&&(it.bearing=r.af(b,V,Rt)),qe&&(it.pitch=r.af(T,q,Rt)),Ne&&(Ge.interpolatePadding(P,Z,Rt),ne=Ge.centerPoint.add(K)),ge)it.setLocationAtPoint(ge,Ce);else{const xt=it.zoomScale(it.zoom-x),jt=N>x?Math.min(2,ve):Math.max(.5,ve),zt=Math.pow(jt,1-Rt),pt=it.unproject(fe.add(ue.mult(Rt*zt)).mult(xt));it.setLocationAtPoint(it.renderWorldCopies?pt.wrap():pt,ne)}return i.preloadOnly||this._fireMoveEvents(s),it};if(i.preloadOnly){const it=this._emulate(Be,i.duration,m);return this._preloadTiles(it),this}const Ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ze,this._rotating=Le,this._pitching=qe,this._padding=Ne,this._easeId=i.easeId,this._prepareEase(s,i.noMoveStart,Ke),this._ease(Be(m),it=>{m.cameraElevationReference==="sea"&&m.recenterOnTerrain(),this._afterEase(s,it)},i),this}_prepareEase(i,s,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||m.moving||this.fire(new r.z("movestart",i)),this._zooming&&!m.zooming&&this.fire(new r.z("zoomstart",i)),this._rotating&&!m.rotating&&this.fire(new r.z("rotatestart",i)),this._pitching&&!m.pitching&&this.fire(new r.z("pitchstart",i))}_fireMoveEvents(i){this.fire(new r.z("move",i)),this._zooming&&this.fire(new r.z("zoom",i)),this._rotating&&this.fire(new r.z("rotate",i)),this._pitching&&this.fire(new r.z("pitch",i))}_afterEase(i,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,x=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new r.z("zoomend",i)),x&&this.fire(new r.z("rotateend",i)),b&&this.fire(new r.z("pitchend",i)),this.fire(new r.z("moveend",i))}flyTo(i,s){if(this._prefersReducedMotion(i)){const Pt=r.ay(i,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Pt,s)}this.stop(),i=r.l({offset:[0,0],speed:1.2,curve:1.42,easing:r.dA},i);const m=this.transform,x=this.getZoom(),b=this.getBearing(),T=this.getPitch(),P=this.getPadding(),N="zoom"in i?r.aw(+i.zoom,m.minZoom,m.maxZoom):x,V="bearing"in i?this._normalizeBearing(i.bearing,b):b,q="pitch"in i?+i.pitch:T,Z=this._extendPadding(i.padding),K=m.zoomScale(N-x),ne=r.P.convert(i.offset);let fe=m.centerPoint.add(ne);const ue=m.pointLocation(fe),ve=r.bO.convert(i.center||ue);this._normalizeCenter(ve);const ge=m.project(ue),Ce=m.project(ve).sub(ge);let ze=i.curve;const Le=Math.max(m.width,m.height),qe=Le/K,Ne=Ce.mag();if("minZoom"in i){const Pt=r.aw(Math.min(i.minZoom,x,N),m.minZoom,m.maxZoom),dn=Le/m.zoomScale(Pt-x);ze=Math.sqrt(dn/Ne*2)}const Ge=ze*ze;function Be(Pt){const dn=(qe*qe-Le*Le+(Pt?-1:1)*Ge*Ge*Ne*Ne)/(2*(Pt?qe:Le)*Ge*Ne);return Math.log(Math.sqrt(dn*dn+1)-dn)}function Ke(Pt){return(Math.exp(Pt)-Math.exp(-Pt))/2}function it(Pt){return(Math.exp(Pt)+Math.exp(-Pt))/2}const Rt=Be(0);let xt=function(Pt){return it(Rt)/it(Rt+ze*Pt)},jt=function(Pt){return Le*((it(Rt)*(Ke(dn=Rt+ze*Pt)/it(dn))-Ke(Rt))/Ge)/Ne;var dn},zt=(Be(1)-Rt)/ze;if(Math.abs(Ne)<1e-6||!isFinite(zt)){if(Math.abs(Le-qe)<1e-6)return this.easeTo(i,s);const Pt=qe<Le?-1:1;zt=Math.abs(Math.log(qe/Le))/ze,jt=function(){return 0},xt=function(dn){return Math.exp(Pt*ze*dn)}}i.duration="duration"in i?+i.duration:1e3*zt/("screenSpeed"in i?+i.screenSpeed/ze:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const pt=b!==V,Dt=q!==T,tn=!m.isPaddingEqual(Z),dt=i.retainPadding===!1?m.clone():m,Ut=Pt=>dn=>{const Zt=dn*zt,Gt=1/xt(Zt);Pt.zoom=dn===1?N:x+Pt.scaleZoom(Gt),pt&&(Pt.bearing=r.af(b,V,dn)),Dt&&(Pt.pitch=r.af(T,q,dn)),tn&&(dt.interpolatePadding(P,Z,dn),fe=dt.centerPoint.add(ne));const rn=dn===1?ve:Pt.unproject(ge.add(Ce.mult(jt(Zt))).mult(Gt));return Pt.setLocationAtPoint(Pt.renderWorldCopies?rn.wrap():rn,fe),Pt._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(s),Pt};if(i.preloadOnly){const Pt=this._emulate(Ut,i.duration,m);return this._preloadTiles(Pt),this}return this._zooming=!0,this._rotating=pt,this._pitching=Dt,this._padding=tn,this._prepareEase(s,!1),this._ease(Ut(m),()=>this._afterEase(s),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,s)}if(!i){const m=this.handlers;m&&m.stop(!1)}return this}_ease(i,s,m){m.animate===!1||m.duration===0?(i(1),s()):(this._easeStart=r.q.now(),this._easeOptions=m,this._onEaseFrame=i,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((r.q.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,s){i=r.bF(i,-180,180);const m=Math.abs(i-s);return Math.abs(i-360-s)<m&&(i-=360),Math.abs(i+360-s)<m&&(i+=360),i}_normalizeCenter(i){const s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;const m=i.lng-s.center.lng;i.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&r.q.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,s,m){const x=Math.ceil(15*s/1e3),b=[],T=i(m.clone());for(let P=0;P<=x;P++){const N=T(P/x);b.push(N.clone())}return b}_preloadTiles(i,s){}}class Yh{constructor(i={}){this.options=i,r.aP(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const s=this.options&&this.options.compact,m=i._getUIString("AttributionControl.ToggleAttribution");this._map=i,this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Q("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",m);const x=Q("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",m),this._innerContainer=Q("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(i){const m=s.reduce((x,b,T)=>(b.value&&(x+=`${b.key}=${b.value}${T<s.length-1?"&":""}`),x),"?");i.href=`${r.e.FEEDBACK_URL}/${m}#${Lp(this._map,!0)}`,i.rel="noopener nofollow"}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const s=this._map.style._mergedSourceCaches;for(const x in s){const b=s[x];if(b.used){const T=b.getSource();T.attribution&&i.indexOf(T.attribution)<0&&i.push(T.attribution)}}i.sort((x,b)=>x.length-b.length),i=i.filter((x,b)=>{for(let T=b+1;T<i.length;T++)if(i[T].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const m=i.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,i.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class bo{constructor(){r.aP(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=Q("div","mapboxgl-ctrl");const s=Q("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const s in i){const m=i[s].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const s=i[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class wo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const s=++this._id;return this._queue.push({callback:i,id:s,cancelled:!1}),s}remove(i){const s=this._currentlyRunning,m=s?this._queue.concat(s):this._queue;for(const x of m)if(x.id===i)return void(x.cancelled=!0)}run(i=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const m of s)if(!m.cancelled&&(m.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Vu{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const s=r.cB((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,s,m){this._start=this.getValue(s),this._end=i,this._startTime=s,this._endTime=s+m}}const Qc={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class il extends r.z{constructor(i,s,m,x){const{point:b,lngLat:T,originalEvent:P,target:N}=i;super(i.type,{point:b,lngLat:T,originalEvent:P,target:N}),this.preventDefault=()=>{i.preventDefault()},this.id=s,this.interaction=m,this.feature=x}}class Sl{constructor(i){this.map=i,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(i,s){if(this.typeById.has(i))throw new Error(`Interaction id "${i}" already exists.`);const m=s.filter;let x=s.type;m&&this.filters.set(i,r.aZ(m)),x==="mouseover"&&(x="mouseenter"),x==="mouseout"&&(x="mouseleave");const b=this.interactionsByType.get(x)||new Map;x==="mouseenter"||x==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(i,s)):b.size===0&&this.map.on(x,this.handleType),b.size===0&&this.interactionsByType.set(x,b),b.set(i,s),this.typeById.set(i,x)}get(i){const s=this.typeById.get(i);if(!s)return;const m=this.interactionsByType.get(s);return m?m.get(i):void 0}remove(i){const s=this.typeById.get(i);if(!s)return;this.typeById.delete(i),this.filters.delete(i);const m=this.interactionsByType.get(s);m&&(m.delete(i),s==="mouseenter"||s==="mouseleave"?(this.delegatedInteractions.delete(i),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):m.size===0&&this.map.off(s,this.handleType))}queryTargets(i,s){const m=[];for(const[x,b]of s)b.target&&m.push({targetId:x,target:b.target,filter:this.filters.get(x)});return this.map.style.queryRenderedTargets(i,m,this.map.transform)}handleMove(i){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const s=this.queryTargets(i.point,Array.from(this.delegatedInteractions).reverse());s.length&&(i.type="mouseenter",this.handleType(i,s));const m=new Map;for(const[x,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(x)||m.set(b.id,b);m.size&&(i.type="mouseleave",this.handleType(i,Array.from(m.values())))}handleOut(i){const s=Array.from(this.hoveredFeatures.values()).map(({feature:m})=>m);s.length&&(i.type="mouseleave",this.handleType(i,s)),this.hoveredFeatures.clear()}handleType(i,s){const m=Array.from(this.interactionsByType.get(i.type)).reverse(),x=!!s;s=s||this.queryTargets(i.point,m);const b=i.type==="mouseenter";let T=!1;const P=new Set;for(const N of s){for(const[V,q]of m){if(!q.target)continue;const Z=N.variants?N.variants[V]:null;if(Z){for(const K of Z){if(ia(K,N,P,V))continue;const ne=new r.cw(N,K),fe=Li(K,N,V);x&&(ne.state=this.map.getFeatureState(ne));const ue=b?this.prevHoveredFeatures.get(fe):null,ve=new il(i,V,q,ne),ge=ue?ue.stop:q.handler(ve);if(b&&this.hoveredFeatures.set(fe,{feature:N,stop:ge}),ge!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[N,V]of m){const{handler:q,target:Z}=V;if(!Z&&q(new il(i,N,V,null))!==!1)break}}}function Ji(f,i){if(Array.isArray(f)&&Array.isArray(i)){const s=new Set(f),m=new Set(i);return s.size===m.size&&f.every(x=>m.has(x))}return r.bn(f,i)}const nc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},ju={showCompass:!0,showZoom:!0,visualizePitch:!1};class gs{constructor(i,s,m=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new ks({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,m&&(this.mousePitch=new Uu({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),r.aP(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(i,s){this.mouseRotate.mousedown(i,s),this.mousePitch&&this.mousePitch.mousedown(i,s),pe()}move(i,s){const m=this.map,x=this.mouseRotate.mousemoveWindow(i,s),b=x&&x.bearingDelta;if(b&&m.setBearing(m.getBearing()+b),this.mousePitch){const T=this.mousePitch.mousemoveWindow(i,s),P=T&&T.pitchDelta;P&&m.setPitch(m.getPitch()+P)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ae(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(r.l({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),Ve(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,Ve(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Se(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=Se(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function mf(f,i,s){if(f=new r.bO(f.lng,f.lat),i){const m=new r.bO(f.lng-360,f.lat),x=new r.bO(f.lng+360,f.lat),b=360*Math.ceil(Math.abs(f.lng-s.center.lng)/360),T=s.locationPoint(f).distSqr(i),P=i.x<0||i.y<0||i.x>s.width||i.y>s.height;s.locationPoint(m).distSqr(i)<T&&(P||Math.abs(m.lng-s.center.lng)<b)?f=m:s.locationPoint(x).distSqr(i)<T&&(P||Math.abs(x.lng-s.center.lng)<b)&&(f=x)}for(;Math.abs(f.lng-s.center.lng)>180;){const m=s.locationPoint(f);if(m.x>=0&&m.y>=0&&m.x<=s.width&&m.y<=s.height)break;f.lng>s.center.lng?f.lng-=360:f.lng+=360}return f}const rl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ns extends r.E{constructor(i,s){if(super(),(i instanceof HTMLElement||s)&&(i=r.l({element:i},s)),r.aP(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=r.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=Q("div");const b=41,T=27,P=J("svg",{display:"block",height:b*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${b}`},this._element),N=J("radialGradient",{id:"shadowGradient"},J("defs",{},P));J("stop",{offset:"10%","stop-opacity":.4},N),J("stop",{offset:"100%","stop-opacity":.05},N),J("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},P),J("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},P),J("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},P),J("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},P),this._offset=r.P.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const m=this._element.classList;for(const b in rl)m.remove(`mapboxgl-marker-anchor-${b}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`);const x=i&&i.className?i.className.trim().split(/\s+/):[];m.add(...x),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=r.bO.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const s=i.code,m=i.charCode||i.keyCode;s!=="Space"&&s!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(i){const s=i.originalEvent.target,m=this._element;this._popup&&(s===m||m.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,s=this._pos;if(!i||!s)return!1;const m=i.unproject(s),x=i.getFreeCameraOptions();if(!x.position)return!1;const b=x.position.toLngLat();return b.distanceTo(m)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const s=this._pos;if(!s||s.x<0||s.x>i.transform.width||s.y<0||s.y>i.transform.height)return void this._clearFadeTimer();const m=i.unproject(s);let x;i._showingGlobe()&&r.dH(i.transform,this._lngLat)?x=0:(x=1-i._queryFogOpacity(m),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${rl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const i=this._pos,s=this._map,m=this.getPitchAlignment();if(!s||!i||m!=="map")return"";if(!s._showingGlobe()){const N=s.getPitch();return N?`rotateX(${N}deg)`:""}const x=r.c4(r.dI(s.transform,this._lngLat)),b=i.sub(r.dJ(s.transform)),T=Math.abs(b.x)+Math.abs(b.y);if(T===0)return"";const P=x/T;return`rotateX(${-b.y*P}deg) rotateY(${b.x*P}deg)`}_calculateZTransform(){const i=this._pos,s=this._map;if(!s||!i)return"";let m=0;const x=this.getRotationAlignment();if(x==="map")if(s._showingGlobe()){const b=s.project(new r.bO(this._lngLat.lng,this._lngLat.lat+.001)),T=s.project(new r.bO(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);m=r.c4(Math.atan2(T.y,T.x))-90}else m=-s.getBearing();else if(x==="horizon"){const b=r.ac(4,6,s.getZoom()),T=r.dJ(s.transform);T.y+=b*s.transform.height;const P=i.sub(T),N=r.c4(Math.atan2(P.y,P.x));m=(N>90?N-270:N+90)*(1-b)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=mf(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=r.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){const s=this._map;if(!s)return;const m=this._pointerdownPos,x=this._positionDelta;if(m&&x){if(!this._isDragging){const b=this._clickTolerance||s._clickTolerance;if(i.point.dist(m)<b)return;this._isDragging=!0}this._pos=i.point.sub(x),this._lngLat=s.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.z("dragstart"))),this.fire(new r.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.z("dragend")),this._state="inactive"}_addDragHandler(i){const s=this._map,m=this._pos;s&&m&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(m),this._pointerdownPos=i.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const s=this._map;return s&&(i?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const po={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ro={maxWidth:100,unit:"metric"},Ra={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},El={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Mr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function gf(f=new r.P(0,0),i="bottom"){if(typeof f=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(i){case"top":return new r.P(0,f);case"top-left":return new r.P(s,s);case"top-right":return new r.P(-s,s);case"bottom":return new r.P(0,-f);case"bottom-left":return new r.P(s,-s);case"bottom-right":return new r.P(-s,-s);case"left":return new r.P(f,0);case"right":return new r.P(-f,0)}return new r.P(0,0)}return f instanceof r.P||Array.isArray(f)?r.P.convert(f):r.P.convert(f[i]||[0,0])}return{version:I,supported:X.supported,setRTLTextPlugin:r.dK,getRTLTextPluginStatus:r.dL,Map:class extends Jc{constructor(f){B.mark(k.create);const i=f;if((f=r.l({},nc,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&r.dF(window)&&(f.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Gd(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new wo,this._domRenderTaskQueue=new wo,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.aV(),this._locale=r.l({},Qc,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Vu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new Tt(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const s=document.getElementById(f.container);if(!s)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=s}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,r.aP(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Gh),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new tc(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||r.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this.indoor=new Tc(this),f.hash&&(this._hash=new uf(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const s=f.bounds;s&&(this.resize(),this.fitBounds(s,r.l({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Yh({customAttribution:f.customAttribution})),this._logoControl=new bo,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new r.z(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new r.z(`${s.dataType}dataloading`,s))}),this._interactions=new Sl(this)}_getMapId(){return this._mapId}addControl(f,i){if(i===void 0&&(i=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new r.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=f.onAdd(this);this._controls.push(f);const m=this._controlPositions[i];return i.indexOf("bottom")!==-1?m.insertBefore(s,m.firstChild):m.appendChild(s),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new r.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(f);return i>-1&&this._controls.splice(i,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new r.z("movestart",f)).fire(new r.z("move",f)),this.fire(new r.z("resize",f)),i&&this.fire(new r.z("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(r.az.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(i=>i.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(i=>i==="auto"?navigator.language:i):f}setLanguage(f){const i=this._parseLanguage(f);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,i=f.projection.name;let s;i==="globe"&&f.zoom>=r.bY?(f.setMercatorFromTransition(),s=!0):i==="mercator"&&f.zoom<r.bY&&(f.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,i){return this._updateProjection(f||i||{name:"mercator"})}_updateProjection(f){let i;return i=f.name==="globe"&&this.transform.zoom>=r.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f){return this.transform.locationPoint3D(r.bO.convert(f))}unproject(f){return this.transform.pointLocation3D(r.P.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,i,s){const m=x=>{let b=[];if(Array.isArray(i)){const T=i.filter(P=>this.getLayer(P));b=T.length?this.queryRenderedFeatures(x,{layers:T}):[]}else b=this.queryRenderedFeatures(x,{target:i});return b};if(f==="mouseenter"||f==="mouseover"){let x=!1;return{listener:s,targets:i,delegates:{mousemove:T=>{const P=m(T.point);P.length?x||(x=!0,s.call(this,new Bo(f,this,T.originalEvent,{features:P}))):x=!1},mouseout:()=>{x=!1}}}}if(f==="mouseleave"||f==="mouseout"){let x=!1;return{listener:s,targets:i,delegates:{mousemove:P=>{m(P.point).length?x=!0:x&&(x=!1,s.call(this,new Bo(f,this,P.originalEvent)))},mouseout:P=>{x&&(x=!1,s.call(this,new Bo(f,this,P.originalEvent)))}}}}{const x=b=>{const T=m(b.point);T.length&&(b.features=T,s.call(this,b),delete b.features)};return{listener:s,targets:i,delegates:{[f]:x}}}}on(f,i,s){if(typeof i=="function"||s===void 0)return super.on(f,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const m=this._createDelegatedListener(f,i,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(m);for(const x in m.delegates)this.on(x,m.delegates[x]);return this}once(f,i,s){if(typeof i=="function"||s===void 0)return super.once(f,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const m=this._createDelegatedListener(f,i,s);for(const x in m.delegates)this.once(x,m.delegates[x]);return this}off(f,i,s){if(typeof i=="function"||s===void 0)return super.off(f,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const m=this._delegatedListeners?this._delegatedListeners[f]:void 0;return m&&(x=>{for(let b=0;b<x.length;b++){const T=x[b];if(T.listener===s&&Ji(T.targets,i)){for(const P in T.delegates)this.off(P,T.delegates[P]);return x.splice(b,1),this}}})(m),this}queryRenderedFeatures(f,i){if(!this.style)return[];if(f===void 0||f instanceof r.P||Array.isArray(f)||i!==void 0||(i=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!i){const b=this.style.queryRenderedFeatures(f,void 0,this.transform),T=this.style.queryRenderedFeatureset(f,void 0,this.transform);return b.concat(T)}let s=!0;if(i.target&&(s=this._isTargetValid(i.target),s&&!i.layers))return this.style.queryRenderedFeatureset(f,i,this.transform);let m=!0;if(i.layers&&Array.isArray(i.layers)){for(const b of i.layers)if(!this._isValidId(b)){m=!1;break}if(m&&!i.target)return this.style.queryRenderedFeatures(f,i,this.transform)}let x=[];return m&&(x=x.concat(this.style.queryRenderedFeatures(f,i,this.transform))),s&&(x=x.concat(this.style.queryRenderedFeatureset(f,i,this.transform))),x}querySourceFeatures(f,i){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,i)}isPointOnSurface(f){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&r.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(f))}addInteraction(f,i){return this._interactions.add(f,i),this}removeInteraction(f){return this._interactions.remove(f),this}setStyle(f,i){return i=r.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&f&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(f,(s,m)=>{s?(r.w(`Unable to perform style diff: ${String(s.message||s.error||s)}. Rebuilding the style from scratch.`),this._updateStyle(f,i)):m&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(f,i))}_getUIString(f){const i=this._locale[f];if(i==null)throw new Error(`Missing UI string '${f}'`);return i}_updateStyle(f,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const s=r.l({},i);i&&i.config&&(s.initialConfig=i.config,delete s.config),this.style=new lo(this,s).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new lo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new r.y(new Error("IDs can't be empty."))),!1):!r.cr(f)||(this.fire(new r.y(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const i of f)if(!this._isValidId(i))return!1;return!0}return this._isTargetValid(f)}addSource(f,i){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,i),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,i,s){this._lazyInitEmptyStyle(),this.style.addSourceType(f,i,s)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,i,{pixelRatio:s=1,sdf:m=!1,stretchX:x,stretchY:b,content:T}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:P,height:N,data:V}=r.q.getImageData(i);this.style.addImage(f,{data:new r.r({width:P,height:N},V),pixelRatio:s,stretchX:x,stretchY:b,content:T,sdf:m,version:0,usvg:!1})}else if(i.width===void 0||i.height===void 0)this.fire(new r.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:P,height:N}=i,V=i;this.style.addImage(f,{data:new r.r({width:P,height:N},new Uint8Array(V.data)),pixelRatio:s,stretchX:x,stretchY:b,content:T,sdf:m,usvg:!1,version:0,userImage:V}),V.onAdd&&V.onAdd(this,f)}}updateImage(f,i){this._lazyInitEmptyStyle();const s=this.style.getImage(f);if(!s)return void this.fire(new r.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?r.q.getImageData(i):i,{width:x,height:b,data:T}=m;if(x===void 0||b===void 0)return void this.fire(new r.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==(s.usvg?s.icon.usvg_tree.width:s.data.width)||b!==(s.usvg?s.icon.usvg_tree.height:s.data.height))return void this.fire(new r.y(new Error(`The width and height of the updated image (${x}, ${b})
                must be that same as the previous version of the image
                (${s.data.width}, ${s.data.height})`)));const P=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);let N=!1;s.usvg?(s.data=new r.r({width:x,height:b},new Uint8Array(T)),s.usvg=!1,s.icon=void 0,N=!0):s.data.replace(T,P),this.style.updateImage(f,s,N)}hasImage(f){return f?!!this.style&&!!this.style.getImage(f):(this.fire(new r.y(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,i){r.o(this._requestManager.transformRequest(f,r.R.Image),(s,m)=>{i(s,m instanceof HTMLImageElement?r.q.getImageData(m):m)})}listImages(){return this.style.listImages()}addModel(f,i){this._lazyInitEmptyStyle(),this.style.addModel(f,i)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new r.y(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,i){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,i),this._update(!0)):this}getSlot(f){const i=this.getLayer(f);return i&&i.slot||null}setSlot(f,i){return this.style.setSlot(f,i),this.style.mergeLayers(),this._update(!0)}addImport(f,i){return this.style.addImport(f,i),this}updateImport(f,i){return typeof i!="string"&&i.id!==f?(this.removeImport(f),this.addImport(i)):(this.style.updateImport(f,i),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,i){return this.style.moveImport(f,i),this._update(!0)}moveLayer(f,i){return this._isValidId(f)?(this.style.moveLayer(f,i),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const i=this.style.getOwnLayer(f);return i?i.type==="custom"?i.implementation:i.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,i,s){return this._isValidId(f)?(this.style.setLayerZoomRange(f,i,s),this._update(!0)):this}setFilter(f,i,s={}){return this._isValidId(f)?(this.style.setFilter(f,i,s),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,i,s,m={}){return this._isValidId(f)?(this.style.setPaintProperty(f,i,s,m),this._update(!0)):this}getPaintProperty(f,i){return this._isValidId(f)?this.style.getPaintProperty(f,i):null}setLayoutProperty(f,i,s,m={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,i,s,m),this._update(!0)):this}getLayoutProperty(f,i){return this._isValidId(f)?this.style.getLayoutProperty(f,i):null}getSchema(f){return this.style.getSchema(f)}setSchema(f,i){return this.style.setSchema(f,i),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,i){return this.style.setConfig(f,i),this._update(!0)}getConfigProperty(f,i){return this.style.getConfigProperty(f,i)}setConfigProperty(f,i,s){return this.style.setConfigProperty(f,i,s),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const i=f[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,i){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,i),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.bO.convert(f),this.transform):0}setFeatureState(f,i){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,i),this._update())}removeFeatureState(f,i){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,i),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let s,m,x,b=this._container;for(;b&&(!m||!x);){const T=window.getComputedStyle(b).transform;T&&T!=="none"&&(s=T.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(m=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(x=s[3])),b=b.parentElement}this._containerWidth=m?Math.abs(f/m):f,this._containerHeight=x?Math.abs(i/x):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Q("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=Q("div","mapboxgl-canvas-container",f);this._canvas=Q("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=Q("div","mapboxgl-control-container",f),m=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(x=>{m[x]=Q("div",`mapboxgl-ctrl-${x}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,i){const s=r.q.devicePixelRatio||1;this._canvas.width=s*Math.ceil(f),this._canvas.height=s*Math.ceil(i),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${i}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const i=this._markers.indexOf(f);i!==-1&&this._markers.splice(i,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const i=this._popups.indexOf(f);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const f=r.l({},X.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",f);i?(vn(i,!0),this.painter=new Pp(i,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.m.testSupport(i)):this.fire(new r.y(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.z("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new r.z("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let i;this.fire(new r.z("renderstart")),++this._frameId;const s=this.painter.context.extTimerQuery,m=r.q.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=x.createQuery(),x.beginQuery(s.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const V=this.transform.zoom,q=this.transform.pitch,Z=r.q.now(),K=new r.a8(V,{now:Z,fadeDuration:b,pitch:q,transition:this.style.transition});this.style.update(K)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(m),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(m);const P=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),P&&(this._placementDirty=P.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,B.mark(k.load),this.fire(new r.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const V=r.q.now()-m;x.endQuery(s.TIME_ELAPSED_EXT),setTimeout(()=>{const q=x.getQueryParameter(i,x.QUERY_RESULT)/1e6;x.deleteQuery(i),this.fire(new r.z("gpu-timing-frame",{cpuTime:V,gpuTime:q}))},50)}if(this.listens("gpu-timing-layer")){const V=this.painter.collectGpuTimers();setTimeout(()=>{const q=this.painter.queryGpuTimers(V);this.fire(new r.z("gpu-timing-layer",{layerTimes:q}))},50)}if(this.listens("gpu-timing-deferred-render")){const V=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const q=this.painter.queryGpuTimeDeferredRender(V);this.fire(new r.z("gpu-timing-deferred-render",{gpuTime:q}))},50)}const N=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(N||this._repaint)this.triggerRepaint();else{const V=this.idle();if(V&&(T=this._updateAverageElevation(m,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),V&&(this.fire(new r.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const q=this._calculateSpeedIndex();this.fire(new r.z("speedindexcompleted",{speedIndex:q})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||N||(this._fullyLoaded=!0,B.mark(k.fullLoad),this._performanceMetricsCollection&&pn(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const i of this._markers)f&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!f||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(f,i=!1){const s=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);const m=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(m||(i||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const x=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=f;const T=Math.abs(x-b);if(T>1){if(this._isInitialLoad||m)return this._averageElevation.jumpTo(b),s(b);this._averageElevation.easeTo(b,f,300)}else if(T>1e-4)return this._averageElevation.jumpTo(b),s(b)}return!!this._averageElevation.isEasing(f)&&s(this._averageElevation.getValue(f))}_authenticate(){Pe(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===Et||f.status===401)){const i=this.painter.context.gl;vn(i,!1),this._logoControl instanceof bo&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),It(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&fn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const s=this.painter.context.gl,m=s.createFramebuffer();function x(b){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,b,0);const T=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,T),T}return s.bindFramebuffer(s.FRAMEBUFFER,m),this._canvasPixelComparison(x(f),i.canvasCopies.map(x),i.timeStamps)}_canvasPixelComparison(f,i,s){let m=s[1]-s[0];const x=f.length/4;for(let b=0;b<i.length;b++){const T=i[b];let P=0;for(let N=0;N<T.length;N+=4)T[N]===f[N]&&T[N+1]===f[N+1]&&T[N+2]===f[N+2]&&T[N+3]===f[N+3]&&(P+=1);m+=(s[b+2]-s[b+1])*(1-P/x)}return m}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Gn.delete(this.painter.context.gl),jn.remove(),Xt.remove(),this._removed=!0,this.fire(new r.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=r.q.frame(i=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(i)}))}_preloadTiles(f){const i=this.style?this.style.getSourceCaches():[];return r.bl(i,(s,m)=>s._preloadTiles(f,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,i){r.dG(f,i)}get version(){return I}},NavigationControl:class{constructor(f={}){this.options=r.l({},ju,f),this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(r.aP(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),Q("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),Q("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aP(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:i}):s.resetNorth({},{originalEvent:i}))}),this._compassIcon=Q("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const i=f.getZoom(),s=i===f.getMaxZoom(),m=i===f.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new gs(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,i){const s=Q("button",f,this._container);return s.type="button",s.addEventListener("click",i),s}_setButtonTitle(f,i){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${i}`);f.setAttribute("aria-label",s),f.firstElementChild&&f.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends r.E{constructor(f={}){super();const i=navigator.geolocation;this.options=r.l({geolocation:i},po,f),r.aP(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=cf(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const i=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,f(s)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(s=>i(s.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(f){const i=this._map.getMaxBounds(),s=f.coords;return!!i&&(s.longitude<i.getWest()||s.longitude>i.getEast()||s.latitude<i.getSouth()||s.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new r.z("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("geolocate",f)),this._finish()}}_updateCamera(f){const i=new r.bO(f.coords.longitude,f.coords.latitude),s=f.coords.accuracy,m=this._map.getBearing(),x=r.l({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(s),x,{geolocateSource:!0})}_updateMarker(f){if(f){const i=new r.bO(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,i=r.bH(1,f._center.lat)*f.worldSize,s=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=Q("button","mapboxgl-ctrl-geolocate",this._container),Q("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Q("div","mapboxgl-user-location"),this._dotElement.appendChild(Q("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Q("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ns({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Q("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ns({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.z("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Yh,ScaleControl:class{constructor(f={}){this.options=r.l({},Ro,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aP(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,i=this._map,s=i._containerHeight/2,m=i._containerWidth/2-f/2,x=i.unproject([m,s]),b=i.unproject([m+f,s]),T=x.distanceTo(b);if(this.options.unit==="imperial"){const P=3.2808*T;P>5280?this._setScale(f,P/5280,"mile"):this._setScale(f,P,"foot")}else this.options.unit==="nautical"?this._setScale(f,T/1852,"nautical-mile"):T>=1e3?this._setScale(f,T/1e3,"kilometer"):this._setScale(f,T,"meter")}_setScale(f,i,s){this._map._requestDomTask(()=>{const m=function(b){const T=Math.pow(10,`${Math.floor(b)}`.length-1);let P=b/T;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(N){const V=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*V)/V}(P),T*P}(i),x=m/i;this._container.innerHTML=this._isNumberFormatSupported&&s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(m):`${m}&nbsp;${Ra[s]}`,this._container.style.width=f*x+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:r.w("Full screen control 'container' must be a DOM element.")),r.aP(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=Q("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Q("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(f){super(),this.options=r.l(Object.create(El),f),r.aP(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new r.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new r.z("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=r.bO.convert(f),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const i=document.createDocumentFragment(),s=document.createElement("body");let m;for(s.innerHTML=f;m=s.firstChild,m;)i.appendChild(m);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=Q("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(f),this.options.closeButton){const s=this._closeButton=Q("button","mapboxgl-popup-close-button",i);s.type="button",s.setAttribute("aria-label","Close popup"),s.innerHTML='<span aria-hidden="true">&#215;</span>',s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let i;return this._classList.delete(f)?i=!1:(this._classList.add(f),i=!0),this._updateClassList(),i}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const i=this._map,s=this._container,m=this._pos;if(!i||!s||!m)return"bottom";const x=s.offsetWidth,b=s.offsetHeight,T=m.x<x/2,P=m.x>i.transform.width-x/2;if(m.y+f<b)return T?"top-left":P?"top-right":"top";if(m.y>i.transform.height-b){if(T)return"bottom-left";if(P)return"bottom-right"}return T?"left":P?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),f.className=i.join(" ")}_update(f){const i=this._map,s=this._content;if(!i||!this._lngLat&&!this._trackPointer||!s)return;let m=this._container;if(m||(m=this._container=Q("div","mapboxgl-popup",i.getContainer()),this._tip=Q("div","mapboxgl-popup-tip",m),m.appendChild(s)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=mf(this._lngLat,this._pos,i.transform)),!this._trackPointer||f){const x=this._pos=this._trackPointer&&f instanceof r.P?f:i.project(this._lngLat),b=gf(this.options.offset),T=this._anchor=this._getAnchor(b.y),P=gf(this.options.offset,T),N=x.add(P).round();i._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${rl[T]} translate(${N.x}px,${N.y}px)`)})}if(!this._marker&&i._showingGlobe()){const x=r.dH(i.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Mr);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:Ns,Style:lo,LngLat:r.bO,LngLatBounds:r.az,Point:r.P,MercatorCoordinate:r.aa,FreeCameraOptions:Vd,Evented:r.E,config:r.e,prewarm:r.dM,clearPrewarmedResources:r.dN,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(f){r.e.ACCESS_TOKEN=f},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(f){r.e.API_URL=f},get workerCount(){return r.dO.workerCount},set workerCount(f){r.dO.workerCount=f},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){r.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){r.dP(f)},get workerUrl(){return r.dQ.workerUrl},set workerUrl(f){r.dQ.workerUrl=f},get workerClass(){return r.dQ.workerClass},set workerClass(f){r.dQ.workerClass=f},get workerParams(){return r.dQ.workerParams},set workerParams(f){r.dQ.workerParams=f},get dracoUrl(){return r.dR()},set dracoUrl(f){r.dS(f)},get meshoptUrl(){return r.dT()},set meshoptUrl(f){r.dU(f)},setNow:r.q.setNow,restoreNow:r.q.restoreNow}});var M=p;return M})}(dw)),dw.exports}var eJ=QK();const fw=Im(eJ),gL="pk.eyJ1IjoibXVoYW1tZWRoYWIiLCJhIjoiY203aml2aXBjMDdqbDJpb3NjZzdvNjl2cSJ9.wBdwODGA8FejfcCS9m2aPQ";var tJ=Object.defineProperty,nJ=Object.defineProperties,iJ=Object.getOwnPropertyDescriptors,rE=Object.getOwnPropertySymbols,BF=Object.prototype.hasOwnProperty,UF=Object.prototype.propertyIsEnumerable,_L=(t,e,a)=>e in t?tJ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,wa=(t,e)=>{for(var a in e||(e={}))BF.call(e,a)&&_L(t,a,e[a]);if(rE)for(var a of rE(e))UF.call(e,a)&&_L(t,a,e[a]);return t},bm=(t,e)=>nJ(t,iJ(e)),kE=(t,e)=>{var a={};for(var c in t)BF.call(t,c)&&e.indexOf(c)<0&&(a[c]=t[c]);if(t!=null&&rE)for(var c of rE(t))e.indexOf(c)<0&&UF.call(t,c)&&(a[c]=t[c]);return a},NR=(t,e,a)=>{if(!e.has(t))throw TypeError("Cannot "+a)},bs=(t,e,a)=>(NR(t,e,"read from private field"),a?a.call(t):e.get(t)),hc=(t,e,a)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,a)},rh=(t,e,a,c)=>(NR(t,e,"write to private field"),e.set(t,a),a),rJ=(t,e,a,c)=>({set _(p){rh(t,e,p)},get _(){return bs(t,e,c)}}),Ry=(t,e,a)=>(NR(t,e,"access private method"),a),Pl=(t,e,a)=>new Promise((c,p)=>{var y=I=>{try{r(a.next(I))}catch(k){p(k)}},M=I=>{try{r(a.throw(I))}catch(k){p(k)}},r=I=>I.done?c(I.value):Promise.resolve(I.value).then(y,M);r((a=a.apply(t,e)).next())}),VF="https://api.mapbox.com/autofill/v1",aJ="suggest",oJ="retrieve",sJ=`${VF}/${aJ}`,lJ=`${VF}/${oJ}`,_o=class{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90");if(this.lng>180||this.lng<-180)throw new Error("Invalid LngLat longitude value: must be between -180 and 180")}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}static convert(t){if(t instanceof _o)return new _o(t.lng,t.lat);if(Array.isArray(t)&&t.length===2)return new _o(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null&&("lng"in t||"lon"in t)&&"lat"in t)return new _o(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}},fc=class{constructor(t,e){this._sw=_o.convert(t),this._ne=_o.convert(e)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new _o(this.getWest(),this.getNorth())}getSouthEast(){return new _o(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toFlatArray(){return[this._sw.lng,this._sw.lat,this._ne.lng,this._ne.lat]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}static convert(t){if(!t)throw new Error("Invalid LngLatBounds convert value: falsy");if(t instanceof fc)return new fc(t.getSouthWest(),t.getNorthEast());if(Array.isArray(t)&&t.length===2)return new fc(_o.convert(t[0]),_o.convert(t[1]));if(Array.isArray(t)&&t.length===4)return new fc(_o.convert([t[0],t[1]]),_o.convert([t[2],t[3]]));throw new Error("`LngLatBoundsLike` argument must be specified as an array [<LngLatLike>, <LngLatLike>] or an array [<west>, <south>, <east>, <north>]")}};function cJ(){const e=(Math.random().toString(16)+Date.now().toString(16)+Math.random().toString(16)).replace(/\./g,"");return[e.slice(0,8),e.slice(8,12),"4"+e.slice(12,15)+"-8"+e.slice(15,18),e.slice(18,30)].join("-")}var pu=class{constructor(t){this.id=t??cJ()}toString(){return this.id}static convert(t){return new pu(t instanceof pu?t.id:t.toString())}},uJ="Unknown error",hJ=class extends Error{constructor(t,e){super(String(t.message||t.error||uJ)),this.name="MapboxError",this.statusCode=e}toString(){return`${this.name} (${this.statusCode}): ${this.message}`}};function Wf(t){return Pl(this,null,function*(){if(!t.ok){const e=yield t.json();throw new hJ(e,t.status)}})}var vL=globalThis.fetch,dJ=globalThis.AbortController;function wd(){if(!vL)throw new Error("Fetch implementation not found. Please include a fetch polyfill in your application or use `polyfillFetch` from `@mapbox/search-js-core` to fix this issue.");return{fetch:vL,AbortController:dJ}}function __(...t){const e=[];for(const a of t){if(!a)continue;const c=Object.entries(a);for(const[p,y]of c)y!=null&&e.push(`${p}=${encodeURIComponent(String(y))}`)}return e.join("&")}var pw,VA,jF,GF=class{constructor(t={}){hc(this,VA),hc(this,pw,void 0);const e=t,{accessToken:a}=e,c=kE(e,["accessToken"]);this.accessToken=a,this.defaults=wa(wa({},GF.defaults),c)}get responseHeaders(){return bs(this,pw)}suggest(t,e){return Pl(this,null,function*(){if(!t)throw new Error("searchText is required");const{sessionToken:a,signal:c}=e,p=bm(wa(wa({},this.defaults),e),{sessionToken:a}),y=new URL(`${sJ}/${encodeURIComponent(t)}`);y.search=Ry(this,VA,jF).call(this,p);const{fetch:M}=wd(),r=yield M(y.toString(),{signal:c});rh(this,pw,r.headers),yield Wf(r);const I=yield r.json();return bm(wa({},I),{suggestions:I.suggestions.map(k=>bm(wa({},k),{original_search_text:t})),url:y.toString()})})}retrieve(t,e){return Pl(this,null,function*(){if(!t)throw new Error("suggestion is required");if(!this.canRetrieve(t))throw new Error("suggestion cannot be retrieved");const{sessionToken:a,signal:c}=e,p=pu.convert(a),y=new URL(`${lJ}/${t.action.id}`);y.search=__({access_token:this.accessToken,session_token:p.id});const{fetch:M}=wd(),r=yield M(y.toString(),{signal:c});yield Wf(r);const I=yield r.json();return I.url=y.toString(),I})}canRetrieve(t){const e=t.action;return typeof(e==null?void 0:e.id)=="string"}},HF=GF;pw=new WeakMap;VA=new WeakSet;jF=function(t){return __({types:"address",access_token:this.accessToken,streets:t.streets,language:t.language,country:t.country,limit:t.limit},t.sessionToken&&{session_token:pu.convert(t.sessionToken).id},t.proximity&&{proximity:typeof t.proximity=="string"?t.proximity:_o.convert(t.proximity).toArray().join(",")},t.bbox&&{bbox:typeof t.bbox=="string"?t.bbox:fc.convert(t.bbox).toFlatArray().join(",")})};HF.defaults={language:"en",proximity:"ip",streets:!0};var FE="https://api.mapbox.com/search/searchbox/v1",fJ="suggest",pJ="retrieve",mJ="category",gJ="reverse",_J=`${FE}/${fJ}`,vJ=`${FE}/${pJ}`,yJ=`${FE}/${mJ}`,xJ=`${FE}/${gJ}`,mw,jA,qF=class{constructor(t={}){hc(this,mw);const e=t,{accessToken:a}=e,c=kE(e,["accessToken"]);this.accessToken=a,this.defaults=wa(wa({},qF.defaults),c)}suggest(t,e){return Pl(this,null,function*(){if(!t)throw new Error("searchText is required");const{sessionToken:a,signal:c}=e,p=bm(wa(wa({},this.defaults),e),{q:t,sessionToken:a});if(p.eta_type&&(!p.origin||!p.navigation_profile))throw new Error("to provide eta estimate: eta, navigation_profile, and origin are required");if(p.origin&&!p.navigation_profile)throw new Error("to provide distance estimate: both navigation_profile and origin are required");const y=new URL(_J);y.search=Ry(this,mw,jA).call(this,p);const{fetch:M}=wd(),r=yield M(y.toString(),{signal:c});yield Wf(r);const I=yield r.json();return I.url=y.toString(),I})}retrieve(t,e){return Pl(this,null,function*(){if(!t)throw new Error("suggestion is required");const{sessionToken:a,signal:c,language:p}=e,y=pu.convert(a),M=wa(wa({},this.defaults),p&&{language:p}),r=new URL(`${vJ}/${encodeURIComponent(t.mapbox_id)}`);r.search=__({access_token:this.accessToken,session_token:y.id},{language:M.language});const{fetch:I}=wd(),k=yield I(r.toString(),{signal:c});yield Wf(k);const B=yield k.json();return B.url=r.toString(),B})}category(t){return Pl(this,arguments,function*(e,a={}){if(!e)throw new Error("category is required");const c=wa(wa({},this.defaults),a),p=new URL(`${yJ}/${encodeURIComponent(e)}`);p.search=Ry(this,mw,jA).call(this,c);const{fetch:y}=wd(),M=yield y(p.toString(),{signal:c.signal});yield Wf(M);const r=yield M.json();return r.url=p.toString(),r})}reverse(t){return Pl(this,arguments,function*(e,a={}){if(!e)throw new Error("lngLat is required");const[c,p]=typeof e=="string"?e.split(",").map(B=>parseFloat(B)):_o.convert(e).toArray();if(isNaN(c)||isNaN(p))throw new Error("lngLat is required");const y=wa(wa({},this.defaults),a),M=new URL(xJ);M.search=__({access_token:this.accessToken,language:y.language,limit:y.limit,longitude:c,latitude:p},y.types&&{types:typeof y.types=="string"?y.types:[...y.types].join(",")});const{fetch:r}=wd(),I=yield r(M.toString(),{signal:y.signal});yield Wf(I);const k=yield I.json();return k.url=M.toString(),k})}},WF=qF;mw=new WeakSet;jA=function(t){return __({q:t.q,access_token:this.accessToken,language:t.language,limit:t.limit,navigation_profile:t.navigation_profile,route:t.route,route_geometry:t.route_geometry,sar_type:t.sar_type,time_deviation:t.time_deviation,eta_type:t.eta_type,country:t.country,poi_category:t.poi_category,rich_metadata_provider:t.rich_metadata_provider,poi_category_exclusions:t.poi_category_exclusions},t.sessionToken&&{session_token:pu.convert(t.sessionToken).id},t.proximity&&{proximity:typeof t.proximity=="string"?t.proximity:_o.convert(t.proximity).toArray().join(",")},t.origin&&{origin:typeof t.origin=="string"?t.origin:_o.convert(t.origin).toArray().join(",")},t.bbox&&{bbox:typeof t.bbox=="string"?t.bbox:fc.convert(t.bbox).toFlatArray().join(",")},t.types&&{types:typeof t.types=="string"?t.types:[...t.types].join(",")})};WF.defaults={language:"en"};var bJ="https://api.mapbox.com/autofill/v1",wJ="retrieve",SJ=`${bJ}/${wJ}`,GA,$F,XF=class{constructor(t={}){hc(this,GA);const e=t,{accessToken:a}=e,c=kE(e,["accessToken"]);this.accessToken=a,this.defaults=wa(wa({},XF.defaults),c)}validate(t,e){return Pl(this,null,function*(){if(!t)throw new Error("searchText is required");const{sessionToken:a,signal:c}=e,p=bm(wa(wa({},this.defaults),e),{sessionToken:a}),y=new URL(`${SJ}/${encodeURIComponent(t)}`);y.search=Ry(this,GA,$F).call(this,p);const{fetch:M}=wd(),r=yield M(y.toString(),{signal:c});yield Wf(r);const I=yield r.json();return I.url=y.toString(),I.features.length>0&&(I.features=[I.features[0]]),I})}},ZF=XF;GA=new WeakSet;$F=function(t){return __({access_token:this.accessToken,language:t.language,country:t.country},t.sessionToken&&{session_token:pu.convert(t.sessionToken).id},t.proximity&&{proximity:typeof t.proximity=="string"?t.proximity:_o.convert(t.proximity).toArray().join(",")},t.bbox&&{bbox:typeof t.bbox=="string"?t.bbox:fc.convert(t.bbox).toFlatArray().join(",")})};ZF.defaults={language:"en",proximity:"ip"};var YF="https://api.mapbox.com/search/geocode/v6",EJ=`${YF}/forward`,MJ=`${YF}/reverse`,TJ=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/,AJ=/[\s,]+/,s0,gw,HA,CJ=class{constructor(t={}){hc(this,gw),hc(this,s0,void 0);const e=t,{accessToken:a}=e,c=kE(e,["accessToken"]);this.accessToken=a,this.defaults=wa({},c)}get responseHeaders(){return bs(this,s0)}forward(t,e){return Pl(this,null,function*(){if(!t)throw new Error("searchText is required");let a;e&&({signal:a}=e);const c=bm(wa(wa({},this.defaults),e),{q:t}),p=new URL(`${EJ}`);p.search=Ry(this,gw,HA).call(this,c);const{fetch:y}=wd(),M=a?{signal:a}:{},r=yield y(p.toString(),M);rh(this,s0,r.headers),yield Wf(r);const I=yield r.json();return I.url=p.toString(),I})}reverse(t,e){return Pl(this,null,function*(){if(!t)throw new Error("lngLat is required");let a;e&&({signal:a}=e);let c;if(typeof t=="string"){const[B,U]=t.split(",");c=new _o(Number(B),Number(U))}else c=_o.convert(t);const p=bm(wa(wa({},this.defaults),e),{longitude:c.lng,latitude:c.lat}),y=new URL(`${MJ}`);y.search=Ry(this,gw,HA).call(this,p,!0);const{fetch:M}=wd(),r=a?{signal:a}:{},I=yield M(y.toString(),r);rh(this,s0,I.headers),yield Wf(I);const k=yield I.json();return k.url=y.toString(),k})}suggest(t,e){return Pl(this,null,function*(){if(TJ.test(t)){const c=t.trim().split(AJ).map(p=>p.trim()).join(",");return this.reverse(c,e)}else return this.forward(t,e)})}retrieve(t){return Pl(this,null,function*(){return t})}};s0=new WeakMap;gw=new WeakSet;HA=function(t,e=!1){return e&&["proximity","autocomplete","bbox"].forEach(a=>{a in t&&delete t[a]}),__({q:t.q,longitude:t.longitude,latitude:t.latitude,access_token:this.accessToken,permanent:t.permanent,language:t.language,country:t.country,limit:t.limit,autocomplete:t.autocomplete,worldview:t.worldview},t.sessionToken&&{session_token:pu.convert(t.sessionToken).id},t.proximity&&{proximity:typeof t.proximity=="string"?t.proximity:_o.convert(t.proximity).toArray().join(",")},t.bbox&&{bbox:typeof t.bbox=="string"?t.bbox:fc.convert(t.bbox).toFlatArray().join(",")},t.types&&{types:typeof t.types=="string"?t.types:[...t.types].join(",")})};var KF=(t=>(t.exact="exact",t.high="high",t.medium="medium",t.low="low",t))(KF||{}),l0,RJ=class{constructor(){hc(this,l0,{})}addEventListener(t,e){const a=bs(this,l0);a[t]||(a[t]=[]),a[t].push(e)}removeEventListener(t,e){const a=bs(this,l0);if(!a[t])return;const c=a[t],p=c.indexOf(e);p!==-1&&c.splice(p,1)}fire(t,e){const a=bs(this,l0);if(!a[t])return;const c=a[t];for(const p of c)p(e)}};l0=new WeakMap;function JF(t,e,a){let c=null;return(...p)=>{c!==null&&clearTimeout(c);const y=a&&a();c=setTimeout(()=>{c=null,!(y!=null&&y.aborted)&&t(...p)},e)}}function d2(){const{AbortController:t}=wd();return new t}var c0,_w,vw,Zv,um,yw,BR=class extends RJ{constructor(t,e=0){super(),hc(this,c0,new pu),hc(this,_w,0),hc(this,vw,!1),hc(this,Zv,void 0),hc(this,um,d2()),hc(this,yw,void 0),rh(this,yw,JF((a,...c)=>Pl(this,[a,...c],function*(p,y={}){if(bs(this,um).abort(),rh(this,um,d2()),!p){rh(this,Zv,null),this.fire("suggest",bs(this,Zv));return}try{const M=yield this.search.suggest(p,bm(wa({sessionToken:this.sessionToken},y),{signal:bs(this,um).signal}));rh(this,Zv,M),this.fire("suggest",M)}catch(M){if(M.name==="AbortError")return;this.fire("suggesterror",M)}}),e,()=>bs(this,um).signal)),Object.defineProperties(this,{search:{value:t,writable:!1},debounce:{value:e,writable:!1}})}get sessionToken(){return bs(this,vw)?bs(this,c0).id:`${bs(this,c0).id}.${bs(this,_w)}`}set sessionToken(t){rh(this,vw,!0),rh(this,c0,new pu(t))}get suggestions(){return bs(this,Zv)}suggest(t,e){return bs(this,yw).call(this,t,e),new Promise((a,c)=>{let p,y;p=M=>{this.removeEventListener("suggest",p),this.removeEventListener("suggesterror",y),a(M)},y=M=>{this.removeEventListener("suggest",p),this.removeEventListener("suggesterror",y),c(M)},this.addEventListener("suggest",p),this.addEventListener("suggesterror",y)})}clear(){this.suggest("")}retrieve(t,e){return Pl(this,null,function*(){const a=yield this.search.retrieve(t,wa({sessionToken:this.sessionToken},e));return this.fire("retrieve",a),a})}canRetrieve(t){return this.search.canRetrieve?this.search.canRetrieve(t):!0}canSuggest(t){return this.search.canSuggest?this.search.canSuggest(t):!0}abort(){bs(this,um).abort(),rh(this,um,d2())}incrementSession(){rJ(this,_w)._++}};c0=new WeakMap;_w=new WeakMap;vw=new WeakMap;Zv=new WeakMap;um=new WeakMap;yw=new WeakMap;function UR(t){const{properties:e}=t;return wa({},e)}function NE(t){return t.split("-")[0]}function VR(t){return t.split("-")[1]}function jR(t){return["top","bottom"].includes(NE(t))?"x":"y"}function QF(t){return t==="y"?"height":"width"}function yL(t,e,a){let{reference:c,floating:p}=t;const y=c.x+c.width/2-p.width/2,M=c.y+c.height/2-p.height/2,r=jR(e),I=QF(r),k=c[I]/2-p[I]/2,B=r==="x";let U;switch(NE(e)){case"top":U={x:y,y:c.y-p.height};break;case"bottom":U={x:y,y:c.y+c.height};break;case"right":U={x:c.x+c.width,y:M};break;case"left":U={x:c.x-p.width,y:M};break;default:U={x:c.x,y:c.y}}switch(VR(e)){case"start":U[r]-=k*(a&&B?-1:1);break;case"end":U[r]+=k*(a&&B?-1:1)}return U}const IJ=async(t,e,a)=>{const{placement:c="bottom",strategy:p="absolute",middleware:y=[],platform:M}=a,r=await(M.isRTL==null?void 0:M.isRTL(e));let I=await M.getElementRects({reference:t,floating:e,strategy:p}),{x:k,y:B}=yL(I,c,r),U=c,H={},Y=0;for(let X=0;X<y.length;X++){const{name:Q,fn:J}=y[X],{x:j,y:oe,data:ce,reset:pe}=await J({x:k,y:B,initialPlacement:c,placement:U,strategy:p,middlewareData:H,rects:I,platform:M,elements:{reference:t,floating:e}});k=j??k,B=oe??B,H={...H,[Q]:{...H[Q],...ce}},pe&&Y<=50&&(Y++,typeof pe=="object"&&(pe.placement&&(U=pe.placement),pe.rects&&(I=pe.rects===!0?await M.getElementRects({reference:t,floating:e,strategy:p}):pe.rects),{x:k,y:B}=yL(I,U,r)),X=-1)}return{x:k,y:B,placement:U,strategy:p,middlewareData:H}};function DJ(t){return typeof t!="number"?function(e){return{top:0,right:0,bottom:0,left:0,...e}}(t):{top:t,right:t,bottom:t,left:t}}function aE(t){return{...t,top:t.y,left:t.x,right:t.x+t.width,bottom:t.y+t.height}}async function PJ(t,e){var a;e===void 0&&(e={});const{x:c,y:p,platform:y,rects:M,elements:r,strategy:I}=t,{boundary:k="clippingAncestors",rootBoundary:B="viewport",elementContext:U="floating",altBoundary:H=!1,padding:Y=0}=e,X=DJ(Y),Q=r[H?U==="floating"?"reference":"floating":U],J=aE(await y.getClippingRect({element:(a=await(y.isElement==null?void 0:y.isElement(Q)))==null||a?Q:Q.contextElement||await(y.getDocumentElement==null?void 0:y.getDocumentElement(r.floating)),boundary:k,rootBoundary:B,strategy:I})),j=aE(y.convertOffsetParentRelativeRectToViewportRelativeRect?await y.convertOffsetParentRelativeRectToViewportRelativeRect({rect:U==="floating"?{...M.floating,x:c,y:p}:M.reference,offsetParent:await(y.getOffsetParent==null?void 0:y.getOffsetParent(r.floating)),strategy:I}):M[U]);return{top:J.top-j.top+X.top,bottom:j.bottom-J.bottom+X.bottom,left:J.left-j.left+X.left,right:j.right-J.right+X.right}}const LJ={left:"right",right:"left",bottom:"top",top:"bottom"};function oE(t){return t.replace(/left|right|bottom|top/g,e=>LJ[e])}function OJ(t,e,a){a===void 0&&(a=!1);const c=VR(t),p=jR(t),y=QF(p);let M=p==="x"?c===(a?"end":"start")?"right":"left":c==="start"?"bottom":"top";return e.reference[y]>e.floating[y]&&(M=oE(M)),{main:M,cross:oE(M)}}const zJ={start:"end",end:"start"};function xL(t){return t.replace(/start|end/g,e=>zJ[e])}const kJ=["top","right","bottom","left"];kJ.reduce((t,e)=>t.concat(e,e+"-start",e+"-end"),[]);const FJ=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var a;const{placement:c,middlewareData:p,rects:y,initialPlacement:M,platform:r,elements:I}=e,{mainAxis:k=!0,crossAxis:B=!0,fallbackPlacements:U,fallbackStrategy:H="bestFit",flipAlignment:Y=!0,...X}=t,Q=NE(c),J=U||(Q===M||!Y?[oE(M)]:function(Ve){const Se=oE(Ve);return[xL(Ve),Se,xL(Se)]}(M)),j=[M,...J],oe=await PJ(e,X),ce=[];let pe=((a=p.flip)==null?void 0:a.overflows)||[];if(k&&ce.push(oe[Q]),B){const{main:Ve,cross:Se}=OJ(c,y,await(r.isRTL==null?void 0:r.isRTL(I.floating)));ce.push(oe[Ve],oe[Se])}if(pe=[...pe,{placement:c,overflows:ce}],!ce.every(Ve=>Ve<=0)){var Ae,Ee;const Ve=((Ae=(Ee=p.flip)==null?void 0:Ee.index)!=null?Ae:0)+1,Se=j[Ve];if(Se)return{data:{index:Ve,overflows:pe},reset:{placement:Se}};let xe="bottom";switch(H){case"bestFit":{var be;const Fe=(be=pe.map(Ct=>[Ct,Ct.overflows.filter(Et=>Et>0).reduce((Et,Tt)=>Et+Tt,0)]).sort((Ct,Et)=>Ct[1]-Et[1])[0])==null?void 0:be[0].placement;Fe&&(xe=Fe);break}case"initialPlacement":xe=M}if(c!==xe)return{reset:{placement:xe}}}return{}}}},NJ=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){const{x:a,y:c}=e,p=await async function(y,M){const{placement:r,platform:I,elements:k}=y,B=await(I.isRTL==null?void 0:I.isRTL(k.floating)),U=NE(r),H=VR(r),Y=jR(r)==="x",X=["left","top"].includes(U)?-1:1,Q=B&&Y?-1:1,J=typeof M=="function"?M(y):M;let{mainAxis:j,crossAxis:oe,alignmentAxis:ce}=typeof J=="number"?{mainAxis:J,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...J};return H&&typeof ce=="number"&&(oe=H==="end"?-1*ce:ce),Y?{x:oe*Q,y:j*X}:{x:j*X,y:oe*Q}}(e,t);return{x:a+p.x,y:c+p.y,data:p}}}};function eN(t){return t&&t.document&&t.location&&t.alert&&t.setInterval}function ip(t){if(t==null)return window;if(!eN(t)){const e=t.ownerDocument;return e&&e.defaultView||window}return t}function hb(t){return ip(t).getComputedStyle(t)}function Zf(t){return eN(t)?"":t?(t.nodeName||"").toLowerCase():""}function tN(){const t=navigator.userAgentData;return t!=null&&t.brands?t.brands.map(e=>e.brand+"/"+e.version).join(" "):navigator.userAgent}function Cd(t){return t instanceof ip(t).HTMLElement}function Rm(t){return t instanceof ip(t).Element}function GR(t){return typeof ShadowRoot>"u"?!1:t instanceof ip(t).ShadowRoot||t instanceof ShadowRoot}function BE(t){const{overflow:e,overflowX:a,overflowY:c}=hb(t);return/auto|scroll|overlay|hidden/.test(e+c+a)}function BJ(t){return["table","td","th"].includes(Zf(t))}function bL(t){const e=/firefox/i.test(tN()),a=hb(t);return a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].includes(a.willChange)||e&&a.willChange==="filter"||e&&!!a.filter&&a.filter!=="none"}function nN(){return!/^((?!chrome|android).)*safari/i.test(tN())}const wL=Math.min,O0=Math.max,sE=Math.round;function Yf(t,e,a){var c,p,y,M;e===void 0&&(e=!1),a===void 0&&(a=!1);const r=t.getBoundingClientRect();let I=1,k=1;e&&Cd(t)&&(I=t.offsetWidth>0&&sE(r.width)/t.offsetWidth||1,k=t.offsetHeight>0&&sE(r.height)/t.offsetHeight||1);const B=Rm(t)?ip(t):window,U=!nN()&&a,H=(r.left+(U&&(c=(p=B.visualViewport)==null?void 0:p.offsetLeft)!=null?c:0))/I,Y=(r.top+(U&&(y=(M=B.visualViewport)==null?void 0:M.offsetTop)!=null?y:0))/k,X=r.width/I,Q=r.height/k;return{width:X,height:Q,top:Y,right:H+X,bottom:Y+Q,left:H,x:H,y:Y}}function wm(t){return(e=t,(e instanceof ip(e).Node?t.ownerDocument:t.document)||window.document).documentElement;var e}function UE(t){return Rm(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function iN(t){return Yf(wm(t)).left+UE(t).scrollLeft}function UJ(t,e,a){const c=Cd(e),p=wm(e),y=Yf(t,c&&function(I){const k=Yf(I);return sE(k.width)!==I.offsetWidth||sE(k.height)!==I.offsetHeight}(e),a==="fixed");let M={scrollLeft:0,scrollTop:0};const r={x:0,y:0};if(c||!c&&a!=="fixed")if((Zf(e)!=="body"||BE(p))&&(M=UE(e)),Cd(e)){const I=Yf(e,!0);r.x=I.x+e.clientLeft,r.y=I.y+e.clientTop}else p&&(r.x=iN(p));return{x:y.left+M.scrollLeft-r.x,y:y.top+M.scrollTop-r.y,width:y.width,height:y.height}}function rN(t){return Zf(t)==="html"?t:t.assignedSlot||t.parentNode||(GR(t)?t.host:null)||wm(t)}function SL(t){return Cd(t)&&getComputedStyle(t).position!=="fixed"?t.offsetParent:null}function qA(t){const e=ip(t);let a=SL(t);for(;a&&BJ(a)&&getComputedStyle(a).position==="static";)a=SL(a);return a&&(Zf(a)==="html"||Zf(a)==="body"&&getComputedStyle(a).position==="static"&&!bL(a))?e:a||function(c){let p=rN(c);for(GR(p)&&(p=p.host);Cd(p)&&!["html","body"].includes(Zf(p));){if(bL(p))return p;p=p.parentNode}return null}(t)||e}function EL(t){if(Cd(t))return{width:t.offsetWidth,height:t.offsetHeight};const e=Yf(t);return{width:e.width,height:e.height}}function aN(t){const e=rN(t);return["html","body","#document"].includes(Zf(e))?t.ownerDocument.body:Cd(e)&&BE(e)?e:aN(e)}function lE(t,e){var a;e===void 0&&(e=[]);const c=aN(t),p=c===((a=t.ownerDocument)==null?void 0:a.body),y=ip(c),M=p?[y].concat(y.visualViewport||[],BE(c)?c:[]):c,r=e.concat(M);return p?r:r.concat(lE(M))}function ML(t,e,a){return e==="viewport"?aE(function(c,p){const y=ip(c),M=wm(c),r=y.visualViewport;let I=M.clientWidth,k=M.clientHeight,B=0,U=0;if(r){I=r.width,k=r.height;const H=nN();(H||!H&&p==="fixed")&&(B=r.offsetLeft,U=r.offsetTop)}return{width:I,height:k,x:B,y:U}}(t,a)):Rm(e)?function(c,p){const y=Yf(c,!1,p==="fixed"),M=y.top+c.clientTop,r=y.left+c.clientLeft;return{top:M,left:r,x:r,y:M,right:r+c.clientWidth,bottom:M+c.clientHeight,width:c.clientWidth,height:c.clientHeight}}(e,a):aE(function(c){var p;const y=wm(c),M=UE(c),r=(p=c.ownerDocument)==null?void 0:p.body,I=O0(y.scrollWidth,y.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),k=O0(y.scrollHeight,y.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0);let B=-M.scrollLeft+iN(c);const U=-M.scrollTop;return hb(r||y).direction==="rtl"&&(B+=O0(y.clientWidth,r?r.clientWidth:0)-I),{width:I,height:k,x:B,y:U}}(wm(t)))}function VJ(t){const e=lE(t),a=["absolute","fixed"].includes(hb(t).position)&&Cd(t)?qA(t):t;return Rm(a)?e.filter(c=>Rm(c)&&function(p,y){const M=y.getRootNode==null?void 0:y.getRootNode();if(p.contains(y))return!0;if(M&&GR(M)){let r=y;do{if(r&&p===r)return!0;r=r.parentNode||r.host}while(r)}return!1}(c,a)&&Zf(c)!=="body"):[]}const jJ={getClippingRect:function(t){let{element:e,boundary:a,rootBoundary:c,strategy:p}=t;const y=[...a==="clippingAncestors"?VJ(e):[].concat(a),c],M=y[0],r=y.reduce((I,k)=>{const B=ML(e,k,p);return I.top=O0(B.top,I.top),I.right=wL(B.right,I.right),I.bottom=wL(B.bottom,I.bottom),I.left=O0(B.left,I.left),I},ML(e,M,p));return{width:r.right-r.left,height:r.bottom-r.top,x:r.left,y:r.top}},convertOffsetParentRelativeRectToViewportRelativeRect:function(t){let{rect:e,offsetParent:a,strategy:c}=t;const p=Cd(a),y=wm(a);if(a===y)return e;let M={scrollLeft:0,scrollTop:0};const r={x:0,y:0};if((p||!p&&c!=="fixed")&&((Zf(a)!=="body"||BE(y))&&(M=UE(a)),Cd(a))){const I=Yf(a,!0);r.x=I.x+a.clientLeft,r.y=I.y+a.clientTop}return{...e,x:e.x-M.scrollLeft+r.x,y:e.y-M.scrollTop+r.y}},isElement:Rm,getDimensions:EL,getOffsetParent:qA,getDocumentElement:wm,getElementRects:t=>{let{reference:e,floating:a,strategy:c}=t;return{reference:UJ(e,qA(a),c),floating:{...EL(a),x:0,y:0}}},getClientRects:t=>Array.from(t.getClientRects()),isRTL:t=>hb(t).direction==="rtl"};function GJ(t,e,a,c){c===void 0&&(c={});const{ancestorScroll:p=!0,ancestorResize:y=!0,elementResize:M=!0,animationFrame:r=!1}=c,I=p&&!r,k=y&&!r,B=I||k?[...Rm(t)?lE(t):[],...lE(e)]:[];B.forEach(X=>{I&&X.addEventListener("scroll",a,{passive:!0}),k&&X.addEventListener("resize",a)});let U,H=null;if(M){let X=!0;H=new ResizeObserver(()=>{X||a(),X=!1}),Rm(t)&&!r&&H.observe(t),H.observe(e)}let Y=r?Yf(t):null;return r&&function X(){const Q=Yf(t);!Y||Q.x===Y.x&&Q.y===Y.y&&Q.width===Y.width&&Q.height===Y.height||a(),Y=Q,U=requestAnimationFrame(X)}(),a(),()=>{var X;B.forEach(Q=>{I&&Q.removeEventListener("scroll",a),k&&Q.removeEventListener("resize",a)}),(X=H)==null||X.disconnect(),H=null,r&&cancelAnimationFrame(U)}}const HJ=(t,e,a)=>IJ(t,e,{platform:jJ,...a});var f2={exports:{}},TL;function qJ(){return TL||(TL=1,function(t){(function(e){var a=!1,c,p;function y(){if(typeof c<"u")return c;var U=document.documentElement,H=document.createElement("div");return H.setAttribute("style","width:99px;height:99px;position:absolute;top:-9999px;overflow:scroll;"),U.appendChild(H),c=H.offsetWidth-H.clientWidth,U.removeChild(H),c}function M(){return document.documentElement.scrollHeight>window.innerHeight}function r(U){if(!(typeof document>"u"||a)){var H=document.documentElement;p=window.pageYOffset,M()?H.style.width="calc(100% - "+y()+"px)":H.style.width="100%",H.style.position="fixed",H.style.top=-p+"px",H.style.overflow="hidden",a=!0}}function I(){if(!(typeof document>"u"||!a)){var U=document.documentElement;U.style.width="",U.style.position="",U.style.top="",U.style.overflow="",window.scroll(0,p),a=!1}}function k(){if(a){I();return}r()}var B={on:r,off:I,toggle:k};t.exports=B})()}(f2)),f2.exports}var WJ=qJ();const AL=Im(WJ);/*!
* tabbable 5.3.3
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var oN=["input","select","textarea","a[href]","button","[tabindex]:not(slot)","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],cE=oN.join(","),sN=typeof Element>"u",v_=sN?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,WA=!sN&&Element.prototype.getRootNode?function(t){return t.getRootNode()}:function(t){return t.ownerDocument},lN=function(e,a,c){var p=Array.prototype.slice.apply(e.querySelectorAll(cE));return a&&v_.call(e,cE)&&p.unshift(e),p=p.filter(c),p},cN=function t(e,a,c){for(var p=[],y=Array.from(e);y.length;){var M=y.shift();if(M.tagName==="SLOT"){var r=M.assignedElements(),I=r.length?r:M.children,k=t(I,!0,c);c.flatten?p.push.apply(p,k):p.push({scope:M,candidates:k})}else{var B=v_.call(M,cE);B&&c.filter(M)&&(a||!e.includes(M))&&p.push(M);var U=M.shadowRoot||typeof c.getShadowRoot=="function"&&c.getShadowRoot(M),H=!c.shadowRootFilter||c.shadowRootFilter(M);if(U&&H){var Y=t(U===!0?M.children:U.children,!0,c);c.flatten?p.push.apply(p,Y):p.push({scope:M,candidates:Y})}else y.unshift.apply(y,M.children)}}return p},uN=function(e,a){return e.tabIndex<0&&(a||/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||e.isContentEditable)&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},$J=function(e,a){return e.tabIndex===a.tabIndex?e.documentOrder-a.documentOrder:e.tabIndex-a.tabIndex},hN=function(e){return e.tagName==="INPUT"},XJ=function(e){return hN(e)&&e.type==="hidden"},ZJ=function(e){var a=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(c){return c.tagName==="SUMMARY"});return a},YJ=function(e,a){for(var c=0;c<e.length;c++)if(e[c].checked&&e[c].form===a)return e[c]},KJ=function(e){if(!e.name)return!0;var a=e.form||WA(e),c=function(r){return a.querySelectorAll('input[type="radio"][name="'+r+'"]')},p;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")p=c(window.CSS.escape(e.name));else try{p=c(e.name)}catch(M){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",M.message),!1}var y=YJ(p,e.form);return!y||y===e},JJ=function(e){return hN(e)&&e.type==="radio"},QJ=function(e){return JJ(e)&&!KJ(e)},CL=function(e){var a=e.getBoundingClientRect(),c=a.width,p=a.height;return c===0&&p===0},eQ=function(e,a){var c=a.displayCheck,p=a.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var y=v_.call(e,"details>summary:first-of-type"),M=y?e.parentElement:e;if(v_.call(M,"details:not([open]) *"))return!0;var r=WA(e).host,I=(r==null?void 0:r.ownerDocument.contains(r))||e.ownerDocument.contains(e);if(!c||c==="full"){if(typeof p=="function"){for(var k=e;e;){var B=e.parentElement,U=WA(e);if(B&&!B.shadowRoot&&p(B)===!0)return CL(e);e.assignedSlot?e=e.assignedSlot:!B&&U!==e.ownerDocument?e=U.host:e=B}e=k}if(I)return!e.getClientRects().length}else if(c==="non-zero-area")return CL(e);return!1},tQ=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var a=e.parentElement;a;){if(a.tagName==="FIELDSET"&&a.disabled){for(var c=0;c<a.children.length;c++){var p=a.children.item(c);if(p.tagName==="LEGEND")return v_.call(a,"fieldset[disabled] *")?!0:!p.contains(e)}return!0}a=a.parentElement}return!1},uE=function(e,a){return!(a.disabled||XJ(a)||eQ(a,e)||ZJ(a)||tQ(a))},$A=function(e,a){return!(QJ(a)||uN(a)<0||!uE(e,a))},nQ=function(e){var a=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(a)||a>=0)},iQ=function t(e){var a=[],c=[];return e.forEach(function(p,y){var M=!!p.scope,r=M?p.scope:p,I=uN(r,M),k=M?t(p.candidates):r;I===0?M?a.push.apply(a,k):a.push(r):c.push({documentOrder:y,tabIndex:I,item:p,isScope:M,content:k})}),c.sort($J).reduce(function(p,y){return y.isScope?p.push.apply(p,y.content):p.push(y.content),p},[]).concat(a)},rQ=function(e,a){a=a||{};var c;return a.getShadowRoot?c=cN([e],a.includeContainer,{filter:$A.bind(null,a),flatten:!1,getShadowRoot:a.getShadowRoot,shadowRootFilter:nQ}):c=lN(e,a.includeContainer,$A.bind(null,a)),iQ(c)},aQ=function(e,a){a=a||{};var c;return a.getShadowRoot?c=cN([e],a.includeContainer,{filter:uE.bind(null,a),flatten:!0,getShadowRoot:a.getShadowRoot}):c=lN(e,a.includeContainer,uE.bind(null,a)),c},J1=function(e,a){if(a=a||{},!e)throw new Error("No node provided");return v_.call(e,cE)===!1?!1:$A(a,e)},oQ=oN.concat("iframe").join(","),p2=function(e,a){if(a=a||{},!e)throw new Error("No node provided");return v_.call(e,oQ)===!1?!1:uE(a,e)};/*!
* focus-trap 6.9.4
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function RL(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);e&&(c=c.filter(function(p){return Object.getOwnPropertyDescriptor(t,p).enumerable})),a.push.apply(a,c)}return a}function IL(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?RL(Object(a),!0).forEach(function(c){sQ(t,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):RL(Object(a)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(a,c))})}return t}function sQ(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var DL=function(){var t=[];return{activateTrap:function(a){if(t.length>0){var c=t[t.length-1];c!==a&&c.pause()}var p=t.indexOf(a);p===-1||t.splice(p,1),t.push(a)},deactivateTrap:function(a){var c=t.indexOf(a);c!==-1&&t.splice(c,1),t.length>0&&t[t.length-1].unpause()}}}(),lQ=function(e){return e.tagName&&e.tagName.toLowerCase()==="input"&&typeof e.select=="function"},cQ=function(e){return e.key==="Escape"||e.key==="Esc"||e.keyCode===27},uQ=function(e){return e.key==="Tab"||e.keyCode===9},PL=function(e){return setTimeout(e,0)},LL=function(e,a){var c=-1;return e.every(function(p,y){return a(p)?(c=y,!1):!0}),c},t0=function(e){for(var a=arguments.length,c=new Array(a>1?a-1:0),p=1;p<a;p++)c[p-1]=arguments[p];return typeof e=="function"?e.apply(void 0,c):e},Q1=function(e){return e.target.shadowRoot&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target},hQ=function(e,a){var c=(a==null?void 0:a.document)||document,p=IL({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0},a),y={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0},M,r=function(Ee,be,Ve){return Ee&&Ee[be]!==void 0?Ee[be]:p[Ve||be]},I=function(Ee){return y.containerGroups.findIndex(function(be){var Ve=be.container,Se=be.tabbableNodes;return Ve.contains(Ee)||Se.find(function(xe){return xe===Ee})})},k=function(Ee){var be=p[Ee];if(typeof be=="function"){for(var Ve=arguments.length,Se=new Array(Ve>1?Ve-1:0),xe=1;xe<Ve;xe++)Se[xe-1]=arguments[xe];be=be.apply(void 0,Se)}if(be===!0&&(be=void 0),!be){if(be===void 0||be===!1)return be;throw new Error("`".concat(Ee,"` was specified but was not a node, or did not return a node"))}var Fe=be;if(typeof be=="string"&&(Fe=c.querySelector(be),!Fe))throw new Error("`".concat(Ee,"` as selector refers to no known node"));return Fe},B=function(){var Ee=k("initialFocus");if(Ee===!1)return!1;if(Ee===void 0)if(I(c.activeElement)>=0)Ee=c.activeElement;else{var be=y.tabbableGroups[0],Ve=be&&be.firstTabbableNode;Ee=Ve||k("fallbackFocus")}if(!Ee)throw new Error("Your focus-trap needs to have at least one focusable element");return Ee},U=function(){if(y.containerGroups=y.containers.map(function(Ee){var be=rQ(Ee,p.tabbableOptions),Ve=aQ(Ee,p.tabbableOptions);return{container:Ee,tabbableNodes:be,focusableNodes:Ve,firstTabbableNode:be.length>0?be[0]:null,lastTabbableNode:be.length>0?be[be.length-1]:null,nextTabbableNode:function(xe){var Fe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,Ct=Ve.findIndex(function(Et){return Et===xe});if(!(Ct<0))return Fe?Ve.slice(Ct+1).find(function(Et){return J1(Et,p.tabbableOptions)}):Ve.slice(0,Ct).reverse().find(function(Et){return J1(Et,p.tabbableOptions)})}}}),y.tabbableGroups=y.containerGroups.filter(function(Ee){return Ee.tabbableNodes.length>0}),y.tabbableGroups.length<=0&&!k("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times")},H=function Ae(Ee){if(Ee!==!1&&Ee!==c.activeElement){if(!Ee||!Ee.focus){Ae(B());return}Ee.focus({preventScroll:!!p.preventScroll}),y.mostRecentlyFocusedNode=Ee,lQ(Ee)&&Ee.select()}},Y=function(Ee){var be=k("setReturnFocus",Ee);return be||(be===!1?!1:Ee)},X=function(Ee){var be=Q1(Ee);if(!(I(be)>=0)){if(t0(p.clickOutsideDeactivates,Ee)){M.deactivate({returnFocus:p.returnFocusOnDeactivate&&!p2(be,p.tabbableOptions)});return}t0(p.allowOutsideClick,Ee)||Ee.preventDefault()}},Q=function(Ee){var be=Q1(Ee),Ve=I(be)>=0;Ve||be instanceof Document?Ve&&(y.mostRecentlyFocusedNode=be):(Ee.stopImmediatePropagation(),H(y.mostRecentlyFocusedNode||B()))},J=function(Ee){var be=Q1(Ee);U();var Ve=null;if(y.tabbableGroups.length>0){var Se=I(be),xe=Se>=0?y.containerGroups[Se]:void 0;if(Se<0)Ee.shiftKey?Ve=y.tabbableGroups[y.tabbableGroups.length-1].lastTabbableNode:Ve=y.tabbableGroups[0].firstTabbableNode;else if(Ee.shiftKey){var Fe=LL(y.tabbableGroups,function(Lt){var lt=Lt.firstTabbableNode;return be===lt});if(Fe<0&&(xe.container===be||p2(be,p.tabbableOptions)&&!J1(be,p.tabbableOptions)&&!xe.nextTabbableNode(be,!1))&&(Fe=Se),Fe>=0){var Ct=Fe===0?y.tabbableGroups.length-1:Fe-1,Et=y.tabbableGroups[Ct];Ve=Et.lastTabbableNode}}else{var Tt=LL(y.tabbableGroups,function(Lt){var lt=Lt.lastTabbableNode;return be===lt});if(Tt<0&&(xe.container===be||p2(be,p.tabbableOptions)&&!J1(be,p.tabbableOptions)&&!xe.nextTabbableNode(be))&&(Tt=Se),Tt>=0){var _t=Tt===y.tabbableGroups.length-1?0:Tt+1,et=y.tabbableGroups[_t];Ve=et.firstTabbableNode}}}else Ve=k("fallbackFocus");Ve&&(Ee.preventDefault(),H(Ve))},j=function(Ee){if(cQ(Ee)&&t0(p.escapeDeactivates,Ee)!==!1){Ee.preventDefault(),M.deactivate();return}if(uQ(Ee)){J(Ee);return}},oe=function(Ee){var be=Q1(Ee);I(be)>=0||t0(p.clickOutsideDeactivates,Ee)||t0(p.allowOutsideClick,Ee)||(Ee.preventDefault(),Ee.stopImmediatePropagation())},ce=function(){if(y.active)return DL.activateTrap(M),y.delayInitialFocusTimer=p.delayInitialFocus?PL(function(){H(B())}):H(B()),c.addEventListener("focusin",Q,!0),c.addEventListener("mousedown",X,{capture:!0,passive:!1}),c.addEventListener("touchstart",X,{capture:!0,passive:!1}),c.addEventListener("click",oe,{capture:!0,passive:!1}),c.addEventListener("keydown",j,{capture:!0,passive:!1}),M},pe=function(){if(y.active)return c.removeEventListener("focusin",Q,!0),c.removeEventListener("mousedown",X,!0),c.removeEventListener("touchstart",X,!0),c.removeEventListener("click",oe,!0),c.removeEventListener("keydown",j,!0),M};return M={get active(){return y.active},get paused(){return y.paused},activate:function(Ee){if(y.active)return this;var be=r(Ee,"onActivate"),Ve=r(Ee,"onPostActivate"),Se=r(Ee,"checkCanFocusTrap");Se||U(),y.active=!0,y.paused=!1,y.nodeFocusedBeforeActivation=c.activeElement,be&&be();var xe=function(){Se&&U(),ce(),Ve&&Ve()};return Se?(Se(y.containers.concat()).then(xe,xe),this):(xe(),this)},deactivate:function(Ee){if(!y.active)return this;var be=IL({onDeactivate:p.onDeactivate,onPostDeactivate:p.onPostDeactivate,checkCanReturnFocus:p.checkCanReturnFocus},Ee);clearTimeout(y.delayInitialFocusTimer),y.delayInitialFocusTimer=void 0,pe(),y.active=!1,y.paused=!1,DL.deactivateTrap(M);var Ve=r(be,"onDeactivate"),Se=r(be,"onPostDeactivate"),xe=r(be,"checkCanReturnFocus"),Fe=r(be,"returnFocus","returnFocusOnDeactivate");Ve&&Ve();var Ct=function(){PL(function(){Fe&&H(Y(y.nodeFocusedBeforeActivation)),Se&&Se()})};return Fe&&xe?(xe(Y(y.nodeFocusedBeforeActivation)).then(Ct,Ct),this):(Ct(),this)},pause:function(){return y.paused||!y.active?this:(y.paused=!0,pe(),this)},unpause:function(){return!y.paused||!y.active?this:(y.paused=!1,U(),ce(),this)},updateContainerElements:function(Ee){var be=[].concat(Ee).filter(Boolean);return y.containers=be.map(function(Ve){return typeof Ve=="string"?c.querySelector(Ve):Ve}),y.active&&U(),this}},M.updateContainerElements(e),M},xw={exports:{}},dQ=xw.exports,OL;function fQ(){return OL||(OL=1,function(t){(function(e,a,c){t.exports?t.exports=c():e[a]=c()})(dQ,"subtag",function(){var e="",a=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function c(I){return I.match(a)||[]}function p(I){return c(I).filter(function(k,B){return k&&B})}function y(I){return I=c(I),{language:I[1]||e,extlang:I[2]||e,script:I[3]||e,region:I[4]||e}}function M(I,k,B){Object.defineProperty(I,k,{value:B,enumerable:!0})}function r(I,k,B){function U(H){return c(H)[I]||e}M(U,"pattern",k),M(y,B,U)}return r(1,/^[a-zA-Z]{2,3}$/,"language"),r(2,/^[a-zA-Z]{3}$/,"extlang"),r(3,/^[a-zA-Z]{4}$/,"script"),r(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),M(y,"split",p),y})}(xw)),xw.exports}var pQ=fQ();const dN=Im(pQ);var m2={exports:{}},zL;function mQ(){return zL||(zL=1,function(t,e){var a=function(){var c={},p=Math.PI/180,y=180/Math.PI,M=6378137,r=20037508342789244e-9;function I(B){return Number(B)===B&&B%1!==0}function k(B){if(B=B||{},this.size=B.size||256,this.expansion=B.antimeridian===!0?2:1,!c[this.size]){var U=this.size,H=c[this.size]={};H.Bc=[],H.Cc=[],H.zc=[],H.Ac=[];for(var Y=0;Y<30;Y++)H.Bc.push(U/360),H.Cc.push(U/(2*Math.PI)),H.zc.push(U/2),H.Ac.push(U),U*=2}this.Bc=c[this.size].Bc,this.Cc=c[this.size].Cc,this.zc=c[this.size].zc,this.Ac=c[this.size].Ac}return k.prototype.px=function(B,U){if(I(U)){var H=this.size*Math.pow(2,U),Y=H/2,X=H/360,Q=H/(2*Math.PI),J=H,j=Math.min(Math.max(Math.sin(p*B[1]),-.9999),.9999),oe=Y+B[0]*X,ce=Y+.5*Math.log((1+j)/(1-j))*-Q;return oe>J*this.expansion&&(oe=J*this.expansion),ce>J&&(ce=J),[oe,ce]}else{var Y=this.zc[U],j=Math.min(Math.max(Math.sin(p*B[1]),-.9999),.9999),oe=Math.round(Y+B[0]*this.Bc[U]),ce=Math.round(Y+.5*Math.log((1+j)/(1-j))*-this.Cc[U]);return oe>this.Ac[U]*this.expansion&&(oe=this.Ac[U]*this.expansion),ce>this.Ac[U]&&(ce=this.Ac[U]),[oe,ce]}},k.prototype.ll=function(B,U){if(I(U)){var H=this.size*Math.pow(2,U),Y=H/360,X=H/(2*Math.PI),Q=H/2,J=(B[1]-Q)/-X,j=(B[0]-Q)/Y,oe=y*(2*Math.atan(Math.exp(J))-.5*Math.PI);return[j,oe]}else{var J=(B[1]-this.zc[U])/-this.Cc[U],j=(B[0]-this.zc[U])/this.Bc[U],oe=y*(2*Math.atan(Math.exp(J))-.5*Math.PI);return[j,oe]}},k.prototype.bbox=function(B,U,H,Y,X){Y&&(U=Math.pow(2,H)-1-U);var Q=[B*this.size,(+U+1)*this.size],J=[(+B+1)*this.size,U*this.size],j=this.ll(Q,H).concat(this.ll(J,H));return X==="900913"?this.convert(j,"900913"):j},k.prototype.xyz=function(B,U,H,Y){Y==="900913"&&(B=this.convert(B,"WGS84"));var X=[B[0],B[1]],Q=[B[2],B[3]],J=this.px(X,U),j=this.px(Q,U),oe=[Math.floor(J[0]/this.size),Math.floor((j[0]-1)/this.size)],ce=[Math.floor(j[1]/this.size),Math.floor((J[1]-1)/this.size)],pe={minX:Math.min.apply(Math,oe)<0?0:Math.min.apply(Math,oe),minY:Math.min.apply(Math,ce)<0?0:Math.min.apply(Math,ce),maxX:Math.max.apply(Math,oe),maxY:Math.max.apply(Math,ce)};if(H){var Ae={minY:Math.pow(2,U)-1-pe.maxY,maxY:Math.pow(2,U)-1-pe.minY};pe.minY=Ae.minY,pe.maxY=Ae.maxY}return pe},k.prototype.convert=function(B,U){return U==="900913"?this.forward(B.slice(0,2)).concat(this.forward(B.slice(2,4))):this.inverse(B.slice(0,2)).concat(this.inverse(B.slice(2,4)))},k.prototype.forward=function(B){var U=[M*B[0]*p,M*Math.log(Math.tan(Math.PI*.25+.5*B[1]*p))];return U[0]>r&&(U[0]=r),U[0]<-20037508342789244e-9&&(U[0]=-20037508342789244e-9),U[1]>r&&(U[1]=r),U[1]<-20037508342789244e-9&&(U[1]=-20037508342789244e-9),U},k.prototype.inverse=function(B){return[B[0]*y/M,(Math.PI*.5-2*Math.atan(Math.exp(-B[1]/M)))*y]},k}();t.exports=a}(m2)),m2.exports}var gQ=mQ();const _Q=Im(gQ);var vQ=Object.defineProperty,yQ=Object.defineProperties,xQ=Object.getOwnPropertyDescriptors,kL=Object.getOwnPropertySymbols,bQ=Object.prototype.hasOwnProperty,wQ=Object.prototype.propertyIsEnumerable,FL=(t,e,a)=>e in t?vQ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,kr=(t,e)=>{for(var a in e||(e={}))bQ.call(e,a)&&FL(t,a,e[a]);if(kL)for(var a of kL(e))wQ.call(e,a)&&FL(t,a,e[a]);return t},mc=(t,e)=>yQ(t,xQ(e)),HR=(t,e,a)=>{if(!e.has(t))throw TypeError("Cannot "+a)},me=(t,e,a)=>(HR(t,e,"read from private field"),a?a.call(t):e.get(t)),Wt=(t,e,a)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,a)},ii=(t,e,a,c)=>(HR(t,e,"write to private field"),e.set(t,a),a),z0=(t,e,a)=>(HR(t,e,"access private method"),a),Iy=(t,e,a)=>new Promise((c,p)=>{var y=I=>{try{r(a.next(I))}catch(k){p(k)}},M=I=>{try{r(a.throw(I))}catch(k){p(k)}},r=I=>I.done?c(I.value):Promise.resolve(I.value).then(y,M);r((a=a.apply(t,e)).next())}),NL=document.implementation.createHTMLDocument();function S_(t,e){const a={};for(const[c,p]of Object.entries(e))a[c]=t.querySelector(p);return a}function SQ(t){return Array.from(t.childNodes||[]).filter(e=>e.nodeType===Node.ELEMENT_NODE)}function _c(t){const e=document.createElement("template");return e.innerHTML=t,e.content.firstElementChild}function EQ(t){const e=NL.createElement("style");return e.textContent=t,NL.head.appendChild(e),e.sheet}function MQ(t){return window.getComputedStyle(t).display!=="none"}function ud(t,e){if(!t)return;Object.getOwnPropertyDescriptor(t.constructor.prototype,"value").set.call(t,e);const c=t;c._valueTracker&&c._valueTracker.setValue("");const p=new Event("input",{bubbles:!0});p.simulated=!0,t.dispatchEvent(p);const y=new Event("change",{bubbles:!0});y.simulated=!0,t.dispatchEvent(y)}function fN(t,e=!1){let a,c;const p=t.getBoundingClientRect();if(t.style.display==="none"||p.height===0&&p.width===0){const y=t.cloneNode(e);t.parentElement.appendChild(y),y.style.setProperty("display","block","important");const M=y.getBoundingClientRect();a=M.width,c=M.height,y.style.setProperty("display","none"),y.remove()}else a=p.width,c=p.height;return{height:Math.floor(c),width:Math.floor(a)}}function TQ(t){const e=document.createElement("style");e.innerHTML=t,document.head.appendChild(e)}var AQ=new RegExp("[_a-zA-Z]+[_a-zA-Z0-9-]*","g"),CQ=new RegExp(`\\.${AQ.source}`,"g"),RQ=new RegExp("^\\s*(@(?:media|supports)[^{]*){(.*)}\\s*$");function bw(t,e){return t.replace(CQ,a=>"."+e(a.slice(1)))}function pN(t,e){const c=EQ(t).cssRules;function p(M){if(M instanceof CSSStyleRule)return`${bw(M.selectorText,e)} { ${M.style.cssText} }`;const r=RQ.exec(M.cssText.split(`
`).join(""));if(r&&r.length>2){const I=r[1],k=r[2];return`${I} { ${pN(k,e)} }`}return M.cssText}let y="";for(const M of Array.from(c))y+=p(M)+`

`;return y.trim()}function BL(t,e){const a=Array.from(t.querySelectorAll("[class]"));a.push(t);for(const c of a){const{classList:p}=c;for(const y of Array.from(p))p.remove(y),p.add(e(y))}return t}var qR=1.4;function mN(t,e,a=.5){const{center:c,zoom:p}=t.cameraForBounds(e),y=Math.max(p-a,0);return{center:c,zoom:y,speed:qR}}function gN(t){switch(t){case"street":return 15;case"neighborhood":case"postcode":case"locality":case"oaza":return 14;case"place":case"city":return 13;case"district":return 9;case"region":case"prefecture":return 6;case"country":return 4;default:return 16}}function _N(t,e){return`https://api.mapbox.com/styles/v1/${t}/${e}/static/`}var WR='<svg viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.8 3.8a1 1 0 0 1 1.4 0L9 7.58l3.8-3.8a1 1 0 1 1 1.4 1.42L10.42 9l3.8 3.8a1 1 0 0 1-1.42 1.4L9 10.42l-3.8 3.8a1 1 0 0 1-1.4-1.42L7.58 9l-3.8-3.8a1 1 0 0 1 0-1.4Z" fill="currentColor"/></svg>',vN='<svg viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/></svg>',IQ=_N("mapbox","satellite-streets-v11"),DQ="20d01",PQ=["mapbox.com","mapbox.cn","tilestream.net"],LQ=_c(`
<template>
  <div class="MapboxSearch">
    <div class="Label" role="label" aria-live="polite" aria-atomic="true">
    </div>
    <div class="Results" aria-hidden="true">
      <div class="ResultsList" role="listbox">
      </div>
      <div class="ResultsAttribution" aria-hidden="true">
        <a href="https://www.mapbox.com/search-service" target="_blank" tabindex="-1">
          Powered by Mapbox
        </a>
      </div>
    </div>
  </div>
</template>
`),OQ=_c(`
<template>
  <div class="Suggestion" role="option" tabindex="-1">
    <div class="SuggestionIcon" aria-hidden="true"></div>
    <div class="SuggestionText">
      <div class="SuggestionName"></div>
      <div class="SuggestionDesc"></div>
    </div>
  </div>
</template>
`),zQ=_c(`
<template>
  <div class="SearchBox">
    <div class="SearchIcon"></div>
    <input class="Input" type="text" />
    <div class="ActionIcon">
      <button aria-label="Clear" class="ClearBtn" type="button">${WR}</button>
      <div class="LoadingIcon">${vN}</div>
    </div>
  </div>
</template>
`),kQ=_c(`
<template>
  <div class="Geocoder">
    <div class="SearchIcon"></div>
    <input class="Input" type="text" />
    <div class="ActionIcon">
      <button aria-label="Clear" class="ClearBtn" type="button">${WR}</button>
      <div class="LoadingIcon">${vN}</div>
    </div>
  </div>
</template>
`);function c_(){return"mbx"+new pu().id.slice(0,8)}function Dy(t){try{return JSON.parse(t)}catch{return null}}function $R(t,e){if(t==null||e==null||typeof t!="object"||typeof e!="object")return t===e;const a=Object.keys(t),c=Object.keys(e);if(a.length!==c.length)return!1;for(const p of a)if(!$R(t[p],e[p]))return!1;return!0}function UL(t,e){const a=Math.pow(10,e);return Math.round(t*a)/a}function FQ(t){return!!t.match(/localhost|[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}|::1|\.local|^$/gi)}function NQ(t){return!!PQ.some(e=>t.includes(e))}var u0,Yv,Kv,Om=class extends HTMLElement{constructor(){super(...arguments),Wt(this,u0,c_()),Wt(this,Yv,void 0),Wt(this,Kv,t=>`${me(this,u0)}--${t}`)}get template(){return null}get templateStyle(){return null}get templateUserStyle(){return null}clonedCallback(t,e){const a=y=>y.replace(t,e);BL(this,a);const c=Array.from(this.querySelectorAll("style"));for(const y of c)y.textContent=bw(y.textContent,a);c.length&&ii(this,Yv,c[c.length-1]);const p=Array.from(this.querySelectorAll(`[id^="${t}"]`));for(const y of p)y.id=y.id.replace(t,e)}connectedCallback(){if(this.childElementCount>0){const c=this.dataset.seed,p=me(this,u0);c&&c!==p&&(this.clonedCallback(c,p),this.dataset.seed=p);return}this.dataset.seed=me(this,u0);const t=this.template;if(t){const c=this.prepareTemplate(t);this.appendChild(c)}const e=this.templateStyle;if(e){const c=document.createElement("style");c.textContent=this.prepareCSS(e),this.appendChild(c)}const a=document.createElement("style");this.templateUserStyle&&(a.textContent=this.prepareCSS(this.templateUserStyle)),this.appendChild(a),ii(this,Yv,a)}prepareTemplate(t){const e=t.content.firstElementChild;return BL(e.cloneNode(!0),me(this,Kv))}prepareCSS(t){return pN(t,me(this,Kv))}updateTemplateUserStyle(t){me(this,Yv)&&(me(this,Yv).textContent=this.prepareCSS(t))}querySelector(t){return super.querySelector(bw(t,me(this,Kv)))}querySelectorAll(t){return super.querySelectorAll(bw(t,me(this,Kv)))}addEventListener(t,e,a){super.addEventListener(t,e,a)}removeEventListener(t,e,a){super.removeEventListener(t,e,a)}dispatchEvent(t){return super.dispatchEvent(t)}};u0=new WeakMap;Yv=new WeakMap;Kv=new WeakMap;var BQ='<?xml version="1.0" encoding="UTF-8" standalone="yes"?><svg viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9 16A7 7 0 1 0 9 2a7 7 0 0 0 0 14ZM6.88 4.88a2.58 2.58 0 0 1 1.83-.75h1.08a2.58 2.58 0 0 1 2.59 2.58v.16c0 1-.53 1.94-1.4 2.46l-.56.34c-.27.16-.45.42-.52.71-.03.14-.14.25-.28.25H8.38a.23.23 0 0 1-.24-.25c.08-.91.59-1.74 1.38-2.21l.56-.34c.34-.2.54-.57.54-.96V6.7a.83.83 0 0 0-.83-.83H8.71a.83.83 0 0 0-.84.83v.18a.87.87 0 1 1-1.75 0V6.7c0-.69.28-1.34.76-1.83ZM10 13a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" fill="currentColor"/></svg>',UQ='<svg width="48" height="56" fill="none" xmlns="http://www.w3.org/2000/svg"><g filter="url(#a)"><path d="m24 50.4 13.79-14.12a18.82 18.82 0 0 0 4.23-20.86 19.23 19.23 0 0 0-7.19-8.6 19.76 19.76 0 0 0-21.66 0c-3.21 2.11-5.71 5.1-7.19 8.6a18.82 18.82 0 0 0 4.23 20.86L24 50.4Z" fill="currentColor"/><path d="M37.26 35.75 24 49.34 10.75 35.76l-.01-.01A18.07 18.07 0 0 1 6.68 15.7a18.48 18.48 0 0 1 6.9-8.26 19 19 0 0 1 20.84 0 18.48 18.48 0 0 1 6.9 8.26 18.07 18.07 0 0 1-4.06 20.04Z" stroke="#fff" stroke-width="1.5"/></g><circle cx="24" cy="22.45" fill="#fff" r="5.85"/><defs><filter id="a" x=".5" y=".6" width="47" height="54.8" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"/><feColorMatrix in="SourceAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dy="1"/><feGaussianBlur stdDeviation="2"/><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.2 0"/><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_17_871"/><feBlend in="SourceGraphic" in2="effect1_dropShadow_17_871" result="shape"/></filter></defs></svg>',VQ=`<svg width="24" height="24" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M1.08 14.94 5.625 3.06h1.17l-3.42 11.88H1.08Zm15.885 0L12.42 3.06h-1.17l3.42 11.88h2.295Zm-6.86-1.44H7.946l.128-2.61h1.912l.119 2.61Zm-.217-4.77H8.181l.088-1.8h1.537l.082 1.8ZM9.74 5.49h-1.4l.049-.99h1.306l.045.99Z" fill="currentColor" />
</svg>`,jQ=`<!-- TODO: I'm not sure if the way I added the circle will "scale" properly, need to check that -->
<svg width="24" height="24" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
  <path fill="none" stroke="currentColor" stroke-width="1.5" d="M4 7a5 5 0 1 1 10 0c0 3.025-3.28 6.713-5 9-1.72-2.287-5-5.975-5-9z"></path>
    <circle cx="9" cy="7" r="2" fill="currentColor"></circle>
</svg>`,GQ=`<svg viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
  <path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>
</svg>`,HQ="@mapbox/search-js-web",VE="1.0.0",qQ=`https://api.mapbox.com/search-js/v${VE}/img/style-toggle-satellite.jpg`,WQ=`https://api.mapbox.com/search-js/v${VE}/img/style-toggle-default.jpg`,$Q=767,XQ=`@media only screen and (max-width: ${$Q}px)`,XR={variables:{unit:["mobile","16px","14px"],unitHeader:["mobile","24px","18px"],minWidth:"min(300px, 100vw)",spacing:"0.75em",padding:"0.5em 0.75em",paddingFooterLabel:"0.5em 0.75em",paddingModal:"1.25em",colorText:"rgba(0, 0, 0, 0.75)",colorPrimary:"#4264FB",colorSecondary:"#667F91",colorBackground:"#fff",colorBackgroundHover:"#f5f5f5",colorBackgroundActive:"#f0f0f0",colorBackdrop:"rgba(102, 127, 145, 0.3)",border:"none",borderRadius:"4px",boxShadow:`
      0 0 10px 2px rgba(0, 0, 0, 0.05),
      0 0 6px 1px rgba(0, 0, 0, 0.1),
      0 0 0 1px rgba(0, 0, 0, 0.1)
    `,lineHeight:"1.2em",fontFamily:`
      -apple-system, BlinkMacSystemFont,
      avenir next, avenir,
      segoe ui,
      helvetica neue, helvetica,
      Ubuntu, roboto, noto, arial, sans-serif
    `,fontWeight:"normal",fontWeightSemibold:"600",fontWeightBold:"bold",duration:"150ms",curve:"ease-out"},icons:{close:WR,question:BQ,marker:UQ,street:VQ,addressMarker:jQ,search:GQ},images:{styleToggleDefault:WQ,styleToggleSatellite:qQ}};function zl(t,e={}){const a=kr(kr({},XR.variables),e.variables||{});let c=e.cssText||"",p="";for(const[y,M]of Object.entries(a)){if(!Array.isArray(M)){p+=`--${y}: ${M};`;continue}if(M[0]!=="mobile"){const k=JSON.stringify(M);throw new Error(`Unsupported expression in theme variables: ${y} ${k}`)}const[,r,I]=M;c+=`${XQ} { ${t} { --${y}: ${r} !important; } }`,p+=`--${y}: ${I};`}return c+`${t} { ${p} }`}function du(t,e={}){return kr(kr({},XR.icons),e.icons||{})[t]}function ZQ(t,e={}){return kr(kr({},XR.images),e.images||{})[t]}var Jv,XA,VL=class{constructor(t,e,a){Wt(this,Jv,void 0),Wt(this,XA,{placement:"bottom-start",flip:!1,offset:10}),this.update=()=>Iy(this,null,function*(){const c={placement:this.options.placement,middleware:[NJ(this.options.offset),this.options.flip&&FJ()].filter(Boolean)},{x:p,y}=yield HJ(this.referenceEl,this.floatingEl,c);Object.assign(this.floatingEl.style,{left:`${p}px`,top:`${y}px`})}),this.referenceEl=t,this.floatingEl=e,ii(this,Jv,kr(kr({},me(this,XA)),a)),this.destroy=GJ(this.referenceEl,this.floatingEl,this.update)}get options(){return me(this,Jv)}set options(t){ii(this,Jv,kr(kr({},me(this,Jv)),t))}};Jv=new WeakMap;XA=new WeakMap;var E_="*{box-sizing:border-box!important}[role=button]{cursor:pointer}.MapboxSearch{--width:0;display:none}.Results{background-color:var(--colorBackground);border:var(--border);border-radius:var(--borderRadius);box-shadow:var(--boxShadow);color:var(--colorText);font-family:var(--fontFamily);font-size:var(--unit);font-weight:var(--fontWeight);line-height:var(--lineHeight);min-width:var(--minWidth);overflow-y:auto;position:absolute;transform:translateZ(0);transition:visibility var(--duration);width:var(--width);z-index:1000}.Results:not([aria-hidden=true]){visibility:visible}.Results[aria-hidden=true]{animation:fadein var(--duration) var(--curve) reverse forwards;visibility:hidden}.Suggestion{align-items:center;display:flex;padding:var(--padding)}.Suggestion:hover{cursor:pointer}.Suggestion[aria-selected=true]{background-color:var(--colorBackgroundHover)}.Suggestion:active{background-color:var(--colorBackgroundActive)}.SuggestionName{font-weight:var(--fontWeightBold)}.SuggestionIcon{margin-right:6px}.SuggestionIcon[aria-hidden=true]{display:none}.ResultsAttribution{padding:var(--paddingFooterLabel)}.ResultsAttribution a{color:var(--colorSecondary)}.ResultsAttribution a:not(:hover){text-decoration:none}.ResultsList{list-style:none;margin:0;padding:0}.Label{display:none}.Geocoder,.SearchBox{background-color:var(--colorBackground);border:var(--border);border-radius:var(--borderRadius);box-shadow:var(--boxShadow);color:var(--colorText);font-family:var(--fontFamily);font-size:var(--unit);font-weight:var(--fontWeight);line-height:var(--lineHeight);padding:var(--padding);padding-bottom:0;padding-top:0;position:relative;width:100%}.SearchIcon{fill:#757575;left:.5em}.ActionIcon,.SearchIcon{bottom:0;height:20px;margin:auto 0;position:absolute;top:0;width:20px}.ActionIcon{right:.5em}.ActionIcon>button{background:none;border:none;color:inherit;cursor:pointer;font:inherit;height:100%;outline:inherit;padding:0;width:100%}.ActionIcon>button:hover{background:none!important}.ClearBtn{display:none}.ClearBtn:hover{color:#909090}.LoadingIcon{-moz-animation:rotate .8s cubic-bezier(.45,.05,.55,.95) infinite;-webkit-animation:rotate .8s cubic-bezier(.45,.05,.55,.95) infinite;animation:rotate .8s cubic-bezier(.45,.05,.55,.95) infinite;display:none;height:100%}@-webkit-keyframes rotate{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes rotate{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}.Input{background-color:transparent;border:0;color:#404040;color:rgba(0,0,0,.75);font:inherit;height:36px;margin:0;overflow:hidden;padding:0 40px;text-overflow:ellipsis;white-space:nowrap;width:100%}.Input::-ms-clear{display:none}.Input:focus{border:thin dotted;border-radius:var(--borderRadius);box-shadow:none;color:#404040;color:rgba(0,0,0,.75);outline:0}mapbox-address-confirmation-feature[aria-hidden=true],mapbox-address-confirmation-no-feature[aria-hidden=true]{display:none}.MapboxAddressConfirmation{align-items:center;background-color:var(--colorBackdrop);bottom:0;display:flex;justify-content:center;left:0;position:fixed;right:0;top:0;transform:translateZ(0);z-index:1000}.MapboxAddressConfirmation:not([aria-hidden=true]){animation:fadein var(--duration) var(--curve) forwards;visibility:visible}.MapboxAddressConfirmation[aria-hidden=true]{visibility:hidden}.ContentFeature,.ContentNoFeature{width:var(--minWidth)}.Modal{background-color:var(--colorBackground);border:var(--border);border-radius:var(--borderRadius);box-shadow:var(--boxShadow);color:var(--colorText);font-family:var(--fontFamily);font-size:var(--unit);font-weight:var(--fontWeight);line-height:var(--lineHeight);padding:var(--paddingModal);width:100%}@media screen and (max-width:480px){.MapboxAddressConfirmation{align-items:flex-end}.ContentFeature,.ContentNoFeature{width:100%}.Modal{border-bottom-left-radius:0;border-bottom-right-radius:0}}.ModalHeader{align-items:center;color:var(--colorPrimary);display:flex;font-size:var(--unitHeader);font-weight:var(--fontWeightBold);margin-bottom:var(--spacing);user-select:none;width:100%}.ModalMap{height:calc(var(--minWidth)*9/16);margin-left:calc(var(--paddingModal)*-1);width:calc(100% + var(--paddingModal)*2)}.ModalMap[aria-hidden=true]{display:none}.Icon{height:var(--unitHeader);width:var(--unitHeader)}.Icon.IconClose{color:var(--colorSecondary)}.ModalHeaderTitle{flex:1;margin-left:.25em}.ModalFooter{color:var(--colorSecondary);margin-top:var(--spacing);text-align:center}.ModalFooter[aria-hidden=true]{display:none}.ModalSubheader{font-weight:var(--fontWeightBold);user-select:none}.ModalDescription{color:var(--colorPrimary)}.ModalAddress,.ModalSubheader{margin-bottom:var(--spacing)}.ModalAddress.ModalAddressApprove{color:var(--colorPrimary)}.Button{border-radius:var(--borderRadius);cursor:pointer;font-weight:var(--fontWeightSemibold);margin-top:var(--spacing);padding:var(--padding);text-align:center;user-select:none;width:100%}.Button[aria-hidden=true]{display:none}.Button.ButtonPrimary{background-color:var(--colorPrimary);color:var(--colorBackground)}.Button.ButtonSecondary{border:1px solid var(--colorSecondary);color:var(--colorSecondary)}@keyframes fadein{0%{opacity:0}to{opacity:1}}.MapboxAddressMinimap{font-family:var(--fontFamily);font-size:var(--unit);font-weight:var(--fontWeight);line-height:var(--lineHeight)}.MapboxAddressMinimap[aria-hidden=true]{display:none}.MinimapImageContainer{border-radius:var(--borderRadius);overflow:hidden}.MinimapImage{height:unset;max-height:unset;max-width:unset;position:relative;width:unset}.MinimapInnerFrame{border:var(--border);border-radius:inherit;height:inherit;left:0;overflow:hidden;position:absolute;top:0;width:inherit}.MinimapMarker{left:50%;position:absolute;top:50%}.MinimapMarker>svg{color:var(--colorPrimary);display:block!important}.MinimapAttributionLogo{bottom:0;left:0;margin:0 0 6px 6px;position:absolute}.MinimapAttributionLogo a{cursor:pointer;display:block;height:23px;width:88px}.MinimapAttributionText{background-color:hsla(0,0%,100%,.65);bottom:0;font:11px/16px Helvetica Neue,Arial,Helvetica,sans-serif;padding:0 5px;position:absolute;right:0}.MinimapAttributionText a{color:rgba(0,0,0,.75);text-decoration:none}.MinimapAttributionText a:hover{color:inherit;text-decoration:underline}.MinimapAttributionText a:not(:first-child){margin-left:3px}.MinimapStyleToggle{background-position:0;background-repeat:no-repeat;background-size:contain;border:2px solid #fff;border-radius:3px;box-shadow:var(--boxShadow);cursor:pointer;height:2em;position:absolute;right:var(--spacing);top:var(--spacing);width:2em}.MinimapFooter{color:var(--colorSecondary);font-family:var(--fontFamily);font-size:var(--unit);margin-top:var(--spacing)}.MinimapFooter[aria-hidden=true]{display:none}.MinimapEditButtons{bottom:26px;display:flex;font-family:var(--fontFamily);position:absolute;right:var(--spacing)}.MinimapEditButtons .Button{box-shadow:var(--boxShadow)}.MinimapButtonCancel{background-color:var(--colorBackground);margin-left:var(--spacing)}.draggable{cursor:move;cursor:grab}.draggable:active{cursor:grabbing}",Aa=class extends CustomEvent{constructor(t,e){super(t,{composed:!0,detail:e})}clone(t){const e=new Aa(this.type,this.detail);return t&&Object.defineProperty(e,"target",{value:t}),e}},YQ="Type in 2 or more characters for results.",KQ="When autocomplete results are available use up and down arrows to review and enter to select. Touch device users, explore by touch or with swipe gestures.",JQ="No search results.",QQ=(t,e,a)=>`${e} ${e===1?"result is":"results are"} available. ${t}. ${a} of ${e} is selected.`,eee=t=>`${t} ${t===1?"result is":"results are"} available. Use up and down arrows to review and enter to select. Touch device users, explore by touch or with swipe gestures.`;function yN(t){const e=t.currentTarget;(t.key===" "||t.key==="Enter")&&(t.preventDefault(),t.stopPropagation(),e.dispatchEvent(new MouseEvent("click",{bubbles:!0,composed:!0})))}var xN="search-listbox__description",ZR=t=>{const e=document.createElement("div");e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.setAttribute("role","status"),e.setAttribute("style","border: 0px;clip: rect(0px, 0px, 0px, 0px);height: 1px;margin-bottom: -1px;margin-right: -1px;overflow: hidden;padding: 0px;position: absolute;white-space: nowrap;width: 1px;");const a=document.createElement("div");return a.setAttribute("id",`${t}--${xN}`),e.appendChild(a),e},jL=(t,e)=>{var a;const c=(a=document.body.querySelector(`[id="${e}--${xN}"]`))!=null?a:null;c&&(c.textContent=t)},tee=t=>{t.name=t.name+" address-search",t.setAttribute("data-lpignore","true")},nee=(t,e,a)=>{let c=null;const p=!e||e.length===0;if((t==null?void 0:t.length)<2)c=YQ+" "+KQ;else if(p)c=JQ;else if(a!==void 0){const y=e[a],M=y.name||y.feature_name||y.properties.name;c=QQ(M,e.length,a+1)}else c=eee(e.length);return c},ZA=(t,e)=>{switch(e){case 0:return t.matching_name||t.feature_name||t.address_line1;case 2:return t.name;case 1:return t.properties.name;default:return""}},iee=(t,e)=>{switch(e){case 0:return t.description;case 2:return t.feature_type==="poi"?t.full_address:t.place_formatted;case 1:return t.properties.place_formatted;default:return""}};function g2(t,e){return`${t}-${e}`}var Hs,cl,h0,Ff,d0,ww,f0,Sw,YA,KA,bN,Ew,Mw,Tw,k0,p0,Qv,Aw,db=class extends Om{constructor(){super(...arguments),Wt(this,Sw),Wt(this,KA),this.suggestions=null,Wt(this,Hs,null),Wt(this,cl,void 0),Wt(this,h0,void 0),Wt(this,Ff,void 0),Wt(this,d0,void 0),Wt(this,ww,null),Wt(this,f0,void 0),Wt(this,Ew,{}),Wt(this,Mw,{}),Wt(this,Tw,t=>{const{Results:e}=me(this,cl),a=t.target;if(a.dataset.mapboxSuccess){delete a.dataset.mapboxSuccess;return}const c=a.value;this.renderAriaMessage(),e.setAttribute("aria-busy","true"),this.dispatchEvent(new Aa("input",{lastInput:t.data,inputText:c}))}),this.renderAriaMessage=()=>{var t;const e=nee((t=this.input)==null?void 0:t.value,this.suggestions,this.selectedIndex);jL(e,this.dataset.seed)},this.clearAriaMessage=()=>{jL("",this.dataset.seed)},this.handleSuggest=t=>{if(this.suggestions=t,(!t||t.length===0)&&this.renderAriaMessage(),!t){this.hideResults();return}z0(this,KA,bN).call(this),t.length&&z0(this,Sw,YA).call(this);const{Results:e}=me(this,cl);e.setAttribute("aria-busy","false")},this.handleError=()=>{const{Results:t}=me(this,cl);t.setAttribute("aria-busy","false"),this.hideResults()},Wt(this,k0,(t,e)=>Iy(this,null,function*(){const a=this.input;a&&(a.dataset.mapboxSuccess="true");const c={suggestion:t,selectedIndex:e};this.dispatchEvent(new Aa("select",c)),this.hideResults()})),Wt(this,p0,()=>{const t=this.input;delete t.dataset.mapboxSuccess,this.dispatchEvent(new Aa("focus")),this.renderAriaMessage(),z0(this,Sw,YA).call(this)}),Wt(this,Qv,()=>{document.activeElement!==this.input&&(this.dispatchEvent(new Aa("blur")),this.clearAriaMessage(),this.hideResults())}),this.handleArrowUp=()=>{this.selectedIndex===void 0?this.selectedIndex=this.suggestions.length-1:this.selectedIndex===0?this.selectedIndex=void 0:this.selectedIndex=Math.max(0,this.selectedIndex-1)},this.handleArrowDown=()=>{this.selectedIndex===void 0?this.selectedIndex=0:this.selectedIndex===this.suggestions.length-1?this.selectedIndex=void 0:this.selectedIndex=Math.min(this.selectedIndex+1,this.suggestions.length-1)},Wt(this,Aw,t=>{var e;if((e=this.suggestions)!=null&&e.length){if(t.key==="ArrowDown"){t.preventDefault(),this.handleArrowDown();return}if(t.key==="ArrowUp"){t.preventDefault(),this.handleArrowUp();return}if(t.key==="Escape"){this.hideResults();return}if(this.selectedIndex!==void 0){if(t.key==="Tab"){me(this,k0).call(this,this.suggestions[this.selectedIndex],this.selectedIndex);return}if(t.key==="Enter"){t.preventDefault(),me(this,k0).call(this,this.suggestions[this.selectedIndex],this.selectedIndex);return}}}})}get template(){return LQ}get templateStyle(){return E_}get templateUserStyle(){return zl(".MapboxSearch",this.theme)}get input(){return me(this,d0)}set input(t){const e=me(this,d0);e&&(e.removeEventListener("input",me(this,Tw)),e.removeEventListener("focus",me(this,p0)),e.removeEventListener("blur",me(this,Qv)),e.removeEventListener("keydown",me(this,Aw)),me(this,Hs)&&me(this,Hs).destroy()),t&&(t.addEventListener("input",me(this,Tw)),t.addEventListener("focus",me(this,p0)),t.addEventListener("blur",me(this,Qv)),t.addEventListener("keydown",me(this,Aw)),t.setAttribute("role","combobox"),t.setAttribute("aria-autocomplete","list"),t.setAttribute("aria-controls",me(this,Ff)),this.isConnected&&ii(this,Hs,new VL(t,me(this,cl).Results,this.popoverOptions))),ii(this,d0,t)}get searchService(){return me(this,ww)}set searchService(t){ii(this,ww,t)}get selectedIndex(){return me(this,f0)}set selectedIndex(t){const e=me(this,f0);ii(this,f0,t);const{ResultsList:a}=me(this,cl),c=g2(me(this,Ff),t);if(t!==void 0?(this.input.setAttribute("aria-activedescendant",c),a.setAttribute("aria-activedescendant",c)):(this.input.removeAttribute("aria-activedescendant"),a.removeAttribute("aria-activedescendant")),e!==t){const p=g2(me(this,Ff),e),y=a.querySelector(`#${p}`);if(y==null||y.removeAttribute("aria-selected"),y==null||y.setAttribute("tabindex","-1"),t!==void 0){const M=a.querySelector(`#${c}`);M==null||M.setAttribute("aria-selected","true"),M==null||M.setAttribute("tabindex","0")}}this.renderAriaMessage()}hideResults(){const{Results:t,ResultsList:e}=me(this,cl);t.setAttribute("aria-hidden","true"),this.input.setAttribute("aria-expanded","false"),e.removeAttribute("aria-activedescendant"),this.input.removeAttribute("aria-activedescendant")}renderItem(t){const e=this.prepareTemplate(OQ);return e.id=g2(me(this,Ff),t),e}fillItem(t,e,a,c){const p=t.querySelector('[class$="SuggestionIcon"]'),y=t.querySelector('[class$="SuggestionName"]'),M=t.querySelector('[class$="SuggestionDesc"]');this.searchService===0?(p.innerHTML=du(e.accuracy==="street"?"street":"addressMarker",this.theme),p.removeAttribute("aria-hidden")):p.setAttribute("aria-hidden","true"),y.textContent=M.textContent="",y.textContent=ZA(e,this.searchService),M.textContent=iee(e,this.searchService),a===this.selectedIndex?t.setAttribute("aria-selected","true"):t.removeAttribute("aria-selected"),t.setAttribute("aria-posinset",(a+1).toString()),t.setAttribute("aria-setsize",c.toString())}get theme(){return me(this,Ew)}set theme(t){ii(this,Ew,t),!(!me(this,cl)||!t)&&this.updateTemplateUserStyle(zl(".MapboxSearch",t))}get popoverOptions(){return me(this,Mw)}set popoverOptions(t){ii(this,Mw,t),me(this,Hs)&&(me(this,Hs).options=t,me(this,Hs).update())}connectedCallback(){super.connectedCallback(),this.dataSeed=this.dataset.seed,ii(this,h0,this.dataset.seed+"-Label"),ii(this,Ff,this.dataset.seed+"-ResultsList"),this.input&&this.input.setAttribute("aria-controls",me(this,Ff)),ii(this,cl,S_(this,{MapboxSearch:".MapboxSearch",Results:".Results",ResultsList:".ResultsList",Label:".Label"}));const{Results:t,ResultsList:e,Label:a}=me(this,cl);a.id=me(this,h0),e.id=me(this,Ff),e.setAttribute("aria-labelledby",me(this,h0)),t.addEventListener("blur",me(this,Qv)),!me(this,Hs)&&this.input&&ii(this,Hs,new VL(this.input,me(this,cl).Results,this.popoverOptions)),requestAnimationFrame(()=>{me(this,Hs)&&me(this,Hs).update()})}disconnectedCallback(){this.input=null;const{Results:t}=me(this,cl);t.removeEventListener("blur",me(this,Qv)),me(this,Hs)&&me(this,Hs).destroy()}focus(){document.activeElement===this.input?me(this,p0).call(this):this.input.focus()}blur(){this.input.blur()}updatePopover(){me(this,Hs)&&me(this,Hs).update()}};Hs=new WeakMap;cl=new WeakMap;h0=new WeakMap;Ff=new WeakMap;d0=new WeakMap;ww=new WeakMap;f0=new WeakMap;Sw=new WeakSet;YA=function(){if(!this.suggestions||!this.suggestions.length)return;const{Results:t,MapboxSearch:e}=me(this,cl),a=this.input.getBoundingClientRect();e.style.setProperty("--width",`${a.width}px`),e.style.setProperty("display","block"),this.input.setAttribute("aria-expanded","true"),t.removeAttribute("aria-hidden"),this.selectedIndex=void 0};KA=new WeakSet;bN=function(){const{ResultsList:t}=me(this,cl);if(!this.suggestions||!this.suggestions.length){t.innerHTML="",this.hideResults();return}const e=SQ(t);if(this.suggestions.length>e.length)for(let a=e.length;a<this.suggestions.length;a++){const c=this.renderItem(a);e.push(c),c.onmouseenter=()=>{this.selectedIndex=a},c.onmouseleave=()=>{this.selectedIndex=void 0},t.appendChild(c)}if(this.suggestions.length<e.length)for(let a=this.suggestions.length;a<e.length;a++)e[a].remove();for(let a=0;a<this.suggestions.length;a++){const c=this.suggestions[a],p=e[a];this.fillItem(p,c,a,this.suggestions.length),p.onclick=()=>{me(this,k0).call(this,c,a)}}};Ew=new WeakMap;Mw=new WeakMap;Tw=new WeakMap;k0=new WeakMap;p0=new WeakMap;Qv=new WeakMap;Aw=new WeakMap;window.MapboxSearchListbox=db;window.customElements.get("mapbox-search-listbox")||customElements.define("mapbox-search-listbox",db);var ree=new Set(["street-address","address-line1","address-line2","address-line3","address-level4","address-level3","address-level2","address-level1","country","country-name","postal-code"]),aee=new Set(["off","on","true","false"]);function wN(t){let e=t.parentNode;for(;e;){if(e instanceof HTMLFormElement)return e;e=e.parentNode}return null}function oee(t){const e=t||document;return Array.from(e.querySelectorAll('input[autocomplete~="address-line1"], input[autocomplete~="street-address"]'))}var see="section-",lee="section-default",cee="section-shipping",uee="section-billing";function YR(t){const e=Array.from(t.querySelectorAll("[autocomplete]")).filter(c=>{const p=c.tagName.toLowerCase();return p==="input"||p==="select"||p==="textarea"}),a=[];for(const c of e){if(!MQ(c))continue;const p=c.getAttribute("autocomplete")||"";if(!p||aee.has(p))continue;const y=p.toLowerCase().split(" ");if(y.length>3)continue;const M=y[y.length-1];if(!ree.has(M))continue;y.pop();let r=lee;if(y.length){const I=y[y.length-1];I==="shipping"&&(r=cee,y.pop()),I==="billing"&&(r=uee,y.pop())}if(y.length){const I=y[y.length-1];I.startsWith(see)&&(r=I)}a.push({input:c,section:r,field:M})}return a}function fb(t,e){const a=[],c=[],p=YR(t);let y=null;for(const{input:M,section:r,field:I}of p){let k=a.length-1,B=!1;if(a.length?(c[k]!==r||a[k][I])&&(B=!0):B=!0,B){if(y)break;a.push({[I]:M}),c.push(r),k++}else a[k][I]=M;M===e&&(y=a[k])}return y??{}}function SN(t,e,a){var c;const p=fb(t,e),y=[a.address_line1,a.address_line2,a.address_line3].filter(r=>!!r).join(", ");ud(p["street-address"],p["address-line2"]?a.address_line1||"":y),ud(p["address-line1"],a.address_line1||""),ud(p["address-line2"],a.address_line2||""),ud(p["address-level1"],a.address_level1||""),ud(p["address-level2"],a.address_level2||""),ud(p["address-level3"],a.address_level3||"");const M=a.country_code||((c=a.metadata)==null?void 0:c.iso_3166_1)||"";if(p.country&&p.country instanceof HTMLSelectElement){let r=p.country.querySelector("option").value;r===""&&(r=p.country.querySelectorAll("option")[1].value);const I=r===r.toUpperCase();ud(p.country,I?M.toUpperCase():M)}else ud(p.country,M);ud(p["country-name"],a.country||""),ud(p["postal-code"],a.postcode||"")}function hee(t,e){const a=fb(t,e),c={};for(const[p,y]of Object.entries(a))y!=null&&y.value&&(c[p]=y.value);return c}function EN(t){const e=[];return t["street-address"]?e.push(t["street-address"]):e.push(t["address-line1"]||""),e.push(t["address-line2"]||""),e.push(t["address-line3"]||""),e.push(t["address-level3"]||""),e.push(t["address-level2"]||""),e.push(t["address-level1"]||""),e.push(t["postal-code"]||""),t["country-name"]?e.push(t["country-name"]):e.push(t.country||""),e.filter(a=>!!a).map(a=>a.trim()).join(", ")}function MN(t,e){const a=wN(e);if(!a)return;const c=UR(t);SN(a,e,c);const p=fb(a,e);p["address-line2"]&&!c.address_line2&&p["address-line2"].focus()}function dee(t){var e;const a={},c=[t.properties.address_line1,t.properties.address_line2,t.properties.address_line3].filter(p=>!!p).join(", ");return a["street-address"]=c,a["address-line1"]=t.properties.address_line1,a["address-line2"]=t.properties.address_line2,a["address-line3"]=t.properties.address_line3,a["address-level1"]=t.properties.address_level1,a["address-level2"]=t.properties.address_level2,a["address-level3"]=t.properties.address_level3,a.country=(e=t.properties.metadata)==null?void 0:e.iso_3166_1,a["country-name"]=t.properties.country,a["postal-code"]=t.properties.postcode,a}function fee(t,e){for(const[a,c]of Object.entries(t))if(e[a]!==c)return!0;return!1}var pee=t=>t.filter((e,a,c)=>{const p=ZA(e,0);return e.accuracy!=="street"||c.findIndex(y=>p===ZA(y,0))===a}),fy=(t,e,a)=>{const y=a?e||"address-line1":"new-password";t&&(t.autocomplete=y)},mee=(t,e,a)=>{if(!t||!a)return;fy(t,e,!0);const c={properties:mc(kr({},a),{address_line1:a.address_line1+" ",postcode:null})};MN(c,t),fy(t,e,!1),t==null||t.focus()},gee=class{constructor(){this.feedbackEnabled=!0,this.autofillSessionToken=new pu,this.autofillSessionEnabled=!1,this.detectBrowserAutofillEnabled=!1}},hh=new gee;Object.defineProperty(hh,"autofillSessionToken",{configurable:!1,writable:!1});var _ee=_c(`
<template>
  <div class="MapboxAddressConfirmation" aria-hidden="true">
    <mapbox-address-confirmation-feature class="ContentFeature"></mapbox-address-confirmation-feature>
    <mapbox-address-confirmation-no-feature class="ContentNoFeature"></mapbox-address-confirmation-no-feature>
  </div>
</template>
`),Cw,cu,ey,Rw,KR=class extends Om{constructor(){super(...arguments),Wt(this,Cw,!1),Wt(this,cu,void 0),Wt(this,ey,void 0),Wt(this,Rw,{})}get template(){return _ee}get templateStyle(){return E_}get templateUserStyle(){return zl(".MapboxAddressConfirmation",this.theme)}get theme(){return me(this,Rw)}set theme(t){if(ii(this,Rw,t),!me(this,cu)||!t)return;this.updateTemplateUserStyle(zl(".MapboxAddressConfirmation",t));const{ContentFeature:e,ContentNoFeature:a}=me(this,cu);e.theme=t,a.theme=t}connectedCallback(){super.connectedCallback(),ii(this,cu,S_(this,{MapboxAddressConfirmation:".MapboxAddressConfirmation",ContentFeature:".ContentFeature",ContentNoFeature:".ContentNoFeature"}));const{MapboxAddressConfirmation:t}=me(this,cu);t.setAttribute("aria-hidden","true");const e=this.theme;if(e){const{ContentFeature:a,ContentNoFeature:c}=me(this,cu);a.theme=e,c.theme=e}}disconnectedCallback(){ii(this,ey,null)}hide(){var t;if(ii(this,Cw,!1),!me(this,cu))return;const{MapboxAddressConfirmation:e}=me(this,cu);e.setAttribute("aria-hidden","true"),(t=me(this,ey))==null||t.deactivate(),AL.off()}show(t,e,a){return Iy(this,null,function*(){var c;if(!me(this,cu))return{type:"cancel"};const{MapboxAddressConfirmation:p,ContentFeature:y,ContentNoFeature:M}=me(this,cu),{accessToken:r,minimap:I=!1,theme:k,footer:B}=e;this.theme=k,a?(y.removeAttribute("aria-hidden"),M.setAttribute("aria-hidden","true"),y.minimap=I,y.accessToken=r,y.footer=B,y.update(a,t)):(y.setAttribute("aria-hidden","true"),M.removeAttribute("aria-hidden"),M.update(t)),ii(this,Cw,!0),p.removeAttribute("aria-hidden"),AL.on();const U=a?y:M;return ii(this,ey,hQ(p,{fallbackFocus:U,escapeDeactivates:()=>(this.hide(),!0)})),(c=me(this,ey))==null||c.activate(),new Promise(H=>{const Y=U,X=Q=>{Y.removeEventListener("result",X);const J=Q.detail;this.hide(),H(J==="change"?{type:"change",feature:a}:{type:J})};Y.addEventListener("result",X)})})}tryShow(t,e){return Iy(this,null,function*(){if(!me(this,cu))return{type:"cancel"};const{accessToken:a,options:c={}}=e,p=new ZF(kr({accessToken:a},c)),y=EN(t),r=(yield p.validate(y,{sessionToken:hh.autofillSessionToken})).features[0];if(r){const I=B=>B.properties.match_code.confidence===KF.exact,{skipConfirmModal:k=I}=e;if(k(r))return{type:"nochange"}}return yield this.show(t,e,r)})}};Cw=new WeakMap;cu=new WeakMap;ey=new WeakMap;Rw=new WeakMap;window.MapboxAddressConfirmation=KR;window.customElements.get("mapbox-address-confirmation")||customElements.define("mapbox-address-confirmation",KR);var _2=new KR;function vee(t){return Iy(this,arguments,function*(e,a={}){var c;const{sections:p=[]}=a;_2.parentNode||document.body.appendChild(_2);let y={type:"nochange"};const M=oee(e),r=YR(e),I=Array.from(document.querySelectorAll("mapbox-search-listbox"));for(const k of M){if(p.length){const Q=r.find(J=>J.input===k);if(!Q||!p.includes(Q.section))continue}const B=hee(e,k),U=I.find(Q=>Q.input===k),H=U==null?void 0:U.autofillHost;if(H){const Q=H.retrieveFeature;if(Q){const J=dee(Q);if(!fee(B,J))continue}}const Y=a.accessToken||hh.accessToken,X=yield _2.tryShow(B,mc(kr({},a),{accessToken:Y}));if(X.type==="change"){const Q=fb(e,k);if((c=Q["address-line2"])!=null&&c.value&&(X.feature.properties.address_line2=Q["address-line2"].value),U)H.simulateRetrieve(X.feature);else{k.dataset.mapboxSuccess="true";const J=UR(X.feature);SN(e,k,J)}}X.type==="change"&&y.type!=="cancel"&&(y=X),X.type==="cancel"&&(y=X)}return y})}function TN(t,e,a,c,p){if(e){const y=_c(`
        <span>
          <span></span>
          <br />
          <span></span>
        </span>
      `),[M,r]=Array.from(y.querySelectorAll("span > span"));if(a&&c)M.textContent=a,r.textContent=c;else{const I=e.split(",");M.textContent=I[0].trim(),r.textContent=I.slice(1).join(",").trim()}if(!p){if(t["address-line2"]){const I=document.createElement("span");I.textContent=t["address-line2"],y.insertBefore(I,r),y.insertBefore(document.createElement("br"),r)}if(t["address-line3"]){const I=document.createElement("span");I.textContent=t["address-line3"],y.insertBefore(I,r),y.insertBefore(document.createElement("br"),r)}}return y}else{const y=t["street-address"]||t["address-line1"]||"",M=t["address-line2"],r=t["address-line3"],I=[t["address-level4"]||"",t["address-level3"]||"",t["address-level2"]||"",`${t["address-level1"]||""} ${t["postal-code"]||""}`,t.country||t["country-name"]||""].filter(Boolean).join(", "),B=[y,M,r,I].filter(Boolean).map(H=>`<span>${H}</span>`).join("<br />");return _c(`
        <span>${B}</span>
      `)}}function yee(t,e,a,c){return Iy(this,null,function*(){if(!a)return;const p=wN(t),y=Object.values(fb(p,t));if(!e.detail.elements.some(H=>y.includes(H)))return;const M=YR(p),I=M.find(H=>H.input===t).section,k=Array.from(new Set(M.filter(H=>e.detail.elements.includes(H.input)).map(H=>H.section)));if(!k.includes(I))return;const B=typeof a=="object"&&a.sections||[];if(B.length&&!B.some(H=>k.includes(H)))return;let U=typeof a=="object"?a:{};U=mc(kr({},U),{accessToken:c,sections:[I]}),yield vee(p,U)})}var xee="https://contribute-api.mapbox.com/v1",bee="https://contribute-api-staging.tilestream.net/v1",wee="edit-suggestion";function AN(t,e){if(!hh.feedbackEnabled)return;const a=window.location.hostname,p=`${FQ(a)||NQ(a)?bee:xee}/${wee}/address?access_token=${t}`,{originalCoordinate:y,originalAddress:M,changes:r}=e,I={action:"update",reason:"incorrect_address",location:{longitude:y[0],latitude:y[1]},userEmail:"no-reply-autofill@mapbox.com",changes:r,placeName:M};fetch(p,{method:"POST",headers:new Headers({"User-Agent":`mapbox-search-js.${VE}.${navigator.userAgent}`,"Content-Type":"application/json"}),body:JSON.stringify(I)})}var See=_c(`
<template>
  <div class="MapboxAddressConfirmationFeature">
    <div class="Modal" aria-modal="true" role="dialog">
      <div class="ModalHeader">
        <svg viewBox="0 0 18 18" class="Icon IconQuestion"></svg>
        <div class="ModalHeaderTitle">Did you mean?</div>
        <svg
          viewBox="0 0 18 18"
          class="Icon IconClose"
          tabindex="0"
          role="button"
          title="Close"
          aria-label="Close"
          aria-expanded="true"
        ></svg>
      </div>

      <div class="ModalAddress ModalAddressApprove"></div>
            
      <div class="ModalMap">
        <mapbox-address-minimap class="Minimap"></mapbox-address-minimap>
      </div>

      <div
        class="Button ButtonPrimary ButtonApprove"
        tabindex="0"
        role="button"
        aria-label="Yes"
      >
        Yes
      </div>
      
      <div
        class="Button ButtonSecondary ButtonReject"
        tabindex="0"
        role="button"
        aria-label="No, use the address I provided"
      >
        No, use the address I provided
      </div>

      <div class="ModalFooter">
          Your confirmation helps improve address data accuracy.
      </div>
    </div>
  </div>
</template>
`),Nf,Iw,m0,Dw,Pw,Lw,Ow,zw,CN=class extends Om{constructor(){super(...arguments),Wt(this,Nf,void 0),Wt(this,Iw,{}),this.minimap=!1,Wt(this,m0,void 0),Wt(this,Dw,void 0),this.update=(t,e)=>{var a;ii(this,m0,t),ii(this,Dw,e);const{ModalMap:c,Minimap:p,ModalAddressApprove:y}=me(this,Nf);if(this.minimap){if(c.removeAttribute("aria-hidden"),p.accessToken=this.accessToken,typeof this.minimap=="object"){const{defaultMapStyle:r,theme:I,mapStyleMode:k,satelliteToggle:B}=this.minimap;r&&(p.defaultMapStyle=this.minimap.defaultMapStyle),I&&(p.theme=this.minimap.theme),k&&(p.mapStyleMode=k),B!==void 0&&(p.satelliteToggle=B)}p.feature=t}else c.setAttribute("aria-hidden","true");const M=t.properties.place_name||t.properties.full_address||t.properties.address;y.innerHTML="",y.appendChild(TN(e,M,t.properties.feature_name,t.properties.description,((a=t.properties.place_type)==null?void 0:a[0])==="secondary_address"))},Wt(this,Pw,()=>{this.dispatchEvent(new Aa("result","cancel"))}),this.approve=()=>{this.dispatchEvent(new Aa("result","change"))},this.reject=()=>{this.dispatchEvent(new Aa("result","nochange")),AN(this.accessToken,{originalCoordinate:me(this,m0).geometry.coordinates,originalAddress:me(this,m0).properties.full_address,changes:{address:EN(me(this,Dw))}})},Wt(this,Lw,c_()),Wt(this,Ow,c_()),Wt(this,zw,c_())}get template(){return See}get templateStyle(){return E_}get templateUserStyle(){return zl(".MapboxAddressConfirmationFeature",this.theme)}get theme(){return me(this,Iw)}set theme(t){if(ii(this,Iw,t),!me(this,Nf)||!t)return;this.updateTemplateUserStyle(zl(".MapboxAddressConfirmationFeature",t));const{IconQuestion:e,IconClose:a}=me(this,Nf);e.innerHTML=du("question",t),a.innerHTML=du("close",t)}set footer(t){if(t===void 0)return;const e=this.querySelector(".ModalFooter");typeof t=="string"?(e.textContent=t,e.removeAttribute("aria-hidden")):t?e.removeAttribute("aria-hidden"):e.setAttribute("aria-hidden","true")}connectedCallback(){super.connectedCallback(),ii(this,Nf,S_(this,{MapboxAddressConfirmationFeature:".MapboxAddressConfirmationFeature",Modal:".Modal",ModalHeaderTitle:".ModalHeaderTitle",ModalMap:".ModalMap",Minimap:".Minimap",IconQuestion:".IconQuestion",IconClose:".IconClose",ButtonApprove:".ButtonApprove",ButtonReject:".ButtonReject",ModalAddressApprove:".ModalAddressApprove"}));const{Modal:t,ModalHeaderTitle:e,IconClose:a,ButtonApprove:c,ButtonReject:p,ModalAddressApprove:y}=me(this,Nf);t.setAttribute("aria-labelledby",me(this,Ow)),t.setAttribute("aria-describedby",me(this,zw)),a.setAttribute("aria-controls",me(this,Lw)),t.id=me(this,Lw),e.id=me(this,Ow),y.id=me(this,zw);const M=Array.from(this.querySelectorAll('[role="button"]'));for(const I of M)I.addEventListener("keydown",yN);a.addEventListener("click",me(this,Pw)),c.addEventListener("click",this.approve),p.addEventListener("click",this.reject);const r=this.theme;if(r){const{IconQuestion:I,IconClose:k}=me(this,Nf);I.innerHTML=du("question",r),k.innerHTML=du("close",r)}}disconnectedCallback(){const{IconClose:t,ButtonApprove:e}=me(this,Nf);t.removeEventListener("click",me(this,Pw)),e.removeEventListener("click",this.approve)}};Nf=new WeakMap;Iw=new WeakMap;m0=new WeakMap;Dw=new WeakMap;Pw=new WeakMap;Lw=new WeakMap;Ow=new WeakMap;zw=new WeakMap;window.MapboxAddressConfirmationFeature=CN;window.customElements.get("mapbox-address-confirmation-feature")||customElements.define("mapbox-address-confirmation-feature",CN);var Eee=_c(`
<template>
  <div class="MapboxAddressConfirmationNoFeature">
    <div class="Modal" aria-modal="true" role="dialog">
      <div class="ModalHeader">
        <svg viewBox="0 0 18 18" class="Icon IconQuestion"></svg>
        <div class="ModalHeaderTitle">Confirm address</div>
        <svg
          viewBox="0 0 18 18"
          class="Icon IconClose"
          tabindex="0"
          role="button"
          title="Close"
          aria-label="Close"
          aria-expanded="true"
        ></svg>
      </div>
      <div class="ModalDescription">
        We couldn't verify this address. Please check that your information is correct before continuing.
      </div>
      <br />
      <div class="ModalSubheader">
        You entered
      </div>
      <div class="ModalAddress"></div>
      <div
        class="Button ButtonPrimary"
        tabindex="0"
        role="button"
        aria-label="Use the address I provided"
      >
        Use the address I provided
      </div>
    </div>
  </div>
</template>
`),Bf,kw,Fw,Nw,Bw,Uw,RN=class extends Om{constructor(){super(...arguments),Wt(this,Bf,void 0),Wt(this,kw,{}),this.update=t=>{const{ModalAddress:e}=me(this,Bf);e.innerHTML="",e.appendChild(TN(t))},Wt(this,Fw,()=>{this.dispatchEvent(new Aa("result","cancel"))}),this.reject=()=>{this.dispatchEvent(new Aa("result","nochange"))},Wt(this,Nw,c_()),Wt(this,Bw,c_()),Wt(this,Uw,c_())}get template(){return Eee}get templateStyle(){return E_}get templateUserStyle(){return zl(".MapboxAddressConfirmationNoFeature",this.theme)}get theme(){return me(this,kw)}set theme(t){if(ii(this,kw,t),!me(this,Bf)||!t)return;this.updateTemplateUserStyle(zl(".MapboxAddressConfirmationNoFeature",t));const{IconQuestion:e,IconClose:a}=me(this,Bf);e.innerHTML=du("question",t),a.innerHTML=du("close",t)}connectedCallback(){super.connectedCallback(),ii(this,Bf,S_(this,{Modal:".Modal",ModalHeaderTitle:".ModalHeaderTitle",IconQuestion:".IconQuestion",IconClose:".IconClose",ModalAddress:".ModalAddress",ButtonReject:".Button"}));const{Modal:t,ModalHeaderTitle:e,IconClose:a,ModalAddress:c,ButtonReject:p}=me(this,Bf);t.setAttribute("aria-labelledby",me(this,Bw)),t.setAttribute("aria-describedby",me(this,Uw)),a.setAttribute("aria-controls",me(this,Nw)),t.id=me(this,Nw),e.id=me(this,Bw),c.id=me(this,Uw);const y=Array.from(this.querySelectorAll('[role="button"]'));for(const r of y)r.addEventListener("keydown",yN);a.addEventListener("click",me(this,Fw)),p.addEventListener("click",this.reject);const M=this.theme;if(M){const{IconQuestion:r,IconClose:I}=me(this,Bf);r.innerHTML=du("question",M),I.innerHTML=du("close",M)}}disconnectedCallback(){const{IconClose:t,ButtonReject:e}=me(this,Bf);t.removeEventListener("click",me(this,Fw)),e.removeEventListener("click",this.reject)}};Bf=new WeakMap;kw=new WeakMap;Fw=new WeakMap;Nw=new WeakMap;Bw=new WeakMap;Uw=new WeakMap;window.MapboxAddressConfirmationNoFeature=RN;window.customElements.get("mapbox-address-confirmation-no-feature")||customElements.define("mapbox-address-confirmation-no-feature",RN);var Mee='input:-webkit-autofill,select:-webkit-autofill,textarea:-webkit-autofill{animation-name:onbrowserautofillstart}input:not(:-webkit-autofill),select:not(:-webkit-autofill),textarea:not(:-webkit-autofill){animation-name:onbrowserautofillcancel}@keyframes onbrowserautofillstart{0%{animation-name:"onbrowserautofillstart"}to{animation-name:"onbrowserautofillstart"}}@keyframes onbrowserautofillcancel{0%{animation-name:"onbrowserautofillcancel"}to{animation-name:"onbrowserautofillcancel"}}',hE="browser-autofilled",JA=[];function Tee(){window.dispatchEvent(new window.CustomEvent("browserautofill",{bubbles:!0,cancelable:!0,detail:{elements:JA}})),JA=[]}var Aee=JF(Tee,5);function IN(t){t.hasAttribute(hE)||(t.setAttribute(hE,""),JA.push(t),Aee())}function DN(t){t.hasAttribute(hE)&&t.removeAttribute(hE)}function Cee(t){t.animationName==="onbrowserautofillstart"?IN(t.target):DN(t.target)}function Ree(t){const e=t.target;e.nodeName.toLowerCase()!=="select"&&!t.simulated&&!(t instanceof Aa)&&(t.inputType==="insertReplacementText"||!("data"in t))?IN(e):DN(e)}function Iee(){hh.detectBrowserAutofillEnabled||(hh.detectBrowserAutofillEnabled=!0,TQ(Mee),document.addEventListener("animationstart",Cee,!0),document.addEventListener("input",Ree,!0))}var JR=(t,e)=>{if(typeof t=="string")if(t==="ip"){const a=e==null?void 0:e.get("ip-proximity");return a&&typeof a=="string"?a.split(",").map(parseFloat):[999,999]}else return t.split(",").map(Number);else return _o.convert(t).toArray()},Dee=t=>{const e={};return t.bbox&&(typeof t.bbox=="string"?e.bbox=t.bbox.split(",").map(Number):e.bbox=fc.convert(t.bbox).toFlatArray()),t.proximity&&(e.proximity=JR(t.proximity)),t.country&&(e.country=t.country.split(",")),t.language&&(e.language=t.language.split(",")),t.types&&(typeof t.types=="string"?e.types=t.types.split(","):e.types=Array.from(t.types)),t.limit&&(typeof t.limit=="string"?e.limit=parseInt(t.limit):e.limit=t.limit),e},Pee=(t,e)=>{const a={};return t.bbox&&(typeof t.bbox=="string"?a.bbox=t.bbox.split(",").map(Number):a.bbox=fc.convert(t.bbox).toFlatArray()),t.proximity&&(a.proximity=JR(t.proximity,e)),t.country&&(a.country=t.country.split(",")),t.language&&(a.language=t.language.split(",")),t.types&&(typeof t.types=="string"?a.types=t.types.split(","):a.types=Array.from(t.types)),t.limit&&(typeof t.limit=="string"?a.limit=parseInt(t.limit):a.limit=t.limit),typeof t.autocomplete=="boolean"&&(a.autocomplete=t.autocomplete),t.worldview&&(a.worldview=t.worldview),t.permanent&&(a.permanent=t.permanent),a},Lee=(t,e)=>{const a={};return t.bbox&&(typeof t.bbox=="string"?a.bbox=t.bbox.split(",").map(Number):a.bbox=fc.convert(t.bbox).toFlatArray()),t.proximity&&(a.proximity=JR(t.proximity,e)),t.country&&(a.country=t.country.split(",")),t.language&&(a.language=t.language.split(",")),t.limit&&(typeof t.limit=="string"?a.limit=parseInt(t.limit):a.limit=t.limit),t.streets!==void 0&&t.streets!==null&&(typeof t.streets=="string"?a.streets=t.streets==="true":a.streets=t.streets),a},Oee=(t,e,a)=>{switch(e){case 2:return Dee(t);case 1:return Pee(t,a);case 0:return Lee(t,a)}},zee=t=>({suggestionIds:t.map(e=>e.mapbox_id||""),suggestionNames:t.map(e=>e.feature_type==="poi"?[e.name,e.full_address].filter(Boolean).join(", "):e.full_address?e.full_address:e.name),suggestionTypes:t.map(e=>e.feature_type||""),suggestionSources:t.map(()=>"mapbox")}),kee=t=>({suggestionIds:t.map(e=>e.properties.mapbox_id||e.id||""),suggestionNames:t.map(e=>e.properties.full_address||""),suggestionTypes:t.map(e=>e.properties.feature_type||""),suggestionSources:t.map(()=>"mapbox")}),Fee=t=>({suggestionIds:t.map(e=>e.mapbox_id||""),suggestionNames:t.map(e=>e.full_address||""),suggestionTypes:t.map(e=>{var a;return((a=e.place_type)==null?void 0:a[0])||""}),suggestionSources:t.map(()=>"mapbox")}),Nee=(t,e)=>{switch(e){case 2:return zee(t);case 1:return kee(t);case 0:return Fee(t)}},GL=(t,e)=>{switch(t){case 2:return"search/searchbox/v1/suggest";case 1:return`search/geocode/v6/${/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/.test(e)?"reverse":"forward"}`;case 0:return"autofill/v1/suggest"}},QA,eC,Jg,Vw,tC,Qg,g0,_0,v0,y0,nC,ty,Uf,iC,rC,aC,x0,oC,sC,lC,cC,uC,hC,b0,e_,w0,QR=class{constructor(t){Wt(this,QA,"https://api.mapbox.com"),Wt(this,eC,"events/v2"),Wt(this,Jg,void 0),Wt(this,Vw,void 0),Wt(this,tC,navigator.language||null),Wt(this,Qg,[]),Wt(this,g0,""),Wt(this,_0,0),Wt(this,v0,!0),Wt(this,y0,1e3),Wt(this,nC,100),Wt(this,ty,void 0),Wt(this,Uf,void 0),this.start=(e,a,c,p)=>{ii(this,Jg,a.accessToken);const y=me(this,x0).call(this,"search.start",{queryString:e,options:a,map:c,responseHeaders:p});y&&me(this,w0).call(this,y)},this.input=(e,a,c,p,y)=>{if(ii(this,Jg,c.accessToken),me(this,v0)&&(this.start(e,c,p,y),ii(this,v0,!1)),!a)return;const M=me(this,x0).call(this,"search.keystroke",{lastInput:a,queryString:e,options:c,map:p,responseHeaders:y});M&&me(this,w0).call(this,M)},this.select=(e,a,c,p,y,M)=>{ii(this,Jg,p.accessToken);const r=me(this,x0).call(this,"search.select",{queryString:e,selectedIndex:a,suggestions:c,options:p,map:y,responseHeaders:M});r&&(r.resultIndex===me(this,_0)&&r.queryString===me(this,g0)||r.resultIndex===-1||(ii(this,_0,r.resultIndex),ii(this,g0,r.queryString),me(this,w0).call(this,r)))},this.clear=()=>{ii(this,v0,!0),ii(this,g0,""),ii(this,_0,0),me(this,e_).call(this)},Wt(this,iC,e=>{const a=`${me(this,QA)}/${me(this,eC)}?access_token=${me(this,Jg)}`,c=me(this,rC).call(this,e);try{fetch(a,c)}catch(p){me(this,aC).call(this,p)}}),Wt(this,rC,e=>(Array.isArray(e)||(e=[e]),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})),Wt(this,aC,e=>{console.log(e)}),Wt(this,x0,(e,a)=>{if(e==="search.select"&&!(typeof a.selectedIndex=="number"||a.suggestions)||e==="search.keystroke"&&!a.lastInput)return null;const c=Oee(a.options,me(this,Uf),a.responseHeaders),p=me(this,oC).call(this,e,a,c);return e==="search.keystroke"?me(this,sC).call(this,p,a,c):e==="search.select"&&me(this,lC).call(this,p,a,c),me(this,hC).call(this,p)?p:null}),Wt(this,oC,(e,a,c)=>{let p={event:e,version:me(this,uC).call(this,e),created:+new Date,sessionIdentifier:a.options.sessionToken,userAgent:me(this,Vw),keyboardLocale:me(this,tC),queryString:a.queryString};if(c&&(p=kr(kr({},p),c)),e==="search.start")for(const y of["streets","permanent"])delete p[y];if(a.map){const y=a.map.getZoom()||void 0,M=a.map.getCenter();p=mc(kr({},p),{mapZoom:y,mapCenterLat:M.lat,mapCenterLng:M.lng})}return p}),Wt(this,sC,(e,a,c)=>{switch(me(this,Uf)){case 0:c.streets&&(e.streets=c.streets);break;case 1:c.permanent&&(e.permanent=c.permanent);break}e.path=GL(me(this,Uf),a.queryString),e.lastAction=a.lastInput}),Wt(this,lC,(e,a,c)=>{switch(me(this,Uf)){case 0:c.streets&&(e.streets=c.streets);break;case 1:c.permanent&&(e.permanent=c.permanent);break}e.path=GL(me(this,Uf),a.queryString);const{selectedIndex:p,suggestions:y}=a;if(y&&y.length>0){const M=Nee(y,me(this,Uf));e.resultIndex=p,e.resultPlaceName=M.suggestionNames[p],e.resultId=M.suggestionIds[p],e.resultId.startsWith("dXJuOm1ie")&&(e.resultMapboxId=e.resultId),e.suggestionIds=M.suggestionIds,e.suggestionNames=M.suggestionNames,e.suggestionTypes=M.suggestionTypes,e.suggestionSources=M.suggestionSources}}),Wt(this,cC,()=>`mapbox.${HQ.split("/")[1]}.${VE}.${navigator.userAgent}`),Wt(this,uC,e=>["search.keystroke","search.select"].includes(e)?"2.2":"2.0"),Wt(this,hC,e=>{if(!e||!e.event)return!1;const a=["event","created","sessionIdentifier","queryString"],c=["event","created","sessionIdentifier","queryString","lastAction"],p=["event","created","sessionIdentifier","queryString","resultIndex","path","suggestionIds"],y=e.event;return y==="search.start"?me(this,b0).call(this,e,a):y==="search.keystroke"?me(this,b0).call(this,e,c):y==="search.select"?me(this,b0).call(this,e,p):!0}),Wt(this,b0,(e,a)=>a.every(c=>c==="queryString"?typeof e[c]=="string"&&e[c].length>0:e[c]!==void 0)),Wt(this,e_,()=>{me(this,Qg).length>0&&me(this,Jg)&&(me(this,iC).call(this,me(this,Qg)),ii(this,Qg,[])),me(this,ty)&&clearTimeout(me(this,ty)),me(this,y0)&&ii(this,ty,setTimeout(me(this,e_),me(this,y0)))}),Wt(this,w0,(e,a)=>{me(this,Qg).push(e),(me(this,Qg).length>=me(this,nC)||a)&&me(this,e_).call(this)}),this.remove=()=>{me(this,e_).call(this)},ii(this,Uf,t),ii(this,Vw,me(this,cC).call(this)),ii(this,ty,setTimeout(me(this,e_),me(this,y0)))}};QA=new WeakMap;eC=new WeakMap;Jg=new WeakMap;Vw=new WeakMap;tC=new WeakMap;Qg=new WeakMap;g0=new WeakMap;_0=new WeakMap;v0=new WeakMap;y0=new WeakMap;nC=new WeakMap;ty=new WeakMap;Uf=new WeakMap;iC=new WeakMap;rC=new WeakMap;aC=new WeakMap;x0=new WeakMap;oC=new WeakMap;sC=new WeakMap;lC=new WeakMap;cC=new WeakMap;uC=new WeakMap;hC=new WeakMap;b0=new WeakMap;e_=new WeakMap;w0=new WeakMap;var hm,Cl,Rl,pa,ny,dm,S0,jw,Gw,E0,Hw,qw,Ww,$w,Xw,Zw,Yw,dC,eI=class extends Om{constructor(){super(...arguments),Wt(this,hm,new HF),Wt(this,Cl,new BR(me(this,hm))),Wt(this,Rl,void 0),Wt(this,pa,new db),Wt(this,ny,new QR(0)),Wt(this,dm,void 0),this.options={},this.confirmOnBrowserAutofill=!1,Wt(this,S0,!1),Wt(this,jw,t=>{const e=t!=null&&t.suggestions?pee(t.suggestions):null;me(this,pa).handleSuggest(e),this.dispatchEvent(new Aa("suggest",t))}),Wt(this,Gw,t=>{me(this,pa).handleError(),this.dispatchEvent(new Aa("suggesterror",t))}),Wt(this,E0,t=>{var e;if(this.dispatchEvent(new Aa("retrieve",t)),this.retrieveFeature=(e=t.features)==null?void 0:e[0],!me(this,Rl))return;const a=t;!a||!a.features||!a.features.length||MN(a.features[0],me(this,Rl))}),Wt(this,Hw,()=>{var t;try{const e=(t=this.querySelector("input"))!=null?t:null;ii(this,Rl,e),me(this,pa).input=e}catch(e){ii(this,Rl,null),me(this,pa).input=null,console.error(e.message||e)}}),Wt(this,qw,new MutationObserver(me(this,Hw))),Wt(this,Ww,t=>{me(this,pa).blur(),yee(me(this,Rl),t,this.confirmOnBrowserAutofill,this.accessToken)}),this.retrieveFeature=null,this.interceptSearch=null,Wt(this,$w,t=>{this.dispatchEvent(new Aa("input",t.detail.inputText));const{lastInput:e,inputText:a}=t.detail,c=this.browserAutofillEnabled===!0&&(a==null?void 0:a.length)<=2;if(fy(me(this,Rl),me(this,dm),c),!a){me(this,dC).call(this);return}const p=this.interceptSearch&&this.interceptSearch(a),y=this.interceptSearch?p:a;if(this.interceptSearch&&!p||(y==null?void 0:y.length)<=2){me(this,pa).handleSuggest(null);return}me(this,Cl).suggest(y,this.options),me(this,ny).input(y,e,mc(kr({},this.options),{sessionToken:me(this,Cl).sessionToken,accessToken:this.accessToken}),null,me(this,hm).responseHeaders)}),Wt(this,Xw,t=>{const{suggestion:e,selectedIndex:a}=t.detail;e.accuracy!=="street"?(fy(me(this,Rl),me(this,dm),!0),me(this,Cl).retrieve(e,this.options),me(this,ny).select(this.input.value,a,me(this,pa).suggestions,mc(kr({},this.options),{sessionToken:me(this,Cl).sessionToken,accessToken:this.accessToken}),null,me(this,hm).responseHeaders)):mee(me(this,Rl),me(this,dm),e)}),Wt(this,Zw,()=>{fy(me(this,Rl),me(this,dm),!0),me(this,Cl).abort()}),Wt(this,Yw,()=>{var t;const e=this.browserAutofillEnabled===!0&&((t=me(this,Rl).value)==null?void 0:t.length)<=2;fy(me(this,Rl),me(this,dm),e)}),Wt(this,dC,()=>{me(this,pa).handleSuggest(null),me(this,ny).clear()})}get accessToken(){return me(this,hm).accessToken}set accessToken(t){me(this,hm).accessToken=t}get input(){return me(this,Rl)}get theme(){return me(this,pa).theme}set theme(t){me(this,pa).theme=t}get popoverOptions(){return me(this,pa).popoverOptions}set popoverOptions(t){me(this,pa).popoverOptions=t}get browserAutofillEnabled(){return me(this,S0)}set browserAutofillEnabled(t){ii(this,S0,t)}connectedCallback(){var t;super.connectedCallback(),hh.autofillSessionEnabled=!0,me(this,Cl).sessionToken=hh.autofillSessionToken.id,me(this,pa).autofillHost=this,me(this,pa).searchService=0;const e=(t=this.querySelector("input"))!=null?t:null;me(this,qw).observe(this,{subtree:!0,childList:!0}),me(this,Hw).call(this),me(this,pa).addEventListener("input",me(this,$w)),me(this,pa).addEventListener("select",me(this,Xw)),me(this,pa).addEventListener("blur",me(this,Zw)),me(this,pa).addEventListener("focus",me(this,Yw)),me(this,Cl).addEventListener("suggest",me(this,jw)),me(this,Cl).addEventListener("suggesterror",me(this,Gw)),me(this,Cl).addEventListener("retrieve",me(this,E0)),document.body.appendChild(me(this,pa)),e&&(e.insertAdjacentElement("beforebegin",ZR(me(this,pa).dataSeed)),tee(e),ii(this,dm,e.autocomplete)),Iee(),window.addEventListener("browserautofill",me(this,Ww))}disconnectedCallback(){me(this,pa).remove(),me(this,pa).removeEventListener("input",me(this,$w)),me(this,pa).removeEventListener("select",me(this,Xw)),me(this,pa).removeEventListener("blur",me(this,Zw)),me(this,pa).removeEventListener("focus",me(this,Yw)),me(this,Cl).removeEventListener("suggest",me(this,jw)),me(this,Cl).removeEventListener("suggesterror",me(this,Gw)),me(this,Cl).removeEventListener("retrieve",me(this,E0)),me(this,ny).remove(),me(this,qw).disconnect(),window.removeEventListener("browserautofill",me(this,Ww))}attributeChangedCallback(t,e,a){if(t==="access-token"){me(this,hm).accessToken=a;return}if(t==="browser-autofill-enabled"){ii(this,S0,!!a);return}if(t==="theme"){this.theme=Dy(a);return}if(t==="popover-options"){this.popoverOptions=Dy(a);return}const c=t.split("-").join("_");a||delete this.options[c],this.options[c]=a}focus(){me(this,pa).focus()}simulateRetrieve(t){const e=this.input;e&&(e.dataset.mapboxSuccess="true"),me(this,pa).hideResults();const a={type:"FeatureCollection",features:[t],url:""};me(this,E0).call(this,a)}};hm=new WeakMap;Cl=new WeakMap;Rl=new WeakMap;pa=new WeakMap;ny=new WeakMap;dm=new WeakMap;S0=new WeakMap;jw=new WeakMap;Gw=new WeakMap;E0=new WeakMap;Hw=new WeakMap;qw=new WeakMap;Ww=new WeakMap;$w=new WeakMap;Xw=new WeakMap;Zw=new WeakMap;Yw=new WeakMap;dC=new WeakMap;eI.observedAttributes=["access-token","browser-autofill-enabled","theme","popover-options","css-text","language","country","bbox","limit","proximity","streets"];window.MapboxAddressAutofill=eI;window.customElements.get("mapbox-address-autofill")||customElements.define("mapbox-address-autofill",eI);var Bee={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},PN={placeholder:Bee},Uee=9,dd,iy,Il,th,fd,Pa,ry,fC,LN,ay,Kw,Jw,Qw,t_,eS,tS,M0,nS,iS,fm,rS,aS,tI=class extends Om{constructor(){super(...arguments),Wt(this,fC),Wt(this,dd,void 0),Wt(this,iy,new WF({})),Wt(this,Il,new BR(me(this,iy))),Wt(this,th,null),Wt(this,fd,void 0),Wt(this,Pa,new db),Wt(this,ry,new QR(2)),this.options={},Wt(this,ay,void 0),Wt(this,Kw,t=>{me(this,fm).call(this),me(this,Pa).handleSuggest((t==null?void 0:t.suggestions)||null),this.dispatchEvent(new Aa("suggest",t))}),Wt(this,Jw,t=>{me(this,fm).call(this),me(this,Pa).handleError(),this.dispatchEvent(new Aa("suggesterror",t))}),Wt(this,Qw,t=>{me(this,fm).call(this),this.dispatchEvent(new Aa("retrieve",t));const e=t;if(!e||!e.features.length)return;const a=UR(e.features[0]);me(this,fd).value=a.name;const c=me(this,th);if(!c)return;const p=e.features[0];if(!p)return;const y=p.properties.feature_type,M=p.properties.bbox;if(M)c.flyTo(mN(c,fc.convert(M).toFlatArray()));else{const r=p.geometry.coordinates,I=gN(y);c.flyTo({center:r,zoom:I,speed:qR})}this.marker&&this.mapboxgl&&me(this,tS).call(this,p)}),Wt(this,t_,void 0),Wt(this,eS,()=>{me(this,t_)&&(me(this,t_).remove(),ii(this,t_,null))}),Wt(this,tS,t=>{if(!me(this,th)||(me(this,eS).call(this),!t))return;const a=kr(kr({},{color:"#4668F2"}),typeof this.marker=="object"&&this.marker);ii(this,t_,new this.mapboxgl.Marker(a)),t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&me(this,t_).setLngLat(t.geometry.coordinates).addTo(me(this,th))}),this.interceptSearch=null,Wt(this,M0,t=>{this.dispatchEvent(new Aa("input",t.detail.inputText));const{lastInput:e,inputText:a}=t.detail;if(!a){me(this,rS).call(this);return}const c=this.interceptSearch&&this.interceptSearch(a),p=this.interceptSearch?c:a;if(this.interceptSearch&&!c){me(this,Pa).hideResults();return}me(this,Il).suggest(p,this.options),me(this,ry).input(p,e,mc(kr({},this.options),{sessionToken:me(this,Il).sessionToken,accessToken:this.accessToken}),me(this,th)),me(this,fm).call(this,!0)}),Wt(this,nS,t=>{const{suggestion:e,selectedIndex:a}=t.detail;me(this,Il).retrieve(e,this.options),me(this,ry).select(this.value,a,me(this,Pa).suggestions,mc(kr({},this.options),{sessionToken:me(this,Il).sessionToken,accessToken:this.accessToken}),me(this,th)),me(this,fm).call(this,!0)}),Wt(this,iS,()=>{me(this,Il).abort()}),Wt(this,fm,(t=!1)=>{t?(me(this,dd).ClearBtn.style.display="none",me(this,dd).LoadingIcon.style.display="block"):(me(this,dd).LoadingIcon.style.display="none",me(this,dd).ClearBtn.style.display=this.value?"block":"none")}),Wt(this,rS,()=>{this.value="",me(this,fm).call(this),me(this,tS).call(this,null),me(this,Pa).handleSuggest(null),me(this,ry).clear(),me(this,Il).incrementSession(),this.dispatchEvent(new Aa("clear"))}),this.marker=!0,Wt(this,aS,()=>{const t=me(this,th),e=kr({},this.options);if(t.getZoom()<=Uee){delete e.proximity,this.options=e;return}const a=t.getCenter();this.options=mc(kr({},e),{proximity:a})})}get accessToken(){return me(this,iy).accessToken}set accessToken(t){me(this,iy).accessToken=t}get value(){return me(this,fd).value}set value(t){me(this,fd).value=t||""}get input(){return me(this,fd)}get template(){return zQ}get templateStyle(){return E_}get templateUserStyle(){return zl(".SearchBox",me(this,Pa).theme)}get theme(){return me(this,Pa).theme}set theme(t){if(me(this,Pa).theme=t,!me(this,dd)||!t)return;this.updateTemplateUserStyle(zl(".SearchBox",t)),me(this,Pa).updatePopover();const{SearchIcon:e}=me(this,dd);e.innerHTML=du("search",t)}get popoverOptions(){return me(this,Pa).popoverOptions}set popoverOptions(t){me(this,Pa).popoverOptions=t}get placeholder(){return me(this,ay)||z0(this,fC,LN).call(this)}set placeholder(t){ii(this,ay,t),me(this,fd)&&(me(this,fd).placeholder=this.placeholder,me(this,fd).setAttribute("aria-label",this.placeholder))}connectedCallback(){super.connectedCallback(),ii(this,dd,S_(this,{SearchBox:".SearchBox",SearchIcon:".SearchIcon",Input:".Input",ClearBtn:".ClearBtn",LoadingIcon:".LoadingIcon"})),this.theme=kr({},this.theme);const{Input:t,ClearBtn:e}=me(this,dd);ii(this,fd,t),me(this,Pa).input=t,me(this,Pa).searchService=2,me(this,Pa).addEventListener("input",me(this,M0)),me(this,Pa).addEventListener("select",me(this,nS)),me(this,Pa).addEventListener("blur",me(this,iS)),me(this,Il).addEventListener("suggest",me(this,Kw)),me(this,Il).addEventListener("suggesterror",me(this,Jw)),me(this,Il).addEventListener("retrieve",me(this,Qw)),e.addEventListener("click",me(this,rS)),this.placeholder=me(this,ay),this.parentElement.appendChild(me(this,Pa)),t&&(t.previousElementSibling.hasAttribute("aria-live")&&t.previousElementSibling.remove(),t.insertAdjacentElement("beforebegin",ZR(me(this,Pa).dataSeed)))}disconnectedCallback(){me(this,Pa).remove(),me(this,Pa).input=null,me(this,Pa).removeEventListener("input",me(this,M0)),me(this,Pa).removeEventListener("select",me(this,nS)),me(this,Pa).removeEventListener("blur",me(this,iS)),me(this,Il).removeEventListener("suggest",me(this,Kw)),me(this,Il).removeEventListener("suggesterror",me(this,Jw)),me(this,Il).removeEventListener("retrieve",me(this,Qw)),me(this,ry).remove()}attributeChangedCallback(t,e,a){if(t==="access-token"){me(this,iy).accessToken=a;return}if(t==="theme"){this.theme=Dy(a);return}if(t==="popover-options"){this.popoverOptions=Dy(a);return}if(t==="placeholder"){this.placeholder=a;return}const c=t.split("-").join("_");a||delete this.options[c],this.options[c]=a,c==="language"&&(this.placeholder=me(this,ay))}focus(){me(this,Pa).focus()}search(t){this.value=t;const e={lastInput:t,inputText:t};me(this,M0).call(this,new Aa("input",e))}bindMap(t){me(this,th)&&me(this,th).off("moveend",me(this,aS)),t&&t.on("moveend",me(this,aS)),ii(this,th,t)}unbindMap(){this.bindMap(null)}onAdd(t){this.bindMap(t),this.remove();const e=document.createElement("div");return e.className="mapboxgl-ctrl",e.style.width="300px",e.appendChild(this),e}onRemove(){this.remove(),this.unbindMap(),me(this,eS).call(this)}getDefaultPosition(){return"top-right"}};dd=new WeakMap;iy=new WeakMap;Il=new WeakMap;th=new WeakMap;fd=new WeakMap;Pa=new WeakMap;ry=new WeakMap;fC=new WeakSet;LN=function(){if(this.options.language){const t=this.options.language.split(",")[0],e=dN.language(t),a=PN.placeholder[e];if(a)return a}return"Search"};ay=new WeakMap;Kw=new WeakMap;Jw=new WeakMap;Qw=new WeakMap;t_=new WeakMap;eS=new WeakMap;tS=new WeakMap;M0=new WeakMap;nS=new WeakMap;iS=new WeakMap;fm=new WeakMap;rS=new WeakMap;aS=new WeakMap;tI.observedAttributes=["access-token","theme","popover-options","placeholder","language","country","bbox","limit","navigation-profile","origin","proximity","eta-type","types"];window.MapboxSearchBox=tI;window.customElements.get("mapbox-search-box")||customElements.define("mapbox-search-box",tI);var Vee=9,pd,pm,Dl,nh,md,La,oy,pC,ON,sy,oS,sS,lS,n_,cS,uS,T0,hS,dS,mm,fS,pS,nI=class extends Om{constructor(){super(...arguments),Wt(this,pC),Wt(this,pd,void 0),Wt(this,pm,new CJ({})),Wt(this,Dl,new BR(me(this,pm))),Wt(this,nh,null),Wt(this,md,void 0),Wt(this,La,new db),Wt(this,oy,new QR(1)),this.options={},Wt(this,sy,void 0),Wt(this,oS,t=>{me(this,mm).call(this),me(this,La).handleSuggest((t==null?void 0:t.features)||null),this.dispatchEvent(new Aa("suggest",t))}),Wt(this,sS,t=>{me(this,mm).call(this),me(this,La).handleError(),this.dispatchEvent(new Aa("suggesterror",t))}),Wt(this,lS,t=>{me(this,mm).call(this),this.dispatchEvent(new Aa("retrieve",t));const e=t;if(!e)return;me(this,md).value=e.properties.full_address;const a=me(this,nh);if(!a)return;const c=e.properties.feature_type,p=e.properties.bbox;if(p)a.flyTo(mN(a,fc.convert(p).toFlatArray()));else{const y=e.geometry.coordinates,M=gN(c);a.flyTo({center:y,zoom:M,speed:qR})}this.marker&&this.mapboxgl&&me(this,uS).call(this,e)}),Wt(this,n_,void 0),Wt(this,cS,()=>{me(this,n_)&&(me(this,n_).remove(),ii(this,n_,null))}),Wt(this,uS,t=>{if(!me(this,nh)||(me(this,cS).call(this),!t))return;const a=kr(kr({},{color:"#4668F2"}),typeof this.marker=="object"&&this.marker);ii(this,n_,new this.mapboxgl.Marker(a)),t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&me(this,n_).setLngLat(t.geometry.coordinates).addTo(me(this,nh))}),this.interceptSearch=null,Wt(this,T0,t=>{this.dispatchEvent(new Aa("input",t.detail.inputText));const{lastInput:e,inputText:a}=t.detail;if(!a){me(this,fS).call(this);return}const c=this.interceptSearch&&this.interceptSearch(a),p=this.interceptSearch?c:a;if(this.interceptSearch&&!c){me(this,La).hideResults();return}me(this,Dl).suggest(p,this.options),me(this,oy).input(p,e,mc(kr({},this.options),{sessionToken:me(this,Dl).sessionToken,accessToken:this.accessToken}),me(this,nh),me(this,pm).responseHeaders),me(this,mm).call(this,!0)}),Wt(this,hS,t=>{const{suggestion:e,selectedIndex:a}=t.detail;me(this,Dl).retrieve(e,this.options),me(this,oy).select(this.value,a,me(this,La).suggestions,mc(kr({},this.options),{sessionToken:me(this,Dl).sessionToken,accessToken:this.accessToken}),me(this,nh),me(this,pm).responseHeaders),me(this,mm).call(this,!0)}),Wt(this,dS,()=>{me(this,Dl).abort()}),Wt(this,mm,(t=!1)=>{t?(me(this,pd).ClearBtn.style.display="none",me(this,pd).LoadingIcon.style.display="block"):(me(this,pd).LoadingIcon.style.display="none",me(this,pd).ClearBtn.style.display=this.value?"block":"none")}),Wt(this,fS,()=>{this.value="",me(this,mm).call(this),me(this,uS).call(this,null),me(this,La).handleSuggest(null),me(this,oy).clear(),me(this,Dl).incrementSession(),this.dispatchEvent(new Aa("clear"))}),this.marker=!0,Wt(this,pS,()=>{const t=me(this,nh),e=kr({},this.options);if(t.getZoom()<=Vee){delete e.proximity,this.options=e;return}const a=t.getCenter();this.options=mc(kr({},e),{proximity:a})})}get accessToken(){return me(this,pm).accessToken}set accessToken(t){me(this,pm).accessToken=t}get value(){return me(this,md).value}set value(t){me(this,md).value=t||""}get input(){return me(this,md)}get template(){return kQ}get templateStyle(){return E_}get templateUserStyle(){return zl(".Geocoder",me(this,La).theme)}get theme(){return me(this,La).theme}set theme(t){if(me(this,La).theme=t,!me(this,pd)||!t)return;this.updateTemplateUserStyle(zl(".Geocoder",t)),me(this,La).updatePopover();const{SearchIcon:e}=me(this,pd);e.innerHTML=du("search",t)}get popoverOptions(){return me(this,La).popoverOptions}set popoverOptions(t){me(this,La).popoverOptions=t}get placeholder(){return me(this,sy)||z0(this,pC,ON).call(this)}set placeholder(t){ii(this,sy,t),me(this,md)&&(me(this,md).placeholder=this.placeholder,me(this,md).setAttribute("aria-label",this.placeholder))}connectedCallback(){super.connectedCallback(),ii(this,pd,S_(this,{Geocoder:".Geocoder",SearchIcon:".SearchIcon",Input:".Input",ClearBtn:".ClearBtn",LoadingIcon:".LoadingIcon"})),this.theme=kr({},this.theme);const{Input:t,ClearBtn:e}=me(this,pd);ii(this,md,t),me(this,La).input=t,me(this,La).searchService=1,me(this,La).addEventListener("input",me(this,T0)),me(this,La).addEventListener("select",me(this,hS)),me(this,La).addEventListener("blur",me(this,dS)),me(this,Dl).addEventListener("suggest",me(this,oS)),me(this,Dl).addEventListener("suggesterror",me(this,sS)),me(this,Dl).addEventListener("retrieve",me(this,lS)),e.addEventListener("click",me(this,fS)),this.placeholder=me(this,sy),this.parentElement.appendChild(me(this,La)),t&&(t.previousElementSibling.hasAttribute("aria-live")&&t.previousElementSibling.remove(),t.insertAdjacentElement("beforebegin",ZR(me(this,La).dataSeed)))}disconnectedCallback(){me(this,La).remove(),me(this,La).input=null,me(this,La).removeEventListener("input",me(this,T0)),me(this,La).removeEventListener("select",me(this,hS)),me(this,La).removeEventListener("blur",me(this,dS)),me(this,Dl).removeEventListener("suggest",me(this,oS)),me(this,Dl).removeEventListener("suggesterror",me(this,sS)),me(this,Dl).removeEventListener("retrieve",me(this,lS)),me(this,oy).remove()}attributeChangedCallback(t,e,a){if(t==="access-token"){me(this,pm).accessToken=a;return}if(t==="theme"){this.theme=Dy(a);return}if(t==="popover-options"){this.popoverOptions=Dy(a);return}if(t==="placeholder"){this.placeholder=a;return}const c=t.split("-").join("_");a||delete this.options[c],this.options[c]=a,c==="language"&&(this.placeholder=me(this,sy))}focus(){me(this,La).focus()}search(t){this.value=t;const e={lastInput:t,inputText:t};me(this,T0).call(this,new Aa("input",e))}bindMap(t){me(this,nh)&&me(this,nh).off("moveend",me(this,pS)),t&&t.on("moveend",me(this,pS)),ii(this,nh,t)}unbindMap(){this.bindMap(null)}onAdd(t){this.bindMap(t),this.remove();const e=document.createElement("div");return e.className="mapboxgl-ctrl",e.style.width="300px",e.appendChild(this),e}onRemove(){this.remove(),this.unbindMap(),me(this,cS).call(this)}getDefaultPosition(){return"top-right"}};pd=new WeakMap;pm=new WeakMap;Dl=new WeakMap;nh=new WeakMap;md=new WeakMap;La=new WeakMap;oy=new WeakMap;pC=new WeakSet;ON=function(){if(this.options.language){const t=this.options.language.split(",")[0],e=dN.language(t),a=PN.placeholder[e];if(a)return a}return"Search"};sy=new WeakMap;oS=new WeakMap;sS=new WeakMap;lS=new WeakMap;n_=new WeakMap;cS=new WeakMap;uS=new WeakMap;T0=new WeakMap;hS=new WeakMap;dS=new WeakMap;mm=new WeakMap;fS=new WeakMap;pS=new WeakMap;nI.observedAttributes=["access-token","theme","popover-options","placeholder","autocomplete","language","country","bbox","limit","proximity","types","worldview","permanent"];window.MapboxGeocoder=nI;window.customElements.get("mapbox-geocoder")||customElements.define("mapbox-geocoder",nI);var HL=new _Q({size:512,antimeridian:!0}),Xv=1280;function qL(t,e){const{width:a,height:c}=fN(t,!0);switch(e){case"center":return[0,0];case"top":return[0,c/2];case"bottom":return[0,-1*c/2];case"left":return[a/2,0];case"right":return[-1*a/2,0];case"top-left":return[a/2,c/2];case"top-right":return[-1*a/2,c/2];case"bottom-left":return[a/2,-1*c/2];case"bottom-right":return[-1*a/2,-1*c/2]}}var mS,mC,ly,gS,_S,gC,vS,yS,_C,xS,bS,cy,vC,wS,jee=class{constructor(t,e,a,c,p,y){Wt(this,mS,void 0),Wt(this,mC,()=>{[this.anchorOffsetX,this.anchorOffsetY]=qL(this.markerElement,this.anchor),this.markerTransform={anchorX:this.anchorOffsetX,anchorY:this.anchorOffsetY}}),Wt(this,ly,{anchorX:0,anchorY:0,globalX:0,globalY:0,correctionX:0,correctionY:0}),Wt(this,gS,!1),Wt(this,_S,void 0),Wt(this,gC,r=>{this.isActive&&(r.preventDefault(),r.stopPropagation(),me(this,cy).call(this,r),window.addEventListener("pointermove",me(this,yS)),window.addEventListener("pointerup",me(this,vS)))}),Wt(this,vS,()=>{window.removeEventListener("pointermove",me(this,yS)),window.removeEventListener("pointerup",me(this,vS))}),Wt(this,yS,r=>{r.preventDefault(),r.stopPropagation();const I=this.curPointerXPos-r.pageX,k=this.curPointerYPos-r.pageY;this.markerDeltaX+=I,this.markerDeltaY-=k,this.markerDeltaX=Math.max(Math.min(this.imgElement.width/2,this.markerDeltaX),this.imgElement.width/2*-1),this.markerDeltaY=Math.max(Math.min(this.imgElement.height/2,this.markerDeltaY),this.imgElement.height/2*-1);const B=this.imgCenterPx[0]-this.imgCenterAdjustedPx[0],U=this.imgCenterPx[1]-this.imgCenterAdjustedPx[1],H=this.markerDeltaX-B,Y=this.markerDeltaY+U;this.markerTransform={globalX:H,globalY:Y},me(this,cy).call(this,r)}),Wt(this,_C,r=>{this.isActive&&(r.preventDefault(),r.stopPropagation(),me(this,cy).call(this,r),window.addEventListener("pointermove",me(this,bS)),window.addEventListener("pointerup",me(this,xS)))}),Wt(this,xS,()=>{window.removeEventListener("pointermove",me(this,bS)),window.removeEventListener("pointerup",me(this,xS))}),Wt(this,bS,r=>{r.preventDefault();let I=Math.round(this.imgContainerElement.scrollTop+(this.curPointerYPos-r.pageY));I=Math.max(Math.min(this.imgElement.height-this.imgContainerElement.clientHeight,I),0);let k=Math.round(this.imgContainerElement.scrollLeft+(this.curPointerXPos-r.pageX));k=Math.max(Math.min(this.imgElement.width-this.imgContainerElement.clientWidth,k),0),this.imgContainerElement.scrollTop=I,this.imgContainerElement.scrollLeft=k;const B=Math.round(k-(this.imgElement.width-this.imgContainerElement.clientWidth)/2),U=Math.round((this.imgElement.height-this.imgContainerElement.clientHeight)/2-I);if(this.imgCenterAdjustedPx=[this.imgCenterPx[0]+B,this.imgCenterPx[1]-U],!this.keepMarkerCentered){const H=this.markerDeltaX+B,Y=this.markerDeltaY+U;this.markerTransform={globalX:H,globalY:Y}}me(this,wS).call(this,k,I),me(this,cy).call(this,r)}),Wt(this,cy,r=>{this.curPointerXPos=r.pageX,this.curPointerYPos=r.pageY}),Wt(this,vC,()=>{const{anchorX:r,anchorY:I,globalX:k,globalY:B,correctionX:U,correctionY:H}=me(this,ly),Y=r-k+U,X=I+B+H;this.markerElement.style.transform=`translate(calc(-50% + ${Y}px), calc(-50% + ${X}px))`}),this.reCenter=()=>{const r=(this.imgElement.height-this.imgContainerElement.clientHeight)/2,I=(this.imgElement.width-this.imgContainerElement.clientWidth)/2;this.imgContainerElement.scrollTop=r,this.imgContainerElement.scrollLeft=I,this.imgCenterAdjustedPx=this.imgCenterPx,this.markerDeltaX=this.markerDeltaY=0,this.markerTransform={globalX:0,globalY:0,correctionX:0,correctionY:0}},this.handleMinimapResize=()=>{if(!this.imgElement.height||!this.imgElement.width)return;const r=this.imgCenterOffset.x,I=this.imgCenterOffset.y,k=this.imgElement.width/2-r-this.imgContainerElement.clientWidth/2,B=this.imgElement.height/2-I-this.imgContainerElement.clientHeight/2;this.imgContainerElement.scrollLeft=k,this.imgContainerElement.scrollTop=B,me(this,wS).call(this,k,B)},Wt(this,wS,(r,I)=>{const k=this.imgCenterOffset.x,B=this.imgCenterOffset.y,{correctionX:U,correctionY:H}=this.markerTransform,Y={};if(r/2<k*-1){const X=k*-1-r/2;Y.correctionX=X*2}else r<0?Y.correctionX=r:U!==0&&(Y.correctionX=0);if(I/2<B*-1){const X=B*-1-I/2;Y.correctionY=X*2}else I<0?Y.correctionY=I:H!==0&&(Y.correctionY=0);this.markerTransform=Y}),this.markerElement=a,this.imgContainerElement=t,this.imgElement=e,this.keepMarkerCentered=c,this.zoom=p,this.anchor=y,this.curPointerXPos=0,this.curPointerYPos=0,this.markerDeltaX=0,this.markerDeltaY=0,this.imgContainerElement.addEventListener("pointerdown",me(this,_C)),this.keepMarkerCentered||this.markerElement.addEventListener("pointerdown",me(this,gC)),new ResizeObserver(me(this,mC)).observe(this.markerElement)}get anchor(){return me(this,mS)}set anchor(t){ii(this,mS,t),[this.anchorOffsetX,this.anchorOffsetY]=qL(this.markerElement,t),this.markerTransform={anchorX:this.anchorOffsetX,anchorY:this.anchorOffsetY}}get markerTransform(){return me(this,ly)}set markerTransform(t){ii(this,ly,kr(kr({},me(this,ly)),t)),me(this,vC).call(this)}get isActive(){return me(this,gS)}set isActive(t){this.imgContainerElement.style.touchAction=t?"none":"",ii(this,gS,t)}get coordinate(){const t=this.keepMarkerCentered?this.imgCenterAdjustedPx:[this.imgCenterPx[0]-this.markerDeltaX,this.imgCenterPx[1]+this.markerDeltaY];if($R(t,this.imgCenterPx))return me(this,_S);{const e=HL.ll(t,this.zoom);return[UL(e[0],6),UL(e[1],6)]}}set coordinate(t){ii(this,_S,t),this.imgCenterPx=this.imgCenterAdjustedPx=HL.px(t,this.zoom)}get imgCenterOffset(){return{x:this.imgCenterPx[0]-this.imgCenterAdjustedPx[0],y:this.imgCenterPx[1]-this.imgCenterAdjustedPx[1]}}};mS=new WeakMap;mC=new WeakMap;ly=new WeakMap;gS=new WeakMap;_S=new WeakMap;gC=new WeakMap;vS=new WeakMap;yS=new WeakMap;_C=new WeakMap;xS=new WeakMap;bS=new WeakMap;cy=new WeakMap;vC=new WeakMap;wS=new WeakMap;var Gee='<svg width="88" height="23" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill-rule="evenodd"><defs><path id="g" d="M11.5 2.25a9.25 9.25 0 1 1 0 18.5 9.25 9.25 0 0 1 0-18.5zM7 15.98c-.05-.33-.83-5.8 2.23-8.87a4.4 4.4 0 0 1 3.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39a4.4 4.4 0 0 1-1.28 3.13C12.72 16.93 7 16 7 16v-.02zm8.3-5.48-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z"/><path id="b" d="M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19A3.77 3.77 0 0 1 50.86 15v3.77c0 .13-.1.23-.23.23h-1.4a.23.23 0 0 1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01.01-.01c.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4a.23.23 0 0 1-.23-.23V15a3.7 3.7 0 0 1-2.73 1.19c-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.38-.19a4.24 4.24 0 0 0-4.16 3.29 4.07 4.07 0 0 0 0 1.77 4.23 4.23 0 0 0 4.17 3.3 4.22 4.22 0 0 0 4.26-4.19 4.2 4.2 0 0 0-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18a4 4 0 0 1 3.84 3.28c.13.59.13 1.2 0 1.8a4 4 0 0 1-3.84 3.29A3.77 3.77 0 0 1 60.86 15v.77c0 .12-.1.23-.23.23h-1.4a.23.23 0 0 1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4a.23.23 0 0 1-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55a2.73 2.73 0 0 1 2.44-1.56c1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41a.23.23 0 0 1-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41a.23.23 0 0 1-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.62 0h-1.61a.27.27 0 0 1-.12-.03c-.1-.06-.13-.19-.06-.28l2.43-3.71-2.4-3.65a.21.21 0 0 1-.02-.12.2.2 0 0 1 .2-.21h1.61c.13 0 .24.06.3.17L82 10.54l1.4-2.37a.34.34 0 0 1 .3-.17h1.6l.12.03c.1.06.13.19.06.28l-2.37 3.65 2.43 3.7.01.13a.2.2 0 0 1-.2.21h-1.61a.33.33 0 0 1-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 0 1-.3.17zm-7.12-1.49A2.47 2.47 0 0 1 70.7 12a2.47 2.47 0 0 1 2.42-2.52 2.47 2.47 0 0 1 2.42 2.51 2.48 2.48 0 0 1-2.42 2.52zm-19.87 0a2.48 2.48 0 0 1-2.42-2.48v-.07a2.47 2.47 0 0 1 2.4-2.49 2.47 2.47 0 0 1 2.41 2.51 2.47 2.47 0 0 1-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51a2.47 2.47 0 0 1 2.4-2.52 2.46 2.46 0 0 1 2.41 2.48l.02.08zm18.12 2.47a2.47 2.47 0 0 1-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51a2.47 2.47 0 0 1-2.42 2.51z"/></defs><mask id="c"><rect width="100%" height="100%" fill="#fff"/><use xlink:href="#g"/><use xlink:href="#b"/></mask><g opacity=".3" stroke="#000" stroke-width="3"><circle mask="url(#c)" cx="11.5" cy="11.5" r="9.25"/><use xlink:href="#b" mask="url(#c)"/></g><g opacity=".9" fill="#fff"><use xlink:href="#g"/><use xlink:href="#b"/></g></svg>',WL=16,Hee=_c(`
<template>
  <div class="MapboxAddressMinimap" aria-hidden="true">
    <div class="MinimapImageContainer">
      <img class="MinimapImage" draggable="false"></img>
      <div class="MinimapInnerFrame">
        <div class="MinimapMarker"></div>
        <div class="MinimapAttribution">
          <div class="MinimapAttributionLogo">
            <a target="_blank" rel="noopener nofollow" href="https://www.mapbox.com/" aria-label="Mapbox logo">
              ${Gee}
            </a>
          </div>
          <div class="MinimapAttributionText">
            <a target="_blank" href='https://www.mapbox.com/about/maps/'>© Mapbox</a><a target="_blank" href='http://www.openstreetmap.org/copyright'>© OpenStreetMap</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
`),qee=_c(`
<template>
  <button type="button" class="MinimapStyleToggle"></button>
</template>
`),Wee=_c(`
<template>
  <div class="MinimapFooter">Adjust the marker on the map if it doesn't precisely match your location. This helps improve address data quality.</div>
</template>
`),yC="Adjust pin",xC="Save",bC="Cancel",$ee=_c(`
<template>
  <div class="MinimapEditButtons">
    <div class="Button ButtonPrimary MinimapButtonAdjust">${yC}</div>
    <div class="Button ButtonPrimary MinimapButtonSave" aria-hidden="true">${xC}</div>
    <div class="Button MinimapButtonCancel" aria-hidden="true">${bC}</div>
  </div>
</template>
`),SS,uy,A0,Vf,i_,gd,_d,Oa,os,ES,MS,TS,hy,AS,CS,RS,IS,DS,PS,C0,LS,OS,zS,kS,wC,SC,FS,R0,I0,NS,BS,EC,US,MC,iI=class extends Om{constructor(){super(...arguments),Wt(this,SS,!1),this.keepMarkerCentered=!1,this.markerAnchor="bottom",Wt(this,uy,!1),Wt(this,A0,!1),Wt(this,Vf,void 0),Wt(this,i_,""),Wt(this,gd,void 0),Wt(this,_d,void 0),Wt(this,Oa,void 0),Wt(this,os,void 0),Wt(this,ES,void 0),Wt(this,MS,{}),Wt(this,TS,!1),Wt(this,hy,"default"),Wt(this,AS,void 0),Wt(this,CS,void 0),Wt(this,RS,void 0),Wt(this,IS,["mapbox","streets-v11"]),Wt(this,DS,void 0),Wt(this,PS,void 0),Wt(this,C0,()=>{const{ImageContainer:t,ButtonAdjust:e,ButtonSave:a,ButtonCancel:c}=me(this,Oa);me(this,uy)?(t.classList.add(`${this.dataset.seed}--draggable`),me(this,os).isActive=!0,e.setAttribute("aria-hidden","true"),a.removeAttribute("aria-hidden"),c.removeAttribute("aria-hidden")):(t.classList.remove(`${this.dataset.seed}--draggable`),me(this,os).isActive=!1,e.removeAttribute("aria-hidden"),a.setAttribute("aria-hidden","true"),c.setAttribute("aria-hidden","true"))}),Wt(this,LS,()=>{ii(this,uy,!0),me(this,C0).call(this)}),Wt(this,OS,()=>{if(this.feature.properties.full_address&&!$R(this.feature.geometry.coordinates,me(this,os).coordinate)){const[t,e]=me(this,os).coordinate;AN(this.accessToken,{originalCoordinate:this.feature.geometry.coordinates,originalAddress:this.feature.properties.full_address,changes:{location:{longitude:t,latitude:e}}})}this.onSaveMarkerLocation&&this.onSaveMarkerLocation(me(this,os).coordinate),ii(this,uy,!1),me(this,C0).call(this)}),Wt(this,zS,()=>{me(this,os).reCenter(),ii(this,uy,!1),me(this,C0).call(this)}),Wt(this,kS,()=>{this.mapStyleMode=this.mapStyleMode==="default"?"satellite":"default"}),Wt(this,wC,()=>{me(this,A0)||me(this,os).reCenter(),ii(this,A0,!0),me(this,os)&&me(this,os).handleMinimapResize()}),Wt(this,SC,()=>{ii(this,A0,!1)}),Wt(this,FS,t=>{if(me(this,gd)===0||me(this,_d)===0)return"";const[e,a]=this.defaultMapStyle,c=_N(e,a),p=this.mapStyleMode==="default"?c:IQ,y=DQ+hh.autofillSessionToken.toString();let M=p+_o.convert(t).toArray().join(",")+","+WL+",0/"+Math.min(me(this,gd)*2,Xv)+"x"+Math.min(me(this,_d)*2,Xv)+"?access_token="+this.accessToken+"&attribution=false&logo=false";return hh.autofillSessionEnabled&&(M+=`&sku=${y}`),M}),Wt(this,R0,()=>{if(me(this,Vf)){const t=me(this,Vf).geometry.coordinates;ii(this,i_,me(this,FS).call(this,t));const{Image:e}=me(this,Oa);e.src=me(this,i_)}}),Wt(this,I0,t=>`url("${ZQ(t==="default"?"styleToggleDefault":"styleToggleSatellite",this.theme)}")`),Wt(this,NS,()=>{const{MapboxAddressMinimap:t,ImageContainer:e,Image:a}=me(this,Oa),{width:c,height:p}=fN(this.container),[y,M]=[me(this,gd),me(this,_d)];ii(this,gd,Math.min(c,Xv)),ii(this,_d,Math.min(p,Xv)),t.style.setProperty("width",`${me(this,gd)}px`),t.style.setProperty("height",`${me(this,_d)}px`),e.style.setProperty("height",`${me(this,_d)}px`),e.style.setProperty("width",`${me(this,gd)}px`);const[r,I]=[a.width,a.height];me(this,gd)>y&&me(this,gd)>r/2&&r<Xv||me(this,_d)>M&&me(this,_d)>I/2&&I<Xv?me(this,R0).call(this):me(this,os)&&me(this,os).handleMinimapResize()}),Wt(this,BS,()=>{if(this.querySelector(".MinimapFooter"))return;const e=this.prepareTemplate(Wee),a=this.querySelector(".MapboxAddressMinimap");if(!a||(a.appendChild(e),this.querySelector(".MinimapEditButtons")))return;const p=this.prepareTemplate($ee);this.querySelector(".MinimapInnerFrame").appendChild(p),ii(this,Oa,mc(kr({},me(this,Oa)),{EditButtons:this.querySelector(".MinimapEditButtons"),ButtonAdjust:this.querySelector(".MinimapButtonAdjust"),ButtonSave:this.querySelector(".MinimapButtonSave"),ButtonCancel:this.querySelector(".MinimapButtonCancel")}));const{ButtonAdjust:M,ButtonSave:r,ButtonCancel:I}=me(this,Oa);M.addEventListener("click",me(this,LS)),r.addEventListener("click",me(this,OS)),I.addEventListener("click",me(this,zS))}),Wt(this,EC,()=>{if(!me(this,Oa))return;const{EditButtons:t,ButtonAdjust:e,ButtonSave:a,ButtonCancel:c}=me(this,Oa),p=this.querySelector(".MinimapFooter");p==null||p.remove(),t==null||t.remove(),e&&(e.remove(),e.removeEventListener("click",me(this,LS))),a&&(a.remove(),a.removeEventListener("click",me(this,OS))),c&&(c.remove(),c.removeEventListener("click",me(this,zS))),delete me(this,Oa).EditButtons,delete me(this,Oa).ButtonAdjust,delete me(this,Oa).ButtonSave,delete me(this,Oa).ButtonCancel}),Wt(this,US,()=>{if(this.querySelector(".MinimapStyleToggle"))return;const e=this.prepareTemplate(qee),a=this.querySelector(".MinimapInnerFrame");a&&(a.appendChild(e),me(this,Oa).MapStyleToggle=e,e.addEventListener("click",me(this,kS)),e.style.backgroundImage=me(this,I0).call(this,this.mapStyleMode==="default"?"satellite":"default"),e.setAttribute("title",`Switch to ${this.mapStyleMode==="default"?"Satellite":"Default"}`))}),Wt(this,MC,()=>{if(!me(this,Oa))return;const{MapStyleToggle:t}=me(this,Oa);t&&(t.remove(),t.removeEventListener("click",me(this,kS)),delete me(this,Oa).MapStyleToggle)})}get canAdjustMarker(){return me(this,SS)}set canAdjustMarker(t){ii(this,SS,t),t?me(this,BS).call(this):me(this,EC).call(this)}get accessToken(){return me(this,ES)||hh.accessToken}set accessToken(t){ii(this,ES,t)}get feature(){return me(this,Vf)}set feature(t){ii(this,Vf,t),t?this.show():this.hide()}get template(){return Hee}get templateStyle(){return E_}get templateUserStyle(){return zl(".MapboxAddressMinimap",this.theme)}get satelliteToggle(){return me(this,TS)}set satelliteToggle(t){ii(this,TS,t),t?me(this,US).call(this):me(this,MC).call(this)}get theme(){return me(this,MS)}set theme(t){if(ii(this,MS,t),!me(this,Oa)||!t)return;this.updateTemplateUserStyle(zl(".MapboxAddressMinimap",t));const{Marker:e,MapStyleToggle:a}=me(this,Oa);e.innerHTML=du("marker",t),a&&(a.style.backgroundImage=me(this,I0).call(this,this.mapStyleMode==="default"?"satellite":"default"))}get adjustBtnText(){return me(this,AS)||yC}set adjustBtnText(t){ii(this,AS,t);const e=this.querySelector(".MinimapButtonAdjust");e.textContent=t||yC}get saveBtnText(){return me(this,CS)||xC}set saveBtnText(t){ii(this,CS,t);const e=this.querySelector(".MinimapButtonSave");e.textContent=t||xC}get cancelBtnText(){return me(this,RS)||bC}set cancelBtnText(t){ii(this,RS,t);const e=this.querySelector(".MinimapButtonCancel");e.textContent=t||bC}get mapStyleMode(){return me(this,hy)}set mapStyleMode(t){const e=me(this,hy);if(e===t||(ii(this,hy,t),!me(this,Oa)))return;const{MapStyleToggle:a}=me(this,Oa);a&&(a.style.backgroundImage=me(this,I0).call(this,e),a.setAttribute("title",`Switch to ${e==="satellite"?"Satellite":"Default"}`),me(this,R0).call(this))}get defaultMapStyle(){return me(this,IS)}set defaultMapStyle(t){ii(this,IS,t),me(this,R0).call(this)}get footer(){return me(this,DS)}set footer(t){ii(this,DS,t);const e=this.querySelector(".MinimapFooter");e&&(typeof t=="string"?(e.textContent=t,e.removeAttribute("aria-hidden")):t?e.removeAttribute("aria-hidden"):e.setAttribute("aria-hidden","true"))}get container(){return me(this,PS)}set container(t){t&&(t.style.position="relative",ii(this,PS,t))}show(){if(!me(this,Vf))return;const t=me(this,Vf).geometry.coordinates;me(this,os).coordinate=t,ii(this,i_,me(this,FS).call(this,t));const{MapboxAddressMinimap:e,Image:a}=me(this,Oa);a.src=me(this,i_),e.removeAttribute("aria-hidden")}hide(){const{MapboxAddressMinimap:t}=me(this,Oa);t.setAttribute("aria-hidden","true")}connectedCallback(){super.connectedCallback(),ii(this,Oa,S_(this,{MapboxAddressMinimap:".MapboxAddressMinimap",ImageContainer:".MinimapImageContainer",Image:".MinimapImage",Marker:".MinimapMarker",MapStyleToggle:".MinimapStyleToggle",EditButtons:".MinimapEditButtons",ButtonAdjust:".MinimapButtonAdjust",ButtonSave:".MinimapButtonSave",ButtonCancel:".MinimapButtonCancel"})),this.mapStyleMode=me(this,hy),this.theme=kr({},this.theme),this.canAdjustMarker&&me(this,BS).call(this),this.satelliteToggle&&me(this,US).call(this),this.container=this.parentElement,new ResizeObserver(me(this,NS)).observe(this.container),me(this,NS).call(this);const{MapboxAddressMinimap:e,ImageContainer:a,Image:c,Marker:p}=me(this,Oa);ii(this,os,new jee(a,c,p,this.keepMarkerCentered,WL,this.markerAnchor)),me(this,os).reCenter(),c.onload=me(this,wC),c.onerror=me(this,SC),c.src=me(this,i_),me(this,Vf)?e.removeAttribute("aria-hidden"):e.setAttribute("aria-hidden","true")}attributeChangedCallback(t,e,a){if(t==="access-token")this.accessToken=a;else if(t==="can-adjust-marker")this.canAdjustMarker=a==="true";else if(t==="keep-marker-centered")this.keepMarkerCentered=a==="true";else if(t==="marker-anchor"){const c=a;this.markerAnchor=c,me(this,os)&&(me(this,os).anchor=c)}else t==="satellite-toggle"&&(this.satelliteToggle=a==="true")}};SS=new WeakMap;uy=new WeakMap;A0=new WeakMap;Vf=new WeakMap;i_=new WeakMap;gd=new WeakMap;_d=new WeakMap;Oa=new WeakMap;os=new WeakMap;ES=new WeakMap;MS=new WeakMap;TS=new WeakMap;hy=new WeakMap;AS=new WeakMap;CS=new WeakMap;RS=new WeakMap;IS=new WeakMap;DS=new WeakMap;PS=new WeakMap;C0=new WeakMap;LS=new WeakMap;OS=new WeakMap;zS=new WeakMap;kS=new WeakMap;wC=new WeakMap;SC=new WeakMap;FS=new WeakMap;R0=new WeakMap;I0=new WeakMap;NS=new WeakMap;BS=new WeakMap;EC=new WeakMap;US=new WeakMap;MC=new WeakMap;iI.observedAttributes=["access-token","can-adjust-marker","keep-marker-centered","marker-anchor","satellite-toggle"];window.MapboxAddressMinimap=iI;window.customElements.get("mapbox-address-minimap")||customElements.define("mapbox-address-minimap",iI);Go.forwardRef((t,e)=>{const{accessToken:a,options:c,theme:p,popoverOptions:y,confirmOnBrowserAutofill:M,browserAutofillEnabled:r,children:I,onChange:k,onSuggest:B,onSuggestError:U,onRetrieve:H,interceptSearch:Y}=t,X=le.useRef();return le.useImperativeHandle(e,()=>({focus:()=>{if(X.current)return X.current.focus();throw new Error("AddressAutofill is not mounted")}})),le.useEffect(()=>{X.current&&(X.current.options=c)},[X.current,c]),le.useEffect(()=>{X.current&&(X.current.interceptSearch=Y)},[X.current,c]),le.useEffect(()=>{X.current&&(X.current.theme=p)},[X.current,p]),le.useEffect(()=>{X.current&&(X.current.popoverOptions=y)},[X.current,y]),le.useEffect(()=>{X.current&&(X.current.confirmOnBrowserAutofill=M)},[X.current,M]),le.useEffect(()=>{X.current&&(X.current.browserAutofillEnabled=r)},[X.current,r]),le.useEffect(()=>{const Q=X.current;if(!Q||!B)return;const J=j=>B(j.detail);return Q.addEventListener("suggest",J),()=>{Q.removeEventListener("suggest",J)}},[X.current,B]),le.useEffect(()=>{const Q=X.current;if(!Q||!U)return;const J=j=>U(j.detail);return Q.addEventListener("suggesterror",J),()=>{Q.removeEventListener("suggesterror",J)}},[X.current,U]),le.useEffect(()=>{const Q=X.current;if(!Q||!H)return;const J=j=>H(j.detail);return Q.addEventListener("retrieve",J),()=>{Q.removeEventListener("retrieve",J)}},[X.current,H]),le.useEffect(()=>{const Q=X.current;if(!Q||!k)return;const J=j=>{j.target===j.currentTarget&&k(j.detail)};return Q.addEventListener("input",J),()=>{Q.removeEventListener("input",J)}},[X.current,k]),le.useEffect(()=>{X.current&&(X.current.accessToken=a)},[X.current,a]),Go.createElement("mapbox-address-autofill",{ref:X},I)});var Xee=Go.forwardRef((t,e)=>{const{accessToken:a,options:c,theme:p,popoverOptions:y,placeholder:M,map:r,marker:I,mapboxgl:k,value:B,onChange:U,onSuggest:H,onSuggestError:Y,onRetrieve:X,onClear:Q,interceptSearch:J}=t,j=le.useRef();return le.useImperativeHandle(e,()=>({focus:()=>{if(j.current)return j.current.focus();throw new Error("SearchBox is not mounted")},search:oe=>{if(j.current)return j.current.search(oe);throw new Error("SearchBox is not mounted")}})),le.useEffect(()=>{j.current&&(j.current.options=c||{})},[j.current,c]),le.useEffect(()=>{j.current&&(j.current.interceptSearch=J)},[j.current,J]),le.useEffect(()=>{j.current&&(j.current.theme=p)},[j.current,p]),le.useEffect(()=>{j.current&&(j.current.popoverOptions=y)},[j.current,y]),le.useEffect(()=>{j.current&&(j.current.placeholder=M)},[j.current,M]),le.useEffect(()=>{j.current&&(j.current.value=B||"")},[j.current,B]),le.useEffect(()=>{const oe=j.current;if(oe)return oe.bindMap(r),()=>{oe.unbindMap()}},[j.current,r]),le.useEffect(()=>{j.current&&(j.current.marker=I)},[j.current,I]),le.useEffect(()=>{j.current&&(j.current.mapboxgl=k)},[j.current,k]),le.useEffect(()=>{const oe=j.current;if(!oe||!H)return;const ce=pe=>H(pe.detail);return oe.addEventListener("suggest",ce),()=>{oe.removeEventListener("suggest",ce)}},[j.current,H]),le.useEffect(()=>{const oe=j.current;if(!oe||!Y)return;const ce=pe=>Y(pe.detail);return oe.addEventListener("suggesterror",ce),()=>{oe.removeEventListener("suggesterror",ce)}},[j.current,Y]),le.useEffect(()=>{const oe=j.current;if(!oe||!X)return;const ce=pe=>X(pe.detail);return oe.addEventListener("retrieve",ce),()=>{oe.removeEventListener("retrieve",ce)}},[j.current,X]),le.useEffect(()=>{const oe=j.current;if(!oe||!U)return;const ce=pe=>{pe.target===pe.currentTarget&&U(pe.detail)};return oe.addEventListener("input",ce),()=>{oe.removeEventListener("input",ce)}},[j.current,U]),le.useEffect(()=>{const oe=j.current;if(!oe||!Q)return;const ce=()=>{Q()};return oe.addEventListener("clear",ce),()=>{oe.removeEventListener("clear",ce)}},[j.current,Q]),le.useEffect(()=>{j.current&&(j.current.accessToken=a)},[j.current,a]),Go.createElement("mapbox-search-box",{ref:j})});Go.forwardRef((t,e)=>{const{accessToken:a,options:c,theme:p,popoverOptions:y,placeholder:M,map:r,marker:I,mapboxgl:k,value:B,onChange:U,onSuggest:H,onSuggestError:Y,onRetrieve:X,onClear:Q,interceptSearch:J}=t,j=le.useRef();return le.useImperativeHandle(e,()=>({focus:()=>{if(j.current)return j.current.focus();throw new Error("Geocoder is not mounted")},search:oe=>{if(j.current)return j.current.search(oe);throw new Error("Geocoder is not mounted")}})),le.useEffect(()=>{j.current&&(j.current.options=c||{})},[j.current,c]),le.useEffect(()=>{j.current&&(j.current.interceptSearch=J)},[j.current,J]),le.useEffect(()=>{j.current&&(j.current.theme=p)},[j.current,p]),le.useEffect(()=>{j.current&&(j.current.popoverOptions=y)},[j.current,y]),le.useEffect(()=>{j.current&&(j.current.placeholder=M)},[j.current,M]),le.useEffect(()=>{j.current&&(j.current.value=B||"")},[j.current,B]),le.useEffect(()=>{const oe=j.current;if(oe)return oe.bindMap(r),()=>{oe.unbindMap()}},[j.current,r]),le.useEffect(()=>{j.current&&(j.current.marker=I)},[j.current,I]),le.useEffect(()=>{j.current&&(j.current.mapboxgl=k)},[j.current,k]),le.useEffect(()=>{const oe=j.current;if(!oe||!H)return;const ce=pe=>H(pe.detail);return oe.addEventListener("suggest",ce),()=>{oe.removeEventListener("suggest",ce)}},[j.current,H]),le.useEffect(()=>{const oe=j.current;if(!oe||!Y)return;const ce=pe=>Y(pe.detail);return oe.addEventListener("suggesterror",ce),()=>{oe.removeEventListener("suggesterror",ce)}},[j.current,Y]),le.useEffect(()=>{const oe=j.current;if(!oe||!X)return;const ce=pe=>X(pe.detail);return oe.addEventListener("retrieve",ce),()=>{oe.removeEventListener("retrieve",ce)}},[j.current,X]),le.useEffect(()=>{const oe=j.current;if(!oe||!U)return;const ce=pe=>{pe.target===pe.currentTarget&&U(pe.detail)};return oe.addEventListener("input",ce),()=>{oe.removeEventListener("input",ce)}},[j.current,U]),le.useEffect(()=>{const oe=j.current;if(!oe||!Q)return;const ce=()=>{Q()};return oe.addEventListener("clear",ce),()=>{oe.removeEventListener("clear",ce)}},[j.current,Q]),le.useEffect(()=>{j.current&&(j.current.accessToken=a)},[j.current,a]),Go.createElement("mapbox-geocoder",{ref:j})});const cc=10;function Zee(){const t=new zR(cc*3,cc*6,32);t.rotateX(-Math.PI/2),t.translate(0,0,cc*6);const e=new X0({color:"orange"}),a=new dc(t,e),c=new LE(cc*.8,cc*.8,cc*12,32);c.rotateX(Math.PI/2),c.translate(0,0,cc*14);const p=new X0({color:"orange"}),y=new dc(c,p),M=new a0;return M.add(a),M.add(y),M}function Yee(t,e,a,c){const p=new t$,y=fw.MercatorCoordinate.fromLngLat([t.longitude,t.latitude],0),M={translateX:y.x,translateY:y.y,translateZ:y.z,rotateX:0,rotateY:0,rotateZ:0,scale:y.meterInMercatorCoordinateUnits()},r=new hu(75,e.getCanvas().getBoundingClientRect().width/e.getCanvas().getBoundingClientRect().height,.1,1e3),I=new g_(cc,1,cc*2);I.translate(0,0,cc);const k=new u$().load(`data:image/jpg;base64,${t.thumbnail}`),B=new dc(I,new r$({map:k}));p.add(B);const U=new g_(cc*1.1,.9,cc*2.1);U.translate(0,0,cc);const H=new X0({color:Object.values(t.components).some(J=>J.quantity>0&&J.condition==="bad")?"red":"green"}),Y=new dc(U,H);p.add(Y);const X=Zee(),Q=new f$(16777215,2);return p.add(Q),{id:`image-layer-for-${t.id}`,type:"custom",renderingMode:"3d",onAdd:function(){},render:function(J,j){const oe=new Ba().makeRotationAxis(new un(1,0,0),M.rotateX),ce=new Ba().makeRotationAxis(new un(0,1,0),M.rotateY),pe=new Ba().makeRotationAxis(new un(0,0,1),M.rotateZ);B.rotation.z=-e.getBearing()*Math.PI/180,Y.rotation.z=-e.getBearing()*Math.PI/180,(c==null?void 0:c.id)===t.id?p.add(X):p.remove(X);const Ae=new Ba().fromArray(j),Ee=new Ba().makeTranslation(M.translateX,M.translateY,M.translateZ).scale(new un(M.scale,-M.scale,M.scale)).multiply(pe).multiply(oe).multiply(ce);r.projectionMatrix=Ae.multiply(Ee),a.resetState(),a.render(p,r),e.triggerRepaint()}}}const zN=t=>{const e=le.useRef(null),a=le.useRef(null),c=le.useRef({id:void 0}).current;le.useEffect(()=>{c.id=t.highlightImageId},[t.highlightImageId]);const p=le.useRef(void 0);function y(k){for(const B of k){const U=Yee(B,a.current,p.current,c);a.current.addLayer(U)}}le.useEffect(()=>{var k,B;t.style==="satellite"?(k=a.current)==null||k.setStyle("mapbox://styles/muhammedhab/cm7mnq14w00gg01qph2dn4dxw"):(B=a.current)==null||B.setStyle("mapbox://styles/muhammedhab/cm7nnypj101co01qv542d0e4b")},[t.style,a.current!==void 0]),le.useEffect(()=>{var k;(k=a.current)==null||k.flyTo({...t.initialPos,essential:!0})},[t.initialPos]),le.useEffect(()=>(e.current&&!a.current&&(fw.accessToken=gL,a.current=new fw.Map({container:e.current,style:"mapbox://styles/muhammedhab/cm7nnypj101co01qv542d0e4b",...t.initialPos,projection:"globe"}),p.current=new KK({canvas:a.current.getCanvas(),context:a.current.painter.context.gl,antialias:!0}),p.current.autoClear=!1,a.current.on("style.load",()=>{y(t.images)}),a.current.on("click",k=>{var B;console.log(`${k.lngLat.lat},${k.lngLat.lng}`),(B=t.onClick)==null||B.call(t,k.lngLat.lat,k.lngLat.lng)})),()=>{a.current&&(a.current.remove(),a.current=null)}),[]);const[M,r]=Go.useState(!1);function I(k){r(k),k?a.current.setStyle("mapbox://styles/muhammedhab/cm7mnq14w00gg01qph2dn4dxw"):a.current.setStyle("mapbox://styles/muhammedhab/cm7nnypj101co01qv542d0e4b")}return se.jsxs("div",{style:{width:"100%",height:"100%",position:"relative"},children:[t.searchBar!==!1&&se.jsx("div",{style:{position:"absolute",top:10,left:"50%",transform:"translateX(-50%)",width:"min(90%, 400px)"},children:se.jsx(Xee,{accessToken:gL,map:a.current??void 0,mapboxgl:fw,theme:{cssText:`
                        div[class*=SuggestionName] {text-align: left;}`},options:{bbox:[[-94.64418,28.950895],[-88.713677,33.075476]]},marker:!0})}),t.searchBar!==!1&&se.jsx("div",{style:{position:"absolute",bottom:20,right:20,background:"white",padding:"5px 10px",borderRadius:10},children:se.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",gap:10},children:["Satellite View ",se.jsx("input",{type:"checkbox",checked:M,className:"toggle",onChange:k=>I(k.target.checked)})]})}),se.jsx("div",{ref:e,style:{height:"100%"}}),t.searchBar!==!1&&se.jsxs("div",{style:{position:"absolute",top:50,left:"50%",transform:"translateX(-50%)",background:"rgba(0, 0, 0, 0.7)",color:"white",padding:"10px",borderRadius:10,zIndex:10,width:"max-content",maxWidth:"calc(100% - 20px)"},children:[se.jsx("p",{style:{margin:0},children:"The locations shown are for demonstration purposes only as there was not enough real location data."}),se.jsx("p",{style:{margin:"5px 0 0"},children:"Tip: Click on an image for more details!"}),se.jsx("button",{style:{border:"none",background:"white",color:"black",padding:"5px 10px",fontSize:"12px",borderRadius:5,cursor:"pointer",marginTop:"10px"},onClick:k=>k.currentTarget.parentElement.style.display="none",children:"Close"})]})]})},Kee=t=>{switch(t.toLowerCase()){case"good":return"bg-green-500";case"fair":return"bg-yellow-500";case"poor":return"bg-orange-500";case"bad":return"bg-red-500";default:return"bg-gray-500"}},kN=({pole:t})=>se.jsxs(LW,{className:"sm:max-w-2xl ",children:[se.jsxs(OW,{children:[se.jsxs(kW,{children:["Component Status for Pole #",t.id]}),se.jsx(FW,{children:"Detailed overview of all components and their current status."})]}),se.jsxs(xd,{className:"w-full shadow",children:[se.jsxs(qS,{className:"text-xl font-bold text-center",children:["Components Status Pole #",t.id]}),se.jsxs(yE,{className:"p-6",children:[se.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[se.jsx("img",{src:`/api/images/${t.id}/data`,style:{width:"100%",height:"100%"}}),se.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[se.jsx("img",{src:`/api/images/${t.id}/data`}),se.jsx("p",{style:{top:0,left:0,width:"100%",lineHeight:"12px",textTransform:"capitalize",height:"100%",overflow:"hidden",position:"absolute",padding:5,color:"orange",textShadow:"-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000",fontWeight:"bold"},children:Object.entries(t.components).filter(([,e])=>e.quantity>0).map(([e,a])=>se.jsxs(se.Fragment,{children:[se.jsxs("span",{style:{margin:0},children:[e," (",a.quantity,") - "]}),se.jsx("span",{style:{margin:0,color:{bad:"oklch(0.637 0.237 25.331)",good:"oklch(0.723 0.219 149.579)",unknown:"oklch(0.551 0.027 264.364)"}[a.condition]??"white"},children:a.condition}),se.jsx("br",{}),se.jsx("span",{style:{margin:"0 0 0 20px",fontSize:8},children:a.description}),se.jsx("br",{})]}))})]})]}),t.longitude&&t.latitude?se.jsxs("div",{style:{marginLeft:"auto",overflow:"hidden",marginRight:"auto",marginTop:10,marginBottom:10,width:"80%",pointerEvents:"none",position:"relative",border:"1px solid black",borderRadius:10},children:[se.jsx(zN,{initialPos:{center:[t.longitude,t.latitude],zoom:15,pitch:76,bearing:76},searchBar:!1,highlightImageId:t.id,images:[t],style:"street"}),se.jsx("a",{target:"_blank",href:`/map?pole=${t.id}`,style:{color:"white",fontWeight:"bold",fontSize:20,display:"grid",placeItems:"center",position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.3)",pointerEvents:"all"},children:"View on Map"})]}):se.jsx("p",{style:{marginTop:10,marginBottom:10},children:se.jsx("b",{children:"Pole does not have gps info."})}),se.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.components&&Object.entries(t.components).map(([e,a])=>se.jsxs(xd,{className:"overflow-hidden",children:[se.jsxs("div",{className:"p-4 border-b bg-slate-50 flex justify-between items-center",children:[se.jsx("h3",{className:"font-medium capitalize",children:e}),se.jsx(JC,{className:Kee(a.condition),children:a.condition})]}),se.jsxs("div",{className:"p-4 space-y-2",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{className:"text-sm text-gray-500",children:"Quantity:"}),se.jsx("span",{className:"font-semibold",children:a.quantity})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{className:"text-sm text-gray-500",children:"Description:"}),se.jsx("span",{className:"text-sm mt-1",children:a.description})]})]})]},e))})]})]}),se.jsxs(zW,{children:[se.jsx(rF,{children:se.jsx(fh,{type:"button",children:"Close"})}),se.jsx(fh,{type:"button",variant:"outline",onClick:()=>alert("This feature has not been implemented yet!"),children:"Generate Report"})]})]}),Jee=t=>{switch(t.toLowerCase()){case"good":return"bg-green-500";case"fair":return"bg-yellow-500";case"poor":return"bg-orange-500";case"bad":return"bg-red-500";default:return"bg-gray-500"}},hd=t=>({accessorKey:`components.${t}.condition`,header:t.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),cell:({row:e})=>{const a=e.original.components[t];return a?se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx(JC,{className:Jee(a.condition),children:a.condition}),se.jsxs("span",{className:"text-xs text-gray-500",children:["(Qty: ",a.quantity,")"]})]}):se.jsx("div",{children:"-"})},size:150}),Qee=[{accessorKey:"id",header:"ID",size:10},{accessorKey:"thumbnail",header:"Image",cell:({row:t})=>{const e=t.original.thumbnail;return e?se.jsxs("div",{className:"relative group",children:[se.jsx("img",{src:`data:image/jpeg;base64,${e}`,alt:`Pole ${t.original.id} thumbnail`,className:"w-12 h-12 object-cover rounded cursor-pointer"}),se.jsx("div",{className:"absolute hidden group-hover:block top-0 left-0 z-10",style:{width:500},children:se.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[se.jsx("img",{src:`/api/images/${t.original.id}/data`,style:{width:"100%",height:"100%"}}),se.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[se.jsx("img",{src:`/api/images/${t.original.id}/data`}),se.jsx("p",{style:{textAlign:"left",top:0,left:0,width:"100%",lineHeight:"12px",textTransform:"capitalize",height:"100%",overflow:"hidden",position:"absolute",padding:5,color:"orange",textShadow:"-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000",fontWeight:"bold"},children:Object.entries(t.original.components).filter(([,a])=>a.quantity>0).map(([a,c])=>se.jsxs(se.Fragment,{children:[se.jsxs("span",{style:{margin:0},children:[a," (",c.quantity,") - "]}),se.jsx("span",{style:{margin:0,color:{bad:"oklch(0.637 0.237 25.331)",good:"oklch(0.723 0.219 149.579)",unknown:"oklch(0.551 0.027 264.364)"}[c.condition]??"white"},children:c.condition}),se.jsx("br",{}),se.jsx("span",{style:{margin:"0 0 0 20px",fontSize:8},children:c.description}),se.jsx("br",{})]}))})]})]})})]}):se.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded flex items-center justify-center text-xs text-gray-500",children:"No image"})},size:100},{accessorKey:"status",header:"Status",size:50},{accessorKey:"date",header:({column:t})=>se.jsxs("div",{className:"flex items-center justify-end cursor-pointer",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Date Created",se.jsx(z5,{className:"ml-1 h-3 w-3"})]}),cell:({row:t})=>{const e=new Date(t.getValue("date"));return se.jsx("div",{className:"text-right",children:e.toLocaleDateString("en-US")})},size:50,maxSize:50},hd("pole"),hd("crossarms"),hd("transformers"),hd("primary wires"),hd("guy wires"),hd("street lights"),hd("customer night lights"),hd("insulators"),hd("capacitors"),hd("fault indicators"),{id:"actions",cell:({row:t})=>{const e=t.original;return se.jsxs(Bk,{children:[se.jsx(Uk,{asChild:!0,children:se.jsxs(fh,{variant:"ghost",className:"h-8 w-8 p-0",children:[se.jsx("span",{className:"sr-only",children:"Open menu"}),se.jsx(G5,{className:"h-4 w-4"})]})}),se.jsxs(Vk,{align:"end",children:[se.jsx(dW,{children:"Actions"}),se.jsx(uW,{onClick:()=>navigator.clipboard.writeText(e.id.toString()),children:"Copy Pole ID"}),se.jsx(fW,{}),se.jsxs(aF,{className:"max-h-[80vh] overflow-scroll",children:[se.jsx(oF,{asChild:!0,children:se.jsx("span",{className:"",children:"View Image details"})}),se.jsx(kN,{pole:e})]})]})]})},size:200}];function $L(t,[e,a]){return Math.min(a,Math.max(e,t))}var ete=[" ","Enter","ArrowUp","ArrowDown"],tte=[" ","Enter"],pb="Select",[jE,GE,nte]=eb(pb),[Vy,Gte]=Pm(pb,[nte,ME]),HE=ME(),[ite,zm]=Vy(pb),[rte,ate]=Vy(pb),FN=t=>{const{__scopeSelect:e,children:a,open:c,defaultOpen:p,onOpenChange:y,value:M,defaultValue:r,onValueChange:I,dir:k,name:B,autoComplete:U,disabled:H,required:Y,form:X}=t,Q=HE(e),[J,j]=le.useState(null),[oe,ce]=le.useState(null),[pe,Ae]=le.useState(!1),Ee=mE(k),[be=!1,Ve]=u_({prop:c,defaultProp:p,onChange:y}),[Se,xe]=u_({prop:M,defaultProp:r,onChange:I}),Fe=le.useRef(null),Ct=J?X||!!J.closest("form"):!0,[Et,Tt]=le.useState(new Set),_t=Array.from(Et).map(et=>et.props.value).join(";");return se.jsx(Vz,{...Q,children:se.jsxs(ite,{required:Y,scope:e,trigger:J,onTriggerChange:j,valueNode:oe,onValueNodeChange:ce,valueNodeHasChildren:pe,onValueNodeHasChildrenChange:Ae,contentId:sh(),value:Se,onValueChange:xe,open:be,onOpenChange:Ve,dir:Ee,triggerPointerDownPosRef:Fe,disabled:H,children:[se.jsx(jE.Provider,{scope:e,children:se.jsx(rte,{scope:t.__scopeSelect,onNativeOptionAdd:le.useCallback(et=>{Tt(Lt=>new Set(Lt).add(et))},[]),onNativeOptionRemove:le.useCallback(et=>{Tt(Lt=>{const lt=new Set(Lt);return lt.delete(et),lt})},[]),children:a})}),Ct?se.jsxs(oB,{"aria-hidden":!0,required:Y,tabIndex:-1,name:B,autoComplete:U,value:Se,onChange:et=>xe(et.target.value),disabled:H,form:X,children:[Se===void 0?se.jsx("option",{value:""}):null,Array.from(Et)]},_t):null]})})};FN.displayName=pb;var NN="SelectTrigger",BN=le.forwardRef((t,e)=>{const{__scopeSelect:a,disabled:c=!1,...p}=t,y=HE(a),M=zm(NN,a),r=M.disabled||c,I=na(e,M.onTriggerChange),k=GE(a),B=le.useRef("touch"),[U,H,Y]=sB(Q=>{const J=k().filter(ce=>!ce.disabled),j=J.find(ce=>ce.value===M.value),oe=lB(J,Q,j);oe!==void 0&&M.onValueChange(oe.value)}),X=Q=>{r||(M.onOpenChange(!0),Y()),Q&&(M.triggerPointerDownPosRef.current={x:Math.round(Q.pageX),y:Math.round(Q.pageY)})};return se.jsx(jz,{asChild:!0,...y,children:se.jsx(fr.button,{type:"button",role:"combobox","aria-controls":M.contentId,"aria-expanded":M.open,"aria-required":M.required,"aria-autocomplete":"none",dir:M.dir,"data-state":M.open?"open":"closed",disabled:r,"data-disabled":r?"":void 0,"data-placeholder":aB(M.value)?"":void 0,...p,ref:I,onClick:xi(p.onClick,Q=>{Q.currentTarget.focus(),B.current!=="mouse"&&X(Q)}),onPointerDown:xi(p.onPointerDown,Q=>{B.current=Q.pointerType;const J=Q.target;J.hasPointerCapture(Q.pointerId)&&J.releasePointerCapture(Q.pointerId),Q.button===0&&Q.ctrlKey===!1&&Q.pointerType==="mouse"&&(X(Q),Q.preventDefault())}),onKeyDown:xi(p.onKeyDown,Q=>{const J=U.current!=="";!(Q.ctrlKey||Q.altKey||Q.metaKey)&&Q.key.length===1&&H(Q.key),!(J&&Q.key===" ")&&ete.includes(Q.key)&&(X(),Q.preventDefault())})})})});BN.displayName=NN;var UN="SelectValue",VN=le.forwardRef((t,e)=>{const{__scopeSelect:a,className:c,style:p,children:y,placeholder:M="",...r}=t,I=zm(UN,a),{onValueNodeHasChildrenChange:k}=I,B=y!==void 0,U=na(e,I.onValueNodeChange);return ss(()=>{k(B)},[k,B]),se.jsx(fr.span,{...r,ref:U,style:{pointerEvents:"none"},children:aB(I.value)?se.jsx(se.Fragment,{children:M}):y})});VN.displayName=UN;var ote="SelectIcon",jN=le.forwardRef((t,e)=>{const{__scopeSelect:a,children:c,...p}=t;return se.jsx(fr.span,{"aria-hidden":!0,...p,ref:e,children:c||"▼"})});jN.displayName=ote;var ste="SelectPortal",GN=t=>se.jsx(TE,{asChild:!0,...t});GN.displayName=ste;var y_="SelectContent",HN=le.forwardRef((t,e)=>{const a=zm(y_,t.__scopeSelect),[c,p]=le.useState();if(ss(()=>{p(new DocumentFragment)},[]),!a.open){const y=c;return y?J0.createPortal(se.jsx(qN,{scope:t.__scopeSelect,children:se.jsx(jE.Slot,{scope:t.__scopeSelect,children:se.jsx("div",{children:t.children})})}),y):null}return se.jsx(WN,{...t,ref:e})});HN.displayName=y_;var ih=10,[qN,km]=Vy(y_),lte="SelectContentImpl",WN=le.forwardRef((t,e)=>{const{__scopeSelect:a,position:c="item-aligned",onCloseAutoFocus:p,onEscapeKeyDown:y,onPointerDownOutside:M,side:r,sideOffset:I,align:k,alignOffset:B,arrowPadding:U,collisionBoundary:H,collisionPadding:Y,sticky:X,hideWhenDetached:Q,avoidCollisions:J,...j}=t,oe=zm(y_,a),[ce,pe]=le.useState(null),[Ae,Ee]=le.useState(null),be=na(e,$t=>pe($t)),[Ve,Se]=le.useState(null),[xe,Fe]=le.useState(null),Ct=GE(a),[Et,Tt]=le.useState(!1),_t=le.useRef(!1);le.useEffect(()=>{if(ce)return fR(ce)},[ce]),iR();const et=le.useCallback($t=>{const[pn,...jn]=Ct().map(vn=>vn.ref.current),[Pe]=jn.slice(-1),Gn=document.activeElement;for(const vn of $t)if(vn===Gn||(vn==null||vn.scrollIntoView({block:"nearest"}),vn===pn&&Ae&&(Ae.scrollTop=0),vn===Pe&&Ae&&(Ae.scrollTop=Ae.scrollHeight),vn==null||vn.focus(),document.activeElement!==Gn))return},[Ct,Ae]),Lt=le.useCallback(()=>et([Ve,ce]),[et,Ve,ce]);le.useEffect(()=>{Et&&Lt()},[Et,Lt]);const{onOpenChange:lt,triggerPointerDownPosRef:ut}=oe;le.useEffect(()=>{if(ce){let $t={x:0,y:0};const pn=Pe=>{var Gn,vn;$t={x:Math.abs(Math.round(Pe.pageX)-(((Gn=ut.current)==null?void 0:Gn.x)??0)),y:Math.abs(Math.round(Pe.pageY)-(((vn=ut.current)==null?void 0:vn.y)??0))}},jn=Pe=>{$t.x<=10&&$t.y<=10?Pe.preventDefault():ce.contains(Pe.target)||lt(!1),document.removeEventListener("pointermove",pn),ut.current=null};return ut.current!==null&&(document.addEventListener("pointermove",pn),document.addEventListener("pointerup",jn,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",pn),document.removeEventListener("pointerup",jn,{capture:!0})}}},[ce,lt,ut]),le.useEffect(()=>{const $t=()=>lt(!1);return window.addEventListener("blur",$t),window.addEventListener("resize",$t),()=>{window.removeEventListener("blur",$t),window.removeEventListener("resize",$t)}},[lt]);const[Xe,kt]=sB($t=>{const pn=Ct().filter(Gn=>!Gn.disabled),jn=pn.find(Gn=>Gn.ref.current===document.activeElement),Pe=lB(pn,$t,jn);Pe&&setTimeout(()=>Pe.ref.current.focus())}),_n=le.useCallback(($t,pn,jn)=>{const Pe=!_t.current&&!jn;(oe.value!==void 0&&oe.value===pn||Pe)&&(Se($t),Pe&&(_t.current=!0))},[oe.value]),Xt=le.useCallback(()=>ce==null?void 0:ce.focus(),[ce]),It=le.useCallback(($t,pn,jn)=>{const Pe=!_t.current&&!jn;(oe.value!==void 0&&oe.value===pn||Pe)&&Fe($t)},[oe.value]),ln=c==="popper"?TC:$N,fn=ln===TC?{side:r,sideOffset:I,align:k,alignOffset:B,arrowPadding:U,collisionBoundary:H,collisionPadding:Y,sticky:X,hideWhenDetached:Q,avoidCollisions:J}:{};return se.jsx(qN,{scope:a,content:ce,viewport:Ae,onViewportChange:Ee,itemRefCallback:_n,selectedItem:Ve,onItemLeave:Xt,itemTextRefCallback:It,focusSelectedItem:Lt,selectedItemText:xe,position:c,isPositioned:Et,searchRef:Xe,children:se.jsx(RE,{as:Jf,allowPinchZoom:!0,children:se.jsx(bE,{asChild:!0,trapped:oe.open,onMountAutoFocus:$t=>{$t.preventDefault()},onUnmountAutoFocus:xi(p,$t=>{var pn;(pn=oe.trigger)==null||pn.focus({preventScroll:!0}),$t.preventDefault()}),children:se.jsx(tb,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:y,onPointerDownOutside:M,onFocusOutside:$t=>$t.preventDefault(),onDismiss:()=>oe.onOpenChange(!1),children:se.jsx(ln,{role:"listbox",id:oe.contentId,"data-state":oe.open?"open":"closed",dir:oe.dir,onContextMenu:$t=>$t.preventDefault(),...j,...fn,onPlaced:()=>Tt(!0),ref:be,style:{display:"flex",flexDirection:"column",outline:"none",...j.style},onKeyDown:xi(j.onKeyDown,$t=>{const pn=$t.ctrlKey||$t.altKey||$t.metaKey;if($t.key==="Tab"&&$t.preventDefault(),!pn&&$t.key.length===1&&kt($t.key),["ArrowUp","ArrowDown","Home","End"].includes($t.key)){let Pe=Ct().filter(Gn=>!Gn.disabled).map(Gn=>Gn.ref.current);if(["ArrowUp","End"].includes($t.key)&&(Pe=Pe.slice().reverse()),["ArrowUp","ArrowDown"].includes($t.key)){const Gn=$t.target,vn=Pe.indexOf(Gn);Pe=Pe.slice(vn+1)}setTimeout(()=>et(Pe)),$t.preventDefault()}})})})})})})});WN.displayName=lte;var cte="SelectItemAlignedPosition",$N=le.forwardRef((t,e)=>{const{__scopeSelect:a,onPlaced:c,...p}=t,y=zm(y_,a),M=km(y_,a),[r,I]=le.useState(null),[k,B]=le.useState(null),U=na(e,be=>B(be)),H=GE(a),Y=le.useRef(!1),X=le.useRef(!0),{viewport:Q,selectedItem:J,selectedItemText:j,focusSelectedItem:oe}=M,ce=le.useCallback(()=>{if(y.trigger&&y.valueNode&&r&&k&&Q&&J&&j){const be=y.trigger.getBoundingClientRect(),Ve=k.getBoundingClientRect(),Se=y.valueNode.getBoundingClientRect(),xe=j.getBoundingClientRect();if(y.dir!=="rtl"){const Gn=xe.left-Ve.left,vn=Se.left-Gn,qn=be.left-vn,ke=be.width+qn,Fi=Math.max(ke,Ve.width),di=window.innerWidth-ih,bi=$L(vn,[ih,Math.max(ih,di-Fi)]);r.style.minWidth=ke+"px",r.style.left=bi+"px"}else{const Gn=Ve.right-xe.right,vn=window.innerWidth-Se.right-Gn,qn=window.innerWidth-be.right-vn,ke=be.width+qn,Fi=Math.max(ke,Ve.width),di=window.innerWidth-ih,bi=$L(vn,[ih,Math.max(ih,di-Fi)]);r.style.minWidth=ke+"px",r.style.right=bi+"px"}const Fe=H(),Ct=window.innerHeight-ih*2,Et=Q.scrollHeight,Tt=window.getComputedStyle(k),_t=parseInt(Tt.borderTopWidth,10),et=parseInt(Tt.paddingTop,10),Lt=parseInt(Tt.borderBottomWidth,10),lt=parseInt(Tt.paddingBottom,10),ut=_t+et+Et+lt+Lt,Xe=Math.min(J.offsetHeight*5,ut),kt=window.getComputedStyle(Q),_n=parseInt(kt.paddingTop,10),Xt=parseInt(kt.paddingBottom,10),It=be.top+be.height/2-ih,ln=Ct-It,fn=J.offsetHeight/2,$t=J.offsetTop+fn,pn=_t+et+$t,jn=ut-pn;if(pn<=It){const Gn=Fe.length>0&&J===Fe[Fe.length-1].ref.current;r.style.bottom="0px";const vn=k.clientHeight-Q.offsetTop-Q.offsetHeight,qn=Math.max(ln,fn+(Gn?Xt:0)+vn+Lt),ke=pn+qn;r.style.height=ke+"px"}else{const Gn=Fe.length>0&&J===Fe[0].ref.current;r.style.top="0px";const qn=Math.max(It,_t+Q.offsetTop+(Gn?_n:0)+fn)+jn;r.style.height=qn+"px",Q.scrollTop=pn-It+Q.offsetTop}r.style.margin=`${ih}px 0`,r.style.minHeight=Xe+"px",r.style.maxHeight=Ct+"px",c==null||c(),requestAnimationFrame(()=>Y.current=!0)}},[H,y.trigger,y.valueNode,r,k,Q,J,j,y.dir,c]);ss(()=>ce(),[ce]);const[pe,Ae]=le.useState();ss(()=>{k&&Ae(window.getComputedStyle(k).zIndex)},[k]);const Ee=le.useCallback(be=>{be&&X.current===!0&&(ce(),oe==null||oe(),X.current=!1)},[ce,oe]);return se.jsx(hte,{scope:a,contentWrapper:r,shouldExpandOnScrollRef:Y,onScrollButtonChange:Ee,children:se.jsx("div",{ref:I,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:pe},children:se.jsx(fr.div,{...p,ref:U,style:{boxSizing:"border-box",maxHeight:"100%",...p.style}})})})});$N.displayName=cte;var ute="SelectPopperPosition",TC=le.forwardRef((t,e)=>{const{__scopeSelect:a,align:c="start",collisionPadding:p=ih,...y}=t,M=HE(a);return se.jsx(Gz,{...M,...y,ref:e,align:c,collisionPadding:p,style:{boxSizing:"border-box",...y.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});TC.displayName=ute;var[hte,rI]=Vy(y_,{}),AC="SelectViewport",XN=le.forwardRef((t,e)=>{const{__scopeSelect:a,nonce:c,...p}=t,y=km(AC,a),M=rI(AC,a),r=na(e,y.onViewportChange),I=le.useRef(0);return se.jsxs(se.Fragment,{children:[se.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:c}),se.jsx(jE.Slot,{scope:a,children:se.jsx(fr.div,{"data-radix-select-viewport":"",role:"presentation",...p,ref:r,style:{position:"relative",flex:1,overflow:"hidden auto",...p.style},onScroll:xi(p.onScroll,k=>{const B=k.currentTarget,{contentWrapper:U,shouldExpandOnScrollRef:H}=M;if(H!=null&&H.current&&U){const Y=Math.abs(I.current-B.scrollTop);if(Y>0){const X=window.innerHeight-ih*2,Q=parseFloat(U.style.minHeight),J=parseFloat(U.style.height),j=Math.max(Q,J);if(j<X){const oe=j+Y,ce=Math.min(X,oe),pe=oe-ce;U.style.height=ce+"px",U.style.bottom==="0px"&&(B.scrollTop=pe>0?pe:0,U.style.justifyContent="flex-end")}}}I.current=B.scrollTop})})})]})});XN.displayName=AC;var ZN="SelectGroup",[dte,fte]=Vy(ZN),pte=le.forwardRef((t,e)=>{const{__scopeSelect:a,...c}=t,p=sh();return se.jsx(dte,{scope:a,id:p,children:se.jsx(fr.div,{role:"group","aria-labelledby":p,...c,ref:e})})});pte.displayName=ZN;var YN="SelectLabel",mte=le.forwardRef((t,e)=>{const{__scopeSelect:a,...c}=t,p=fte(YN,a);return se.jsx(fr.div,{id:p.id,...c,ref:e})});mte.displayName=YN;var dE="SelectItem",[gte,KN]=Vy(dE),JN=le.forwardRef((t,e)=>{const{__scopeSelect:a,value:c,disabled:p=!1,textValue:y,...M}=t,r=zm(dE,a),I=km(dE,a),k=r.value===c,[B,U]=le.useState(y??""),[H,Y]=le.useState(!1),X=na(e,oe=>{var ce;return(ce=I.itemRefCallback)==null?void 0:ce.call(I,oe,c,p)}),Q=sh(),J=le.useRef("touch"),j=()=>{p||(r.onValueChange(c),r.onOpenChange(!1))};if(c==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return se.jsx(gte,{scope:a,value:c,disabled:p,textId:Q,isSelected:k,onItemTextChange:le.useCallback(oe=>{U(ce=>ce||((oe==null?void 0:oe.textContent)??"").trim())},[]),children:se.jsx(jE.ItemSlot,{scope:a,value:c,disabled:p,textValue:B,children:se.jsx(fr.div,{role:"option","aria-labelledby":Q,"data-highlighted":H?"":void 0,"aria-selected":k&&H,"data-state":k?"checked":"unchecked","aria-disabled":p||void 0,"data-disabled":p?"":void 0,tabIndex:p?void 0:-1,...M,ref:X,onFocus:xi(M.onFocus,()=>Y(!0)),onBlur:xi(M.onBlur,()=>Y(!1)),onClick:xi(M.onClick,()=>{J.current!=="mouse"&&j()}),onPointerUp:xi(M.onPointerUp,()=>{J.current==="mouse"&&j()}),onPointerDown:xi(M.onPointerDown,oe=>{J.current=oe.pointerType}),onPointerMove:xi(M.onPointerMove,oe=>{var ce;J.current=oe.pointerType,p?(ce=I.onItemLeave)==null||ce.call(I):J.current==="mouse"&&oe.currentTarget.focus({preventScroll:!0})}),onPointerLeave:xi(M.onPointerLeave,oe=>{var ce;oe.currentTarget===document.activeElement&&((ce=I.onItemLeave)==null||ce.call(I))}),onKeyDown:xi(M.onKeyDown,oe=>{var pe;((pe=I.searchRef)==null?void 0:pe.current)!==""&&oe.key===" "||(tte.includes(oe.key)&&j(),oe.key===" "&&oe.preventDefault())})})})})});JN.displayName=dE;var D0="SelectItemText",QN=le.forwardRef((t,e)=>{const{__scopeSelect:a,className:c,style:p,...y}=t,M=zm(D0,a),r=km(D0,a),I=KN(D0,a),k=ate(D0,a),[B,U]=le.useState(null),H=na(e,j=>U(j),I.onItemTextChange,j=>{var oe;return(oe=r.itemTextRefCallback)==null?void 0:oe.call(r,j,I.value,I.disabled)}),Y=B==null?void 0:B.textContent,X=le.useMemo(()=>se.jsx("option",{value:I.value,disabled:I.disabled,children:Y},I.value),[I.disabled,I.value,Y]),{onNativeOptionAdd:Q,onNativeOptionRemove:J}=k;return ss(()=>(Q(X),()=>J(X)),[Q,J,X]),se.jsxs(se.Fragment,{children:[se.jsx(fr.span,{id:I.textId,...y,ref:H}),I.isSelected&&M.valueNode&&!M.valueNodeHasChildren?J0.createPortal(y.children,M.valueNode):null]})});QN.displayName=D0;var eB="SelectItemIndicator",tB=le.forwardRef((t,e)=>{const{__scopeSelect:a,...c}=t;return KN(eB,a).isSelected?se.jsx(fr.span,{"aria-hidden":!0,...c,ref:e}):null});tB.displayName=eB;var CC="SelectScrollUpButton",nB=le.forwardRef((t,e)=>{const a=km(CC,t.__scopeSelect),c=rI(CC,t.__scopeSelect),[p,y]=le.useState(!1),M=na(e,c.onScrollButtonChange);return ss(()=>{if(a.viewport&&a.isPositioned){let r=function(){const k=I.scrollTop>0;y(k)};const I=a.viewport;return r(),I.addEventListener("scroll",r),()=>I.removeEventListener("scroll",r)}},[a.viewport,a.isPositioned]),p?se.jsx(rB,{...t,ref:M,onAutoScroll:()=>{const{viewport:r,selectedItem:I}=a;r&&I&&(r.scrollTop=r.scrollTop-I.offsetHeight)}}):null});nB.displayName=CC;var RC="SelectScrollDownButton",iB=le.forwardRef((t,e)=>{const a=km(RC,t.__scopeSelect),c=rI(RC,t.__scopeSelect),[p,y]=le.useState(!1),M=na(e,c.onScrollButtonChange);return ss(()=>{if(a.viewport&&a.isPositioned){let r=function(){const k=I.scrollHeight-I.clientHeight,B=Math.ceil(I.scrollTop)<k;y(B)};const I=a.viewport;return r(),I.addEventListener("scroll",r),()=>I.removeEventListener("scroll",r)}},[a.viewport,a.isPositioned]),p?se.jsx(rB,{...t,ref:M,onAutoScroll:()=>{const{viewport:r,selectedItem:I}=a;r&&I&&(r.scrollTop=r.scrollTop+I.offsetHeight)}}):null});iB.displayName=RC;var rB=le.forwardRef((t,e)=>{const{__scopeSelect:a,onAutoScroll:c,...p}=t,y=km("SelectScrollButton",a),M=le.useRef(null),r=GE(a),I=le.useCallback(()=>{M.current!==null&&(window.clearInterval(M.current),M.current=null)},[]);return le.useEffect(()=>()=>I(),[I]),ss(()=>{var B;const k=r().find(U=>U.ref.current===document.activeElement);(B=k==null?void 0:k.ref.current)==null||B.scrollIntoView({block:"nearest"})},[r]),se.jsx(fr.div,{"aria-hidden":!0,...p,ref:e,style:{flexShrink:0,...p.style},onPointerDown:xi(p.onPointerDown,()=>{M.current===null&&(M.current=window.setInterval(c,50))}),onPointerMove:xi(p.onPointerMove,()=>{var k;(k=y.onItemLeave)==null||k.call(y),M.current===null&&(M.current=window.setInterval(c,50))}),onPointerLeave:xi(p.onPointerLeave,()=>{I()})})}),_te="SelectSeparator",vte=le.forwardRef((t,e)=>{const{__scopeSelect:a,...c}=t;return se.jsx(fr.div,{"aria-hidden":!0,...c,ref:e})});vte.displayName=_te;var IC="SelectArrow",yte=le.forwardRef((t,e)=>{const{__scopeSelect:a,...c}=t,p=HE(a),y=zm(IC,a),M=km(IC,a);return y.open&&M.position==="popper"?se.jsx(Hz,{...p,...c,ref:e}):null});yte.displayName=IC;function aB(t){return t===""||t===void 0}var oB=le.forwardRef((t,e)=>{const{value:a,...c}=t,p=le.useRef(null),y=na(e,p),M=xO(a);return le.useEffect(()=>{const r=p.current,I=window.HTMLSelectElement.prototype,B=Object.getOwnPropertyDescriptor(I,"value").set;if(M!==a&&B){const U=new Event("change",{bubbles:!0});B.call(r,a),r.dispatchEvent(U)}},[M,a]),se.jsx(FC,{asChild:!0,children:se.jsx("select",{...c,ref:y,defaultValue:a})})});oB.displayName="BubbleSelect";function sB(t){const e=Ho(t),a=le.useRef(""),c=le.useRef(0),p=le.useCallback(M=>{const r=a.current+M;e(r),function I(k){a.current=k,window.clearTimeout(c.current),k!==""&&(c.current=window.setTimeout(()=>I(""),1e3))}(r)},[e]),y=le.useCallback(()=>{a.current="",window.clearTimeout(c.current)},[]);return le.useEffect(()=>()=>window.clearTimeout(c.current),[]),[a,p,y]}function lB(t,e,a){const p=e.length>1&&Array.from(e).every(k=>k===e[0])?e[0]:e,y=a?t.indexOf(a):-1;let M=xte(t,Math.max(y,0));p.length===1&&(M=M.filter(k=>k!==a));const I=M.find(k=>k.textValue.toLowerCase().startsWith(p.toLowerCase()));return I!==a?I:void 0}function xte(t,e){return t.map((a,c)=>t[(e+c)%t.length])}var bte=FN,wte=BN,Ste=VN,Ete=jN,Mte=GN,Tte=HN,Ate=XN,Cte=JN,Rte=QN,Ite=tB,Dte=nB,Pte=iB;function v2({...t}){return se.jsx(bte,{"data-slot":"select",...t})}function y2({...t}){return se.jsx(Ste,{"data-slot":"select-value",...t})}function x2({className:t,children:e,...a}){return se.jsxs(wte,{"data-slot":"select-trigger",className:yr("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive flex h-9 w-full items-center justify-between rounded-md border bg-transparent px-3 py-2 text-sm shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 [&>span]:line-clamp-1",t),...a,children:[e,se.jsx(Ete,{asChild:!0,children:se.jsx(gO,{className:"size-4 opacity-50"})})]})}function b2({className:t,children:e,position:a="popper",...c}){return se.jsx(Mte,{children:se.jsxs(Tte,{"data-slot":"select-content",className:yr("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border shadow-md",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:a,...c,children:[se.jsx(Lte,{}),se.jsx(Ate,{className:yr("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:e}),se.jsx(Ote,{})]})})}function w2({className:t,children:e,...a}){return se.jsxs(Cte,{"data-slot":"select-item",className:yr("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...a,children:[se.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:se.jsx(Ite,{children:se.jsx(mO,{className:"size-4"})})}),se.jsx(Rte,{children:e})]})}function Lte({className:t,...e}){return se.jsx(Dte,{"data-slot":"select-scroll-up-button",className:yr("flex cursor-default items-center justify-center py-1",t),...e,children:se.jsx(B5,{className:"size-4"})})}function Ote({className:t,...e}){return se.jsx(Pte,{"data-slot":"select-scroll-down-button",className:yr("flex cursor-default items-center justify-center py-1",t),...e,children:se.jsx(gO,{className:"size-4"})})}const zte=()=>{var j;const[t,e]=le.useState([]),[a,c]=le.useState([]),[p,y]=le.useState(!0),[M,r]=le.useState(null),[I,k]=le.useState({assetType:"",condition:"",minPrice:"",maxPrice:"",location:""}),[B,U]=le.useState(null);function H(oe){if(Object.keys(oe).length===0)return"Unknown";const ce={bad:0,good:0,unknown:0};for(const Ae in oe)oe[Ae].condition in ce&&ce[oe[Ae].condition]++;return Object.keys(ce).reduce((Ae,Ee)=>ce[Ae]>ce[Ee]?Ae:Ee)}if(le.useEffect(()=>{(async()=>{console.log("Attempting to fetch Pole Data "),y(!0);try{const ce=await fetch("/api/images-meta");if(ce.ok){const pe=await ce.json();if(pe.images&&pe.images.length>0){console.log("Original Array"),console.log(pe.images);const Ae=pe.images.map(Ee=>{let be=H(Ee.components);return{id:Ee.id,status:be,date:Ee.time_created,components:Ee.components||{},thumbnail:Ee.thumbnail||void 0,latitude:Ee.latitude||null,longitude:Ee.longitude&&-Math.abs(Ee.longitude)||Ee.longitude||null}});console.log("New Typed Poles"),c(Ae),e(Ae)}else c([])}else r("Error fetching image metadata")}catch(ce){r(`Error: ${ce.message}`)}finally{y(!1)}})()},[]),p)return se.jsx(xd,{className:"w-full",children:se.jsx(F2,{className:"text-center",children:se.jsx(qS,{children:"Loading image metadata..."})})});if(M)return se.jsx(xd,{className:"w-full border-red-200",children:se.jsxs(F2,{className:"bg-red-50 text-red-700",children:[se.jsx(qS,{children:"Error"}),se.jsx(Sj,{className:"text-red-600",children:M})]})});const Y=["Overall","Pole","Crossarms","Guy Wires","Insulators","Primary Wires","Street Lights","Transformers"],X=["Good","Bad","Unknown","Any"],Q=(oe,ce)=>{k(pe=>({...pe,[oe]:ce}))},J=()=>{console.log("Filters Applied:",I);let oe=I.assetType.toLowerCase(),ce=I.condition.toLowerCase();const pe=I.location;let Ae=t;oe==="overall"&&ce==="any"?Ae=t:oe==="overall"?Ae=t.filter(be=>be.status===ce):ce==="any"?Ae=t:oe&&ce&&(Ae=t.filter(be=>be.components[oe]&&be.components[oe].condition===ce)),pe==="Has Location"?Ae=Ae.filter(be=>be.latitude&&be.longitude):pe==="No Location"&&(Ae=Ae.filter(be=>!(be.latitude||be.longitude))),c(Ae);const Ee=document.querySelector("#results");Ee&&(Ee.className="inline")};return se.jsxs("div",{className:"min-h-screen bg-zinc-300 flex flex-col w-full ",children:[se.jsx(gE,{}),se.jsx("div",{className:"flex justify-between m-10 align-center ",children:se.jsxs(xd,{className:"border-blue-500 border-t-8  w-250 flex-1",style:{maxWidth:"100%"},children:[se.jsx("h2",{className:"text-2xl font-semibold",children:"Utility Pole Inventory"}),se.jsx(xd,{style:{width:"max-content"},className:"flex flex-col shadow-lg bg-zinc-50 text-black border-1 border-rose-500 p-2 ml-10 w-4/12",children:se.jsxs(yE,{className:"p-4 space-y-4 text-black",style:{width:"max-content"},children:[se.jsx("h2",{className:"text-xl font-semibold",children:"Search Assets"}),se.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",style:{width:"max-content"},children:[se.jsx("div",{children:se.jsxs(v2,{onValueChange:oe=>Q("assetType",oe),children:[se.jsx(x2,{children:se.jsx(y2,{placeholder:"Select Asset Type"})}),se.jsx(b2,{children:Y.map(oe=>se.jsx(w2,{value:oe,children:oe},oe))})]})}),se.jsx("div",{children:se.jsxs(v2,{onValueChange:oe=>Q("condition",oe),children:[se.jsx(x2,{children:se.jsx(y2,{placeholder:"Select Condition"})}),se.jsx(b2,{children:X.map(oe=>se.jsx(w2,{value:oe,children:oe},oe))})]})}),se.jsx("div",{children:se.jsxs(v2,{onValueChange:oe=>Q("location",oe),children:[se.jsx(x2,{children:se.jsx(y2,{placeholder:"Location"})}),se.jsx(b2,{children:["Has Location","No Location","Any"].map(oe=>se.jsx(w2,{value:oe,children:oe},oe))})]})}),se.jsx("div",{children:se.jsx(fh,{className:" bg-rose-500 text-white flex-1",onClick:J,children:"Search"})})]})]})}),se.jsxs("div",{className:"relative mx-5",style:{maxWidth:"100%",overflowX:"auto"},children:[B&&se.jsx("div",{className:"absolute bg-white p-2 shadow-md rounded",style:{top:"10px",left:"10px",zIndex:10},children:se.jsx("img",{src:((j=a.find(oe=>oe.id===B))==null?void 0:j.thumbnail)||"",alt:"Thumbnail",className:"h-24 w-24 object-cover"})}),se.jsx(mW,{columns:Qee,data:a,onRowHover:oe=>U(oe),onRowLeave:()=>U(null)})]})]})})]})};function kte(t){const[e,a]=Go.useState(!1);le.useEffect(()=>{a(t.image!==void 0)},[a,t.image]);const[c,p]=Go.useState(!0);function y(){a(!1),setTimeout(t.onClose,300)}return se.jsx("div",{style:{position:"absolute",top:"50%",transform:`translateY(-50%) ${e?"translateX(0)":"translateX(-100%)"}`,transition:"all 0.3s ease-in-out",left:"0",width:"250px",height:"400px",backgroundColor:"#eeeeee",zIndex:10,boxShadow:"2px 0 5px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",borderRadius:10,overflow:"hidden"},children:t.image!==void 0&&se.jsxs(se.Fragment,{children:[se.jsxs("div",{style:{display:"flex",paddingLeft:10,justifyContent:"space-between",alignItems:"center",background:"#FD2858"},children:[se.jsxs("h3",{style:{margin:"0",color:"white"},children:["Pole ",t.image.id]}),se.jsx("button",{onClick:y,style:{background:"none",color:"white",border:"none",cursor:"pointer",fontSize:"16px"},children:"X"})]}),se.jsxs("div",{style:{display:"flex",overflowY:"auto",flexDirection:"column",flex:1,padding:"10px"},children:[se.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",gap:5,marginBottom:5},children:["Show Annotations ",se.jsx("input",{type:"checkbox",checked:c,className:"toggle",onChange:M=>p(M.target.checked)})]}),se.jsxs("div",{style:{width:"100%",position:"relative"},children:[se.jsx("img",{style:{width:"100%"},src:`/api/images/${t.image.id}/data`,alt:`power pole ${t.image.id}`}),c&&se.jsx("p",{style:{textAlign:"left",top:0,left:0,width:"100%",lineHeight:"12px",textTransform:"capitalize",overflow:"hidden",height:"100%",position:"absolute",padding:5,color:"orange",textShadow:"-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000",fontWeight:"bold"},children:Object.entries(t.image.components).filter(([,M])=>M.quantity>0).map(([M,r])=>se.jsxs(se.Fragment,{children:[se.jsxs("span",{style:{margin:0},children:[M," (",r.quantity,") - "]}),se.jsx("span",{style:{margin:0,color:{bad:"oklch(0.637 0.237 25.331)",good:"oklch(0.723 0.219 149.579)",unknown:"oklch(0.551 0.027 264.364)"}[r.condition]??"white"},children:r.condition}),se.jsx("br",{}),se.jsx("span",{style:{margin:"0 0 0 20px",fontSize:8},children:r.description}),se.jsx("br",{})]}))})]}),se.jsx("table",{className:"table",children:se.jsx("tbody",{children:Object.entries(t.image.components).filter(([,M])=>M.quantity>0).map(([M,r])=>se.jsxs(Go.Fragment,{children:[se.jsx("tr",{children:se.jsx("th",{children:M})}),se.jsxs("tr",{children:[se.jsx("td",{children:"Count"}),se.jsx("td",{children:r.quantity})]}),se.jsxs("tr",{children:[se.jsx("td",{children:"Condition"}),se.jsx("td",{style:{fontWeight:"bold",color:{bad:"oklch(0.637 0.237 25.331)",good:"oklch(0.723 0.219 149.579)",unknown:"oklch(0.551 0.027 264.364)"}[r.condition]??"white"},children:r.condition})]}),se.jsxs("tr",{children:[se.jsx("td",{children:"Description"}),se.jsx("td",{style:{fontSize:10},children:r.description})]})]},M))})})]}),se.jsxs(aF,{children:[se.jsx(oF,{asChild:!0,children:se.jsx("button",{style:{margin:10,background:"#F0A5B6",color:"white",border:"none",cursor:"pointer",fontSize:"16px",borderRadius:10},children:"View Details"})}),se.jsx(kN,{pole:t.image})]})]})})}function XL(t,e,a,c){const p=H=>H*(Math.PI/180),M=p(t),r=p(a),I=p(a-t),k=p(c-e),B=Math.sin(I/2)**2+Math.cos(M)*Math.cos(r)*Math.sin(k/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(B),Math.sqrt(1-B)))}const Fte=()=>{const[t,e]=le.useState(void 0),[a,c]=le.useState(void 0),[p,y]=le.useState("street"),[M,r]=b5(),[I,k]=le.useState(void 0);le.useEffect(()=>{(async()=>{try{const{images:J}=await(await fetch("/api/images-meta")).json(),j=J.filter(ce=>ce.latitude&&ce.longitude).map(ce=>(ce.longitude=-Math.abs(ce.longitude),ce));c(j);const oe=M.get("pole");if(oe){const ce=j==null?void 0:j.find(pe=>pe.id===parseInt(oe));ce&&(e(ce),setTimeout(()=>{H({center:[ce.longitude,ce.latitude],zoom:16,pitch:76,bearing:76})},200),X(!0))}console.log("images loaded")}catch(J){k(String(J))}})()},[]);function B(J,j){const oe=a==null?void 0:a.reduce((ce,pe)=>{const Ae=XL(ce.latitude,ce.longitude,J,j);return XL(pe.latitude,pe.longitude,J,j)<Ae?pe:ce},a[0]);oe&&(r({pole:oe.id.toString()}),e(oe),H({center:[oe.longitude,oe.latitude],zoom:17,pitch:76,bearing:76}))}const[U,H]=le.useState({center:[-91.180421,30.417421],zoom:1,pitch:0,bearing:0}),[Y,X]=le.useState(!1);function Q(){H({center:t?[t.longitude,t.latitude]:[-90.09497222222221,29.981194444444444],zoom:16,pitch:76,bearing:76}),X(!0)}return se.jsxs("div",{className:"bg-zinc-300",style:{width:"100%",height:"100%",display:"grid",gridTemplateRows:"min-content 1fr"},children:[se.jsx(gE,{}),se.jsxs("main",{className:"",style:{width:"100%",height:"100%",overflow:"hidden",position:"relative"},children:[se.jsx(kte,{image:Y?t:void 0,onClose:()=>{e(void 0),r({})},onShowDetails:()=>{}}),I===void 0&&(a!==void 0?se.jsxs(se.Fragment,{children:[se.jsxs("div",{style:{position:"absolute",bottom:20,right:20,display:"flex",padding:"5px 10px",background:"white",borderRadius:10,placeItems:"center",gap:10},children:[se.jsx("span",{children:"Streets"}),se.jsx("input",{type:"checkbox",className:"toggle",checked:p==="satellite",onChange:J=>y(J.target.checked?"satellite":"street")}),se.jsx("span",{children:"Satellite"})]}),se.jsx(zN,{initialPos:U,images:a,style:p,onClick:B,highlightImageId:t==null?void 0:t.id}),!Y&&se.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",color:"white",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1,fontSize:"24px",fontWeight:"bold",cursor:"pointer"},onClick:Q,children:"Click to Begin"})]}):se.jsx("h1",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:"Loading images"})),I!==void 0&&se.jsxs(se.Fragment,{children:[se.jsx("h1",{children:"Error loading images"}),se.jsx("button",{onClick:()=>window.location.reload(),children:"Reload Page"}),se.jsx("pre",{children:I})]})]})]})};iU.createRoot(document.getElementById("root")).render(se.jsx(le.StrictMode,{children:se.jsx(_5,{children:se.jsxs($U,{children:[se.jsx(n0,{path:"/",element:se.jsx(Oj,{})}),se.jsx(n0,{path:"map",element:se.jsx(Fte,{})}),se.jsx(n0,{path:"query",element:se.jsx(zte,{})}),se.jsx(n0,{path:"upload",element:se.jsx(BG,{})})]})})}));
